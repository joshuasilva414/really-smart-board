function voe(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const o=Object.getOwnPropertyDescriptor(r,i);o&&Object.defineProperty(t,i,o.get?o:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();var Qr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ua(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var vI={exports:{}},Og={},xI={exports:{}},zt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var A$;function xoe(){if(A$)return zt;A$=1;var t=Symbol.for("react.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),s=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),u=Symbol.iterator;function p(H){return H===null||typeof H!="object"?null:(H=u&&H[u]||H["@@iterator"],typeof H=="function"?H:null)}var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,v={};function x(H,ie,U){this.props=H,this.context=ie,this.refs=v,this.updater=U||f}x.prototype.isReactComponent={},x.prototype.setState=function(H,ie){if(typeof H!="object"&&typeof H!="function"&&H!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,H,ie,"setState")},x.prototype.forceUpdate=function(H){this.updater.enqueueForceUpdate(this,H,"forceUpdate")};function b(){}b.prototype=x.prototype;function w(H,ie,U){this.props=H,this.context=ie,this.refs=v,this.updater=U||f}var _=w.prototype=new b;_.constructor=w,y(_,x.prototype),_.isPureReactComponent=!0;var C=Array.isArray,A=Object.prototype.hasOwnProperty,E={current:null},O={key:!0,ref:!0,__self:!0,__source:!0};function D(H,ie,U){var ke,ge={},Te=null,ye=null;if(ie!=null)for(ke in ie.ref!==void 0&&(ye=ie.ref),ie.key!==void 0&&(Te=""+ie.key),ie)A.call(ie,ke)&&!O.hasOwnProperty(ke)&&(ge[ke]=ie[ke]);var Se=arguments.length-2;if(Se===1)ge.children=U;else if(1<Se){for(var Re=Array(Se),$e=0;$e<Se;$e++)Re[$e]=arguments[$e+2];ge.children=Re}if(H&&H.defaultProps)for(ke in Se=H.defaultProps,Se)ge[ke]===void 0&&(ge[ke]=Se[ke]);return{$$typeof:t,type:H,key:Te,ref:ye,props:ge,_owner:E.current}}function B(H,ie){return{$$typeof:t,type:H.type,key:ie,ref:H.ref,props:H.props,_owner:H._owner}}function L(H){return typeof H=="object"&&H!==null&&H.$$typeof===t}function j(H){var ie={"=":"=0",":":"=2"};return"$"+H.replace(/[=:]/g,function(U){return ie[U]})}var F=/\/+/g;function z(H,ie){return typeof H=="object"&&H!==null&&H.key!=null?j(""+H.key):ie.toString(36)}function $(H,ie,U,ke,ge){var Te=typeof H;(Te==="undefined"||Te==="boolean")&&(H=null);var ye=!1;if(H===null)ye=!0;else switch(Te){case"string":case"number":ye=!0;break;case"object":switch(H.$$typeof){case t:case e:ye=!0}}if(ye)return ye=H,ge=ge(ye),H=ke===""?"."+z(ye,0):ke,C(ge)?(U="",H!=null&&(U=H.replace(F,"$&/")+"/"),$(ge,ie,U,"",function($e){return $e})):ge!=null&&(L(ge)&&(ge=B(ge,U+(!ge.key||ye&&ye.key===ge.key?"":(""+ge.key).replace(F,"$&/")+"/")+H)),ie.push(ge)),1;if(ye=0,ke=ke===""?".":ke+":",C(H))for(var Se=0;Se<H.length;Se++){Te=H[Se];var Re=ke+z(Te,Se);ye+=$(Te,ie,U,Re,ge)}else if(Re=p(H),typeof Re=="function")for(H=Re.call(H),Se=0;!(Te=H.next()).done;)Te=Te.value,Re=ke+z(Te,Se++),ye+=$(Te,ie,U,Re,ge);else if(Te==="object")throw ie=String(H),Error("Objects are not valid as a React child (found: "+(ie==="[object Object]"?"object with keys {"+Object.keys(H).join(", ")+"}":ie)+"). If you meant to render a collection of children, use an array instead.");return ye}function V(H,ie,U){if(H==null)return H;var ke=[],ge=0;return $(H,ke,"","",function(Te){return ie.call(U,Te,ge++)}),ke}function Y(H){if(H._status===-1){var ie=H._result;ie=ie(),ie.then(function(U){(H._status===0||H._status===-1)&&(H._status=1,H._result=U)},function(U){(H._status===0||H._status===-1)&&(H._status=2,H._result=U)}),H._status===-1&&(H._status=0,H._result=ie)}if(H._status===1)return H._result.default;throw H._result}var re={current:null},q={transition:null},X={ReactCurrentDispatcher:re,ReactCurrentBatchConfig:q,ReactCurrentOwner:E};function N(){throw Error("act(...) is not supported in production builds of React.")}return zt.Children={map:V,forEach:function(H,ie,U){V(H,function(){ie.apply(this,arguments)},U)},count:function(H){var ie=0;return V(H,function(){ie++}),ie},toArray:function(H){return V(H,function(ie){return ie})||[]},only:function(H){if(!L(H))throw Error("React.Children.only expected to receive a single React element child.");return H}},zt.Component=x,zt.Fragment=n,zt.Profiler=i,zt.PureComponent=w,zt.StrictMode=r,zt.Suspense=l,zt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=X,zt.act=N,zt.cloneElement=function(H,ie,U){if(H==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+H+".");var ke=y({},H.props),ge=H.key,Te=H.ref,ye=H._owner;if(ie!=null){if(ie.ref!==void 0&&(Te=ie.ref,ye=E.current),ie.key!==void 0&&(ge=""+ie.key),H.type&&H.type.defaultProps)var Se=H.type.defaultProps;for(Re in ie)A.call(ie,Re)&&!O.hasOwnProperty(Re)&&(ke[Re]=ie[Re]===void 0&&Se!==void 0?Se[Re]:ie[Re])}var Re=arguments.length-2;if(Re===1)ke.children=U;else if(1<Re){Se=Array(Re);for(var $e=0;$e<Re;$e++)Se[$e]=arguments[$e+2];ke.children=Se}return{$$typeof:t,type:H.type,key:ge,ref:Te,props:ke,_owner:ye}},zt.createContext=function(H){return H={$$typeof:s,_currentValue:H,_currentValue2:H,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},H.Provider={$$typeof:o,_context:H},H.Consumer=H},zt.createElement=D,zt.createFactory=function(H){var ie=D.bind(null,H);return ie.type=H,ie},zt.createRef=function(){return{current:null}},zt.forwardRef=function(H){return{$$typeof:a,render:H}},zt.isValidElement=L,zt.lazy=function(H){return{$$typeof:d,_payload:{_status:-1,_result:H},_init:Y}},zt.memo=function(H,ie){return{$$typeof:c,type:H,compare:ie===void 0?null:ie}},zt.startTransition=function(H){var ie=q.transition;q.transition={};try{H()}finally{q.transition=ie}},zt.unstable_act=N,zt.useCallback=function(H,ie){return re.current.useCallback(H,ie)},zt.useContext=function(H){return re.current.useContext(H)},zt.useDebugValue=function(){},zt.useDeferredValue=function(H){return re.current.useDeferredValue(H)},zt.useEffect=function(H,ie){return re.current.useEffect(H,ie)},zt.useId=function(){return re.current.useId()},zt.useImperativeHandle=function(H,ie,U){return re.current.useImperativeHandle(H,ie,U)},zt.useInsertionEffect=function(H,ie){return re.current.useInsertionEffect(H,ie)},zt.useLayoutEffect=function(H,ie){return re.current.useLayoutEffect(H,ie)},zt.useMemo=function(H,ie){return re.current.useMemo(H,ie)},zt.useReducer=function(H,ie,U){return re.current.useReducer(H,ie,U)},zt.useRef=function(H){return re.current.useRef(H)},zt.useState=function(H){return re.current.useState(H)},zt.useSyncExternalStore=function(H,ie,U){return re.current.useSyncExternalStore(H,ie,U)},zt.useTransition=function(){return re.current.useTransition()},zt.version="18.3.1",zt}var M$;function s2(){return M$||(M$=1,xI.exports=xoe()),xI.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O$;function Soe(){if(O$)return Og;O$=1;var t=s2(),e=Symbol.for("react.element"),n=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function s(a,l,c){var d,u={},p=null,f=null;c!==void 0&&(p=""+c),l.key!==void 0&&(p=""+l.key),l.ref!==void 0&&(f=l.ref);for(d in l)r.call(l,d)&&!o.hasOwnProperty(d)&&(u[d]=l[d]);if(a&&a.defaultProps)for(d in l=a.defaultProps,l)u[d]===void 0&&(u[d]=l[d]);return{$$typeof:e,type:a,key:p,ref:f,props:u,_owner:i.current}}return Og.Fragment=n,Og.jsx=s,Og.jsxs=s,Og}var D$;function boe(){return D$||(D$=1,vI.exports=Soe()),vI.exports}var g=boe(),I=s2();const rt=ua(I),ZB=voe({__proto__:null,default:rt},[I]);var Tx={},SI={exports:{}},Lo={},bI={exports:{}},wI={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j$;function woe(){return j$||(j$=1,(function(t){function e(q,X){var N=q.length;q.push(X);e:for(;0<N;){var H=N-1>>>1,ie=q[H];if(0<i(ie,X))q[H]=X,q[N]=ie,N=H;else break e}}function n(q){return q.length===0?null:q[0]}function r(q){if(q.length===0)return null;var X=q[0],N=q.pop();if(N!==X){q[0]=N;e:for(var H=0,ie=q.length,U=ie>>>1;H<U;){var ke=2*(H+1)-1,ge=q[ke],Te=ke+1,ye=q[Te];if(0>i(ge,N))Te<ie&&0>i(ye,ge)?(q[H]=ye,q[Te]=N,H=Te):(q[H]=ge,q[ke]=N,H=ke);else if(Te<ie&&0>i(ye,N))q[H]=ye,q[Te]=N,H=Te;else break e}}return X}function i(q,X){var N=q.sortIndex-X.sortIndex;return N!==0?N:q.id-X.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,a=s.now();t.unstable_now=function(){return s.now()-a}}var l=[],c=[],d=1,u=null,p=3,f=!1,y=!1,v=!1,x=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(q){for(var X=n(c);X!==null;){if(X.callback===null)r(c);else if(X.startTime<=q)r(c),X.sortIndex=X.expirationTime,e(l,X);else break;X=n(c)}}function C(q){if(v=!1,_(q),!y)if(n(l)!==null)y=!0,Y(A);else{var X=n(c);X!==null&&re(C,X.startTime-q)}}function A(q,X){y=!1,v&&(v=!1,b(D),D=-1),f=!0;var N=p;try{for(_(X),u=n(l);u!==null&&(!(u.expirationTime>X)||q&&!j());){var H=u.callback;if(typeof H=="function"){u.callback=null,p=u.priorityLevel;var ie=H(u.expirationTime<=X);X=t.unstable_now(),typeof ie=="function"?u.callback=ie:u===n(l)&&r(l),_(X)}else r(l);u=n(l)}if(u!==null)var U=!0;else{var ke=n(c);ke!==null&&re(C,ke.startTime-X),U=!1}return U}finally{u=null,p=N,f=!1}}var E=!1,O=null,D=-1,B=5,L=-1;function j(){return!(t.unstable_now()-L<B)}function F(){if(O!==null){var q=t.unstable_now();L=q;var X=!0;try{X=O(!0,q)}finally{X?z():(E=!1,O=null)}}else E=!1}var z;if(typeof w=="function")z=function(){w(F)};else if(typeof MessageChannel<"u"){var $=new MessageChannel,V=$.port2;$.port1.onmessage=F,z=function(){V.postMessage(null)}}else z=function(){x(F,0)};function Y(q){O=q,E||(E=!0,z())}function re(q,X){D=x(function(){q(t.unstable_now())},X)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(q){q.callback=null},t.unstable_continueExecution=function(){y||f||(y=!0,Y(A))},t.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<q?Math.floor(1e3/q):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(q){switch(p){case 1:case 2:case 3:var X=3;break;default:X=p}var N=p;p=X;try{return q()}finally{p=N}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(q,X){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var N=p;p=q;try{return X()}finally{p=N}},t.unstable_scheduleCallback=function(q,X,N){var H=t.unstable_now();switch(typeof N=="object"&&N!==null?(N=N.delay,N=typeof N=="number"&&0<N?H+N:H):N=H,q){case 1:var ie=-1;break;case 2:ie=250;break;case 5:ie=1073741823;break;case 4:ie=1e4;break;default:ie=5e3}return ie=N+ie,q={id:d++,callback:X,priorityLevel:q,startTime:N,expirationTime:ie,sortIndex:-1},N>H?(q.sortIndex=N,e(c,q),n(l)===null&&q===n(c)&&(v?(b(D),D=-1):v=!0,re(C,N-H))):(q.sortIndex=ie,e(l,q),y||f||(y=!0,Y(A))),q},t.unstable_shouldYield=j,t.unstable_wrapCallback=function(q){var X=p;return function(){var N=p;p=X;try{return q.apply(this,arguments)}finally{p=N}}}})(wI)),wI}var R$;function koe(){return R$||(R$=1,bI.exports=woe()),bI.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $$;function Ioe(){if($$)return Lo;$$=1;var t=s2(),e=koe();function n(h){for(var m="https://reactjs.org/docs/error-decoder.html?invariant="+h,S=1;S<arguments.length;S++)m+="&args[]="+encodeURIComponent(arguments[S]);return"Minified React error #"+h+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,i={};function o(h,m){s(h,m),s(h+"Capture",m)}function s(h,m){for(i[h]=m,h=0;h<m.length;h++)r.add(m[h])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d={},u={};function p(h){return l.call(u,h)?!0:l.call(d,h)?!1:c.test(h)?u[h]=!0:(d[h]=!0,!1)}function f(h,m,S,k){if(S!==null&&S.type===0)return!1;switch(typeof m){case"function":case"symbol":return!0;case"boolean":return k?!1:S!==null?!S.acceptsBooleans:(h=h.toLowerCase().slice(0,5),h!=="data-"&&h!=="aria-");default:return!1}}function y(h,m,S,k){if(m===null||typeof m>"u"||f(h,m,S,k))return!0;if(k)return!1;if(S!==null)switch(S.type){case 3:return!m;case 4:return m===!1;case 5:return isNaN(m);case 6:return isNaN(m)||1>m}return!1}function v(h,m,S,k,P,M,R){this.acceptsBooleans=m===2||m===3||m===4,this.attributeName=k,this.attributeNamespace=P,this.mustUseProperty=S,this.propertyName=h,this.type=m,this.sanitizeURL=M,this.removeEmptyString=R}var x={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(h){x[h]=new v(h,0,!1,h,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(h){var m=h[0];x[m]=new v(m,1,!1,h[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(h){x[h]=new v(h,2,!1,h.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(h){x[h]=new v(h,2,!1,h,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(h){x[h]=new v(h,3,!1,h.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(h){x[h]=new v(h,3,!0,h,null,!1,!1)}),["capture","download"].forEach(function(h){x[h]=new v(h,4,!1,h,null,!1,!1)}),["cols","rows","size","span"].forEach(function(h){x[h]=new v(h,6,!1,h,null,!1,!1)}),["rowSpan","start"].forEach(function(h){x[h]=new v(h,5,!1,h.toLowerCase(),null,!1,!1)});var b=/[\-:]([a-z])/g;function w(h){return h[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(h){var m=h.replace(b,w);x[m]=new v(m,1,!1,h,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(h){var m=h.replace(b,w);x[m]=new v(m,1,!1,h,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(h){var m=h.replace(b,w);x[m]=new v(m,1,!1,h,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(h){x[h]=new v(h,1,!1,h.toLowerCase(),null,!1,!1)}),x.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(h){x[h]=new v(h,1,!1,h.toLowerCase(),null,!0,!0)});function _(h,m,S,k){var P=x.hasOwnProperty(m)?x[m]:null;(P!==null?P.type!==0:k||!(2<m.length)||m[0]!=="o"&&m[0]!=="O"||m[1]!=="n"&&m[1]!=="N")&&(y(m,S,P,k)&&(S=null),k||P===null?p(m)&&(S===null?h.removeAttribute(m):h.setAttribute(m,""+S)):P.mustUseProperty?h[P.propertyName]=S===null?P.type===3?!1:"":S:(m=P.attributeName,k=P.attributeNamespace,S===null?h.removeAttribute(m):(P=P.type,S=P===3||P===4&&S===!0?"":""+S,k?h.setAttributeNS(k,m,S):h.setAttribute(m,S))))}var C=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,A=Symbol.for("react.element"),E=Symbol.for("react.portal"),O=Symbol.for("react.fragment"),D=Symbol.for("react.strict_mode"),B=Symbol.for("react.profiler"),L=Symbol.for("react.provider"),j=Symbol.for("react.context"),F=Symbol.for("react.forward_ref"),z=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),V=Symbol.for("react.memo"),Y=Symbol.for("react.lazy"),re=Symbol.for("react.offscreen"),q=Symbol.iterator;function X(h){return h===null||typeof h!="object"?null:(h=q&&h[q]||h["@@iterator"],typeof h=="function"?h:null)}var N=Object.assign,H;function ie(h){if(H===void 0)try{throw Error()}catch(S){var m=S.stack.trim().match(/\n( *(at )?)/);H=m&&m[1]||""}return`
`+H+h}var U=!1;function ke(h,m){if(!h||U)return"";U=!0;var S=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(m)if(m=function(){throw Error()},Object.defineProperty(m.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(m,[])}catch(ue){var k=ue}Reflect.construct(h,[],m)}else{try{m.call()}catch(ue){k=ue}h.call(m.prototype)}else{try{throw Error()}catch(ue){k=ue}h()}}catch(ue){if(ue&&k&&typeof ue.stack=="string"){for(var P=ue.stack.split(`
`),M=k.stack.split(`
`),R=P.length-1,K=M.length-1;1<=R&&0<=K&&P[R]!==M[K];)K--;for(;1<=R&&0<=K;R--,K--)if(P[R]!==M[K]){if(R!==1||K!==1)do if(R--,K--,0>K||P[R]!==M[K]){var Z=`
`+P[R].replace(" at new "," at ");return h.displayName&&Z.includes("<anonymous>")&&(Z=Z.replace("<anonymous>",h.displayName)),Z}while(1<=R&&0<=K);break}}}finally{U=!1,Error.prepareStackTrace=S}return(h=h?h.displayName||h.name:"")?ie(h):""}function ge(h){switch(h.tag){case 5:return ie(h.type);case 16:return ie("Lazy");case 13:return ie("Suspense");case 19:return ie("SuspenseList");case 0:case 2:case 15:return h=ke(h.type,!1),h;case 11:return h=ke(h.type.render,!1),h;case 1:return h=ke(h.type,!0),h;default:return""}}function Te(h){if(h==null)return null;if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case O:return"Fragment";case E:return"Portal";case B:return"Profiler";case D:return"StrictMode";case z:return"Suspense";case $:return"SuspenseList"}if(typeof h=="object")switch(h.$$typeof){case j:return(h.displayName||"Context")+".Consumer";case L:return(h._context.displayName||"Context")+".Provider";case F:var m=h.render;return h=h.displayName,h||(h=m.displayName||m.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case V:return m=h.displayName||null,m!==null?m:Te(h.type)||"Memo";case Y:m=h._payload,h=h._init;try{return Te(h(m))}catch{}}return null}function ye(h){var m=h.type;switch(h.tag){case 24:return"Cache";case 9:return(m.displayName||"Context")+".Consumer";case 10:return(m._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return h=m.render,h=h.displayName||h.name||"",m.displayName||(h!==""?"ForwardRef("+h+")":"ForwardRef");case 7:return"Fragment";case 5:return m;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Te(m);case 8:return m===D?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof m=="function")return m.displayName||m.name||null;if(typeof m=="string")return m}return null}function Se(h){switch(typeof h){case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function Re(h){var m=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function $e(h){var m=Re(h)?"checked":"value",S=Object.getOwnPropertyDescriptor(h.constructor.prototype,m),k=""+h[m];if(!h.hasOwnProperty(m)&&typeof S<"u"&&typeof S.get=="function"&&typeof S.set=="function"){var P=S.get,M=S.set;return Object.defineProperty(h,m,{configurable:!0,get:function(){return P.call(this)},set:function(R){k=""+R,M.call(this,R)}}),Object.defineProperty(h,m,{enumerable:S.enumerable}),{getValue:function(){return k},setValue:function(R){k=""+R},stopTracking:function(){h._valueTracker=null,delete h[m]}}}}function Ft(h){h._valueTracker||(h._valueTracker=$e(h))}function rn(h){if(!h)return!1;var m=h._valueTracker;if(!m)return!0;var S=m.getValue(),k="";return h&&(k=Re(h)?h.checked?"true":"false":h.value),h=k,h!==S?(m.setValue(h),!0):!1}function Dt(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}function Kt(h,m){var S=m.checked;return N({},m,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:S??h._wrapperState.initialChecked})}function Gt(h,m){var S=m.defaultValue==null?"":m.defaultValue,k=m.checked!=null?m.checked:m.defaultChecked;S=Se(m.value!=null?m.value:S),h._wrapperState={initialChecked:k,initialValue:S,controlled:m.type==="checkbox"||m.type==="radio"?m.checked!=null:m.value!=null}}function Gn(h,m){m=m.checked,m!=null&&_(h,"checked",m,!1)}function Ln(h,m){Gn(h,m);var S=Se(m.value),k=m.type;if(S!=null)k==="number"?(S===0&&h.value===""||h.value!=S)&&(h.value=""+S):h.value!==""+S&&(h.value=""+S);else if(k==="submit"||k==="reset"){h.removeAttribute("value");return}m.hasOwnProperty("value")?Tr(h,m.type,S):m.hasOwnProperty("defaultValue")&&Tr(h,m.type,Se(m.defaultValue)),m.checked==null&&m.defaultChecked!=null&&(h.defaultChecked=!!m.defaultChecked)}function Pr(h,m,S){if(m.hasOwnProperty("value")||m.hasOwnProperty("defaultValue")){var k=m.type;if(!(k!=="submit"&&k!=="reset"||m.value!==void 0&&m.value!==null))return;m=""+h._wrapperState.initialValue,S||m===h.value||(h.value=m),h.defaultValue=m}S=h.name,S!==""&&(h.name=""),h.defaultChecked=!!h._wrapperState.initialChecked,S!==""&&(h.name=S)}function Tr(h,m,S){(m!=="number"||Dt(h.ownerDocument)!==h)&&(S==null?h.defaultValue=""+h._wrapperState.initialValue:h.defaultValue!==""+S&&(h.defaultValue=""+S))}var fr=Array.isArray;function gr(h,m,S,k){if(h=h.options,m){m={};for(var P=0;P<S.length;P++)m["$"+S[P]]=!0;for(S=0;S<h.length;S++)P=m.hasOwnProperty("$"+h[S].value),h[S].selected!==P&&(h[S].selected=P),P&&k&&(h[S].defaultSelected=!0)}else{for(S=""+Se(S),m=null,P=0;P<h.length;P++){if(h[P].value===S){h[P].selected=!0,k&&(h[P].defaultSelected=!0);return}m!==null||h[P].disabled||(m=h[P])}m!==null&&(m.selected=!0)}}function ts(h,m){if(m.dangerouslySetInnerHTML!=null)throw Error(n(91));return N({},m,{value:void 0,defaultValue:void 0,children:""+h._wrapperState.initialValue})}function ya(h,m){var S=m.value;if(S==null){if(S=m.children,m=m.defaultValue,S!=null){if(m!=null)throw Error(n(92));if(fr(S)){if(1<S.length)throw Error(n(93));S=S[0]}m=S}m==null&&(m=""),S=m}h._wrapperState={initialValue:Se(S)}}function va(h,m){var S=Se(m.value),k=Se(m.defaultValue);S!=null&&(S=""+S,S!==h.value&&(h.value=S),m.defaultValue==null&&h.defaultValue!==S&&(h.defaultValue=S)),k!=null&&(h.defaultValue=""+k)}function Ur(h){var m=h.textContent;m===h._wrapperState.initialValue&&m!==""&&m!==null&&(h.value=m)}function de(h){switch(h){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Me(h,m){return h==null||h==="http://www.w3.org/1999/xhtml"?de(m):h==="http://www.w3.org/2000/svg"&&m==="foreignObject"?"http://www.w3.org/1999/xhtml":h}var nt,vt=(function(h){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(m,S,k,P){MSApp.execUnsafeLocalFunction(function(){return h(m,S,k,P)})}:h})(function(h,m){if(h.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in h)h.innerHTML=m;else{for(nt=nt||document.createElement("div"),nt.innerHTML="<svg>"+m.valueOf().toString()+"</svg>",m=nt.firstChild;h.firstChild;)h.removeChild(h.firstChild);for(;m.firstChild;)h.appendChild(m.firstChild)}});function oe(h,m){if(m){var S=h.firstChild;if(S&&S===h.lastChild&&S.nodeType===3){S.nodeValue=m;return}}h.textContent=m}var Ie={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Qe=["Webkit","ms","Moz","O"];Object.keys(Ie).forEach(function(h){Qe.forEach(function(m){m=m+h.charAt(0).toUpperCase()+h.substring(1),Ie[m]=Ie[h]})});function Pt(h,m,S){return m==null||typeof m=="boolean"||m===""?"":S||typeof m!="number"||m===0||Ie.hasOwnProperty(h)&&Ie[h]?(""+m).trim():m+"px"}function zn(h,m){h=h.style;for(var S in m)if(m.hasOwnProperty(S)){var k=S.indexOf("--")===0,P=Pt(S,m[S],k);S==="float"&&(S="cssFloat"),k?h.setProperty(S,P):h[S]=P}}var Fn=N({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function mn(h,m){if(m){if(Fn[h]&&(m.children!=null||m.dangerouslySetInnerHTML!=null))throw Error(n(137,h));if(m.dangerouslySetInnerHTML!=null){if(m.children!=null)throw Error(n(60));if(typeof m.dangerouslySetInnerHTML!="object"||!("__html"in m.dangerouslySetInnerHTML))throw Error(n(61))}if(m.style!=null&&typeof m.style!="object")throw Error(n(62))}}function Bn(h,m){if(h.indexOf("-")===-1)return typeof m.is=="string";switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ln=null;function Pi(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var ro=null,Ti=null,ns=null;function Ac(h){if(h=yg(h)){if(typeof ro!="function")throw Error(n(280));var m=h.stateNode;m&&(m=Hv(m),ro(h.stateNode,h.type,m))}}function xa(h){Ti?ns?ns.push(h):ns=[h]:Ti=h}function Za(){if(Ti){var h=Ti,m=ns;if(ns=Ti=null,Ac(h),m)for(h=0;h<m.length;h++)Ac(m[h])}}function To(h,m){return h(m)}function Mc(){}var Sa=!1;function Rh(h,m,S){if(Sa)return h(m,S);Sa=!0;try{return To(h,m,S)}finally{Sa=!1,(Ti!==null||ns!==null)&&(Mc(),Za())}}function Bl(h,m){var S=h.stateNode;if(S===null)return null;var k=Hv(S);if(k===null)return null;S=k[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(k=!k.disabled)||(h=h.type,k=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!k;break e;default:h=!1}if(h)return null;if(S&&typeof S!="function")throw Error(n(231,m,typeof S));return S}var sd=!1;if(a)try{var ai={};Object.defineProperty(ai,"passive",{get:function(){sd=!0}}),window.addEventListener("test",ai,ai),window.removeEventListener("test",ai,ai)}catch{sd=!1}function Xf(h,m,S,k,P,M,R,K,Z){var ue=Array.prototype.slice.call(arguments,3);try{m.apply(S,ue)}catch(_e){this.onError(_e)}}var Ja=!1,Qa=null,Eo=!1,ad=null,ba={onError:function(h){Ja=!0,Qa=h}};function Zf(h,m,S,k,P,M,R,K,Z){Ja=!1,Qa=null,Xf.apply(ba,arguments)}function Jf(h,m,S,k,P,M,R,K,Z){if(Zf.apply(this,arguments),Ja){if(Ja){var ue=Qa;Ja=!1,Qa=null}else throw Error(n(198));Eo||(Eo=!0,ad=ue)}}function wa(h){var m=h,S=h;if(h.alternate)for(;m.return;)m=m.return;else{h=m;do m=h,(m.flags&4098)!==0&&(S=m.return),h=m.return;while(h)}return m.tag===3?S:null}function Ao(h){if(h.tag===13){var m=h.memoizedState;if(m===null&&(h=h.alternate,h!==null&&(m=h.memoizedState)),m!==null)return m.dehydrated}return null}function $h(h){if(wa(h)!==h)throw Error(n(188))}function Oc(h){var m=h.alternate;if(!m){if(m=wa(h),m===null)throw Error(n(188));return m!==h?null:h}for(var S=h,k=m;;){var P=S.return;if(P===null)break;var M=P.alternate;if(M===null){if(k=P.return,k!==null){S=k;continue}break}if(P.child===M.child){for(M=P.child;M;){if(M===S)return $h(P),h;if(M===k)return $h(P),m;M=M.sibling}throw Error(n(188))}if(S.return!==k.return)S=P,k=M;else{for(var R=!1,K=P.child;K;){if(K===S){R=!0,S=P,k=M;break}if(K===k){R=!0,k=P,S=M;break}K=K.sibling}if(!R){for(K=M.child;K;){if(K===S){R=!0,S=M,k=P;break}if(K===k){R=!0,k=M,S=P;break}K=K.sibling}if(!R)throw Error(n(189))}}if(S.alternate!==k)throw Error(n(190))}if(S.tag!==3)throw Error(n(188));return S.stateNode.current===S?h:m}function Nh(h){return h=Oc(h),h!==null?Lh(h):null}function Lh(h){if(h.tag===5||h.tag===6)return h;for(h=h.child;h!==null;){var m=Lh(h);if(m!==null)return m;h=h.sibling}return null}var rs=e.unstable_scheduleCallback,Ns=e.unstable_cancelCallback,Qf=e.unstable_shouldYield,eg=e.unstable_requestPaint,En=e.unstable_now,tg=e.unstable_getCurrentPriorityLevel,ld=e.unstable_ImmediatePriority,Ls=e.unstable_UserBlockingPriority,Dc=e.unstable_NormalPriority,zh=e.unstable_LowPriority,is=e.unstable_IdlePriority,jc=null,Mo=null;function ng(h){if(Mo&&typeof Mo.onCommitFiberRoot=="function")try{Mo.onCommitFiberRoot(jc,h,void 0,(h.current.flags&128)===128)}catch{}}var Ei=Math.clz32?Math.clz32:ka,rg=Math.log,ig=Math.LN2;function ka(h){return h>>>=0,h===0?32:31-(rg(h)/ig|0)|0}var ss=64,Rr=4194304;function el(h){switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return h&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return h}}function Ul(h,m){var S=h.pendingLanes;if(S===0)return 0;var k=0,P=h.suspendedLanes,M=h.pingedLanes,R=S&268435455;if(R!==0){var K=R&~P;K!==0?k=el(K):(M&=R,M!==0&&(k=el(M)))}else R=S&~P,R!==0?k=el(R):M!==0&&(k=el(M));if(k===0)return 0;if(m!==0&&m!==k&&(m&P)===0&&(P=k&-k,M=m&-m,P>=M||P===16&&(M&4194240)!==0))return m;if((k&4)!==0&&(k|=S&16),m=h.entangledLanes,m!==0)for(h=h.entanglements,m&=k;0<m;)S=31-Ei(m),P=1<<S,k|=h[S],m&=~P;return k}function og(h,m){switch(h){case 1:case 2:case 4:return m+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sg(h,m){for(var S=h.suspendedLanes,k=h.pingedLanes,P=h.expirationTimes,M=h.pendingLanes;0<M;){var R=31-Ei(M),K=1<<R,Z=P[R];Z===-1?((K&S)===0||(K&k)!==0)&&(P[R]=og(K,m)):Z<=m&&(h.expiredLanes|=K),M&=~K}}function as(h){return h=h.pendingLanes&-1073741825,h!==0?h:h&1073741824?1073741824:0}function cd(){var h=ss;return ss<<=1,(ss&4194240)===0&&(ss=64),h}function Rc(h){for(var m=[],S=0;31>S;S++)m.push(h);return m}function Ia(h,m,S){h.pendingLanes|=m,m!==536870912&&(h.suspendedLanes=0,h.pingedLanes=0),h=h.eventTimes,m=31-Ei(m),h[m]=S}function Fh(h,m){var S=h.pendingLanes&~m;h.pendingLanes=m,h.suspendedLanes=0,h.pingedLanes=0,h.expiredLanes&=m,h.mutableReadLanes&=m,h.entangledLanes&=m,m=h.entanglements;var k=h.eventTimes;for(h=h.expirationTimes;0<S;){var P=31-Ei(S),M=1<<P;m[P]=0,k[P]=-1,h[P]=-1,S&=~M}}function $c(h,m){var S=h.entangledLanes|=m;for(h=h.entanglements;S;){var k=31-Ei(S),P=1<<k;P&m|h[k]&m&&(h[k]|=m),S&=~P}}var Ut=0;function zs(h){return h&=-h,1<h?4<h?(h&268435455)!==0?16:536870912:4:1}var ud,Hl,io,Bh,dd,G=!1,ae=[],Ce=null,ze=null,Yt=null,ft=new Map,wn=new Map,An=[],rr="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function $r(h,m){switch(h){case"focusin":case"focusout":Ce=null;break;case"dragenter":case"dragleave":ze=null;break;case"mouseover":case"mouseout":Yt=null;break;case"pointerover":case"pointerout":ft.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":wn.delete(m.pointerId)}}function mr(h,m,S,k,P,M){return h===null||h.nativeEvent!==M?(h={blockedOn:m,domEventName:S,eventSystemFlags:k,nativeEvent:M,targetContainers:[P]},m!==null&&(m=yg(m),m!==null&&Hl(m)),h):(h.eventSystemFlags|=k,m=h.targetContainers,P!==null&&m.indexOf(P)===-1&&m.push(P),h)}function Ai(h,m,S,k,P){switch(m){case"focusin":return Ce=mr(Ce,h,m,S,k,P),!0;case"dragenter":return ze=mr(ze,h,m,S,k,P),!0;case"mouseover":return Yt=mr(Yt,h,m,S,k,P),!0;case"pointerover":var M=P.pointerId;return ft.set(M,mr(ft.get(M)||null,h,m,S,k,P)),!0;case"gotpointercapture":return M=P.pointerId,wn.set(M,mr(wn.get(M)||null,h,m,S,k,P)),!0}return!1}function yr(h){var m=hd(h.target);if(m!==null){var S=wa(m);if(S!==null){if(m=S.tag,m===13){if(m=Ao(S),m!==null){h.blockedOn=m,dd(h.priority,function(){io(S)});return}}else if(m===3&&S.stateNode.current.memoizedState.isDehydrated){h.blockedOn=S.tag===3?S.stateNode.containerInfo:null;return}}}h.blockedOn=null}function Yn(h){if(h.blockedOn!==null)return!1;for(var m=h.targetContainers;0<m.length;){var S=kn(h.domEventName,h.eventSystemFlags,m[0],h.nativeEvent);if(S===null){S=h.nativeEvent;var k=new S.constructor(S.type,S);ln=k,S.target.dispatchEvent(k),ln=null}else return m=yg(S),m!==null&&Hl(m),h.blockedOn=S,!1;m.shift()}return!0}function Hr(h,m,S){Yn(h)&&S.delete(m)}function Fs(){G=!1,Ce!==null&&Yn(Ce)&&(Ce=null),ze!==null&&Yn(ze)&&(ze=null),Yt!==null&&Yn(Yt)&&(Yt=null),ft.forEach(Hr),wn.forEach(Hr)}function li(h,m){h.blockedOn===m&&(h.blockedOn=null,G||(G=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Fs)))}function oo(h){function m(P){return li(P,h)}if(0<ae.length){li(ae[0],h);for(var S=1;S<ae.length;S++){var k=ae[S];k.blockedOn===h&&(k.blockedOn=null)}}for(Ce!==null&&li(Ce,h),ze!==null&&li(ze,h),Yt!==null&&li(Yt,h),ft.forEach(m),wn.forEach(m),S=0;S<An.length;S++)k=An[S],k.blockedOn===h&&(k.blockedOn=null);for(;0<An.length&&(S=An[0],S.blockedOn===null);)yr(S),S.blockedOn===null&&An.shift()}var W=C.ReactCurrentBatchConfig,te=!0;function ve(h,m,S,k){var P=Ut,M=W.transition;W.transition=null;try{Ut=1,cn(h,m,S,k)}finally{Ut=P,W.transition=M}}function Ke(h,m,S,k){var P=Ut,M=W.transition;W.transition=null;try{Ut=4,cn(h,m,S,k)}finally{Ut=P,W.transition=M}}function cn(h,m,S,k){if(te){var P=kn(h,m,S,k);if(P===null)lk(h,m,k,xt,S),$r(h,k);else if(Ai(P,h,m,S,k))k.stopPropagation();else if($r(h,k),m&4&&-1<rr.indexOf(h)){for(;P!==null;){var M=yg(P);if(M!==null&&ud(M),M=kn(h,m,S,k),M===null&&lk(h,m,k,xt,S),M===P)break;P=M}P!==null&&k.stopPropagation()}else lk(h,m,k,null,S)}}var xt=null;function kn(h,m,S,k){if(xt=null,h=Pi(k),h=hd(h),h!==null)if(m=wa(h),m===null)h=null;else if(S=m.tag,S===13){if(h=Ao(m),h!==null)return h;h=null}else if(S===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;h=null}else m!==h&&(h=null);return xt=h,null}function vr(h){switch(h){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(tg()){case ld:return 1;case Ls:return 4;case Dc:case zh:return 16;case is:return 536870912;default:return 16}default:return 16}}var In=null,yn=null,Wr=null;function Oo(){if(Wr)return Wr;var h,m=yn,S=m.length,k,P="value"in In?In.value:In.textContent,M=P.length;for(h=0;h<S&&m[h]===P[h];h++);var R=S-h;for(k=1;k<=R&&m[S-k]===P[M-k];k++);return Wr=P.slice(h,1<k?1-k:void 0)}function xr(h){var m=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&m===13&&(h=13)):h=m,h===10&&(h=13),32<=h||h===13?h:0}function ci(){return!0}function so(){return!1}function ir(h){function m(S,k,P,M,R){this._reactName=S,this._targetInst=P,this.type=k,this.nativeEvent=M,this.target=R,this.currentTarget=null;for(var K in h)h.hasOwnProperty(K)&&(S=h[K],this[K]=S?S(M):M[K]);return this.isDefaultPrevented=(M.defaultPrevented!=null?M.defaultPrevented:M.returnValue===!1)?ci:so,this.isPropagationStopped=so,this}return N(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var S=this.nativeEvent;S&&(S.preventDefault?S.preventDefault():typeof S.returnValue!="unknown"&&(S.returnValue=!1),this.isDefaultPrevented=ci)},stopPropagation:function(){var S=this.nativeEvent;S&&(S.stopPropagation?S.stopPropagation():typeof S.cancelBubble!="unknown"&&(S.cancelBubble=!0),this.isPropagationStopped=ci)},persist:function(){},isPersistent:ci}),m}var Mi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_a=ir(Mi),Nc=N({},Mi,{view:0,detail:0}),Uh=ir(Nc),Lc,Y1,ag,Rv=N({},Nc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Z1,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==ag&&(ag&&h.type==="mousemove"?(Lc=h.screenX-ag.screenX,Y1=h.screenY-ag.screenY):Y1=Lc=0,ag=h),Lc)},movementY:function(h){return"movementY"in h?h.movementY:Y1}}),xj=ir(Rv),Kre=N({},Rv,{dataTransfer:0}),qre=ir(Kre),Gre=N({},Nc,{relatedTarget:0}),X1=ir(Gre),Yre=N({},Mi,{animationName:0,elapsedTime:0,pseudoElement:0}),Xre=ir(Yre),Zre=N({},Mi,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),Jre=ir(Zre),Qre=N({},Mi,{data:0}),Sj=ir(Qre),eie={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},tie={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},nie={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function rie(h){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(h):(h=nie[h])?!!m[h]:!1}function Z1(){return rie}var iie=N({},Nc,{key:function(h){if(h.key){var m=eie[h.key]||h.key;if(m!=="Unidentified")return m}return h.type==="keypress"?(h=xr(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?tie[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Z1,charCode:function(h){return h.type==="keypress"?xr(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?xr(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),oie=ir(iie),sie=N({},Rv,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),bj=ir(sie),aie=N({},Nc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Z1}),lie=ir(aie),cie=N({},Mi,{propertyName:0,elapsedTime:0,pseudoElement:0}),uie=ir(cie),die=N({},Rv,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),hie=ir(die),pie=[9,13,27,32],J1=a&&"CompositionEvent"in window,lg=null;a&&"documentMode"in document&&(lg=document.documentMode);var fie=a&&"TextEvent"in window&&!lg,wj=a&&(!J1||lg&&8<lg&&11>=lg),kj=" ",Ij=!1;function _j(h,m){switch(h){case"keyup":return pie.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Cj(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var Hh=!1;function gie(h,m){switch(h){case"compositionend":return Cj(m);case"keypress":return m.which!==32?null:(Ij=!0,kj);case"textInput":return h=m.data,h===kj&&Ij?null:h;default:return null}}function mie(h,m){if(Hh)return h==="compositionend"||!J1&&_j(h,m)?(h=Oo(),Wr=yn=In=null,Hh=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return wj&&m.locale!=="ko"?null:m.data;default:return null}}var yie={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Pj(h){var m=h&&h.nodeName&&h.nodeName.toLowerCase();return m==="input"?!!yie[h.type]:m==="textarea"}function Tj(h,m,S,k){xa(k),m=Fv(m,"onChange"),0<m.length&&(S=new _a("onChange","change",null,S,k),h.push({event:S,listeners:m}))}var cg=null,ug=null;function vie(h){Kj(h,0)}function $v(h){var m=Gh(h);if(rn(m))return h}function xie(h,m){if(h==="change")return m}var Ej=!1;if(a){var Q1;if(a){var ek="oninput"in document;if(!ek){var Aj=document.createElement("div");Aj.setAttribute("oninput","return;"),ek=typeof Aj.oninput=="function"}Q1=ek}else Q1=!1;Ej=Q1&&(!document.documentMode||9<document.documentMode)}function Mj(){cg&&(cg.detachEvent("onpropertychange",Oj),ug=cg=null)}function Oj(h){if(h.propertyName==="value"&&$v(ug)){var m=[];Tj(m,ug,h,Pi(h)),Rh(vie,m)}}function Sie(h,m,S){h==="focusin"?(Mj(),cg=m,ug=S,cg.attachEvent("onpropertychange",Oj)):h==="focusout"&&Mj()}function bie(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return $v(ug)}function wie(h,m){if(h==="click")return $v(m)}function kie(h,m){if(h==="input"||h==="change")return $v(m)}function Iie(h,m){return h===m&&(h!==0||1/h===1/m)||h!==h&&m!==m}var Ca=typeof Object.is=="function"?Object.is:Iie;function dg(h,m){if(Ca(h,m))return!0;if(typeof h!="object"||h===null||typeof m!="object"||m===null)return!1;var S=Object.keys(h),k=Object.keys(m);if(S.length!==k.length)return!1;for(k=0;k<S.length;k++){var P=S[k];if(!l.call(m,P)||!Ca(h[P],m[P]))return!1}return!0}function Dj(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function jj(h,m){var S=Dj(h);h=0;for(var k;S;){if(S.nodeType===3){if(k=h+S.textContent.length,h<=m&&k>=m)return{node:S,offset:m-h};h=k}e:{for(;S;){if(S.nextSibling){S=S.nextSibling;break e}S=S.parentNode}S=void 0}S=Dj(S)}}function Rj(h,m){return h&&m?h===m?!0:h&&h.nodeType===3?!1:m&&m.nodeType===3?Rj(h,m.parentNode):"contains"in h?h.contains(m):h.compareDocumentPosition?!!(h.compareDocumentPosition(m)&16):!1:!1}function $j(){for(var h=window,m=Dt();m instanceof h.HTMLIFrameElement;){try{var S=typeof m.contentWindow.location.href=="string"}catch{S=!1}if(S)h=m.contentWindow;else break;m=Dt(h.document)}return m}function tk(h){var m=h&&h.nodeName&&h.nodeName.toLowerCase();return m&&(m==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||m==="textarea"||h.contentEditable==="true")}function _ie(h){var m=$j(),S=h.focusedElem,k=h.selectionRange;if(m!==S&&S&&S.ownerDocument&&Rj(S.ownerDocument.documentElement,S)){if(k!==null&&tk(S)){if(m=k.start,h=k.end,h===void 0&&(h=m),"selectionStart"in S)S.selectionStart=m,S.selectionEnd=Math.min(h,S.value.length);else if(h=(m=S.ownerDocument||document)&&m.defaultView||window,h.getSelection){h=h.getSelection();var P=S.textContent.length,M=Math.min(k.start,P);k=k.end===void 0?M:Math.min(k.end,P),!h.extend&&M>k&&(P=k,k=M,M=P),P=jj(S,M);var R=jj(S,k);P&&R&&(h.rangeCount!==1||h.anchorNode!==P.node||h.anchorOffset!==P.offset||h.focusNode!==R.node||h.focusOffset!==R.offset)&&(m=m.createRange(),m.setStart(P.node,P.offset),h.removeAllRanges(),M>k?(h.addRange(m),h.extend(R.node,R.offset)):(m.setEnd(R.node,R.offset),h.addRange(m)))}}for(m=[],h=S;h=h.parentNode;)h.nodeType===1&&m.push({element:h,left:h.scrollLeft,top:h.scrollTop});for(typeof S.focus=="function"&&S.focus(),S=0;S<m.length;S++)h=m[S],h.element.scrollLeft=h.left,h.element.scrollTop=h.top}}var Cie=a&&"documentMode"in document&&11>=document.documentMode,Wh=null,nk=null,hg=null,rk=!1;function Nj(h,m,S){var k=S.window===S?S.document:S.nodeType===9?S:S.ownerDocument;rk||Wh==null||Wh!==Dt(k)||(k=Wh,"selectionStart"in k&&tk(k)?k={start:k.selectionStart,end:k.selectionEnd}:(k=(k.ownerDocument&&k.ownerDocument.defaultView||window).getSelection(),k={anchorNode:k.anchorNode,anchorOffset:k.anchorOffset,focusNode:k.focusNode,focusOffset:k.focusOffset}),hg&&dg(hg,k)||(hg=k,k=Fv(nk,"onSelect"),0<k.length&&(m=new _a("onSelect","select",null,m,S),h.push({event:m,listeners:k}),m.target=Wh)))}function Nv(h,m){var S={};return S[h.toLowerCase()]=m.toLowerCase(),S["Webkit"+h]="webkit"+m,S["Moz"+h]="moz"+m,S}var Vh={animationend:Nv("Animation","AnimationEnd"),animationiteration:Nv("Animation","AnimationIteration"),animationstart:Nv("Animation","AnimationStart"),transitionend:Nv("Transition","TransitionEnd")},ik={},Lj={};a&&(Lj=document.createElement("div").style,"AnimationEvent"in window||(delete Vh.animationend.animation,delete Vh.animationiteration.animation,delete Vh.animationstart.animation),"TransitionEvent"in window||delete Vh.transitionend.transition);function Lv(h){if(ik[h])return ik[h];if(!Vh[h])return h;var m=Vh[h],S;for(S in m)if(m.hasOwnProperty(S)&&S in Lj)return ik[h]=m[S];return h}var zj=Lv("animationend"),Fj=Lv("animationiteration"),Bj=Lv("animationstart"),Uj=Lv("transitionend"),Hj=new Map,Wj="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function zc(h,m){Hj.set(h,m),o(m,[h])}for(var ok=0;ok<Wj.length;ok++){var sk=Wj[ok],Pie=sk.toLowerCase(),Tie=sk[0].toUpperCase()+sk.slice(1);zc(Pie,"on"+Tie)}zc(zj,"onAnimationEnd"),zc(Fj,"onAnimationIteration"),zc(Bj,"onAnimationStart"),zc("dblclick","onDoubleClick"),zc("focusin","onFocus"),zc("focusout","onBlur"),zc(Uj,"onTransitionEnd"),s("onMouseEnter",["mouseout","mouseover"]),s("onMouseLeave",["mouseout","mouseover"]),s("onPointerEnter",["pointerout","pointerover"]),s("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var pg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Eie=new Set("cancel close invalid load scroll toggle".split(" ").concat(pg));function Vj(h,m,S){var k=h.type||"unknown-event";h.currentTarget=S,Jf(k,m,void 0,h),h.currentTarget=null}function Kj(h,m){m=(m&4)!==0;for(var S=0;S<h.length;S++){var k=h[S],P=k.event;k=k.listeners;e:{var M=void 0;if(m)for(var R=k.length-1;0<=R;R--){var K=k[R],Z=K.instance,ue=K.currentTarget;if(K=K.listener,Z!==M&&P.isPropagationStopped())break e;Vj(P,K,ue),M=Z}else for(R=0;R<k.length;R++){if(K=k[R],Z=K.instance,ue=K.currentTarget,K=K.listener,Z!==M&&P.isPropagationStopped())break e;Vj(P,K,ue),M=Z}}}if(Eo)throw h=ad,Eo=!1,ad=null,h}function Mn(h,m){var S=m[fk];S===void 0&&(S=m[fk]=new Set);var k=h+"__bubble";S.has(k)||(qj(m,h,2,!1),S.add(k))}function ak(h,m,S){var k=0;m&&(k|=4),qj(S,h,k,m)}var zv="_reactListening"+Math.random().toString(36).slice(2);function fg(h){if(!h[zv]){h[zv]=!0,r.forEach(function(S){S!=="selectionchange"&&(Eie.has(S)||ak(S,!1,h),ak(S,!0,h))});var m=h.nodeType===9?h:h.ownerDocument;m===null||m[zv]||(m[zv]=!0,ak("selectionchange",!1,m))}}function qj(h,m,S,k){switch(vr(m)){case 1:var P=ve;break;case 4:P=Ke;break;default:P=cn}S=P.bind(null,m,S,h),P=void 0,!sd||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||(P=!0),k?P!==void 0?h.addEventListener(m,S,{capture:!0,passive:P}):h.addEventListener(m,S,!0):P!==void 0?h.addEventListener(m,S,{passive:P}):h.addEventListener(m,S,!1)}function lk(h,m,S,k,P){var M=k;if((m&1)===0&&(m&2)===0&&k!==null)e:for(;;){if(k===null)return;var R=k.tag;if(R===3||R===4){var K=k.stateNode.containerInfo;if(K===P||K.nodeType===8&&K.parentNode===P)break;if(R===4)for(R=k.return;R!==null;){var Z=R.tag;if((Z===3||Z===4)&&(Z=R.stateNode.containerInfo,Z===P||Z.nodeType===8&&Z.parentNode===P))return;R=R.return}for(;K!==null;){if(R=hd(K),R===null)return;if(Z=R.tag,Z===5||Z===6){k=M=R;continue e}K=K.parentNode}}k=k.return}Rh(function(){var ue=M,_e=Pi(S),Ee=[];e:{var we=Hj.get(h);if(we!==void 0){var Ue=_a,Xe=h;switch(h){case"keypress":if(xr(S)===0)break e;case"keydown":case"keyup":Ue=oie;break;case"focusin":Xe="focus",Ue=X1;break;case"focusout":Xe="blur",Ue=X1;break;case"beforeblur":case"afterblur":Ue=X1;break;case"click":if(S.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ue=xj;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ue=qre;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ue=lie;break;case zj:case Fj:case Bj:Ue=Xre;break;case Uj:Ue=uie;break;case"scroll":Ue=Uh;break;case"wheel":Ue=hie;break;case"copy":case"cut":case"paste":Ue=Jre;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ue=bj}var Je=(m&4)!==0,Sr=!Je&&h==="scroll",le=Je?we!==null?we+"Capture":null:we;Je=[];for(var Q=ue,ce;Q!==null;){ce=Q;var je=ce.stateNode;if(ce.tag===5&&je!==null&&(ce=je,le!==null&&(je=Bl(Q,le),je!=null&&Je.push(gg(Q,je,ce)))),Sr)break;Q=Q.return}0<Je.length&&(we=new Ue(we,Xe,null,S,_e),Ee.push({event:we,listeners:Je}))}}if((m&7)===0){e:{if(we=h==="mouseover"||h==="pointerover",Ue=h==="mouseout"||h==="pointerout",we&&S!==ln&&(Xe=S.relatedTarget||S.fromElement)&&(hd(Xe)||Xe[Wl]))break e;if((Ue||we)&&(we=_e.window===_e?_e:(we=_e.ownerDocument)?we.defaultView||we.parentWindow:window,Ue?(Xe=S.relatedTarget||S.toElement,Ue=ue,Xe=Xe?hd(Xe):null,Xe!==null&&(Sr=wa(Xe),Xe!==Sr||Xe.tag!==5&&Xe.tag!==6)&&(Xe=null)):(Ue=null,Xe=ue),Ue!==Xe)){if(Je=xj,je="onMouseLeave",le="onMouseEnter",Q="mouse",(h==="pointerout"||h==="pointerover")&&(Je=bj,je="onPointerLeave",le="onPointerEnter",Q="pointer"),Sr=Ue==null?we:Gh(Ue),ce=Xe==null?we:Gh(Xe),we=new Je(je,Q+"leave",Ue,S,_e),we.target=Sr,we.relatedTarget=ce,je=null,hd(_e)===ue&&(Je=new Je(le,Q+"enter",Xe,S,_e),Je.target=ce,Je.relatedTarget=Sr,je=Je),Sr=je,Ue&&Xe)t:{for(Je=Ue,le=Xe,Q=0,ce=Je;ce;ce=Kh(ce))Q++;for(ce=0,je=le;je;je=Kh(je))ce++;for(;0<Q-ce;)Je=Kh(Je),Q--;for(;0<ce-Q;)le=Kh(le),ce--;for(;Q--;){if(Je===le||le!==null&&Je===le.alternate)break t;Je=Kh(Je),le=Kh(le)}Je=null}else Je=null;Ue!==null&&Gj(Ee,we,Ue,Je,!1),Xe!==null&&Sr!==null&&Gj(Ee,Sr,Xe,Je,!0)}}e:{if(we=ue?Gh(ue):window,Ue=we.nodeName&&we.nodeName.toLowerCase(),Ue==="select"||Ue==="input"&&we.type==="file")var et=xie;else if(Pj(we))if(Ej)et=kie;else{et=bie;var st=Sie}else(Ue=we.nodeName)&&Ue.toLowerCase()==="input"&&(we.type==="checkbox"||we.type==="radio")&&(et=wie);if(et&&(et=et(h,ue))){Tj(Ee,et,S,_e);break e}st&&st(h,we,ue),h==="focusout"&&(st=we._wrapperState)&&st.controlled&&we.type==="number"&&Tr(we,"number",we.value)}switch(st=ue?Gh(ue):window,h){case"focusin":(Pj(st)||st.contentEditable==="true")&&(Wh=st,nk=ue,hg=null);break;case"focusout":hg=nk=Wh=null;break;case"mousedown":rk=!0;break;case"contextmenu":case"mouseup":case"dragend":rk=!1,Nj(Ee,S,_e);break;case"selectionchange":if(Cie)break;case"keydown":case"keyup":Nj(Ee,S,_e)}var at;if(J1)e:{switch(h){case"compositionstart":var gt="onCompositionStart";break e;case"compositionend":gt="onCompositionEnd";break e;case"compositionupdate":gt="onCompositionUpdate";break e}gt=void 0}else Hh?_j(h,S)&&(gt="onCompositionEnd"):h==="keydown"&&S.keyCode===229&&(gt="onCompositionStart");gt&&(wj&&S.locale!=="ko"&&(Hh||gt!=="onCompositionStart"?gt==="onCompositionEnd"&&Hh&&(at=Oo()):(In=_e,yn="value"in In?In.value:In.textContent,Hh=!0)),st=Fv(ue,gt),0<st.length&&(gt=new Sj(gt,h,null,S,_e),Ee.push({event:gt,listeners:st}),at?gt.data=at:(at=Cj(S),at!==null&&(gt.data=at)))),(at=fie?gie(h,S):mie(h,S))&&(ue=Fv(ue,"onBeforeInput"),0<ue.length&&(_e=new Sj("onBeforeInput","beforeinput",null,S,_e),Ee.push({event:_e,listeners:ue}),_e.data=at))}Kj(Ee,m)})}function gg(h,m,S){return{instance:h,listener:m,currentTarget:S}}function Fv(h,m){for(var S=m+"Capture",k=[];h!==null;){var P=h,M=P.stateNode;P.tag===5&&M!==null&&(P=M,M=Bl(h,S),M!=null&&k.unshift(gg(h,M,P)),M=Bl(h,m),M!=null&&k.push(gg(h,M,P))),h=h.return}return k}function Kh(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5);return h||null}function Gj(h,m,S,k,P){for(var M=m._reactName,R=[];S!==null&&S!==k;){var K=S,Z=K.alternate,ue=K.stateNode;if(Z!==null&&Z===k)break;K.tag===5&&ue!==null&&(K=ue,P?(Z=Bl(S,M),Z!=null&&R.unshift(gg(S,Z,K))):P||(Z=Bl(S,M),Z!=null&&R.push(gg(S,Z,K)))),S=S.return}R.length!==0&&h.push({event:m,listeners:R})}var Aie=/\r\n?/g,Mie=/\u0000|\uFFFD/g;function Yj(h){return(typeof h=="string"?h:""+h).replace(Aie,`
`).replace(Mie,"")}function Bv(h,m,S){if(m=Yj(m),Yj(h)!==m&&S)throw Error(n(425))}function Uv(){}var ck=null,uk=null;function dk(h,m){return h==="textarea"||h==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var hk=typeof setTimeout=="function"?setTimeout:void 0,Oie=typeof clearTimeout=="function"?clearTimeout:void 0,Xj=typeof Promise=="function"?Promise:void 0,Die=typeof queueMicrotask=="function"?queueMicrotask:typeof Xj<"u"?function(h){return Xj.resolve(null).then(h).catch(jie)}:hk;function jie(h){setTimeout(function(){throw h})}function pk(h,m){var S=m,k=0;do{var P=S.nextSibling;if(h.removeChild(S),P&&P.nodeType===8)if(S=P.data,S==="/$"){if(k===0){h.removeChild(P),oo(m);return}k--}else S!=="$"&&S!=="$?"&&S!=="$!"||k++;S=P}while(S);oo(m)}function Fc(h){for(;h!=null;h=h.nextSibling){var m=h.nodeType;if(m===1||m===3)break;if(m===8){if(m=h.data,m==="$"||m==="$!"||m==="$?")break;if(m==="/$")return null}}return h}function Zj(h){h=h.previousSibling;for(var m=0;h;){if(h.nodeType===8){var S=h.data;if(S==="$"||S==="$!"||S==="$?"){if(m===0)return h;m--}else S==="/$"&&m++}h=h.previousSibling}return null}var qh=Math.random().toString(36).slice(2),tl="__reactFiber$"+qh,mg="__reactProps$"+qh,Wl="__reactContainer$"+qh,fk="__reactEvents$"+qh,Rie="__reactListeners$"+qh,$ie="__reactHandles$"+qh;function hd(h){var m=h[tl];if(m)return m;for(var S=h.parentNode;S;){if(m=S[Wl]||S[tl]){if(S=m.alternate,m.child!==null||S!==null&&S.child!==null)for(h=Zj(h);h!==null;){if(S=h[tl])return S;h=Zj(h)}return m}h=S,S=h.parentNode}return null}function yg(h){return h=h[tl]||h[Wl],!h||h.tag!==5&&h.tag!==6&&h.tag!==13&&h.tag!==3?null:h}function Gh(h){if(h.tag===5||h.tag===6)return h.stateNode;throw Error(n(33))}function Hv(h){return h[mg]||null}var gk=[],Yh=-1;function Bc(h){return{current:h}}function On(h){0>Yh||(h.current=gk[Yh],gk[Yh]=null,Yh--)}function _n(h,m){Yh++,gk[Yh]=h.current,h.current=m}var Uc={},Oi=Bc(Uc),Do=Bc(!1),pd=Uc;function Xh(h,m){var S=h.type.contextTypes;if(!S)return Uc;var k=h.stateNode;if(k&&k.__reactInternalMemoizedUnmaskedChildContext===m)return k.__reactInternalMemoizedMaskedChildContext;var P={},M;for(M in S)P[M]=m[M];return k&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=m,h.__reactInternalMemoizedMaskedChildContext=P),P}function jo(h){return h=h.childContextTypes,h!=null}function Wv(){On(Do),On(Oi)}function Jj(h,m,S){if(Oi.current!==Uc)throw Error(n(168));_n(Oi,m),_n(Do,S)}function Qj(h,m,S){var k=h.stateNode;if(m=m.childContextTypes,typeof k.getChildContext!="function")return S;k=k.getChildContext();for(var P in k)if(!(P in m))throw Error(n(108,ye(h)||"Unknown",P));return N({},S,k)}function Vv(h){return h=(h=h.stateNode)&&h.__reactInternalMemoizedMergedChildContext||Uc,pd=Oi.current,_n(Oi,h),_n(Do,Do.current),!0}function eR(h,m,S){var k=h.stateNode;if(!k)throw Error(n(169));S?(h=Qj(h,m,pd),k.__reactInternalMemoizedMergedChildContext=h,On(Do),On(Oi),_n(Oi,h)):On(Do),_n(Do,S)}var Vl=null,Kv=!1,mk=!1;function tR(h){Vl===null?Vl=[h]:Vl.push(h)}function Nie(h){Kv=!0,tR(h)}function Hc(){if(!mk&&Vl!==null){mk=!0;var h=0,m=Ut;try{var S=Vl;for(Ut=1;h<S.length;h++){var k=S[h];do k=k(!0);while(k!==null)}Vl=null,Kv=!1}catch(P){throw Vl!==null&&(Vl=Vl.slice(h+1)),rs(ld,Hc),P}finally{Ut=m,mk=!1}}return null}var Zh=[],Jh=0,qv=null,Gv=0,Bs=[],Us=0,fd=null,Kl=1,ql="";function gd(h,m){Zh[Jh++]=Gv,Zh[Jh++]=qv,qv=h,Gv=m}function nR(h,m,S){Bs[Us++]=Kl,Bs[Us++]=ql,Bs[Us++]=fd,fd=h;var k=Kl;h=ql;var P=32-Ei(k)-1;k&=~(1<<P),S+=1;var M=32-Ei(m)+P;if(30<M){var R=P-P%5;M=(k&(1<<R)-1).toString(32),k>>=R,P-=R,Kl=1<<32-Ei(m)+P|S<<P|k,ql=M+h}else Kl=1<<M|S<<P|k,ql=h}function yk(h){h.return!==null&&(gd(h,1),nR(h,1,0))}function vk(h){for(;h===qv;)qv=Zh[--Jh],Zh[Jh]=null,Gv=Zh[--Jh],Zh[Jh]=null;for(;h===fd;)fd=Bs[--Us],Bs[Us]=null,ql=Bs[--Us],Bs[Us]=null,Kl=Bs[--Us],Bs[Us]=null}var ls=null,cs=null,Un=!1,Pa=null;function rR(h,m){var S=Ks(5,null,null,0);S.elementType="DELETED",S.stateNode=m,S.return=h,m=h.deletions,m===null?(h.deletions=[S],h.flags|=16):m.push(S)}function iR(h,m){switch(h.tag){case 5:var S=h.type;return m=m.nodeType!==1||S.toLowerCase()!==m.nodeName.toLowerCase()?null:m,m!==null?(h.stateNode=m,ls=h,cs=Fc(m.firstChild),!0):!1;case 6:return m=h.pendingProps===""||m.nodeType!==3?null:m,m!==null?(h.stateNode=m,ls=h,cs=null,!0):!1;case 13:return m=m.nodeType!==8?null:m,m!==null?(S=fd!==null?{id:Kl,overflow:ql}:null,h.memoizedState={dehydrated:m,treeContext:S,retryLane:1073741824},S=Ks(18,null,null,0),S.stateNode=m,S.return=h,h.child=S,ls=h,cs=null,!0):!1;default:return!1}}function xk(h){return(h.mode&1)!==0&&(h.flags&128)===0}function Sk(h){if(Un){var m=cs;if(m){var S=m;if(!iR(h,m)){if(xk(h))throw Error(n(418));m=Fc(S.nextSibling);var k=ls;m&&iR(h,m)?rR(k,S):(h.flags=h.flags&-4097|2,Un=!1,ls=h)}}else{if(xk(h))throw Error(n(418));h.flags=h.flags&-4097|2,Un=!1,ls=h}}}function oR(h){for(h=h.return;h!==null&&h.tag!==5&&h.tag!==3&&h.tag!==13;)h=h.return;ls=h}function Yv(h){if(h!==ls)return!1;if(!Un)return oR(h),Un=!0,!1;var m;if((m=h.tag!==3)&&!(m=h.tag!==5)&&(m=h.type,m=m!=="head"&&m!=="body"&&!dk(h.type,h.memoizedProps)),m&&(m=cs)){if(xk(h))throw sR(),Error(n(418));for(;m;)rR(h,m),m=Fc(m.nextSibling)}if(oR(h),h.tag===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(n(317));e:{for(h=h.nextSibling,m=0;h;){if(h.nodeType===8){var S=h.data;if(S==="/$"){if(m===0){cs=Fc(h.nextSibling);break e}m--}else S!=="$"&&S!=="$!"&&S!=="$?"||m++}h=h.nextSibling}cs=null}}else cs=ls?Fc(h.stateNode.nextSibling):null;return!0}function sR(){for(var h=cs;h;)h=Fc(h.nextSibling)}function Qh(){cs=ls=null,Un=!1}function bk(h){Pa===null?Pa=[h]:Pa.push(h)}var Lie=C.ReactCurrentBatchConfig;function vg(h,m,S){if(h=S.ref,h!==null&&typeof h!="function"&&typeof h!="object"){if(S._owner){if(S=S._owner,S){if(S.tag!==1)throw Error(n(309));var k=S.stateNode}if(!k)throw Error(n(147,h));var P=k,M=""+h;return m!==null&&m.ref!==null&&typeof m.ref=="function"&&m.ref._stringRef===M?m.ref:(m=function(R){var K=P.refs;R===null?delete K[M]:K[M]=R},m._stringRef=M,m)}if(typeof h!="string")throw Error(n(284));if(!S._owner)throw Error(n(290,h))}return h}function Xv(h,m){throw h=Object.prototype.toString.call(m),Error(n(31,h==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":h))}function aR(h){var m=h._init;return m(h._payload)}function lR(h){function m(le,Q){if(h){var ce=le.deletions;ce===null?(le.deletions=[Q],le.flags|=16):ce.push(Q)}}function S(le,Q){if(!h)return null;for(;Q!==null;)m(le,Q),Q=Q.sibling;return null}function k(le,Q){for(le=new Map;Q!==null;)Q.key!==null?le.set(Q.key,Q):le.set(Q.index,Q),Q=Q.sibling;return le}function P(le,Q){return le=Zc(le,Q),le.index=0,le.sibling=null,le}function M(le,Q,ce){return le.index=ce,h?(ce=le.alternate,ce!==null?(ce=ce.index,ce<Q?(le.flags|=2,Q):ce):(le.flags|=2,Q)):(le.flags|=1048576,Q)}function R(le){return h&&le.alternate===null&&(le.flags|=2),le}function K(le,Q,ce,je){return Q===null||Q.tag!==6?(Q=hI(ce,le.mode,je),Q.return=le,Q):(Q=P(Q,ce),Q.return=le,Q)}function Z(le,Q,ce,je){var et=ce.type;return et===O?_e(le,Q,ce.props.children,je,ce.key):Q!==null&&(Q.elementType===et||typeof et=="object"&&et!==null&&et.$$typeof===Y&&aR(et)===Q.type)?(je=P(Q,ce.props),je.ref=vg(le,Q,ce),je.return=le,je):(je=Sx(ce.type,ce.key,ce.props,null,le.mode,je),je.ref=vg(le,Q,ce),je.return=le,je)}function ue(le,Q,ce,je){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==ce.containerInfo||Q.stateNode.implementation!==ce.implementation?(Q=pI(ce,le.mode,je),Q.return=le,Q):(Q=P(Q,ce.children||[]),Q.return=le,Q)}function _e(le,Q,ce,je,et){return Q===null||Q.tag!==7?(Q=kd(ce,le.mode,je,et),Q.return=le,Q):(Q=P(Q,ce),Q.return=le,Q)}function Ee(le,Q,ce){if(typeof Q=="string"&&Q!==""||typeof Q=="number")return Q=hI(""+Q,le.mode,ce),Q.return=le,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case A:return ce=Sx(Q.type,Q.key,Q.props,null,le.mode,ce),ce.ref=vg(le,null,Q),ce.return=le,ce;case E:return Q=pI(Q,le.mode,ce),Q.return=le,Q;case Y:var je=Q._init;return Ee(le,je(Q._payload),ce)}if(fr(Q)||X(Q))return Q=kd(Q,le.mode,ce,null),Q.return=le,Q;Xv(le,Q)}return null}function we(le,Q,ce,je){var et=Q!==null?Q.key:null;if(typeof ce=="string"&&ce!==""||typeof ce=="number")return et!==null?null:K(le,Q,""+ce,je);if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case A:return ce.key===et?Z(le,Q,ce,je):null;case E:return ce.key===et?ue(le,Q,ce,je):null;case Y:return et=ce._init,we(le,Q,et(ce._payload),je)}if(fr(ce)||X(ce))return et!==null?null:_e(le,Q,ce,je,null);Xv(le,ce)}return null}function Ue(le,Q,ce,je,et){if(typeof je=="string"&&je!==""||typeof je=="number")return le=le.get(ce)||null,K(Q,le,""+je,et);if(typeof je=="object"&&je!==null){switch(je.$$typeof){case A:return le=le.get(je.key===null?ce:je.key)||null,Z(Q,le,je,et);case E:return le=le.get(je.key===null?ce:je.key)||null,ue(Q,le,je,et);case Y:var st=je._init;return Ue(le,Q,ce,st(je._payload),et)}if(fr(je)||X(je))return le=le.get(ce)||null,_e(Q,le,je,et,null);Xv(Q,je)}return null}function Xe(le,Q,ce,je){for(var et=null,st=null,at=Q,gt=Q=0,qr=null;at!==null&&gt<ce.length;gt++){at.index>gt?(qr=at,at=null):qr=at.sibling;var en=we(le,at,ce[gt],je);if(en===null){at===null&&(at=qr);break}h&&at&&en.alternate===null&&m(le,at),Q=M(en,Q,gt),st===null?et=en:st.sibling=en,st=en,at=qr}if(gt===ce.length)return S(le,at),Un&&gd(le,gt),et;if(at===null){for(;gt<ce.length;gt++)at=Ee(le,ce[gt],je),at!==null&&(Q=M(at,Q,gt),st===null?et=at:st.sibling=at,st=at);return Un&&gd(le,gt),et}for(at=k(le,at);gt<ce.length;gt++)qr=Ue(at,le,gt,ce[gt],je),qr!==null&&(h&&qr.alternate!==null&&at.delete(qr.key===null?gt:qr.key),Q=M(qr,Q,gt),st===null?et=qr:st.sibling=qr,st=qr);return h&&at.forEach(function(Jc){return m(le,Jc)}),Un&&gd(le,gt),et}function Je(le,Q,ce,je){var et=X(ce);if(typeof et!="function")throw Error(n(150));if(ce=et.call(ce),ce==null)throw Error(n(151));for(var st=et=null,at=Q,gt=Q=0,qr=null,en=ce.next();at!==null&&!en.done;gt++,en=ce.next()){at.index>gt?(qr=at,at=null):qr=at.sibling;var Jc=we(le,at,en.value,je);if(Jc===null){at===null&&(at=qr);break}h&&at&&Jc.alternate===null&&m(le,at),Q=M(Jc,Q,gt),st===null?et=Jc:st.sibling=Jc,st=Jc,at=qr}if(en.done)return S(le,at),Un&&gd(le,gt),et;if(at===null){for(;!en.done;gt++,en=ce.next())en=Ee(le,en.value,je),en!==null&&(Q=M(en,Q,gt),st===null?et=en:st.sibling=en,st=en);return Un&&gd(le,gt),et}for(at=k(le,at);!en.done;gt++,en=ce.next())en=Ue(at,le,gt,en.value,je),en!==null&&(h&&en.alternate!==null&&at.delete(en.key===null?gt:en.key),Q=M(en,Q,gt),st===null?et=en:st.sibling=en,st=en);return h&&at.forEach(function(yoe){return m(le,yoe)}),Un&&gd(le,gt),et}function Sr(le,Q,ce,je){if(typeof ce=="object"&&ce!==null&&ce.type===O&&ce.key===null&&(ce=ce.props.children),typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case A:e:{for(var et=ce.key,st=Q;st!==null;){if(st.key===et){if(et=ce.type,et===O){if(st.tag===7){S(le,st.sibling),Q=P(st,ce.props.children),Q.return=le,le=Q;break e}}else if(st.elementType===et||typeof et=="object"&&et!==null&&et.$$typeof===Y&&aR(et)===st.type){S(le,st.sibling),Q=P(st,ce.props),Q.ref=vg(le,st,ce),Q.return=le,le=Q;break e}S(le,st);break}else m(le,st);st=st.sibling}ce.type===O?(Q=kd(ce.props.children,le.mode,je,ce.key),Q.return=le,le=Q):(je=Sx(ce.type,ce.key,ce.props,null,le.mode,je),je.ref=vg(le,Q,ce),je.return=le,le=je)}return R(le);case E:e:{for(st=ce.key;Q!==null;){if(Q.key===st)if(Q.tag===4&&Q.stateNode.containerInfo===ce.containerInfo&&Q.stateNode.implementation===ce.implementation){S(le,Q.sibling),Q=P(Q,ce.children||[]),Q.return=le,le=Q;break e}else{S(le,Q);break}else m(le,Q);Q=Q.sibling}Q=pI(ce,le.mode,je),Q.return=le,le=Q}return R(le);case Y:return st=ce._init,Sr(le,Q,st(ce._payload),je)}if(fr(ce))return Xe(le,Q,ce,je);if(X(ce))return Je(le,Q,ce,je);Xv(le,ce)}return typeof ce=="string"&&ce!==""||typeof ce=="number"?(ce=""+ce,Q!==null&&Q.tag===6?(S(le,Q.sibling),Q=P(Q,ce),Q.return=le,le=Q):(S(le,Q),Q=hI(ce,le.mode,je),Q.return=le,le=Q),R(le)):S(le,Q)}return Sr}var ep=lR(!0),cR=lR(!1),Zv=Bc(null),Jv=null,tp=null,wk=null;function kk(){wk=tp=Jv=null}function Ik(h){var m=Zv.current;On(Zv),h._currentValue=m}function _k(h,m,S){for(;h!==null;){var k=h.alternate;if((h.childLanes&m)!==m?(h.childLanes|=m,k!==null&&(k.childLanes|=m)):k!==null&&(k.childLanes&m)!==m&&(k.childLanes|=m),h===S)break;h=h.return}}function np(h,m){Jv=h,wk=tp=null,h=h.dependencies,h!==null&&h.firstContext!==null&&((h.lanes&m)!==0&&(Ro=!0),h.firstContext=null)}function Hs(h){var m=h._currentValue;if(wk!==h)if(h={context:h,memoizedValue:m,next:null},tp===null){if(Jv===null)throw Error(n(308));tp=h,Jv.dependencies={lanes:0,firstContext:h}}else tp=tp.next=h;return m}var md=null;function Ck(h){md===null?md=[h]:md.push(h)}function uR(h,m,S,k){var P=m.interleaved;return P===null?(S.next=S,Ck(m)):(S.next=P.next,P.next=S),m.interleaved=S,Gl(h,k)}function Gl(h,m){h.lanes|=m;var S=h.alternate;for(S!==null&&(S.lanes|=m),S=h,h=h.return;h!==null;)h.childLanes|=m,S=h.alternate,S!==null&&(S.childLanes|=m),S=h,h=h.return;return S.tag===3?S.stateNode:null}var Wc=!1;function Pk(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function dR(h,m){h=h.updateQueue,m.updateQueue===h&&(m.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,effects:h.effects})}function Yl(h,m){return{eventTime:h,lane:m,tag:0,payload:null,callback:null,next:null}}function Vc(h,m,S){var k=h.updateQueue;if(k===null)return null;if(k=k.shared,(Xt&2)!==0){var P=k.pending;return P===null?m.next=m:(m.next=P.next,P.next=m),k.pending=m,Gl(h,S)}return P=k.interleaved,P===null?(m.next=m,Ck(k)):(m.next=P.next,P.next=m),k.interleaved=m,Gl(h,S)}function Qv(h,m,S){if(m=m.updateQueue,m!==null&&(m=m.shared,(S&4194240)!==0)){var k=m.lanes;k&=h.pendingLanes,S|=k,m.lanes=S,$c(h,S)}}function hR(h,m){var S=h.updateQueue,k=h.alternate;if(k!==null&&(k=k.updateQueue,S===k)){var P=null,M=null;if(S=S.firstBaseUpdate,S!==null){do{var R={eventTime:S.eventTime,lane:S.lane,tag:S.tag,payload:S.payload,callback:S.callback,next:null};M===null?P=M=R:M=M.next=R,S=S.next}while(S!==null);M===null?P=M=m:M=M.next=m}else P=M=m;S={baseState:k.baseState,firstBaseUpdate:P,lastBaseUpdate:M,shared:k.shared,effects:k.effects},h.updateQueue=S;return}h=S.lastBaseUpdate,h===null?S.firstBaseUpdate=m:h.next=m,S.lastBaseUpdate=m}function ex(h,m,S,k){var P=h.updateQueue;Wc=!1;var M=P.firstBaseUpdate,R=P.lastBaseUpdate,K=P.shared.pending;if(K!==null){P.shared.pending=null;var Z=K,ue=Z.next;Z.next=null,R===null?M=ue:R.next=ue,R=Z;var _e=h.alternate;_e!==null&&(_e=_e.updateQueue,K=_e.lastBaseUpdate,K!==R&&(K===null?_e.firstBaseUpdate=ue:K.next=ue,_e.lastBaseUpdate=Z))}if(M!==null){var Ee=P.baseState;R=0,_e=ue=Z=null,K=M;do{var we=K.lane,Ue=K.eventTime;if((k&we)===we){_e!==null&&(_e=_e.next={eventTime:Ue,lane:0,tag:K.tag,payload:K.payload,callback:K.callback,next:null});e:{var Xe=h,Je=K;switch(we=m,Ue=S,Je.tag){case 1:if(Xe=Je.payload,typeof Xe=="function"){Ee=Xe.call(Ue,Ee,we);break e}Ee=Xe;break e;case 3:Xe.flags=Xe.flags&-65537|128;case 0:if(Xe=Je.payload,we=typeof Xe=="function"?Xe.call(Ue,Ee,we):Xe,we==null)break e;Ee=N({},Ee,we);break e;case 2:Wc=!0}}K.callback!==null&&K.lane!==0&&(h.flags|=64,we=P.effects,we===null?P.effects=[K]:we.push(K))}else Ue={eventTime:Ue,lane:we,tag:K.tag,payload:K.payload,callback:K.callback,next:null},_e===null?(ue=_e=Ue,Z=Ee):_e=_e.next=Ue,R|=we;if(K=K.next,K===null){if(K=P.shared.pending,K===null)break;we=K,K=we.next,we.next=null,P.lastBaseUpdate=we,P.shared.pending=null}}while(!0);if(_e===null&&(Z=Ee),P.baseState=Z,P.firstBaseUpdate=ue,P.lastBaseUpdate=_e,m=P.shared.interleaved,m!==null){P=m;do R|=P.lane,P=P.next;while(P!==m)}else M===null&&(P.shared.lanes=0);xd|=R,h.lanes=R,h.memoizedState=Ee}}function pR(h,m,S){if(h=m.effects,m.effects=null,h!==null)for(m=0;m<h.length;m++){var k=h[m],P=k.callback;if(P!==null){if(k.callback=null,k=S,typeof P!="function")throw Error(n(191,P));P.call(k)}}}var xg={},nl=Bc(xg),Sg=Bc(xg),bg=Bc(xg);function yd(h){if(h===xg)throw Error(n(174));return h}function Tk(h,m){switch(_n(bg,m),_n(Sg,h),_n(nl,xg),h=m.nodeType,h){case 9:case 11:m=(m=m.documentElement)?m.namespaceURI:Me(null,"");break;default:h=h===8?m.parentNode:m,m=h.namespaceURI||null,h=h.tagName,m=Me(m,h)}On(nl),_n(nl,m)}function rp(){On(nl),On(Sg),On(bg)}function fR(h){yd(bg.current);var m=yd(nl.current),S=Me(m,h.type);m!==S&&(_n(Sg,h),_n(nl,S))}function Ek(h){Sg.current===h&&(On(nl),On(Sg))}var Xn=Bc(0);function tx(h){for(var m=h;m!==null;){if(m.tag===13){var S=m.memoizedState;if(S!==null&&(S=S.dehydrated,S===null||S.data==="$?"||S.data==="$!"))return m}else if(m.tag===19&&m.memoizedProps.revealOrder!==void 0){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===h)break;for(;m.sibling===null;){if(m.return===null||m.return===h)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var Ak=[];function Mk(){for(var h=0;h<Ak.length;h++)Ak[h]._workInProgressVersionPrimary=null;Ak.length=0}var nx=C.ReactCurrentDispatcher,Ok=C.ReactCurrentBatchConfig,vd=0,Zn=null,Nr=null,Vr=null,rx=!1,wg=!1,kg=0,zie=0;function Di(){throw Error(n(321))}function Dk(h,m){if(m===null)return!1;for(var S=0;S<m.length&&S<h.length;S++)if(!Ca(h[S],m[S]))return!1;return!0}function jk(h,m,S,k,P,M){if(vd=M,Zn=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,nx.current=h===null||h.memoizedState===null?Hie:Wie,h=S(k,P),wg){M=0;do{if(wg=!1,kg=0,25<=M)throw Error(n(301));M+=1,Vr=Nr=null,m.updateQueue=null,nx.current=Vie,h=S(k,P)}while(wg)}if(nx.current=sx,m=Nr!==null&&Nr.next!==null,vd=0,Vr=Nr=Zn=null,rx=!1,m)throw Error(n(300));return h}function Rk(){var h=kg!==0;return kg=0,h}function rl(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Vr===null?Zn.memoizedState=Vr=h:Vr=Vr.next=h,Vr}function Ws(){if(Nr===null){var h=Zn.alternate;h=h!==null?h.memoizedState:null}else h=Nr.next;var m=Vr===null?Zn.memoizedState:Vr.next;if(m!==null)Vr=m,Nr=h;else{if(h===null)throw Error(n(310));Nr=h,h={memoizedState:Nr.memoizedState,baseState:Nr.baseState,baseQueue:Nr.baseQueue,queue:Nr.queue,next:null},Vr===null?Zn.memoizedState=Vr=h:Vr=Vr.next=h}return Vr}function Ig(h,m){return typeof m=="function"?m(h):m}function $k(h){var m=Ws(),S=m.queue;if(S===null)throw Error(n(311));S.lastRenderedReducer=h;var k=Nr,P=k.baseQueue,M=S.pending;if(M!==null){if(P!==null){var R=P.next;P.next=M.next,M.next=R}k.baseQueue=P=M,S.pending=null}if(P!==null){M=P.next,k=k.baseState;var K=R=null,Z=null,ue=M;do{var _e=ue.lane;if((vd&_e)===_e)Z!==null&&(Z=Z.next={lane:0,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null}),k=ue.hasEagerState?ue.eagerState:h(k,ue.action);else{var Ee={lane:_e,action:ue.action,hasEagerState:ue.hasEagerState,eagerState:ue.eagerState,next:null};Z===null?(K=Z=Ee,R=k):Z=Z.next=Ee,Zn.lanes|=_e,xd|=_e}ue=ue.next}while(ue!==null&&ue!==M);Z===null?R=k:Z.next=K,Ca(k,m.memoizedState)||(Ro=!0),m.memoizedState=k,m.baseState=R,m.baseQueue=Z,S.lastRenderedState=k}if(h=S.interleaved,h!==null){P=h;do M=P.lane,Zn.lanes|=M,xd|=M,P=P.next;while(P!==h)}else P===null&&(S.lanes=0);return[m.memoizedState,S.dispatch]}function Nk(h){var m=Ws(),S=m.queue;if(S===null)throw Error(n(311));S.lastRenderedReducer=h;var k=S.dispatch,P=S.pending,M=m.memoizedState;if(P!==null){S.pending=null;var R=P=P.next;do M=h(M,R.action),R=R.next;while(R!==P);Ca(M,m.memoizedState)||(Ro=!0),m.memoizedState=M,m.baseQueue===null&&(m.baseState=M),S.lastRenderedState=M}return[M,k]}function gR(){}function mR(h,m){var S=Zn,k=Ws(),P=m(),M=!Ca(k.memoizedState,P);if(M&&(k.memoizedState=P,Ro=!0),k=k.queue,Lk(xR.bind(null,S,k,h),[h]),k.getSnapshot!==m||M||Vr!==null&&Vr.memoizedState.tag&1){if(S.flags|=2048,_g(9,vR.bind(null,S,k,P,m),void 0,null),Kr===null)throw Error(n(349));(vd&30)!==0||yR(S,m,P)}return P}function yR(h,m,S){h.flags|=16384,h={getSnapshot:m,value:S},m=Zn.updateQueue,m===null?(m={lastEffect:null,stores:null},Zn.updateQueue=m,m.stores=[h]):(S=m.stores,S===null?m.stores=[h]:S.push(h))}function vR(h,m,S,k){m.value=S,m.getSnapshot=k,SR(m)&&bR(h)}function xR(h,m,S){return S(function(){SR(m)&&bR(h)})}function SR(h){var m=h.getSnapshot;h=h.value;try{var S=m();return!Ca(h,S)}catch{return!0}}function bR(h){var m=Gl(h,1);m!==null&&Ma(m,h,1,-1)}function wR(h){var m=rl();return typeof h=="function"&&(h=h()),m.memoizedState=m.baseState=h,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ig,lastRenderedState:h},m.queue=h,h=h.dispatch=Uie.bind(null,Zn,h),[m.memoizedState,h]}function _g(h,m,S,k){return h={tag:h,create:m,destroy:S,deps:k,next:null},m=Zn.updateQueue,m===null?(m={lastEffect:null,stores:null},Zn.updateQueue=m,m.lastEffect=h.next=h):(S=m.lastEffect,S===null?m.lastEffect=h.next=h:(k=S.next,S.next=h,h.next=k,m.lastEffect=h)),h}function kR(){return Ws().memoizedState}function ix(h,m,S,k){var P=rl();Zn.flags|=h,P.memoizedState=_g(1|m,S,void 0,k===void 0?null:k)}function ox(h,m,S,k){var P=Ws();k=k===void 0?null:k;var M=void 0;if(Nr!==null){var R=Nr.memoizedState;if(M=R.destroy,k!==null&&Dk(k,R.deps)){P.memoizedState=_g(m,S,M,k);return}}Zn.flags|=h,P.memoizedState=_g(1|m,S,M,k)}function IR(h,m){return ix(8390656,8,h,m)}function Lk(h,m){return ox(2048,8,h,m)}function _R(h,m){return ox(4,2,h,m)}function CR(h,m){return ox(4,4,h,m)}function PR(h,m){if(typeof m=="function")return h=h(),m(h),function(){m(null)};if(m!=null)return h=h(),m.current=h,function(){m.current=null}}function TR(h,m,S){return S=S!=null?S.concat([h]):null,ox(4,4,PR.bind(null,m,h),S)}function zk(){}function ER(h,m){var S=Ws();m=m===void 0?null:m;var k=S.memoizedState;return k!==null&&m!==null&&Dk(m,k[1])?k[0]:(S.memoizedState=[h,m],h)}function AR(h,m){var S=Ws();m=m===void 0?null:m;var k=S.memoizedState;return k!==null&&m!==null&&Dk(m,k[1])?k[0]:(h=h(),S.memoizedState=[h,m],h)}function MR(h,m,S){return(vd&21)===0?(h.baseState&&(h.baseState=!1,Ro=!0),h.memoizedState=S):(Ca(S,m)||(S=cd(),Zn.lanes|=S,xd|=S,h.baseState=!0),m)}function Fie(h,m){var S=Ut;Ut=S!==0&&4>S?S:4,h(!0);var k=Ok.transition;Ok.transition={};try{h(!1),m()}finally{Ut=S,Ok.transition=k}}function OR(){return Ws().memoizedState}function Bie(h,m,S){var k=Yc(h);if(S={lane:k,action:S,hasEagerState:!1,eagerState:null,next:null},DR(h))jR(m,S);else if(S=uR(h,m,S,k),S!==null){var P=lo();Ma(S,h,k,P),RR(S,m,k)}}function Uie(h,m,S){var k=Yc(h),P={lane:k,action:S,hasEagerState:!1,eagerState:null,next:null};if(DR(h))jR(m,P);else{var M=h.alternate;if(h.lanes===0&&(M===null||M.lanes===0)&&(M=m.lastRenderedReducer,M!==null))try{var R=m.lastRenderedState,K=M(R,S);if(P.hasEagerState=!0,P.eagerState=K,Ca(K,R)){var Z=m.interleaved;Z===null?(P.next=P,Ck(m)):(P.next=Z.next,Z.next=P),m.interleaved=P;return}}catch{}finally{}S=uR(h,m,P,k),S!==null&&(P=lo(),Ma(S,h,k,P),RR(S,m,k))}}function DR(h){var m=h.alternate;return h===Zn||m!==null&&m===Zn}function jR(h,m){wg=rx=!0;var S=h.pending;S===null?m.next=m:(m.next=S.next,S.next=m),h.pending=m}function RR(h,m,S){if((S&4194240)!==0){var k=m.lanes;k&=h.pendingLanes,S|=k,m.lanes=S,$c(h,S)}}var sx={readContext:Hs,useCallback:Di,useContext:Di,useEffect:Di,useImperativeHandle:Di,useInsertionEffect:Di,useLayoutEffect:Di,useMemo:Di,useReducer:Di,useRef:Di,useState:Di,useDebugValue:Di,useDeferredValue:Di,useTransition:Di,useMutableSource:Di,useSyncExternalStore:Di,useId:Di,unstable_isNewReconciler:!1},Hie={readContext:Hs,useCallback:function(h,m){return rl().memoizedState=[h,m===void 0?null:m],h},useContext:Hs,useEffect:IR,useImperativeHandle:function(h,m,S){return S=S!=null?S.concat([h]):null,ix(4194308,4,PR.bind(null,m,h),S)},useLayoutEffect:function(h,m){return ix(4194308,4,h,m)},useInsertionEffect:function(h,m){return ix(4,2,h,m)},useMemo:function(h,m){var S=rl();return m=m===void 0?null:m,h=h(),S.memoizedState=[h,m],h},useReducer:function(h,m,S){var k=rl();return m=S!==void 0?S(m):m,k.memoizedState=k.baseState=m,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:m},k.queue=h,h=h.dispatch=Bie.bind(null,Zn,h),[k.memoizedState,h]},useRef:function(h){var m=rl();return h={current:h},m.memoizedState=h},useState:wR,useDebugValue:zk,useDeferredValue:function(h){return rl().memoizedState=h},useTransition:function(){var h=wR(!1),m=h[0];return h=Fie.bind(null,h[1]),rl().memoizedState=h,[m,h]},useMutableSource:function(){},useSyncExternalStore:function(h,m,S){var k=Zn,P=rl();if(Un){if(S===void 0)throw Error(n(407));S=S()}else{if(S=m(),Kr===null)throw Error(n(349));(vd&30)!==0||yR(k,m,S)}P.memoizedState=S;var M={value:S,getSnapshot:m};return P.queue=M,IR(xR.bind(null,k,M,h),[h]),k.flags|=2048,_g(9,vR.bind(null,k,M,S,m),void 0,null),S},useId:function(){var h=rl(),m=Kr.identifierPrefix;if(Un){var S=ql,k=Kl;S=(k&~(1<<32-Ei(k)-1)).toString(32)+S,m=":"+m+"R"+S,S=kg++,0<S&&(m+="H"+S.toString(32)),m+=":"}else S=zie++,m=":"+m+"r"+S.toString(32)+":";return h.memoizedState=m},unstable_isNewReconciler:!1},Wie={readContext:Hs,useCallback:ER,useContext:Hs,useEffect:Lk,useImperativeHandle:TR,useInsertionEffect:_R,useLayoutEffect:CR,useMemo:AR,useReducer:$k,useRef:kR,useState:function(){return $k(Ig)},useDebugValue:zk,useDeferredValue:function(h){var m=Ws();return MR(m,Nr.memoizedState,h)},useTransition:function(){var h=$k(Ig)[0],m=Ws().memoizedState;return[h,m]},useMutableSource:gR,useSyncExternalStore:mR,useId:OR,unstable_isNewReconciler:!1},Vie={readContext:Hs,useCallback:ER,useContext:Hs,useEffect:Lk,useImperativeHandle:TR,useInsertionEffect:_R,useLayoutEffect:CR,useMemo:AR,useReducer:Nk,useRef:kR,useState:function(){return Nk(Ig)},useDebugValue:zk,useDeferredValue:function(h){var m=Ws();return Nr===null?m.memoizedState=h:MR(m,Nr.memoizedState,h)},useTransition:function(){var h=Nk(Ig)[0],m=Ws().memoizedState;return[h,m]},useMutableSource:gR,useSyncExternalStore:mR,useId:OR,unstable_isNewReconciler:!1};function Ta(h,m){if(h&&h.defaultProps){m=N({},m),h=h.defaultProps;for(var S in h)m[S]===void 0&&(m[S]=h[S]);return m}return m}function Fk(h,m,S,k){m=h.memoizedState,S=S(k,m),S=S==null?m:N({},m,S),h.memoizedState=S,h.lanes===0&&(h.updateQueue.baseState=S)}var ax={isMounted:function(h){return(h=h._reactInternals)?wa(h)===h:!1},enqueueSetState:function(h,m,S){h=h._reactInternals;var k=lo(),P=Yc(h),M=Yl(k,P);M.payload=m,S!=null&&(M.callback=S),m=Vc(h,M,P),m!==null&&(Ma(m,h,P,k),Qv(m,h,P))},enqueueReplaceState:function(h,m,S){h=h._reactInternals;var k=lo(),P=Yc(h),M=Yl(k,P);M.tag=1,M.payload=m,S!=null&&(M.callback=S),m=Vc(h,M,P),m!==null&&(Ma(m,h,P,k),Qv(m,h,P))},enqueueForceUpdate:function(h,m){h=h._reactInternals;var S=lo(),k=Yc(h),P=Yl(S,k);P.tag=2,m!=null&&(P.callback=m),m=Vc(h,P,k),m!==null&&(Ma(m,h,k,S),Qv(m,h,k))}};function $R(h,m,S,k,P,M,R){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(k,M,R):m.prototype&&m.prototype.isPureReactComponent?!dg(S,k)||!dg(P,M):!0}function NR(h,m,S){var k=!1,P=Uc,M=m.contextType;return typeof M=="object"&&M!==null?M=Hs(M):(P=jo(m)?pd:Oi.current,k=m.contextTypes,M=(k=k!=null)?Xh(h,P):Uc),m=new m(S,M),h.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=ax,h.stateNode=m,m._reactInternals=h,k&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=P,h.__reactInternalMemoizedMaskedChildContext=M),m}function LR(h,m,S,k){h=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(S,k),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(S,k),m.state!==h&&ax.enqueueReplaceState(m,m.state,null)}function Bk(h,m,S,k){var P=h.stateNode;P.props=S,P.state=h.memoizedState,P.refs={},Pk(h);var M=m.contextType;typeof M=="object"&&M!==null?P.context=Hs(M):(M=jo(m)?pd:Oi.current,P.context=Xh(h,M)),P.state=h.memoizedState,M=m.getDerivedStateFromProps,typeof M=="function"&&(Fk(h,m,M,S),P.state=h.memoizedState),typeof m.getDerivedStateFromProps=="function"||typeof P.getSnapshotBeforeUpdate=="function"||typeof P.UNSAFE_componentWillMount!="function"&&typeof P.componentWillMount!="function"||(m=P.state,typeof P.componentWillMount=="function"&&P.componentWillMount(),typeof P.UNSAFE_componentWillMount=="function"&&P.UNSAFE_componentWillMount(),m!==P.state&&ax.enqueueReplaceState(P,P.state,null),ex(h,S,P,k),P.state=h.memoizedState),typeof P.componentDidMount=="function"&&(h.flags|=4194308)}function ip(h,m){try{var S="",k=m;do S+=ge(k),k=k.return;while(k);var P=S}catch(M){P=`
Error generating stack: `+M.message+`
`+M.stack}return{value:h,source:m,stack:P,digest:null}}function Uk(h,m,S){return{value:h,source:null,stack:S??null,digest:m??null}}function Hk(h,m){try{console.error(m.value)}catch(S){setTimeout(function(){throw S})}}var Kie=typeof WeakMap=="function"?WeakMap:Map;function zR(h,m,S){S=Yl(-1,S),S.tag=3,S.payload={element:null};var k=m.value;return S.callback=function(){fx||(fx=!0,iI=k),Hk(h,m)},S}function FR(h,m,S){S=Yl(-1,S),S.tag=3;var k=h.type.getDerivedStateFromError;if(typeof k=="function"){var P=m.value;S.payload=function(){return k(P)},S.callback=function(){Hk(h,m)}}var M=h.stateNode;return M!==null&&typeof M.componentDidCatch=="function"&&(S.callback=function(){Hk(h,m),typeof k!="function"&&(qc===null?qc=new Set([this]):qc.add(this));var R=m.stack;this.componentDidCatch(m.value,{componentStack:R!==null?R:""})}),S}function BR(h,m,S){var k=h.pingCache;if(k===null){k=h.pingCache=new Kie;var P=new Set;k.set(m,P)}else P=k.get(m),P===void 0&&(P=new Set,k.set(m,P));P.has(S)||(P.add(S),h=soe.bind(null,h,m,S),m.then(h,h))}function UR(h){do{var m;if((m=h.tag===13)&&(m=h.memoizedState,m=m!==null?m.dehydrated!==null:!0),m)return h;h=h.return}while(h!==null);return null}function HR(h,m,S,k,P){return(h.mode&1)===0?(h===m?h.flags|=65536:(h.flags|=128,S.flags|=131072,S.flags&=-52805,S.tag===1&&(S.alternate===null?S.tag=17:(m=Yl(-1,1),m.tag=2,Vc(S,m,1))),S.lanes|=1),h):(h.flags|=65536,h.lanes=P,h)}var qie=C.ReactCurrentOwner,Ro=!1;function ao(h,m,S,k){m.child=h===null?cR(m,null,S,k):ep(m,h.child,S,k)}function WR(h,m,S,k,P){S=S.render;var M=m.ref;return np(m,P),k=jk(h,m,S,k,M,P),S=Rk(),h!==null&&!Ro?(m.updateQueue=h.updateQueue,m.flags&=-2053,h.lanes&=~P,Xl(h,m,P)):(Un&&S&&yk(m),m.flags|=1,ao(h,m,k,P),m.child)}function VR(h,m,S,k,P){if(h===null){var M=S.type;return typeof M=="function"&&!dI(M)&&M.defaultProps===void 0&&S.compare===null&&S.defaultProps===void 0?(m.tag=15,m.type=M,KR(h,m,M,k,P)):(h=Sx(S.type,null,k,m,m.mode,P),h.ref=m.ref,h.return=m,m.child=h)}if(M=h.child,(h.lanes&P)===0){var R=M.memoizedProps;if(S=S.compare,S=S!==null?S:dg,S(R,k)&&h.ref===m.ref)return Xl(h,m,P)}return m.flags|=1,h=Zc(M,k),h.ref=m.ref,h.return=m,m.child=h}function KR(h,m,S,k,P){if(h!==null){var M=h.memoizedProps;if(dg(M,k)&&h.ref===m.ref)if(Ro=!1,m.pendingProps=k=M,(h.lanes&P)!==0)(h.flags&131072)!==0&&(Ro=!0);else return m.lanes=h.lanes,Xl(h,m,P)}return Wk(h,m,S,k,P)}function qR(h,m,S){var k=m.pendingProps,P=k.children,M=h!==null?h.memoizedState:null;if(k.mode==="hidden")if((m.mode&1)===0)m.memoizedState={baseLanes:0,cachePool:null,transitions:null},_n(sp,us),us|=S;else{if((S&1073741824)===0)return h=M!==null?M.baseLanes|S:S,m.lanes=m.childLanes=1073741824,m.memoizedState={baseLanes:h,cachePool:null,transitions:null},m.updateQueue=null,_n(sp,us),us|=h,null;m.memoizedState={baseLanes:0,cachePool:null,transitions:null},k=M!==null?M.baseLanes:S,_n(sp,us),us|=k}else M!==null?(k=M.baseLanes|S,m.memoizedState=null):k=S,_n(sp,us),us|=k;return ao(h,m,P,S),m.child}function GR(h,m){var S=m.ref;(h===null&&S!==null||h!==null&&h.ref!==S)&&(m.flags|=512,m.flags|=2097152)}function Wk(h,m,S,k,P){var M=jo(S)?pd:Oi.current;return M=Xh(m,M),np(m,P),S=jk(h,m,S,k,M,P),k=Rk(),h!==null&&!Ro?(m.updateQueue=h.updateQueue,m.flags&=-2053,h.lanes&=~P,Xl(h,m,P)):(Un&&k&&yk(m),m.flags|=1,ao(h,m,S,P),m.child)}function YR(h,m,S,k,P){if(jo(S)){var M=!0;Vv(m)}else M=!1;if(np(m,P),m.stateNode===null)cx(h,m),NR(m,S,k),Bk(m,S,k,P),k=!0;else if(h===null){var R=m.stateNode,K=m.memoizedProps;R.props=K;var Z=R.context,ue=S.contextType;typeof ue=="object"&&ue!==null?ue=Hs(ue):(ue=jo(S)?pd:Oi.current,ue=Xh(m,ue));var _e=S.getDerivedStateFromProps,Ee=typeof _e=="function"||typeof R.getSnapshotBeforeUpdate=="function";Ee||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(K!==k||Z!==ue)&&LR(m,R,k,ue),Wc=!1;var we=m.memoizedState;R.state=we,ex(m,k,R,P),Z=m.memoizedState,K!==k||we!==Z||Do.current||Wc?(typeof _e=="function"&&(Fk(m,S,_e,k),Z=m.memoizedState),(K=Wc||$R(m,S,K,k,we,Z,ue))?(Ee||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(m.flags|=4194308)):(typeof R.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=k,m.memoizedState=Z),R.props=k,R.state=Z,R.context=ue,k=K):(typeof R.componentDidMount=="function"&&(m.flags|=4194308),k=!1)}else{R=m.stateNode,dR(h,m),K=m.memoizedProps,ue=m.type===m.elementType?K:Ta(m.type,K),R.props=ue,Ee=m.pendingProps,we=R.context,Z=S.contextType,typeof Z=="object"&&Z!==null?Z=Hs(Z):(Z=jo(S)?pd:Oi.current,Z=Xh(m,Z));var Ue=S.getDerivedStateFromProps;(_e=typeof Ue=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(K!==Ee||we!==Z)&&LR(m,R,k,Z),Wc=!1,we=m.memoizedState,R.state=we,ex(m,k,R,P);var Xe=m.memoizedState;K!==Ee||we!==Xe||Do.current||Wc?(typeof Ue=="function"&&(Fk(m,S,Ue,k),Xe=m.memoizedState),(ue=Wc||$R(m,S,ue,k,we,Xe,Z)||!1)?(_e||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(k,Xe,Z),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(k,Xe,Z)),typeof R.componentDidUpdate=="function"&&(m.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof R.componentDidUpdate!="function"||K===h.memoizedProps&&we===h.memoizedState||(m.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||K===h.memoizedProps&&we===h.memoizedState||(m.flags|=1024),m.memoizedProps=k,m.memoizedState=Xe),R.props=k,R.state=Xe,R.context=Z,k=ue):(typeof R.componentDidUpdate!="function"||K===h.memoizedProps&&we===h.memoizedState||(m.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||K===h.memoizedProps&&we===h.memoizedState||(m.flags|=1024),k=!1)}return Vk(h,m,S,k,M,P)}function Vk(h,m,S,k,P,M){GR(h,m);var R=(m.flags&128)!==0;if(!k&&!R)return P&&eR(m,S,!1),Xl(h,m,M);k=m.stateNode,qie.current=m;var K=R&&typeof S.getDerivedStateFromError!="function"?null:k.render();return m.flags|=1,h!==null&&R?(m.child=ep(m,h.child,null,M),m.child=ep(m,null,K,M)):ao(h,m,K,M),m.memoizedState=k.state,P&&eR(m,S,!0),m.child}function XR(h){var m=h.stateNode;m.pendingContext?Jj(h,m.pendingContext,m.pendingContext!==m.context):m.context&&Jj(h,m.context,!1),Tk(h,m.containerInfo)}function ZR(h,m,S,k,P){return Qh(),bk(P),m.flags|=256,ao(h,m,S,k),m.child}var Kk={dehydrated:null,treeContext:null,retryLane:0};function qk(h){return{baseLanes:h,cachePool:null,transitions:null}}function JR(h,m,S){var k=m.pendingProps,P=Xn.current,M=!1,R=(m.flags&128)!==0,K;if((K=R)||(K=h!==null&&h.memoizedState===null?!1:(P&2)!==0),K?(M=!0,m.flags&=-129):(h===null||h.memoizedState!==null)&&(P|=1),_n(Xn,P&1),h===null)return Sk(m),h=m.memoizedState,h!==null&&(h=h.dehydrated,h!==null)?((m.mode&1)===0?m.lanes=1:h.data==="$!"?m.lanes=8:m.lanes=1073741824,null):(R=k.children,h=k.fallback,M?(k=m.mode,M=m.child,R={mode:"hidden",children:R},(k&1)===0&&M!==null?(M.childLanes=0,M.pendingProps=R):M=bx(R,k,0,null),h=kd(h,k,S,null),M.return=m,h.return=m,M.sibling=h,m.child=M,m.child.memoizedState=qk(S),m.memoizedState=Kk,h):Gk(m,R));if(P=h.memoizedState,P!==null&&(K=P.dehydrated,K!==null))return Gie(h,m,R,k,K,P,S);if(M){M=k.fallback,R=m.mode,P=h.child,K=P.sibling;var Z={mode:"hidden",children:k.children};return(R&1)===0&&m.child!==P?(k=m.child,k.childLanes=0,k.pendingProps=Z,m.deletions=null):(k=Zc(P,Z),k.subtreeFlags=P.subtreeFlags&14680064),K!==null?M=Zc(K,M):(M=kd(M,R,S,null),M.flags|=2),M.return=m,k.return=m,k.sibling=M,m.child=k,k=M,M=m.child,R=h.child.memoizedState,R=R===null?qk(S):{baseLanes:R.baseLanes|S,cachePool:null,transitions:R.transitions},M.memoizedState=R,M.childLanes=h.childLanes&~S,m.memoizedState=Kk,k}return M=h.child,h=M.sibling,k=Zc(M,{mode:"visible",children:k.children}),(m.mode&1)===0&&(k.lanes=S),k.return=m,k.sibling=null,h!==null&&(S=m.deletions,S===null?(m.deletions=[h],m.flags|=16):S.push(h)),m.child=k,m.memoizedState=null,k}function Gk(h,m){return m=bx({mode:"visible",children:m},h.mode,0,null),m.return=h,h.child=m}function lx(h,m,S,k){return k!==null&&bk(k),ep(m,h.child,null,S),h=Gk(m,m.pendingProps.children),h.flags|=2,m.memoizedState=null,h}function Gie(h,m,S,k,P,M,R){if(S)return m.flags&256?(m.flags&=-257,k=Uk(Error(n(422))),lx(h,m,R,k)):m.memoizedState!==null?(m.child=h.child,m.flags|=128,null):(M=k.fallback,P=m.mode,k=bx({mode:"visible",children:k.children},P,0,null),M=kd(M,P,R,null),M.flags|=2,k.return=m,M.return=m,k.sibling=M,m.child=k,(m.mode&1)!==0&&ep(m,h.child,null,R),m.child.memoizedState=qk(R),m.memoizedState=Kk,M);if((m.mode&1)===0)return lx(h,m,R,null);if(P.data==="$!"){if(k=P.nextSibling&&P.nextSibling.dataset,k)var K=k.dgst;return k=K,M=Error(n(419)),k=Uk(M,k,void 0),lx(h,m,R,k)}if(K=(R&h.childLanes)!==0,Ro||K){if(k=Kr,k!==null){switch(R&-R){case 4:P=2;break;case 16:P=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:P=32;break;case 536870912:P=268435456;break;default:P=0}P=(P&(k.suspendedLanes|R))!==0?0:P,P!==0&&P!==M.retryLane&&(M.retryLane=P,Gl(h,P),Ma(k,h,P,-1))}return uI(),k=Uk(Error(n(421))),lx(h,m,R,k)}return P.data==="$?"?(m.flags|=128,m.child=h.child,m=aoe.bind(null,h),P._reactRetry=m,null):(h=M.treeContext,cs=Fc(P.nextSibling),ls=m,Un=!0,Pa=null,h!==null&&(Bs[Us++]=Kl,Bs[Us++]=ql,Bs[Us++]=fd,Kl=h.id,ql=h.overflow,fd=m),m=Gk(m,k.children),m.flags|=4096,m)}function QR(h,m,S){h.lanes|=m;var k=h.alternate;k!==null&&(k.lanes|=m),_k(h.return,m,S)}function Yk(h,m,S,k,P){var M=h.memoizedState;M===null?h.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:k,tail:S,tailMode:P}:(M.isBackwards=m,M.rendering=null,M.renderingStartTime=0,M.last=k,M.tail=S,M.tailMode=P)}function e$(h,m,S){var k=m.pendingProps,P=k.revealOrder,M=k.tail;if(ao(h,m,k.children,S),k=Xn.current,(k&2)!==0)k=k&1|2,m.flags|=128;else{if(h!==null&&(h.flags&128)!==0)e:for(h=m.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&QR(h,S,m);else if(h.tag===19)QR(h,S,m);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===m)break e;for(;h.sibling===null;){if(h.return===null||h.return===m)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}k&=1}if(_n(Xn,k),(m.mode&1)===0)m.memoizedState=null;else switch(P){case"forwards":for(S=m.child,P=null;S!==null;)h=S.alternate,h!==null&&tx(h)===null&&(P=S),S=S.sibling;S=P,S===null?(P=m.child,m.child=null):(P=S.sibling,S.sibling=null),Yk(m,!1,P,S,M);break;case"backwards":for(S=null,P=m.child,m.child=null;P!==null;){if(h=P.alternate,h!==null&&tx(h)===null){m.child=P;break}h=P.sibling,P.sibling=S,S=P,P=h}Yk(m,!0,S,null,M);break;case"together":Yk(m,!1,null,null,void 0);break;default:m.memoizedState=null}return m.child}function cx(h,m){(m.mode&1)===0&&h!==null&&(h.alternate=null,m.alternate=null,m.flags|=2)}function Xl(h,m,S){if(h!==null&&(m.dependencies=h.dependencies),xd|=m.lanes,(S&m.childLanes)===0)return null;if(h!==null&&m.child!==h.child)throw Error(n(153));if(m.child!==null){for(h=m.child,S=Zc(h,h.pendingProps),m.child=S,S.return=m;h.sibling!==null;)h=h.sibling,S=S.sibling=Zc(h,h.pendingProps),S.return=m;S.sibling=null}return m.child}function Yie(h,m,S){switch(m.tag){case 3:XR(m),Qh();break;case 5:fR(m);break;case 1:jo(m.type)&&Vv(m);break;case 4:Tk(m,m.stateNode.containerInfo);break;case 10:var k=m.type._context,P=m.memoizedProps.value;_n(Zv,k._currentValue),k._currentValue=P;break;case 13:if(k=m.memoizedState,k!==null)return k.dehydrated!==null?(_n(Xn,Xn.current&1),m.flags|=128,null):(S&m.child.childLanes)!==0?JR(h,m,S):(_n(Xn,Xn.current&1),h=Xl(h,m,S),h!==null?h.sibling:null);_n(Xn,Xn.current&1);break;case 19:if(k=(S&m.childLanes)!==0,(h.flags&128)!==0){if(k)return e$(h,m,S);m.flags|=128}if(P=m.memoizedState,P!==null&&(P.rendering=null,P.tail=null,P.lastEffect=null),_n(Xn,Xn.current),k)break;return null;case 22:case 23:return m.lanes=0,qR(h,m,S)}return Xl(h,m,S)}var t$,Xk,n$,r$;t$=function(h,m){for(var S=m.child;S!==null;){if(S.tag===5||S.tag===6)h.appendChild(S.stateNode);else if(S.tag!==4&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===m)break;for(;S.sibling===null;){if(S.return===null||S.return===m)return;S=S.return}S.sibling.return=S.return,S=S.sibling}},Xk=function(){},n$=function(h,m,S,k){var P=h.memoizedProps;if(P!==k){h=m.stateNode,yd(nl.current);var M=null;switch(S){case"input":P=Kt(h,P),k=Kt(h,k),M=[];break;case"select":P=N({},P,{value:void 0}),k=N({},k,{value:void 0}),M=[];break;case"textarea":P=ts(h,P),k=ts(h,k),M=[];break;default:typeof P.onClick!="function"&&typeof k.onClick=="function"&&(h.onclick=Uv)}mn(S,k);var R;S=null;for(ue in P)if(!k.hasOwnProperty(ue)&&P.hasOwnProperty(ue)&&P[ue]!=null)if(ue==="style"){var K=P[ue];for(R in K)K.hasOwnProperty(R)&&(S||(S={}),S[R]="")}else ue!=="dangerouslySetInnerHTML"&&ue!=="children"&&ue!=="suppressContentEditableWarning"&&ue!=="suppressHydrationWarning"&&ue!=="autoFocus"&&(i.hasOwnProperty(ue)?M||(M=[]):(M=M||[]).push(ue,null));for(ue in k){var Z=k[ue];if(K=P?.[ue],k.hasOwnProperty(ue)&&Z!==K&&(Z!=null||K!=null))if(ue==="style")if(K){for(R in K)!K.hasOwnProperty(R)||Z&&Z.hasOwnProperty(R)||(S||(S={}),S[R]="");for(R in Z)Z.hasOwnProperty(R)&&K[R]!==Z[R]&&(S||(S={}),S[R]=Z[R])}else S||(M||(M=[]),M.push(ue,S)),S=Z;else ue==="dangerouslySetInnerHTML"?(Z=Z?Z.__html:void 0,K=K?K.__html:void 0,Z!=null&&K!==Z&&(M=M||[]).push(ue,Z)):ue==="children"?typeof Z!="string"&&typeof Z!="number"||(M=M||[]).push(ue,""+Z):ue!=="suppressContentEditableWarning"&&ue!=="suppressHydrationWarning"&&(i.hasOwnProperty(ue)?(Z!=null&&ue==="onScroll"&&Mn("scroll",h),M||K===Z||(M=[])):(M=M||[]).push(ue,Z))}S&&(M=M||[]).push("style",S);var ue=M;(m.updateQueue=ue)&&(m.flags|=4)}},r$=function(h,m,S,k){S!==k&&(m.flags|=4)};function Cg(h,m){if(!Un)switch(h.tailMode){case"hidden":m=h.tail;for(var S=null;m!==null;)m.alternate!==null&&(S=m),m=m.sibling;S===null?h.tail=null:S.sibling=null;break;case"collapsed":S=h.tail;for(var k=null;S!==null;)S.alternate!==null&&(k=S),S=S.sibling;k===null?m||h.tail===null?h.tail=null:h.tail.sibling=null:k.sibling=null}}function ji(h){var m=h.alternate!==null&&h.alternate.child===h.child,S=0,k=0;if(m)for(var P=h.child;P!==null;)S|=P.lanes|P.childLanes,k|=P.subtreeFlags&14680064,k|=P.flags&14680064,P.return=h,P=P.sibling;else for(P=h.child;P!==null;)S|=P.lanes|P.childLanes,k|=P.subtreeFlags,k|=P.flags,P.return=h,P=P.sibling;return h.subtreeFlags|=k,h.childLanes=S,m}function Xie(h,m,S){var k=m.pendingProps;switch(vk(m),m.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ji(m),null;case 1:return jo(m.type)&&Wv(),ji(m),null;case 3:return k=m.stateNode,rp(),On(Do),On(Oi),Mk(),k.pendingContext&&(k.context=k.pendingContext,k.pendingContext=null),(h===null||h.child===null)&&(Yv(m)?m.flags|=4:h===null||h.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,Pa!==null&&(aI(Pa),Pa=null))),Xk(h,m),ji(m),null;case 5:Ek(m);var P=yd(bg.current);if(S=m.type,h!==null&&m.stateNode!=null)n$(h,m,S,k,P),h.ref!==m.ref&&(m.flags|=512,m.flags|=2097152);else{if(!k){if(m.stateNode===null)throw Error(n(166));return ji(m),null}if(h=yd(nl.current),Yv(m)){k=m.stateNode,S=m.type;var M=m.memoizedProps;switch(k[tl]=m,k[mg]=M,h=(m.mode&1)!==0,S){case"dialog":Mn("cancel",k),Mn("close",k);break;case"iframe":case"object":case"embed":Mn("load",k);break;case"video":case"audio":for(P=0;P<pg.length;P++)Mn(pg[P],k);break;case"source":Mn("error",k);break;case"img":case"image":case"link":Mn("error",k),Mn("load",k);break;case"details":Mn("toggle",k);break;case"input":Gt(k,M),Mn("invalid",k);break;case"select":k._wrapperState={wasMultiple:!!M.multiple},Mn("invalid",k);break;case"textarea":ya(k,M),Mn("invalid",k)}mn(S,M),P=null;for(var R in M)if(M.hasOwnProperty(R)){var K=M[R];R==="children"?typeof K=="string"?k.textContent!==K&&(M.suppressHydrationWarning!==!0&&Bv(k.textContent,K,h),P=["children",K]):typeof K=="number"&&k.textContent!==""+K&&(M.suppressHydrationWarning!==!0&&Bv(k.textContent,K,h),P=["children",""+K]):i.hasOwnProperty(R)&&K!=null&&R==="onScroll"&&Mn("scroll",k)}switch(S){case"input":Ft(k),Pr(k,M,!0);break;case"textarea":Ft(k),Ur(k);break;case"select":case"option":break;default:typeof M.onClick=="function"&&(k.onclick=Uv)}k=P,m.updateQueue=k,k!==null&&(m.flags|=4)}else{R=P.nodeType===9?P:P.ownerDocument,h==="http://www.w3.org/1999/xhtml"&&(h=de(S)),h==="http://www.w3.org/1999/xhtml"?S==="script"?(h=R.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild)):typeof k.is=="string"?h=R.createElement(S,{is:k.is}):(h=R.createElement(S),S==="select"&&(R=h,k.multiple?R.multiple=!0:k.size&&(R.size=k.size))):h=R.createElementNS(h,S),h[tl]=m,h[mg]=k,t$(h,m,!1,!1),m.stateNode=h;e:{switch(R=Bn(S,k),S){case"dialog":Mn("cancel",h),Mn("close",h),P=k;break;case"iframe":case"object":case"embed":Mn("load",h),P=k;break;case"video":case"audio":for(P=0;P<pg.length;P++)Mn(pg[P],h);P=k;break;case"source":Mn("error",h),P=k;break;case"img":case"image":case"link":Mn("error",h),Mn("load",h),P=k;break;case"details":Mn("toggle",h),P=k;break;case"input":Gt(h,k),P=Kt(h,k),Mn("invalid",h);break;case"option":P=k;break;case"select":h._wrapperState={wasMultiple:!!k.multiple},P=N({},k,{value:void 0}),Mn("invalid",h);break;case"textarea":ya(h,k),P=ts(h,k),Mn("invalid",h);break;default:P=k}mn(S,P),K=P;for(M in K)if(K.hasOwnProperty(M)){var Z=K[M];M==="style"?zn(h,Z):M==="dangerouslySetInnerHTML"?(Z=Z?Z.__html:void 0,Z!=null&&vt(h,Z)):M==="children"?typeof Z=="string"?(S!=="textarea"||Z!=="")&&oe(h,Z):typeof Z=="number"&&oe(h,""+Z):M!=="suppressContentEditableWarning"&&M!=="suppressHydrationWarning"&&M!=="autoFocus"&&(i.hasOwnProperty(M)?Z!=null&&M==="onScroll"&&Mn("scroll",h):Z!=null&&_(h,M,Z,R))}switch(S){case"input":Ft(h),Pr(h,k,!1);break;case"textarea":Ft(h),Ur(h);break;case"option":k.value!=null&&h.setAttribute("value",""+Se(k.value));break;case"select":h.multiple=!!k.multiple,M=k.value,M!=null?gr(h,!!k.multiple,M,!1):k.defaultValue!=null&&gr(h,!!k.multiple,k.defaultValue,!0);break;default:typeof P.onClick=="function"&&(h.onclick=Uv)}switch(S){case"button":case"input":case"select":case"textarea":k=!!k.autoFocus;break e;case"img":k=!0;break e;default:k=!1}}k&&(m.flags|=4)}m.ref!==null&&(m.flags|=512,m.flags|=2097152)}return ji(m),null;case 6:if(h&&m.stateNode!=null)r$(h,m,h.memoizedProps,k);else{if(typeof k!="string"&&m.stateNode===null)throw Error(n(166));if(S=yd(bg.current),yd(nl.current),Yv(m)){if(k=m.stateNode,S=m.memoizedProps,k[tl]=m,(M=k.nodeValue!==S)&&(h=ls,h!==null))switch(h.tag){case 3:Bv(k.nodeValue,S,(h.mode&1)!==0);break;case 5:h.memoizedProps.suppressHydrationWarning!==!0&&Bv(k.nodeValue,S,(h.mode&1)!==0)}M&&(m.flags|=4)}else k=(S.nodeType===9?S:S.ownerDocument).createTextNode(k),k[tl]=m,m.stateNode=k}return ji(m),null;case 13:if(On(Xn),k=m.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(Un&&cs!==null&&(m.mode&1)!==0&&(m.flags&128)===0)sR(),Qh(),m.flags|=98560,M=!1;else if(M=Yv(m),k!==null&&k.dehydrated!==null){if(h===null){if(!M)throw Error(n(318));if(M=m.memoizedState,M=M!==null?M.dehydrated:null,!M)throw Error(n(317));M[tl]=m}else Qh(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;ji(m),M=!1}else Pa!==null&&(aI(Pa),Pa=null),M=!0;if(!M)return m.flags&65536?m:null}return(m.flags&128)!==0?(m.lanes=S,m):(k=k!==null,k!==(h!==null&&h.memoizedState!==null)&&k&&(m.child.flags|=8192,(m.mode&1)!==0&&(h===null||(Xn.current&1)!==0?Lr===0&&(Lr=3):uI())),m.updateQueue!==null&&(m.flags|=4),ji(m),null);case 4:return rp(),Xk(h,m),h===null&&fg(m.stateNode.containerInfo),ji(m),null;case 10:return Ik(m.type._context),ji(m),null;case 17:return jo(m.type)&&Wv(),ji(m),null;case 19:if(On(Xn),M=m.memoizedState,M===null)return ji(m),null;if(k=(m.flags&128)!==0,R=M.rendering,R===null)if(k)Cg(M,!1);else{if(Lr!==0||h!==null&&(h.flags&128)!==0)for(h=m.child;h!==null;){if(R=tx(h),R!==null){for(m.flags|=128,Cg(M,!1),k=R.updateQueue,k!==null&&(m.updateQueue=k,m.flags|=4),m.subtreeFlags=0,k=S,S=m.child;S!==null;)M=S,h=k,M.flags&=14680066,R=M.alternate,R===null?(M.childLanes=0,M.lanes=h,M.child=null,M.subtreeFlags=0,M.memoizedProps=null,M.memoizedState=null,M.updateQueue=null,M.dependencies=null,M.stateNode=null):(M.childLanes=R.childLanes,M.lanes=R.lanes,M.child=R.child,M.subtreeFlags=0,M.deletions=null,M.memoizedProps=R.memoizedProps,M.memoizedState=R.memoizedState,M.updateQueue=R.updateQueue,M.type=R.type,h=R.dependencies,M.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),S=S.sibling;return _n(Xn,Xn.current&1|2),m.child}h=h.sibling}M.tail!==null&&En()>ap&&(m.flags|=128,k=!0,Cg(M,!1),m.lanes=4194304)}else{if(!k)if(h=tx(R),h!==null){if(m.flags|=128,k=!0,S=h.updateQueue,S!==null&&(m.updateQueue=S,m.flags|=4),Cg(M,!0),M.tail===null&&M.tailMode==="hidden"&&!R.alternate&&!Un)return ji(m),null}else 2*En()-M.renderingStartTime>ap&&S!==1073741824&&(m.flags|=128,k=!0,Cg(M,!1),m.lanes=4194304);M.isBackwards?(R.sibling=m.child,m.child=R):(S=M.last,S!==null?S.sibling=R:m.child=R,M.last=R)}return M.tail!==null?(m=M.tail,M.rendering=m,M.tail=m.sibling,M.renderingStartTime=En(),m.sibling=null,S=Xn.current,_n(Xn,k?S&1|2:S&1),m):(ji(m),null);case 22:case 23:return cI(),k=m.memoizedState!==null,h!==null&&h.memoizedState!==null!==k&&(m.flags|=8192),k&&(m.mode&1)!==0?(us&1073741824)!==0&&(ji(m),m.subtreeFlags&6&&(m.flags|=8192)):ji(m),null;case 24:return null;case 25:return null}throw Error(n(156,m.tag))}function Zie(h,m){switch(vk(m),m.tag){case 1:return jo(m.type)&&Wv(),h=m.flags,h&65536?(m.flags=h&-65537|128,m):null;case 3:return rp(),On(Do),On(Oi),Mk(),h=m.flags,(h&65536)!==0&&(h&128)===0?(m.flags=h&-65537|128,m):null;case 5:return Ek(m),null;case 13:if(On(Xn),h=m.memoizedState,h!==null&&h.dehydrated!==null){if(m.alternate===null)throw Error(n(340));Qh()}return h=m.flags,h&65536?(m.flags=h&-65537|128,m):null;case 19:return On(Xn),null;case 4:return rp(),null;case 10:return Ik(m.type._context),null;case 22:case 23:return cI(),null;case 24:return null;default:return null}}var ux=!1,Ri=!1,Jie=typeof WeakSet=="function"?WeakSet:Set,qe=null;function op(h,m){var S=h.ref;if(S!==null)if(typeof S=="function")try{S(null)}catch(k){or(h,m,k)}else S.current=null}function Zk(h,m,S){try{S()}catch(k){or(h,m,k)}}var i$=!1;function Qie(h,m){if(ck=te,h=$j(),tk(h)){if("selectionStart"in h)var S={start:h.selectionStart,end:h.selectionEnd};else e:{S=(S=h.ownerDocument)&&S.defaultView||window;var k=S.getSelection&&S.getSelection();if(k&&k.rangeCount!==0){S=k.anchorNode;var P=k.anchorOffset,M=k.focusNode;k=k.focusOffset;try{S.nodeType,M.nodeType}catch{S=null;break e}var R=0,K=-1,Z=-1,ue=0,_e=0,Ee=h,we=null;t:for(;;){for(var Ue;Ee!==S||P!==0&&Ee.nodeType!==3||(K=R+P),Ee!==M||k!==0&&Ee.nodeType!==3||(Z=R+k),Ee.nodeType===3&&(R+=Ee.nodeValue.length),(Ue=Ee.firstChild)!==null;)we=Ee,Ee=Ue;for(;;){if(Ee===h)break t;if(we===S&&++ue===P&&(K=R),we===M&&++_e===k&&(Z=R),(Ue=Ee.nextSibling)!==null)break;Ee=we,we=Ee.parentNode}Ee=Ue}S=K===-1||Z===-1?null:{start:K,end:Z}}else S=null}S=S||{start:0,end:0}}else S=null;for(uk={focusedElem:h,selectionRange:S},te=!1,qe=m;qe!==null;)if(m=qe,h=m.child,(m.subtreeFlags&1028)!==0&&h!==null)h.return=m,qe=h;else for(;qe!==null;){m=qe;try{var Xe=m.alternate;if((m.flags&1024)!==0)switch(m.tag){case 0:case 11:case 15:break;case 1:if(Xe!==null){var Je=Xe.memoizedProps,Sr=Xe.memoizedState,le=m.stateNode,Q=le.getSnapshotBeforeUpdate(m.elementType===m.type?Je:Ta(m.type,Je),Sr);le.__reactInternalSnapshotBeforeUpdate=Q}break;case 3:var ce=m.stateNode.containerInfo;ce.nodeType===1?ce.textContent="":ce.nodeType===9&&ce.documentElement&&ce.removeChild(ce.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(je){or(m,m.return,je)}if(h=m.sibling,h!==null){h.return=m.return,qe=h;break}qe=m.return}return Xe=i$,i$=!1,Xe}function Pg(h,m,S){var k=m.updateQueue;if(k=k!==null?k.lastEffect:null,k!==null){var P=k=k.next;do{if((P.tag&h)===h){var M=P.destroy;P.destroy=void 0,M!==void 0&&Zk(m,S,M)}P=P.next}while(P!==k)}}function dx(h,m){if(m=m.updateQueue,m=m!==null?m.lastEffect:null,m!==null){var S=m=m.next;do{if((S.tag&h)===h){var k=S.create;S.destroy=k()}S=S.next}while(S!==m)}}function Jk(h){var m=h.ref;if(m!==null){var S=h.stateNode;switch(h.tag){case 5:h=S;break;default:h=S}typeof m=="function"?m(h):m.current=h}}function o$(h){var m=h.alternate;m!==null&&(h.alternate=null,o$(m)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(m=h.stateNode,m!==null&&(delete m[tl],delete m[mg],delete m[fk],delete m[Rie],delete m[$ie])),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}function s$(h){return h.tag===5||h.tag===3||h.tag===4}function a$(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||s$(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==18;){if(h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function Qk(h,m,S){var k=h.tag;if(k===5||k===6)h=h.stateNode,m?S.nodeType===8?S.parentNode.insertBefore(h,m):S.insertBefore(h,m):(S.nodeType===8?(m=S.parentNode,m.insertBefore(h,S)):(m=S,m.appendChild(h)),S=S._reactRootContainer,S!=null||m.onclick!==null||(m.onclick=Uv));else if(k!==4&&(h=h.child,h!==null))for(Qk(h,m,S),h=h.sibling;h!==null;)Qk(h,m,S),h=h.sibling}function eI(h,m,S){var k=h.tag;if(k===5||k===6)h=h.stateNode,m?S.insertBefore(h,m):S.appendChild(h);else if(k!==4&&(h=h.child,h!==null))for(eI(h,m,S),h=h.sibling;h!==null;)eI(h,m,S),h=h.sibling}var ui=null,Ea=!1;function Kc(h,m,S){for(S=S.child;S!==null;)l$(h,m,S),S=S.sibling}function l$(h,m,S){if(Mo&&typeof Mo.onCommitFiberUnmount=="function")try{Mo.onCommitFiberUnmount(jc,S)}catch{}switch(S.tag){case 5:Ri||op(S,m);case 6:var k=ui,P=Ea;ui=null,Kc(h,m,S),ui=k,Ea=P,ui!==null&&(Ea?(h=ui,S=S.stateNode,h.nodeType===8?h.parentNode.removeChild(S):h.removeChild(S)):ui.removeChild(S.stateNode));break;case 18:ui!==null&&(Ea?(h=ui,S=S.stateNode,h.nodeType===8?pk(h.parentNode,S):h.nodeType===1&&pk(h,S),oo(h)):pk(ui,S.stateNode));break;case 4:k=ui,P=Ea,ui=S.stateNode.containerInfo,Ea=!0,Kc(h,m,S),ui=k,Ea=P;break;case 0:case 11:case 14:case 15:if(!Ri&&(k=S.updateQueue,k!==null&&(k=k.lastEffect,k!==null))){P=k=k.next;do{var M=P,R=M.destroy;M=M.tag,R!==void 0&&((M&2)!==0||(M&4)!==0)&&Zk(S,m,R),P=P.next}while(P!==k)}Kc(h,m,S);break;case 1:if(!Ri&&(op(S,m),k=S.stateNode,typeof k.componentWillUnmount=="function"))try{k.props=S.memoizedProps,k.state=S.memoizedState,k.componentWillUnmount()}catch(K){or(S,m,K)}Kc(h,m,S);break;case 21:Kc(h,m,S);break;case 22:S.mode&1?(Ri=(k=Ri)||S.memoizedState!==null,Kc(h,m,S),Ri=k):Kc(h,m,S);break;default:Kc(h,m,S)}}function c$(h){var m=h.updateQueue;if(m!==null){h.updateQueue=null;var S=h.stateNode;S===null&&(S=h.stateNode=new Jie),m.forEach(function(k){var P=loe.bind(null,h,k);S.has(k)||(S.add(k),k.then(P,P))})}}function Aa(h,m){var S=m.deletions;if(S!==null)for(var k=0;k<S.length;k++){var P=S[k];try{var M=h,R=m,K=R;e:for(;K!==null;){switch(K.tag){case 5:ui=K.stateNode,Ea=!1;break e;case 3:ui=K.stateNode.containerInfo,Ea=!0;break e;case 4:ui=K.stateNode.containerInfo,Ea=!0;break e}K=K.return}if(ui===null)throw Error(n(160));l$(M,R,P),ui=null,Ea=!1;var Z=P.alternate;Z!==null&&(Z.return=null),P.return=null}catch(ue){or(P,m,ue)}}if(m.subtreeFlags&12854)for(m=m.child;m!==null;)u$(m,h),m=m.sibling}function u$(h,m){var S=h.alternate,k=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:if(Aa(m,h),il(h),k&4){try{Pg(3,h,h.return),dx(3,h)}catch(Je){or(h,h.return,Je)}try{Pg(5,h,h.return)}catch(Je){or(h,h.return,Je)}}break;case 1:Aa(m,h),il(h),k&512&&S!==null&&op(S,S.return);break;case 5:if(Aa(m,h),il(h),k&512&&S!==null&&op(S,S.return),h.flags&32){var P=h.stateNode;try{oe(P,"")}catch(Je){or(h,h.return,Je)}}if(k&4&&(P=h.stateNode,P!=null)){var M=h.memoizedProps,R=S!==null?S.memoizedProps:M,K=h.type,Z=h.updateQueue;if(h.updateQueue=null,Z!==null)try{K==="input"&&M.type==="radio"&&M.name!=null&&Gn(P,M),Bn(K,R);var ue=Bn(K,M);for(R=0;R<Z.length;R+=2){var _e=Z[R],Ee=Z[R+1];_e==="style"?zn(P,Ee):_e==="dangerouslySetInnerHTML"?vt(P,Ee):_e==="children"?oe(P,Ee):_(P,_e,Ee,ue)}switch(K){case"input":Ln(P,M);break;case"textarea":va(P,M);break;case"select":var we=P._wrapperState.wasMultiple;P._wrapperState.wasMultiple=!!M.multiple;var Ue=M.value;Ue!=null?gr(P,!!M.multiple,Ue,!1):we!==!!M.multiple&&(M.defaultValue!=null?gr(P,!!M.multiple,M.defaultValue,!0):gr(P,!!M.multiple,M.multiple?[]:"",!1))}P[mg]=M}catch(Je){or(h,h.return,Je)}}break;case 6:if(Aa(m,h),il(h),k&4){if(h.stateNode===null)throw Error(n(162));P=h.stateNode,M=h.memoizedProps;try{P.nodeValue=M}catch(Je){or(h,h.return,Je)}}break;case 3:if(Aa(m,h),il(h),k&4&&S!==null&&S.memoizedState.isDehydrated)try{oo(m.containerInfo)}catch(Je){or(h,h.return,Je)}break;case 4:Aa(m,h),il(h);break;case 13:Aa(m,h),il(h),P=h.child,P.flags&8192&&(M=P.memoizedState!==null,P.stateNode.isHidden=M,!M||P.alternate!==null&&P.alternate.memoizedState!==null||(rI=En())),k&4&&c$(h);break;case 22:if(_e=S!==null&&S.memoizedState!==null,h.mode&1?(Ri=(ue=Ri)||_e,Aa(m,h),Ri=ue):Aa(m,h),il(h),k&8192){if(ue=h.memoizedState!==null,(h.stateNode.isHidden=ue)&&!_e&&(h.mode&1)!==0)for(qe=h,_e=h.child;_e!==null;){for(Ee=qe=_e;qe!==null;){switch(we=qe,Ue=we.child,we.tag){case 0:case 11:case 14:case 15:Pg(4,we,we.return);break;case 1:op(we,we.return);var Xe=we.stateNode;if(typeof Xe.componentWillUnmount=="function"){k=we,S=we.return;try{m=k,Xe.props=m.memoizedProps,Xe.state=m.memoizedState,Xe.componentWillUnmount()}catch(Je){or(k,S,Je)}}break;case 5:op(we,we.return);break;case 22:if(we.memoizedState!==null){p$(Ee);continue}}Ue!==null?(Ue.return=we,qe=Ue):p$(Ee)}_e=_e.sibling}e:for(_e=null,Ee=h;;){if(Ee.tag===5){if(_e===null){_e=Ee;try{P=Ee.stateNode,ue?(M=P.style,typeof M.setProperty=="function"?M.setProperty("display","none","important"):M.display="none"):(K=Ee.stateNode,Z=Ee.memoizedProps.style,R=Z!=null&&Z.hasOwnProperty("display")?Z.display:null,K.style.display=Pt("display",R))}catch(Je){or(h,h.return,Je)}}}else if(Ee.tag===6){if(_e===null)try{Ee.stateNode.nodeValue=ue?"":Ee.memoizedProps}catch(Je){or(h,h.return,Je)}}else if((Ee.tag!==22&&Ee.tag!==23||Ee.memoizedState===null||Ee===h)&&Ee.child!==null){Ee.child.return=Ee,Ee=Ee.child;continue}if(Ee===h)break e;for(;Ee.sibling===null;){if(Ee.return===null||Ee.return===h)break e;_e===Ee&&(_e=null),Ee=Ee.return}_e===Ee&&(_e=null),Ee.sibling.return=Ee.return,Ee=Ee.sibling}}break;case 19:Aa(m,h),il(h),k&4&&c$(h);break;case 21:break;default:Aa(m,h),il(h)}}function il(h){var m=h.flags;if(m&2){try{e:{for(var S=h.return;S!==null;){if(s$(S)){var k=S;break e}S=S.return}throw Error(n(160))}switch(k.tag){case 5:var P=k.stateNode;k.flags&32&&(oe(P,""),k.flags&=-33);var M=a$(h);eI(h,M,P);break;case 3:case 4:var R=k.stateNode.containerInfo,K=a$(h);Qk(h,K,R);break;default:throw Error(n(161))}}catch(Z){or(h,h.return,Z)}h.flags&=-3}m&4096&&(h.flags&=-4097)}function eoe(h,m,S){qe=h,d$(h)}function d$(h,m,S){for(var k=(h.mode&1)!==0;qe!==null;){var P=qe,M=P.child;if(P.tag===22&&k){var R=P.memoizedState!==null||ux;if(!R){var K=P.alternate,Z=K!==null&&K.memoizedState!==null||Ri;K=ux;var ue=Ri;if(ux=R,(Ri=Z)&&!ue)for(qe=P;qe!==null;)R=qe,Z=R.child,R.tag===22&&R.memoizedState!==null?f$(P):Z!==null?(Z.return=R,qe=Z):f$(P);for(;M!==null;)qe=M,d$(M),M=M.sibling;qe=P,ux=K,Ri=ue}h$(h)}else(P.subtreeFlags&8772)!==0&&M!==null?(M.return=P,qe=M):h$(h)}}function h$(h){for(;qe!==null;){var m=qe;if((m.flags&8772)!==0){var S=m.alternate;try{if((m.flags&8772)!==0)switch(m.tag){case 0:case 11:case 15:Ri||dx(5,m);break;case 1:var k=m.stateNode;if(m.flags&4&&!Ri)if(S===null)k.componentDidMount();else{var P=m.elementType===m.type?S.memoizedProps:Ta(m.type,S.memoizedProps);k.componentDidUpdate(P,S.memoizedState,k.__reactInternalSnapshotBeforeUpdate)}var M=m.updateQueue;M!==null&&pR(m,M,k);break;case 3:var R=m.updateQueue;if(R!==null){if(S=null,m.child!==null)switch(m.child.tag){case 5:S=m.child.stateNode;break;case 1:S=m.child.stateNode}pR(m,R,S)}break;case 5:var K=m.stateNode;if(S===null&&m.flags&4){S=K;var Z=m.memoizedProps;switch(m.type){case"button":case"input":case"select":case"textarea":Z.autoFocus&&S.focus();break;case"img":Z.src&&(S.src=Z.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(m.memoizedState===null){var ue=m.alternate;if(ue!==null){var _e=ue.memoizedState;if(_e!==null){var Ee=_e.dehydrated;Ee!==null&&oo(Ee)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}Ri||m.flags&512&&Jk(m)}catch(we){or(m,m.return,we)}}if(m===h){qe=null;break}if(S=m.sibling,S!==null){S.return=m.return,qe=S;break}qe=m.return}}function p$(h){for(;qe!==null;){var m=qe;if(m===h){qe=null;break}var S=m.sibling;if(S!==null){S.return=m.return,qe=S;break}qe=m.return}}function f$(h){for(;qe!==null;){var m=qe;try{switch(m.tag){case 0:case 11:case 15:var S=m.return;try{dx(4,m)}catch(Z){or(m,S,Z)}break;case 1:var k=m.stateNode;if(typeof k.componentDidMount=="function"){var P=m.return;try{k.componentDidMount()}catch(Z){or(m,P,Z)}}var M=m.return;try{Jk(m)}catch(Z){or(m,M,Z)}break;case 5:var R=m.return;try{Jk(m)}catch(Z){or(m,R,Z)}}}catch(Z){or(m,m.return,Z)}if(m===h){qe=null;break}var K=m.sibling;if(K!==null){K.return=m.return,qe=K;break}qe=m.return}}var toe=Math.ceil,hx=C.ReactCurrentDispatcher,tI=C.ReactCurrentOwner,Vs=C.ReactCurrentBatchConfig,Xt=0,Kr=null,Er=null,di=0,us=0,sp=Bc(0),Lr=0,Tg=null,xd=0,px=0,nI=0,Eg=null,$o=null,rI=0,ap=1/0,Zl=null,fx=!1,iI=null,qc=null,gx=!1,Gc=null,mx=0,Ag=0,oI=null,yx=-1,vx=0;function lo(){return(Xt&6)!==0?En():yx!==-1?yx:yx=En()}function Yc(h){return(h.mode&1)===0?1:(Xt&2)!==0&&di!==0?di&-di:Lie.transition!==null?(vx===0&&(vx=cd()),vx):(h=Ut,h!==0||(h=window.event,h=h===void 0?16:vr(h.type)),h)}function Ma(h,m,S,k){if(50<Ag)throw Ag=0,oI=null,Error(n(185));Ia(h,S,k),((Xt&2)===0||h!==Kr)&&(h===Kr&&((Xt&2)===0&&(px|=S),Lr===4&&Xc(h,di)),No(h,k),S===1&&Xt===0&&(m.mode&1)===0&&(ap=En()+500,Kv&&Hc()))}function No(h,m){var S=h.callbackNode;sg(h,m);var k=Ul(h,h===Kr?di:0);if(k===0)S!==null&&Ns(S),h.callbackNode=null,h.callbackPriority=0;else if(m=k&-k,h.callbackPriority!==m){if(S!=null&&Ns(S),m===1)h.tag===0?Nie(m$.bind(null,h)):tR(m$.bind(null,h)),Die(function(){(Xt&6)===0&&Hc()}),S=null;else{switch(zs(k)){case 1:S=ld;break;case 4:S=Ls;break;case 16:S=Dc;break;case 536870912:S=is;break;default:S=Dc}S=I$(S,g$.bind(null,h))}h.callbackPriority=m,h.callbackNode=S}}function g$(h,m){if(yx=-1,vx=0,(Xt&6)!==0)throw Error(n(327));var S=h.callbackNode;if(lp()&&h.callbackNode!==S)return null;var k=Ul(h,h===Kr?di:0);if(k===0)return null;if((k&30)!==0||(k&h.expiredLanes)!==0||m)m=xx(h,k);else{m=k;var P=Xt;Xt|=2;var M=v$();(Kr!==h||di!==m)&&(Zl=null,ap=En()+500,bd(h,m));do try{ioe();break}catch(K){y$(h,K)}while(!0);kk(),hx.current=M,Xt=P,Er!==null?m=0:(Kr=null,di=0,m=Lr)}if(m!==0){if(m===2&&(P=as(h),P!==0&&(k=P,m=sI(h,P))),m===1)throw S=Tg,bd(h,0),Xc(h,k),No(h,En()),S;if(m===6)Xc(h,k);else{if(P=h.current.alternate,(k&30)===0&&!noe(P)&&(m=xx(h,k),m===2&&(M=as(h),M!==0&&(k=M,m=sI(h,M))),m===1))throw S=Tg,bd(h,0),Xc(h,k),No(h,En()),S;switch(h.finishedWork=P,h.finishedLanes=k,m){case 0:case 1:throw Error(n(345));case 2:wd(h,$o,Zl);break;case 3:if(Xc(h,k),(k&130023424)===k&&(m=rI+500-En(),10<m)){if(Ul(h,0)!==0)break;if(P=h.suspendedLanes,(P&k)!==k){lo(),h.pingedLanes|=h.suspendedLanes&P;break}h.timeoutHandle=hk(wd.bind(null,h,$o,Zl),m);break}wd(h,$o,Zl);break;case 4:if(Xc(h,k),(k&4194240)===k)break;for(m=h.eventTimes,P=-1;0<k;){var R=31-Ei(k);M=1<<R,R=m[R],R>P&&(P=R),k&=~M}if(k=P,k=En()-k,k=(120>k?120:480>k?480:1080>k?1080:1920>k?1920:3e3>k?3e3:4320>k?4320:1960*toe(k/1960))-k,10<k){h.timeoutHandle=hk(wd.bind(null,h,$o,Zl),k);break}wd(h,$o,Zl);break;case 5:wd(h,$o,Zl);break;default:throw Error(n(329))}}}return No(h,En()),h.callbackNode===S?g$.bind(null,h):null}function sI(h,m){var S=Eg;return h.current.memoizedState.isDehydrated&&(bd(h,m).flags|=256),h=xx(h,m),h!==2&&(m=$o,$o=S,m!==null&&aI(m)),h}function aI(h){$o===null?$o=h:$o.push.apply($o,h)}function noe(h){for(var m=h;;){if(m.flags&16384){var S=m.updateQueue;if(S!==null&&(S=S.stores,S!==null))for(var k=0;k<S.length;k++){var P=S[k],M=P.getSnapshot;P=P.value;try{if(!Ca(M(),P))return!1}catch{return!1}}}if(S=m.child,m.subtreeFlags&16384&&S!==null)S.return=m,m=S;else{if(m===h)break;for(;m.sibling===null;){if(m.return===null||m.return===h)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function Xc(h,m){for(m&=~nI,m&=~px,h.suspendedLanes|=m,h.pingedLanes&=~m,h=h.expirationTimes;0<m;){var S=31-Ei(m),k=1<<S;h[S]=-1,m&=~k}}function m$(h){if((Xt&6)!==0)throw Error(n(327));lp();var m=Ul(h,0);if((m&1)===0)return No(h,En()),null;var S=xx(h,m);if(h.tag!==0&&S===2){var k=as(h);k!==0&&(m=k,S=sI(h,k))}if(S===1)throw S=Tg,bd(h,0),Xc(h,m),No(h,En()),S;if(S===6)throw Error(n(345));return h.finishedWork=h.current.alternate,h.finishedLanes=m,wd(h,$o,Zl),No(h,En()),null}function lI(h,m){var S=Xt;Xt|=1;try{return h(m)}finally{Xt=S,Xt===0&&(ap=En()+500,Kv&&Hc())}}function Sd(h){Gc!==null&&Gc.tag===0&&(Xt&6)===0&&lp();var m=Xt;Xt|=1;var S=Vs.transition,k=Ut;try{if(Vs.transition=null,Ut=1,h)return h()}finally{Ut=k,Vs.transition=S,Xt=m,(Xt&6)===0&&Hc()}}function cI(){us=sp.current,On(sp)}function bd(h,m){h.finishedWork=null,h.finishedLanes=0;var S=h.timeoutHandle;if(S!==-1&&(h.timeoutHandle=-1,Oie(S)),Er!==null)for(S=Er.return;S!==null;){var k=S;switch(vk(k),k.tag){case 1:k=k.type.childContextTypes,k!=null&&Wv();break;case 3:rp(),On(Do),On(Oi),Mk();break;case 5:Ek(k);break;case 4:rp();break;case 13:On(Xn);break;case 19:On(Xn);break;case 10:Ik(k.type._context);break;case 22:case 23:cI()}S=S.return}if(Kr=h,Er=h=Zc(h.current,null),di=us=m,Lr=0,Tg=null,nI=px=xd=0,$o=Eg=null,md!==null){for(m=0;m<md.length;m++)if(S=md[m],k=S.interleaved,k!==null){S.interleaved=null;var P=k.next,M=S.pending;if(M!==null){var R=M.next;M.next=P,k.next=R}S.pending=k}md=null}return h}function y$(h,m){do{var S=Er;try{if(kk(),nx.current=sx,rx){for(var k=Zn.memoizedState;k!==null;){var P=k.queue;P!==null&&(P.pending=null),k=k.next}rx=!1}if(vd=0,Vr=Nr=Zn=null,wg=!1,kg=0,tI.current=null,S===null||S.return===null){Lr=1,Tg=m,Er=null;break}e:{var M=h,R=S.return,K=S,Z=m;if(m=di,K.flags|=32768,Z!==null&&typeof Z=="object"&&typeof Z.then=="function"){var ue=Z,_e=K,Ee=_e.tag;if((_e.mode&1)===0&&(Ee===0||Ee===11||Ee===15)){var we=_e.alternate;we?(_e.updateQueue=we.updateQueue,_e.memoizedState=we.memoizedState,_e.lanes=we.lanes):(_e.updateQueue=null,_e.memoizedState=null)}var Ue=UR(R);if(Ue!==null){Ue.flags&=-257,HR(Ue,R,K,M,m),Ue.mode&1&&BR(M,ue,m),m=Ue,Z=ue;var Xe=m.updateQueue;if(Xe===null){var Je=new Set;Je.add(Z),m.updateQueue=Je}else Xe.add(Z);break e}else{if((m&1)===0){BR(M,ue,m),uI();break e}Z=Error(n(426))}}else if(Un&&K.mode&1){var Sr=UR(R);if(Sr!==null){(Sr.flags&65536)===0&&(Sr.flags|=256),HR(Sr,R,K,M,m),bk(ip(Z,K));break e}}M=Z=ip(Z,K),Lr!==4&&(Lr=2),Eg===null?Eg=[M]:Eg.push(M),M=R;do{switch(M.tag){case 3:M.flags|=65536,m&=-m,M.lanes|=m;var le=zR(M,Z,m);hR(M,le);break e;case 1:K=Z;var Q=M.type,ce=M.stateNode;if((M.flags&128)===0&&(typeof Q.getDerivedStateFromError=="function"||ce!==null&&typeof ce.componentDidCatch=="function"&&(qc===null||!qc.has(ce)))){M.flags|=65536,m&=-m,M.lanes|=m;var je=FR(M,K,m);hR(M,je);break e}}M=M.return}while(M!==null)}S$(S)}catch(et){m=et,Er===S&&S!==null&&(Er=S=S.return);continue}break}while(!0)}function v$(){var h=hx.current;return hx.current=sx,h===null?sx:h}function uI(){(Lr===0||Lr===3||Lr===2)&&(Lr=4),Kr===null||(xd&268435455)===0&&(px&268435455)===0||Xc(Kr,di)}function xx(h,m){var S=Xt;Xt|=2;var k=v$();(Kr!==h||di!==m)&&(Zl=null,bd(h,m));do try{roe();break}catch(P){y$(h,P)}while(!0);if(kk(),Xt=S,hx.current=k,Er!==null)throw Error(n(261));return Kr=null,di=0,Lr}function roe(){for(;Er!==null;)x$(Er)}function ioe(){for(;Er!==null&&!Qf();)x$(Er)}function x$(h){var m=k$(h.alternate,h,us);h.memoizedProps=h.pendingProps,m===null?S$(h):Er=m,tI.current=null}function S$(h){var m=h;do{var S=m.alternate;if(h=m.return,(m.flags&32768)===0){if(S=Xie(S,m,us),S!==null){Er=S;return}}else{if(S=Zie(S,m),S!==null){S.flags&=32767,Er=S;return}if(h!==null)h.flags|=32768,h.subtreeFlags=0,h.deletions=null;else{Lr=6,Er=null;return}}if(m=m.sibling,m!==null){Er=m;return}Er=m=h}while(m!==null);Lr===0&&(Lr=5)}function wd(h,m,S){var k=Ut,P=Vs.transition;try{Vs.transition=null,Ut=1,ooe(h,m,S,k)}finally{Vs.transition=P,Ut=k}return null}function ooe(h,m,S,k){do lp();while(Gc!==null);if((Xt&6)!==0)throw Error(n(327));S=h.finishedWork;var P=h.finishedLanes;if(S===null)return null;if(h.finishedWork=null,h.finishedLanes=0,S===h.current)throw Error(n(177));h.callbackNode=null,h.callbackPriority=0;var M=S.lanes|S.childLanes;if(Fh(h,M),h===Kr&&(Er=Kr=null,di=0),(S.subtreeFlags&2064)===0&&(S.flags&2064)===0||gx||(gx=!0,I$(Dc,function(){return lp(),null})),M=(S.flags&15990)!==0,(S.subtreeFlags&15990)!==0||M){M=Vs.transition,Vs.transition=null;var R=Ut;Ut=1;var K=Xt;Xt|=4,tI.current=null,Qie(h,S),u$(S,h),_ie(uk),te=!!ck,uk=ck=null,h.current=S,eoe(S),eg(),Xt=K,Ut=R,Vs.transition=M}else h.current=S;if(gx&&(gx=!1,Gc=h,mx=P),M=h.pendingLanes,M===0&&(qc=null),ng(S.stateNode),No(h,En()),m!==null)for(k=h.onRecoverableError,S=0;S<m.length;S++)P=m[S],k(P.value,{componentStack:P.stack,digest:P.digest});if(fx)throw fx=!1,h=iI,iI=null,h;return(mx&1)!==0&&h.tag!==0&&lp(),M=h.pendingLanes,(M&1)!==0?h===oI?Ag++:(Ag=0,oI=h):Ag=0,Hc(),null}function lp(){if(Gc!==null){var h=zs(mx),m=Vs.transition,S=Ut;try{if(Vs.transition=null,Ut=16>h?16:h,Gc===null)var k=!1;else{if(h=Gc,Gc=null,mx=0,(Xt&6)!==0)throw Error(n(331));var P=Xt;for(Xt|=4,qe=h.current;qe!==null;){var M=qe,R=M.child;if((qe.flags&16)!==0){var K=M.deletions;if(K!==null){for(var Z=0;Z<K.length;Z++){var ue=K[Z];for(qe=ue;qe!==null;){var _e=qe;switch(_e.tag){case 0:case 11:case 15:Pg(8,_e,M)}var Ee=_e.child;if(Ee!==null)Ee.return=_e,qe=Ee;else for(;qe!==null;){_e=qe;var we=_e.sibling,Ue=_e.return;if(o$(_e),_e===ue){qe=null;break}if(we!==null){we.return=Ue,qe=we;break}qe=Ue}}}var Xe=M.alternate;if(Xe!==null){var Je=Xe.child;if(Je!==null){Xe.child=null;do{var Sr=Je.sibling;Je.sibling=null,Je=Sr}while(Je!==null)}}qe=M}}if((M.subtreeFlags&2064)!==0&&R!==null)R.return=M,qe=R;else e:for(;qe!==null;){if(M=qe,(M.flags&2048)!==0)switch(M.tag){case 0:case 11:case 15:Pg(9,M,M.return)}var le=M.sibling;if(le!==null){le.return=M.return,qe=le;break e}qe=M.return}}var Q=h.current;for(qe=Q;qe!==null;){R=qe;var ce=R.child;if((R.subtreeFlags&2064)!==0&&ce!==null)ce.return=R,qe=ce;else e:for(R=Q;qe!==null;){if(K=qe,(K.flags&2048)!==0)try{switch(K.tag){case 0:case 11:case 15:dx(9,K)}}catch(et){or(K,K.return,et)}if(K===R){qe=null;break e}var je=K.sibling;if(je!==null){je.return=K.return,qe=je;break e}qe=K.return}}if(Xt=P,Hc(),Mo&&typeof Mo.onPostCommitFiberRoot=="function")try{Mo.onPostCommitFiberRoot(jc,h)}catch{}k=!0}return k}finally{Ut=S,Vs.transition=m}}return!1}function b$(h,m,S){m=ip(S,m),m=zR(h,m,1),h=Vc(h,m,1),m=lo(),h!==null&&(Ia(h,1,m),No(h,m))}function or(h,m,S){if(h.tag===3)b$(h,h,S);else for(;m!==null;){if(m.tag===3){b$(m,h,S);break}else if(m.tag===1){var k=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof k.componentDidCatch=="function"&&(qc===null||!qc.has(k))){h=ip(S,h),h=FR(m,h,1),m=Vc(m,h,1),h=lo(),m!==null&&(Ia(m,1,h),No(m,h));break}}m=m.return}}function soe(h,m,S){var k=h.pingCache;k!==null&&k.delete(m),m=lo(),h.pingedLanes|=h.suspendedLanes&S,Kr===h&&(di&S)===S&&(Lr===4||Lr===3&&(di&130023424)===di&&500>En()-rI?bd(h,0):nI|=S),No(h,m)}function w$(h,m){m===0&&((h.mode&1)===0?m=1:(m=Rr,Rr<<=1,(Rr&130023424)===0&&(Rr=4194304)));var S=lo();h=Gl(h,m),h!==null&&(Ia(h,m,S),No(h,S))}function aoe(h){var m=h.memoizedState,S=0;m!==null&&(S=m.retryLane),w$(h,S)}function loe(h,m){var S=0;switch(h.tag){case 13:var k=h.stateNode,P=h.memoizedState;P!==null&&(S=P.retryLane);break;case 19:k=h.stateNode;break;default:throw Error(n(314))}k!==null&&k.delete(m),w$(h,S)}var k$;k$=function(h,m,S){if(h!==null)if(h.memoizedProps!==m.pendingProps||Do.current)Ro=!0;else{if((h.lanes&S)===0&&(m.flags&128)===0)return Ro=!1,Yie(h,m,S);Ro=(h.flags&131072)!==0}else Ro=!1,Un&&(m.flags&1048576)!==0&&nR(m,Gv,m.index);switch(m.lanes=0,m.tag){case 2:var k=m.type;cx(h,m),h=m.pendingProps;var P=Xh(m,Oi.current);np(m,S),P=jk(null,m,k,h,P,S);var M=Rk();return m.flags|=1,typeof P=="object"&&P!==null&&typeof P.render=="function"&&P.$$typeof===void 0?(m.tag=1,m.memoizedState=null,m.updateQueue=null,jo(k)?(M=!0,Vv(m)):M=!1,m.memoizedState=P.state!==null&&P.state!==void 0?P.state:null,Pk(m),P.updater=ax,m.stateNode=P,P._reactInternals=m,Bk(m,k,h,S),m=Vk(null,m,k,!0,M,S)):(m.tag=0,Un&&M&&yk(m),ao(null,m,P,S),m=m.child),m;case 16:k=m.elementType;e:{switch(cx(h,m),h=m.pendingProps,P=k._init,k=P(k._payload),m.type=k,P=m.tag=uoe(k),h=Ta(k,h),P){case 0:m=Wk(null,m,k,h,S);break e;case 1:m=YR(null,m,k,h,S);break e;case 11:m=WR(null,m,k,h,S);break e;case 14:m=VR(null,m,k,Ta(k.type,h),S);break e}throw Error(n(306,k,""))}return m;case 0:return k=m.type,P=m.pendingProps,P=m.elementType===k?P:Ta(k,P),Wk(h,m,k,P,S);case 1:return k=m.type,P=m.pendingProps,P=m.elementType===k?P:Ta(k,P),YR(h,m,k,P,S);case 3:e:{if(XR(m),h===null)throw Error(n(387));k=m.pendingProps,M=m.memoizedState,P=M.element,dR(h,m),ex(m,k,null,S);var R=m.memoizedState;if(k=R.element,M.isDehydrated)if(M={element:k,isDehydrated:!1,cache:R.cache,pendingSuspenseBoundaries:R.pendingSuspenseBoundaries,transitions:R.transitions},m.updateQueue.baseState=M,m.memoizedState=M,m.flags&256){P=ip(Error(n(423)),m),m=ZR(h,m,k,S,P);break e}else if(k!==P){P=ip(Error(n(424)),m),m=ZR(h,m,k,S,P);break e}else for(cs=Fc(m.stateNode.containerInfo.firstChild),ls=m,Un=!0,Pa=null,S=cR(m,null,k,S),m.child=S;S;)S.flags=S.flags&-3|4096,S=S.sibling;else{if(Qh(),k===P){m=Xl(h,m,S);break e}ao(h,m,k,S)}m=m.child}return m;case 5:return fR(m),h===null&&Sk(m),k=m.type,P=m.pendingProps,M=h!==null?h.memoizedProps:null,R=P.children,dk(k,P)?R=null:M!==null&&dk(k,M)&&(m.flags|=32),GR(h,m),ao(h,m,R,S),m.child;case 6:return h===null&&Sk(m),null;case 13:return JR(h,m,S);case 4:return Tk(m,m.stateNode.containerInfo),k=m.pendingProps,h===null?m.child=ep(m,null,k,S):ao(h,m,k,S),m.child;case 11:return k=m.type,P=m.pendingProps,P=m.elementType===k?P:Ta(k,P),WR(h,m,k,P,S);case 7:return ao(h,m,m.pendingProps,S),m.child;case 8:return ao(h,m,m.pendingProps.children,S),m.child;case 12:return ao(h,m,m.pendingProps.children,S),m.child;case 10:e:{if(k=m.type._context,P=m.pendingProps,M=m.memoizedProps,R=P.value,_n(Zv,k._currentValue),k._currentValue=R,M!==null)if(Ca(M.value,R)){if(M.children===P.children&&!Do.current){m=Xl(h,m,S);break e}}else for(M=m.child,M!==null&&(M.return=m);M!==null;){var K=M.dependencies;if(K!==null){R=M.child;for(var Z=K.firstContext;Z!==null;){if(Z.context===k){if(M.tag===1){Z=Yl(-1,S&-S),Z.tag=2;var ue=M.updateQueue;if(ue!==null){ue=ue.shared;var _e=ue.pending;_e===null?Z.next=Z:(Z.next=_e.next,_e.next=Z),ue.pending=Z}}M.lanes|=S,Z=M.alternate,Z!==null&&(Z.lanes|=S),_k(M.return,S,m),K.lanes|=S;break}Z=Z.next}}else if(M.tag===10)R=M.type===m.type?null:M.child;else if(M.tag===18){if(R=M.return,R===null)throw Error(n(341));R.lanes|=S,K=R.alternate,K!==null&&(K.lanes|=S),_k(R,S,m),R=M.sibling}else R=M.child;if(R!==null)R.return=M;else for(R=M;R!==null;){if(R===m){R=null;break}if(M=R.sibling,M!==null){M.return=R.return,R=M;break}R=R.return}M=R}ao(h,m,P.children,S),m=m.child}return m;case 9:return P=m.type,k=m.pendingProps.children,np(m,S),P=Hs(P),k=k(P),m.flags|=1,ao(h,m,k,S),m.child;case 14:return k=m.type,P=Ta(k,m.pendingProps),P=Ta(k.type,P),VR(h,m,k,P,S);case 15:return KR(h,m,m.type,m.pendingProps,S);case 17:return k=m.type,P=m.pendingProps,P=m.elementType===k?P:Ta(k,P),cx(h,m),m.tag=1,jo(k)?(h=!0,Vv(m)):h=!1,np(m,S),NR(m,k,P),Bk(m,k,P,S),Vk(null,m,k,!0,h,S);case 19:return e$(h,m,S);case 22:return qR(h,m,S)}throw Error(n(156,m.tag))};function I$(h,m){return rs(h,m)}function coe(h,m,S,k){this.tag=h,this.key=S,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=k,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ks(h,m,S,k){return new coe(h,m,S,k)}function dI(h){return h=h.prototype,!(!h||!h.isReactComponent)}function uoe(h){if(typeof h=="function")return dI(h)?1:0;if(h!=null){if(h=h.$$typeof,h===F)return 11;if(h===V)return 14}return 2}function Zc(h,m){var S=h.alternate;return S===null?(S=Ks(h.tag,m,h.key,h.mode),S.elementType=h.elementType,S.type=h.type,S.stateNode=h.stateNode,S.alternate=h,h.alternate=S):(S.pendingProps=m,S.type=h.type,S.flags=0,S.subtreeFlags=0,S.deletions=null),S.flags=h.flags&14680064,S.childLanes=h.childLanes,S.lanes=h.lanes,S.child=h.child,S.memoizedProps=h.memoizedProps,S.memoizedState=h.memoizedState,S.updateQueue=h.updateQueue,m=h.dependencies,S.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},S.sibling=h.sibling,S.index=h.index,S.ref=h.ref,S}function Sx(h,m,S,k,P,M){var R=2;if(k=h,typeof h=="function")dI(h)&&(R=1);else if(typeof h=="string")R=5;else e:switch(h){case O:return kd(S.children,P,M,m);case D:R=8,P|=8;break;case B:return h=Ks(12,S,m,P|2),h.elementType=B,h.lanes=M,h;case z:return h=Ks(13,S,m,P),h.elementType=z,h.lanes=M,h;case $:return h=Ks(19,S,m,P),h.elementType=$,h.lanes=M,h;case re:return bx(S,P,M,m);default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case L:R=10;break e;case j:R=9;break e;case F:R=11;break e;case V:R=14;break e;case Y:R=16,k=null;break e}throw Error(n(130,h==null?h:typeof h,""))}return m=Ks(R,S,m,P),m.elementType=h,m.type=k,m.lanes=M,m}function kd(h,m,S,k){return h=Ks(7,h,k,m),h.lanes=S,h}function bx(h,m,S,k){return h=Ks(22,h,k,m),h.elementType=re,h.lanes=S,h.stateNode={isHidden:!1},h}function hI(h,m,S){return h=Ks(6,h,null,m),h.lanes=S,h}function pI(h,m,S){return m=Ks(4,h.children!==null?h.children:[],h.key,m),m.lanes=S,m.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},m}function doe(h,m,S,k,P){this.tag=m,this.containerInfo=h,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Rc(0),this.expirationTimes=Rc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Rc(0),this.identifierPrefix=k,this.onRecoverableError=P,this.mutableSourceEagerHydrationData=null}function fI(h,m,S,k,P,M,R,K,Z){return h=new doe(h,m,S,K,Z),m===1?(m=1,M===!0&&(m|=8)):m=0,M=Ks(3,null,null,m),h.current=M,M.stateNode=h,M.memoizedState={element:k,isDehydrated:S,cache:null,transitions:null,pendingSuspenseBoundaries:null},Pk(M),h}function hoe(h,m,S){var k=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:E,key:k==null?null:""+k,children:h,containerInfo:m,implementation:S}}function _$(h){if(!h)return Uc;h=h._reactInternals;e:{if(wa(h)!==h||h.tag!==1)throw Error(n(170));var m=h;do{switch(m.tag){case 3:m=m.stateNode.context;break e;case 1:if(jo(m.type)){m=m.stateNode.__reactInternalMemoizedMergedChildContext;break e}}m=m.return}while(m!==null);throw Error(n(171))}if(h.tag===1){var S=h.type;if(jo(S))return Qj(h,S,m)}return m}function C$(h,m,S,k,P,M,R,K,Z){return h=fI(S,k,!0,h,P,M,R,K,Z),h.context=_$(null),S=h.current,k=lo(),P=Yc(S),M=Yl(k,P),M.callback=m??null,Vc(S,M,P),h.current.lanes=P,Ia(h,P,k),No(h,k),h}function wx(h,m,S,k){var P=m.current,M=lo(),R=Yc(P);return S=_$(S),m.context===null?m.context=S:m.pendingContext=S,m=Yl(M,R),m.payload={element:h},k=k===void 0?null:k,k!==null&&(m.callback=k),h=Vc(P,m,R),h!==null&&(Ma(h,P,R,M),Qv(h,P,R)),R}function kx(h){if(h=h.current,!h.child)return null;switch(h.child.tag){case 5:return h.child.stateNode;default:return h.child.stateNode}}function P$(h,m){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var S=h.retryLane;h.retryLane=S!==0&&S<m?S:m}}function gI(h,m){P$(h,m),(h=h.alternate)&&P$(h,m)}function poe(){return null}var T$=typeof reportError=="function"?reportError:function(h){console.error(h)};function mI(h){this._internalRoot=h}Ix.prototype.render=mI.prototype.render=function(h){var m=this._internalRoot;if(m===null)throw Error(n(409));wx(h,m,null,null)},Ix.prototype.unmount=mI.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var m=h.containerInfo;Sd(function(){wx(null,h,null,null)}),m[Wl]=null}};function Ix(h){this._internalRoot=h}Ix.prototype.unstable_scheduleHydration=function(h){if(h){var m=Bh();h={blockedOn:null,target:h,priority:m};for(var S=0;S<An.length&&m!==0&&m<An[S].priority;S++);An.splice(S,0,h),S===0&&yr(h)}};function yI(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}function _x(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11&&(h.nodeType!==8||h.nodeValue!==" react-mount-point-unstable "))}function E$(){}function foe(h,m,S,k,P){if(P){if(typeof k=="function"){var M=k;k=function(){var ue=kx(R);M.call(ue)}}var R=C$(m,k,h,0,null,!1,!1,"",E$);return h._reactRootContainer=R,h[Wl]=R.current,fg(h.nodeType===8?h.parentNode:h),Sd(),R}for(;P=h.lastChild;)h.removeChild(P);if(typeof k=="function"){var K=k;k=function(){var ue=kx(Z);K.call(ue)}}var Z=fI(h,0,!1,null,null,!1,!1,"",E$);return h._reactRootContainer=Z,h[Wl]=Z.current,fg(h.nodeType===8?h.parentNode:h),Sd(function(){wx(m,Z,S,k)}),Z}function Cx(h,m,S,k,P){var M=S._reactRootContainer;if(M){var R=M;if(typeof P=="function"){var K=P;P=function(){var Z=kx(R);K.call(Z)}}wx(m,R,h,P)}else R=foe(S,m,h,P,k);return kx(R)}ud=function(h){switch(h.tag){case 3:var m=h.stateNode;if(m.current.memoizedState.isDehydrated){var S=el(m.pendingLanes);S!==0&&($c(m,S|1),No(m,En()),(Xt&6)===0&&(ap=En()+500,Hc()))}break;case 13:Sd(function(){var k=Gl(h,1);if(k!==null){var P=lo();Ma(k,h,1,P)}}),gI(h,1)}},Hl=function(h){if(h.tag===13){var m=Gl(h,134217728);if(m!==null){var S=lo();Ma(m,h,134217728,S)}gI(h,134217728)}},io=function(h){if(h.tag===13){var m=Yc(h),S=Gl(h,m);if(S!==null){var k=lo();Ma(S,h,m,k)}gI(h,m)}},Bh=function(){return Ut},dd=function(h,m){var S=Ut;try{return Ut=h,m()}finally{Ut=S}},ro=function(h,m,S){switch(m){case"input":if(Ln(h,S),m=S.name,S.type==="radio"&&m!=null){for(S=h;S.parentNode;)S=S.parentNode;for(S=S.querySelectorAll("input[name="+JSON.stringify(""+m)+'][type="radio"]'),m=0;m<S.length;m++){var k=S[m];if(k!==h&&k.form===h.form){var P=Hv(k);if(!P)throw Error(n(90));rn(k),Ln(k,P)}}}break;case"textarea":va(h,S);break;case"select":m=S.value,m!=null&&gr(h,!!S.multiple,m,!1)}},To=lI,Mc=Sd;var goe={usingClientEntryPoint:!1,Events:[yg,Gh,Hv,xa,Za,lI]},Mg={findFiberByHostInstance:hd,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},moe={bundleType:Mg.bundleType,version:Mg.version,rendererPackageName:Mg.rendererPackageName,rendererConfig:Mg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:C.ReactCurrentDispatcher,findHostInstanceByFiber:function(h){return h=Nh(h),h===null?null:h.stateNode},findFiberByHostInstance:Mg.findFiberByHostInstance||poe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Px=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Px.isDisabled&&Px.supportsFiber)try{jc=Px.inject(moe),Mo=Px}catch{}}return Lo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=goe,Lo.createPortal=function(h,m){var S=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!yI(m))throw Error(n(200));return hoe(h,m,null,S)},Lo.createRoot=function(h,m){if(!yI(h))throw Error(n(299));var S=!1,k="",P=T$;return m!=null&&(m.unstable_strictMode===!0&&(S=!0),m.identifierPrefix!==void 0&&(k=m.identifierPrefix),m.onRecoverableError!==void 0&&(P=m.onRecoverableError)),m=fI(h,1,!1,null,null,S,!1,k,P),h[Wl]=m.current,fg(h.nodeType===8?h.parentNode:h),new mI(m)},Lo.findDOMNode=function(h){if(h==null)return null;if(h.nodeType===1)return h;var m=h._reactInternals;if(m===void 0)throw typeof h.render=="function"?Error(n(188)):(h=Object.keys(h).join(","),Error(n(268,h)));return h=Nh(m),h=h===null?null:h.stateNode,h},Lo.flushSync=function(h){return Sd(h)},Lo.hydrate=function(h,m,S){if(!_x(m))throw Error(n(200));return Cx(null,h,m,!0,S)},Lo.hydrateRoot=function(h,m,S){if(!yI(h))throw Error(n(405));var k=S!=null&&S.hydratedSources||null,P=!1,M="",R=T$;if(S!=null&&(S.unstable_strictMode===!0&&(P=!0),S.identifierPrefix!==void 0&&(M=S.identifierPrefix),S.onRecoverableError!==void 0&&(R=S.onRecoverableError)),m=C$(m,null,h,1,S??null,P,!1,M,R),h[Wl]=m.current,fg(h),k)for(h=0;h<k.length;h++)S=k[h],P=S._getVersion,P=P(S._source),m.mutableSourceEagerHydrationData==null?m.mutableSourceEagerHydrationData=[S,P]:m.mutableSourceEagerHydrationData.push(S,P);return new Ix(m)},Lo.render=function(h,m,S){if(!_x(m))throw Error(n(200));return Cx(null,h,m,!1,S)},Lo.unmountComponentAtNode=function(h){if(!_x(h))throw Error(n(40));return h._reactRootContainer?(Sd(function(){Cx(null,null,h,!1,function(){h._reactRootContainer=null,h[Wl]=null})}),!0):!1},Lo.unstable_batchedUpdates=lI,Lo.unstable_renderSubtreeIntoContainer=function(h,m,S,k){if(!_x(S))throw Error(n(200));if(h==null||h._reactInternals===void 0)throw Error(n(38));return Cx(h,m,S,!1,k)},Lo.version="18.3.1-next-f1338f8080-20240426",Lo}var N$;function JB(){if(N$)return SI.exports;N$=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),SI.exports=Ioe(),SI.exports}var L$;function _oe(){if(L$)return Tx;L$=1;var t=JB();return Tx.createRoot=t.createRoot,Tx.hydrateRoot=t.hydrateRoot,Tx}var QB=_oe();const Coe=ua(QB),kI="__TLDRAW_LIBRARY_VERSIONS__";function Poe(){if(globalThis[kI])return globalThis[kI];const t={versions:[],didWarn:!1,scheduledNotice:null};return Object.defineProperty(globalThis,kI,{value:t,writable:!1,configurable:!1,enumerable:!1}),t}function Fu(t,e,n){if(!t||!e||!n)throw new Error("Missing name/version/module system in built version of tldraw library");const r=Poe();if(r.versions.push({name:t,version:e,modules:n}),!r.scheduledNotice)try{r.scheduledNotice=setTimeout(()=>{r.scheduledNotice=null,z$(r)},100)}catch{z$(r)}}function z$(t){if(!t.versions.length||t.didWarn)return;const e=t.versions.sort((a,l)=>F$(a.version,l.version)),n=e[e.length-1].version,r=new Set,i=new Map;for(const a of e){if(i.has(a.name)){r.delete(a.name),II(i,a.name,new Set).add(a.version);continue}a.version===n?r.add(a.name):(r.delete(a.name),II(i,a.name,new Set).add(a.version))}if(i.size>0){const a=[`${Jl("[tldraw]",["bold","bgRed","textWhite"])} ${Jl("You have multiple versions of tldraw libraries installed. This can lead to bugs and unexpected behavior.",["textRed","bold"])}`,"",`The latest version you have installed is ${Jl(`v${n}`,["bold","textBlue"])}. The following libraries are on the latest version:`,...Array.from(r,l=>`  • ✅ ${Jl(l,["bold"])}`),"","The following libraries are not on the latest version, or have multiple versions installed:",...Array.from(i,([l,c])=>{const d=Array.from(c).sort(F$).map(u=>Jl(`v${u}`,u===n?["textGreen"]:["textRed"]));return`  • ❌ ${Jl(l,["bold"])} (${d.join(", ")})`})];console.log(a.join(`
`)),t.didWarn=!0;return}const o=new Map;for(const a of e)II(o,a.name,{version:a.version,modules:[]}).modules.push(a.modules);const s=new Map;for(const[a,l]of o)l.modules.length>1&&s.set(a,l);if(s.size>0){const a=[`${Jl("[tldraw]",["bold","bgRed","textWhite"])} ${Jl("You have multiple instances of some tldraw libraries active. This can lead to bugs and unexpected behavior. ",["textRed","bold"])}`,"","This usually means that your bundler is misconfigured, and is importing the same library multiple times - usually once as an ES Module, and once as a CommonJS module.","","The following libraries have been imported multiple times:",...Array.from(s,([l,c])=>{const d=c.modules.map((u,p)=>u==="esm"?`      ${p+1}. ES Modules`:`      ${p+1}. CommonJS`).join(`
`);return`  • ❌ ${Jl(l,["bold"])} v${c.version}: 
${d}`}),"","You should configure your bundler to only import one version of each library."];console.log(a.join(`
`)),t.didWarn=!0;return}}function F$(t,e){const n=t.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/),r=e.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/);return!n||!r?t.localeCompare(e):n[1]!==r[1]?Number(n[1])-Number(r[1]):n[2]!==r[2]?Number(n[2])-Number(r[2]):n[3]!==r[3]?Number(n[3])-Number(r[3]):n[4]&&r[4]?n[4].localeCompare(r[4]):n[4]?1:r[4]?-1:0}const Toe={bold:"1",textBlue:"94",textRed:"31",textGreen:"32",bgRed:"41",textWhite:"97"};function Jl(t,e=[]){return`\x1B[${e.map(n=>Toe[n]).join(";")}m${t}\x1B[m`}function II(t,e,n){return t.has(e)?t.get(e):(t.set(e,n),n)}var rm={exports:{}};rm.exports;var B$;function Eoe(){return B$||(B$=1,(function(t,e){var n=200,r="__lodash_hash_undefined__",i=1,o=2,s=9007199254740991,a="[object Arguments]",l="[object Array]",c="[object AsyncFunction]",d="[object Boolean]",u="[object Date]",p="[object Error]",f="[object Function]",y="[object GeneratorFunction]",v="[object Map]",x="[object Number]",b="[object Null]",w="[object Object]",_="[object Promise]",C="[object Proxy]",A="[object RegExp]",E="[object Set]",O="[object String]",D="[object Symbol]",B="[object Undefined]",L="[object WeakMap]",j="[object ArrayBuffer]",F="[object DataView]",z="[object Float32Array]",$="[object Float64Array]",V="[object Int8Array]",Y="[object Int16Array]",re="[object Int32Array]",q="[object Uint8Array]",X="[object Uint8ClampedArray]",N="[object Uint16Array]",H="[object Uint32Array]",ie=/[\\^$.*+?()[\]{}|]/g,U=/^\[object .+?Constructor\]$/,ke=/^(?:0|[1-9]\d*)$/,ge={};ge[z]=ge[$]=ge[V]=ge[Y]=ge[re]=ge[q]=ge[X]=ge[N]=ge[H]=!0,ge[a]=ge[l]=ge[j]=ge[d]=ge[F]=ge[u]=ge[p]=ge[f]=ge[v]=ge[x]=ge[w]=ge[A]=ge[E]=ge[O]=ge[L]=!1;var Te=typeof Qr=="object"&&Qr&&Qr.Object===Object&&Qr,ye=typeof self=="object"&&self&&self.Object===Object&&self,Se=Te||ye||Function("return this")(),Re=e&&!e.nodeType&&e,$e=Re&&!0&&t&&!t.nodeType&&t,Ft=$e&&$e.exports===Re,rn=Ft&&Te.process,Dt=(function(){try{return rn&&rn.binding&&rn.binding("util")}catch{}})(),Kt=Dt&&Dt.isTypedArray;function Gt(W,te){for(var ve=-1,Ke=W==null?0:W.length,cn=0,xt=[];++ve<Ke;){var kn=W[ve];te(kn,ve,W)&&(xt[cn++]=kn)}return xt}function Gn(W,te){for(var ve=-1,Ke=te.length,cn=W.length;++ve<Ke;)W[cn+ve]=te[ve];return W}function Ln(W,te){for(var ve=-1,Ke=W==null?0:W.length;++ve<Ke;)if(te(W[ve],ve,W))return!0;return!1}function Pr(W,te){for(var ve=-1,Ke=Array(W);++ve<W;)Ke[ve]=te(ve);return Ke}function Tr(W){return function(te){return W(te)}}function fr(W,te){return W.has(te)}function gr(W,te){return W?.[te]}function ts(W){var te=-1,ve=Array(W.size);return W.forEach(function(Ke,cn){ve[++te]=[cn,Ke]}),ve}function ya(W,te){return function(ve){return W(te(ve))}}function va(W){var te=-1,ve=Array(W.size);return W.forEach(function(Ke){ve[++te]=Ke}),ve}var Ur=Array.prototype,de=Function.prototype,Me=Object.prototype,nt=Se["__core-js_shared__"],vt=de.toString,oe=Me.hasOwnProperty,Ie=(function(){var W=/[^.]+$/.exec(nt&&nt.keys&&nt.keys.IE_PROTO||"");return W?"Symbol(src)_1."+W:""})(),Qe=Me.toString,Pt=RegExp("^"+vt.call(oe).replace(ie,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),zn=Ft?Se.Buffer:void 0,Fn=Se.Symbol,mn=Se.Uint8Array,Bn=Me.propertyIsEnumerable,ln=Ur.splice,Pi=Fn?Fn.toStringTag:void 0,ro=Object.getOwnPropertySymbols,Ti=zn?zn.isBuffer:void 0,ns=ya(Object.keys,Object),Ac=zs(Se,"DataView"),xa=zs(Se,"Map"),Za=zs(Se,"Promise"),To=zs(Se,"Set"),Mc=zs(Se,"WeakMap"),Sa=zs(Object,"create"),Rh=ze(Ac),Bl=ze(xa),sd=ze(Za),ai=ze(To),Xf=ze(Mc),Ja=Fn?Fn.prototype:void 0,Qa=Ja?Ja.valueOf:void 0;function Eo(W){var te=-1,ve=W==null?0:W.length;for(this.clear();++te<ve;){var Ke=W[te];this.set(Ke[0],Ke[1])}}function ad(){this.__data__=Sa?Sa(null):{},this.size=0}function ba(W){var te=this.has(W)&&delete this.__data__[W];return this.size-=te?1:0,te}function Zf(W){var te=this.__data__;if(Sa){var ve=te[W];return ve===r?void 0:ve}return oe.call(te,W)?te[W]:void 0}function Jf(W){var te=this.__data__;return Sa?te[W]!==void 0:oe.call(te,W)}function wa(W,te){var ve=this.__data__;return this.size+=this.has(W)?0:1,ve[W]=Sa&&te===void 0?r:te,this}Eo.prototype.clear=ad,Eo.prototype.delete=ba,Eo.prototype.get=Zf,Eo.prototype.has=Jf,Eo.prototype.set=wa;function Ao(W){var te=-1,ve=W==null?0:W.length;for(this.clear();++te<ve;){var Ke=W[te];this.set(Ke[0],Ke[1])}}function $h(){this.__data__=[],this.size=0}function Oc(W){var te=this.__data__,ve=ka(te,W);if(ve<0)return!1;var Ke=te.length-1;return ve==Ke?te.pop():ln.call(te,ve,1),--this.size,!0}function Nh(W){var te=this.__data__,ve=ka(te,W);return ve<0?void 0:te[ve][1]}function Lh(W){return ka(this.__data__,W)>-1}function rs(W,te){var ve=this.__data__,Ke=ka(ve,W);return Ke<0?(++this.size,ve.push([W,te])):ve[Ke][1]=te,this}Ao.prototype.clear=$h,Ao.prototype.delete=Oc,Ao.prototype.get=Nh,Ao.prototype.has=Lh,Ao.prototype.set=rs;function Ns(W){var te=-1,ve=W==null?0:W.length;for(this.clear();++te<ve;){var Ke=W[te];this.set(Ke[0],Ke[1])}}function Qf(){this.size=0,this.__data__={hash:new Eo,map:new(xa||Ao),string:new Eo}}function eg(W){var te=Ut(this,W).delete(W);return this.size-=te?1:0,te}function En(W){return Ut(this,W).get(W)}function tg(W){return Ut(this,W).has(W)}function ld(W,te){var ve=Ut(this,W),Ke=ve.size;return ve.set(W,te),this.size+=ve.size==Ke?0:1,this}Ns.prototype.clear=Qf,Ns.prototype.delete=eg,Ns.prototype.get=En,Ns.prototype.has=tg,Ns.prototype.set=ld;function Ls(W){var te=-1,ve=W==null?0:W.length;for(this.__data__=new Ns;++te<ve;)this.add(W[te])}function Dc(W){return this.__data__.set(W,r),this}function zh(W){return this.__data__.has(W)}Ls.prototype.add=Ls.prototype.push=Dc,Ls.prototype.has=zh;function is(W){var te=this.__data__=new Ao(W);this.size=te.size}function jc(){this.__data__=new Ao,this.size=0}function Mo(W){var te=this.__data__,ve=te.delete(W);return this.size=te.size,ve}function ng(W){return this.__data__.get(W)}function Ei(W){return this.__data__.has(W)}function rg(W,te){var ve=this.__data__;if(ve instanceof Ao){var Ke=ve.__data__;if(!xa||Ke.length<n-1)return Ke.push([W,te]),this.size=++ve.size,this;ve=this.__data__=new Ns(Ke)}return ve.set(W,te),this.size=ve.size,this}is.prototype.clear=jc,is.prototype.delete=Mo,is.prototype.get=ng,is.prototype.has=Ei,is.prototype.set=rg;function ig(W,te){var ve=wn(W),Ke=!ve&&ft(W),cn=!ve&&!Ke&&rr(W),xt=!ve&&!Ke&&!cn&&Hr(W),kn=ve||Ke||cn||xt,vr=kn?Pr(W.length,String):[],In=vr.length;for(var yn in W)oe.call(W,yn)&&!(kn&&(yn=="length"||cn&&(yn=="offset"||yn=="parent")||xt&&(yn=="buffer"||yn=="byteLength"||yn=="byteOffset")||Bh(yn,In)))&&vr.push(yn);return vr}function ka(W,te){for(var ve=W.length;ve--;)if(Yt(W[ve][0],te))return ve;return-1}function ss(W,te,ve){var Ke=te(W);return wn(W)?Ke:Gn(Ke,ve(W))}function Rr(W){return W==null?W===void 0?B:b:Pi&&Pi in Object(W)?ud(W):Ce(W)}function el(W){return Yn(W)&&Rr(W)==a}function Ul(W,te,ve,Ke,cn){return W===te?!0:W==null||te==null||!Yn(W)&&!Yn(te)?W!==W&&te!==te:og(W,te,ve,Ke,Ul,cn)}function og(W,te,ve,Ke,cn,xt){var kn=wn(W),vr=wn(te),In=kn?l:io(W),yn=vr?l:io(te);In=In==a?w:In,yn=yn==a?w:yn;var Wr=In==w,Oo=yn==w,xr=In==yn;if(xr&&rr(W)){if(!rr(te))return!1;kn=!0,Wr=!1}if(xr&&!Wr)return xt||(xt=new is),kn||Hr(W)?Rc(W,te,ve,Ke,cn,xt):Ia(W,te,In,ve,Ke,cn,xt);if(!(ve&i)){var ci=Wr&&oe.call(W,"__wrapped__"),so=Oo&&oe.call(te,"__wrapped__");if(ci||so){var ir=ci?W.value():W,Mi=so?te.value():te;return xt||(xt=new is),cn(ir,Mi,ve,Ke,xt)}}return xr?(xt||(xt=new is),Fh(W,te,ve,Ke,cn,xt)):!1}function sg(W){if(!yr(W)||G(W))return!1;var te=mr(W)?Pt:U;return te.test(ze(W))}function as(W){return Yn(W)&&Ai(W.length)&&!!ge[Rr(W)]}function cd(W){if(!ae(W))return ns(W);var te=[];for(var ve in Object(W))oe.call(W,ve)&&ve!="constructor"&&te.push(ve);return te}function Rc(W,te,ve,Ke,cn,xt){var kn=ve&i,vr=W.length,In=te.length;if(vr!=In&&!(kn&&In>vr))return!1;var yn=xt.get(W);if(yn&&xt.get(te))return yn==te;var Wr=-1,Oo=!0,xr=ve&o?new Ls:void 0;for(xt.set(W,te),xt.set(te,W);++Wr<vr;){var ci=W[Wr],so=te[Wr];if(Ke)var ir=kn?Ke(so,ci,Wr,te,W,xt):Ke(ci,so,Wr,W,te,xt);if(ir!==void 0){if(ir)continue;Oo=!1;break}if(xr){if(!Ln(te,function(Mi,_a){if(!fr(xr,_a)&&(ci===Mi||cn(ci,Mi,ve,Ke,xt)))return xr.push(_a)})){Oo=!1;break}}else if(!(ci===so||cn(ci,so,ve,Ke,xt))){Oo=!1;break}}return xt.delete(W),xt.delete(te),Oo}function Ia(W,te,ve,Ke,cn,xt,kn){switch(ve){case F:if(W.byteLength!=te.byteLength||W.byteOffset!=te.byteOffset)return!1;W=W.buffer,te=te.buffer;case j:return!(W.byteLength!=te.byteLength||!xt(new mn(W),new mn(te)));case d:case u:case x:return Yt(+W,+te);case p:return W.name==te.name&&W.message==te.message;case A:case O:return W==te+"";case v:var vr=ts;case E:var In=Ke&i;if(vr||(vr=va),W.size!=te.size&&!In)return!1;var yn=kn.get(W);if(yn)return yn==te;Ke|=o,kn.set(W,te);var Wr=Rc(vr(W),vr(te),Ke,cn,xt,kn);return kn.delete(W),Wr;case D:if(Qa)return Qa.call(W)==Qa.call(te)}return!1}function Fh(W,te,ve,Ke,cn,xt){var kn=ve&i,vr=$c(W),In=vr.length,yn=$c(te),Wr=yn.length;if(In!=Wr&&!kn)return!1;for(var Oo=In;Oo--;){var xr=vr[Oo];if(!(kn?xr in te:oe.call(te,xr)))return!1}var ci=xt.get(W);if(ci&&xt.get(te))return ci==te;var so=!0;xt.set(W,te),xt.set(te,W);for(var ir=kn;++Oo<In;){xr=vr[Oo];var Mi=W[xr],_a=te[xr];if(Ke)var Nc=kn?Ke(_a,Mi,xr,te,W,xt):Ke(Mi,_a,xr,W,te,xt);if(!(Nc===void 0?Mi===_a||cn(Mi,_a,ve,Ke,xt):Nc)){so=!1;break}ir||(ir=xr=="constructor")}if(so&&!ir){var Uh=W.constructor,Lc=te.constructor;Uh!=Lc&&"constructor"in W&&"constructor"in te&&!(typeof Uh=="function"&&Uh instanceof Uh&&typeof Lc=="function"&&Lc instanceof Lc)&&(so=!1)}return xt.delete(W),xt.delete(te),so}function $c(W){return ss(W,Fs,Hl)}function Ut(W,te){var ve=W.__data__;return dd(te)?ve[typeof te=="string"?"string":"hash"]:ve.map}function zs(W,te){var ve=gr(W,te);return sg(ve)?ve:void 0}function ud(W){var te=oe.call(W,Pi),ve=W[Pi];try{W[Pi]=void 0;var Ke=!0}catch{}var cn=Qe.call(W);return Ke&&(te?W[Pi]=ve:delete W[Pi]),cn}var Hl=ro?function(W){return W==null?[]:(W=Object(W),Gt(ro(W),function(te){return Bn.call(W,te)}))}:li,io=Rr;(Ac&&io(new Ac(new ArrayBuffer(1)))!=F||xa&&io(new xa)!=v||Za&&io(Za.resolve())!=_||To&&io(new To)!=E||Mc&&io(new Mc)!=L)&&(io=function(W){var te=Rr(W),ve=te==w?W.constructor:void 0,Ke=ve?ze(ve):"";if(Ke)switch(Ke){case Rh:return F;case Bl:return v;case sd:return _;case ai:return E;case Xf:return L}return te});function Bh(W,te){return te=te??s,!!te&&(typeof W=="number"||ke.test(W))&&W>-1&&W%1==0&&W<te}function dd(W){var te=typeof W;return te=="string"||te=="number"||te=="symbol"||te=="boolean"?W!=="__proto__":W===null}function G(W){return!!Ie&&Ie in W}function ae(W){var te=W&&W.constructor,ve=typeof te=="function"&&te.prototype||Me;return W===ve}function Ce(W){return Qe.call(W)}function ze(W){if(W!=null){try{return vt.call(W)}catch{}try{return W+""}catch{}}return""}function Yt(W,te){return W===te||W!==W&&te!==te}var ft=el((function(){return arguments})())?el:function(W){return Yn(W)&&oe.call(W,"callee")&&!Bn.call(W,"callee")},wn=Array.isArray;function An(W){return W!=null&&Ai(W.length)&&!mr(W)}var rr=Ti||oo;function $r(W,te){return Ul(W,te)}function mr(W){if(!yr(W))return!1;var te=Rr(W);return te==f||te==y||te==c||te==C}function Ai(W){return typeof W=="number"&&W>-1&&W%1==0&&W<=s}function yr(W){var te=typeof W;return W!=null&&(te=="object"||te=="function")}function Yn(W){return W!=null&&typeof W=="object"}var Hr=Kt?Tr(Kt):as;function Fs(W){return An(W)?ig(W):cd(W)}function li(){return[]}function oo(){return!1}t.exports=$r})(rm,rm.exports)),rm.exports}var Aoe=Eoe();const Bu=ua(Aoe);var im={exports:{}};im.exports;var U$;function Moe(){return U$||(U$=1,(function(t,e){var n=200,r="__lodash_hash_undefined__",i=1,o=2,s=9007199254740991,a="[object Arguments]",l="[object Array]",c="[object Boolean]",d="[object Date]",u="[object Error]",p="[object Function]",f="[object GeneratorFunction]",y="[object Map]",v="[object Number]",x="[object Object]",b="[object Promise]",w="[object RegExp]",_="[object Set]",C="[object String]",A="[object Symbol]",E="[object WeakMap]",O="[object ArrayBuffer]",D="[object DataView]",B="[object Float32Array]",L="[object Float64Array]",j="[object Int8Array]",F="[object Int16Array]",z="[object Int32Array]",$="[object Uint8Array]",V="[object Uint8ClampedArray]",Y="[object Uint16Array]",re="[object Uint32Array]",q=/[\\^$.*+?()[\]{}|]/g,X=/^\[object .+?Constructor\]$/,N=/^(?:0|[1-9]\d*)$/,H={};H[B]=H[L]=H[j]=H[F]=H[z]=H[$]=H[V]=H[Y]=H[re]=!0,H[a]=H[l]=H[O]=H[c]=H[D]=H[d]=H[u]=H[p]=H[y]=H[v]=H[x]=H[w]=H[_]=H[C]=H[E]=!1;var ie=typeof Qr=="object"&&Qr&&Qr.Object===Object&&Qr,U=typeof self=="object"&&self&&self.Object===Object&&self,ke=ie||U||Function("return this")(),ge=e&&!e.nodeType&&e,Te=ge&&!0&&t&&!t.nodeType&&t,ye=Te&&Te.exports===ge,Se=ye&&ie.process,Re=(function(){try{return Se&&Se.binding("util")}catch{}})(),$e=Re&&Re.isTypedArray;function Ft(G,ae){for(var Ce=-1,ze=G?G.length:0;++Ce<ze;)if(ae(G[Ce],Ce,G))return!0;return!1}function rn(G,ae){for(var Ce=-1,ze=Array(G);++Ce<G;)ze[Ce]=ae(Ce);return ze}function Dt(G){return function(ae){return G(ae)}}function Kt(G,ae){return G?.[ae]}function Gt(G){var ae=!1;if(G!=null&&typeof G.toString!="function")try{ae=!!(G+"")}catch{}return ae}function Gn(G){var ae=-1,Ce=Array(G.size);return G.forEach(function(ze,Yt){Ce[++ae]=[Yt,ze]}),Ce}function Ln(G,ae){return function(Ce){return G(ae(Ce))}}function Pr(G){var ae=-1,Ce=Array(G.size);return G.forEach(function(ze){Ce[++ae]=ze}),Ce}var Tr=Array.prototype,fr=Function.prototype,gr=Object.prototype,ts=ke["__core-js_shared__"],ya=(function(){var G=/[^.]+$/.exec(ts&&ts.keys&&ts.keys.IE_PROTO||"");return G?"Symbol(src)_1."+G:""})(),va=fr.toString,Ur=gr.hasOwnProperty,de=gr.toString,Me=RegExp("^"+va.call(Ur).replace(q,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),nt=ke.Symbol,vt=ke.Uint8Array,oe=gr.propertyIsEnumerable,Ie=Tr.splice,Qe=Ln(Object.keys,Object),Pt=ss(ke,"DataView"),zn=ss(ke,"Map"),Fn=ss(ke,"Promise"),mn=ss(ke,"Set"),Bn=ss(ke,"WeakMap"),ln=ss(Object,"create"),Pi=as(Pt),ro=as(zn),Ti=as(Fn),ns=as(mn),Ac=as(Bn),xa=nt?nt.prototype:void 0,Za=xa?xa.valueOf:void 0;function To(G){var ae=-1,Ce=G?G.length:0;for(this.clear();++ae<Ce;){var ze=G[ae];this.set(ze[0],ze[1])}}function Mc(){this.__data__=ln?ln(null):{}}function Sa(G){return this.has(G)&&delete this.__data__[G]}function Rh(G){var ae=this.__data__;if(ln){var Ce=ae[G];return Ce===r?void 0:Ce}return Ur.call(ae,G)?ae[G]:void 0}function Bl(G){var ae=this.__data__;return ln?ae[G]!==void 0:Ur.call(ae,G)}function sd(G,ae){var Ce=this.__data__;return Ce[G]=ln&&ae===void 0?r:ae,this}To.prototype.clear=Mc,To.prototype.delete=Sa,To.prototype.get=Rh,To.prototype.has=Bl,To.prototype.set=sd;function ai(G){var ae=-1,Ce=G?G.length:0;for(this.clear();++ae<Ce;){var ze=G[ae];this.set(ze[0],ze[1])}}function Xf(){this.__data__=[]}function Ja(G){var ae=this.__data__,Ce=Ls(ae,G);if(Ce<0)return!1;var ze=ae.length-1;return Ce==ze?ae.pop():Ie.call(ae,Ce,1),!0}function Qa(G){var ae=this.__data__,Ce=Ls(ae,G);return Ce<0?void 0:ae[Ce][1]}function Eo(G){return Ls(this.__data__,G)>-1}function ad(G,ae){var Ce=this.__data__,ze=Ls(Ce,G);return ze<0?Ce.push([G,ae]):Ce[ze][1]=ae,this}ai.prototype.clear=Xf,ai.prototype.delete=Ja,ai.prototype.get=Qa,ai.prototype.has=Eo,ai.prototype.set=ad;function ba(G){var ae=-1,Ce=G?G.length:0;for(this.clear();++ae<Ce;){var ze=G[ae];this.set(ze[0],ze[1])}}function Zf(){this.__data__={hash:new To,map:new(zn||ai),string:new To}}function Jf(G){return ka(this,G).delete(G)}function wa(G){return ka(this,G).get(G)}function Ao(G){return ka(this,G).has(G)}function $h(G,ae){return ka(this,G).set(G,ae),this}ba.prototype.clear=Zf,ba.prototype.delete=Jf,ba.prototype.get=wa,ba.prototype.has=Ao,ba.prototype.set=$h;function Oc(G){var ae=-1,Ce=G?G.length:0;for(this.__data__=new ba;++ae<Ce;)this.add(G[ae])}function Nh(G){return this.__data__.set(G,r),this}function Lh(G){return this.__data__.has(G)}Oc.prototype.add=Oc.prototype.push=Nh,Oc.prototype.has=Lh;function rs(G){this.__data__=new ai(G)}function Ns(){this.__data__=new ai}function Qf(G){return this.__data__.delete(G)}function eg(G){return this.__data__.get(G)}function En(G){return this.__data__.has(G)}function tg(G,ae){var Ce=this.__data__;if(Ce instanceof ai){var ze=Ce.__data__;if(!zn||ze.length<n-1)return ze.push([G,ae]),this;Ce=this.__data__=new ba(ze)}return Ce.set(G,ae),this}rs.prototype.clear=Ns,rs.prototype.delete=Qf,rs.prototype.get=eg,rs.prototype.has=En,rs.prototype.set=tg;function ld(G,ae){var Ce=Ia(G)||Rc(G)?rn(G.length,String):[],ze=Ce.length,Yt=!!ze;for(var ft in G)Ur.call(G,ft)&&!(Yt&&(ft=="length"||el(ft,ze)))&&Ce.push(ft);return Ce}function Ls(G,ae){for(var Ce=G.length;Ce--;)if(cd(G[Ce][0],ae))return Ce;return-1}function Dc(G){return de.call(G)}function zh(G,ae,Ce,ze,Yt){return G===ae?!0:G==null||ae==null||!Hl(G)&&!io(ae)?G!==G&&ae!==ae:is(G,ae,zh,Ce,ze,Yt)}function is(G,ae,Ce,ze,Yt,ft){var wn=Ia(G),An=Ia(ae),rr=l,$r=l;wn||(rr=Rr(G),rr=rr==a?x:rr),An||($r=Rr(ae),$r=$r==a?x:$r);var mr=rr==x&&!Gt(G),Ai=$r==x&&!Gt(ae),yr=rr==$r;if(yr&&!mr)return ft||(ft=new rs),wn||Bh(G)?Ei(G,ae,Ce,ze,Yt,ft):rg(G,ae,rr,Ce,ze,Yt,ft);if(!(Yt&o)){var Yn=mr&&Ur.call(G,"__wrapped__"),Hr=Ai&&Ur.call(ae,"__wrapped__");if(Yn||Hr){var Fs=Yn?G.value():G,li=Hr?ae.value():ae;return ft||(ft=new rs),Ce(Fs,li,ze,Yt,ft)}}return yr?(ft||(ft=new rs),ig(G,ae,Ce,ze,Yt,ft)):!1}function jc(G){if(!Hl(G)||og(G))return!1;var ae=zs(G)||Gt(G)?Me:X;return ae.test(as(G))}function Mo(G){return io(G)&&ud(G.length)&&!!H[de.call(G)]}function ng(G){if(!sg(G))return Qe(G);var ae=[];for(var Ce in Object(G))Ur.call(G,Ce)&&Ce!="constructor"&&ae.push(Ce);return ae}function Ei(G,ae,Ce,ze,Yt,ft){var wn=Yt&o,An=G.length,rr=ae.length;if(An!=rr&&!(wn&&rr>An))return!1;var $r=ft.get(G);if($r&&ft.get(ae))return $r==ae;var mr=-1,Ai=!0,yr=Yt&i?new Oc:void 0;for(ft.set(G,ae),ft.set(ae,G);++mr<An;){var Yn=G[mr],Hr=ae[mr];if(ze)var Fs=wn?ze(Hr,Yn,mr,ae,G,ft):ze(Yn,Hr,mr,G,ae,ft);if(Fs!==void 0){if(Fs)continue;Ai=!1;break}if(yr){if(!Ft(ae,function(li,oo){if(!yr.has(oo)&&(Yn===li||Ce(Yn,li,ze,Yt,ft)))return yr.add(oo)})){Ai=!1;break}}else if(!(Yn===Hr||Ce(Yn,Hr,ze,Yt,ft))){Ai=!1;break}}return ft.delete(G),ft.delete(ae),Ai}function rg(G,ae,Ce,ze,Yt,ft,wn){switch(Ce){case D:if(G.byteLength!=ae.byteLength||G.byteOffset!=ae.byteOffset)return!1;G=G.buffer,ae=ae.buffer;case O:return!(G.byteLength!=ae.byteLength||!ze(new vt(G),new vt(ae)));case c:case d:case v:return cd(+G,+ae);case u:return G.name==ae.name&&G.message==ae.message;case w:case C:return G==ae+"";case y:var An=Gn;case _:var rr=ft&o;if(An||(An=Pr),G.size!=ae.size&&!rr)return!1;var $r=wn.get(G);if($r)return $r==ae;ft|=i,wn.set(G,ae);var mr=Ei(An(G),An(ae),ze,Yt,ft,wn);return wn.delete(G),mr;case A:if(Za)return Za.call(G)==Za.call(ae)}return!1}function ig(G,ae,Ce,ze,Yt,ft){var wn=Yt&o,An=dd(G),rr=An.length,$r=dd(ae),mr=$r.length;if(rr!=mr&&!wn)return!1;for(var Ai=rr;Ai--;){var yr=An[Ai];if(!(wn?yr in ae:Ur.call(ae,yr)))return!1}var Yn=ft.get(G);if(Yn&&ft.get(ae))return Yn==ae;var Hr=!0;ft.set(G,ae),ft.set(ae,G);for(var Fs=wn;++Ai<rr;){yr=An[Ai];var li=G[yr],oo=ae[yr];if(ze)var W=wn?ze(oo,li,yr,ae,G,ft):ze(li,oo,yr,G,ae,ft);if(!(W===void 0?li===oo||Ce(li,oo,ze,Yt,ft):W)){Hr=!1;break}Fs||(Fs=yr=="constructor")}if(Hr&&!Fs){var te=G.constructor,ve=ae.constructor;te!=ve&&"constructor"in G&&"constructor"in ae&&!(typeof te=="function"&&te instanceof te&&typeof ve=="function"&&ve instanceof ve)&&(Hr=!1)}return ft.delete(G),ft.delete(ae),Hr}function ka(G,ae){var Ce=G.__data__;return Ul(ae)?Ce[typeof ae=="string"?"string":"hash"]:Ce.map}function ss(G,ae){var Ce=Kt(G,ae);return jc(Ce)?Ce:void 0}var Rr=Dc;(Pt&&Rr(new Pt(new ArrayBuffer(1)))!=D||zn&&Rr(new zn)!=y||Fn&&Rr(Fn.resolve())!=b||mn&&Rr(new mn)!=_||Bn&&Rr(new Bn)!=E)&&(Rr=function(G){var ae=de.call(G),Ce=ae==x?G.constructor:void 0,ze=Ce?as(Ce):void 0;if(ze)switch(ze){case Pi:return D;case ro:return y;case Ti:return b;case ns:return _;case Ac:return E}return ae});function el(G,ae){return ae=ae??s,!!ae&&(typeof G=="number"||N.test(G))&&G>-1&&G%1==0&&G<ae}function Ul(G){var ae=typeof G;return ae=="string"||ae=="number"||ae=="symbol"||ae=="boolean"?G!=="__proto__":G===null}function og(G){return!!ya&&ya in G}function sg(G){var ae=G&&G.constructor,Ce=typeof ae=="function"&&ae.prototype||gr;return G===Ce}function as(G){if(G!=null){try{return va.call(G)}catch{}try{return G+""}catch{}}return""}function cd(G,ae){return G===ae||G!==G&&ae!==ae}function Rc(G){return $c(G)&&Ur.call(G,"callee")&&(!oe.call(G,"callee")||de.call(G)==a)}var Ia=Array.isArray;function Fh(G){return G!=null&&ud(G.length)&&!zs(G)}function $c(G){return io(G)&&Fh(G)}function Ut(G,ae,Ce){Ce=typeof Ce=="function"?Ce:void 0;var ze=Ce?Ce(G,ae):void 0;return ze===void 0?zh(G,ae,Ce):!!ze}function zs(G){var ae=Hl(G)?de.call(G):"";return ae==p||ae==f}function ud(G){return typeof G=="number"&&G>-1&&G%1==0&&G<=s}function Hl(G){var ae=typeof G;return!!G&&(ae=="object"||ae=="function")}function io(G){return!!G&&typeof G=="object"}var Bh=$e?Dt($e):Mo;function dd(G){return Fh(G)?ld(G):ng(G)}t.exports=Ut})(im,im.exports)),im.exports}var Ooe=Moe();const Doe=ua(Ooe);var _I,H$;function joe(){if(H$)return _I;H$=1;var t="Expected a function",e=NaN,n="[object Symbol]",r=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,s=/^0o[0-7]+$/i,a=parseInt,l=typeof Qr=="object"&&Qr&&Qr.Object===Object&&Qr,c=typeof self=="object"&&self&&self.Object===Object&&self,d=l||c||Function("return this")(),u=Object.prototype,p=u.toString,f=Math.max,y=Math.min,v=function(){return d.Date.now()};function x(E,O,D){var B,L,j,F,z,$,V=0,Y=!1,re=!1,q=!0;if(typeof E!="function")throw new TypeError(t);O=A(O)||0,w(D)&&(Y=!!D.leading,re="maxWait"in D,j=re?f(A(D.maxWait)||0,O):j,q="trailing"in D?!!D.trailing:q);function X(Se){var Re=B,$e=L;return B=L=void 0,V=Se,F=E.apply($e,Re),F}function N(Se){return V=Se,z=setTimeout(U,O),Y?X(Se):F}function H(Se){var Re=Se-$,$e=Se-V,Ft=O-Re;return re?y(Ft,j-$e):Ft}function ie(Se){var Re=Se-$,$e=Se-V;return $===void 0||Re>=O||Re<0||re&&$e>=j}function U(){var Se=v();if(ie(Se))return ke(Se);z=setTimeout(U,H(Se))}function ke(Se){return z=void 0,q&&B?X(Se):(B=L=void 0,F)}function ge(){z!==void 0&&clearTimeout(z),V=0,B=$=L=z=void 0}function Te(){return z===void 0?F:ke(v())}function ye(){var Se=v(),Re=ie(Se);if(B=arguments,L=this,$=Se,Re){if(z===void 0)return N($);if(re)return z=setTimeout(U,O),X($)}return z===void 0&&(z=setTimeout(U,O)),F}return ye.cancel=ge,ye.flush=Te,ye}function b(E,O,D){var B=!0,L=!0;if(typeof E!="function")throw new TypeError(t);return w(D)&&(B="leading"in D?!!D.leading:B,L="trailing"in D?!!D.trailing:L),x(E,O,{leading:B,maxWait:O,trailing:L})}function w(E){var O=typeof E;return!!E&&(O=="object"||O=="function")}function _(E){return!!E&&typeof E=="object"}function C(E){return typeof E=="symbol"||_(E)&&p.call(E)==n}function A(E){if(typeof E=="number")return E;if(C(E))return e;if(w(E)){var O=typeof E.valueOf=="function"?E.valueOf():E;E=w(O)?O+"":O}if(typeof E!="string")return E===0?E:+E;E=E.replace(r,"");var D=o.test(E);return D||s.test(E)?a(E.slice(2),D?2:8):i.test(E)?e:+E}return _I=b,_I}var Roe=joe();const e5=ua(Roe);var CI,W$;function $oe(){if(W$)return CI;W$=1;var t=200,e="__lodash_hash_undefined__",n=1/0,r="[object Function]",i="[object GeneratorFunction]",o=/[\\^$.*+?()[\]{}|]/g,s=/^\[object .+?Constructor\]$/,a=typeof Qr=="object"&&Qr&&Qr.Object===Object&&Qr,l=typeof self=="object"&&self&&self.Object===Object&&self,c=a||l||Function("return this")();function d(oe,Ie){var Qe=oe?oe.length:0;return!!Qe&&p(oe,Ie,0)>-1}function u(oe,Ie,Qe,Pt){for(var zn=oe.length,Fn=Qe+-1;++Fn<zn;)if(Ie(oe[Fn],Fn,oe))return Fn;return-1}function p(oe,Ie,Qe){if(Ie!==Ie)return u(oe,f,Qe);for(var Pt=Qe-1,zn=oe.length;++Pt<zn;)if(oe[Pt]===Ie)return Pt;return-1}function f(oe){return oe!==oe}function y(oe,Ie){return oe.has(Ie)}function v(oe,Ie){return oe?.[Ie]}function x(oe){var Ie=!1;if(oe!=null&&typeof oe.toString!="function")try{Ie=!!(oe+"")}catch{}return Ie}function b(oe){var Ie=-1,Qe=Array(oe.size);return oe.forEach(function(Pt){Qe[++Ie]=Pt}),Qe}var w=Array.prototype,_=Function.prototype,C=Object.prototype,A=c["__core-js_shared__"],E=(function(){var oe=/[^.]+$/.exec(A&&A.keys&&A.keys.IE_PROTO||"");return oe?"Symbol(src)_1."+oe:""})(),O=_.toString,D=C.hasOwnProperty,B=C.toString,L=RegExp("^"+O.call(D).replace(o,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),j=w.splice,F=gr(c,"Map"),z=gr(c,"Set"),$=gr(Object,"create");function V(oe){var Ie=-1,Qe=oe?oe.length:0;for(this.clear();++Ie<Qe;){var Pt=oe[Ie];this.set(Pt[0],Pt[1])}}function Y(){this.__data__=$?$(null):{}}function re(oe){return this.has(oe)&&delete this.__data__[oe]}function q(oe){var Ie=this.__data__;if($){var Qe=Ie[oe];return Qe===e?void 0:Qe}return D.call(Ie,oe)?Ie[oe]:void 0}function X(oe){var Ie=this.__data__;return $?Ie[oe]!==void 0:D.call(Ie,oe)}function N(oe,Ie){var Qe=this.__data__;return Qe[oe]=$&&Ie===void 0?e:Ie,this}V.prototype.clear=Y,V.prototype.delete=re,V.prototype.get=q,V.prototype.has=X,V.prototype.set=N;function H(oe){var Ie=-1,Qe=oe?oe.length:0;for(this.clear();++Ie<Qe;){var Pt=oe[Ie];this.set(Pt[0],Pt[1])}}function ie(){this.__data__=[]}function U(oe){var Ie=this.__data__,Qe=Gn(Ie,oe);if(Qe<0)return!1;var Pt=Ie.length-1;return Qe==Pt?Ie.pop():j.call(Ie,Qe,1),!0}function ke(oe){var Ie=this.__data__,Qe=Gn(Ie,oe);return Qe<0?void 0:Ie[Qe][1]}function ge(oe){return Gn(this.__data__,oe)>-1}function Te(oe,Ie){var Qe=this.__data__,Pt=Gn(Qe,oe);return Pt<0?Qe.push([oe,Ie]):Qe[Pt][1]=Ie,this}H.prototype.clear=ie,H.prototype.delete=U,H.prototype.get=ke,H.prototype.has=ge,H.prototype.set=Te;function ye(oe){var Ie=-1,Qe=oe?oe.length:0;for(this.clear();++Ie<Qe;){var Pt=oe[Ie];this.set(Pt[0],Pt[1])}}function Se(){this.__data__={hash:new V,map:new(F||H),string:new V}}function Re(oe){return fr(this,oe).delete(oe)}function $e(oe){return fr(this,oe).get(oe)}function Ft(oe){return fr(this,oe).has(oe)}function rn(oe,Ie){return fr(this,oe).set(oe,Ie),this}ye.prototype.clear=Se,ye.prototype.delete=Re,ye.prototype.get=$e,ye.prototype.has=Ft,ye.prototype.set=rn;function Dt(oe){var Ie=-1,Qe=oe?oe.length:0;for(this.__data__=new ye;++Ie<Qe;)this.add(oe[Ie])}function Kt(oe){return this.__data__.set(oe,e),this}function Gt(oe){return this.__data__.has(oe)}Dt.prototype.add=Dt.prototype.push=Kt,Dt.prototype.has=Gt;function Gn(oe,Ie){for(var Qe=oe.length;Qe--;)if(de(oe[Qe][0],Ie))return Qe;return-1}function Ln(oe){if(!nt(oe)||ya(oe))return!1;var Ie=Me(oe)||x(oe)?L:s;return Ie.test(va(oe))}function Pr(oe,Ie,Qe){var Pt=-1,zn=d,Fn=oe.length,mn=!0,Bn=[],ln=Bn;if(Fn>=t){var Pi=Tr(oe);if(Pi)return b(Pi);mn=!1,zn=y,ln=new Dt}else ln=Bn;e:for(;++Pt<Fn;){var ro=oe[Pt],Ti=ro;if(ro=ro!==0?ro:0,mn&&Ti===Ti){for(var ns=ln.length;ns--;)if(ln[ns]===Ti)continue e;Bn.push(ro)}else zn(ln,Ti,Qe)||(ln!==Bn&&ln.push(Ti),Bn.push(ro))}return Bn}var Tr=z&&1/b(new z([,-0]))[1]==n?function(oe){return new z(oe)}:vt;function fr(oe,Ie){var Qe=oe.__data__;return ts(Ie)?Qe[typeof Ie=="string"?"string":"hash"]:Qe.map}function gr(oe,Ie){var Qe=v(oe,Ie);return Ln(Qe)?Qe:void 0}function ts(oe){var Ie=typeof oe;return Ie=="string"||Ie=="number"||Ie=="symbol"||Ie=="boolean"?oe!=="__proto__":oe===null}function ya(oe){return!!E&&E in oe}function va(oe){if(oe!=null){try{return O.call(oe)}catch{}try{return oe+""}catch{}}return""}function Ur(oe){return oe&&oe.length?Pr(oe):[]}function de(oe,Ie){return oe===Ie||oe!==oe&&Ie!==Ie}function Me(oe){var Ie=nt(oe)?B.call(oe):"";return Ie==r||Ie==i}function nt(oe){var Ie=typeof oe;return!!oe&&(Ie=="object"||Ie=="function")}function vt(){}return CI=Ur,CI}var Noe=$oe();const Loe=ua(Noe);function a2(t,e){const n=[];e:for(const r of t){for(const i of n)if(e?e(r,i):r===i)continue e;n.push(r)}return n}function ut(t){return t.filter(e=>e!=null)}function gi(t){return t[t.length-1]}function t5(t,e){let n,r=1/0;for(const i of t){const o=e(i);o<r&&(n=i,r=o)}return n}function zoe(t,e){let n,r=-1/0;for(const i of t){const o=e(i);o>r&&(n=i,r=o)}return n}function JS(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Object.is(t[n],e[n]))return!1;return!0}function Pm(t,e,n){const r=new Set(e.map(o=>o[t])),i=[];for(const o of n)r.has(o[t])||i.push(o);for(const o of e)i.push(o);return i}function n5(t){const e=(...n)=>{try{return t(...n)}catch(r){throw r instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(r,e),r}};return e}const Xm=()=>{},Iu={ok(t){return{ok:!0,value:t}},err(t){return{ok:!1,error:t}}};function Wt(t,e){const n=e&&t&&typeof t=="object"&&e in t?t[e]:t;throw new Error(`Unknown switch case ${n}`)}const Ge=n5((t,e)=>{if(!t)throw new Error(e||"Assertion Error")}),Gr=n5((t,e)=>{if(t==null)throw new Error(e??"value must be defined");return t});function l2(){let t,e;const n=new Promise((r,i)=>{t=r,e=i});return Object.assign(n,{resolve:t,reject:e})}function uT(t){return new Promise(e=>setTimeout(e,t))}/*!
 * MIT License: https://github.com/NoHomey/bind-decorator/blob/master/License
 * Copyright (c) 2016 Ivo Stratev
 */function qo(...t){if(t.length===2){const[e,n]=t;n.addInitializer(function(){Ge(Reflect.isExtensible(this),"Cannot bind to a non-extensible class.");const i=e.bind(this),o=Reflect.defineProperty(this,n.name,{value:i,writable:!0,configurable:!0});Ge(o,"Cannot bind a non-configurable class method.")})}else{const[e,n,r]=t;if(!r||typeof r.value!="function")throw new TypeError(`Only methods can be decorated with @bind. <${n}> is not a method!`);return{configurable:!0,get(){const i=r.value.bind(this);return Object.defineProperty(this,n,{value:i,configurable:!0,writable:!0}),i}}}}class ki{items=new WeakMap;get(e,n){return this.items.has(e)||this.items.set(e,n(e)),this.items.get(e)}}function Lw(t,e){let n;const r=(...i)=>(n||(n={},n.promise=new Promise((o,s)=>{n.resolve=o,n.reject=s})),clearTimeout(n.timeout),n.latestArgs=i,n.timeout=setTimeout(()=>{const o=n;n=void 0;try{o.resolve(t(...o.latestArgs))}catch(s){o.reject(s)}},e),n.promise);return r.cancel=()=>{n&&clearTimeout(n.timeout)},r}const V$=new WeakMap;function c2(t,e){if(typeof t!="object"||t===null)return;let n=V$.get(t);n||(n={tags:{},extras:{}},V$.set(t,n)),e.tags&&(n.tags={...n.tags,...e.tags}),e.extras&&(n.extras={...n.extras,...e.extras})}async function gc(t,e){return window.fetch(t,{referrerPolicy:"strict-origin-when-cross-origin",...e})}const Zm=(t,e)=>{const n=new window.Image(t,e);return n.referrerPolicy="strict-origin-when-cross-origin",n};class Si{static async urlToArrayBuffer(e){return await(await gc(e)).arrayBuffer()}static async urlToBlob(e){return await(await gc(e)).blob()}static async urlToDataUrl(e){if(e.startsWith("data:"))return e;const n=await Si.urlToBlob(e);return await Si.blobToDataUrl(n)}static async blobToDataUrl(e){return await new Promise((n,r)=>{if(e){const i=new FileReader;i.onload=()=>n(i.result),i.onerror=o=>r(o),i.onabort=o=>r(o),i.readAsDataURL(e)}})}static async blobToText(e){return await new Promise((n,r)=>{if(e){const i=new FileReader;i.onload=()=>n(i.result),i.onerror=o=>r(o),i.onabort=o=>r(o),i.readAsText(e)}})}static rewriteMimeType(e,n){return e.type===n?e:e instanceof File?new File([e],e.name,{type:n}):new Blob([e],{type:n})}}function u2(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return e+""}function r5(t){const e=new DataView(t);let n=0;for(let r=0;r<e.byteLength;r++)n=(n<<5)-n+e.getUint8(r),n|=0;return n+""}/*!
 * MIT License: https://github.com/ai/nanoid/blob/main/LICENSE
 * Modified code originally from <https://github.com/ai/nanoid>
 * Copyright 2017 Andrey Sitnik <andrey@sitnik.ru>
 *
 * `nanoid` is currently only distributed as an ES module. Some tools (jest, playwright) don't
 * properly support ESM-only code yet, and tldraw itself is distributed as both an ES module and a
 * CommonJS module. By including nanoid here, we can make sure it works well in every environment
 * where tldraw is used. We can also remove some unused features like custom alphabets.
 */const K$=globalThis.crypto,Foe="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",Boe=128;let Pd,Rp;function Uoe(t){!Pd||Pd.length<t?(Pd=new Uint8Array(t*Boe),K$.getRandomValues(Pd),Rp=0):Rp+t>Pd.length&&(K$.getRandomValues(Pd),Rp=0),Rp+=t}function Hoe(t=21){Uoe(t-=0);let e="";for(let n=Rp-t;n<Rp;n++)e+=Foe[Pd[n]&63];return e}let Woe=Hoe;function Qt(t){return Woe(t)}/*!
 * MIT License: https://github.com/vHeemstra/is-apng/blob/main/license
 * Copyright (c) Philip van Heemstra
 */function Voe(t){const e=new Uint8Array(t);if(!e||!(typeof Buffer<"u"&&Buffer.isBuffer(e)||e instanceof Uint8Array)||e.length<16||!(e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10))return!1;function r(o,s,a,l,c=1024){if(!s)return-1;s=new RegExp(s,"g");const d=s.source.length,u=new TextDecoder,p=o.length;if(typeof l>"u"&&(l=p),a>=p||l<=0||a>=l)return-1;o=o.subarray(a,l);let f=-1,y=0,v=0,x="";e:for(;y<o.length;){const b=y+c,w=o.subarray(y,b),_=u.decode(w,{stream:!0}),C=x+_;let A,E=-1;for(;(A=s.exec(C))!==null;){E=A.index-x.length,f=v+E;break e}y=b,v+=_.length;const O=E>-1?E+d:_.length-d;x=_.slice(O)}return f>=0&&(f+=a>=0?a:p+a),f}const i=r(e,"IDAT",12);return i>=12?r(e,"acTL",8,i)>=8:!1}const Koe=t=>new Uint8Array(t)[3]===44;/*!
 * MIT License
 * Modified code originally from <https://github.com/qzb/is-animated>
 * Copyright (c) 2016 Józef Sokołowski <j.k.sokolowski@gmail.com>
 */function q$(t,e){let n=0;for(;t[e+n];)n+=t[e+n]+1;return n+1}function qoe(t){return new TextDecoder("ascii").decode(t.slice(0,3))==="GIF"}function Goe(t){const e=new Uint8Array(t);let n,r,i=0,o=0;if(!qoe(t))return!1;for(n=e[10]&128,r=e[10]&7,i+=6,i+=7,i+=n?3*Math.pow(2,r+1):0;o<2&&i<e.length;)switch(e[i]){case 44:o+=1,n=e[i+9]&128,r=e[i+9]&7,i+=10,i+=n?3*Math.pow(2,r+1):0,i+=q$(e,i+1)+1;break;case 33:i+=2,i+=q$(e,i);break;case 59:i=e.length;break;default:i=e.length;break}return o>1}/*!
 * MIT License: https://github.com/alexgorbatchev/crc/blob/master/LICENSE
 * Copyright: 2014 Alex Gorbatchev
 * Code: crc32, https://github.com/alexgorbatchev/crc/blob/master/src/calculators/crc32.ts
 */let dT=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(dT=new Int32Array(dT));const Yoe=(t,e)=>{let n=-1;for(let r=0;r<t.length;r++)n=dT[(n^t[r])&255]^n>>>8;return n^-1},G$=4,Y$=4;class fl{static isPng(e,n){return e.getUint8(n+0)===137&&e.getUint8(n+1)===80&&e.getUint8(n+2)===78&&e.getUint8(n+3)===71&&e.getUint8(n+4)===13&&e.getUint8(n+5)===10&&e.getUint8(n+6)===26&&e.getUint8(n+7)===10}static getChunkType(e,n){return[String.fromCharCode(e.getUint8(n)),String.fromCharCode(e.getUint8(n+1)),String.fromCharCode(e.getUint8(n+2)),String.fromCharCode(e.getUint8(n+3))].join("")}static readChunks(e,n=0){const r={};if(!fl.isPng(e,n))throw new Error("Not a PNG");for(n+=8;n<=e.buffer.byteLength;){const i=n,o=e.getInt32(n);n+=4;const s=fl.getChunkType(e,n);if(s==="IDAT"&&r[s]){n+=o+G$+Y$;continue}if(s==="IEND")break;r[s]={start:i,dataOffset:n+4,size:o},n+=o+G$+Y$}return r}static parsePhys(e,n){return{ppux:e.getUint32(n),ppuy:e.getUint32(n+4),unit:e.getUint8(n+8)}}static findChunk(e,n){return fl.readChunks(e)[n]}static setPhysChunk(e,n=1,r){let i=46,o=0;const s=fl.findChunk(e,"pHYs");s&&(i=s.start,o=s.size);const a=fl.findChunk(e,"IDAT");a&&(i=a.start,o=0);const l=new ArrayBuffer(21),c=new DataView(l);c.setUint32(0,9),c.setUint8(4,112),c.setUint8(5,72),c.setUint8(6,89),c.setUint8(7,115);const d=2835.5;c.setInt32(8,d*n),c.setInt32(12,d*n),c.setInt8(16,1);const u=new Uint8Array(l.slice(4,17));c.setInt32(17,Yoe(u));const p=e.buffer.slice(0,i),f=e.buffer.slice(i+o);return new Blob([p,l,f],r)}}/*!
 * MIT License: https://github.com/sindresorhus/is-webp/blob/main/license
 * Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)
 */function Xoe(t){return!t||t.length<12?!1:t[8]===87&&t[9]===69&&t[10]===66&&t[11]===80}function Zoe(t){const e=new Uint8Array(t);return!Xoe(e)||!e||e.length<21?!1:(e[20]>>1&1)===1}const i5=Object.freeze(["image/svg+xml"]),o5=Object.freeze(["image/jpeg","image/png","image/webp"]),s5=Object.freeze(["image/gif","image/apng","image/avif"]),Pf=Object.freeze([...o5,...i5,...s5]),zw=Object.freeze(["video/mp4","video/webm","video/quicktime"]),Joe=Object.freeze([...Pf,...zw]);Joe.join(",");class vs{static loadVideo(e){return new Promise((n,r)=>{const i=document.createElement("video");i.onloadeddata=()=>n(i),i.onerror=o=>{console.error(o),r(new Error("Could not load video"))},i.crossOrigin="anonymous",i.src=e})}static async getVideoFrameAsDataUrl(e,n=0){const r=l2();let i=!1;const o=()=>{if(!i)if(e.readyState>=e.HAVE_METADATA)i=!0,e.currentTime=n;else return;if(e.readyState>=e.HAVE_CURRENT_DATA){const a=document.createElement("canvas");a.width=e.videoWidth,a.height=e.videoHeight;const l=a.getContext("2d");if(!l)throw new Error("Could not get 2d context");l.drawImage(e,0,0),r.resolve(a.toDataURL())}},s=a=>{console.error(a),r.reject(new Error("Could not get video frame"))};e.addEventListener("loadedmetadata",o),e.addEventListener("loadeddata",o),e.addEventListener("canplay",o),e.addEventListener("seeked",o),e.addEventListener("error",s),e.addEventListener("stalled",s),o();try{return await r}finally{e.removeEventListener("loadedmetadata",o),e.removeEventListener("loadeddata",o),e.removeEventListener("canplay",o),e.removeEventListener("seeked",o),e.removeEventListener("error",s),e.removeEventListener("stalled",s)}}static getImageAndDimensions(e){return new Promise((n,r)=>{const i=Zm();i.onload=()=>{let o;i.naturalWidth?o={w:i.naturalWidth,h:i.naturalHeight}:(document.body.appendChild(i),o={w:i.clientWidth,h:i.clientHeight},document.body.removeChild(i)),n({...o,image:i})},i.onerror=o=>{console.error(o),r(new Error("Could not load image"))},i.crossOrigin="anonymous",i.referrerPolicy="strict-origin-when-cross-origin",i.style.visibility="hidden",i.style.position="absolute",i.style.opacity="0",i.style.zIndex="-9999",i.src=e})}static async getVideoSize(e){return vs.usingObjectURL(e,async n=>{const r=await vs.loadVideo(n);return{w:r.videoWidth,h:r.videoHeight}})}static async getImageSize(e){const{w:n,h:r}=await vs.usingObjectURL(e,vs.getImageAndDimensions);try{if(e.type==="image/png"){const i=new DataView(await e.arrayBuffer());if(fl.isPng(i,0)){const o=fl.findChunk(i,"pHYs");if(o){const s=fl.parsePhys(i,o.dataOffset);if(s.unit===1&&s.ppux===s.ppuy){const l=Math.max(s.ppux/2834.645669291339,1);return{w:Math.round(n/l),h:Math.round(r/l)}}}}}}catch(i){return console.error(i),{w:n,h:r}}return{w:n,h:r}}static async isAnimated(e){return e.type==="image/gif"?Goe(await e.arrayBuffer()):e.type==="image/avif"?Koe(await e.arrayBuffer()):e.type==="image/webp"?Zoe(await e.arrayBuffer()):e.type==="image/apng"?Voe(await e.arrayBuffer()):!1}static isAnimatedImageType(e){return s5.includes(e||"")}static isStaticImageType(e){return o5.includes(e||"")}static isVectorImageType(e){return i5.includes(e||"")}static isImageType(e){return Pf.includes(e||"")}static async usingObjectURL(e,n){const r=URL.createObjectURL(e);try{return await n(r)}finally{URL.revokeObjectURL(r)}}}function St(t,e,n){return t+(e-t)*n}function Jm(t,e,n){return(n-t)/(e-t)}function xh(t=""){let e=0,n=0,r=0,i=0;function o(){const s=e^e<<11;return e=n,n=r,r=i,i^=(i>>>19^s^s>>>8)>>>0,i/4294967296*2}for(let s=0;s<t.length+64;s++)e^=t.charCodeAt(s)|0,o();return o}function Ha(t,e,n,r=!1){const[i,o]=e,[s,a]=n,l=s+(t-i)/(o-i)*(a-s);return r?s<a?Math.max(Math.min(l,a),s):Math.max(Math.min(l,s),a):l}function sa(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function wr(t,e){if(sa(t,e))return t[e]}function Tm(t){return Object.keys(t)}function ar(t){return Object.values(t)}function go(t){return Object.entries(t)}function a5(t){return Object.fromEntries(t)}function Em(t,e){const n={};let r=!1;for(const[i,o]of go(t))e(i,o)?n[i]=o:r=!0;return r?n:t}function Uu(t,e){const n={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=e(r,t[r]));return n}function l5(t,e){if(t===e)return!0;const n=new Set(Object.keys(t)),r=new Set(Object.keys(e));if(n.size!==r.size)return!1;for(const i of n)if(!r.has(i)||!Object.is(t[i],e[i]))return!1;return!0}function Qoe(t,e){const n=[];for(const r in t)Object.is(t[r],e[r])||n.push(r);return n}function ese(t,e,n=1e-6){return Doe(t,e,(r,i)=>{if(typeof r=="number"&&typeof i=="number")return Math.abs(r-i)<n})}const om={Good:"#40C057",Mid:"#FFC078",Poor:"#E03131"},tse=om.Good;class c5{startTime=0;name="";frames=0;started=!1;frame=null;recordFrame=()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))};start(e){this.name=e,this.frames=0,this.started=!0,this.frame!==null&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,this.frame!==null&&cancelAnimationFrame(this.frame);const e=(performance.now()-this.startTime)/1e3,n=e===0?0:Math.floor(this.frames/e),r=n>55?om.Good:n>30?om.Mid:om.Poor,i=r===om.Mid?"black":"white",o=this.name[0].toUpperCase()+this.name.slice(1);console.debug(`%cPerf%c ${o} %c${n}%c fps`,`color: white; background: ${tse};padding: 2px;border-radius: 3px;`,"font-weight: normal",`font-weight: bold; padding: 2px; background: ${r};color: ${i};`,"font-weight: normal")}isStarted(){return this.started}}const u5="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function $p(t,e,n){const r=n[0];if(e!=null&&t>=e)throw new Error(t+" >= "+e);if(t.slice(-1)===r||e&&e.slice(-1)===r)throw new Error("trailing zero");if(e){let s=0;for(;(t[s]||r)===e[s];)s++;if(s>0)return e.slice(0,s)+$p(t.slice(s),e.slice(s),n)}const i=t?n.indexOf(t[0]):0,o=e!=null?n.indexOf(e[0]):n.length;if(o-i>1){const s=Math.round(.5*(i+o));return n[s]}else return e&&e.length>1?e.slice(0,1):n[i]+$p(t.slice(1),null,n)}function d5(t){if(t.length!==h5(t[0]))throw new Error("invalid integer part of order key: "+t)}function h5(t){if(t>="a"&&t<="z")return t.charCodeAt(0)-97+2;if(t>="A"&&t<="Z")return 90-t.charCodeAt(0)+2;throw new Error("invalid order key head: "+t)}function sm(t){const e=h5(t[0]);if(e>t.length)throw new Error("invalid order key: "+t);return t.slice(0,e)}function X$(t,e){if(t==="A"+e[0].repeat(26))throw new Error("invalid order key: "+t);const n=sm(t);if(t.slice(n.length).slice(-1)===e[0])throw new Error("invalid order key: "+t)}function Z$(t,e){d5(t);const[n,...r]=t.split("");let i=!0;for(let o=r.length-1;i&&o>=0;o--){const s=e.indexOf(r[o])+1;s===e.length?r[o]=e[0]:(r[o]=e[s],i=!1)}if(i){if(n==="Z")return"a"+e[0];if(n==="z")return null;const o=String.fromCharCode(n.charCodeAt(0)+1);return o>"a"?r.push(e[0]):r.pop(),o+r.join("")}else return n+r.join("")}function nse(t,e){d5(t);const[n,...r]=t.split("");let i=!0;for(let o=r.length-1;i&&o>=0;o--){const s=e.indexOf(r[o])-1;s===-1?r[o]=e.slice(-1):(r[o]=e[s],i=!1)}if(i){if(n==="a")return"Z"+e.slice(-1);if(n==="A")return null;const o=String.fromCharCode(n.charCodeAt(0)-1);return o<"Z"?r.push(e.slice(-1)):r.pop(),o+r.join("")}else return n+r.join("")}function du(t,e,n=u5){if(t!=null&&X$(t,n),e!=null&&X$(e,n),t!=null&&e!=null&&t>=e)throw new Error(t+" >= "+e);if(t==null){if(e==null)return"a"+n[0];const l=sm(e),c=e.slice(l.length);if(l==="A"+n[0].repeat(26))return l+$p("",c,n);if(l<e)return l;const d=nse(l,n);if(d==null)throw new Error("cannot decrement any more");return d}if(e==null){const l=sm(t),c=t.slice(l.length),d=Z$(l,n);return d??l+$p(c,null,n)}const r=sm(t),i=t.slice(r.length),o=sm(e),s=e.slice(o.length);if(r===o)return r+$p(i,s,n);const a=Z$(r,n);if(a==null)throw new Error("cannot increment any more");return a<e?a:r+$p(i,null,n)}function QS(t,e,n,r=u5){if(n===0)return[];if(n===1)return[du(t,e,r)];if(e==null){let s=du(t,e,r);const a=[s];for(let l=0;l<n-1;l++)s=du(s,e,r),a.push(s);return a}if(t==null){let s=du(t,e,r);const a=[s];for(let l=0;l<n-1;l++)s=du(t,s,r),a.push(s);return a.reverse(),a}const i=Math.floor(n/2),o=du(t,e,r);return[...QS(t,o,i,r),o,...QS(o,e,n-i-1,r)]}const rse=30,ise=()=>Math.random()<.5;function p5(t,e){if(!Number.isInteger(e))throw new Error(`"${t}" must be an integer, got '${e}'`);if(e<0)throw new Error(`"${t}" must be greater than or equal to 0, got '${e}'`)}function f5(t,e,n){const{digits:r,jitterBits:i=rse,getRandomBit:o=ise}=n??{};p5("jitterBits",i);let s=i,a=t,l=e,c=du(t,e,r);for(;s>0;)(o()?1:0)===1?a=c:l=c,c=du(a,l,r),s--;return c}function ose(t,e,n,r){const{digits:i,jitterBits:o}=r??{};if(p5("n",n),n===0)return[];if(o===0)return QS(t,e,n,i);const s=QS(t,e,n+1,i),a=[];for(let l=0;l<n;l++){const c=s[l],d=s[l+1];a.push(f5(c,d,r))}return a}const Tf=ose,d2="a0";function sse(t){try{f5(t,null)}catch{throw new Error("invalid index: "+t)}}function Gd(t,e,n){return Tf(t??null,e??null,n)}function PI(t,e){return Tf(t??null,null,e)}function rf(t,e){return Tf(t??null,e??null,1)[0]}function na(t=null){return Tf(t,null,1)[0]}function ase(t=null){return Tf(null,t,1)[0]}function Qm(t,e="a1"){return[e,...Tf(e,null,t)]}function Yr(t,e){return t.index<e.index?-1:t.index>e.index?1:0}function lse(t,e){return t.id>e.id?1:-1}function h2(t){try{return localStorage.getItem(t)}catch{return null}}function p2(t,e){try{localStorage.setItem(t,e)}catch{}}function cse(){try{localStorage.clear()}catch{}}function g5(t){try{return sessionStorage.getItem(t)}catch{return null}}function f2(t,e){try{sessionStorage.setItem(t,e)}catch{}}function m5(t){try{sessionStorage.removeItem(t)}catch{}}function use(){try{sessionStorage.clear()}catch{}}const Np=[],dse=60,y5=Math.floor(1e3/dse)*.9;let TI,Ex,EI=-y5;const J$=()=>{const t=Np.splice(0,Np.length);for(const e of t)e()};function v5(t=!1){if(TI)return;const e=Date.now();if(e-EI<y5){TI=requestAnimationFrame(()=>{TI=void 0,v5(!0)});return}if(t){if(Ex)return;EI=e,J$()}else{if(Ex)return;Ex=requestAnimationFrame(()=>{Ex=void 0,EI=e,J$()})}}function g2(t){return Np.includes(t)||(Np.push(t),v5()),()=>{const e=Np.indexOf(t);e>-1&&Np.splice(e,1)}}class hse{timeouts=new Map;intervals=new Map;rafs=new Map;constructor(){this.setTimeout=this.setTimeout.bind(this),this.setInterval=this.setInterval.bind(this),this.requestAnimationFrame=this.requestAnimationFrame.bind(this),this.dispose=this.dispose.bind(this)}setTimeout(e,n,r,...i){const o=window.setTimeout(n,r,i),s=this.timeouts.get(e)??[];return this.timeouts.set(e,[...s,o]),o}setInterval(e,n,r,...i){const o=window.setInterval(n,r,i),s=this.intervals.get(e)??[];return this.intervals.set(e,[...s,o]),o}requestAnimationFrame(e,n){const r=window.requestAnimationFrame(n),i=this.rafs.get(e)??[];return this.rafs.set(e,[...i,r]),r}dispose(e){this.timeouts.get(e)?.forEach(n=>clearTimeout(n)),this.intervals.get(e)?.forEach(n=>clearInterval(n)),this.rafs.get(e)?.forEach(n=>cancelAnimationFrame(n)),this.timeouts.delete(e),this.intervals.delete(e),this.rafs.delete(e)}disposeAll(){for(const e of this.timeouts.keys())this.dispose(e)}forContext(e){return{setTimeout:(n,r,...i)=>this.setTimeout(e,n,r,i),setInterval:(n,r,...i)=>this.setInterval(e,n,r,i),requestAnimationFrame:n=>this.requestAnimationFrame(e,n),dispose:()=>this.dispose(e)}}}const ht=(t,e)=>{try{return new URL(t,e)}catch{return}};function pse(t){return t!==void 0}function fse(){return typeof globalThis<"u"&&globalThis.structuredClone?[globalThis.structuredClone,!0]:typeof global<"u"&&global.structuredClone?[global.structuredClone,!0]:typeof window<"u"&&window.structuredClone?[window.structuredClone,!0]:[t=>t&&JSON.parse(JSON.stringify(t)),!1]}const x5=fse(),fn=x5[0];x5[1];const gse=Object.getPrototypeOf(fn({})),Q$=new Set;function mse(t){Q$.has(t)||(Q$.add(t),console.warn(`[tldraw] ${t}`))}Fu("@tldraw/utils","4.1.1","esm");var eN={},Dg,tN;function Gi(){if(tN)return Dg;tN=1;var t=function(e){return e&&e.Math===Math&&e};return Dg=t(typeof globalThis=="object"&&globalThis)||t(typeof window=="object"&&window)||t(typeof self=="object"&&self)||t(typeof Qr=="object"&&Qr)||t(typeof Dg=="object"&&Dg)||(function(){return this})()||Function("return this")(),Dg}var AI={},MI,nN;function Yi(){return nN||(nN=1,MI=function(t){try{return!!t()}catch{return!0}}),MI}var OI,rN;function Hu(){if(rN)return OI;rN=1;var t=Yi();return OI=!t(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),OI}var DI,iN;function Fw(){if(iN)return DI;iN=1;var t=Yi();return DI=!t(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),DI}var jI,oN;function wc(){if(oN)return jI;oN=1;var t=Fw(),e=Function.prototype.call;return jI=t?e.bind(e):function(){return e.apply(e,arguments)},jI}var RI={},sN;function yse(){if(sN)return RI;sN=1;var t={}.propertyIsEnumerable,e=Object.getOwnPropertyDescriptor,n=e&&!t.call({1:2},1);return RI.f=n?function(i){var o=e(this,i);return!!o&&o.enumerable}:t,RI}var $I,aN;function S5(){return aN||(aN=1,$I=function(t,e){return{enumerable:!(t&1),configurable:!(t&2),writable:!(t&4),value:e}}),$I}var NI,lN;function ii(){if(lN)return NI;lN=1;var t=Fw(),e=Function.prototype,n=e.call,r=t&&e.bind.bind(n,n);return NI=t?r:function(i){return function(){return n.apply(i,arguments)}},NI}var LI,cN;function Ef(){if(cN)return LI;cN=1;var t=ii(),e=t({}.toString),n=t("".slice);return LI=function(r){return n(e(r),8,-1)},LI}var zI,uN;function vse(){if(uN)return zI;uN=1;var t=ii(),e=Yi(),n=Ef(),r=Object,i=t("".split);return zI=e(function(){return!r("z").propertyIsEnumerable(0)})?function(o){return n(o)==="String"?i(o,""):r(o)}:r,zI}var FI,dN;function b5(){return dN||(dN=1,FI=function(t){return t==null}),FI}var BI,hN;function Af(){if(hN)return BI;hN=1;var t=b5(),e=TypeError;return BI=function(n){if(t(n))throw new e("Can't call method on "+n);return n},BI}var UI,pN;function Bw(){if(pN)return UI;pN=1;var t=vse(),e=Af();return UI=function(n){return t(e(n))},UI}var HI,fN;function _o(){if(fN)return HI;fN=1;var t=typeof document=="object"&&document.all;return HI=typeof t>"u"&&t!==void 0?function(e){return typeof e=="function"||e===t}:function(e){return typeof e=="function"},HI}var WI,gN;function kc(){if(gN)return WI;gN=1;var t=_o();return WI=function(e){return typeof e=="object"?e!==null:t(e)},WI}var VI,mN;function Uw(){if(mN)return VI;mN=1;var t=Gi(),e=_o(),n=function(r){return e(r)?r:void 0};return VI=function(r,i){return arguments.length<2?n(t[r]):t[r]&&t[r][i]},VI}var KI,yN;function w5(){if(yN)return KI;yN=1;var t=ii();return KI=t({}.isPrototypeOf),KI}var qI,vN;function xse(){if(vN)return qI;vN=1;var t=Gi(),e=t.navigator,n=e&&e.userAgent;return qI=n?String(n):"",qI}var GI,xN;function Sse(){if(xN)return GI;xN=1;var t=Gi(),e=xse(),n=t.process,r=t.Deno,i=n&&n.versions||r&&r.version,o=i&&i.v8,s,a;return o&&(s=o.split("."),a=s[0]>0&&s[0]<4?1:+(s[0]+s[1])),!a&&e&&(s=e.match(/Edge\/(\d+)/),(!s||s[1]>=74)&&(s=e.match(/Chrome\/(\d+)/),s&&(a=+s[1]))),GI=a,GI}var YI,SN;function k5(){if(SN)return YI;SN=1;var t=Sse(),e=Yi(),n=Gi(),r=n.String;return YI=!!Object.getOwnPropertySymbols&&!e(function(){var i=Symbol("symbol detection");return!r(i)||!(Object(i)instanceof Symbol)||!Symbol.sham&&t&&t<41}),YI}var XI,bN;function I5(){if(bN)return XI;bN=1;var t=k5();return XI=t&&!Symbol.sham&&typeof Symbol.iterator=="symbol",XI}var ZI,wN;function _5(){if(wN)return ZI;wN=1;var t=Uw(),e=_o(),n=w5(),r=I5(),i=Object;return ZI=r?function(o){return typeof o=="symbol"}:function(o){var s=t("Symbol");return e(s)&&n(s.prototype,i(o))},ZI}var JI,kN;function bse(){if(kN)return JI;kN=1;var t=String;return JI=function(e){try{return t(e)}catch{return"Object"}},JI}var QI,IN;function m2(){if(IN)return QI;IN=1;var t=_o(),e=bse(),n=TypeError;return QI=function(r){if(t(r))return r;throw new n(e(r)+" is not a function")},QI}var e_,_N;function y2(){if(_N)return e_;_N=1;var t=m2(),e=b5();return e_=function(n,r){var i=n[r];return e(i)?void 0:t(i)},e_}var t_,CN;function wse(){if(CN)return t_;CN=1;var t=wc(),e=_o(),n=kc(),r=TypeError;return t_=function(i,o){var s,a;if(o==="string"&&e(s=i.toString)&&!n(a=t(s,i))||e(s=i.valueOf)&&!n(a=t(s,i))||o!=="string"&&e(s=i.toString)&&!n(a=t(s,i)))return a;throw new r("Can't convert object to primitive value")},t_}var n_={exports:{}},r_,PN;function C5(){return PN||(PN=1,r_=!1),r_}var i_,TN;function v2(){if(TN)return i_;TN=1;var t=Gi(),e=Object.defineProperty;return i_=function(n,r){try{e(t,n,{value:r,configurable:!0,writable:!0})}catch{t[n]=r}return r},i_}var EN;function x2(){if(EN)return n_.exports;EN=1;var t=C5(),e=Gi(),n=v2(),r="__core-js_shared__",i=n_.exports=e[r]||n(r,{});return(i.versions||(i.versions=[])).push({version:"3.46.0",mode:t?"pure":"global",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru), 2025 CoreJS Company (core-js.io)",license:"https://github.com/zloirock/core-js/blob/v3.46.0/LICENSE",source:"https://github.com/zloirock/core-js"}),n_.exports}var o_,AN;function S2(){if(AN)return o_;AN=1;var t=x2();return o_=function(e,n){return t[e]||(t[e]=n||{})},o_}var s_,MN;function Ny(){if(MN)return s_;MN=1;var t=Af(),e=Object;return s_=function(n){return e(t(n))},s_}var a_,ON;function Wu(){if(ON)return a_;ON=1;var t=ii(),e=Ny(),n=t({}.hasOwnProperty);return a_=Object.hasOwn||function(i,o){return n(e(i),o)},a_}var l_,DN;function P5(){if(DN)return l_;DN=1;var t=ii(),e=0,n=Math.random(),r=t(1.1.toString);return l_=function(i){return"Symbol("+(i===void 0?"":i)+")_"+r(++e+n,36)},l_}var c_,jN;function Ic(){if(jN)return c_;jN=1;var t=Gi(),e=S2(),n=Wu(),r=P5(),i=k5(),o=I5(),s=t.Symbol,a=e("wks"),l=o?s.for||s:s&&s.withoutSetter||r;return c_=function(c){return n(a,c)||(a[c]=i&&n(s,c)?s[c]:l("Symbol."+c)),a[c]},c_}var u_,RN;function kse(){if(RN)return u_;RN=1;var t=wc(),e=kc(),n=_5(),r=y2(),i=wse(),o=Ic(),s=TypeError,a=o("toPrimitive");return u_=function(l,c){if(!e(l)||n(l))return l;var d=r(l,a),u;if(d){if(c===void 0&&(c="default"),u=t(d,l,c),!e(u)||n(u))return u;throw new s("Can't convert object to primitive value")}return c===void 0&&(c="number"),i(l,c)},u_}var d_,$N;function T5(){if($N)return d_;$N=1;var t=kse(),e=_5();return d_=function(n){var r=t(n,"string");return e(r)?r:r+""},d_}var h_,NN;function E5(){if(NN)return h_;NN=1;var t=Gi(),e=kc(),n=t.document,r=e(n)&&e(n.createElement);return h_=function(i){return r?n.createElement(i):{}},h_}var p_,LN;function A5(){if(LN)return p_;LN=1;var t=Hu(),e=Yi(),n=E5();return p_=!t&&!e(function(){return Object.defineProperty(n("div"),"a",{get:function(){return 7}}).a!==7}),p_}var zN;function M5(){if(zN)return AI;zN=1;var t=Hu(),e=wc(),n=yse(),r=S5(),i=Bw(),o=T5(),s=Wu(),a=A5(),l=Object.getOwnPropertyDescriptor;return AI.f=t?l:function(d,u){if(d=i(d),u=o(u),a)try{return l(d,u)}catch{}if(s(d,u))return r(!e(n.f,d,u),d[u])},AI}var f_={},g_,FN;function O5(){if(FN)return g_;FN=1;var t=Hu(),e=Yi();return g_=t&&e(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),g_}var m_,BN;function Sh(){if(BN)return m_;BN=1;var t=kc(),e=String,n=TypeError;return m_=function(r){if(t(r))return r;throw new n(e(r)+" is not an object")},m_}var UN;function Ly(){if(UN)return f_;UN=1;var t=Hu(),e=A5(),n=O5(),r=Sh(),i=T5(),o=TypeError,s=Object.defineProperty,a=Object.getOwnPropertyDescriptor,l="enumerable",c="configurable",d="writable";return f_.f=t?n?function(p,f,y){if(r(p),f=i(f),r(y),typeof p=="function"&&f==="prototype"&&"value"in y&&d in y&&!y[d]){var v=a(p,f);v&&v[d]&&(p[f]=y.value,y={configurable:c in y?y[c]:v[c],enumerable:l in y?y[l]:v[l],writable:!1})}return s(p,f,y)}:s:function(p,f,y){if(r(p),f=i(f),r(y),e)try{return s(p,f,y)}catch{}if("get"in y||"set"in y)throw new o("Accessors not supported");return"value"in y&&(p[f]=y.value),p},f_}var y_,HN;function b2(){if(HN)return y_;HN=1;var t=Hu(),e=Ly(),n=S5();return y_=t?function(r,i,o){return e.f(r,i,n(1,o))}:function(r,i,o){return r[i]=o,r},y_}var v_={exports:{}},x_,WN;function Ise(){if(WN)return x_;WN=1;var t=Hu(),e=Wu(),n=Function.prototype,r=t&&Object.getOwnPropertyDescriptor,i=e(n,"name"),o=i&&(function(){}).name==="something",s=i&&(!t||t&&r(n,"name").configurable);return x_={EXISTS:i,PROPER:o,CONFIGURABLE:s},x_}var S_,VN;function D5(){if(VN)return S_;VN=1;var t=ii(),e=_o(),n=x2(),r=t(Function.toString);return e(n.inspectSource)||(n.inspectSource=function(i){return r(i)}),S_=n.inspectSource,S_}var b_,KN;function _se(){if(KN)return b_;KN=1;var t=Gi(),e=_o(),n=t.WeakMap;return b_=e(n)&&/native code/.test(String(n)),b_}var w_,qN;function j5(){if(qN)return w_;qN=1;var t=S2(),e=P5(),n=t("keys");return w_=function(r){return n[r]||(n[r]=e(r))},w_}var k_,GN;function w2(){return GN||(GN=1,k_={}),k_}var I_,YN;function R5(){if(YN)return I_;YN=1;var t=_se(),e=Gi(),n=kc(),r=b2(),i=Wu(),o=x2(),s=j5(),a=w2(),l="Object already initialized",c=e.TypeError,d=e.WeakMap,u,p,f,y=function(w){return f(w)?p(w):u(w,{})},v=function(w){return function(_){var C;if(!n(_)||(C=p(_)).type!==w)throw new c("Incompatible receiver, "+w+" required");return C}};if(t||o.state){var x=o.state||(o.state=new d);x.get=x.get,x.has=x.has,x.set=x.set,u=function(w,_){if(x.has(w))throw new c(l);return _.facade=w,x.set(w,_),_},p=function(w){return x.get(w)||{}},f=function(w){return x.has(w)}}else{var b=s("state");a[b]=!0,u=function(w,_){if(i(w,b))throw new c(l);return _.facade=w,r(w,b,_),_},p=function(w){return i(w,b)?w[b]:{}},f=function(w){return i(w,b)}}return I_={set:u,get:p,has:f,enforce:y,getterFor:v},I_}var XN;function Cse(){if(XN)return v_.exports;XN=1;var t=ii(),e=Yi(),n=_o(),r=Wu(),i=Hu(),o=Ise().CONFIGURABLE,s=D5(),a=R5(),l=a.enforce,c=a.get,d=String,u=Object.defineProperty,p=t("".slice),f=t("".replace),y=t([].join),v=i&&!e(function(){return u(function(){},"length",{value:8}).length!==8}),x=String(String).split("String"),b=v_.exports=function(w,_,C){p(d(_),0,7)==="Symbol("&&(_="["+f(d(_),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),C&&C.getter&&(_="get "+_),C&&C.setter&&(_="set "+_),(!r(w,"name")||o&&w.name!==_)&&(i?u(w,"name",{value:_,configurable:!0}):w.name=_),v&&C&&r(C,"arity")&&w.length!==C.arity&&u(w,"length",{value:C.arity});try{C&&r(C,"constructor")&&C.constructor?i&&u(w,"prototype",{writable:!1}):w.prototype&&(w.prototype=void 0)}catch{}var A=l(w);return r(A,"source")||(A.source=y(x,typeof _=="string"?_:"")),w};return Function.prototype.toString=b(function(){return n(this)&&c(this).source||s(this)},"toString"),v_.exports}var __,ZN;function $5(){if(ZN)return __;ZN=1;var t=_o(),e=Ly(),n=Cse(),r=v2();return __=function(i,o,s,a){a||(a={});var l=a.enumerable,c=a.name!==void 0?a.name:o;if(t(s)&&n(s,c,a),a.global)l?i[o]=s:r(o,s);else{try{a.unsafe?i[o]&&(l=!0):delete i[o]}catch{}l?i[o]=s:e.f(i,o,{value:s,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return i},__}var C_={},P_,JN;function Pse(){if(JN)return P_;JN=1;var t=Math.ceil,e=Math.floor;return P_=Math.trunc||function(r){var i=+r;return(i>0?e:t)(i)},P_}var T_,QN;function bh(){if(QN)return T_;QN=1;var t=Pse();return T_=function(e){var n=+e;return n!==n||n===0?0:t(n)},T_}var E_,eL;function Tse(){if(eL)return E_;eL=1;var t=bh(),e=Math.max,n=Math.min;return E_=function(r,i){var o=t(r);return o<0?e(o+i,0):n(o,i)},E_}var A_,tL;function N5(){if(tL)return A_;tL=1;var t=bh(),e=Math.min;return A_=function(n){var r=t(n);return r>0?e(r,9007199254740991):0},A_}var M_,nL;function zy(){if(nL)return M_;nL=1;var t=N5();return M_=function(e){return t(e.length)},M_}var O_,rL;function Ese(){if(rL)return O_;rL=1;var t=Bw(),e=Tse(),n=zy(),r=function(i){return function(o,s,a){var l=t(o),c=n(l);if(c===0)return!i&&-1;var d=e(a,c),u;if(i&&s!==s){for(;c>d;)if(u=l[d++],u!==u)return!0}else for(;c>d;d++)if((i||d in l)&&l[d]===s)return i||d||0;return!i&&-1}};return O_={includes:r(!0),indexOf:r(!1)},O_}var D_,iL;function L5(){if(iL)return D_;iL=1;var t=ii(),e=Wu(),n=Bw(),r=Ese().indexOf,i=w2(),o=t([].push);return D_=function(s,a){var l=n(s),c=0,d=[],u;for(u in l)!e(i,u)&&e(l,u)&&o(d,u);for(;a.length>c;)e(l,u=a[c++])&&(~r(d,u)||o(d,u));return d},D_}var j_,oL;function k2(){return oL||(oL=1,j_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),j_}var sL;function Ase(){if(sL)return C_;sL=1;var t=L5(),e=k2(),n=e.concat("length","prototype");return C_.f=Object.getOwnPropertyNames||function(i){return t(i,n)},C_}var R_={},aL;function Mse(){return aL||(aL=1,R_.f=Object.getOwnPropertySymbols),R_}var $_,lL;function Ose(){if(lL)return $_;lL=1;var t=Uw(),e=ii(),n=Ase(),r=Mse(),i=Sh(),o=e([].concat);return $_=t("Reflect","ownKeys")||function(a){var l=n.f(i(a)),c=r.f;return c?o(l,c(a)):l},$_}var N_,cL;function Dse(){if(cL)return N_;cL=1;var t=Wu(),e=Ose(),n=M5(),r=Ly();return N_=function(i,o,s){for(var a=e(o),l=r.f,c=n.f,d=0;d<a.length;d++){var u=a[d];!t(i,u)&&!(s&&t(s,u))&&l(i,u,c(o,u))}},N_}var L_,uL;function jse(){if(uL)return L_;uL=1;var t=Yi(),e=_o(),n=/#|\.prototype\./,r=function(l,c){var d=o[i(l)];return d===a?!0:d===s?!1:e(c)?t(c):!!c},i=r.normalize=function(l){return String(l).replace(n,".").toLowerCase()},o=r.data={},s=r.NATIVE="N",a=r.POLYFILL="P";return L_=r,L_}var z_,dL;function Mf(){if(dL)return z_;dL=1;var t=Gi(),e=M5().f,n=b2(),r=$5(),i=v2(),o=Dse(),s=jse();return z_=function(a,l){var c=a.target,d=a.global,u=a.stat,p,f,y,v,x,b;if(d?f=t:u?f=t[c]||i(c,{}):f=t[c]&&t[c].prototype,f)for(y in l){if(x=l[y],a.dontCallGetSet?(b=e(f,y),v=b&&b.value):v=f[y],p=s(d?y:c+(u?".":"#")+y,a.forced),!p&&v!==void 0){if(typeof x==typeof v)continue;o(x,v)}(a.sham||v&&v.sham)&&n(x,"sham",!0),r(f,y,x,a)}},z_}var F_={},B_,hL;function Rse(){if(hL)return B_;hL=1;var t=L5(),e=k2();return B_=Object.keys||function(r){return t(r,e)},B_}var pL;function $se(){if(pL)return F_;pL=1;var t=Hu(),e=O5(),n=Ly(),r=Sh(),i=Bw(),o=Rse();return F_.f=t&&!e?Object.defineProperties:function(a,l){r(a);for(var c=i(l),d=o(l),u=d.length,p=0,f;u>p;)n.f(a,f=d[p++],c[f]);return a},F_}var U_,fL;function Nse(){if(fL)return U_;fL=1;var t=Uw();return U_=t("document","documentElement"),U_}var H_,gL;function z5(){if(gL)return H_;gL=1;var t=Sh(),e=$se(),n=k2(),r=w2(),i=Nse(),o=E5(),s=j5(),a=">",l="<",c="prototype",d="script",u=s("IE_PROTO"),p=function(){},f=function(w){return l+d+a+w+l+"/"+d+a},y=function(w){w.write(f("")),w.close();var _=w.parentWindow.Object;return w=null,_},v=function(){var w=o("iframe"),_="java"+d+":",C;return w.style.display="none",i.appendChild(w),w.src=String(_),C=w.contentWindow.document,C.open(),C.write(f("document.F=Object")),C.close(),C.F},x,b=function(){try{x=new ActiveXObject("htmlfile")}catch{}b=typeof document<"u"?document.domain&&x?y(x):v():y(x);for(var w=n.length;w--;)delete b[c][n[w]];return b()};return r[u]=!0,H_=Object.create||function(_,C){var A;return _!==null?(p[c]=t(_),A=new p,p[c]=null,A[u]=_):A=b(),C===void 0?A:e.f(A,C)},H_}var W_,mL;function I2(){if(mL)return W_;mL=1;var t=Ic(),e=z5(),n=Ly().f,r=t("unscopables"),i=Array.prototype;return i[r]===void 0&&n(i,r,{configurable:!0,value:e(null)}),W_=function(o){i[r][o]=!0},W_}var yL;function Lse(){if(yL)return eN;yL=1;var t=Mf(),e=Ny(),n=zy(),r=bh(),i=I2();return t({target:"Array",proto:!0},{at:function(s){var a=e(this),l=n(a),c=r(s),d=c>=0?c:l+c;return d<0||d>=l?void 0:a[d]}}),i("at"),eN}var V_,vL;function Fy(){if(vL)return V_;vL=1;var t=Gi(),e=ii();return V_=function(n,r){return e(t[n].prototype[r])},V_}var K_,xL;function zse(){if(xL)return K_;xL=1,Lse();var t=Fy();return K_=t("Array","at"),K_}var q_,SL;function Fse(){if(SL)return q_;SL=1;var t=zse();return q_=t,q_}Fse();var bL={},G_,wL;function F5(){if(wL)return G_;wL=1;var t=Ef();return G_=Array.isArray||function(n){return t(n)==="Array"},G_}var Y_,kL;function Bse(){if(kL)return Y_;kL=1;var t=TypeError,e=9007199254740991;return Y_=function(n){if(n>e)throw t("Maximum allowed index exceeded");return n},Y_}var X_,IL;function Use(){if(IL)return X_;IL=1;var t=Ef(),e=ii();return X_=function(n){if(t(n)==="Function")return e(n)},X_}var Z_,_L;function Hse(){if(_L)return Z_;_L=1;var t=Use(),e=m2(),n=Fw(),r=t(t.bind);return Z_=function(i,o){return e(i),o===void 0?i:n?r(i,o):function(){return i.apply(o,arguments)}},Z_}var J_,CL;function B5(){if(CL)return J_;CL=1;var t=F5(),e=zy(),n=Bse(),r=Hse(),i=function(o,s,a,l,c,d,u,p){for(var f=c,y=0,v=u?r(u,p):!1,x,b;y<l;)y in a&&(x=v?v(a[y],y,s):a[y],d>0&&t(x)?(b=e(x),f=i(o,s,x,b,f,d-1)-1):(n(f+1),o[f]=x),f++),y++;return f};return J_=i,J_}var Q_,PL;function Wse(){if(PL)return Q_;PL=1;var t=Ic(),e=t("toStringTag"),n={};return n[e]="z",Q_=String(n)==="[object z]",Q_}var eC,TL;function U5(){if(TL)return eC;TL=1;var t=Wse(),e=_o(),n=Ef(),r=Ic(),i=r("toStringTag"),o=Object,s=n((function(){return arguments})())==="Arguments",a=function(l,c){try{return l[c]}catch{}};return eC=t?n:function(l){var c,d,u;return l===void 0?"Undefined":l===null?"Null":typeof(d=a(c=o(l),i))=="string"?d:s?n(c):(u=n(c))==="Object"&&e(c.callee)?"Arguments":u},eC}var tC,EL;function Vse(){if(EL)return tC;EL=1;var t=ii(),e=Yi(),n=_o(),r=U5(),i=Uw(),o=D5(),s=function(){},a=i("Reflect","construct"),l=/^\s*(?:class|function)\b/,c=t(l.exec),d=!l.test(s),u=function(y){if(!n(y))return!1;try{return a(s,[],y),!0}catch{return!1}},p=function(y){if(!n(y))return!1;switch(r(y)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return d||!!c(l,o(y))}catch{return!0}};return p.sham=!0,tC=!a||e(function(){var f;return u(u.call)||!u(Object)||!u(function(){f=!0})||f})?p:u,tC}var nC,AL;function Kse(){if(AL)return nC;AL=1;var t=F5(),e=Vse(),n=kc(),r=Ic(),i=r("species"),o=Array;return nC=function(s){var a;return t(s)&&(a=s.constructor,e(a)&&(a===o||t(a.prototype))?a=void 0:n(a)&&(a=a[i],a===null&&(a=void 0))),a===void 0?o:a},nC}var rC,ML;function H5(){if(ML)return rC;ML=1;var t=Kse();return rC=function(e,n){return new(t(e))(n===0?0:n)},rC}var OL;function qse(){if(OL)return bL;OL=1;var t=Mf(),e=B5(),n=m2(),r=Ny(),i=zy(),o=H5();return t({target:"Array",proto:!0},{flatMap:function(a){var l=r(this),c=i(l),d;return n(a),d=o(l,0),d.length=e(d,l,l,c,0,1,a,arguments.length>1?arguments[1]:void 0),d}}),bL}var DL={},jL;function Gse(){if(jL)return DL;jL=1;var t=I2();return t("flatMap"),DL}var iC,RL;function Yse(){if(RL)return iC;RL=1,qse(),Gse();var t=Fy();return iC=t("Array","flatMap"),iC}var oC,$L;function Xse(){if($L)return oC;$L=1;var t=Yse();return oC=t,oC}Xse();var NL={},LL;function Zse(){if(LL)return NL;LL=1;var t=Mf(),e=B5(),n=Ny(),r=zy(),i=bh(),o=H5();return t({target:"Array",proto:!0},{flat:function(){var a=arguments.length?arguments[0]:void 0,l=n(this),c=r(l),d=o(l,0);return d.length=e(d,l,l,c,0,a===void 0?1:i(a)),d}}),NL}var zL={},FL;function Jse(){if(FL)return zL;FL=1;var t=I2();return t("flat"),zL}var sC,BL;function Qse(){if(BL)return sC;BL=1,Zse(),Jse();var t=Fy();return sC=t("Array","flat"),sC}var aC,UL;function eae(){if(UL)return aC;UL=1;var t=Qse();return aC=t,aC}eae();var HL={},lC,WL;function By(){if(WL)return lC;WL=1;var t=U5(),e=String;return lC=function(n){if(t(n)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return e(n)},lC}var VL;function tae(){if(VL)return HL;VL=1;var t=Mf(),e=ii(),n=Af(),r=bh(),i=By(),o=Yi(),s=e("".charAt),a=o(function(){return"𠮷".at(-2)!=="\uD842"});return t({target:"String",proto:!0,forced:a},{at:function(c){var d=i(n(this)),u=d.length,p=r(c),f=p>=0?p:u+p;return f<0||f>=u?void 0:s(d,f)}}),HL}var cC,KL;function nae(){if(KL)return cC;KL=1,tae();var t=Fy();return cC=t("String","at"),cC}var uC,qL;function rae(){if(qL)return uC;qL=1;var t=nae();return uC=t,uC}rae();var GL={},dC,YL;function W5(){if(YL)return dC;YL=1;var t=Sh();return dC=function(){var e=t(this),n="";return e.hasIndices&&(n+="d"),e.global&&(n+="g"),e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),e.dotAll&&(n+="s"),e.unicode&&(n+="u"),e.unicodeSets&&(n+="v"),e.sticky&&(n+="y"),n},dC}var hC,XL;function iae(){if(XL)return hC;XL=1;var t=Yi(),e=Gi(),n=e.RegExp,r=t(function(){var s=n("a","y");return s.lastIndex=2,s.exec("abcd")!==null}),i=r||t(function(){return!n("a","y").sticky}),o=r||t(function(){var s=n("^r","gy");return s.lastIndex=2,s.exec("str")!==null});return hC={BROKEN_CARET:o,MISSED_STICKY:i,UNSUPPORTED_Y:r},hC}var pC,ZL;function oae(){if(ZL)return pC;ZL=1;var t=Yi(),e=Gi(),n=e.RegExp;return pC=t(function(){var r=n(".","s");return!(r.dotAll&&r.test(`
`)&&r.flags==="s")}),pC}var fC,JL;function sae(){if(JL)return fC;JL=1;var t=Yi(),e=Gi(),n=e.RegExp;return fC=t(function(){var r=n("(?<a>b)","g");return r.exec("b").groups.a!=="b"||"b".replace(r,"$<a>c")!=="bc"}),fC}var gC,QL;function _2(){if(QL)return gC;QL=1;var t=wc(),e=ii(),n=By(),r=W5(),i=iae(),o=S2(),s=z5(),a=R5().get,l=oae(),c=sae(),d=o("native-string-replace",String.prototype.replace),u=RegExp.prototype.exec,p=u,f=e("".charAt),y=e("".indexOf),v=e("".replace),x=e("".slice),b=(function(){var A=/a/,E=/b*/g;return t(u,A,"a"),t(u,E,"a"),A.lastIndex!==0||E.lastIndex!==0})(),w=i.BROKEN_CARET,_=/()??/.exec("")[1]!==void 0,C=b||_||w||l||c;return C&&(p=function(E){var O=this,D=a(O),B=n(E),L=D.raw,j,F,z,$,V,Y,re;if(L)return L.lastIndex=O.lastIndex,j=t(p,L,B),O.lastIndex=L.lastIndex,j;var q=D.groups,X=w&&O.sticky,N=t(r,O),H=O.source,ie=0,U=B;if(X&&(N=v(N,"y",""),y(N,"g")===-1&&(N+="g"),U=x(B,O.lastIndex),O.lastIndex>0&&(!O.multiline||O.multiline&&f(B,O.lastIndex-1)!==`
`)&&(H="(?: "+H+")",U=" "+U,ie++),F=new RegExp("^(?:"+H+")",N)),_&&(F=new RegExp("^"+H+"$(?!\\s)",N)),b&&(z=O.lastIndex),$=t(u,X?F:O,U),X?$?($.input=x($.input,ie),$[0]=x($[0],ie),$.index=O.lastIndex,O.lastIndex+=$[0].length):O.lastIndex=0:b&&$&&(O.lastIndex=O.global?$.index+$[0].length:z),_&&$&&$.length>1&&t(d,$[0],F,function(){for(V=1;V<arguments.length-2;V++)arguments[V]===void 0&&($[V]=void 0)}),$&&q)for($.groups=Y=s(null),V=0;V<q.length;V++)re=q[V],Y[re[0]]=$[re[1]];return $}),gC=p,gC}var ez;function V5(){if(ez)return GL;ez=1;var t=Mf(),e=_2();return t({target:"RegExp",proto:!0,forced:/./.exec!==e},{exec:e}),GL}var tz={},mC,nz;function aae(){if(nz)return mC;nz=1;var t=Fw(),e=Function.prototype,n=e.apply,r=e.call;return mC=typeof Reflect=="object"&&Reflect.apply||(t?r.bind(n):function(){return r.apply(n,arguments)}),mC}var yC,rz;function lae(){if(rz)return yC;rz=1,V5();var t=wc(),e=$5(),n=_2(),r=Yi(),i=Ic(),o=b2(),s=i("species"),a=RegExp.prototype;return yC=function(l,c,d,u){var p=i(l),f=!r(function(){var b={};return b[p]=function(){return 7},""[l](b)!==7}),y=f&&!r(function(){var b=!1,w=/a/;return l==="split"&&(w={},w.constructor={},w.constructor[s]=function(){return w},w.flags="",w[p]=/./[p]),w.exec=function(){return b=!0,null},w[p](""),!b});if(!f||!y||d){var v=/./[p],x=c(p,""[l],function(b,w,_,C,A){var E=w.exec;return E===n||E===a.exec?f&&!A?{done:!0,value:t(v,w,_,C)}:{done:!0,value:t(b,_,w,C)}:{done:!1}});e(String.prototype,l,x[0]),e(a,p,x[1])}u&&o(a[p],"sham",!0)},yC}var vC,iz;function cae(){if(iz)return vC;iz=1;var t=ii(),e=bh(),n=By(),r=Af(),i=t("".charAt),o=t("".charCodeAt),s=t("".slice),a=function(l){return function(c,d){var u=n(r(c)),p=e(d),f=u.length,y,v;return p<0||p>=f?l?"":void 0:(y=o(u,p),y<55296||y>56319||p+1===f||(v=o(u,p+1))<56320||v>57343?l?i(u,p):y:l?s(u,p,p+2):(y-55296<<10)+(v-56320)+65536)}};return vC={codeAt:a(!1),charAt:a(!0)},vC}var xC,oz;function uae(){if(oz)return xC;oz=1;var t=cae().charAt;return xC=function(e,n,r){return n+(r?t(e,n).length:1)},xC}var SC,sz;function K5(){if(sz)return SC;sz=1;var t=ii(),e=Ny(),n=Math.floor,r=t("".charAt),i=t("".replace),o=t("".slice),s=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,a=/\$([$&'`]|\d{1,2})/g;return SC=function(l,c,d,u,p,f){var y=d+l.length,v=u.length,x=a;return p!==void 0&&(p=e(p),x=s),i(f,x,function(b,w){var _;switch(r(w,0)){case"$":return"$";case"&":return l;case"`":return o(c,0,d);case"'":return o(c,y);case"<":_=p[o(w,1,-1)];break;default:var C=+w;if(C===0)return b;if(C>v){var A=n(C/10);return A===0?b:A<=v?u[A-1]===void 0?r(w,1):u[A-1]+r(w,1):b}_=u[C-1]}return _===void 0?"":_})},SC}var bC,az;function dae(){if(az)return bC;az=1;var t=Gi(),e=Yi(),n=t.RegExp,r=!e(function(){var i=!0;try{n(".","d")}catch{i=!1}var o={},s="",a=i?"dgimsy":"gimsy",l=function(p,f){Object.defineProperty(o,p,{get:function(){return s+=f,!0}})},c={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};i&&(c.hasIndices="d");for(var d in c)l(d,c[d]);var u=Object.getOwnPropertyDescriptor(n.prototype,"flags").get.call(o);return u!==a||s!==a});return bC={correct:r},bC}var wC,lz;function q5(){if(lz)return wC;lz=1;var t=wc(),e=Wu(),n=w5(),r=dae(),i=W5(),o=RegExp.prototype;return wC=r.correct?function(s){return s.flags}:function(s){return!r.correct&&n(o,s)&&!e(s,"flags")?t(i,s):s.flags},wC}var kC,cz;function hae(){if(cz)return kC;cz=1;var t=wc(),e=Sh(),n=_o(),r=Ef(),i=_2(),o=TypeError;return kC=function(s,a){var l=s.exec;if(n(l)){var c=t(l,s,a);return c!==null&&e(c),c}if(r(s)==="RegExp")return t(i,s,a);throw new o("RegExp#exec called on incompatible receiver")},kC}var uz;function pae(){if(uz)return tz;uz=1;var t=aae(),e=wc(),n=ii(),r=lae(),i=Yi(),o=Sh(),s=_o(),a=kc(),l=bh(),c=N5(),d=By(),u=Af(),p=uae(),f=y2(),y=K5(),v=q5(),x=hae(),b=Ic(),w=b("replace"),_=Math.max,C=Math.min,A=n([].concat),E=n([].push),O=n("".indexOf),D=n("".slice),B=function(z){return z===void 0?z:String(z)},L=(function(){return"a".replace(/./,"$0")==="$0"})(),j=(function(){return/./[w]?/./[w]("a","$0")==="":!1})(),F=!i(function(){var z=/./;return z.exec=function(){var $=[];return $.groups={a:"7"},$},"".replace(z,"$<a>")!=="7"});return r("replace",function(z,$,V){var Y=j?"$":"$0";return[function(q,X){var N=u(this),H=a(q)?f(q,w):void 0;return H?e(H,q,N,X):e($,d(N),q,X)},function(re,q){var X=o(this),N=d(re);if(typeof q=="string"&&O(q,Y)===-1&&O(q,"$<")===-1){var H=V($,X,N,q);if(H.done)return H.value}var ie=s(q);ie||(q=d(q));var U=d(v(X)),ke=O(U,"g")!==-1,ge;ke&&(ge=O(U,"u")!==-1,X.lastIndex=0);for(var Te=[],ye;ye=x(X,N),!(ye===null||(E(Te,ye),!ke));){var Se=d(ye[0]);Se===""&&(X.lastIndex=p(N,c(X.lastIndex),ge))}for(var Re="",$e=0,Ft=0;Ft<Te.length;Ft++){ye=Te[Ft];for(var rn=d(ye[0]),Dt=_(C(l(ye.index),N.length),0),Kt=[],Gt,Gn=1;Gn<ye.length;Gn++)E(Kt,B(ye[Gn]));var Ln=ye.groups;if(ie){var Pr=A([rn],Kt,Dt,N);Ln!==void 0&&E(Pr,Ln),Gt=d(t(q,void 0,Pr))}else Gt=y(rn,N,Dt,Kt,Ln,q);Dt>=$e&&(Re+=D(N,$e,Dt)+Gt,$e=Dt+rn.length)}return Re+D(N,$e)}]},!F||!L||j),tz}var dz={},IC,hz;function fae(){if(hz)return IC;hz=1;var t=kc(),e=Ef(),n=Ic(),r=n("match");return IC=function(i){var o;return t(i)&&((o=i[r])!==void 0?!!o:e(i)==="RegExp")},IC}var pz;function gae(){if(pz)return dz;pz=1;var t=Mf(),e=wc(),n=ii(),r=Af(),i=_o(),o=kc(),s=fae(),a=By(),l=y2(),c=q5(),d=K5(),u=Ic(),p=C5(),f=u("replace"),y=TypeError,v=n("".indexOf),x=n("".replace),b=n("".slice),w=Math.max;return t({target:"String",proto:!0},{replaceAll:function(C,A){var E=r(this),O,D,B,L,j,F,z,$,V,Y,re=0,q="";if(o(C)){if(O=s(C),O&&(D=a(r(c(C))),!~v(D,"g")))throw new y("`.replaceAll` does not allow non-global regexes");if(B=l(C,f),B)return e(B,C,E,A);if(p&&O)return x(a(E),C,A)}for(L=a(E),j=a(C),F=i(A),F||(A=a(A)),z=j.length,$=w(1,z),V=v(L,j);V!==-1;)Y=F?a(A(j,V,L)):d(j,L,V,[],void 0,A),q+=b(L,re,V)+Y,re=V+z,V=V+$>L.length?-1:v(L,j,V+$);return re<L.length&&(q+=b(L,re)),q}}),dz}var _C,fz;function mae(){if(fz)return _C;fz=1,V5(),pae(),gae();var t=Fy();return _C=t("String","replaceAll"),_C}var CC,gz;function yae(){if(gz)return CC;gz=1;var t=mae();return CC=t,CC}yae();function G5(t){return t&&typeof t=="object"&&"parents"in t}function Y5(t){for(let e=0,n=t.parents.length;e<n;e++)if(t.parents[e].__unsafe__getWithoutCapture(!0),t.parents[e].lastChangedEpoch!==t.parentEpochs[e])return!0;return!1}function eb(t,e){if(t.children.remove(e)&&t.children.isEmpty&&G5(t))for(let n=0,r=t.parents.length;n<r;n++)eb(t.parents[n],t)}function C2(t,e){if(t.children.add(e)&&G5(t))for(let n=0,r=t.parents.length;n<r;n++)C2(t.parents[n],t)}function X5(t,e){return t===e||Object.is(t,e)||!!(t&&e&&typeof t.equals=="function"&&t.equals(e))}function Vu(t,e){const n=Symbol.for(`com.tldraw.state/${t}`),r=globalThis;return r[n]??=e(),r[n]}const ur=Vu("empty_array",()=>Object.freeze([])),mz=8;class tb{arraySize=0;array=Array(mz);set=null;get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(e){if(this.array)return this.array.indexOf(e)!==-1?!1:this.arraySize<mz?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0);if(this.set)return this.set.has(e)?!1:(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const n=this.array.indexOf(e);return n===-1?!1:(this.array[n]=void 0,this.arraySize--,n!==this.arraySize&&(this.array[n]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(e)?(this.set.delete(e),!0):!1;throw new Error("no set or array")}visit(e){if(this.array){for(let n=0;n<this.arraySize;n++){const r=this.array[n];typeof r<"u"&&e(r)}return}if(this.set){this.set.forEach(e);return}throw new Error("no set or array")}*[Symbol.iterator](){if(this.array)for(let e=0;e<this.arraySize;e++){const n=this.array[e];typeof n<"u"&&(yield n)}else if(this.set)yield*this.set;else throw new Error("no set or array")}has(e){return this.array?this.array.indexOf(e)!==-1:this.set.has(e)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}const bs=Symbol.for("com.tldraw.state/RESET_VALUE");class Z5{constructor(e){this.capacity=e,this.buffer=new Array(e)}index=0;buffer;pushEntry(e,n,r){if(r!==void 0){if(r===bs){this.clear();return}this.buffer[this.index]=[e,n,r],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:n,capacity:r,buffer:i}=this;for(let o=0;o<r;o++){const s=(n-1+r-o)%r,a=i[s];if(!a)return bs;const[l,c]=a;if(o===0&&e>=c)return[];if(l<=e&&e<c){const d=o+1,u=new Array(d);for(let p=0;p<d;p++)u[p]=i[(s+p)%r][2];return u}}return bs}}const vu=-1;class vae{constructor(e,n,r){this.name=e,this.runEffect=n,this._scheduleEffect=r?.scheduleEffect}_isActivelyListening=!1;get isActivelyListening(){return this._isActivelyListening}lastTraversedEpoch=vu;lastReactedEpoch=vu;_scheduleCount=0;__debug_ancestor_epochs__=null;get scheduleCount(){return this._scheduleCount}parentSet=new tb;parentEpochs=[];parents=[];_scheduleEffect;maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==Ho()){if(this.parents.length&&!Y5(this)){this.lastReactedEpoch=Ho();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}maybeExecute=()=>{this._isActivelyListening&&this.execute()};attach(){this._isActivelyListening=!0;for(let e=0,n=this.parents.length;e<n;e++)C2(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,n=this.parents.length;e<n;e++)eb(this.parents[e],this)}execute(){try{tU(this);const e=Ho(),n=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=e,n}finally{nU()}}}const wh=Vu("EffectScheduler",()=>vae);function mo(t,e,n){const r=new wh(t,e,n);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}function xae(t,e,n){const r=new wh(t,e,n);return{scheduler:r,start:i=>{const o=i?.force??!1;r.attach(),o?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}let Sae=class{constructor(e,n){this.parent=e,this.isSync=n}asyncProcessCount=0;initialAtomValues=new Map;get isRoot(){return this.parent===null}commit(){if(an.globalIsReacting)for(const e of this.initialAtomValues.keys())Q5(e);else this.isRoot?J5(this.initialAtomValues.keys()):this.initialAtomValues.forEach((e,n)=>{this.parent.initialAtomValues.has(n)||this.parent.initialAtomValues.set(n,e)})}abort(){an.globalEpoch++,this.initialAtomValues.forEach((e,n)=>{n.set(e),n.historyBuffer?.clear()}),this.commit()}};const an=Vu("transactions",()=>({globalEpoch:vu+1,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:vu+1}));function bae(){return an.reactionEpoch}function Ho(){return an.globalEpoch}function wae(){return an.globalIsReacting}function P2(t,e){e.lastTraversedEpoch!==an.globalEpoch&&(e.lastTraversedEpoch=an.globalEpoch,e instanceof wh?t.add(e):e.children.visit(n=>P2(t,n)))}function J5(t){if(an.globalIsReacting)throw new Error("flushChanges cannot be called during a reaction");const e=an.currentTransaction;try{an.currentTransaction=null,an.globalIsReacting=!0,an.reactionEpoch=an.globalEpoch;const n=new Set;for(const i of t)i.children.visit(o=>P2(n,o));for(const i of n)i.maybeScheduleEffect();let r=0;for(;an.cleanupReactors?.size;){if(r++>1e3)throw new Error("Reaction update depth limit exceeded");const i=an.cleanupReactors;an.cleanupReactors=null;for(const o of i)o.maybeScheduleEffect()}}finally{an.cleanupReactors=null,an.globalIsReacting=!1,an.currentTransaction=e}}function kae(t,e){an.currentTransaction?an.currentTransaction.initialAtomValues.has(t)||an.currentTransaction.initialAtomValues.set(t,e):an.globalIsReacting?Q5(t):J5([t])}function Q5(t){const e=an.cleanupReactors??=new Set;t.children.visit(n=>P2(e,n))}function Iae(){an.globalEpoch++}function _ae(t){const e=new Sae(an.currentTransaction,!0);an.currentTransaction=e;try{let n,r=!1;try{n=t(()=>r=!0)}catch(i){throw e.abort(),i}if(an.currentTransaction!==e)throw new Error("Transaction boundaries overlap");return r?e.abort():e.commit(),n}finally{an.currentTransaction=e.parent}}function ws(t){return an.currentTransaction?t():_ae(t)}let yz=!1;function Cae(){yz||(yz=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const zi=Symbol.for("com.tldraw.state/UNINITIALIZED");function Fd(t){return t===zi}const hT=Vu("WithDiff",()=>class{constructor(e,n){this.value=e,this.diff=n}});function am(t,e){return new hT(t,e)}class Pae{constructor(e,n,r){this.name=e,this.derive=n,r?.historyLength&&(this.historyBuffer=new Z5(r.historyLength)),this.computeDiff=r?.computeDiff,this.isEqual=r?.isEqual??X5}lastChangedEpoch=vu;lastTraversedEpoch=vu;__debug_ancestor_epochs__=null;lastCheckedEpoch=vu;parentSet=new tb;parents=[];parentEpochs=[];children=new tb;get isActivelyListening(){return!this.children.isEmpty}historyBuffer;state=zi;error=null;computeDiff;isEqual;__unsafe__getWithoutCapture(e){const n=this.lastChangedEpoch===vu,r=Ho();if(!n&&(this.lastCheckedEpoch===r||this.isActivelyListening&&wae()&&this.lastTraversedEpoch<bae()||!Y5(this)))if(this.lastCheckedEpoch=r,this.error){if(e)return this.state;throw this.error.thrownValue}else return this.state;try{tU(this);const i=this.derive(this.state,this.lastCheckedEpoch),o=i instanceof hT?i.value:i,s=this.state===zi;if(s||!this.isEqual(o,this.state)){if(this.historyBuffer&&!s){const a=i instanceof hT?i.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,Ho(),a??this.computeDiff?.(this.state,o,this.lastCheckedEpoch,Ho())??bs)}this.lastChangedEpoch=Ho(),this.state=o}return this.error=null,this.lastCheckedEpoch=Ho(),this.state}catch(i){if(this.state!==zi&&(this.state=zi,this.lastChangedEpoch=Ho()),this.lastCheckedEpoch=Ho(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:i},!e)throw i;return this.state}finally{nU()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{nb(this)}}getDiffSince(e){return this.__unsafe__getWithoutCapture(!0),nb(this),e>=this.lastChangedEpoch?ur:this.historyBuffer?.getChangesSince(e)??bs}}const Uy=Vu("Computed",()=>Pae);function Tae(t={},e,n,r){const i=r.value,o=Symbol.for("__@tldraw/state__computed__"+n);return r.value=function(){let s=this[o];return s||(s=new Uy(n,i.bind(this),t),Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:s})),s.get()},r.value[eU]=!0,r}function Eae(t={},e,n,r){const i=r.get,o=Symbol.for("__@tldraw/state__computed__"+n);return r.get=function(){let s=this[o];return s||(s=new Uy(n,i.bind(this),t),Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:s})),s.get()},r}function Aae(t,e,n){Ge(n.kind==="method","@computed can only be used on methods");const r=Symbol.for("__@tldraw/state__computed__"+String(n.name)),i=function(){let o=this[r];return o||(o=new Uy(String(n.name),e.bind(this),t),Object.defineProperty(this,r,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()};return i[eU]=!0,i}function vz(t={},e){if(e.length===2){const[n,r]=e;return Aae(t,n,r)}else{const[n,r,i]=e;return i.get?(Cae(),Eae(t,n,r,i)):Tae(t,n,r,i)}}const eU="@@__isComputedMethod__@@";function fe(){if(arguments.length===1){const t=arguments[0];return(...e)=>vz(t,e)}else return typeof arguments[0]=="string"?new Uy(arguments[0],arguments[1],arguments[2]):vz(void 0,arguments)}function T2(t){return!!(t&&t instanceof Uy)}class Mae{constructor(e,n){this.below=e,this.child=n}offset=0;maybeRemoved}const Hn=Vu("capture",()=>({stack:null}));function lm(t){const e=Hn.stack;Hn.stack=null;try{return t()}finally{Hn.stack=e}}function tU(t){if(Hn.stack=new Mae(Hn.stack,t),t.__debug_ancestor_epochs__){const e=t.__debug_ancestor_epochs__;t.__debug_ancestor_epochs__=null;for(const n of t.parents)n.__unsafe__getWithoutCapture(!0);Oae(t,e)}t.parentSet.clear()}function nU(){const t=Hn.stack;if(Hn.stack=t.below,t.offset<t.child.parents.length){for(let e=t.offset;e<t.child.parents.length;e++){const n=t.child.parents[e];t.child.parentSet.has(n)||eb(n,t.child)}t.child.parents.length=t.offset,t.child.parentEpochs.length=t.offset}if(t.maybeRemoved)for(let e=0;e<t.maybeRemoved.length;e++){const n=t.maybeRemoved[e];t.child.parentSet.has(n)||eb(n,t.child)}t.child.__debug_ancestor_epochs__&&rU(t.child,t.child.__debug_ancestor_epochs__)}function nb(t){if(Hn.stack){if(Hn.stack.child.parentSet.has(t))return;if(Hn.stack.child.parentSet.add(t),Hn.stack.child.isActivelyListening&&C2(t,Hn.stack.child),Hn.stack.offset<Hn.stack.child.parents.length){const n=Hn.stack.child.parents[Hn.stack.offset];n!==t&&(Hn.stack.maybeRemoved?Hn.stack.maybeRemoved.push(n):Hn.stack.maybeRemoved=[n])}Hn.stack.child.parents[Hn.stack.offset]=t,Hn.stack.child.parentEpochs[Hn.stack.offset]=t.lastChangedEpoch,Hn.stack.offset++}}function rU(t,e){for(let n=0;n<t.parents.length;n++){const r=t.parents[n],i=t.parentEpochs[n];e.set(r,i),T2(r)&&rU(r,e)}return e}function iU(t,e){const n={};for(let r=0;r<t.parents.length;r++){const i=t.parents[r];if(!e.has(i))continue;const o=e.get(i);i.lastChangedEpoch!==o&&(T2(i)?n[i.name]=iU(i,e):n[i.name]=null)}return n}function Oae(t,e){const n=iU(t,e);if(Object.keys(n).length===0){console.log(`Effect(${t.name}) was executed manually.`);return}let r=T2(t)?`Computed(${t.name}) is recomputing because:`:`Effect(${t.name}) is executing because:`;function i(o,s){const a=`
`+" ".repeat(s)+"↳ ";for(const[l,c]of Object.entries(o))c?(r+=`${a}Computed(${l}) changed`,i(c,s+2)):r+=`${a}Atom(${l}) changed`}i(n,1),console.log(r)}class Dae{constructor(e,n,r){this.name=e,this.current=n,this.isEqual=r?.isEqual??null,r&&(r.historyLength&&(this.historyBuffer=new Z5(r.historyLength)),this.computeDiff=r.computeDiff)}isEqual;computeDiff;lastChangedEpoch=Ho();children=new tb;historyBuffer;__unsafe__getWithoutCapture(e){return this.current}get(){return nb(this),this.current}set(e,n){if(this.isEqual?.(this.current,e)??X5(this.current,e))return this.current;Iae(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,Ho(),n??this.computeDiff?.(this.current,e,this.lastChangedEpoch,Ho())??bs),this.lastChangedEpoch=Ho();const r=this.current;return this.current=e,kae(this,r),e}update(e){return this.set(e(this.current))}getDiffSince(e){return nb(this),e>=this.lastChangedEpoch?ur:this.historyBuffer?.getChangesSince(e)??bs}}const jae=Vu("Atom",()=>Dae);function qt(t,e,n){return new jae(t,e,n)}const oU=1,Rae=Vu("apiVersion",()=>oU);if(Rae!==oU)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");Fu("@tldraw/state","4.1.1","esm");function Hw(t,e,n=[]){const r=rt.useRef(e);r.current=e;const[i,o,s]=rt.useMemo(()=>{let a=null;const l=u=>(a=u,()=>{a=null}),c=new wh(`useStateTracking(${t})`,()=>r.current?.(),{scheduleEffect(){a?.()}});return[c,l,()=>c.scheduleCount]},[t,...n]);return rt.useSyncExternalStore(o,s,s),rt.useEffect(()=>(i.attach(),i.maybeScheduleEffect(),()=>{i.detach()}),[i]),i.execute()}const xz={apply(t,e,n){return Hw(t.displayName??t.name??"tracked(???)",()=>t.apply(e,n))}},$ae=Symbol.for("react.memo"),Nae=Symbol.for("react.forward_ref");function _r(t){let e=null;const n=t.$$typeof;return n===$ae&&(t=t.type,e=t.compare),n===Nae?I.memo(I.forwardRef(new Proxy(t.render,xz))):I.memo(new Proxy(t,xz),e)}function Hy(t,e,n){return I.useState(()=>{const r=typeof e=="function"?e():e;return qt(`useAtom(${t})`,r,n)})[0]}function Lae(){const t=arguments[0],e=arguments[1],n=arguments.length===3?void 0:arguments[2],r=arguments.length===3?arguments[2]:arguments[3];return I.useMemo(()=>fe(`useComputed(${t})`,e,n),r)}function Yd(t,e,n=ur){I.useEffect(()=>{const r=new wh(t,e);return r.attach(),r.execute(),()=>{r.detach()}},n)}function E2(t,e,n=[]){I.useEffect(()=>{let r;const i=new wh(t,e,{scheduleEffect:o=>{r=g2(o)}});return i.attach(),i.execute(),()=>{i.detach(),r?.()}},n)}function J(){const t=arguments,e=t.length===3?t[2]:[t[0]],n=t.length===3?t[0]:`useValue(${t[0].name})`,{$val:r,subscribe:i,getSnapshot:o}=I.useMemo(()=>{const s=t.length===1?t[0]:fe(n,t[1]);return{$val:s,subscribe:a=>mo(`useValue(${n})`,()=>{try{s.get()}catch{}a()}),getSnapshot:()=>s.lastChangedEpoch}},e);return I.useSyncExternalStore(i,o,o),r.__unsafe__getWithoutCapture()}Fu("@tldraw/state-react","4.1.1","esm");/*!
 * This file was lovingly and delicately extracted from Immutable.js
 * MIT License: https://github.com/immutable-js/immutable-js/blob/main/LICENSE
 * Copyright (c) 2014-present, Lee Byron and other contributors.
 */function A2(t){return t>>>1&1073741824|t&3221225471}const zae=Object.prototype.valueOf;function Xd(t){if(t==null)return Sz(t);if(typeof t.hashCode=="function")return A2(t.hashCode(t));const e=Wae(t);if(e==null)return Sz(e);switch(typeof e){case"boolean":return e?1108378657:1108378656;case"number":return Fae(e);case"string":return e.length>Vae?Bae(e):pT(e);case"object":case"function":return Hae(e);case"symbol":return Uae(e);default:if(typeof e.toString=="function")return pT(e.toString());throw new Error("Value type "+typeof e+" cannot be hashed.")}}function Sz(t){return t===null?1108378658:1108378659}function Fae(t){if(t!==t||t===1/0)return 0;let e=t|0;for(e!==t&&(e^=t*4294967295);t>4294967295;)t/=4294967295,e^=t;return A2(e)}function Bae(t){let e=EC[t];return e===void 0&&(e=pT(t),TC===Kae&&(TC=0,EC={}),TC++,EC[t]=e),e}function pT(t){let e=0;for(let n=0;n<t.length;n++)e=31*e+t.charCodeAt(n)|0;return A2(e)}function Uae(t){let e=wz[t];return e!==void 0||(e=sU(),wz[t]=e),e}function Hae(t){let e=bz.get(t);return e!==void 0||(e=sU(),bz.set(t,e)),e}function Wae(t){return t.valueOf!==zae&&typeof t.valueOf=="function"?t.valueOf(t):t}function sU(){const t=++PC;return PC&1073741824&&(PC=0),t}const bz=new WeakMap,wz=Object.create(null);let PC=0;const Vae=16,Kae=255;let TC=0,EC={};const of=5,Wy=1<<of,sf=Wy-1,mc={};function kz(){return{value:!1}}function Ra(t){t&&(t.value=!0)}function M2(t,e){e=e||0;const n=Math.max(0,t.length-e),r=new Array(n);for(let i=0;i<n;i++)r[i]=t[i+e];return r}const af=Object.is;class aU{}class O2{_root;size;__ownerID;__hash;__altered;constructor(e){return e==null?Wp():e instanceof O2?e:Wp().withMutations(n=>{for(const[r,i]of e)n.set(r,i)})}get(e,n){return this._root?this._root.get(0,void 0,e,n):n}set(e,n){return Cz(this,e,n)}delete(e){return Cz(this,e,mc)}deleteAll(e){return this.withMutations(n=>{for(const r of e)n.delete(r)})}__ensureOwner(e){return e===this.__ownerID?this:e?R2(this.size,this._root,e,this.__hash):this.size===0?Wp():(this.__ownerID=e,this.__altered=!1,this)}withMutations(e){const n=this.asMutable();return e(n),n.wasAltered()?n.__ensureOwner(this.__ownerID):this}wasAltered(){return this.__altered}asMutable(){return this.__ownerID?this:this.__ensureOwner(new aU)}[Symbol.iterator](){return this.entries()[Symbol.iterator]()}entries(){return new AC(this,qae,!1)}keys(){return new AC(this,lU,!1)}values(){return new AC(this,cU,!1)}}class D2{constructor(e,n){this.ownerID=e,this.entries=n}get(e,n,r,i){const o=this.entries;for(let s=0,a=o.length;s<a;s++)if(af(r,o[s][0]))return o[s][1];return i}update(e,n,r,i,o,s,a){const l=o===mc,c=this.entries;let d=0;const u=c.length;for(;d<u&&!af(i,c[d][0]);d++);const p=d<u;if(p?c[d][1]===o:l)return this;if(Ra(a),(l||!p)&&Ra(s),l&&c.length===1)return;if(!p&&!l&&c.length>=tle)return Xae(e,c,i,o);const f=e&&e===this.ownerID,y=f?c:M2(c);return p?l?d===u-1?y.pop():y[d]=y.pop():y[d]=[i,o]:y.push([i,o]),f?(this.entries=y,this):new D2(e,y)}}class Ww{constructor(e,n,r){this.ownerID=e,this.bitmap=n,this.nodes=r}get(e,n,r,i){n===void 0&&(n=Xd(r));const o=1<<((e===0?n:n>>>e)&sf),s=this.bitmap;return(s&o)===0?i:this.nodes[Tz(s&o-1)].get(e+of,n,r,i)}update(e,n,r,i,o,s,a){r===void 0&&(r=Xd(i));const l=(n===0?r:r>>>n)&sf,c=1<<l,d=this.bitmap,u=(d&c)!==0;if(!u&&o===mc)return this;const p=Tz(d&c-1),f=this.nodes,y=u?f[p]:void 0,v=$2(y,e,n+of,r,i,o,s,a);if(v===y)return this;if(!u&&v&&f.length>=nle)return Jae(e,f,d,l,v);if(u&&!v&&f.length===2&&Pz(f[p^1]))return f[p^1];if(u&&v&&f.length===1&&Pz(v))return v;const x=e&&e===this.ownerID,b=u?v?d:d^c:d|c,w=u?v?uU(f,p,v,x):ele(f,p,x):Qae(f,p,v,x);return x?(this.bitmap=b,this.nodes=w,this):new Ww(e,b,w)}}class j2{constructor(e,n,r){this.ownerID=e,this.count=n,this.nodes=r}get(e,n,r,i){n===void 0&&(n=Xd(r));const o=(e===0?n:n>>>e)&sf,s=this.nodes[o];return s?s.get(e+of,n,r,i):i}update(e,n,r,i,o,s,a){r===void 0&&(r=Xd(i));const l=(n===0?r:r>>>n)&sf,c=o===mc,d=this.nodes,u=d[l];if(c&&!u)return this;const p=$2(u,e,n+of,r,i,o,s,a);if(p===u)return this;let f=this.count;if(!u)f++;else if(!p&&(f--,f<rle))return Zae(e,d,f,l);const y=e&&e===this.ownerID,v=uU(d,l,p,y);return y?(this.count=f,this.nodes=v,this):new j2(e,f,v)}}class Vw{constructor(e,n,r){this.ownerID=e,this.keyHash=n,this.entries=r}get(e,n,r,i){const o=this.entries;for(let s=0,a=o.length;s<a;s++)if(af(r,o[s][0]))return o[s][1];return i}update(e,n,r,i,o,s,a){r===void 0&&(r=Xd(i));const l=o===mc;if(r!==this.keyHash)return l?this:(Ra(a),Ra(s),N2(this,e,n,r,[i,o]));const c=this.entries;let d=0;const u=c.length;for(;d<u&&!af(i,c[d][0]);d++);const p=d<u;if(p?c[d][1]===o:l)return this;if(Ra(a),(l||!p)&&Ra(s),l&&u===2)return new kh(e,this.keyHash,c[d^1]);const f=e&&e===this.ownerID,y=f?c:M2(c);return p?l?d===u-1?y.pop():y[d]=y.pop():y[d]=[i,o]:y.push([i,o]),f?(this.entries=y,this):new Vw(e,this.keyHash,y)}}class kh{constructor(e,n,r){this.ownerID=e,this.keyHash=n,this.entry=r}get(e,n,r,i){return af(r,this.entry[0])?this.entry[1]:i}update(e,n,r,i,o,s,a){const l=o===mc,c=af(i,this.entry[0]);if(c?o===this.entry[1]:l)return this;if(Ra(a),l){Ra(s);return}return c?e&&e===this.ownerID?(this.entry[1]=o,this):new kh(e,this.keyHash,[i,o]):(Ra(s),N2(this,e,n,Xd(i),[i,o]))}}class AC{constructor(e,n,r){this._type=n,this._reverse=r,this._stack=e._root&&Iz(e._root)}_stack;[Symbol.iterator](){return this}next(){const e=this._type;let n=this._stack;for(;n;){const r=n.node,i=n.index++;let o;if(r.entry){if(i===0)return MC(e,r.entry)}else if("entries"in r&&r.entries){if(o=r.entries.length-1,i<=o)return MC(e,r.entries[this._reverse?o-i:i])}else if(o=r.nodes.length-1,i<=o){const s=r.nodes[this._reverse?o-i:i];if(s){if(s.entry)return MC(e,s.entry);n=this._stack=Iz(s,n)}continue}n=this._stack=this._stack.__prev}return Yae()}}function MC(t,e){return Gae(t,e[0],e[1])}function Iz(t,e){return{node:t,index:0,__prev:e}}const lU=0,cU=1,qae=2;function Gae(t,e,n,r){const i=t===lU?e:t===cU?n:[e,n];return r?r.value=i:r={value:i,done:!1},r}function Yae(){return{value:void 0,done:!0}}function R2(t,e,n,r){const i=Object.create(O2.prototype);return i.size=t,i._root=e,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}let _z;function Wp(){return _z||(_z=R2(0))}function Cz(t,e,n){let r,i;if(t._root){const o=kz(),s=kz();if(r=$2(t._root,t.__ownerID,0,void 0,e,n,o,s),!s.value)return t;i=t.size+(o.value?n===mc?-1:1:0)}else{if(n===mc)return t;i=1,r=new D2(t.__ownerID,[[e,n]])}return t.__ownerID?(t.size=i,t._root=r,t.__hash=void 0,t.__altered=!0,t):r?R2(i,r):Wp()}function $2(t,e,n,r,i,o,s,a){return t?t.update(e,n,r,i,o,s,a):o===mc?t:(Ra(a),Ra(s),new kh(e,r,[i,o]))}function Pz(t){return t.constructor===kh||t.constructor===Vw}function N2(t,e,n,r,i){if(t.keyHash===r)return new Vw(e,r,[t.entry,i]);const o=(n===0?t.keyHash:t.keyHash>>>n)&sf,s=(n===0?r:r>>>n)&sf;let a;const l=o===s?[N2(t,e,n+of,r,i)]:(a=new kh(e,r,i),o<s?[t,a]:[a,t]);return new Ww(e,1<<o|1<<s,l)}function Xae(t,e,n,r){t||(t=new aU);let i=new kh(t,Xd(n),[n,r]);for(let o=0;o<e.length;o++){const s=e[o];i=i.update(t,0,void 0,s[0],s[1])}return i}function Zae(t,e,n,r){let i=0,o=0;const s=new Array(n);for(let a=0,l=1,c=e.length;a<c;a++,l<<=1){const d=e[a];d!==void 0&&a!==r&&(i|=l,s[o++]=d)}return new Ww(t,i,s)}function Jae(t,e,n,r,i){let o=0;const s=new Array(Wy);for(let a=0;n!==0;a++,n>>>=1)s[a]=n&1?e[o++]:void 0;return s[r]=i,new j2(t,o+1,s)}function Tz(t){return t-=t>>1&1431655765,t=(t&858993459)+(t>>2&858993459),t=t+(t>>4)&252645135,t+=t>>8,t+=t>>16,t&127}function uU(t,e,n,r){const i=r?t:M2(t);return i[e]=n,i}function Qae(t,e,n,r){const i=t.length+1;if(r&&e+1===i)return t[e]=n,t;const o=new Array(i);let s=0;for(let a=0;a<i;a++)a===e?(o[a]=n,s=-1):o[a]=t[a+s];return o}function ele(t,e,n){const r=t.length-1;if(n&&e===r)return t.pop(),t;const i=new Array(r);let o=0;for(let s=0;s<r;s++)s===e&&(o=1),i[s]=t[s+o];return i}const tle=Wy/4,nle=Wy/2,rle=Wy/4;class fT{constructor(e,n){this.name=e;let r=Wp();n&&(r=r.withMutations(i=>{for(const[o,s]of n)i.set(o,qt(`${e}:${String(o)}`,s))})),this.atoms=qt(`${e}:atoms`,r)}atoms;getAtom(e){const n=this.atoms.__unsafe__getWithoutCapture().get(e);if(!n){this.atoms.get();return}return n}get(e){const n=this.getAtom(e)?.get();return Ge(n!==zi),n}__unsafe__getWithoutCapture(e){const n=this.atoms.__unsafe__getWithoutCapture().get(e);if(!n)return;const r=n.__unsafe__getWithoutCapture();return Ge(r!==zi),r}has(e){const n=this.getAtom(e);return n?n.get()!==zi:!1}__unsafe__hasWithoutCapture(e){const n=this.atoms.__unsafe__getWithoutCapture().get(e);return n?(Ge(n.__unsafe__getWithoutCapture()!==zi),!0):!1}set(e,n){const r=this.atoms.__unsafe__getWithoutCapture().get(e);return r?r.set(n):this.atoms.update(i=>i.set(e,qt(`${this.name}:${String(e)}`,n))),this}update(e,n){const r=this.atoms.__unsafe__getWithoutCapture().get(e);if(!r)throw new Error(`AtomMap: key ${e} not found`);const i=r.__unsafe__getWithoutCapture();Ge(i!==zi),r.set(n(i))}delete(e){const n=this.atoms.__unsafe__getWithoutCapture().get(e);return n?(ws(()=>{n.set(zi),this.atoms.update(r=>r.delete(e))}),!0):!1}deleteMany(e){return ws(()=>{const n=[],r=this.atoms.get().withMutations(i=>{for(const o of e){const s=i.get(o);if(!s)continue;const a=s.get();Ge(a!==zi),n.push([o,a]),i.delete(o),s.set(zi)}});return n.length&&this.atoms.set(r),n})}clear(){return ws(()=>{for(const e of this.atoms.__unsafe__getWithoutCapture().values())e.set(zi);this.atoms.set(Wp())})}*entries(){for(const[e,n]of this.atoms.get()){const r=n.get();Ge(r!==zi),yield[e,r]}}*keys(){for(const e of this.atoms.get().keys())yield e}*values(){for(const e of this.atoms.get().values()){const n=e.get();Ge(n!==zi),yield n}}get size(){return this.atoms.get().size}forEach(e,n){for(const[r,i]of this.entries())e.call(n,i,r,this)}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="AtomMap"}class jS{constructor(e){this.previousValue=e}nextValue;diff;get(){const e=this.diff?.removed?.size??0,n=this.diff?.added?.size??0;if(!(e===0&&n===0))return{value:this.nextValue,diff:this.diff}}_add(e,n){this.nextValue??=new Set(this.previousValue),this.nextValue.add(e),this.diff??={},n?this.diff.removed?.delete(e):(this.diff.added??=new Set,this.diff.added.add(e))}add(e){const n=this.previousValue.has(e);if(n)return this.diff?.removed?.has(e)?this._add(e,n):void 0;this.nextValue?.has(e)||this._add(e,n)}_remove(e,n){this.nextValue??=new Set(this.previousValue),this.nextValue.delete(e),this.diff??={},n?(this.diff.removed??=new Set,this.diff.removed.add(e)):this.diff.added?.delete(e)}remove(e){const n=this.previousValue.has(e);if(!n)return this.diff?.added?.has(e)?this._remove(e,n):void 0;this.diff?.removed?.has(e)||this._remove(e,n)}}function ile(t){const e=[];for(let n=t.length-1;n>=0;n--){const r=t[n];if("id"in r)e.unshift(r);else{const i=r.dependsOn,o=e[0];o&&(e[0]={...o,dependsOn:i.concat(o.dependsOn??[])})}}return e}function Vp({sequence:t,sequenceId:e,retroactive:n=!0}){const r={sequenceId:e,retroactive:n,sequence:ile(t)};return dU(r),r}function Jo(t,e){return Object.fromEntries(go(e).map(([n,r])=>[n,`${t}/${r}`]))}function Es(t){const e=t.sequenceId;return Vp({sequenceId:e,retroactive:t.retroactive??!0,sequence:t.sequence.map(n=>"id"in n?{...n,scope:"record",filter:r=>r.typeName===t.recordType&&(n.filter?.(r)??!0)&&(t.filter?.(r)??!0)}:n)})}function ole(t){if(t.length===0)return[];const e=new Map(t.map(l=>[l.id,l])),n=new Map,r=new Map,i=new Map;for(const l of t)r.set(l.id,0),n.set(l.id,new Set),i.set(l.id,new Set);for(const l of t){const{version:c,sequenceId:d}=rb(l.id),u=`${d}/${c-1}`;if(e.has(u)&&(n.get(u).add(l.id),r.set(l.id,r.get(l.id)+1)),l.dependsOn)for(const p of l.dependsOn)e.has(p)&&(n.get(p).add(l.id),i.get(l.id).add(p),r.set(l.id,r.get(l.id)+1))}const o=t.filter(l=>r.get(l.id)===0),s=[],a=new Set;for(;o.length>0;){let l,c=-1/0;for(const u of o){let p=0;for(const f of n.get(u.id)||[])a.has(f)||(p+=1,i.get(f).has(u.id)&&(p+=100));(p>c||p===c&&u.id.localeCompare(l?.id??"")<0)&&(l=u,c=p)}const d=l;o.splice(o.indexOf(d),1),s.push(d),a.add(d.id);for(const u of n.get(d.id)||[])a.has(u)||(r.set(u,r.get(u)-1),r.get(u)===0&&o.push(e.get(u)))}if(s.length!==t.length){const l=t.filter(c=>!a.has(c.id));Ge(!1,`Circular dependency in migrations: ${l[0].id}`)}return s}function rb(t){const[e,n]=t.split("/");return{sequenceId:e,version:parseInt(n)}}function Ez(t,e){e&&Ge(t.startsWith(e+"/"),`Every migration in sequence '${e}' must have an id starting with '${e}/'. Got invalid id: '${t}'`),Ge(t.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${t}'`)}function dU(t){if(Ge(!t.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${t.sequenceId}`),Ge(t.sequenceId.length,"sequenceId must be a non-empty string"),t.sequence.length===0)return;Ez(t.sequence[0].id,t.sequenceId);let e=rb(t.sequence[0].id).version;Ge(e===1,`Expected the first migrationId to be '${t.sequenceId}/1' but got '${t.sequence[0].id}'`);for(let n=1;n<t.sequence.length;n++){const r=t.sequence[n].id;Ez(r,t.sequenceId);const i=rb(r).version;Ge(i===e+1,`Migration id numbers must increase in increments of 1, expected ${t.sequenceId}/${e+1} but got '${t.sequence[n].id}'`),e=i}}var su=(t=>(t.IncompatibleSubtype="incompatible-subtype",t.UnknownType="unknown-type",t.TargetVersionTooNew="target-version-too-new",t.TargetVersionTooOld="target-version-too-old",t.MigrationError="migration-error",t.UnrecognizedSubtype="unrecognized-subtype",t))(su||{});function ib(){return{added:{},updated:{},removed:{}}}function lf(t){const e={added:t.removed,removed:t.added,updated:{}};for(const[n,r]of Object.values(t.updated))e.updated[n.id]=[r,n];return e}function Kw(t){return Object.keys(t.added).length===0&&Object.keys(t.updated).length===0&&Object.keys(t.removed).length===0}function Vy(t,e){const n=e?.mutateFirstDiff?t[0]:{added:{},removed:{},updated:{}};return Am(n,t),n}function Am(t,e){for(const n of e){for(const[r,i]of go(n.added))if(t.removed[r]){const o=t.removed[r];delete t.removed[r],o!==i&&(t.updated[r]=[o,i])}else t.added[r]=i;for(const[r,[i,o]]of go(n.updated)){if(t.added[r]){t.added[r]=o,delete t.updated[r],delete t.removed[r];continue}if(t.updated[r]){t.updated[r]=[t.updated[r][0],o],delete t.removed[r];continue}t.updated[r]=n.updated[r],delete t.removed[r]}for(const[r,i]of go(n.removed))t.added[r]?delete t.added[r]:t.updated[r]?(t.removed[r]=t.updated[r][0],delete t.updated[r]):t.removed[r]=i}}class qw{constructor(e,n){this.typeName=e,this.createDefaultProperties=n.createDefaultProperties,this.validator=n.validator??{validate:i=>i},this.scope=n.scope??"document",this.ephemeralKeys=n.ephemeralKeys;const r=new Set;if(n.ephemeralKeys)for(const[i,o]of go(n.ephemeralKeys))o&&r.add(i);this.ephemeralKeySet=r}createDefaultProperties;validator;ephemeralKeys;ephemeralKeySet;scope;create(e){const n={...this.createDefaultProperties(),id:"id"in e?e.id:this.createId()};for(const[r,i]of Object.entries(e))i!==void 0&&(n[r]=i);return n.typeName=this.typeName,n}clone(e){return{...fn(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??Qt())}parseId(e){if(!this.isId(e))throw new Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isInstance(e){return e?.typeName===this.typeName}isId(e){if(!e)return!1;for(let n=0;n<this.typeName.length;n++)if(e[n]!==this.typeName[n])return!1;return e[this.typeName.length]===":"}withDefaultProperties(e){return new qw(this.typeName,{createDefaultProperties:e,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(e,n){return n&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(n,e):this.validator.validate(e)}}function Dl(t,e){return new qw(t,{createDefaultProperties:()=>({}),validator:e.validator,scope:e.scope,ephemeralKeys:e.ephemeralKeys})}function sle(t){if(t.length===0)return new Set;const e=t[0],n=t.slice(1),r=new Set;for(const i of e)n.every(o=>o.has(i))&&r.add(i);return r}function ale(t,e){const n={};for(const r of e)t.has(r)||(n.added??=new Set,n.added.add(r));for(const r of t)e.has(r)||(n.removed??=new Set,n.removed.add(r));return n.added||n.removed?n:void 0}function Az(t,e){for(const[n,r]of Object.entries(t)){const i=r,o=e[n];if("eq"in i&&o!==i.eq||"neq"in i&&o===i.neq||"gt"in i&&(typeof o!="number"||o<=i.gt))return!1}return!0}function Mz(t,e,n){const r=Object.fromEntries(Object.keys(n).map(i=>[i,new Set]));for(const[i,o]of Object.entries(n))if("eq"in o){const a=t.index(e,i).get().get(o.eq);if(a)for(const l of a)r[i].add(l)}else if("neq"in o){const s=t.index(e,i);for(const[a,l]of s.get())if(a!==o.neq)for(const c of l)r[i].add(c)}else if("gt"in o){const s=t.index(e,i);for(const[a,l]of s.get())if(a>o.gt)for(const c of l)r[i].add(c)}return sle(Object.values(r))}class lle{constructor(e,n){this.recordMap=e,this.history=n}indexCache=new Map;historyCache=new Map;filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const n=fe("filterHistory:"+e,(r,i)=>{if(Fd(r))return this.history.get();const o=this.history.getDiffSince(i);if(o===bs)return this.history.get();const s={added:{},removed:{},updated:{}};let a=0,l=0,c=0;for(const d of o){for(const u of ar(d.added))if(u.typeName===e)if(s.removed[u.id]){const p=s.removed[u.id];delete s.removed[u.id],l--,p!==u&&(s.updated[u.id]=[p,u],c++)}else s.added[u.id]=u,a++;for(const[u,p]of ar(d.updated))p.typeName===e&&(s.added[p.id]?s.added[p.id]=p:s.updated[p.id]?s.updated[p.id]=[s.updated[p.id][0],p]:(s.updated[p.id]=[u,p],c++));for(const u of ar(d.removed))u.typeName===e&&(s.added[u.id]?(delete s.added[u.id],a--):s.updated[u.id]?(s.removed[u.id]=s.updated[u.id][0],delete s.updated[u.id],c--,l++):(s.removed[u.id]=u,l++))}return a||l||c?am(this.history.get(),s):r},{historyLength:100});return this.historyCache.set(e,n),n}index(e,n){const r=e+":"+n;if(this.indexCache.has(r))return this.indexCache.get(r);const i=this.__uncached_createIndex(e,n);return this.indexCache.set(r,i),i}__uncached_createIndex(e,n){const r=this.filterHistory(e),i=()=>{r.get();const o=new Map;for(const s of this.recordMap.values())if(s.typeName===e){const a=s[n];o.has(a)||o.set(a,new Set),o.get(a).add(s.id)}return o};return fe("index:"+e+":"+n,(o,s)=>{if(Fd(o))return i();const a=r.getDiffSince(s);if(a===bs)return i();const l=new Map,c=(f,y)=>{let v=l.get(f);v||(v=new jS(o.get(f)??new Set)),v.add(y),l.set(f,v)},d=(f,y)=>{let v=l.get(f);v||(v=new jS(o.get(f)??new Set)),v.remove(y),l.set(f,v)};for(const f of a){for(const y of ar(f.added))if(y.typeName===e){const v=y[n];c(v,y.id)}for(const[y,v]of ar(f.updated))if(v.typeName===e){const x=y[n],b=v[n];x!==b&&(d(x,v.id),c(b,v.id))}for(const y of ar(f.removed))if(y.typeName===e){const v=y[n];d(v,y.id)}}let u,p;for(const[f,y]of l){const v=y.get();v&&(u||(u=new Map(o)),p||(p=new Map),v.value.size===0?u.delete(f):u.set(f,v.value),p.set(f,v.diff))}return u&&p?am(u,p):o},{historyLength:100})}record(e,n=()=>({}),r="record:"+e+(n?":"+n.toString():"")){const i=this.ids(e,n,r);return fe(r,()=>{for(const o of i.get())return this.recordMap.get(o)})}records(e,n=()=>({}),r="records:"+e+(n?":"+n.toString():"")){const i=this.ids(e,n,"ids:"+r);return fe(r,()=>Array.from(i.get(),o=>this.recordMap.get(o)),{isEqual:JS})}ids(e,n=()=>({}),r="ids:"+e+(n?":"+n.toString():"")){const i=this.filterHistory(e),o=()=>{i.get();const l=n();if(Object.keys(l).length===0){const c=new Set;for(const d of this.recordMap.values())d.typeName===e&&c.add(d.id);return c}return Mz(this,e,l)},s=l=>{const c=o(),d=ale(l,c);return d?am(c,d):l},a=fe("ids_query:"+r,n,{isEqual:Bu});return fe("query:"+r,(l,c)=>{const d=a.get();if(Fd(l))return o();if(c<a.lastChangedEpoch)return s(l);const u=i.getDiffSince(c);if(u===bs)return s(l);const p=new jS(l);for(const y of u){for(const v of ar(y.added))v.typeName===e&&Az(d,v)&&p.add(v.id);for(const[v,x]of ar(y.updated))x.typeName===e&&(Az(d,x)?p.add(x.id):p.remove(x.id));for(const v of ar(y.removed))v.typeName===e&&p.remove(v.id)}const f=p.get();return f?am(f.value,f.diff):l},{historyLength:50})}exec(e,n){const r=Mz(this,e,n);return r.size===0?ur:Array.from(r,i=>this.recordMap.get(i))}}class cle{constructor(e){this.store=e}_beforeCreateHandlers={};_afterCreateHandlers={};_beforeChangeHandlers={};_afterChangeHandlers={};_beforeDeleteHandlers={};_afterDeleteHandlers={};_operationCompleteHandlers=[];_isEnabled=!0;isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}handleBeforeCreate(e,n){if(!this._isEnabled)return e;const r=this._beforeCreateHandlers[e.typeName];if(r){let i=e;for(const o of r)i=o(i,n);return i}return e}handleAfterCreate(e,n){if(!this._isEnabled)return;const r=this._afterCreateHandlers[e.typeName];if(r)for(const i of r)i(e,n)}handleBeforeChange(e,n,r){if(!this._isEnabled)return n;const i=this._beforeChangeHandlers[n.typeName];if(i){let o=n;for(const s of i)o=s(e,o,r);return o}return n}handleAfterChange(e,n,r){if(!this._isEnabled)return;const i=this._afterChangeHandlers[n.typeName];if(i)for(const o of i)o(e,n,r)}handleBeforeDelete(e,n){if(!this._isEnabled)return!0;const r=this._beforeDeleteHandlers[e.typeName];if(r){for(const i of r)if(i(e,n)===!1)return!1}return!0}handleAfterDelete(e,n){if(!this._isEnabled)return;const r=this._afterDeleteHandlers[e.typeName];if(r)for(const i of r)i(e,n)}handleOperationComplete(e){if(this._isEnabled)for(const n of this._operationCompleteHandlers)n(e)}register(e){const n=[];for(const[r,i]of Object.entries(e))i?.beforeCreate&&n.push(this.registerBeforeCreateHandler(r,i.beforeCreate)),i?.afterCreate&&n.push(this.registerAfterCreateHandler(r,i.afterCreate)),i?.beforeChange&&n.push(this.registerBeforeChangeHandler(r,i.beforeChange)),i?.afterChange&&n.push(this.registerAfterChangeHandler(r,i.afterChange)),i?.beforeDelete&&n.push(this.registerBeforeDeleteHandler(r,i.beforeDelete)),i?.afterDelete&&n.push(this.registerAfterDeleteHandler(r,i.afterDelete));return()=>{for(const r of n)r()}}registerBeforeCreateHandler(e,n){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(n),()=>Id(this._beforeCreateHandlers[e],n)}registerAfterCreateHandler(e,n){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(n),()=>Id(this._afterCreateHandlers[e],n)}registerBeforeChangeHandler(e,n){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(n),()=>Id(this._beforeChangeHandlers[e],n)}registerAfterChangeHandler(e,n){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(n),()=>Id(this._afterChangeHandlers[e],n)}registerBeforeDeleteHandler(e,n){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(n),()=>Id(this._beforeDeleteHandlers[e],n)}registerAfterDeleteHandler(e,n){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(n),()=>Id(this._afterDeleteHandlers[e],n)}registerOperationCompleteHandler(e){return this._operationCompleteHandlers.push(e),()=>Id(this._operationCompleteHandlers,e)}}function Id(t,e){const n=t.indexOf(e);n>=0&&t.splice(n,1)}class L2{id;records;history=qt("history",0,{historyLength:1e3});query;listeners=new Set;historyAccumulator=new dle;historyReactor;cancelHistoryReactor(){}schema;props;scopedTypes;sideEffects=new cle(this);constructor(e){const{initialData:n,schema:r,id:i}=e;this.id=i??Qt(),this.schema=r,this.props=e.props,n?this.records=new fT("store",go(n).map(([o,s])=>[o,this.schema.validateRecord(this,s,"initialize",null)])):this.records=new fT("store"),this.query=new lle(this.records,this.history),this.historyReactor=xae("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:o=>this.cancelHistoryReactor=g2(o)}),this.scopedTypes={document:new Set(ar(this.schema.types).filter(o=>o.scope==="document").map(o=>o.typeName)),session:new Set(ar(this.schema.types).filter(o=>o.scope==="session").map(o=>o.typeName)),presence:new Set(ar(this.schema.types).filter(o=>o.scope==="presence").map(o=>o.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){const e=this.historyAccumulator.flush();for(const{changes:n,source:r}of e){let i=null,o=null,s=null;for(const{onHistory:a,filters:l}of this.listeners)if(!(l.source!=="all"&&l.source!==r))if(l.scope!=="all")if(l.scope==="document"){if(o??=this.filterChangesByScope(n,"document"),!o)continue;a({changes:o,source:r})}else if(l.scope==="session"){if(i??=this.filterChangesByScope(n,"session"),!i)continue;a({changes:i,source:r})}else{if(s??=this.filterChangesByScope(n,"presence"),!s)continue;a({changes:s,source:r})}else a({changes:n,source:r})}}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(e,n){const r={added:Em(e.added,(i,o)=>this.scopedTypes[n].has(o.typeName)),updated:Em(e.updated,(i,o)=>this.scopedTypes[n].has(o[1].typeName)),removed:Em(e.removed,(i,o)=>this.scopedTypes[n].has(o.typeName))};return Object.keys(r.added).length===0&&Object.keys(r.updated).length===0&&Object.keys(r.removed).length===0?null:r}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(n=>this.schema.validateRecord(this,n,e,null))}put(e,n){this.atomic(()=>{const r={},i={};let o,s=!1;const a=this.isMergingRemoteChanges?"remote":"user";for(let l=0,c=e.length;l<c;l++){o=e[l];const d=this.records.__unsafe__getWithoutCapture(o.id);if(d){if(o=this.sideEffects.handleBeforeChange(d,o,a),this.schema.validateRecord(this,o,n??"updateRecord",d)===d)continue;o=o,this.records.set(o.id,o),s=!0,r[o.id]=[d,o],this.addDiffForAfterEvent(d,o)}else o=this.sideEffects.handleBeforeCreate(o,a),s=!0,o=this.schema.validateRecord(this,o,n??"createRecord",null),o=o,i[o.id]=o,this.addDiffForAfterEvent(null,o),this.records.set(o.id,o)}s&&this.updateHistory({added:i,updated:r,removed:{}})})}remove(e){this.atomic(()=>{const n=new Set(e),r=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(const s of e){const a=this.records.__unsafe__getWithoutCapture(s);a&&this.sideEffects.handleBeforeDelete(a,r)===!1&&n.delete(s)}const i=this.records.deleteMany(n);if(i.length===0)return;const o={};for(const[s,a]of i)o[s]=a,this.addDiffForAfterEvent(a,null);this.updateHistory({added:{},updated:{},removed:o})})}get(e){return this.records.get(e)}unsafeGetWithoutCapture(e){return this.records.__unsafe__getWithoutCapture(e)}serialize(e="document"){const n={};for(const[r,i]of this.records)(e==="all"||this.scopedTypes[e].has(i.typeName))&&(n[r]=i);return n}getStoreSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}migrateSnapshot(e){const n=this.schema.migrateStoreSnapshot(e);if(n.type==="error")throw new Error(`Failed to migrate snapshot: ${n.reason}`);return{store:n.value,schema:this.schema.serialize()}}loadStoreSnapshot(e){const n=this.schema.migrateStoreSnapshot(e);if(n.type==="error")throw new Error(`Failed to migrate snapshot: ${n.reason}`);const r=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic(()=>{this.clear(),this.put(Object.values(n.value)),this.ensureStoreIsUsable()})}finally{this.sideEffects.setIsEnabled(r)}}allRecords(){return Array.from(this.records.values())}clear(){this.remove(Array.from(this.records.keys()))}update(e,n){const r=this.unsafeGetWithoutCapture(e);if(!r){console.error(`Record ${e} not found. This is probably an error`);return}this.put([n(r)])}has(e){return this.records.has(e)}listen(e,n){this._flushHistory();const r={onHistory:e,filters:{source:n?.source??"all",scope:n?.scope??"all"}};return this.historyReactor.scheduler.isActivelyListening||(this.historyReactor.start(),this.historyReactor.scheduler.execute()),this.listeners.add(r),()=>{this.listeners.delete(r),this.listeners.size===0&&this.historyReactor.stop()}}isMergingRemoteChanges=!1;mergeRemoteChanges(e){if(this.isMergingRemoteChanges)return e();if(this._isInAtomicOp)throw new Error("Cannot merge remote changes while in atomic operation");try{this.atomic(e,!0,!0)}finally{this.ensureStoreIsUsable()}}extractingChanges(e){const n=[],r=this.historyAccumulator.addInterceptor(i=>n.push(i.changes));try{return ws(e),Vy(n)}finally{r()}}applyDiff(e,{runCallbacks:n=!0,ignoreEphemeralKeys:r=!1}={}){this.atomic(()=>{const i=ar(e.added);for(const[s,a]of ar(e.updated)){const l=this.schema.getType(a.typeName);if(r&&l.ephemeralKeySet.size){const c=this.get(a.id);if(!c){i.push(a);continue}let d=null;for(const[u,p]of Object.entries(a))l.ephemeralKeySet.has(u)||Object.is(p,wr(c,u))||(d||(d={...c}),d[u]=p);d&&i.push(d)}else i.push(a)}const o=Tm(e.removed);i.length&&this.put(i),o.length&&this.remove(o)},n)}createCache(e){const n=new ki;return{get:r=>{const i=this.records.getAtom(r);if(i)return n.get(i,()=>e(r,i)).get()}}}createComputedCache(e,n,r){return this.createCache((i,o)=>{const s=r?.areRecordsEqual?fe(`${e}:${i}:isEqual`,()=>o.get(),{isEqual:r.areRecordsEqual}):o;return fe(e+":"+i,()=>n(s.get()),{isEqual:r?.areResultsEqual})})}_integrityChecker;ensureStoreIsUsable(){this.atomic(()=>{this._integrityChecker??=this.schema.createIntegrityChecker(this),this._integrityChecker?.()})}_isPossiblyCorrupted=!1;markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}pendingAfterEvents=null;addDiffForAfterEvent(e,n){if(Ge(this.pendingAfterEvents,"must be in event operation"),e===n||(e&&n&&Ge(e.id===n.id),!e&&!n))return;const r=(e||n).id,i=this.pendingAfterEvents.get(r);i?i.after=n:this.pendingAfterEvents.set(r,{before:e,after:n})}flushAtomicCallbacks(e){let n=0,r=e?"remote":"user";for(;this.pendingAfterEvents;){const i=this.pendingAfterEvents;if(this.pendingAfterEvents=null,!!this.sideEffects.isEnabled()){if(n++,n>100)throw new Error("Maximum store update depth exceeded, bailing out");for(const{before:o,after:s}of i.values())o&&s&&o!==s&&!Bu(o,s)?this.sideEffects.handleAfterChange(o,s,r):o&&!s?this.sideEffects.handleAfterDelete(o,r):!o&&s&&this.sideEffects.handleAfterCreate(s,r);this.pendingAfterEvents?r="user":this.sideEffects.handleOperationComplete(r)}}}_isInAtomicOp=!1;atomic(e,n=!0,r=!1){return ws(()=>{if(this._isInAtomicOp){this.pendingAfterEvents||(this.pendingAfterEvents=new Map);const o=this.sideEffects.isEnabled();Ge(!r,"cannot call mergeRemoteChanges while in atomic operation");try{return o&&!n&&this.sideEffects.setIsEnabled(!1),e()}finally{this.sideEffects.setIsEnabled(o)}}this.pendingAfterEvents=new Map;const i=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(n??i),this._isInAtomicOp=!0,r&&(this.isMergingRemoteChanges=!0);try{const o=e();return this.isMergingRemoteChanges=!1,this.flushAtomicCallbacks(r),o}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(i),this._isInAtomicOp=!1,this.isMergingRemoteChanges=!1}})}addHistoryInterceptor(e){return this.historyAccumulator.addInterceptor(n=>e(n,this.isMergingRemoteChanges?"remote":"user"))}}function ule(t){if(t.length===0)return[];const e=[];let n=[t[0]],r;for(let i=1,o=t.length;i<o;i++)r=t[i],n[0].source!==r.source&&(e.push(n),n=[]),n.push(r);return e.push(n),e.map(i=>({source:i[0].source,changes:Vy(i.map(o=>o.changes))}))}class dle{_history=[];_interceptors=new Set;addInterceptor(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const n of this._interceptors)n(e)}flush(){const e=ule(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function Gw(t,e,n){const r=new ki;return{get(i,o){return r.get(i,()=>(i instanceof L2?i:i.store).createComputedCache(t,l=>e(i,l),n)).get(o)}}}function hle(t){if(t.schemaVersion>2||t.schemaVersion<1)return Iu.err("Bad schema version");if(t.schemaVersion===2)return Iu.ok(t);const e={schemaVersion:2,sequences:{"com.tldraw.store":t.storeVersion}};for(const[n,r]of Object.entries(t.recordVersions))if(e.sequences[`com.tldraw.${n}`]=r.version,"subTypeKey"in r)for(const[i,o]of Object.entries(r.subTypeVersions))e.sequences[`com.tldraw.${n}.${i}`]=o;return Iu.ok(e)}class z2{constructor(e,n){this.types=e,this.options=n;for(const i of n.migrations??[])Ge(!this.migrations[i.sequenceId],`Duplicate migration sequenceId ${i.sequenceId}`),dU(i),this.migrations[i.sequenceId]=i;const r=Object.values(this.migrations).flatMap(i=>i.sequence);this.sortedMigrations=ole(r);for(const i of this.sortedMigrations)if(i.dependsOn?.length)for(const o of i.dependsOn){const s=r.find(a=>a.id===o);Ge(s,`Migration '${i.id}' depends on missing migration '${o}'`)}}static create(e,n){return new z2(e,n??{})}migrations={};sortedMigrations;migrationCache=new WeakMap;validateRecord(e,n,r,i){try{const o=wr(this.types,n.typeName);if(!o)throw new Error(`Missing definition for record type ${n.typeName}`);return o.validate(n,i??void 0)}catch(o){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:n,phase:r,recordBefore:i,error:o});throw o}}getMigrationsSince(e){const n=this.migrationCache.get(e);if(n)return n;const r=hle(e);if(!r.ok)return this.migrationCache.set(e,r),r;const i=r.value,o=new Set(Object.keys(i.sequences).filter(l=>this.migrations[l]));for(const l in this.migrations)i.sequences[l]===void 0&&this.migrations[l].retroactive&&o.add(l);if(o.size===0){const l=Iu.ok([]);return this.migrationCache.set(e,l),l}const s=new Set;for(const l of o){const c=i.sequences[l];if(typeof c!="number"&&this.migrations[l].retroactive||c===0){for(const p of this.migrations[l].sequence)s.add(p.id);continue}const d=`${l}/${c}`,u=this.migrations[l].sequence.findIndex(p=>p.id===d);if(u===-1){const p=Iu.err("Incompatible schema?");return this.migrationCache.set(e,p),p}for(const p of this.migrations[l].sequence.slice(u+1))s.add(p.id)}const a=Iu.ok(this.sortedMigrations.filter(({id:l})=>s.has(l)));return this.migrationCache.set(e,a),a}migratePersistedRecord(e,n,r="up"){const i=this.getMigrationsSince(n);if(!i.ok)return console.error("Error migrating record",i.error),{type:"error",reason:su.MigrationError};let o=i.value;if(o.length===0)return{type:"success",value:e};if(o.some(s=>s.scope==="store"))return{type:"error",reason:r==="down"?su.TargetVersionTooOld:su.TargetVersionTooNew};if(r==="down"){if(!o.every(s=>s.down))return{type:"error",reason:su.TargetVersionTooOld};o=o.slice().reverse()}e=fn(e);try{for(const s of o){if(s.scope==="store")throw new Error;if(!(s.filter?s.filter(e):!0))continue;const l=s[r](e);l&&(e=fn(l))}}catch(s){return console.error("Error migrating record",s),{type:"error",reason:su.MigrationError}}return{type:"success",value:e}}migrateStoreSnapshot(e,n){let{store:r}=e;const i=this.getMigrationsSince(e.schema);if(!i.ok)return console.error("Error migrating store",i.error),{type:"error",reason:su.MigrationError};const o=i.value;if(o.length===0)return{type:"success",value:r};n?.mutateInputStore||(r=fn(r));try{for(const s of o)if(s.scope==="record")for(const[a,l]of Object.entries(r)){if(!(s.filter?s.filter(l):!0))continue;const d=s.up(l);d&&(r[a]=d)}else if(s.scope==="store"){const a=s.up(r);a&&(r=a)}else Wt(s)}catch(s){return console.error("Error migrating store",s),{type:"error",reason:su.MigrationError}}return{type:"success",value:r}}createIntegrityChecker(e){return this.options.createIntegrityChecker?.(e)??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e,sequence:n})=>[e,n.length?rb(n.at(-1).id).version:0]))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e})=>[e,0]))}}getType(e){const n=wr(this.types,e);return Ge(n,"record type does not exists"),n}}Fu("@tldraw/store","4.1.1","esm");function ple(t){if(!t.length)return null;let e="";for(const n of t)typeof n=="number"?e+=`.${n}`:n.startsWith("(")?e.endsWith(")")?e=`${e.slice(0,-1)}, ${n.slice(1)}`:e+=n:e+=`.${n}`;return e=e.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,""),e.startsWith(".")?e.slice(1):e}class Vt extends Error{constructor(e,n=[]){const r=ple(n),i=e.split(`
`).map((o,s)=>s===0?o:`  ${o}`).join(`
`);super(n?`At ${r}: ${i}`:i),this.rawMessage=e,this.path=n}name="ValidationError"}function Go(t,e){try{return e()}catch(n){throw n instanceof Vt?new Vt(n.rawMessage,[t,...n.path]):new Vt(n.toString(),[t])}}function Mu(t){if(t===null)return"null";if(Array.isArray(t))return"an array";const e=typeof t;switch(e){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${e}`;case"object":return`an ${e}`;case"undefined":return"undefined";default:Wt(e)}}class Xi{constructor(e,n){this.validationFn=e,this.validateUsingKnownGoodVersionFn=n}validate(e){return this.validationFn(e)}validateUsingKnownGoodVersion(e,n){return Object.is(e,n)?e:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(e,n):this.validate(n)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return Sle(this)}optional(){return pU(this)}refine(e){return new Xi(n=>e(this.validate(n)),(n,r)=>{const i=this.validateUsingKnownGoodVersion(n,r);return Object.is(n,i)?n:e(i)})}check(e,n){return typeof e=="string"?this.refine(r=>(Go(`(check ${e})`,()=>n(r)),r)):this.refine(r=>(e(r),r))}}class fle extends Xi{constructor(e){super(n=>{const r=Oz.validate(n);for(let i=0;i<r.length;i++)Go(i,()=>e.validate(r[i]));return r},(n,r)=>{if(!e.validateUsingKnownGoodVersion)return this.validate(r);const i=Oz.validate(r);let o=n.length!==i.length;for(let s=0;s<i.length;s++){const a=i[s];if(s>=n.length){o=!0,Go(s,()=>e.validate(a));continue}if(Object.is(n[s],a))continue;const l=Go(s,()=>e.validateUsingKnownGoodVersion(n[s],a));Object.is(l,n[s])||(o=!0)}return o?r:n}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(e.length===0)throw new Vt("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new Vt("Expected an array with length greater than 1")})}}class ob extends Xi{constructor(e,n=!1){super(r=>{if(typeof r!="object"||r===null)throw new Vt(`Expected object, got ${Mu(r)}`);for(const[i,o]of Object.entries(e))Go(i,()=>{o.validate(wr(r,i))});if(!n){for(const i of Object.keys(r))if(!sa(e,i))throw new Vt("Unexpected property",[i])}return r},(r,i)=>{if(typeof i!="object"||i===null)throw new Vt(`Expected object, got ${Mu(i)}`);let o=!1;for(const[s,a]of Object.entries(e)){const l=wr(r,s),c=wr(i,s);if(Object.is(l,c))continue;const d=Go(s,()=>{const u=a;return u.validateUsingKnownGoodVersion?u.validateUsingKnownGoodVersion(l,c):u.validate(c)});Object.is(d,l)||(o=!0)}if(!n){for(const s of Object.keys(i))if(!sa(e,s))throw new Vt("Unexpected property",[s])}for(const s of Object.keys(r))if(!sa(i,s)){o=!0;break}return o?i:r}),this.config=e,this.shouldAllowUnknownProperties=n}allowUnknownProperties(){return new ob(this.config,!0)}extend(e){return new ob({...this.config,...e})}}class Yw extends Xi{constructor(e,n,r,i){super(o=>{this.expectObject(o);const{matchingSchema:s,variant:a}=this.getMatchingSchemaAndVariant(o);return s===void 0?this.unknownValueValidation(o,a):Go(`(${e} = ${a})`,()=>s.validate(o))},(o,s)=>{this.expectObject(s),this.expectObject(o);const{matchingSchema:a,variant:l}=this.getMatchingSchemaAndVariant(s);return a===void 0?this.unknownValueValidation(s,l):wr(o,e)!==wr(s,e)?Go(`(${e} = ${l})`,()=>a.validate(s)):Go(`(${e} = ${l})`,()=>a.validateUsingKnownGoodVersion?a.validateUsingKnownGoodVersion(o,s):a.validate(s))}),this.key=e,this.config=n,this.unknownValueValidation=r,this.useNumberKeys=i}expectObject(e){if(typeof e!="object"||e===null)throw new Vt(`Expected an object, got ${Mu(e)}`,[])}getMatchingSchemaAndVariant(e){const n=wr(e,this.key);if(!this.useNumberKeys&&typeof n!="string")throw new Vt(`Expected a string for key "${this.key}", got ${Mu(n)}`);if(this.useNumberKeys&&!Number.isFinite(Number(n)))throw new Vt(`Expected a number for key "${this.key}", got "${n}"`);return{matchingSchema:sa(this.config,n)?this.config[n]:void 0,variant:n}}validateUnknownVariants(e){return new Yw(this.key,this.config,e,this.useNumberKeys)}}class gle extends Xi{constructor(e,n){super(r=>{if(typeof r!="object"||r===null)throw new Vt(`Expected object, got ${Mu(r)}`);for(const[i,o]of Object.entries(r))Go(i,()=>{e.validate(i),n.validate(o)});return r},(r,i)=>{if(typeof i!="object"||i===null)throw new Vt(`Expected object, got ${Mu(i)}`);let o=!1;for(const[s,a]of Object.entries(i)){if(!sa(r,s)){o=!0,Go(s,()=>{e.validate(s),n.validate(a)});continue}const l=wr(r,s),c=a;if(Object.is(l,c))continue;const d=Go(s,()=>n.validateUsingKnownGoodVersion?n.validateUsingKnownGoodVersion(l,c):n.validate(c));Object.is(d,l)||(o=!0)}for(const s of Object.keys(r))if(!sa(i,s)){o=!0;break}return o?i:r}),this.keyValidator=e,this.valueValidator=n}}function F2(t){return new Xi(e=>{if(typeof e!==t)throw new Vt(`Expected ${t}, got ${Mu(e)}`);return e})}const mle=new Xi(t=>t),yle=new Xi(t=>t),_t=F2("string"),ct=F2("number").check(t=>{if(Number.isNaN(t))throw new Vt("Expected a number, got NaN");if(!Number.isFinite(t))throw new Vt(`Expected a finite number, got ${t}`)}),sb=ct.check(t=>{if(t<0)throw new Vt(`Expected a positive number, got ${t}`)}),kr=ct.check(t=>{if(t<=0)throw new Vt(`Expected a non-zero positive number, got ${t}`)}),hU=ct.check(t=>{if(!Number.isInteger(t))throw new Vt(`Expected an integer, got ${t}`)}),RS=hU.check(t=>{if(t<0)throw new Vt(`Expected a positive integer, got ${t}`)}),vle=hU.check(t=>{if(t<=0)throw new Vt(`Expected a non-zero positive integer, got ${t}`)}),Tt=F2("boolean");function Ki(t){return new Xi(e=>{if(e!==t)throw new Vt(`Expected ${t}, got ${JSON.stringify(e)}`);return t})}const Oz=new Xi(t=>{if(!Array.isArray(t))throw new Vt(`Expected an array, got ${Mu(t)}`);return t});function Jr(t){return new fle(t)}function Lt(t){return new ob(t)}function gT(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null||Object.getPrototypeOf(t)===gse)}function mT(t){return t===null||typeof t=="number"||typeof t=="string"||typeof t=="boolean"?!0:Array.isArray(t)?t.every(mT):gT(t)?Object.values(t).every(mT):!1}const xi=new Xi(t=>{if(mT(t))return t;throw new Vt(`Expected json serializable value, got ${typeof t}`)},(t,e)=>{if(Array.isArray(t)&&Array.isArray(e)){let n=t.length!==e.length;for(let r=0;r<e.length;r++){if(r>=t.length){n=!0,xi.validate(e[r]);continue}const i=t[r],o=e[r];if(Object.is(i,o))continue;const s=xi.validateUsingKnownGoodVersion(i,o);Object.is(s,i)||(n=!0)}return n?e:t}else if(gT(t)&&gT(e)){let n=!1;for(const r of Object.keys(e)){if(!sa(t,r)){n=!0,xi.validate(e[r]);continue}const i=t[r],o=e[r];if(Object.is(i,o))continue;const s=xi.validateUsingKnownGoodVersion(i,o);Object.is(s,i)||(n=!0)}for(const r of Object.keys(t))if(!sa(e,r)){n=!0;break}return n?e:t}else return xi.validate(e)});function ab(t,e){return new gle(t,e)}function B2(t,e){return new Yw(t,e,(n,r)=>{throw new Vt(`Expected one of ${Object.keys(e).map(i=>JSON.stringify(i)).join(" or ")}, got ${JSON.stringify(r)}`,[t])},!1)}function xle(t,e){return new Yw(t,e,(n,r)=>{throw new Vt(`Expected one of ${Object.keys(e).map(i=>JSON.stringify(i)).join(" or ")}, got ${JSON.stringify(r)}`,[t])},!0)}function jl(t,e){return new Xi(n=>Go(t,()=>e.validate(n)),(n,r)=>Go(t,()=>e.validateUsingKnownGoodVersion?e.validateUsingKnownGoodVersion(n,r):e.validate(r)))}function Xw(t){return new Xi(e=>{if(!t.has(e)){const n=Array.from(t,r=>JSON.stringify(r)).join(" or ");throw new Vt(`Expected ${n}, got ${e}`)}return e})}function pU(t){return new Xi(e=>{if(e!==void 0)return t.validate(e)},(e,n)=>{if(!(e===void 0&&n===void 0)&&n!==void 0)return t.validateUsingKnownGoodVersion&&e!==void 0?t.validateUsingKnownGoodVersion(e,n):t.validate(n)})}function Sle(t){return new Xi(e=>e===null?null:t.validate(e),(e,n)=>n===null?null:t.validateUsingKnownGoodVersion&&e!==null?t.validateUsingKnownGoodVersion(e,n):t.validate(n))}function Zd(...t){return Xw(new Set(t))}function U2(t){try{return new URL(t)}catch{if(t.startsWith("/")||t.startsWith("./"))try{return new URL(t,"http://example.com")}catch{throw new Vt(`Expected a valid url, got ${JSON.stringify(t)}`)}throw new Vt(`Expected a valid url, got ${JSON.stringify(t)}`)}}const ble=new Set(["http:","https:","mailto:"]),Cs=_t.check(t=>{if(t==="")return;const e=U2(t);if(!ble.has(e.protocol.toLowerCase()))throw new Vt(`Expected a valid url, got ${JSON.stringify(t)} (invalid protocol)`)}),wle=new Set(["http:","https:","data:","asset:"]),Jd=_t.check(t=>{if(t==="")return;const e=U2(t);if(!wle.has(e.protocol.toLowerCase()))throw new Vt(`Expected a valid url, got ${JSON.stringify(t)} (invalid protocol)`)});_t.check(t=>{if(t==="")return;if(!U2(t).protocol.toLowerCase().match(/^https?:$/))throw new Vt(`Expected a valid url, got ${JSON.stringify(t)} (invalid protocol)`)});const H2=_t.refine(t=>{try{return sse(t),t}catch{throw new Vt(`Expected an index key, got ${JSON.stringify(t)}`)}});Fu("@tldraw/validate","4.1.1","esm");function ks(t){return _t.refine(e=>{if(!e.startsWith(`${t}:`))throw new Error(`${t} ID must start with "${t}:"`);return e})}const Zw=ks("asset");function W2(t,e){return Lt({id:Zw,typeName:Ki("asset"),type:Ki(t),props:e,meta:xi})}const Qd=Lt({x:ct,y:ct,z:ct.optional()}),Mm=Lt({x:ct,y:ct,w:ct,h:ct}),fU=ct.check(t=>{if(t<0||t>1)throw new Vt("Opacity must be between 0 and 1")}),kle=_t.refine(t=>{if(!t.startsWith("page:")&&!t.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return t}),Xs=ks("shape");function Ile(t,e,n){return Lt({id:Xs,typeName:Ki("shape"),x:ct,y:ct,rotation:ct,index:H2,parentId:kle,type:Ki(t),isLocked:Tt,opacity:fU,props:e?Lt(e):xi,meta:n?Lt(n):xi})}const _le=ks("binding");function Cle(t,e,n){return Lt({id:_le,typeName:Ki("binding"),type:Ki(t),fromId:Xs,toId:Xs,props:e?Lt(e):xi,meta:n?Lt(n):xi})}Jo("com.tldraw.binding",{});Es({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});function Bd(t){return`binding:${Qt()}`}function Ple(t,e){return Uu(e,(n,r)=>`com.tldraw.binding.${t}/${r}`)}function Tle(t){return Dl("binding",{scope:"document",validator:jl("binding",B2("type",Uu(t,(e,{props:n,meta:r})=>Cle(e,n,r))))}).withDefaultProperties(()=>({meta:{}}))}const Jw=Lt({type:_t,content:Jr(mle)});function dn(t){return{type:"doc",content:t.split(`
`).map(r=>r?{type:"paragraph",content:[{type:"text",text:r}]}:{type:"paragraph"})}}class oi{constructor(e,n,r){this.id=e,this.defaultValue=n,this.type=r}static define(e,n){const{defaultValue:r,type:i=yle}=n;return new oi(e,r,i)}static defineEnum(e,n){const{defaultValue:r,values:i}=n;return new Ele(e,r,i)}setDefaultValue(e){this.defaultValue=e}validate(e){return this.type.validate(e)}validateUsingKnownGoodVersion(e,n){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(e,n):this.validate(n)}}class Ele extends oi{constructor(e,n,r){super(e,n,Zd(...r)),this.values=r}}const Ax=Jo("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),Ale=Es({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:Ax.AddIsLocked,up:t=>{t.isLocked=!1},down:t=>{delete t.isLocked}},{id:Ax.HoistOpacity,up:t=>{t.opacity=Number(t.props.opacity??"1"),delete t.props.opacity},down:t=>{const e=t.opacity;delete t.opacity,t.props.opacity=e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}},{id:Ax.AddMeta,up:t=>{t.meta={}}},{id:Ax.AddWhite,up:t=>{},down:t=>{t.props.color==="white"&&(t.props.color="black")}}]});function Lp(t){return t?t.typeName==="shape":!1}function co(t){return t?t.startsWith("shape:"):!1}function sn(t){return`shape:${t??Qt()}`}function gU(t){const e=new Map;for(const[n,r]of Object.entries(t))if(r instanceof oi){if(e.has(r))throw new Error(`Duplicate style prop ${r.id}. Each style prop can only be used once within a shape.`);e.set(r,n)}return e}function da(t,e){return Uu(e,(n,r)=>`com.tldraw.shape.${t}/${r}`)}function Mle(t){return Dl("shape",{scope:"document",validator:jl("shape",B2("type",Uu(t,(e,{props:n,meta:r})=>Ile(e,n,r))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}function Dz(t,e){const n=[];for(const[r,{migrations:i}]of Object.entries(e)){const o=`com.tldraw.${t}.${r}`;i?"sequenceId"in i?(Ge(o===i.sequenceId,`sequenceId mismatch for ${r} ${qw} migrations. Expected '${o}', got '${i.sequenceId}'`),n.push(i)):"sequence"in i?n.push(Vp({sequenceId:o,retroactive:!0,sequence:i.sequence.map(s=>"id"in s?mU(t,r,s):s)})):n.push(Vp({sequenceId:o,retroactive:!0,sequence:Object.keys(i.migrators).map(s=>Number(s)).sort((s,a)=>s-a).map(s=>({id:`${o}/${s}`,scope:"record",filter:a=>a.typeName===t&&a.type===r,up:a=>{const l=i.migrators[s].up(a);if(l)return l},down:a=>{const l=i.migrators[s].down(a);if(l)return l}}))})):n.push(Vp({sequenceId:o,retroactive:!0,sequence:[]}))}return n}function mU(t,e,n){return{id:n.id,dependsOn:n.dependsOn,scope:"record",filter:r=>r.typeName===t&&r.type===e,up:r=>{const i=n.up(r.props);i&&(r.props=i)},down:typeof n.down=="function"?r=>{const i=n.down(r.props);i&&(r.props=i)}:void 0}}const V2=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],tn={lightMode:{id:"light",text:"#000000",background:"#f9fafb",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",frameHeadingStroke:"#717171",frameHeadingFill:"#ffffff",frameStroke:"#717171",frameFill:"#ffffff",frameText:"#000000",noteFill:"#FCE19C",noteText:"#000000",semi:"#e8e8e8",pattern:"#494949",highlightSrgb:"#fddd00",highlightP3:"color(display-p3 0.972 0.8205 0.05)"},blue:{solid:"#4465e9",fill:"#4465e9",frameHeadingStroke:"#6681ec",frameHeadingFill:"#f9fafe",frameStroke:"#6681ec",frameFill:"#f9fafe",frameText:"#000000",noteFill:"#8AA3FF",noteText:"#000000",semi:"#dce1f8",pattern:"#6681ee",highlightSrgb:"#10acff",highlightP3:"color(display-p3 0.308 0.6632 0.9996)"},green:{solid:"#099268",fill:"#099268",frameHeadingStroke:"#37a684",frameHeadingFill:"#f8fcfa",frameStroke:"#37a684",frameFill:"#f8fcfa",frameText:"#000000",noteFill:"#6FC896",noteText:"#000000",semi:"#d3e9e3",pattern:"#39a785",highlightSrgb:"#00ffc8",highlightP3:"color(display-p3 0.2536 0.984 0.7981)"},grey:{solid:"#9fa8b2",fill:"#9fa8b2",frameHeadingStroke:"#aaaaab",frameHeadingFill:"#fbfcfc",frameStroke:"#aaaaab",frameFill:"#fcfcfd",frameText:"#000000",noteFill:"#C0CAD3",noteText:"#000000",semi:"#eceef0",pattern:"#bcc3c9",highlightSrgb:"#cbe7f1",highlightP3:"color(display-p3 0.8163 0.9023 0.9416)"},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",frameHeadingStroke:"#6cb2f3",frameHeadingFill:"#f8fbfe",frameStroke:"#6cb2f3",frameFill:"#fafcff",frameText:"#000000",noteFill:"#9BC4FD",noteText:"#000000",semi:"#ddedfa",pattern:"#6fbbf8",highlightSrgb:"#00f4ff",highlightP3:"color(display-p3 0.1512 0.9414 0.9996)"},"light-green":{solid:"#4cb05e",fill:"#4cb05e",frameHeadingStroke:"#6dbe7c",frameHeadingFill:"#f8fcf9",frameStroke:"#6dbe7c",frameFill:"#fafdfa",frameText:"#000000",noteFill:"#98D08A",noteText:"#000000",semi:"#dbf0e0",pattern:"#65cb78",highlightSrgb:"#65f641",highlightP3:"color(display-p3 0.563 0.9495 0.3857)"},"light-red":{solid:"#f87777",fill:"#f87777",frameHeadingStroke:"#f89090",frameHeadingFill:"#fffafa",frameStroke:"#f89090",frameFill:"#fffbfb",frameText:"#000000",noteFill:"#F7A5A1",noteText:"#000000",semi:"#f4dadb",pattern:"#fe9e9e",highlightSrgb:"#ff7fa3",highlightP3:"color(display-p3 0.9988 0.5301 0.6397)"},"light-violet":{solid:"#e085f4",fill:"#e085f4",frameHeadingStroke:"#e59bf5",frameHeadingFill:"#fefaff",frameStroke:"#e59bf5",frameFill:"#fefbff",frameText:"#000000",noteFill:"#DFB0F9",noteText:"#000000",semi:"#f5eafa",pattern:"#e9acf8",highlightSrgb:"#ff88ff",highlightP3:"color(display-p3 0.9676 0.5652 0.9999)"},orange:{solid:"#e16919",fill:"#e16919",frameHeadingStroke:"#e68544",frameHeadingFill:"#fef9f6",frameStroke:"#e68544",frameFill:"#fef9f6",frameText:"#000000",noteFill:"#FAA475",noteText:"#000000",semi:"#f8e2d4",pattern:"#f78438",highlightSrgb:"#ffa500",highlightP3:"color(display-p3 0.9988 0.6905 0.266)"},red:{solid:"#e03131",fill:"#e03131",frameHeadingStroke:"#e55757",frameHeadingFill:"#fef7f7",frameStroke:"#e55757",frameFill:"#fef9f9",frameText:"#000000",noteFill:"#FC8282",noteText:"#000000",semi:"#f4dadb",pattern:"#e55959",highlightSrgb:"#ff636e",highlightP3:"color(display-p3 0.9992 0.4376 0.45)"},violet:{solid:"#ae3ec9",fill:"#ae3ec9",frameHeadingStroke:"#bc62d3",frameHeadingFill:"#fcf7fd",frameStroke:"#bc62d3",frameFill:"#fdf9fd",frameText:"#000000",noteFill:"#DB91FD",noteText:"#000000",semi:"#ecdcf2",pattern:"#bd63d3",highlightSrgb:"#c77cff",highlightP3:"color(display-p3 0.7469 0.5089 0.9995)"},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",frameHeadingStroke:"#f3bb6c",frameHeadingFill:"#fefcf8",frameStroke:"#f3bb6c",frameFill:"#fffdfa",frameText:"#000000",noteFill:"#FED49A",noteText:"#000000",semi:"#f9f0e6",pattern:"#fecb92",highlightSrgb:"#fddd00",highlightP3:"color(display-p3 0.972 0.8705 0.05)"},white:{solid:"#FFFFFF",fill:"#FFFFFF",semi:"#f5f5f5",pattern:"#f9f9f9",frameHeadingStroke:"#7d7d7d",frameHeadingFill:"#ffffff",frameStroke:"#7d7d7d",frameFill:"#ffffff",frameText:"#000000",noteFill:"#FFFFFF",noteText:"#000000",highlightSrgb:"#ffffff",highlightP3:"color(display-p3 1 1 1)"}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",frameHeadingStroke:"#5c5c5c",frameHeadingFill:"#252525",frameStroke:"#5c5c5c",frameFill:"#0c0c0c",frameText:"#f2f2f2",noteFill:"#2c2c2c",noteText:"#f2f2f2",semi:"#2c3036",pattern:"#989898",highlightSrgb:"#d2b700",highlightP3:"color(display-p3 0.8078 0.6225 0.0312)"},blue:{solid:"#4f72fc",fill:"#4f72fc",frameHeadingStroke:"#384994",frameHeadingFill:"#1C2036",frameStroke:"#384994",frameFill:"#11141f",frameText:"#f2f2f2",noteFill:"#2A3F98",noteText:"#f2f2f2",semi:"#262d40",pattern:"#3a4b9e",highlightSrgb:"#0079d2",highlightP3:"color(display-p3 0.0032 0.4655 0.7991)"},green:{solid:"#099268",fill:"#099268",frameHeadingStroke:"#10513C",frameHeadingFill:"#14241f",frameStroke:"#10513C",frameFill:"#0E1614",frameText:"#f2f2f2",noteFill:"#014429",noteText:"#f2f2f2",semi:"#253231",pattern:"#366a53",highlightSrgb:"#009774",highlightP3:"color(display-p3 0.0085 0.582 0.4604)"},grey:{solid:"#9398b0",fill:"#9398b0",frameHeadingStroke:"#42474D",frameHeadingFill:"#23262A",frameStroke:"#42474D",frameFill:"#151719",frameText:"#f2f2f2",noteFill:"#56595F",noteText:"#f2f2f2",semi:"#33373c",pattern:"#7c8187",highlightSrgb:"#9cb4cb",highlightP3:"color(display-p3 0.6299 0.7012 0.7856)"},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",frameHeadingStroke:"#075797",frameHeadingFill:"#142839",frameStroke:"#075797",frameFill:"#0B1823",frameText:"#f2f2f2",noteFill:"#1F5495",noteText:"#f2f2f2",semi:"#2a3642",pattern:"#4d7aa9",highlightSrgb:"#00bdc8",highlightP3:"color(display-p3 0.0023 0.7259 0.7735)"},"light-green":{solid:"#40c057",fill:"#40c057",frameHeadingStroke:"#1C5427",frameHeadingFill:"#18251A",frameStroke:"#1C5427",frameFill:"#0F1911",frameText:"#f2f2f2",noteFill:"#21581D",noteText:"#f2f2f2",semi:"#2a3830",pattern:"#4e874e",highlightSrgb:"#00a000",highlightP3:"color(display-p3 0.2711 0.6172 0.0195)"},"light-red":{solid:"#ff8787",fill:"#ff8787",frameHeadingStroke:"#6f3232",frameHeadingFill:"#341818",frameStroke:"#6f3232",frameFill:"#181212",frameText:"#f2f2f2",noteFill:"#7a3333",noteText:"#f2f2f2",semi:"#3c2b2b",pattern:"#a56767",highlightSrgb:"#db005b",highlightP3:"color(display-p3 0.7849 0.0585 0.3589)"},"light-violet":{solid:"#e599f7",fill:"#e599f7",frameHeadingStroke:"#6c367a",frameHeadingFill:"#2D2230",frameStroke:"#6c367a",frameFill:"#1C151E",frameText:"#f2f2f2",noteFill:"#762F8E",noteText:"#f2f2f2",semi:"#383442",pattern:"#9770a9",highlightSrgb:"#c400c7",highlightP3:"color(display-p3 0.7024 0.0403 0.753)"},orange:{solid:"#f76707",fill:"#f76707",frameHeadingStroke:"#773a0e",frameHeadingFill:"#2f1d13",frameStroke:"#773a0e",frameFill:"#1c1512",frameText:"#f2f2f2",noteFill:"#7c3905",noteText:"#f2f2f2",semi:"#3b2e27",pattern:"#9f552d",highlightSrgb:"#d07a00",highlightP3:"color(display-p3 0.7699 0.4937 0.0085)"},red:{solid:"#e03131",fill:"#e03131",frameHeadingStroke:"#701e1e",frameHeadingFill:"#301616",frameStroke:"#701e1e",frameFill:"#1b1313",frameText:"#f2f2f2",noteFill:"#7e201f",noteText:"#f2f2f2",semi:"#382726",pattern:"#8f3734",highlightSrgb:"#de002c",highlightP3:"color(display-p3 0.7978 0.0509 0.2035)"},violet:{solid:"#ae3ec9",fill:"#ae3ec9",frameHeadingStroke:"#6d1583",frameHeadingFill:"#27152e",frameStroke:"#6d1583",frameFill:"#1b0f21",frameText:"#f2f2f2",noteFill:"#5f1c70",noteText:"#f2f2f2",semi:"#342938",pattern:"#763a8b",highlightSrgb:"#9e00ee",highlightP3:"color(display-p3 0.5651 0.0079 0.8986)"},yellow:{solid:"#ffc034",fill:"#ffc034",frameHeadingStroke:"#684e12",frameHeadingFill:"#2a2113",frameStroke:"#684e12",frameFill:"#1e1911",frameText:"#f2f2f2",noteFill:"#8a5e1c",noteText:"#f2f2f2",semi:"#3b352b",pattern:"#fecb92",highlightSrgb:"#d2b700",highlightP3:"color(display-p3 0.8078 0.7225 0.0312)"},white:{solid:"#f3f3f3",fill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",frameHeadingStroke:"#ffffff",frameHeadingFill:"#ffffff",frameStroke:"#ffffff",frameFill:"#ffffff",frameText:"#000000",noteFill:"#eaeaea",noteText:"#1d1d1d",highlightSrgb:"#ffffff",highlightP3:"color(display-p3 1 1 1)"}}};function Ku(t){return t.isDarkMode?tn.darkMode:tn.lightMode}const vo=oi.defineEnum("tldraw:color",{defaultValue:"black",values:V2}),K2=oi.defineEnum("tldraw:labelColor",{defaultValue:"black",values:V2}),Ole=new Set(V2);function Dle(t){return Ole.has(t)}function Ht(t,e,n){return Dle(e)?t[e][n]:e}const eh=oi.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),th=oi.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill"]}),Ou=oi.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),jle={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},Wa=oi.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),Rle=["arc","elbow"],lb=oi.defineEnum("tldraw:arrowKind",{defaultValue:"arc",values:Rle}),yU=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],yT=oi.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:yU}),vT=oi.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:yU}),vU={kind:lb,labelColor:K2,color:vo,fill:th,dash:eh,size:Wa,arrowheadStart:yT,arrowheadEnd:vT,font:Ou,start:Qd,end:Qd,bend:ct,richText:Jw,labelPosition:ct,scale:kr,elbowMidPoint:ct},au=da("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5,AddElbow:6,AddRichText:7});function cp(t){return mU("shape","arrow",t)}const xU=Vp({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[cp({id:au.AddLabelColor,up:t=>{t.labelColor="black"},down:"retired"}),cp({id:au.AddIsPrecise,up:({start:t,end:e})=>{t.type==="binding"&&(t.isPrecise=!(t.normalizedAnchor.x===.5&&t.normalizedAnchor.y===.5)),e.type==="binding"&&(e.isPrecise=!(e.normalizedAnchor.x===.5&&e.normalizedAnchor.y===.5))},down:({start:t,end:e})=>{t.type==="binding"&&(t.isPrecise||(t.normalizedAnchor={x:.5,y:.5}),delete t.isPrecise),e.type==="binding"&&(e.isPrecise||(e.normalizedAnchor={x:.5,y:.5}),delete e.isPrecise)}}),cp({id:au.AddLabelPosition,up:t=>{t.labelPosition=.5},down:t=>{delete t.labelPosition}}),{id:au.ExtractBindings,scope:"store",up:t=>{const e=Object.values(t).filter(n=>n.typeName==="shape"&&n.type==="arrow");for(const n of e){const{start:r,end:i}=n.props;if(r.type==="binding"){const o=Bd(),s={typeName:"binding",id:o,type:"arrow",fromId:n.id,toId:r.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:r.normalizedAnchor,isExact:r.isExact,isPrecise:r.isPrecise}};t[o]=s,n.props.start={x:0,y:0}}else delete n.props.start.type;if(i.type==="binding"){const o=Bd(),s={typeName:"binding",id:o,type:"arrow",fromId:n.id,toId:i.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:i.normalizedAnchor,isExact:i.isExact,isPrecise:i.isPrecise}};t[o]=s,n.props.end={x:0,y:0}}else delete n.props.end.type}}},cp({id:au.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}),cp({id:au.AddElbow,up:t=>{t.kind="arc",t.elbowMidPoint=.5},down:t=>{delete t.kind,delete t.elbowMidPoint}}),cp({id:au.AddRichText,up:t=>{t.richText=dn(t.text),delete t.text}})]}),$le=Zd("center","edge-point","edge","none"),SU={terminal:Zd("start","end"),normalizedAnchor:Qd,isExact:Tt,isPrecise:Tt,snap:$le},Nle=Ple("arrow",{AddSnap:1}),bU={sequence:[{dependsOn:[au.ExtractBindings]},{id:Nle.AddSnap,up:t=>{t.snap="none"},down:t=>{delete t.snap}}]},Lle=jl("camera",Lt({typeName:Ki("camera"),id:ks("camera"),x:ct,y:ct,z:ct,meta:xi})),zle=Jo("com.tldraw.camera",{AddMeta:1}),Fle=Es({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:zle.AddMeta,up:t=>{t.meta={}}}]}),yl=Dl("camera",{validator:Lle,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),Ble=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),wU=Xw(Ble),Ule=Lt({type:wU,rotation:ct}),Hle=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),Wle=Xw(Hle),Vle=new Set(["starting","paused","active","stopping"]),kU=Lt({id:_t,points:Jr(Qd),size:sb,color:Wle,opacity:ct,state:Xw(Vle),delay:ct,shrink:ct,taper:Tt}),ey=ks("page"),Kle=jl("page",Lt({typeName:Ki("page"),id:ey,name:_t,index:H2,meta:xi})),qle=Jo("com.tldraw.page",{AddMeta:1}),Gle=Es({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:qle.AddMeta,up:t=>{t.meta={}}}]}),yo=Dl("page",{validator:Kle,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function hi(t){return yo.isId(t)}const Yle={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1};function IU(t){return t?Em(t,e=>Yle[e]):null}ks("instance");function Xle(t){const e={};for(const[r,i]of t)e[r]=pU(i);const n=jl("instance",Lt({typeName:Ki("instance"),id:ks("instance"),currentPageId:ey,followingUserId:_t.nullable(),brush:Mm.nullable(),opacityForNextShape:fU,stylesForNextShape:Lt(e),cursor:Ule,scribbles:Jr(kU),isFocusMode:Tt,isDebugMode:Tt,isToolLocked:Tt,exportBackground:Tt,screenBounds:Mm,insets:Jr(Tt),zoomBrush:Mm.nullable(),isPenMode:Tt,isGridMode:Tt,chatMessage:_t,isChatting:Tt,highlightedUserIds:Jr(_t),isFocused:Tt,devicePixelRatio:ct,isCoarsePointer:Tt,isHoveringCanvas:Tt.nullable(),openMenus:Jr(_t),isChangingStyle:Tt,isReadonly:Tt,meta:xi,duplicateProps:Lt({shapeIds:Jr(ks("shape")),offset:Lt({x:ct,y:ct})}).nullable()}));return Dl("instance",{validator:n,scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}const Dn=Jo("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),Zle=Es({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:Dn.AddTransparentExportBgs,up:t=>({...t,exportBackground:!0})},{id:Dn.RemoveDialog,up:({dialog:t,...e})=>e},{id:Dn.AddToolLockMode,up:t=>({...t,isToolLocked:!1})},{id:Dn.RemoveExtraPropsForNextShape,up:({propsForNextShape:t,...e})=>({...e,propsForNextShape:Object.fromEntries(Object.entries(t).filter(([n])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(n)))})},{id:Dn.AddLabelColor,up:({propsForNextShape:t,...e})=>({...e,propsForNextShape:{...t,labelColor:"black"}})},{id:Dn.AddFollowingUserId,up:t=>({...t,followingUserId:null})},{id:Dn.RemoveAlignJustify,up:t=>{let e=t.propsForNextShape.align;return e==="justify"&&(e="start"),{...t,propsForNextShape:{...t.propsForNextShape,align:e}}}},{id:Dn.AddZoom,up:t=>({...t,zoomBrush:null})},{id:Dn.AddVerticalAlign,up:t=>({...t,propsForNextShape:{...t.propsForNextShape,verticalAlign:"middle"}})},{id:Dn.AddScribbleDelay,up:t=>t.scribble!==null?{...t,scribble:{...t.scribble,delay:0}}:{...t}},{id:Dn.RemoveUserId,up:({userId:t,...e})=>e},{id:Dn.AddIsPenModeAndIsGridMode,up:t=>({...t,isPenMode:!1,isGridMode:!1})},{id:Dn.HoistOpacity,up:({propsForNextShape:{opacity:t,...e},...n})=>({...n,opacityForNextShape:Number(t??"1"),propsForNextShape:e})},{id:Dn.AddChat,up:t=>({...t,chatMessage:"",isChatting:!1})},{id:Dn.AddHighlightedUserIds,up:t=>({...t,highlightedUserIds:[]})},{id:Dn.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:t,...e})=>({...e,stylesForNextShape:{}})},{id:Dn.AddMeta,up:t=>({...t,meta:{}})},{id:Dn.RemoveCursorColor,up:t=>{const{color:e,...n}=t.cursor;return{...t,cursor:n}}},{id:Dn.AddLonelyProperties,up:t=>({...t,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:Dn.ReadOnlyReadonly,up:({isReadOnly:t,...e})=>({...e,isReadonly:t})},{id:Dn.AddHoveringCanvas,up:t=>({...t,isHoveringCanvas:null})},{id:Dn.AddScribbles,up:({scribble:t,...e})=>({...e,scribbles:[]})},{id:Dn.AddInset,up:t=>({...t,insets:[!1,!1,!1,!1]}),down:({insets:t,...e})=>({...e})},{id:Dn.AddDuplicateProps,up:t=>({...t,duplicateProps:null}),down:({duplicateProps:t,...e})=>({...e})},{id:Dn.RemoveCanMoveCamera,up:({canMoveCamera:t,...e})=>({...e}),down:t=>({...t,canMoveCamera:!0})}]}),uo="instance:instance",Jle=jl("instance_page_state",Lt({typeName:Ki("instance_page_state"),id:ks("instance_page_state"),pageId:ey,selectedShapeIds:Jr(Xs),hintingShapeIds:Jr(Xs),erasingShapeIds:Jr(Xs),hoveredShapeId:Xs.nullable(),editingShapeId:Xs.nullable(),croppingShapeId:Xs.nullable(),focusedGroupId:Xs.nullable(),meta:xi})),jg=Jo("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),Qle=Es({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:jg.AddCroppingId,up(t){t.croppingShapeId=null}},{id:jg.RemoveInstanceIdAndCameraId,up(t){delete t.instanceId,delete t.cameraId}},{id:jg.AddMeta,up:t=>{t.meta={}}},{id:jg.RenameProperties,up:t=>{},down:t=>{}},{id:jg.RenamePropertiesAgain,up:t=>{t.selectedShapeIds=t.selectedIds,delete t.selectedIds,t.hintingShapeIds=t.hintingIds,delete t.hintingIds,t.erasingShapeIds=t.erasingIds,delete t.erasingIds,t.hoveredShapeId=t.hoveredId,delete t.hoveredId,t.editingShapeId=t.editingId,delete t.editingId,t.croppingShapeId=t.croppingShapeId??t.croppingId??null,delete t.croppingId,t.focusedGroupId=t.focusLayerId,delete t.focusLayerId},down:t=>{t.selectedIds=t.selectedShapeIds,delete t.selectedShapeIds,t.hintingIds=t.hintingShapeIds,delete t.hintingShapeIds,t.erasingIds=t.erasingShapeIds,delete t.erasingShapeIds,t.hoveredId=t.hoveredShapeId,delete t.hoveredShapeId,t.editingId=t.editingShapeId,delete t.editingShapeId,t.croppingId=t.croppingShapeId,delete t.croppingShapeId,t.focusLayerId=t.focusedGroupId,delete t.focusedGroupId}}]}),$a=Dl("instance_page_state",{validator:Jle,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),ece=jl("pointer",Lt({typeName:Ki("pointer"),id:ks("pointer"),x:ct,y:ct,lastActivityTimestamp:ct,meta:xi})),tce=Jo("com.tldraw.pointer",{AddMeta:1}),nce=Es({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:tce.AddMeta,up:t=>{t.meta={}}}]}),q2=Dl("pointer",{validator:ece,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),cb=q2.createId("pointer"),rce=jl("instance_presence",Lt({typeName:Ki("instance_presence"),id:ks("instance_presence"),userId:_t,userName:_t,lastActivityTimestamp:ct.nullable(),followingUserId:_t.nullable(),cursor:Lt({x:ct,y:ct,type:wU,rotation:ct}).nullable(),color:_t,camera:Lt({x:ct,y:ct,z:ct}).nullable(),screenBounds:Mm.nullable(),selectedShapeIds:Jr(ks("shape")),currentPageId:ks("page"),brush:Mm.nullable(),scribbles:Jr(kU),chatMessage:_t,meta:xi})),up=Jo("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5,NullableCameraCursor:6}),ice=Es({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:up.AddScribbleDelay,up:t=>{t.scribble!==null&&(t.scribble.delay=0)}},{id:up.RemoveInstanceId,up:t=>{delete t.instanceId}},{id:up.AddChatMessage,up:t=>{t.chatMessage=""}},{id:up.AddMeta,up:t=>{t.meta={}}},{id:up.RenameSelectedShapeIds,up:t=>{}},{id:up.NullableCameraCursor,up:t=>{},down:t=>{t.camera===null&&(t.camera={x:0,y:0,z:1}),t.lastActivityTimestamp===null&&(t.lastActivityTimestamp=0),t.cursor===null&&(t.cursor={type:"default",x:0,y:0,rotation:0}),t.screenBounds===null&&(t.screenBounds={x:0,y:0,w:1,h:1})}}]}),oce=Dl("instance_presence",{validator:rce,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:null,followingUserId:null,color:"#FF0000",camera:null,cursor:null,screenBounds:null,selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),sce=jl("document",Lt({typeName:Ki("document"),id:Ki("document:document"),gridSize:ct,name:_t,meta:xi})),jz=Jo("com.tldraw.document",{AddName:1,AddMeta:2}),ace=Es({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:jz.AddName,up:t=>{t.name=""},down:t=>{delete t.name}},{id:jz.AddMeta,up:t=>{t.meta={}}}]}),G2=Dl("document",{validator:sce,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),xT=G2.createId("document");function Rz(t){t.typeName==="asset"&&("src"in t&&(t.src="<redacted>"),"src"in t.props&&(t.props.src="<redacted>"))}function lce({error:t,phase:e,record:n,recordBefore:r}){throw c2(t,{tags:{origin:"store.validateRecord",storePhase:e,isExistingValidationIssue:e==="initialize"},extras:{recordBefore:r?Rz(fn(r)):void 0,recordAfter:Rz(fn(n))}}),t}function cce(){return[yo.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function uce(t){const e=t.query.ids("page"),n=t.query.records("instance_page_state"),r=()=>{if(!t.has(xT))return t.put([G2.create({id:xT,name:t.props.defaultName})]),r();if(!t.has(cb))return t.put([q2.create({id:cb})]),r();const i=e.get();if(i.size===0)return t.put(cce()),r();const o=()=>[...i].map(d=>t.get(d)).sort(Yr)[0].id,s=t.get(uo);if(s){if(!i.has(s.currentPageId))return t.put([{...s,currentPageId:o()}]),r()}else return t.put([t.schema.types.instance.create({id:uo,currentPageId:o(),exportBackground:!0})]),r();const a=new Set,l=new Set;for(const d of i){const u=$a.createId(d);t.get(u)||a.add(u);const f=yl.createId(d);t.has(f)||l.add(f)}a.size>0&&t.put([...a].map(d=>$a.create({id:d,pageId:$a.parseId(d)}))),l.size>0&&t.put([...l].map(d=>yl.create({id:d})));const c=n.get();for(const d of c){if(!i.has(d.pageId)){t.remove([d.id]);continue}if(d.croppingShapeId&&!t.has(d.croppingShapeId))return t.put([{...d,croppingShapeId:null}]),r();if(d.focusedGroupId&&!t.has(d.focusedGroupId))return t.put([{...d,focusedGroupId:null}]),r();if(d.hoveredShapeId&&!t.has(d.hoveredShapeId))return t.put([{...d,hoveredShapeId:null}]),r();const u=d.selectedShapeIds.filter(y=>t.has(y));if(u.length!==d.selectedShapeIds.length)return t.put([{...d,selectedShapeIds:u}]),r();const p=d.hintingShapeIds.filter(y=>t.has(y));if(p.length!==d.hintingShapeIds.length)return t.put([{...d,hintingShapeIds:p}]),r();const f=d.erasingShapeIds.filter(y=>t.has(y));if(f.length!==d.erasingShapeIds.length)return t.put([{...d,erasingShapeIds:f}]),r()}};return r}const dce=W2("bookmark",Lt({title:_t,description:_t,image:_t,favicon:_t,src:Jd.nullable()})),$z=Jo("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),hce=Es({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:t=>t.type==="bookmark",sequence:[{id:$z.MakeUrlsValid,up:t=>{Jd.isValid(t.props.src)||(t.props.src="")},down:t=>{}},{id:$z.AddFavicon,up:t=>{Jd.isValid(t.props.favicon)||(t.props.favicon="")},down:t=>{delete t.props.favicon}}]}),pce=W2("image",Lt({w:ct,h:ct,name:_t,isAnimated:Tt,mimeType:_t.nullable(),src:Jd.nullable(),fileSize:kr.optional()})),Rg=Jo("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),fce=Es({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:t=>t.type==="image",sequence:[{id:Rg.AddIsAnimated,up:t=>{t.props.isAnimated=!1},down:t=>{delete t.props.isAnimated}},{id:Rg.RenameWidthHeight,up:t=>{t.props.w=t.props.width,t.props.h=t.props.height,delete t.props.width,delete t.props.height},down:t=>{t.props.width=t.props.w,t.props.height=t.props.h,delete t.props.w,delete t.props.h}},{id:Rg.MakeUrlsValid,up:t=>{Jd.isValid(t.props.src)||(t.props.src="")},down:t=>{}},{id:Rg.AddFileSize,up:t=>{t.props.fileSize=-1},down:t=>{delete t.props.fileSize}},{id:Rg.MakeFileSizeOptional,up:t=>{t.props.fileSize===-1&&(t.props.fileSize=void 0)},down:t=>{t.props.fileSize===void 0&&(t.props.fileSize=-1)}}]}),gce=W2("video",Lt({w:ct,h:ct,name:_t,isAnimated:Tt,mimeType:_t.nullable(),src:Jd.nullable(),fileSize:ct.optional()})),$g=Jo("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),mce=Es({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:t=>t.type==="video",sequence:[{id:$g.AddIsAnimated,up:t=>{t.props.isAnimated=!1},down:t=>{delete t.props.isAnimated}},{id:$g.RenameWidthHeight,up:t=>{t.props.w=t.props.width,t.props.h=t.props.height,delete t.props.width,delete t.props.height},down:t=>{t.props.width=t.props.w,t.props.height=t.props.h,delete t.props.w,delete t.props.h}},{id:$g.MakeUrlsValid,up:t=>{Jd.isValid(t.props.src)||(t.props.src="")},down:t=>{}},{id:$g.AddFileSize,up:t=>{t.props.fileSize=-1},down:t=>{delete t.props.fileSize}},{id:$g.MakeFileSizeOptional,up:t=>{t.props.fileSize===-1&&(t.props.fileSize=void 0)},down:t=>{t.props.fileSize===void 0&&(t.props.fileSize=-1)}}]}),yce=jl("asset",B2("type",{image:pce,video:gce,bookmark:dce})),vce=Jo("com.tldraw.asset",{AddMeta:1}),xce=Es({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:vce.AddMeta,up:t=>{t.meta={}}}]}),qu=Dl("asset",{validator:yce,scope:"document"}).withDefaultProperties(()=>({meta:{}})),_U={w:kr,h:kr,assetId:Zw.nullable(),url:Cs},Nz=da("bookmark",{NullAssetId:1,MakeUrlsValid:2}),CU={sequence:[{id:Nz.NullAssetId,up:t=>{t.assetId===void 0&&(t.assetId=null)},down:"retired"},{id:Nz.MakeUrlsValid,up:t=>{Cs.isValid(t.url)||(t.url="")},down:t=>{}}]},PU=Lt({type:Zd("free","straight"),points:Jr(Qd)}),TU={color:vo,fill:th,dash:eh,size:Wa,segments:Jr(PU),isComplete:Tt,isClosed:Tt,isPen:Tt,scale:kr},Lz=da("draw",{AddInPen:1,AddScale:2}),EU={sequence:[{id:Lz.AddInPen,up:t=>{const{points:e}=t.segments[0];if(e.length===0){t.isPen=!1;return}let n=!(e[0].z===0||e[0].z===.5);e[1]&&(n=n&&!(e[1].z===0||e[1].z===.5)),t.isPen=n},down:"retired"},{id:Lz.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]},Sce=/(^\/r\/[^/]+\/?$)/,bce=[{hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],fromEmbedUrl:t=>{const e=ht(t);if(e&&e.pathname.match(Sce))return t}},{hostnames:["figma.com"],fromEmbedUrl:t=>{const e=ht(t);if(e&&e.pathname.match(/^\/embed\/?$/)){const n=e.searchParams.get("url");if(n)return n}}},{hostnames:["google.*"],fromEmbedUrl:t=>{const e=ht(t);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const r=e.searchParams.get("zoom"),[i,o]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${i},${o},${r}z`}}},{hostnames:["val.town"],fromEmbedUrl:t=>{const e=ht(t),n=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(n)return`https://www.val.town/v/${n[1]}`}},{hostnames:["codesandbox.io"],fromEmbedUrl:t=>{const e=ht(t),n=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://codesandbox.io/s/${n[1]}`}},{hostnames:["codepen.io"],fromEmbedUrl:t=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,n=t.match(e);if(n){const[r,i,o]=n;return`https://codepen.io/${i}/pen/${o}`}}},{hostnames:["scratch.mit.edu"],fromEmbedUrl:t=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,n=t.match(e);if(n){const[r,i]=n;return`https://scratch.mit.edu/projects/${i}`}}},{hostnames:["*.youtube.com","youtube.com","youtu.be"],fromEmbedUrl:t=>{const e=ht(t);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const r=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(r)return`https://www.youtube.com/watch?v=${r[1]}`}}},{hostnames:["calendar.google.*"],fromEmbedUrl:t=>{const e=ht(t),n=e?.searchParams.get("src");if(e?.pathname.match(/\/calendar\/embed/)&&n){e.pathname="/calendar/u/0";const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.searchParams.set("cid",n),e.href}}},{hostnames:["docs.google.*"],fromEmbedUrl:t=>{const e=ht(t);if(e?.pathname.match(/^\/presentation/)&&e?.pathname.match(/\/embed\/?$/)){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const n=Array.from(e.searchParams.keys());for(const r of n)e.searchParams.delete(r);return e.href}}},{hostnames:["gist.github.com"],fromEmbedUrl:t=>{const e=ht(t);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return t.split("/").pop()?t:void 0}},{hostnames:["replit.com"],fromEmbedUrl:t=>{const e=ht(t);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{hostnames:["felt.com"],fromEmbedUrl:t=>{const e=ht(t);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{hostnames:["open.spotify.com"],fromEmbedUrl:t=>{const e=ht(t);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{hostnames:["vimeo.com","player.vimeo.com"],fromEmbedUrl:t=>{const e=ht(t);if(e&&e.hostname==="player.vimeo.com"){const n=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(n)return"https://vimeo.com/"+n[1]}}},{hostnames:["excalidraw.com"],fromEmbedUrl:t=>{const e=ht(t);if(e&&e.hash.match(/#room=/))return t}},{hostnames:["observablehq.com"],fromEmbedUrl:t=>{const e=ht(t);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{hostnames:["desmos.com"],fromEmbedUrl:t=>{const e=ht(t);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return t.replace("?embed","")}}],AU={w:kr,h:kr,url:_t},Mx=da("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),MU={sequence:[{id:Mx.GenOriginalUrlInEmbed,up:t=>{try{const e=t.url,n=new URL(e).host.replace("www.","");let r;for(const i of bce)if(i.hostnames.includes(n))try{r=i.fromEmbedUrl(e)}catch(o){console.warn(o)}t.tmpOldUrl=t.url,t.url=r??""}catch{t.url="",t.tmpOldUrl=t.url}},down:"retired"},{id:Mx.RemoveDoesResize,up:t=>{delete t.doesResize},down:"retired"},{id:Mx.RemoveTmpOldUrl,up:t=>{delete t.tmpOldUrl},down:"retired"},{id:Mx.RemovePermissionOverrides,up:t=>{delete t.overridePermissions},down:"retired"}]},OU={w:kr,h:kr,name:_t,color:Zd(...vo.values)},wce=da("frame",{AddColorProp:1}),DU={sequence:[{id:wce.AddColorProp,up:t=>{t.color="black"},down:t=>{delete t.color}}]},ub=oi.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),db=oi.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),vl=oi.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),jU={geo:vl,dash:eh,url:Cs,w:kr,h:kr,growY:sb,scale:kr,labelColor:K2,color:vo,fill:th,size:Wa,font:Ou,align:ub,verticalAlign:db,richText:Jw},ol=da("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9,AddRichText:10}),RU={sequence:[{id:ol.AddUrlProp,up:t=>{t.url=""},down:"retired"},{id:ol.AddLabelColor,up:t=>{t.labelColor="black"},down:"retired"},{id:ol.RemoveJustify,up:t=>{t.align==="justify"&&(t.align="start")},down:"retired"},{id:ol.AddCheckBox,up:t=>{},down:"retired"},{id:ol.AddVerticalAlign,up:t=>{t.verticalAlign="middle"},down:"retired"},{id:ol.MigrateLegacyAlign,up:t=>{let e;switch(t.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}t.align=e},down:"retired"},{id:ol.AddCloud,up:t=>{},down:"retired"},{id:ol.MakeUrlsValid,up:t=>{Cs.isValid(t.url)||(t.url="")},down:t=>{}},{id:ol.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}},{id:ol.AddRichText,up:t=>{t.richText=dn(t.text),delete t.text}}]},$U={},NU={sequence:[]},LU={color:vo,size:Wa,segments:Jr(PU),isComplete:Tt,isPen:Tt,scale:kr},kce=da("highlight",{AddScale:1}),zU={sequence:[{id:kce.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]},Ice=Lt({topLeft:Qd,bottomRight:Qd,isCircle:Tt.optional()}),FU={w:kr,h:kr,playing:Tt,url:Cs,assetId:Zw.nullable(),crop:Ice.nullable(),flipX:Tt,flipY:Tt,altText:_t},Ng=da("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4,AddAltText:5}),BU={sequence:[{id:Ng.AddUrlProp,up:t=>{t.url=""},down:"retired"},{id:Ng.AddCropProp,up:t=>{t.crop=null},down:t=>{delete t.crop}},{id:Ng.MakeUrlsValid,up:t=>{Cs.isValid(t.url)||(t.url="")},down:t=>{}},{id:Ng.AddFlipProps,up:t=>{t.flipX=!1,t.flipY=!1},down:t=>{delete t.flipX,delete t.flipY}},{id:Ng.AddAltText,up:t=>{t.altText=""},down:t=>{delete t.altText}}]},ST=oi.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),_ce=Lt({id:_t,index:H2,x:ct,y:ct}),UU={color:vo,dash:eh,size:Wa,spline:ST,points:ab(_t,_ce),scale:kr},Lg=da("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),HU={sequence:[{id:Lg.AddSnapHandles,up:t=>{for(const e of Object.values(t.handles))e.canSnap=!0},down:"retired"},{id:Lg.RemoveExtraHandleProps,up:t=>{t.handles=a5(Object.values(t.handles).map(e=>[e.index,{x:e.x,y:e.y}]))},down:t=>{const e=Object.entries(t.handles).map(([n,r])=>({index:n,...r})).sort(Yr);t.handles=Object.fromEntries(e.map((n,r)=>{const i=r===0?"start":r===e.length-1?"end":`handle:${n.index}`;return[i,{id:i,type:"vertex",canBind:!1,canSnap:!0,index:n.index,x:n.x,y:n.y}]}))}},{id:Lg.HandlesToPoints,up:t=>{const e=Object.entries(t.handles).map(([n,{x:r,y:i}])=>({x:r,y:i,index:n})).sort(Yr);t.points=e.map(({x:n,y:r})=>({x:n,y:r})),delete t.handles},down:t=>{const e=Qm(t.points.length);t.handles=Object.fromEntries(t.points.map((n,r)=>[e[r],{x:n.x,y:n.y}])),delete t.points}},{id:Lg.PointIndexIds,up:t=>{const e=Qm(t.points.length);t.points=Object.fromEntries(t.points.map((n,r)=>{const i=e[r];return[i,{id:i,index:i,x:n.x,y:n.y}]}))},down:t=>{const e=Object.values(t.points).sort(Yr);t.points=e.map(({x:n,y:r})=>({x:n,y:r}))}},{id:Lg.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]},WU={color:vo,labelColor:K2,size:Wa,font:Ou,fontSizeAdjustment:sb,align:ub,verticalAlign:db,growY:sb,url:Cs,richText:Jw,scale:kr},Ql=da("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7,AddLabelColor:8,AddRichText:9}),VU={sequence:[{id:Ql.AddUrlProp,up:t=>{t.url=""},down:"retired"},{id:Ql.RemoveJustify,up:t=>{t.align==="justify"&&(t.align="start")},down:"retired"},{id:Ql.MigrateLegacyAlign,up:t=>{switch(t.align){case"start":t.align="start-legacy";return;case"end":t.align="end-legacy";return;default:t.align="middle-legacy";return}},down:"retired"},{id:Ql.AddVerticalAlign,up:t=>{t.verticalAlign="middle"},down:"retired"},{id:Ql.MakeUrlsValid,up:t=>{Cs.isValid(t.url)||(t.url="")},down:t=>{}},{id:Ql.AddFontSizeAdjustment,up:t=>{t.fontSizeAdjustment=0},down:t=>{delete t.fontSizeAdjustment}},{id:Ql.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}},{id:Ql.AddLabelColor,up:t=>{t.labelColor="black"},down:t=>{delete t.labelColor}},{id:Ql.AddRichText,up:t=>{t.richText=dn(t.text),delete t.text}}]},bT=oi.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),KU={color:vo,size:Wa,font:Ou,textAlign:bT,w:kr,richText:Jw,scale:kr,autoSize:Tt},OC=da("text",{RemoveJustify:1,AddTextAlign:2,AddRichText:3}),qU={sequence:[{id:OC.RemoveJustify,up:t=>{t.align==="justify"&&(t.align="start")},down:"retired"},{id:OC.AddTextAlign,up:t=>{t.textAlign=t.align,delete t.align},down:t=>{t.align=t.textAlign,delete t.textAlign}},{id:OC.AddRichText,up:t=>{t.richText=dn(t.text),delete t.text}}]},GU={w:kr,h:kr,time:ct,playing:Tt,autoplay:Tt,url:Cs,assetId:Zw.nullable(),altText:_t},Ox=da("video",{AddUrlProp:1,MakeUrlsValid:2,AddAltText:3,AddAutoplay:4}),YU={sequence:[{id:Ox.AddUrlProp,up:t=>{t.url=""},down:"retired"},{id:Ox.MakeUrlsValid,up:t=>{Cs.isValid(t.url)||(t.url="")},down:t=>{}},{id:Ox.AddAltText,up:t=>{t.altText=""},down:t=>{delete t.altText}},{id:Ox.AddAutoplay,up:t=>{t.autoplay=!0},down:t=>{delete t.autoplay}}]},zg=Jo("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4,FixIndexKeys:5}),Cce=Vp({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:zg.RemoveCodeAndIconShapeTypes,scope:"store",up:t=>{for(const[e,n]of go(t))n.typeName==="shape"&&(n.type==="icon"||n.type==="code")&&delete t[e]}},{id:zg.AddInstancePresenceType,scope:"store",up(t){}},{id:zg.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:t=>{for(const[e,n]of go(t))n.typeName.match(/^(user|user_presence)$/)&&delete t[e]}},{id:zg.RemoveUserDocument,scope:"store",up:t=>{for(const[e,n]of go(t))n.typeName.match("user_document")&&delete t[e]}},{id:zg.FixIndexKeys,scope:"record",up:t=>{if(["shape","page"].includes(t.typeName)&&"index"in t){const e=t;if(e.index.endsWith("0")&&e.index!=="a0"&&(e.index=e.index.slice(0,-1)+Fz(3)),t.typeName==="shape"&&e.type==="line"){const n=e;for(const[r,i]of go(n.props.points))i.index.endsWith("0")&&i.index!=="a0"&&(i.index=i.index.slice(0,-1)+Fz(3))}}},down:()=>{}}]}),zz="123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",Pce=()=>zz.charAt(Math.floor(Math.random()*zz.length)),Fz=t=>Array.from({length:t},Pce).join(""),Tce={arrow:{migrations:xU,props:vU},bookmark:{migrations:CU,props:_U},draw:{migrations:EU,props:TU},embed:{migrations:MU,props:AU},frame:{migrations:DU,props:OU},geo:{migrations:RU,props:jU},group:{migrations:NU,props:$U},highlight:{migrations:zU,props:LU},image:{migrations:BU,props:FU},line:{migrations:HU,props:UU},note:{migrations:VU,props:WU},text:{migrations:qU,props:KU},video:{migrations:YU,props:GU}},Ece={arrow:{migrations:bU,props:SU}};function Ace({shapes:t=Tce,bindings:e=Ece,migrations:n}={}){const r=new Map;for(const a of ar(t))for(const l of gU(a.props??{}).keys()){if(r.has(l.id)&&r.get(l.id)!==l)throw new Error(`Multiple StyleProp instances with the same id: ${l.id}`);r.set(l.id,l)}const i=Mle(t),o=Tle(e),s=Xle(r);return z2.create({asset:qu,binding:o,camera:yl,document:G2,instance:s,instance_page_state:$a,page:yo,instance_presence:oce,pointer:q2,shape:i},{migrations:[Cce,xce,Fle,ace,Zle,Qle,Gle,ice,nce,Ale,hce,fce,mce,...Dz("shape",t),...Dz("binding",e),...n??[]],onValidationFailure:lce,createIntegrityChecker:uce})}const ty=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ms",label:"Bahasa Melayu"},{locale:"ca",label:"Català"},{locale:"cs",label:"Čeština"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Español"},{locale:"tl",label:"Filipino"},{locale:"fr",label:"Français"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"nl",label:"Nederlands"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Português - Brasil"},{locale:"pt-pt",label:"Português - Europeu"},{locale:"ro",label:"Română"},{locale:"sl",label:"Slovenščina"},{locale:"so",label:"Somali"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Tiếng Việt"},{locale:"tr",label:"Türkçe"},{locale:"el",label:"Ελληνικά"},{locale:"ru",label:"Русский"},{locale:"uk",label:"Українська"},{locale:"he",label:"עברית"},{locale:"ur",label:"اردو"},{locale:"ar",label:"عربي"},{locale:"fa",label:"فارسی"},{locale:"ne",label:"नेपाली"},{locale:"mr",label:"मराठी"},{locale:"hi-in",label:"हिन्दी"},{locale:"bn",label:"বাংলা"},{locale:"pa",label:"ਪੰਜਾਬੀ"},{locale:"gu-in",label:"ગુજરાતી"},{locale:"ta",label:"தமிழ்"},{locale:"te",label:"తెలుగు"},{locale:"kn",label:"ಕನ್ನಡ"},{locale:"ml",label:"മലയാളം"},{locale:"th",label:"ภาษาไทย"},{locale:"km-kh",label:"ភាសាខ្មែរ"},{locale:"ko-kr",label:"한국어"},{locale:"ja",label:"日本語"},{locale:"zh-cn",label:"简体中文"},{locale:"zh-tw",label:"繁體中文 (台灣)"}];function Mce(){const t=typeof window<"u"&&window.navigator?window.navigator.languages??["en"]:["en"];return Oce(t)}function Oce(t){for(const e of t){const n=Dce(e);if(n)return n}return"en"}const Bz={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function Dce(t){const e=ty.find(i=>i.locale===t.toLowerCase());if(e)return e.locale;const[n,r]=t.split(/[-_]/).map(i=>i.toLowerCase());if(r){const i=ty.find(o=>o.locale===n);if(i)return i.locale}return n in Bz?Bz[n]:null}Fu("@tldraw/tlschema","4.1.1","esm");function jce(){return g.jsx("div",{className:"tl-background"})}function Ky(t,e,n,r,i,o){I.useLayoutEffect(()=>{const s=t.current;if(!s||e===void 0)return;let a=`translate(${e}px, ${n}px)`;r!==void 0&&(a+=` scale(${r})`),i!==void 0&&(a+=` rotate(${i}rad)`),o&&(a+=` translate(${o.x}px, ${o.y}px)`),s.style.transform=a})}const Ui={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>t*(2-t),easeInOutQuad:t=>t<.5?2*t*t:-1+(4-2*t)*t,easeInCubic:t=>t*t*t,easeOutCubic:t=>--t*t*t+1,easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1- --t*t*t*t,easeInOutQuart:t=>t<.5?8*t*t*t*t:1-8*--t*t*t*t,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1+--t*t*t*t*t,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t,easeInSine:t=>1-Math.cos(t*Math.PI/2),easeOutSine:t=>Math.sin(t*Math.PI/2),easeInOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeInExpo:t=>t<=0?0:Math.pow(2,10*t-10),easeOutExpo:t=>t>=1?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>t<=0?0:t>=1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2};class T{constructor(e=0,n=0,r=1){this.x=e,this.y=n,this.z=r}get pressure(){return this.z}set(e=this.x,n=this.y,r=this.z){return this.x=e,this.y=n,this.z=r,this}setTo({x:e=0,y:n=0,z:r=1}){return this.x=e,this.y=n,this.z=r,this}rot(e){if(e===0)return this;const{x:n,y:r}=this,i=Math.sin(e),o=Math.cos(e);return this.x=n*o-r*i,this.y=n*i+r*o,this}rotWith(e,n){if(n===0)return this;const r=this.x-e.x,i=this.y-e.y,o=Math.sin(n),s=Math.cos(n);return this.x=e.x+(r*s-i*o),this.y=e.y+(r*o+i*s),this}clone(){const{x:e,y:n,z:r}=this;return new T(e,n,r)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,n){return this.x-=e,this.y-=n,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,n){return this.x+=e,this.y+=n,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,n){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),n!==void 0&&(this.x=Math.min(this.x,n),this.y=Math.min(this.y,n)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,n){const r=T.Tan(e,this);return this.add(r.mul(n))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return T.Dpr(this,e)}cpr(e){return T.Cpr(this,e)}len2(){return T.Len2(this)}len(){return T.Len(this)}pry(e){return T.Pry(this,e)}per(){const{x:e,y:n}=this;return this.x=n,this.y=-e,this}uni(){const e=this.len();return e===0?this:(this.x/=e,this.y/=e,this)}tan(e){return this.sub(e).uni()}dist(e){return T.Dist(this,e)}distanceToLineSegment(e,n){return T.DistanceToLineSegment(e,n,this)}slope(e){return T.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return T.Angle(this,e)}toAngle(){return T.ToAngle(this)}lrp(e,n){return this.x=this.x+(e.x-this.x)*n,this.y=this.y+(e.y-this.y)*n,this}equals(e){return T.Equals(this,e)}equalsXY(e,n){return T.EqualsXY(this,e,n)}toFixed(){return this.x=Da(this.x),this.y=Da(this.y),this}toString(){return T.ToString(T.ToFixed(this))}toJson(){return T.ToJson(this)}toArray(){return T.ToArray(this)}static Add(e,n){return new T(e.x+n.x,e.y+n.y)}static AddXY(e,n,r){return new T(e.x+n,e.y+r)}static Sub(e,n){return new T(e.x-n.x,e.y-n.y)}static SubXY(e,n,r){return new T(e.x-n,e.y-r)}static AddScalar(e,n){return new T(e.x+n,e.y+n)}static SubScalar(e,n){return new T(e.x-n,e.y-n)}static Div(e,n){return new T(e.x/n,e.y/n)}static Mul(e,n){return new T(e.x*n,e.y*n)}static DivV(e,n){return new T(e.x/n.x,e.y/n.y)}static MulV(e,n){return new T(e.x*n.x,e.y*n.y)}static Neg(e){return new T(-e.x,-e.y)}static Per(e){return new T(e.y,-e.x)}static Abs(e){return new T(Math.abs(e.x),Math.abs(e.y))}static Dist(e,n){return((e.y-n.y)**2+(e.x-n.x)**2)**.5}static ManhattanDist(e,n){return Math.abs(e.x-n.x)+Math.abs(e.y-n.y)}static DistMin(e,n,r){return(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y)<r**2}static Dist2(e,n){return(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y)}static Dpr(e,n){return e.x*n.x+e.y*n.y}static Cross(e,n){return new T(e.y*n.z-e.z*n.y,e.z*n.x-e.x*n.z)}static Cpr(e,n){return e.x*n.y-n.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return(e.x*e.x+e.y*e.y)**.5}static Pry(e,n){return T.Dpr(e,n)/T.Len(n)}static Uni(e){const n=T.Len(e);return new T(n===0?0:e.x/n,n===0?0:e.y/n)}static Tan(e,n){return T.Uni(T.Sub(e,n))}static Min(e,n){return new T(Math.min(e.x,n.x),Math.min(e.y,n.y))}static Max(e,n){return new T(Math.max(e.x,n.x),Math.max(e.y,n.y))}static From({x:e,y:n,z:r=1}){return new T(e,n,r)}static FromArray(e){return new T(e[0],e[1])}static Rot(e,n=0){const r=Math.sin(n),i=Math.cos(n);return new T(e.x*i-e.y*r,e.x*r+e.y*i)}static RotWith(e,n,r){const i=e.x-n.x,o=e.y-n.y,s=Math.sin(r),a=Math.cos(r);return new T(n.x+(i*a-o*s),n.y+(i*s+o*a))}static NearestPointOnLineThroughPoint(e,n,r){return T.Mul(n,T.Sub(r,e).pry(n)).add(e)}static NearestPointOnLineSegment(e,n,r,i=!0){if(T.Equals(e,r)||T.Equals(n,r))return T.From(r);const o=T.Tan(n,e),s=T.Add(e,T.Mul(o,T.Sub(r,e).pry(o)));if(i){if(s.x<Math.min(e.x,n.x))return T.Cast(e.x<n.x?e:n);if(s.x>Math.max(e.x,n.x))return T.Cast(e.x>n.x?e:n);if(s.y<Math.min(e.y,n.y))return T.Cast(e.y<n.y?e:n);if(s.y>Math.max(e.y,n.y))return T.Cast(e.y>n.y?e:n)}return s}static DistanceToLineThroughPoint(e,n,r){return T.Dist(r,T.NearestPointOnLineThroughPoint(e,n,r))}static DistanceToLineSegment(e,n,r,i=!0){return T.Dist(r,T.NearestPointOnLineSegment(e,n,r,i))}static Snap(e,n=1){return new T(Math.round(e.x/n)*n,Math.round(e.y/n)*n)}static Cast(e){return e instanceof T?e:T.From(e)}static Slope(e,n){return e.x===n.y?NaN:(e.y-n.y)/(e.x-n.x)}static IsNaN(e){return isNaN(e.x)||isNaN(e.y)}static Angle(e,n){return Math.atan2(n.y-e.y,n.x-e.x)}static AngleBetween(e,n){const r=e.x*n.x+e.y*n.y,i=Math.sqrt((Math.pow(e.x,2)+Math.pow(e.y,2))*(Math.pow(n.x,2)+Math.pow(n.y,2)));return(e.x*n.y-e.y*n.x<0?-1:1)*Math.acos(pt(r/i,-1,1))}static Lrp(e,n,r){return T.Sub(n,e).mul(r).add(e)}static Med(e,n){return new T((e.x+n.x)/2,(e.y+n.y)/2)}static Equals(e,n){return Math.abs(e.x-n.x)<1e-4&&Math.abs(e.y-n.y)<1e-4}static EqualsXY(e,n,r){return e.x===n&&e.y===r}static Clockwise(e,n,r){return(r.x-e.x)*(n.y-e.y)-(n.x-e.x)*(r.y-e.y)<0}static Rescale(e,n){const r=T.Len(e);return new T(n*e.x/r,n*e.y/r)}static ScaleWithOrigin(e,n,r){return T.Sub(e,r).mul(n).add(r)}static ToFixed(e){return new T(Da(e.x),Da(e.y))}static ToInt(e){return new T(parseInt(e.x.toFixed(0)),parseInt(e.y.toFixed(0)),parseInt((e.z??0).toFixed(0)))}static ToCss(e){return`${e.x},${e.y}`}static Nudge(e,n,r){return T.Add(e,T.Tan(n,e).mul(r))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let n=Math.atan2(e.y,e.x);return n<0&&(n+=Math.PI*2),n}static FromAngle(e,n=1){return new T(Math.cos(e)*n,Math.sin(e)*n)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:n,y:r,z:i}=e;return{x:n,y:r,z:i}}static Average(e){const n=e.length,r=new T(0,0);if(n===0)return r;for(let i=0;i<n;i++)r.add(e[i]);return r.div(n)}static Clamp(e,n,r){return r===void 0?new T(Math.min(Math.max(e.x,n)),Math.min(Math.max(e.y,n))):new T(Math.min(Math.max(e.x,n),r),Math.min(Math.max(e.y,n),r))}static PointsBetween(e,n,r=6){const i=[];for(let o=0;o<r;o++){const s=Ui.easeInQuad(o/(r-1)),a=T.Lrp(e,n,s);a.z=Math.min(1,.5+Math.abs(.5-Rce(s))*.65),i.push(a)}return i}static SnapToGrid(e,n=8){return new T(Math.round(e.x/n)*n,Math.round(e.y/n)*n)}}const Rce=t=>t<.5?2*t*t:-1+(4-2*t)*t;function mi(t){return`${ee(t.x)},${ee(t.y)} `}function Wo(t,e){return`${ee((t.x+e.x)/2)},${ee((t.y+e.y)/2)} `}const nn=Math.PI,br=nn/2,Sn=nn*2,$ce=Math.sin;function pt(t,e,n){return Math.max(e,typeof n<"u"?Math.min(t,n):t)}function Dx(t,e=1e10){return t?Math.round(t*e)/e:0}function Ir(t,e,n=1e-6){return Math.abs(t-e)<=n}function xu(t,e,n=1e-6){return t<e||Ir(t,e,n)}function Nce(t,e){const n=Math.pow(t-e,2)/Math.pow(t+e,2);return nn*(t+e)*(1+3*n/(10+Math.sqrt(4-3*n)))}function hb(t){return t=t%Sn,t<0?t=t+Sn:t===0&&(t=0),t}function Y2(t,e){return t=hb(t),e=hb(e),t>e&&(e+=Sn),e-t}function Lce(t,e){return Sn-Y2(t,e)}function $S(t,e){const n=(e-t)%Sn;return 2*n%Sn-n}function wT(t){return(Sn+t)%Sn}function pb(t,e){const n=Sn/e;let r=Math.floor((wT(t)+n/2)/n)*n%Sn;return r<nn&&(r+=Sn),r>nn&&(r-=Sn),r}function XU(t,e){return t===e||Ir(t%(Math.PI/2)-e%(Math.PI/2),0)}function zce(t){return t*nn/180}function Fce(t){return t*180/nn}function X2(t,e,n){return new T(t.x,t.y).add(T.FromAngle(n,e))}function DC(t,e,n){const r=t/2,i=e/2,o=[];let s=1/0,a=-1/0,l=1/0,c=-1/0;for(let y=0;y<n;y++){const v=Sn/n,x=-br+y*v,b=r+r*Math.cos(x),w=i+i*Math.sin(x);b<s&&(s=b),w<l&&(l=w),b>a&&(a=b),w>c&&(c=w),o.push(new T(b,w))}const d=a-s,u=c-l,p=t-d,f=e-u;if(p!==0||f!==0)for(let y=0;y<o.length;y++){const v=o[y];v.x=(v.x-s)/d*t,v.y=(v.y-l)/u*e}return o}function Fg(t,e,n,r){return t<r&&n<e}function Oa(t,e,n,r){const i=Math.max(t,n),o=Math.min(e,r);return i<=o?[i,o]:null}function Uz(t,e,n){return(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)}function fo(t,e){let n=0,r,i;for(let o=0;o<e.length;o++){if(r=e[o],r.x===t.x&&r.y===t.y||(i=e[(o+1)%e.length],T.Dist(t,r)+T.Dist(t,i)===T.Dist(r,i)))return!0;r.y<=t.y?i.y>t.y&&Uz(r,i,t)>0&&(n+=1):i.y<=t.y&&Uz(r,i,t)<0&&(n-=1)}return n!==0}function ee(t){return Math.round(t*1e4)/1e4}function Da(t){return Math.round(t*100)/100}const Hz=t=>Math.abs(t)<Number.MAX_SAFE_INTEGER;function Wz(t,e,n,r){let i;if(Math.abs(t)>nn){i=$S(e,r);const o=$S(r,n);return Math.abs(i)<Math.abs(o)?i/t:(t-o)/t}else{i=$S(e,r);const o=i/t;return Math.sign(i)!==Math.sign(t)?Math.abs(o)>.5?1:0:o}}function Bce(t,e,n,r){const i=2*((e-t)%Sn)%Sn-(e-t)%Sn;return r?(Sn-Math.abs(i))*(n?1:-1):i}function ZU(t,e,n){const r=-2*(t.x*(e.y-n.y)-t.y*(e.x-n.x)+e.x*n.y-n.x*e.y),i=((t.x*t.x+t.y*t.y)*(n.y-e.y)+(e.x*e.x+e.y*e.y)*(t.y-n.y)+(n.x*n.x+n.y*n.y)*(e.y-t.y))/r,o=((t.x*t.x+t.y*t.y)*(e.x-n.x)+(e.x*e.x+e.y*e.y)*(n.x-t.x)+(n.x*n.x+n.y*n.y)*(t.x-e.x))/r;return!Number.isFinite(i)||!Number.isFinite(o)?null:new T(i,o)}const jC=({brush:t,color:e,opacity:n,className:r})=>{const i=I.useRef(null);Ky(i,t.x,t.y);const o=ee(Math.max(1,t.w)),s=ee(Math.max(1,t.h));return g.jsx("svg",{className:"tl-overlays__item",ref:i,"aria-hidden":"true",children:e?g.jsxs("g",{className:"tl-brush",opacity:n,children:[g.jsx("rect",{width:o,height:s,fill:e,opacity:.75}),g.jsx("rect",{width:o,height:s,fill:"none",stroke:e,opacity:.1})]}):g.jsx("rect",{className:`tl-brush tl-brush__default ${r}`,width:o,height:s})})};var RC={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var Vz;function Uce(){return Vz||(Vz=1,(function(t){(function(){var e={}.hasOwnProperty;function n(){for(var o="",s=0;s<arguments.length;s++){var a=arguments[s];a&&(o=i(o,r(a)))}return o}function r(o){if(typeof o=="string"||typeof o=="number")return o;if(typeof o!="object")return"";if(Array.isArray(o))return n.apply(null,o);if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]"))return o.toString();var s="";for(var a in o)e.call(o,a)&&o[a]&&(s=i(s,a));return s}function i(o,s){return s?o?o+" "+s:o+s:o}t.exports?(n.default=n,t.exports=n):window.classNames=n})()})(RC)),RC.exports}var Hce=Uce();const Ye=ua(Hce),Jt={isSafari:!1,isIos:!1,isChromeForIos:!1,isFirefox:!1,isAndroid:!1,isDarwin:!1,hasCanvasSupport:!1};typeof window<"u"&&"navigator"in window&&(Jt.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),Jt.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),Jt.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),Jt.isFirefox=/firefox/i.test(navigator.userAgent),Jt.isAndroid=/android/i.test(navigator.userAgent),Jt.isDarwin=window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,Jt.hasCanvasSupport=typeof window<"u"&&"Promise"in window&&"HTMLCanvasElement"in window);const Kz={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.05,.1,.25,.5,1,2,4,8]},$C={duration:0,easing:Ui.easeInOutCubic},qz={CAMERA_MOVE:-10},Wce=["top","right","bottom","left"],Gz=0,Z2=2,jx=1,Yz=5,Vce=128;var NC={};const Kce={},JU=Ni("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),Vn={logPreventDefaults:Ni("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:Ni("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:Ni("logElementRemoves",{defaults:{all:!1}}),debugSvg:Ni("debugSvg",{defaults:{all:!1}}),showFps:Ni("showFps",{defaults:{all:!1}}),measurePerformance:Ni("measurePerformance",{defaults:{all:!1}}),throwToBlob:Ni("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:Ni("reconnectOnPing",{defaults:{all:!1}}),debugCursors:Ni("debugCursors",{defaults:{all:!1}}),forceSrgb:Ni("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:Ni("debugGeometry",{defaults:{all:!1}}),hideShapes:Ni("hideShapes",{defaults:{all:!1}}),editOnType:Ni("editOnType",{defaults:{all:!1}}),a11y:Ni("a11y",{defaults:{all:!1}}),debugElbowArrows:Ni("debugElbowArrows",{defaults:{all:!1}})};if(typeof Element<"u"){const t=Element.prototype.removeChild;mo("element removal logging",()=>{Vn.logElementRemoves.get()?Element.prototype.removeChild=function(e){return console.warn("[tldraw] removing child:",e),t.call(this,e)}:Element.prototype.removeChild=t})}function Ni(t,{defaults:e,shouldStoreForSession:n=!0}){return qce({name:t,defaults:e,shouldStoreForSession:n})}function qce(t){const e=Yce(t),n=t.shouldStoreForSession?Gce(t.name):null,r=qt(`debug:${t.name}`,n??e);return typeof window<"u"&&(t.shouldStoreForSession&&mo(`debug:${t.name}`,()=>{const i=r.get();i===e?m5(`tldraw_debug:${t.name}`):f2(`tldraw_debug:${t.name}`,JSON.stringify(i))}),Object.defineProperty(window,`tldraw${t.name.replace(/^[a-z]/,i=>i.toUpperCase())}`,{get(){return r.get()},set(i){r.set(i)},configurable:!0})),Object.assign(r,t,{reset:()=>r.set(e)})}function Gce(t){try{return JSON.parse(g5(`tldraw_debug:${t}`)??"null")}catch{return null}}function LC(t){try{return t()}catch{return null}}function Yce(t){switch(LC(()=>NC.TLDRAW_ENV)??LC(()=>NC.VERCEL_PUBLIC_TLDRAW_ENV)??LC(()=>NC.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return t.defaults.production??t.defaults.all;case"preview":case"staging":return t.defaults.staging??t.defaults.all;default:return t.defaults.development??t.defaults.all}}function fb(t){if(t.nodeType===Node.ELEMENT_NODE)return t;if(t.parentElement)return fb(t.parentElement);throw Error("Could not find a parent element of an HTML type!")}function dt(t){t.preventDefault(),Vn.logPreventDefaults.get()&&console.warn("preventDefault called on event:",t)}function qy(t,e){if(t.setPointerCapture(e.pointerId),Vn.logPointerCaptures.get()){const n=JU.get();n.set(t,(n.get(t)??0)+1),console.warn("setPointerCapture called on element:",t,e)}}function Gy(t,e){if(t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),Vn.logPointerCaptures.get())){const n=JU.get();n.get(t)===1?n.delete(t):n.has(t)?n.set(t,n.get(t)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",t,e)}}const Li=(t,e,n)=>{t&&t.style.setProperty(e,n)};function QU(t=!1){const{activeElement:e}=document,n=t?["input","textarea"]:["input","select","button","textarea"];return!!(e&&(e.isContentEditable||n.indexOf(e.tagName.toLowerCase())>-1||e.classList.contains("tlui-slider__thumb")))}const Rn=t=>Jt.isDarwin?t.metaKey:t.ctrlKey||t.metaKey;function Hi(t,e){return t.markEventAsHandled(e),{point:{x:e.clientX,y:e.clientY,z:e.pressure},shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,metaKey:e.metaKey,accelKey:Rn(e),pointerId:e.pointerId,button:e.button,isPen:e.pointerType==="pen"}}function J2(t,e){return Qw(`${t}_${e}`)}function Ih(t){return Qw(`${I.useId()}${t??""}`)}function za(t){const e=Gr(I.useContext(e8));return Qw(`${e}_${t}`)}function Qw(t){return t.replace(/:/g,"_")}const e8=I.createContext(null);function Xce({children:t}){const e=Ih();return g.jsx(e8.Provider,{value:e,children:t})}const Q2=I.createContext(null);function ne(){const t=rt.useContext(Q2);if(!t)throw new Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return t}function hr(){return rt.useContext(Q2)}function eA({editor:t,children:e}){return g.jsx(Q2.Provider,{value:t,children:g.jsx(Xce,{children:e})})}function e0(){const t=ne(),e=J("current tool",()=>t.getCurrentTool(),[t]),n=I.useMemo(function(){function i(f){if(!t.wasEventAlreadyHandled(f)){if(f.button===Z2){t.dispatch({type:"pointer",target:"canvas",name:"right_click",...Hi(t,f)});return}f.button!==0&&f.button!==1&&f.button!==5||(qy(f.currentTarget,f),t.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...Hi(t,f)}))}}function o(f){t.wasEventAlreadyHandled(f)||f.button!==0&&f.button!==1&&f.button!==2&&f.button!==5||(Gy(f.currentTarget,f),t.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...Hi(t,f)}))}function s(f){if(t.wasEventAlreadyHandled(f)||t.getInstanceState().isPenMode&&f.pointerType!=="pen")return;const y=f.pointerType==="mouse"||f.pointerType==="pen";t.updateInstanceState({isHoveringCanvas:y?!0:null})}function a(f){if(t.wasEventAlreadyHandled(f)||t.getInstanceState().isPenMode&&f.pointerType!=="pen")return;const y=f.pointerType==="mouse"||f.pointerType==="pen";t.updateInstanceState({isHoveringCanvas:y?!1:null})}function l(f){t.wasEventAlreadyHandled(f)||(t.markEventAsHandled(f),dt(f))}function c(f){if(t.wasEventAlreadyHandled(f)||(t.markEventAsHandled(f),!(f.target instanceof HTMLElement)))return;const y=t.getEditingShape()?.id;!(y&&f.target.closest(`[data-shape-id="${y}"]`))&&f.target.tagName!=="A"&&f.target.tagName!=="TEXTAREA"&&!f.target.isContentEditable&&dt(f)}function d(f){t.wasEventAlreadyHandled(f)||dt(f)}async function u(f){if(t.wasEventAlreadyHandled(f))return;if(dt(f),f.stopPropagation(),f.dataTransfer?.files?.length){const v=Array.from(f.dataTransfer.files);await t.putExternalContent({type:"files",files:v,point:t.screenToPage({x:f.clientX,y:f.clientY})});return}const y=f.dataTransfer.getData("url");if(y){await t.putExternalContent({type:"url",url:y,point:t.screenToPage({x:f.clientX,y:f.clientY})});return}}function p(f){t.wasEventAlreadyHandled(f)||f.stopPropagation()}return{onPointerDown:i,onPointerUp:o,onPointerEnter:s,onPointerLeave:a,onDragOver:d,onDrop:u,onTouchStart:l,onTouchEnd:c,onClick:p}},[t]);return I.useEffect(()=>{let r,i;function o(s){if(t.wasEventAlreadyHandled(s)||(t.markEventAsHandled(s),s.clientX===r&&s.clientY===i))return;r=s.clientX,i=s.clientY;const a=e.useCoalescedEvents&&s.getCoalescedEvents?s.getCoalescedEvents():[s];for(const l of a)t.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...Hi(t,l)})}return document.body.addEventListener("pointermove",o),()=>{document.body.removeEventListener("pointermove",o)}},[t,e]),n}function Zce(){const t=ne();I.useEffect(()=>{let e=t.getInstanceState().isCoarsePointer;const n=s=>{const a=s.pointerType!=="mouse";e!==a&&(e=a,t.updateInstanceState({isCoarsePointer:a}))};window.addEventListener("pointerdown",n,{capture:!0});const r=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),i=Jt.isFirefox&&!Jt.isAndroid&&!Jt.isIos,o=()=>{const s=i?!1:r.matches;e===s&&(e=s,t.updateInstanceState({isCoarsePointer:s}))};return r&&(r.addEventListener("change",o),o()),()=>{window.removeEventListener("pointerdown",n,{capture:!0}),r&&r.removeEventListener("change",o)}},[t])}const t8=I.createContext(null);function n8({container:t,children:e}){return g.jsx(t8.Provider,{value:t,children:e})}function Cr(){return Gr(I.useContext(t8),"useContainer used outside of <Tldraw />")}function Jce(){const t=ne(),e=Cr(),n=J("isEditing",()=>t.getEditingShapeId(),[t]),r=J("isFocused",()=>t.getIsFocused(),[t]);I.useEffect(()=>{if(!e)return;function i(o){if(o.isSpecialRedispatchedEvent)return;dt(o),o.stopPropagation();const s=e.querySelector(".tl-canvas");if(!s)return;const a=new DragEvent(o.type,o);a.isSpecialRedispatchedEvent=!0,s.dispatchEvent(a)}return e.addEventListener("dragover",i),e.addEventListener("drop",i),()=>{e.removeEventListener("dragover",i),e.removeEventListener("drop",i)}},[e]),I.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;let i=null;const o=()=>{i?.();const s=`(resolution: ${window.devicePixelRatio}dppx)`,a=matchMedia(s),l=c=>{c.type==="change"&&o()};a.addEventListener?a.addEventListener("change",o):a.addListener&&a.addListener(l),i=()=>{a.removeEventListener?a.removeEventListener("change",o):a.removeListener&&a.removeListener(l)},t.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return o(),()=>{i?.()}},[t]),I.useEffect(()=>{if(!r)return;const i=l=>{if(l.altKey&&(t.isIn("zoom")||!t.getPath().endsWith(".idle"))&&!Bg(t)&&dt(l),t.wasEventAlreadyHandled(l))return;t.markEventAsHandled(l);const c=!!t.getSelectedShapeIds().length;switch(l.key){case"=":case"-":case"0":{if(l.metaKey||l.ctrlKey){dt(l);return}break}case"Tab":{if(Bg(t))return;c&&!n&&dt(l);break}case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{if(Bg(t))return;c&&(l.metaKey||l.ctrlKey)&&dt(l);break}case",":return;case"Escape":{if((t.getEditingShape()||t.getSelectedShapeIds().length>0)&&dt(l),t.menus.getOpenMenus().length>0)return;t.inputs.keys.has("Escape")||(t.inputs.keys.add("Escape"),t.cancel(),e.focus());return}default:if(Bg(t))return}const d={type:"keyboard",name:l.repeat?"key_repeat":"key_down",key:l.key,code:l.code,shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey,metaKey:l.metaKey,accelKey:Rn(l)};t.dispatch(d)},o=l=>{if(t.wasEventAlreadyHandled(l)||(t.markEventAsHandled(l),Bg(t))||l.key===",")return;const c={type:"keyboard",name:"key_up",key:l.key,code:l.code,shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey,metaKey:l.metaKey,accelKey:Rn(l)};t.dispatch(c)};function s(l){if(e.contains(l.target)){const c=l.touches[0].pageX,d=l.touches[0].radiusX||0;(c-d<10||c+d>t.getViewportScreenBounds().width-10)&&(l.target?.tagName==="BUTTON"&&l.target?.click(),dt(l))}}const a=l=>{e.contains(l.target)&&(l.ctrlKey||l.metaKey)&&dt(l)};return e.addEventListener("touchstart",s,{passive:!1}),e.addEventListener("wheel",a,{passive:!1}),document.addEventListener("gesturestart",dt),document.addEventListener("gesturechange",dt),document.addEventListener("gestureend",dt),e.addEventListener("keydown",i),e.addEventListener("keyup",o),()=>{e.removeEventListener("touchstart",s),e.removeEventListener("wheel",a),document.removeEventListener("gesturestart",dt),document.removeEventListener("gesturechange",dt),document.removeEventListener("gestureend",dt),e.removeEventListener("keydown",i),e.removeEventListener("keyup",o)}},[t,e,r,n])}function Bg(t){return t.menus.hasOpenMenus()||QU()}function Qce({className:t,zoom:e,point:n,color:r,viewport:i,opacity:o=1}){const s=I.useRef(null);Ky(s,pt(n.x,i.minX+5/e,i.maxX-5/e),pt(n.y,i.minY+5/e,i.maxY-5/e),1/e,T.Angle(i.center,n));const a=za("cursor_hint");return g.jsxs("svg",{ref:s,className:Ye("tl-overlays__item",t),"aria-hidden":"true",children:[g.jsx("use",{href:`#${a}`,color:r,strokeWidth:3,stroke:"var(--tl-color-background)"}),g.jsx("use",{href:`#${a}`,color:r,opacity:o})]})}const Xz=I.memo(function({className:e,zoom:n,point:r,color:i,name:o,chatMessage:s}){const a=I.useRef(null);Ky(a,r?.x,r?.y,1/n);const l=za("cursor");return r?g.jsxs("div",{ref:a,className:Ye("tl-overlays__item",e),children:[g.jsx("svg",{className:"tl-cursor","aria-hidden":"true",children:g.jsx("use",{href:`#${l}`,color:i})}),s?g.jsxs(g.Fragment,{children:[o&&g.jsx("div",{className:"tl-nametag-title",style:{color:i},children:o}),g.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:i},children:s})]}):o&&g.jsx("div",{className:"tl-nametag",style:{backgroundColor:i},children:o})]}):null}),Yy={openWindow(t,e){window.open(t,e,"noopener noreferrer")},refreshPage(){window.location.reload()},async hardReset(){return await window.__tldraw__hardReset?.()}};function r8(){Yy.hardReset()}function eue(){Yy.refreshPage()}const tue={error:null};class t0 extends I.Component{static getDerivedStateFromError(e){return{error:e}}state=tue;componentDidCatch(e){this.props.onError?.(e)}render(){const{error:e}=this.state;if(e!==null){const{fallback:n}=this.props;return g.jsx(n,{error:e})}return this.props.children}}function ny({children:t,fallback:e,...n}){return e===null?t:g.jsx(t0,{fallback:e,...n,children:t})}const nue="https://github.com/tldraw/tldraw/issues/new",i8=({error:t,editor:e})=>{const n=I.useRef(null),[r,i]=I.useState(!1),[o,s]=I.useState(!1),[a,l]=I.useState(!1);let c=null;try{c=gn().Canvas??null}catch{}const d=t instanceof Error?t.message:String(t),u=t instanceof Error?t.stack:null,p=J("isDarkMode",()=>{try{if(e)return e.user.getIsDarkMode()}catch{}return null},[e]),[f,y]=I.useState(null);I.useLayoutEffect(()=>{p!==null&&y(p);let _=n.current?.parentElement,C=!1;for(;_;){if(_.classList.contains("tl-theme__dark")||_.classList.contains("tl-theme__light")){C=!0;break}_=_.parentElement}if(C){y(null);return}typeof window<"u"&&window.matchMedia&&y(window.matchMedia("(prefers-color-scheme: dark)").matches)},[p]),I.useEffect(()=>{if(o){const _=e?.timers.setTimeout(()=>{s(!1)},2e3);return()=>clearTimeout(_)}},[o,e]);const v=()=>{const _=document.createElement("textarea");_.value=u??d,document.body.appendChild(_),_.select(),document.execCommand("copy"),_.remove(),s(!0)},x=()=>{eue()},b=async()=>{r8()},w=new URL(nue);return w.searchParams.set("title",d),w.searchParams.set("labels","bug"),w.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${u??d}
\`\`\`

My browser: ${navigator.userAgent}`),g.jsxs("div",{ref:n,className:Ye("tl-container tl-error-boundary",f===null?"":f?"tl-theme__dark":"tl-theme__light"),children:[g.jsx("div",{className:"tl-error-boundary__overlay"}),e&&g.jsx(t0,{onError:Xm,fallback:()=>null,children:g.jsx(eA,{editor:e,children:g.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:c?g.jsx(c,{}):null})})}),g.jsx("div",{className:Ye("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":r&&!a}),children:a?g.jsxs(g.Fragment,{children:[g.jsx("h2",{children:"Are you sure?"}),g.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),g.jsxs("div",{className:"tl-error-boundary__content__actions",children:[g.jsx("button",{className:"tlui-button",onClick:()=>l(!1),children:"Cancel"}),g.jsx("button",{className:"tlui-button tl-error-boundary__reset",onClick:b,children:"Reset data"})]})]}):g.jsxs(g.Fragment,{children:[g.jsx("h2",{children:"Something went wrong"}),g.jsx("p",{children:"Please refresh your browser."}),g.jsx("p",{children:"If the issue continues after refreshing, you may need to reset the tldraw data stored on your device."}),g.jsxs("p",{children:[g.jsx("strong",{children:"Note:"})," Resetting will erase your current project and any unsaved work."]}),!1,r&&g.jsxs(g.Fragment,{children:["Message:",g.jsx("h4",{children:g.jsx("code",{children:d})}),"Stack trace:",g.jsxs("div",{className:"tl-error-boundary__content__error",children:[g.jsx("pre",{children:g.jsx("code",{children:u??d})}),g.jsx("button",{className:"tlui-button",onClick:v,children:o?"Copied!":"Copy"})]})]}),g.jsxs("div",{className:"tl-error-boundary__content__actions",children:[g.jsx("button",{className:"tlui-button",onClick:()=>i(!r),children:r?"Hide details":"Show details"}),g.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[g.jsx("button",{className:"tlui-button tl-error-boundary__reset",onClick:()=>l(!0),children:"Reset data"}),g.jsx("button",{className:"tlui-button tl-error-boundary__refresh",onClick:x,children:"Refresh Page"})]})]})]})})]})};function rue({x:t,y:e,z:n,size:r}){const i=Ih("grid"),o=ne(),{gridSteps:s}=o.options;return g.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[g.jsx("defs",{children:s.map(({min:a,mid:l,step:c},d)=>{const u=c*r*n,p=.5+t*n,f=.5+e*n,y=p>0?p%u:u+p%u,v=f>0?f%u:u+f%u,x=n<l?Ha(n,[a,l],[0,1]):1;return g.jsx("pattern",{id:J2(i,`${c}`),width:u,height:u,patternUnits:"userSpaceOnUse",children:g.jsx("circle",{className:"tl-grid-dot",cx:y,cy:v,r:1,opacity:x})},d)})}),s.map(({step:a},l)=>g.jsx("rect",{width:"100%",height:"100%",fill:`url(#${i}_${a})`},l))]})}function iue({handle:t,isCoarse:e,className:n,zoom:r}){const i=ne(),o=(e?i.options.coarseHandleRadius:i.options.handleRadius)/r;if(t.type==="clone"){const a=3/r,l=`M0,${-a} A${a},${a} 0 0,1 0,${a}`,c=Wce.indexOf(t.id);return g.jsxs("g",{className:Ye(`tl-handle tl-handle__${t.type}`,n),children:[g.jsx("circle",{className:"tl-handle__bg",r:o}),g.jsx("path",{className:"tl-handle__fg",d:l,transform:`rotate(${-90+90*c})`})]})}const s=(t.type==="create"&&e?3:4)/Math.max(r,.25);return g.jsxs("g",{className:Ye(`tl-handle tl-handle__${t.type}`,n),children:[g.jsx("circle",{className:"tl-handle__bg",r:o}),g.jsx("circle",{className:"tl-handle__fg",r:s})]})}const oue=({children:t})=>g.jsx("svg",{className:"tl-user-handles tl-overlays__item","aria-hidden":"true",children:t}),tA="4.1.1",Zz={major:"2025-09-18T14:39:22.803Z",minor:"2025-10-15T12:23:29.168Z"};function o8(t,e){const n=I.useRef(t);return e(t,n.current)?n.current:(n.current=t,t)}const sue=(t,e)=>(t??=null,e??=null,t===e?!0:!t||!e?!1:JS(t,e));function gu(t){return o8(t,sue)}const aue=(t,e)=>(t??=null,e??=null,t===e?!0:!t||!e?!1:l5(t,e));function Of(t){return o8(t,aue)}const s8="TLDRAW_USER_DATA_v3",a8=Lt({id:_t,name:_t.nullable().optional(),color:_t.nullable().optional(),locale:_t.nullable().optional(),animationSpeed:ct.nullable().optional(),areKeyboardShortcutsEnabled:Tt.nullable().optional(),edgeScrollSpeed:ct.nullable().optional(),colorScheme:Zd("light","dark","system").optional(),isSnapMode:Tt.nullable().optional(),isWrapMode:Tt.nullable().optional(),isDynamicSizeMode:Tt.nullable().optional(),isPasteAtCursorMode:Tt.nullable().optional(),enhancedA11yMode:Tt.nullable().optional(),inputMode:Zd("trackpad","mouse").nullable().optional()}),hs={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7,AddPasteAtCursor:8,AddKeyboardShortcuts:9,AddShowUiLabels:10,AddPointerPeripheral:11,RenameShowUiLabelsToEnhancedA11yMode:12},nA=Math.max(...Object.values(hs));function lue(t){t.version<hs.AddAnimationSpeed&&(t.user.animationSpeed=1),t.version<hs.AddIsSnapMode&&(t.user.isSnapMode=!1),t.version<hs.MakeFieldsNullable,t.version<hs.AddEdgeScrollSpeed&&(t.user.edgeScrollSpeed=1),t.version<hs.AddExcalidrawSelectMode&&(t.user.isWrapMode=!1),t.version<hs.AllowSystemColorScheme&&(t.user.isDarkMode===!0?t.user.colorScheme="dark":t.user.isDarkMode===!1&&(t.user.colorScheme="light"),delete t.user.isDarkMode),t.version<hs.AddDynamicSizeMode&&(t.user.isDynamicSizeMode=!1),t.version<hs.AddPasteAtCursor&&(t.user.isPasteAtCursorMode=!1),t.version<hs.AddKeyboardShortcuts&&(t.user.areKeyboardShortcutsEnabled=!0),t.version<hs.AddShowUiLabels&&(t.user.showUiLabels=!1),t.version<hs.RenameShowUiLabelsToEnhancedA11yMode&&(t.user.enhancedA11yMode=t.user.showUiLabels,delete t.user.showUiLabels),t.version<hs.AddPointerPeripheral&&(t.user.inputMode=null),t.version=nA}const kT=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function l8(){return kT[Math.floor(Math.random()*kT.length)]}function cue(){return typeof window<"u"&&window.matchMedia?window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches??!1:!1}const Fo=Object.freeze({name:"",locale:Mce(),color:l8(),edgeScrollSpeed:1,animationSpeed:cue()?0:1,areKeyboardShortcutsEnabled:!0,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1,isPasteAtCursorMode:!1,enhancedA11yMode:!1,colorScheme:"light",inputMode:null});function zC(){return{id:Qt(),color:l8()}}function c8(t){if(t===null||typeof t!="object"||!("version"in t)||!("user"in t)||typeof t.version!="number")return zC();const e=fn(t);lue(e);try{return a8.validate(e.user)}catch{return zC()}}function uue(){const t=JSON.parse(h2(s8)||"null")??null;return c8(t)}const n0=qt("globalUserData",null);function due(){p2(s8,JSON.stringify({version:nA,user:n0.get()}))}function u8(t){a8.validate(t),n0.set(t),due(),hue()}const d8=typeof BroadcastChannel<"u"?new BroadcastChannel("tldraw-user-sync"):null;d8?.addEventListener("message",t=>{const e=t.data;e?.type===p8&&e?.origin!==h8()&&n0.set(c8(e.data))});let FC=null;function h8(){return FC===null&&(FC=Qt()),FC}const p8="tldraw-user-preferences-change";function hue(){d8?.postMessage({type:p8,origin:h8(),data:{user:f8(),version:nA}})}function f8(){let t=n0.get();return t||(t=uue(),u8(t)),t}const pue=fe("defaultLocalStorageUserPrefs",()=>f8());function g8(t={}){return{userPreferences:t.userPreferences??pue,setUserPreferences:t.setUserPreferences??u8}}var BC={exports:{}},Jz;function fue(){return Jz||(Jz=1,(function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function i(l,c,d){this.fn=l,this.context=c,this.once=d||!1}function o(l,c,d,u,p){if(typeof d!="function")throw new TypeError("The listener must be a function");var f=new i(d,u||l,p),y=n?n+c:c;return l._events[y]?l._events[y].fn?l._events[y]=[l._events[y],f]:l._events[y].push(f):(l._events[y]=f,l._eventsCount++),l}function s(l,c){--l._eventsCount===0?l._events=new r:delete l._events[c]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],d,u;if(this._eventsCount===0)return c;for(u in d=this._events)e.call(d,u)&&c.push(n?u.slice(1):u);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(d)):c},a.prototype.listeners=function(c){var d=n?n+c:c,u=this._events[d];if(!u)return[];if(u.fn)return[u.fn];for(var p=0,f=u.length,y=new Array(f);p<f;p++)y[p]=u[p].fn;return y},a.prototype.listenerCount=function(c){var d=n?n+c:c,u=this._events[d];return u?u.fn?1:u.length:0},a.prototype.emit=function(c,d,u,p,f,y){var v=n?n+c:c;if(!this._events[v])return!1;var x=this._events[v],b=arguments.length,w,_;if(x.fn){switch(x.once&&this.removeListener(c,x.fn,void 0,!0),b){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,d),!0;case 3:return x.fn.call(x.context,d,u),!0;case 4:return x.fn.call(x.context,d,u,p),!0;case 5:return x.fn.call(x.context,d,u,p,f),!0;case 6:return x.fn.call(x.context,d,u,p,f,y),!0}for(_=1,w=new Array(b-1);_<b;_++)w[_-1]=arguments[_];x.fn.apply(x.context,w)}else{var C=x.length,A;for(_=0;_<C;_++)switch(x[_].once&&this.removeListener(c,x[_].fn,void 0,!0),b){case 1:x[_].fn.call(x[_].context);break;case 2:x[_].fn.call(x[_].context,d);break;case 3:x[_].fn.call(x[_].context,d,u);break;case 4:x[_].fn.call(x[_].context,d,u,p);break;default:if(!w)for(A=1,w=new Array(b-1);A<b;A++)w[A-1]=arguments[A];x[_].fn.apply(x[_].context,w)}}return!0},a.prototype.on=function(c,d,u){return o(this,c,d,u,!1)},a.prototype.once=function(c,d,u){return o(this,c,d,u,!0)},a.prototype.removeListener=function(c,d,u,p){var f=n?n+c:c;if(!this._events[f])return this;if(!d)return s(this,f),this;var y=this._events[f];if(y.fn)y.fn===d&&(!p||y.once)&&(!u||y.context===u)&&s(this,f);else{for(var v=0,x=[],b=y.length;v<b;v++)(y[v].fn!==d||p&&!y[v].once||u&&y[v].context!==u)&&x.push(y[v]);x.length?this._events[f]=x.length===1?x[0]:x:s(this,f)}return this},a.prototype.removeAllListeners=function(c){var d;return c?(d=n?n+c:c,this._events[d]&&s(this,d)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,t.exports=a})(BC)),BC.exports}var gue=fue();const mue=ua(gue),Kp="TLDRAW_TAB_ID_v2",nh=globalThis.window;function yue(){return nh?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(nh.navigator.platform)||Jt.isDarwin&&"ontouchend"in document:!1}const gb=nh?nh[Kp]??g5(Kp)??"TLDRAW_INSTANCE_STATE_V1_"+Qt():"<error>";nh&&(nh[Kp]=gb,yue()?f2(Kp,gb):m5(Kp));nh?.addEventListener("beforeunload",()=>{f2(Kp,gb)});const m8={Initial:0},r0=Math.max(...Object.values(m8));function vue(t){t.version<m8.Initial,t.version=r0}const y8=Lt({version:ct,currentPageId:ey.optional(),isFocusMode:Tt.optional(),exportBackground:Tt.optional(),isDebugMode:Tt.optional(),isToolLocked:Tt.optional(),isGridMode:Tt.optional(),pageStates:Jr(Lt({pageId:ey,camera:Lt({x:ct,y:ct,z:ct}).optional(),selectedShapeIds:Jr(Xs).optional(),focusedGroupId:Xs.nullable().optional()})).optional()});function xue(t){if(!t||typeof t!="object")return console.warn("Invalid instance state"),null;if(!("version"in t)||typeof t.version!="number")return console.warn("No version in instance state"),null;t.version!==r0&&(t=fn(t),vue(t));try{return y8.validate(t)}catch(e){return console.warn(e),null}}function rA(t){const e=t.query.ids("page");return fe("sessionStateSnapshot",()=>{const n=t.get(uo);if(!n)return null;const r=[...e.get()];return{version:r0,currentPageId:n.currentPageId,exportBackground:n.exportBackground,isFocusMode:n.isFocusMode,isDebugMode:n.isDebugMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,pageStates:r.map(i=>{const o=t.get($a.createId(i)),s=t.get(yl.createId(i));return{pageId:i,camera:{x:s?.x??0,y:s?.y??0,z:s?.z??1},selectedShapeIds:o?.selectedShapeIds??[],focusedGroupId:o?.focusedGroupId??null}})}},{isEqual:Bu})}function IT(t,e,n){const r=xue(e);if(!r)return;const i=IU(t.get(uo)),o=n?.forceOverwrite?r:i,s=n?.forceOverwrite?i:r,a=t.schema.types.instance.create({id:uo,...i,currentPageId:r.currentPageId,isDebugMode:o?.isDebugMode??s?.isDebugMode,isFocusMode:o?.isFocusMode??s?.isFocusMode,isToolLocked:o?.isToolLocked??s?.isToolLocked,isGridMode:o?.isGridMode??s?.isGridMode,exportBackground:o?.exportBackground??s?.exportBackground});t.atomic(()=>{for(const l of r.pageStates??[]){if(!t.has(l.pageId))continue;const c=yl.createId(l.pageId),d=$a.createId(l.pageId),u=t.get(c),p=t.get(d);t.put([yl.create({id:c,x:l.camera?.x??u?.x,y:l.camera?.y??u?.y,z:l.camera?.z??u?.z}),$a.create({id:d,pageId:l.pageId,selectedShapeIds:l.selectedShapeIds??p?.selectedShapeIds,focusedGroupId:l.focusedGroupId??p?.focusedGroupId})])}t.put([a]),t.ensureStoreIsUsable()})}function Sue(t){const e=[];for(const i of Object.values(t))i.typeName?.match(/^(instance.*|pointer|camera)$/)&&e.push(i);const n=e.filter(i=>i.typeName==="instance"&&i.id!==uo)[0];if(!n)return null;const r={version:r0,currentPageId:n.currentPageId,exportBackground:!!n.exportBackground,isFocusMode:!!n.isFocusMode,isDebugMode:!!n.isDebugMode,isToolLocked:!!n.isToolLocked,isGridMode:!1,pageStates:e.filter(i=>i.typeName==="instance_page_state"&&i.instanceId===n.id).map(i=>{const o=t[i.cameraId]??{x:0,y:0,z:1};return{pageId:i.pageId,camera:{x:o.x,y:o.y,z:o.z},selectedShapeIds:i.selectedShapeIds,focusedGroupId:i.focusedGroupId}})};try{return y8.validate(r),r}catch{return null}}function v8(t,e,n){let r={};if("store"in e){const s=t.schema.migrateStoreSnapshot(e);if(s.type!=="success")throw new Error("Failed to migrate store snapshot: "+s.reason);r.document={schema:t.schema.serialize(),store:Em(s.value,(a,{typeName:l})=>t.scopedTypes.document.has(l))}}else r=e;const i=IU(t.get(uo)),o=x8.get(t,rA).get();t.atomic(()=>{r.document&&t.loadStoreSnapshot(r.document),i&&t.update(uo,s=>({...s,...i})),o&&IT(t,o),r.session&&IT(t,r.session,{forceOverwrite:n?.forceOverwriteSessionState})})}const x8=new ki;function bue(t){const n=x8.get(t,rA).get();if(!n)throw new Error("Session state is not ready yet");return{document:t.getStoreSnapshot(),session:n}}function S8(t){const e=[],n=new Set;for(const r of t){if(n.has(r.type))throw new Error(`Binding type "${r.type}" is defined more than once`);e.push(r),n.add(r.type)}return e}function _l({children:t,className:e="",...n}){return g.jsx("svg",{...n,className:Ye("tl-svg-container",e),"aria-hidden":"true",children:t})}class pe{constructor(e=0,n=0,r=0,i=0){this.x=e,this.y=n,this.w=r,this.h=i}x=0;y=0;w=0;h=0;get point(){return new T(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get left(){return this.x}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get right(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get top(){return this.y}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get bottom(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new T(this.x+this.w/2,this.y+this.h/2)}set center(e){this.x=e.x-this.w/2,this.y=e.y-this.h/2}get corners(){return[new T(this.x,this.y),new T(this.x+this.w,this.y),new T(this.x+this.w,this.y+this.h),new T(this.x,this.y+this.h)]}get cornersAndCenter(){return[new T(this.x,this.y),new T(this.x+this.w,this.y),new T(this.x+this.w,this.y+this.h),new T(this.x,this.y+this.h),new T(this.x+this.w/2,this.y+this.h/2)]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new T(this.w,this.h)}toFixed(){return this.x=Dx(this.x),this.y=Dx(this.y),this.w=Dx(this.w),this.h=Dx(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,n=0,r=0,i=0){return this.x=e,this.y=n,this.w=r,this.h=i,this}expand(e){const n=Math.min(this.x,e.x),r=Math.min(this.y,e.y),i=Math.max(this.x+this.w,e.x+e.w),o=Math.max(this.y+this.h,e.y+e.h);return this.x=n,this.y=r,this.w=i-n,this.h=o-r,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=e*2,this.h+=e*2,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:e,y:n,w:r,h:i}=this;return new pe(e,n,r,i)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const n=Math.round(this.x/e)*e,r=Math.round(this.y/e)*e,i=Math.round((this.x+this.w)/e)*e,o=Math.round((this.y+this.h)/e)*e;this.minX=n,this.minY=r,this.width=Math.max(1,i-n),this.height=Math.max(1,o-r)}collides(e){return pe.Collides(this,e)}contains(e){return pe.Contains(this,e)}includes(e){return pe.Includes(this,e)}containsPoint(e,n=0){return pe.ContainsPoint(this,e,n)}getHandlePoint(e){switch(e){case"top_left":return new T(this.x,this.y);case"top_right":return new T(this.x+this.w,this.y);case"bottom_left":return new T(this.x,this.y+this.h);case"bottom_right":return new T(this.x+this.w,this.y+this.h);case"top":return new T(this.x+this.w/2,this.y);case"right":return new T(this.x+this.w,this.y+this.h/2);case"bottom":return new T(this.x+this.w/2,this.y+this.h);case"left":return new T(this.x,this.y+this.h/2)}}toJson(){return{x:this.x,y:this.y,w:this.w,h:this.h}}resize(e,n,r){const{minX:i,minY:o,maxX:s,maxY:a}=this;let{minX:l,minY:c,maxX:d,maxY:u}=this;switch(e){case"left":case"top_left":case"bottom_left":{l+=n;break}case"right":case"top_right":case"bottom_right":{d+=n;break}}switch(e){case"top":case"top_left":case"top_right":{c+=r;break}case"bottom":case"bottom_left":case"bottom_right":{u+=r;break}}const p=(d-l)/(s-i),f=(u-c)/(a-o),y=p<0,v=f<0;if(y){const x=d;d=l,l=x}if(v){const x=u;u=c,c=x}this.minX=l,this.minY=c,this.width=Math.abs(d-l),this.height=Math.abs(u-c)}union(e){const n=Math.min(this.x,e.x),r=Math.min(this.y,e.y),i=Math.max(this.x+this.w,e.x+e.w),o=Math.max(this.y+this.h,e.y+e.h);return this.x=n,this.y=r,this.width=i-n,this.height=o-r,this}static From(e){return new pe(e.x,e.y,e.w,e.h)}static FromCenter(e,n){return new pe(e.x-n.x/2,e.y-n.y/2,n.x,n.y)}static FromPoints(e){if(e.length===0)return new pe;let n=1/0,r=1/0,i=-1/0,o=-1/0,s;for(let a=0,l=e.length;a<l;a++)s=e[a],n=Math.min(s.x,n),r=Math.min(s.y,r),i=Math.max(s.x,i),o=Math.max(s.y,o);return new pe(n,r,i-n,o-r)}static Expand(e,n){const r=Math.min(n.minX,e.minX),i=Math.min(n.minY,e.minY),o=Math.max(n.maxX,e.maxX),s=Math.max(n.maxY,e.maxY);return new pe(r,i,o-r,s-i)}static ExpandBy(e,n){return new pe(e.minX-n,e.minY-n,e.width+n*2,e.height+n*2)}static Collides(e,n){return!(e.maxX<n.minX||e.minX>n.maxX||e.maxY<n.minY||e.minY>n.maxY)}static Contains(e,n){return e.minX<n.minX&&e.minY<n.minY&&e.maxY>n.maxY&&e.maxX>n.maxX}static ContainsApproximately(e,n,r){return xu(e.minX,n.minX,r)&&xu(e.minY,n.minY,r)&&xu(n.maxX,e.maxX,r)&&xu(n.maxY,e.maxY,r)}static Includes(e,n){return pe.Collides(e,n)||pe.Contains(e,n)}static ContainsPoint(e,n,r=0){return!(n.x<e.minX-r||n.y<e.minY-r||n.x>e.maxX+r||n.y>e.maxY+r)}static Common(e){let n=1/0,r=1/0,i=-1/0,o=-1/0;for(let s=0;s<e.length;s++){const a=e[s];n=Math.min(n,a.minX),r=Math.min(r,a.minY),i=Math.max(i,a.maxX),o=Math.max(o,a.maxY)}return new pe(n,r,i-n,o-r)}static Sides(e,n=0){const{corners:r}=e;return[[r[0],r[1]],[r[1],r[2]],[r[2],r[3]],[r[3],r[0]]]}static Resize(e,n,r,i,o=!1){const{minX:s,minY:a,maxX:l,maxY:c}=e;let{minX:d,minY:u,maxX:p,maxY:f}=e;switch(n){case"left":case"top_left":case"bottom_left":{d+=r;break}case"right":case"top_right":case"bottom_right":{p+=r;break}}switch(n){case"top":case"top_left":case"top_right":{u+=i;break}case"bottom":case"bottom_left":case"bottom_right":{f+=i;break}}const y=(p-d)/(l-s),v=(f-u)/(c-a),x=y<0,b=v<0;if(o){const _=(l-s)/(c-a),C=Math.abs(p-d),A=Math.abs(f-u),E=C*(v<0?1:-1)*(1/_),O=A*(y<0?1:-1)*_,D=_<C/A;switch(n){case"top_left":{D?u=f+E:d=p+O;break}case"top_right":{D?u=f+E:p=d-O;break}case"bottom_right":{D?f=u-E:p=d-O;break}case"bottom_left":{D?f=u-E:d=p+O;break}case"bottom":case"top":{const B=(d+p)/2,L=A*_;d=B-L/2,p=B+L/2;break}case"left":case"right":{const B=(u+f)/2,L=C/_;u=B-L/2,f=B+L/2;break}}}if(x){const _=p;p=d,d=_}if(b){const _=f;f=u,u=_}const w=new pe(d,u,Math.abs(p-d),Math.abs(f-u));return{box:w,scaleX:+(w.width/e.width*(y>0?1:-1)).toFixed(5),scaleY:+(w.height/e.height*(v>0?1:-1)).toFixed(5)}}equals(e){return pe.Equals(this,e)}static Equals(e,n){return n.x===e.x&&n.y===e.y&&n.w===e.w&&n.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new pe(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}}function wue(t){switch(t){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return t}}function kue(t){switch(t){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return t}}function Iue(t){return t==="top_left"||t==="top_right"||t==="bottom_right"||t==="bottom_left"}class xe{constructor(e,n,r,i,o,s){this.a=e,this.b=n,this.c=r,this.d=i,this.e=o,this.f=s}a=1;b=0;c=0;d=1;e=0;f=0;equals(e){return this===e||this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const n=e,{a:r,b:i,c:o,d:s,e:a,f:l}=this;return this.a=r*n.a+o*n.b,this.c=r*n.c+o*n.d,this.e=r*n.e+o*n.f+a,this.b=i*n.a+s*n.b,this.d=i*n.c+s*n.d,this.f=i*n.e+s*n.f+l,this}rotate(e,n,r){return e===0?this:n===void 0?this.multiply(xe.Rotate(e)):this.translate(n,r).multiply(xe.Rotate(e)).translate(-n,-r)}translate(e,n){return this.multiply(xe.Translate(e,n))}scale(e,n){return this.multiply(xe.Scale(e,n))}invert(){const{a:e,b:n,c:r,d:i,e:o,f:s}=this,a=e*i-n*r;return this.a=i/a,this.b=n/-a,this.c=r/-a,this.d=e/a,this.e=(i*o-r*s)/-a,this.f=(n*o-e*s)/a,this}applyToPoint(e){return xe.applyToPoint(this,e)}applyToPoints(e){return xe.applyToPoints(this,e)}rotation(){return xe.Rotation(this)}point(){return xe.Point(this)}decomposed(){return xe.Decompose(this)}toCssString(){return xe.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return xe.Decompose(this)}clone(){return new xe(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new xe(1,0,0,1,0,0)}static Translate(e,n){return new xe(1,0,0,1,e,n)}static Rotate(e,n,r){if(e===0)return xe.Identity();const i=Math.cos(e),o=Math.sin(e),s=new xe(i,o,-o,i,0,0);return n===void 0?s:xe.Compose(xe.Translate(n,r),s,xe.Translate(-n,-r))}static Scale(e,n,r,i){const o=new xe(e,0,0,n,0,0);return r===void 0?o:xe.Translate(r,i).multiply(o).translate(-r,-i)}static Multiply(e,n){return{a:e.a*n.a+e.c*n.b,c:e.a*n.c+e.c*n.d,e:e.a*n.e+e.c*n.f+e.e,b:e.b*n.a+e.d*n.b,d:e.b*n.c+e.d*n.d,f:e.b*n.e+e.d*n.f+e.f}}static Inverse(e){const n=e.a*e.d-e.b*e.c;return{a:e.d/n,b:e.b/-n,c:e.c/-n,d:e.a/n,e:(e.d*e.e-e.c*e.f)/-n,f:(e.b*e.e-e.a*e.f)/n}}static Absolute(e){const n=e.a*e.d-e.b*e.c;return{a:e.d/n,b:e.b/-n,c:e.c/-n,d:e.a/n,e:(e.d*e.e-e.c*e.f)/n,f:(e.b*e.e-e.a*e.f)/-n}}static Compose(...e){const n=xe.Identity();for(let r=0,i=e.length;r<i;r++)n.multiply(e[r]);return n}static Point(e){return new T(e.e,e.f)}static Rotation(e){let n;if(e.a!==0||e.c!==0){const r=(e.a*e.a+e.c*e.c)**.5;n=Math.acos(e.a/r)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const r=(e.b*e.b+e.d*e.d)**.5;n=br+Math.acos(e.b/r)*(e.d>0?-1:1)}else n=0;return wT(n)}static Decompose(e){let n,r,i;if(e.a!==0||e.c!==0){const o=(e.a*e.a+e.c*e.c)**.5;n=o,r=(e.a*e.d-e.b*e.c)/o,i=Math.acos(e.a/o)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const o=(e.b*e.b+e.d*e.d)**.5;n=(e.a*e.d-e.b*e.c)/o,r=o,i=br+Math.acos(e.b/o)*(e.d>0?-1:1)}else n=0,r=0,i=0;return{x:e.e,y:e.f,scaleX:n,scaleY:r,rotation:wT(i)}}static Smooth(e,n=1e10){return e.a=Math.round(e.a*n)/n,e.b=Math.round(e.b*n)/n,e.c=Math.round(e.c*n)/n,e.d=Math.round(e.d*n)/n,e.e=Math.round(e.e*n)/n,e.f=Math.round(e.f*n)/n,e}static toCssString(e){return`matrix(${ee(e.a)}, ${ee(e.b)}, ${ee(e.c)}, ${ee(e.d)}, ${ee(e.e)}, ${ee(e.f)})`}static applyToPoint(e,n){return new T(e.a*n.x+e.c*n.y+e.e,e.b*n.x+e.d*n.y+e.f,n.z)}static applyToXY(e,n,r){return[e.a*n+e.c*r+e.e,e.b*n+e.d*r+e.f]}static applyToPoints(e,n){return n.map(r=>new T(e.a*r.x+e.c*r.y+e.e,e.b*r.x+e.d*r.y+e.f,r.z))}static applyToBounds(e,n){return new pe(e.e+n.minX,e.f+n.minY,n.width,n.height)}static From(e){return new xe(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof xe?e:xe.From(e)}}function i0(t,e,n,r,i=1e-10){const o=t.x-n.x,s=t.y-n.y,a=r.x-n.x,l=r.y-n.y,c=e.x-t.x,d=e.y-t.y,u=a*s-l*o,p=c*s-d*o,f=l*c-a*d;if(Ir(u,0,i)||Ir(p,0,i)||Ir(f,0,i))return null;if(f!==0){const y=u/f,v=p/f;if(xu(0,y,i)&&xu(y,1,i)&&xu(0,v,i)&&xu(v,1,i))return T.AddXY(t,y*c,y*d)}return null}function Xy(t,e,n,r){const i=(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y),o=2*((e.x-t.x)*(t.x-n.x)+(e.y-t.y)*(t.y-n.y)),s=n.x*n.x+n.y*n.y+t.x*t.x+t.y*t.y-2*(n.x*t.x+n.y*t.y)-r*r,a=o*o-4*i*s;if(a<0||a===0)return null;const l=Math.sqrt(a),c=(-o+l)/(2*i),d=(-o-l)/(2*i);if((c<0||c>1)&&(d<0||d>1))return null;const u=[];return 0<=c&&c<=1&&u.push(T.Lrp(t,e,c)),0<=d&&d<=1&&u.push(T.Lrp(t,e,d)),u.length===0?null:u}function _ue(t,e,n){const r=[];let i;for(let o=0,s=n.length-1;o<s;o++)i=i0(t,e,n[o],n[o+1]),i&&r.push(i);return r.length===0?null:r}function b8(t,e,n){const r=[];let i;for(let o=1,s=n.length;o<s+1;o++)i=i0(t,e,n[o-1],n[o%n.length]),i&&r.push(i);return r.length===0?null:r}function Cue(t,e,n,r){let i=n.x-t.x,o=n.y-t.y;const s=Math.sqrt(i*i+o*o),a=(s*s-r*r+e*e)/(2*s),l=Math.sqrt(e*e-a*a);return i/=s,o/=s,[new T(t.x+i*a-o*l,t.y+o*a+i*l),new T(t.x+i*a+o*l,t.y+o*a-i*l)]}function Pue(t,e,n){const r=[];let i,o,s;for(let a=0,l=n.length;a<l;a++)i=n[a],o=n[(a+1)%n.length],s=Xy(i,o,t,e),s&&r.push(...s);return r.length===0?null:r}function Tue(t,e,n){const r=[];let i,o,s;for(let a=1,l=n.length;a<l;a++)i=n[a-1],o=n[a],s=Xy(i,o,t,e),s&&r.push(...s);return r.length===0?null:r}function Rx(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function iA(t,e,n,r){return Rx(t,n,r)!==Rx(e,n,r)&&Rx(t,e,n)!==Rx(t,e,r)}function mb(t,e){const n=new Map;let r,i,o,s;for(let a=0,l=t.length;a<l;a++)if(r=t[a],fo(r,e)){const c=NS(r);n.has(c)||n.set(c,r)}for(let a=0,l=e.length;a<l;a++)if(r=e[a],fo(r,t)){const c=NS(r);n.has(c)||n.set(c,r)}for(let a=0,l=t.length;a<l;a++){r=t[a],i=t[(a+1)%t.length];for(let c=0,d=e.length;c<d;c++){o=e[c],s=e[(c+1)%e.length];const u=i0(r,i,o,s);if(u!==null){const p=NS(u);n.has(p)||n.set(p,u)}}}return n.size===0?null:Eue([...n.values()])}function Qz(t,e,n,r){const i=new Map;for(let o=0,s=n?t.length:t.length-1;o<s;o++){const a=t[o],l=t[(o+1)%t.length];for(let c=0,d=r?e.length:e.length-1;c<d;c++){const u=e[c],p=e[(c+1)%e.length],f=i0(a,l,u,p);if(f!==null){const y=NS(f);i.has(y)||i.set(y,f)}}}return[...i.values()]}function NS(t){return`${t.x},${t.y}`}function Eue(t){const e=T.Average(t);return t.sort((n,r)=>T.Angle(e,n)-T.Angle(e,r))}function w8(t,e){let n,r,i,o;for(let s=0,a=t.length;s<a;s++){n=t[s],r=t[(s+1)%a];for(let l=0,c=e.length;l<c;l++)if(i=e[l],o=e[(l+1)%c],iA(n,r,i,o))return!0}return!1}function Aue(t,e){let n,r,i,o;for(let s=0,a=t.length;s<a;s++){n=t[s],r=t[(s+1)%a];for(let l=1,c=e.length;l<c;l++)if(i=e[l-1],o=e[l],iA(n,r,i,o))return!0}return!1}const bl={EXCLUDE_NON_STANDARD:{includeLabels:!1,includeInternal:!1},EXCLUDE_LABELS:{includeLabels:!1,includeInternal:!0}};class Gu{isFilled=!1;isClosed=!0;isLabel=!1;isEmptyLabel=!1;isInternal=!1;excludeFromShapeBounds=!1;debugColor;ignore;constructor(e){const{isLabel:n=!1,isEmptyLabel:r=!1,isInternal:i=!1,excludeFromShapeBounds:o=!1}=e;this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.debugColor=e.debugColor,this.ignore=e.ignore,this.isLabel=n,this.isEmptyLabel=r,this.isInternal=i,this.excludeFromShapeBounds=o}isExcludedByFilter(e){return e?!!(this.isLabel&&!e.includeLabels||this.isInternal&&!e.includeInternal):!1}hitTestPoint(e,n=0,r=!1,i){return this.isClosed&&(this.isFilled||r)&&fo(e,this.vertices)?!0:T.Dist2(e,this.nearestPoint(e))<=n*n}distanceToPoint(e,n=!1,r){return T.Dist(e,this.nearestPoint(e,r))*(this.isClosed&&(this.isFilled||n)&&fo(e,this.vertices)?-1:1)}distanceToLineSegment(e,n,r){if(T.Equals(e,n))return this.distanceToPoint(e,!1,r);const{vertices:i}=this;if(i.length===0)throw Error("nearest point not found");if(i.length===1)return T.Dist(e,i[0]);let o,s=1/0,a,l,c;const d=this.isClosed?i.length:i.length-1;for(let u=0;u<i.length;u++){if(l=i[u],u<d){const p=i[(u+1)%i.length];if(iA(e,n,l,p))return 0}c=T.NearestPointOnLineSegment(e,n,l,!0),a=T.Dist2(l,c),a<s&&(s=a,o=c)}if(!o)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&fo(o,this.vertices)?-s:s}hitTestLineSegment(e,n,r=0,i){return this.distanceToLineSegment(e,n,i)<=r}intersectLineSegment(e,n,r){return(this.isClosed?b8(e,n,this.vertices):_ue(e,n,this.vertices))??[]}intersectCircle(e,n,r){return(this.isClosed?Pue(e,n,this.vertices):Tue(e,n,this.vertices))??[]}intersectPolygon(e,n){return Qz(e,this.vertices,!0,this.isClosed)}intersectPolyline(e,n){return Qz(e,this.vertices,!1,this.isClosed)}interpolateAlongEdge(e,n){const{vertices:r}=this;if(r.length===0)return new T(0,0);if(r.length===1||e<=0)return r[0];const i=e*this.length;let o=0;for(let s=0;s<(this.isClosed?r.length:r.length-1);s++){const a=r[s],l=r[(s+1)%r.length],c=T.Dist(a,l),d=o+c;if(d>=i)return T.Lrp(a,l,Jm(o,d,i));o=d}return this.isClosed?r[0]:r[r.length-1]}uninterpolateAlongEdge(e,n){const{vertices:r,length:i}=this;let o=null,s=1/0,a=0;if(r.length===0||r.length===1)return 0;for(let c=0;c<(this.isClosed?r.length:r.length-1);c++){const d=r[c],u=r[(c+1)%r.length],p=T.NearestPointOnLineSegment(d,u,e,!0),f=T.Dist(p,e);f<s&&(s=f,o={start:d,end:u,nearestPoint:p,distanceToStart:a}),a+=T.Dist(d,u)}return Ge(o),(o.distanceToStart+T.Dist(o.start,o.nearestPoint))/i}isPointInBounds(e,n=0){const{bounds:r}=this;return!(e.x<r.minX-n||e.y<r.minY-n||e.x>r.maxX+n||e.y>r.maxY+n)}overlapsPolygon(e){const n=e.map(l=>T.From(l)),{vertices:r,center:i,isFilled:o,isEmptyLabel:s,isClosed:a}=this;if(s)return!1;if(r.some(l=>fo(l,n)))return!0;if(a){if(o&&(fo(i,n)||n.every(l=>fo(l,r)))||w8(n,r))return!0}else if(Aue(n,r))return!0;return!1}transform(e,n){return new oA(this,e,n)}_vertices;get vertices(){return this._vertices||(this._vertices=this.getVertices(bl.EXCLUDE_LABELS)),this._vertices}getBoundsVertices(){return this.excludeFromShapeBounds?[]:this.vertices}_boundsVertices;get boundsVertices(){return this._boundsVertices||(this._boundsVertices=this.getBoundsVertices()),this._boundsVertices}getBounds(){return pe.FromPoints(this.boundsVertices)}_bounds;get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}_area;get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let n=0;for(let r=0,i=e.length;r<i;r++){const o=e[r],s=e[(r+1)%i];n+=o.x*s.y-s.x*o.y}return n/2}toSimpleSvgPath(){let e="";const{vertices:n}=this,r=n.length;if(r===0)return e;e+=`M${n[0].x},${n[0].y}`;for(let i=1;i<r;i++)e+=`L${n[i].x},${n[i].y}`;return this.isClosed&&(e+="Z"),e}_length;get length(){return this._length?this._length:(this._length=this.getLength(bl.EXCLUDE_LABELS),this._length)}getLength(e){const n=this.getVertices(e??bl.EXCLUDE_LABELS);if(n.length===0)return 0;let r=n[0],i=0;for(let o=1;o<n.length;o++){const s=n[o];i+=T.Dist(r,s),r=s}return this.isClosed&&(i+=T.Dist(n[n.length-1],n[0])),i}}class oA extends Gu{constructor(e,n,r){super(e),this.geometry=e,this.matrix=n,this.inverse=xe.Inverse(n),this.decomposed=xe.Decompose(n),r&&(r.isLabel!=null&&(this.isLabel=r.isLabel),r.isInternal!=null&&(this.isInternal=r.isInternal),r.debugColor!=null&&(this.debugColor=r.debugColor),r.ignore!=null&&(this.ignore=r.ignore)),Ge(Ir(this.decomposed.scaleX,this.decomposed.scaleY),"non-uniform scaling is not yet supported")}inverse;decomposed;getVertices(e){return this.geometry.getVertices(e).map(n=>xe.applyToPoint(this.matrix,n))}getBoundsVertices(){return this.geometry.getBoundsVertices().map(e=>xe.applyToPoint(this.matrix,e))}nearestPoint(e,n){return xe.applyToPoint(this.matrix,this.geometry.nearestPoint(xe.applyToPoint(this.inverse,e),n))}hitTestPoint(e,n=0,r,i){return this.geometry.hitTestPoint(xe.applyToPoint(this.inverse,e),n/this.decomposed.scaleX,r,i)}distanceToPoint(e,n=!1,r){return this.geometry.distanceToPoint(xe.applyToPoint(this.inverse,e),n,r)*this.decomposed.scaleX}distanceToLineSegment(e,n,r){return this.geometry.distanceToLineSegment(xe.applyToPoint(this.inverse,e),xe.applyToPoint(this.inverse,n),r)*this.decomposed.scaleX}hitTestLineSegment(e,n,r=0,i){return this.geometry.hitTestLineSegment(xe.applyToPoint(this.inverse,e),xe.applyToPoint(this.inverse,n),r/this.decomposed.scaleX,i)}intersectLineSegment(e,n,r){return xe.applyToPoints(this.matrix,this.geometry.intersectLineSegment(xe.applyToPoint(this.inverse,e),xe.applyToPoint(this.inverse,n),r))}intersectCircle(e,n,r){return xe.applyToPoints(this.matrix,this.geometry.intersectCircle(xe.applyToPoint(this.inverse,e),n/this.decomposed.scaleX,r))}intersectPolygon(e,n){return xe.applyToPoints(this.matrix,this.geometry.intersectPolygon(xe.applyToPoints(this.inverse,e),n))}intersectPolyline(e,n){return xe.applyToPoints(this.matrix,this.geometry.intersectPolyline(xe.applyToPoints(this.inverse,e),n))}transform(e,n){return new oA(this.geometry,xe.Multiply(e,this.matrix),{isLabel:n?.isLabel??this.isLabel,isInternal:n?.isInternal??this.isInternal,debugColor:n?.debugColor??this.debugColor,ignore:n?.ignore??this.ignore})}getSvgPathData(){throw new Error("Cannot get SVG path data for transformed geometry.")}}class Zo extends Gu{children=[];ignoredChildren=[];constructor(e){super({...e,isClosed:!0,isFilled:!1});const n=r=>{for(const i of r)i instanceof Zo?n(i.children):i.ignore?this.ignoredChildren.push(i):this.children.push(i)};if(n(e.children),this.children.length===0)throw Error("Group2d must have at least one child")}getVertices(e){return this.isExcludedByFilter(e)?[]:this.children.filter(n=>!n.isExcludedByFilter(e)).flatMap(n=>n.getVertices(e))}nearestPoint(e,n){let r=1/0,i;const{children:o}=this;if(o.length===0)throw Error("no children");let s,a;for(const l of o)l.isExcludedByFilter(n)||(s=l.nearestPoint(e,n),a=T.Dist2(s,e),a<r&&(r=a,i=s));if(!i)throw Error("nearest point not found");return i}distanceToPoint(e,n=!1,r){let i=1/0;for(const o of this.children){if(o.isExcludedByFilter(r))continue;const s=o.distanceToPoint(e,n,r);s<i&&(i=s)}return i}hitTestPoint(e,n,r,i=bl.EXCLUDE_LABELS){return!!this.children.filter(o=>!o.isExcludedByFilter(i)).find(o=>o.hitTestPoint(e,n,r))}hitTestLineSegment(e,n,r,i=bl.EXCLUDE_LABELS){return!!this.children.filter(o=>!o.isExcludedByFilter(i)).find(o=>o.hitTestLineSegment(e,n,r))}intersectLineSegment(e,n,r){return this.children.flatMap(i=>i.isExcludedByFilter(r)?ur:i.intersectLineSegment(e,n,r))}intersectCircle(e,n,r){return this.children.flatMap(i=>i.isExcludedByFilter(r)?ur:i.intersectCircle(e,n,r))}getBoundsVertices(){return this.excludeFromShapeBounds?[]:this.children.flatMap(e=>e.getBoundsVertices())}intersectPolygon(e,n){return this.children.flatMap(r=>r.isExcludedByFilter(n)?ur:r.intersectPolygon(e,n))}intersectPolyline(e,n){return this.children.flatMap(r=>r.isExcludedByFilter(n)?ur:r.intersectPolyline(e,n))}interpolateAlongEdge(e,n){const r=this.getLength(n),i=e*r;let o=0;for(const s of this.children){if(s.isExcludedByFilter(n))continue;const a=s.length,l=o+a;if(l>=i)return s.interpolateAlongEdge(Jm(o,l,i),n);o=l}return this.children[this.children.length-1].interpolateAlongEdge(1,n)}uninterpolateAlongEdge(e,n){const r=this.getLength(n);let i=null,o=1/0,s=0;for(const c of this.children){if(c.isExcludedByFilter(n))continue;const d=c.getLength(n),u=s+d,p=c.distanceToPoint(e,!1,n);p<o&&(o=p,i={startLength:s,endLength:u,child:c}),s=u}Ge(i);const a=i.child.uninterpolateAlongEdge(e,n);return St(i.startLength,i.endLength,a)/r}transform(e){return new Zo({children:this.children.map(n=>n.transform(e)),isLabel:this.isLabel,debugColor:this.debugColor,ignore:this.ignore})}getArea(){return this.children[0].area}toSimpleSvgPath(){let e="";for(const r of this.children)e+=r.toSimpleSvgPath();const n=pe.FromPoints(this.boundsVertices).corners;for(let r=0,i=n.length;r<i;r++){const o=n[r],s=n[(r-1+i)%i],a=o.dist(s),l=n[(r+1)%i],c=o.dist(l),d=o.clone().lrp(s,4/a),u=o,p=o.clone().lrp(l,4/c);e+=`M${d.x},${d.y} L${u.x},${u.y} L${p.x},${p.y} `}return e}getLength(e){let n=0;for(const r of this.children)r.isExcludedByFilter(e)||(n+=r.length);return n}getSvgPathData(){return this.children.map((e,n)=>e.isLabel?"":e.getSvgPathData(n===0)).join(" ")}overlapsPolygon(e){return this.children.some(n=>n.overlapsPolygon(e))}}class cf extends Gu{_start;_end;_d;_u;_ul;constructor(e){super({...e,isClosed:!1,isFilled:!1});const{start:n,end:r}=e;this._start=n,this._end=r,this._d=n.clone().sub(r),this._u=this._d.clone().uni(),this._ul=this._u.len()}getLength(){return this._d.len()}getVertices(){return[this._start,this._end]}nearestPoint(e){const{_start:n,_end:r,_d:i,_u:o,_ul:s}=this;if(i.len()===0||s===0)return n;const a=T.Sub(e,n).dpr(o)/s,l=n.x+o.x*a;if(l<Math.min(n.x,r.x))return n.x<r.x?n:r;if(l>Math.max(n.x,r.x))return n.x>r.x?n:r;const c=n.y+o.y*a;return c<Math.min(n.y,r.y)?n.y<r.y?n:r:c>Math.max(n.y,r.y)?n.y>r.y?n:r:new T(l,c)}getSvgPathData(e=!0){const{_start:n,_end:r}=this;return`${e?`M${n.toFixed()}`:""} L${r.toFixed()}`}}class Zy extends Gu{_points;_segments;constructor(e){super({isClosed:!1,isFilled:!1,...e});const{points:n}=e;if(this._points=n,n.length<2)throw new Error("Polyline2d: points must be an array of at least 2 points")}get segments(){if(!this._segments){this._segments=[];const{vertices:e}=this;for(let n=0,r=e.length-1;n<r;n++){const i=e[n],o=e[n+1];this._segments.push(new cf({start:i,end:o}))}this.isClosed&&this._segments.push(new cf({start:e[e.length-1],end:e[0]}))}return this._segments}getLength(){return this.segments.reduce((e,n)=>e+n.length,0)}getVertices(){return this._points}nearestPoint(e){const{segments:n}=this;let r=this._points[0],i=1/0,o,s;for(let a=0;a<n.length;a++)o=n[a].nearestPoint(e),s=T.Dist2(o,e),s<i&&(r=o,i=s);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(e,n,r=0){const{segments:i}=this;for(let o=0,s=i.length;o<s;o++)if(i[o].hitTestLineSegment(e,n,r))return!0;return!1}getSvgPathData(){const{vertices:e}=this;return e.length<2?"":e.reduce((n,r,i)=>i===0?`M ${r.x} ${r.y}`:`${n} L ${r.x} ${r.y}`,"")}}class ry extends Zy{constructor(e){if(super({...e}),this.isClosed=!0,e.points.length<3)throw new Error("Polygon2d: points must be an array of at least 3 points")}}class Cl extends ry{_x;_y;_w;_h;constructor(e){const{x:n=0,y:r=0,width:i,height:o}=e;super({...e,points:[new T(n,r),new T(n+i,r),new T(n+i,r+o),new T(n,r+o)]}),this._x=n,this._y=r,this._w=i,this._h=o}getBounds(){return new pe(this._x,this._y,this._w,this._h)}getSvgPathData(){const{_x:e,_y:n,_w:r,_h:i}=this;return this.negativeZeroFix(),`M${e},${n} h${r} v${i} h${-r}z`}negativeZeroFix(){this._x=$x(this._x),this._y=$x(this._y),this._w=$x(this._w),this._h=$x(this._h)}}function $x(t){return Object.is(t,-0)?0:t}class Yu{constructor(e){this.editor=e}static configure(e){return class extends this{options={...this.options,...e}}}options={};static props;static migrations;static type;getFontFaces(e){return ur}canSnap(e){return!0}canTabTo(e){return!0}canScroll(e){return!1}canBind(e){return!0}canEdit(e){return!1}canResize(e){return!0}canResizeChildren(e){return!0}canEditInReadonly(e){return!1}canCrop(e){return!1}canBeLaidOut(e,n){return!0}canCull(e){return!0}providesBackgroundForChildren(e){return!1}hideResizeHandles(e){return!1}hideRotateHandle(e){return!1}hideSelectionBoundsBg(e){return!1}hideSelectionBoundsFg(e){return!1}isAspectRatioLocked(e){return!1}isExportBoundsContainer(e){return!1}canReceiveNewChildrenOfType(e,n){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(e){return{}}getHandleSnapGeometry(e){return{}}getText(e){}getAriaDescriptor(e){}}function k8(t,e,n={}){const{closed:r=!1,snap:i=1,start:o="outset",end:s="outset",lengthRatio:a=2,style:l="dashed",forceSolid:c=!1}=n;let d=0,u=0,p=1,f=0,y=0;if(c)return{strokeDasharray:"none",strokeDashoffset:"none"};switch(l){case"dashed":{p=1,d=Math.min(e*a,t/4);break}case"dotted":{p=100,d=e/p;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(o==="outset"?(t+=d/2,y+=d/2):o==="skip"&&(t-=d,y-=d),s==="outset"?t+=d/2:s==="skip"&&(t-=d)),u=Math.floor(t/d/(2*p)),u-=u%i,u<3&&l==="dashed"?t/e<4?(d=t,u=1,f=0):(d=t*(1/3),f=t*(1/3)):(d=t/u/(2*p),r?(y=d/2,f=(t-u*d)/u):f=(t-u*d)/Math.max(1,u-1)),{strokeDasharray:[d,f].join(" "),strokeDashoffset:y.toString()}}function e4({bounds:t,className:e}){const n=ne(),r=J("zoom level",()=>n.getZoomLevel(),[n]);return g.jsx("g",{className:e,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:t.sides.map((i,o)=>{const{strokeDasharray:s,strokeDashoffset:a}=k8(i[0].dist(i[1]),1/r,{style:"dashed",lengthRatio:4});return g.jsx("line",{x1:i[0].x,y1:i[0].y,x2:i[1].x,y2:i[1].y,strokeDasharray:s,strokeDashoffset:a},o)})})}class Mue extends Yu{static type="group";static props=$U;static migrations=NU;hideSelectionBoundsFg(){return!0}canBind(){return!1}canResize(){return!0}canResizeChildren(){return!0}getDefaultProps(){return{}}getGeometry(e){const n=this.editor.getSortedChildIdsForParent(e.id);return n.length===0?new Cl({width:1,height:1,isFilled:!1}):new Zo({children:n.map(r=>{const i=this.editor.getShape(r);return this.editor.getShapeGeometry(r).transform(this.editor.getShapeLocalTransform(i),{isLabel:!1})})})}component(e){const n=this.editor.getErasingShapeIds().includes(e.id),{hintingShapeIds:r}=this.editor.getCurrentPageState(),i=r.length>0&&r.some(a=>a!==e.id&&this.editor.isShapeOfType(this.editor.getShape(a),"group")),o=this.editor.getCurrentPageState().focusedGroupId!==e.id;if(!n&&(o||i))return null;const s=this.editor.getShapeGeometry(e).bounds;return g.jsx(_l,{children:g.jsx(e4,{className:"tl-group",bounds:s})})}indicator(e){const n=this.editor.getShapeGeometry(e).bounds;return g.jsx(e4,{className:"",bounds:n})}onChildrenChange(e){const n=this.editor.getSortedChildIdsForParent(e.id);if(n.length===0){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([e.id]);return}else if(n.length===1){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(n,e.parentId),this.editor.deleteShapes([e.id]);return}}}const I8=[Mue],Oue=new Set(I8.map(t=>t.type));function _8(t){const e=[...I8],n=new Set;for(const r of t){if(Oue.has(r.type))throw new Error(`Shape type "${r.type}" is a core shapes type and cannot be overridden`);if(n.has(r.type))throw new Error(`Shape type "${r.type}" is defined more than once`);e.push(r),n.add(r.type)}return e}var _h=JB();const Due=ua(_h);function C8(t,e){const n=new Map;return async function(i){const o=n.get(i);if(o)return o;const s=(async()=>{try{const a=await gc(i,e);return Ge(a.ok),await t(a)}catch(a){return console.error(a),null}})();return n.set(i,s),s}}const o0=C8(async t=>await Si.blobToDataUrl(await t.blob())),jue=/@import\s+(?:"([^"]+)"|'([^']+)'|url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\))([^;]+);/gi,Rue=/@font-face\s*{([^}]+)}/gi,P8=/url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\)/gi,$ue=/(?:^|;)\s*font-family\s*:\s*(?:([^'"][^;\n]+)|"([^"]+)"|'([^']+)')\s*(?:;|$)/gi;function Nue(t){return Array.from(t.matchAll(jue),e=>({url:e[1]||e[2]||e[3]||e[4]||e[5],extras:e[6]}))}function T8(t,e){return Array.from(t.matchAll(Rue),n=>{const r=n[1],i=Array.from(r.matchAll(P8),s=>{const a=s[1]||s[2]||s[3];return{original:a,resolved:ht(a,e)?.href??null}}),o=new Set(Array.from(r.matchAll($ue),s=>(s[1]||s[2]||s[3]).toLowerCase()));return{fontFace:r,urls:i,fontFamilies:o}})}function Lue(t){const e=/\s*(?:([^'"][^;\n\s,]+)|"([^"]+)"|'([^']+)')\s*/gi,n=/\s*,\s*/gi,r=new Set;for(;;){const i=e.exec(t);if(!i)break;const o=i[1]||i[2]||i[3];if(r.add(o.toLowerCase()),n.lastIndex=e.lastIndex,!n.exec(t))break;e.lastIndex=n.lastIndex}return r}function E8(t){return!(t.startsWith("-")||t.startsWith("animation")||t.startsWith("transition")||t==="cursor"||t==="pointer-events"||t==="user-select"||t==="touch-action")}function zue(t,e){return{imports:Nue(t),fontFaces:T8(t,e)}}function Fue(t){return Array.from(t.matchAll(P8),e=>({original:e[0],url:e[1]||e[2]||e[3]}))}var Bue=Object.create,A8=Object.defineProperty,Uue=Object.getOwnPropertyDescriptor,Hue=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),M8=t=>{throw TypeError(t)},O8=(t,e,n)=>e in t?A8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Wue=t=>[,,,Bue(null)],D8=["class","method","getter","setter","accessor","field","value","get","set"],j8=t=>t!==void 0&&typeof t!="function"?M8("Function expected"):t,Vue=(t,e,n,r,i)=>({kind:D8[t],name:e,metadata:r,addInitializer:o=>n._?M8("Already initialized"):i.push(j8(o||null))}),Kue=(t,e)=>O8(e,Hue("metadata"),t[3]),que=(t,e,n,r)=>{for(var i=0,o=t[e>>1],s=o&&o.length;i<s;i++)o[i].call(n);return r},Gue=(t,e,n,r,i,o)=>{for(var s,a,l,c,d=e&7,u=!1,p=!1,f=2,y=D8[d+5],v=t[f]||(t[f]=[]),x=(i=i.prototype,Uue(i,n)),b=r.length-1;b>=0;b--)l=Vue(d,n,a={},t[3],v),l.static=u,l.private=p,c=l.access={has:w=>n in w},c.get=w=>w[n],s=(0,r[b])(x[y],l),a._=1,j8(s)&&(x[y]=s);return x&&A8(i,n,x),i},Nx=(t,e,n)=>O8(t,typeof e!="symbol"?e+"":e,n),R8,s0;const $8="tldraw-svg-export";R8=[qo];class sA{constructor(){que(s0,5,this),Nx(this,"fontFacesPromise",null),Nx(this,"foundFontNames",new Set),Nx(this,"fontFacesToEmbed",new Set),Nx(this,"pendingPromises",[])}startFindingCurrentDocumentFontFaces(){Ge(!this.fontFacesPromise,"FontEmbedder already started"),this.fontFacesPromise=Yue()}onFontFamilyValue(e){Ge(this.fontFacesPromise,"FontEmbedder not started");const n=Lue(e);for(const r of n){if(this.foundFontNames.has(r))return;this.foundFontNames.add(r),this.pendingPromises.push(this.fontFacesPromise.then(i=>{const o=i.filter(s=>s.fontFamilies.has(r));for(const s of o)if(!this.fontFacesToEmbed.has(s)){this.fontFacesToEmbed.add(s);for(const a of s.urls)!a.resolved||a.embedded||(a.embedded=o0(a.resolved))}}))}}async createCss(){await Promise.all(this.pendingPromises);let e="";for(const n of this.fontFacesToEmbed){let r=`@font-face {${n.fontFace}}`;for(const i of n.urls){if(!i.embedded)continue;const o=await i.embedded;o&&(r=r.replace(i.original,o))}e+=r}return e}}s0=Wue();Gue(s0,1,"onFontFamilyValue",R8,sA);Kue(s0,sA);async function Yue(){const t=[],e=Array.from(document.styleSheets).filter(n=>!n.ownerNode?.closest(`.${$8}`));for(const n of e){let r;try{r=n.cssRules}catch{}if(r){for(const i of n.cssRules)if(i instanceof CSSFontFaceRule)t.push(T8(i.cssText,n.href??document.baseURI));else if(i instanceof CSSImportRule){const o=new URL(i.href,i.parentStyleSheet?.href??document.baseURI);t.push(_T(o.href))}}else n.href&&t.push(_T(n.href))}return ut(await Promise.all(t)).flat()}const _T=C8(async t=>{const e=zue(await t.text(),t.url),n=await Promise.all(e.imports.map(({url:r})=>_T(new URL(r,t.url).href)));return[...e.fontFaces,...ut(n).flat()]}),ds=(t,e,{currentColor:n})=>t==="currentColor"||t===n,jt=(t,e,{parentStyles:n})=>n[e]===t,Jn=t=>(e,n,{getStyle:r})=>{const i=r(`border-${t}-width`),o=r(`border-${t}-style`);return i==="0px"||o==="none"},N8={"border-block-end-color":ds,"border-block-start-color":ds,"border-bottom-color":ds,"border-inline-end-color":ds,"border-inline-start-color":ds,"border-left-color":ds,"border-right-color":ds,"border-top-color":ds,"caret-color":ds,"column-rule-color":ds,"outline-color":ds,"text-decoration":(t,e,{currentColor:n})=>t==="none solid currentColor"||t==="none solid "+n,"text-decoration-color":ds,"text-emphasis-color":ds,"border-collapse":jt,"border-spacing":jt,"caption-side":jt,cursor:jt,direction:jt,"empty-cells":jt,"font-family":jt,"font-size":jt,"font-style":jt,"font-variant":jt,"font-weight":jt,"font-size-adjust":jt,"font-stretch":jt,font:jt,"letter-spacing":jt,"line-height":jt,"list-style-image":jt,"list-style-position":jt,"list-style-type":jt,"list-style":jt,orphans:jt,"overflow-wrap":jt,quotes:jt,"stroke-linecap":jt,"stroke-linejoin":jt,"tab-size":jt,"text-align":jt,"text-align-last":jt,"text-indent":jt,"text-justify":jt,"text-shadow":jt,"text-transform":jt,visibility:jt,"white-space":jt,"white-space-collapse":jt,widows:jt,"word-break":jt,"word-spacing":jt,"word-wrap":jt,"border-top":Jn("top"),"border-right":Jn("right"),"border-bottom":Jn("bottom"),"border-left":Jn("left"),"border-block-end":Jn("block-end"),"border-block-start":Jn("block-start"),"border-inline-end":Jn("inline-end"),"border-inline-start":Jn("inline-start"),"border-top-style":Jn("top"),"border-right-style":Jn("right"),"border-bottom-style":Jn("bottom"),"border-left-style":Jn("left"),"border-block-end-style":Jn("block-end"),"border-block-start-style":Jn("block-start"),"border-inline-end-style":Jn("inline-end"),"border-inline-start-style":Jn("inline-start"),"border-top-width":Jn("top"),"border-right-width":Jn("right"),"border-bottom-width":Jn("bottom"),"border-left-width":Jn("left"),"border-block-end-width":Jn("block-end"),"border-block-start-width":Jn("block-start"),"border-inline-end-width":Jn("inline-end")};function L8(t){if(t.shadowRoot)return t.shadowRoot.childNodes;if(Que(t)){const e=t.assignedNodes();if(e?.length)return e}return t.childNodes}function*CT(t){for(const e of L8(t))Xue(e)&&(yield e)}function a0(t){return t.ownerDocument?.defaultView??globalThis}function Xue(t){return t instanceof a0(t).Element}function Zue(t){return t instanceof a0(t).ShadowRoot}function Jue(t){return"getRootNode"in t&&Zue(t.getRootNode())}function Que(t){return Jue(t)&&t instanceof a0(t).HTMLSlotElement}function ede(t){return t.style}function aA(t,e){return a0(t).getComputedStyle(t,e)}const uf={};class tde{constructor(e){this.root=e}styles=new Map;fonts=new sA;readRootElementStyles(e){this.readElementStyles(e,{shouldRespectDefaults:!1,shouldSkipInheritedParentStyles:!1});const n=Array.from(CT(e));for(;n.length;){const r=n.pop();n.push(...CT(r)),this.readElementStyles(r,{shouldRespectDefaults:!0,shouldSkipInheritedParentStyles:!0})}}readElementStyles(e,{shouldRespectDefaults:n=!0,shouldSkipInheritedParentStyles:r=!0}){const i=n?ode(e.tagName.toLowerCase()):uf,o=Object.assign({},uf);if(r){let a=e.parentElement;for(;a;){const l=this.styles.get(a)?.self;for(const c in l)o[c]||(o[c]=l[c]);a=a.parentElement}}const s={self:nde(e,{defaultStyles:i,parentStyles:o}),before:t4(e,"::before"),after:t4(e,"::after")};this.styles.set(e,s)}fetchResources(){const e=[];for(const n of this.styles.values())for(const r of ar(n))if(r)for(const[i,o]of Object.entries(r)){if(!o)continue;i==="font-family"&&this.fonts.onFontFamilyValue(o);const s=Fue(o);s.length!==0&&e.push(...s.map(async({url:a,original:l})=>{const c=await o0(a)??"data:";r[i]=o.replace(l,`url("${c}")`)}))}return Promise.all(e)}unwrapCustomElements(){const e=new Set,n=(r,i)=>{if(e.has(r))return;e.add(r);const o=r.shadowRoot;if(o){const s=document.createElement("div");this.styles.set(s,this.styles.get(r)),s.setAttribute("data-tl-custom-element",r.tagName),(i??r.parentElement).appendChild(s);for(const a of o.childNodes)a instanceof Element?n(a,s):s.appendChild(a.cloneNode(!0));r.remove()}else if(i){if(r.tagName.toLowerCase()==="style")return;const s=r.cloneNode(!1);this.styles.set(s,this.styles.get(r)),i.appendChild(s);for(const a of L8(r))a instanceof Element?n(a,s):s.appendChild(a.cloneNode(!0))}};for(const r of this.styles.keys())n(r,null)}embedStyles(){let e="";for(const[n,r]of this.styles){if(r.after||r.before){const o=`pseudo-${Qt()}`;n.classList.add(o),r.before&&(e+=`.${o}::before {${n4(r.before)}}
`),r.after&&(e+=`.${o}::after {${n4(r.after)}}
`)}const i=ede(n);for(const[o,s]of Object.entries(r.self))s&&i.setProperty(o,s);i.fontKerning==="auto"&&(i.fontKerning="normal")}return e}async getFontFaceCss(){return await this.fonts.createCss()}dispose(){ide()}}function nde(t,{defaultStyles:e,parentStyles:n}){return t.computedStyleMap?z8(t.computedStyleMap(),{defaultStyles:e,parentStyles:n}):lA(aA(t),{defaultStyles:e,parentStyles:n})}function t4(t,e){const n=aA(t,e),r=n.getPropertyValue("content");if(!(r===""||r==="none"))return lA(n,{defaultStyles:uf,parentStyles:uf})}function z8(t,{defaultStyles:e,parentStyles:n}){const r={},o={currentColor:t.get("color")?.toString()||"",parentStyles:n,defaultStyles:e,getStyle:s=>t.get(s)?.toString()??""};for(const s of t.keys()){if(!E8(s))continue;const a=t.get(s).toString();if(e[s]===a)continue;const l=wr(N8,s);l&&l(a,s,o)||(r[s]=a)}return r}function lA(t,{defaultStyles:e,parentStyles:n}){const r={},o={currentColor:t.color,parentStyles:n,defaultStyles:e,getStyle:s=>t.getPropertyValue(s)};for(const s in t){if(!E8(s))continue;const a=t.getPropertyValue(s);if(e[s]===a)continue;const l=wr(N8,s);l&&l(a,s,o)||(r[s]=a)}return r}function n4(t){let e="";for(const[n,r]of Object.entries(t))e+=`${n}: ${r};`;return e}let qp;const r4={};function rde(){if(!qp){const t=document.createElement("iframe");t.style.display="none",document.body.appendChild(t);const e=Gr(t.contentDocument,"frame must have a document"),n=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");n.appendChild(r),e.body.appendChild(n),qp={iframe:t,foreignObject:r,document:e}}return qp}function ide(){qp&&(document.body.removeChild(qp.iframe),qp=void 0)}const i4={defaultStyles:uf,parentStyles:uf};function ode(t){let e=r4[t];if(!e){const{foreignObject:n,document:r}=rde(),i=r.createElement(t);n.appendChild(i),e=i.computedStyleMap?z8(i.computedStyleMap(),i4):lA(aA(i),i4),n.removeChild(i),r4[t]=e}return e}function sde(t,e){Array.from(t.attributes).forEach(r=>{e.setAttribute(r.name,r.value)})}function o4(t,e){return t.replaceWith(e),e}async function Om(t,e){const n=document.createElement("img");e&&sde(e,n),n.setAttribute("src",t??"data:"),n.setAttribute("decoding","sync"),n.setAttribute("loading","eager");try{await n.decode()}catch{}return n}async function ade(t){try{const e=t.toDataURL();return await Om(e,t)}catch{return await Om(null,t)}}async function lde(t){try{const e=await vs.getVideoFrameAsDataUrl(t);return Om(e,t)}catch(e){console.error("Could not get video frame",e)}if(t.poster){const e=await o0(t.poster);return Om(e,t)}return Om(null,t)}async function F8(t){if(t instanceof HTMLCanvasElement)return o4(t,await ade(t));if(t instanceof HTMLVideoElement)return o4(t,await lde(t));if(t instanceof HTMLImageElement){const e=t.currentSrc||t.src,n=await o0(e);t.setAttribute("src",n??"data:"),t.setAttribute("decoding","sync"),t.setAttribute("loading","eager");try{await t.decode()}catch{}return t}else t instanceof HTMLInputElement?t.setAttribute("value",t.value):t instanceof HTMLTextAreaElement&&(t.textContent=t.value);await Promise.all(Array.from(CT(t),e=>F8(e)))}const PT=(t,e)=>t.props===e.props&&t.meta===e.meta,B8=I.memo(function({id:e,shape:n,util:r,index:i,backgroundIndex:o,opacity:s}){const a=ne(),{ShapeErrorFallback:l,ShapeWrapper:c}=gn(),d=I.useRef(null),u=I.useRef(null);I.useEffect(()=>mo("load fonts",()=>{const y=a.fonts.getShapeFontFaces(e);a.fonts.requestFonts(y)}),[a,e]);const p=I.useRef({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});Yd("set shape stuff",()=>{const y=a.getShape(e);if(!y)return;const v=p.current,x=a.getShapeClipPath(e)??"none";x!==v.clipPath&&(Li(d.current,"clip-path",x),Li(u.current,"clip-path",x),v.clipPath=x);const b=a.getShapePageTransform(e),w=xe.toCssString(b),_=a.getShapeGeometry(y).bounds;w!==v.transform&&(Li(d.current,"transform",w),Li(u.current,"transform",w),v.transform=w);const C=Math.max(_.width,1),A=Math.max(_.height,1);(C!==v.width||A!==v.height)&&(Li(d.current,"width",C+"px"),Li(d.current,"height",A+"px"),Li(u.current,"width",C+"px"),Li(u.current,"height",A+"px"),v.width=C,v.height=A)},[a]),I.useLayoutEffect(()=>{const y=d.current,v=u.current;Li(y,"opacity",s),Li(v,"opacity",s),Li(y,"z-index",i),Li(v,"z-index",o)},[s,i,o]),Yd("set display",()=>{if(!a.getShape(e))return;const x=a.getCulledShapes().has(e);x!==p.current.isCulled&&(Li(d.current,"display",x?"none":"block"),Li(u.current,"display",x?"none":"block"),p.current.isCulled=x)},[a]);const f=I.useCallback(y=>a.annotateError(y,{origin:"shape",willCrashApp:!1}),[a]);return!n||!c?null:g.jsxs(g.Fragment,{children:[r.backgroundComponent&&g.jsx(c,{ref:u,shape:n,isBackground:!0,children:g.jsx(ny,{fallback:l,onError:f,children:g.jsx(H8,{shape:n,util:r})})}),g.jsx(c,{ref:d,shape:n,isBackground:!1,children:g.jsx(ny,{fallback:l,onError:f,children:g.jsx(U8,{shape:n,util:r})})})]})}),U8=I.memo(function({shape:e,util:n}){return Hw("InnerShape:"+e.type,()=>n.component(n.editor.store.unsafeGetWithoutCapture(e.id)),[n,e.id])},(t,e)=>PT(t.shape,e.shape)&&t.util===e.util),H8=I.memo(function({shape:e,util:n}){return Hw("InnerShape:"+e.type,()=>n.backgroundComponent?.(n.editor.store.unsafeGetWithoutCapture(e.id)),[n,e.id])},(t,e)=>t.shape.props===e.shape.props&&t.shape.meta===e.shape.meta&&t.util===e.util);function pl(t){const e=I.useRef();return I.useLayoutEffect(()=>{e.current=t}),I.useDebugValue(t),I.useCallback((...n)=>{const r=e.current;return Ge(r,"fn does not exist"),r(...n)},[])}const cA=I.createContext(null);function cde({context:t,editor:e,children:n}){const r=e.options.exportProvider;return g.jsx(eA,{editor:e,children:g.jsx(n8,{container:e.getContainer(),children:g.jsx(cA.Provider,{value:t,children:g.jsx(r,{children:n})})})})}function Jy(){return I.useContext(cA)}function ude(){const t=I.useContext(cA),[e]=I.useState(l2);return I.useEffect(()=>(t?.waitUntil(e),()=>{e.resolve()}),[e,t]),pl(()=>{e.resolve()})}var dde=Object.create,W8=Object.defineProperty,hde=Object.getOwnPropertyDescriptor,pde=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),V8=t=>{throw TypeError(t)},K8=(t,e,n)=>e in t?W8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,fde=t=>[,,,dde(null)],q8=["class","method","getter","setter","accessor","field","value","get","set"],G8=t=>t!==void 0&&typeof t!="function"?V8("Function expected"):t,gde=(t,e,n,r,i)=>({kind:q8[t],name:e,metadata:r,addInitializer:o=>n._?V8("Already initialized"):i.push(G8(o||null))}),mde=(t,e)=>K8(e,pde("metadata"),t[3]),yde=(t,e,n,r)=>{for(var i=0,o=t[e>>1],s=o&&o.length;i<s;i++)o[i].call(n);return r},vde=(t,e,n,r,i,o)=>{for(var s,a,l,c,d=e&7,u=!1,p=!1,f=2,y=q8[d+5],v=t[f]||(t[f]=[]),x=(i=i.prototype,hde(i,n)),b=r.length-1;b>=0;b--)l=gde(d,n,a={},t[3],v),l.static=u,l.private=p,c=l.access={has:w=>n in w},c.get=w=>w[n],s=(0,r[b])(x[y],l),a._=1,G8(s)&&(x[y]=s);return x&&W8(i,n,x),i},s4=(t,e,n)=>K8(t,typeof e!="symbol"?e+"":e,n),Y8,l0;Y8=[qo];class uA{constructor(e){this.maxDelayTimeMs=e,yde(l0,5,this),s4(this,"isResolved",!1),s4(this,"promisesToWaitFor",[])}waitUntil(e){if(this.isResolved)throw new Error("Cannot `waitUntil` - the export has already been resolved. Make sure to call `waitUntil` as soon as possible during an export - ie within the first react effect after rendering.");this.promisesToWaitFor.push(e.catch(n=>console.error("Error while waiting for export:",n)))}async resolvePromises(){let e=null;for(;this.promisesToWaitFor.length!==e;)e=this.promisesToWaitFor.length,await Promise.allSettled(this.promisesToWaitFor),await uT(0)}async resolve(){const e=uT(this.maxDelayTimeMs).then(()=>"timeout"),n=this.resolvePromises().then(()=>"resolved");await Promise.race([e,n])==="timeout"&&console.warn("[tldraw] Export delay timed out after ${this.maxDelayTimeMs}ms"),this.isResolved=!0}}l0=fde();vde(l0,1,"waitUntil",Y8,uA);mde(l0,uA);function xde(t,e,n={}){if(!window.document)throw Error("No document");const{scale:r=1,background:i=t.getInstanceState().exportBackground,padding:o=t.options.defaultSvgPadding,preserveAspectRatio:s}=n,a=n.darkMode??t.user.getIsDarkMode(),l=t.getShapeAndDescendantIds(e),c=t.getUnorderedRenderingShapes(!1).filter(({id:b})=>l.has(b)),d=e.length===1&&t.isShapeOfType(t.getShape(e[0]),"frame")?e[0]:null;let u=null;if(n.bounds?u=n.bounds.clone().expandBy(o):u=Sde(t,c,o,d),!u)return;const p=u.width*r,f=u.height*r;try{document.body.focus?.()}catch{}const y=new uA(t.options.maxExportDelayMs),v=l2();return y.waitUntil(v),{jsx:g.jsx(bde,{editor:t,preserveAspectRatio:s,scale:r,pixelRatio:n.pixelRatio??null,bbox:u,background:i,singleFrameShapeId:d,isDarkMode:a,renderingShapes:c,onMount:v.resolve,waitUntil:y.waitUntil}),width:p,height:f,exportDelay:y}}function Sde(t,e,n,r){let i=!1,o=null;for(const{id:s}of e){const a=t.getShapeMaskedPageBounds(s);if(!a)continue;const l=t.getShape(s),c=t.getShapeUtil(l).isExportBoundsContainer(l);o?c&&pe.ContainsApproximately(a,o)?(i=!0,o=a.clone()):(i&&!pe.ContainsApproximately(o,a)&&(i=!1),o.union(a)):(i=c,o=a.clone())}return o?(!r&&!i&&o.expandBy(n),o):null}function bde({editor:t,preserveAspectRatio:e,scale:n,pixelRatio:r,bbox:i,background:o,singleFrameShapeId:s,isDarkMode:a,renderingShapes:l,onMount:c,waitUntil:d}){const u=Ih(),p=Ku({isDarkMode:a}),f=Hy("export state",{defsById:{},shapeElements:null}),{defsById:y,shapeElements:v}=J(f),x=pl(C=>{f.update(A=>{if(sa(A.defsById,C.key))return A;const E=Promise.resolve(C.getElement());return d(E.then(O=>{f.update(D=>({...D,defsById:{...D.defsById,[C.key]:{pending:!1,element:O}}}))})),{...A,defsById:{...A.defsById,[C.key]:{pending:!0,element:E}}}})}),b=I.useMemo(()=>({isDarkMode:a,waitUntil:d,addExportDef:x,scale:n,pixelRatio:r,async resolveAssetUrl(C,A){const E=t.getAsset(C);return!E||E.type!=="image"&&E.type!=="video"?null:await t.resolveAssetUrl(C,{screenScale:n*(A/E.props.w),shouldResolveToOriginal:r===null,dpr:r??void 0})}}),[a,d,x,n,r,t]),w=I.useRef(!1);I.useLayoutEffect(()=>{if(w.current)throw new Error("SvgExport should only render once - do not use with react strict mode");w.current=!0,(async()=>{const C={},A=l.map(async({id:O,opacity:D,index:B,backgroundIndex:L})=>{if(O===s)return[];const j=t.getShape(O);if(t.isShapeOfType(j,"group"))return[];const F=[],z=t.getShapeUtil(j);if(z.toSvg||z.toBackgroundSvg){const[$,V]=await Promise.all([z.toSvg?.(j,b),z.toBackgroundSvg?.(j,b)]),Y=t.getShapePageTransform(j);let re=Y.toCssString(),q=1;"scale"in j.props&&j.props.scale!==1&&(q=j.props.scale,re=`${re} scale(${j.props.scale}, ${j.props.scale})`);const X=t.getShapeMask(j.id),N=X?xe.From(xe.Inverse(Y)).applyToPoints(X):null,H=J2(u,j.id);N&&(C[H]={pending:!1,element:g.jsx("clipPath",{id:H,children:g.jsx("path",{d:`M${N.map(({x:ie,y:U})=>`${ie/q},${U/q}`).join("L")}Z`})})}),$&&F.push({zIndex:B,element:g.jsx("g",{transform:re,opacity:D,clipPath:X?`url(#${H})`:void 0,children:$},`fg_${j.id}`)}),V&&F.push({zIndex:L,element:g.jsx("g",{transform:re,opacity:D,clipPath:X?`url(#${H})`:void 0,children:V},`bg_${j.id}`)})}else F.push({zIndex:B,element:g.jsx(a4,{shape:j,util:z,component:U8,className:"tl-shape",bbox:i,opacity:D},`fg_${j.id}`)}),z.backgroundComponent&&F.push({zIndex:L,element:g.jsx(a4,{shape:j,util:z,component:H8,className:"tl-shape tl-shape-background",bbox:i,opacity:D},`bg_${j.id}`)});return F}),E=(await Promise.all(A)).flat();_h.flushSync(()=>{f.update(O=>({...O,shapeElements:E.sort((D,B)=>D.zIndex-B.zIndex).map(({element:D})=>D),defsById:{...O.defsById,...C}}))})})()},[i,t,b,u,l,s,f]),I.useEffect(()=>{const C=new Set;for(const{id:A}of l)for(const E of t.fonts.getShapeFontFaces(A))C.add(E);for(const A of C)x({key:Qt(),getElement:async()=>{const E=await t.fonts.toEmbeddedCssDeclaration(A);return g.jsx("style",{nonce:t.options.nonce,children:E})}})},[t,l,x]),I.useEffect(()=>{v!==null&&c()},[c,v]);let _=o?p.background:"transparent";if(s&&o)if(t.getShapeUtil("frame")?.options.showColors){const A=t.getShape(s);_=Ht(p,A.props.color,"frameFill")}else _=p.solid;return g.jsx(cde,{editor:t,context:b,children:g.jsxs("svg",{preserveAspectRatio:e,direction:"ltr",width:i.width*n,height:i.height*n,viewBox:`${i.minX} ${i.minY} ${i.width} ${i.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:_},"data-color-mode":a?"dark":"light",className:`tl-container tl-theme__force-sRGB ${a?"tl-theme__dark":"tl-theme__light"}`,children:[g.jsx("defs",{children:Object.entries(y).map(([C,A])=>A.pending?null:g.jsx(I.Fragment,{children:A.element},C))}),v]})})}function a4({shape:t,util:e,className:n,component:r,bbox:i,opacity:o}){const s=ne(),a=xe.Translate(-i.minX,-i.minY).multiply(s.getShapePageTransform(t.id)),l=s.getShapeGeometry(t.id).bounds,c=Math.max(l.width,1),d=Math.max(l.height,1);return g.jsx(t0,{fallback:()=>null,children:g.jsx("foreignObject",{x:i.minX,y:i.minY,width:i.w,height:i.h,className:"tl-shape-foreign-object tl-export-embed-styles",children:g.jsx("div",{className:n,"data-shape-type":t.type,style:{clipPath:s.getShapeClipPath(t.id),transform:a.toCssString(),width:c,height:d,opacity:o},children:g.jsx(r,{shape:t,util:e})})})})}let wde=1;async function kde(t,e,n={}){const r=xde(t,e,n);if(!r)return;const i=t.getContainer(),o=document.createElement("div");o.className=$8,o.inert=!0,o.tabIndex=-1,Object.assign(o.style,{position:"absolute",top:"0px",left:"0px",width:r.width+"px",height:r.height+"px",pointerEvents:"none",opacity:0}),i.appendChild(o);const s=QB.createRoot(o,{identifierPrefix:`export_${wde++}_`});try{await Promise.resolve(),_h.flushSync(()=>{s.render(r.jsx)}),await r.exportDelay.resolve();const a=o.firstElementChild;return Ge(a instanceof SVGSVGElement,"Expected an SVG element"),await Ide(a),{svg:a,width:r.width,height:r.height}}finally{setTimeout(()=>{s.unmount(),i.removeChild(o)},0)}}async function Ide(t){const e=[...t.querySelectorAll("foreignObject.tl-export-embed-styles > *")];if(!e.length)return;const n=new tde(t);try{n.fonts.startFindingCurrentDocumentFontFaces(),await Promise.all(e.map(o=>F8(o)));for(const o of e)n.readRootElementStyles(o);await n.fetchResources();const r=await n.getFontFaceCss();n.unwrapCustomElements();const i=n.embedStyles();if(r||i){const o=document.createElementNS("http://www.w3.org/2000/svg","style");o.textContent=`${r}
${i}`,t.prepend(o)}}finally{n.dispose()}}let UC=null;function _de(){return UC||(UC={maxWidth:HC("width"),maxHeight:HC("height"),maxArea:HC("area")}),UC}/*!
 * Extracted from https://github.com/jhildenbiddle/canvas-size
 * MIT License: https://github.com/jhildenbiddle/canvas-size/blob/master/LICENSE
 * Copyright (c) John Hildenbiddle
 */const l4=8192,Cde=4096*4096,Pde={area:[16384,14188,11402,11180,10836,8192,4096],height:[8388607,65535,32767,16384,8192,4096],width:[4194303,65535,32767,16384,8192,4096]};function HC(t){const e=document.createElement("canvas");e.width=1,e.height=1;const n=e.getContext("2d");for(const r of Pde[t]){const i=t==="height"?1:r,o=t==="width"?1:r,s=document.createElement("canvas");s.width=i,s.height=o,s.getContext("2d").fillRect(i-1,o-1,1,1),n.drawImage(s,i-1,o-1,1,1,0,0,1,1);const l=n.getImageData(0,0,1,1).data[3]!==0;if(s.width=0,s.height=0,l)return e.width=0,e.height=0,t==="area"?r*r:r}throw e.width=0,e.height=0,Error("Failed to determine maximum canvas dimension")}function Tde(t,e){if(t<=l4&&e<=l4&&t*e<=Cde)return[t,e];const{maxWidth:n,maxHeight:r,maxArea:i}=_de(),o=t/e;if(t>n&&(t=n,e=t/o),e>r&&(e=r,t=e*o),t*e>i){const s=Math.sqrt(i/(t*e));t*=s,e*=s}return[t,e]}async function Ede(t,e){const{type:n,width:r,height:i,quality:o=1,pixelRatio:s=2}=e;let[a,l]=Tde(r*s,i*s);a=Math.floor(a),l=Math.floor(l);const c=a/r,d=await Si.blobToDataUrl(new Blob([t],{type:"image/svg+xml"})),u=await new Promise(f=>{const y=Zm();y.crossOrigin="anonymous",y.onload=async()=>{Jt.isSafari&&await uT(250);const v=document.createElement("canvas"),x=v.getContext("2d");v.width=a,v.height=l,x.imageSmoothingEnabled=!0,x.imageSmoothingQuality="high",x.drawImage(y,0,0,a,l),URL.revokeObjectURL(d),f(v)},y.onerror=()=>{f(null)},y.src=d});if(!u)return null;const p=await new Promise(f=>u.toBlob(y=>{(!y||Vn.throwToBlob.get())&&f(null),f(y)},"image/"+n,o));if(!p)return null;if(n==="png"){const f=new DataView(await p.arrayBuffer());return fl.setPhysChunk(f,c,{type:"image/"+n})}else return p}const ho={menus:qt("open menus",[]),getOpenMenus(t){return t?this.menus.get().filter(e=>e.endsWith("-"+t)):this.menus.get()},addOpenMenu(t,e=""){const n=e?`${t}-${e}`:t,r=new Set(this.menus.get());r.has(n)||(r.add(n),this.menus.set([...r]))},deleteOpenMenu(t,e=""){const n=e?`${t}-${e}`:t,r=new Set(this.menus.get());r.has(n)&&(r.delete(n),this.menus.set([...r]))},clearOpenMenus(t){this.menus.set(t?this.menus.get().filter(e=>!e.endsWith("-"+t)):[])},_hiddenMenus:[],hideOpenMenus(t){if(this._hiddenMenus=[...this.getOpenMenus(t)],this._hiddenMenus.length!==0)for(const e of this._hiddenMenus)this.deleteOpenMenu(e,t)},showOpenMenus(t){if(this._hiddenMenus.length!==0){for(const e of this._hiddenMenus)this.addOpenMenu(e,t);this._hiddenMenus=[]}},isMenuOpen(t,e){return this.getOpenMenus(e).includes(t)},hasOpenMenus(t){return this.getOpenMenus(t).length>0},hasAnyOpenMenus(){return this.getOpenMenus().length>0},forContext(t){return{getOpenMenus:()=>this.getOpenMenus(t),addOpenMenu:e=>this.addOpenMenu(e,t),deleteOpenMenu:e=>this.deleteOpenMenu(e,t),clearOpenMenus:()=>this.clearOpenMenus(t),isMenuOpen:e=>this.isMenuOpen(e,t),hasOpenMenus:()=>this.hasOpenMenus(t),hasAnyOpenMenus:()=>this.hasAnyOpenMenus()}}},yb=new hse,Ade={maxShapesPerPage:4e3,maxFilesAtOnce:100,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,uiDragDistanceSquared:16,uiCoarseDragDistanceSquared:625,defaultSvgPadding:32,cameraSlideFriction:.09,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16,laserDelayMs:1200,maxExportDelayMs:5e3,tooltipDelayMs:700,temporaryAssetPreviewLifetimeMs:18e4,actionShortcutsLocation:"swap",createTextOnCanvasDoubleClick:!0,exportProvider:I.Fragment,enableToolbarKeyboardShortcuts:!0,maxFontsToLoadBeforeRender:1/0,nonce:void 0};function c4(t,e){if(!e)return!1;switch(t.type){case"mixed":return e.type==="mixed";case"shared":return e.type==="shared"&&t.value===e.value;default:throw Wt(t)}}class Mde{map;constructor(e){this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const n=this.get(e);if(n&&n.type!=="mixed")return n.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const n=new Set;for(const[r,i]of this){if(!c4(i,e.get(r)))return!1;n.add(r)}for(const[r,i]of e)if(!n.has(r)&&!c4(i,this.get(r)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class TT extends Mde{set(e,n){this.map.set(e,n)}applyValue(e,n){const r=this.get(e);if(!r){this.set(e,{type:"shared",value:n});return}switch(r.type){case"mixed":return;case"shared":r.value!==n&&this.set(e,{type:"mixed"});return;default:Wt(r,"type")}}}function Ode(t,e,n){return gc(t).then(function(r){return r.arrayBuffer()}).then(function(r){return new File([r],e,{type:n})})}const Dde="https://cdn.tldraw.com";function Ar(){return`${Dde}/${tA}`}function jde(t){switch(t.type){case"shapes":return`s${t.shapeIds.map(n=>WC(n.slice(6))).join(".")}`;case"page":return"p"+WC(yo.parseId(t.pageId));case"viewport":{const{bounds:e,pageId:n}=t;let r=`v${Math.round(e.x)}.${Math.round(e.y)}.${Math.round(e.w)}.${Math.round(e.h)}`;return n&&(r+="."+WC(yo.parseId(n))),r}default:Wt(t)}}function Rde(t){switch(t[0]){case"s":return{type:"shapes",shapeIds:t.slice(1).split(".").filter(Boolean).map(r=>sn(decodeURIComponent(r)))};case"p":return{type:"page",pageId:yo.createId(decodeURIComponent(t.slice(1)))};case"v":{const[n,r,i,o,s]=t.slice(1).split(".");return{type:"viewport",bounds:new pe(Number(n),Number(r),Number(i),Number(o)),pageId:s?yo.createId(decodeURIComponent(s)):void 0}}default:throw Error("Invalid deep link string")}}function WC(t){return encodeURIComponent(t).replace(/\./g,"%2E")}function $de(t,e){let n=t;const r=new Set(e);for(;r.has(n);)n=/^.*(\d+)$/.exec(n)?.[1]?n.replace(/(\d+)(?=\D?)$/,i=>(+i+1).toString()):`${n} 1`;return n}function Lx(t,e,n,r){if(n.length===0)return[];const i=new Map;for(const s of ut(n.map(a=>t.getShape(a)))){const{parentId:a}=s;i.has(a)||i.set(a,{children:ut(t.getSortedChildIdsForParent(a).map(l=>t.getShape(l))),moving:new Set}),i.get(a).moving.add(s)}const o=[];switch(e){case"toBack":{i.forEach(({moving:s,children:a})=>Nde(s,a,o));break}case"toFront":{i.forEach(({moving:s,children:a})=>Lde(s,a,o));break}case"forward":{i.forEach(({moving:s,children:a})=>zde(t,s,a,o,r));break}case"backward":{i.forEach(({moving:s,children:a})=>Fde(t,s,a,o,r));break}}return o}function Nde(t,e,n){const r=e.length;if(t.size===r)return;let i,o;for(let s=0;s<r;s++){const a=e[s];if(t.has(a))i=a.index,t.delete(a);else{o=a.index;break}}if(t.size!==0){const s=Gd(i,o,t.size);n.push(...Array.from(t.values()).sort(Yr).map((a,l)=>({...a,index:s[l]})))}}function Lde(t,e,n){const r=e.length;if(t.size===r)return;let i,o;for(let s=r-1;s>-1;s--){const a=e[s];if(t.has(a))o=a.index,t.delete(a);else{i=a.index;break}}if(t.size!==0){const s=Gd(i,o,t.size);n.push(...Array.from(t.values()).sort(Yr).map((a,l)=>({...a,index:s[l]})))}}function X8(t,e){const n=ut(Array.from(e).map(i=>{const o=t.getShapePageBounds(i);return o?{shape:i,bounds:o}:null}));return i=>{const o=t.getShapePageBounds(i);return o?n.some(s=>s.bounds.includes(o)):!1}}function zde(t,e,n,r,i){const o=X8(t,e),s=n.length;if(e.size===s)return;let a={name:"skipping"};for(let l=0;l<s;l++){const c=e.has(n[l]);switch(a.name){case"skipping":{if(!c)continue;a={name:"selecting",selectIndex:l};break}case"selecting":{if(c||!i?.considerAllShapes&&!o(n[l]))continue;const{selectIndex:d}=a;Gd(n[l].index,n[l+1]?.index,l-d).forEach((u,p)=>{const f=n[d+p];e.has(f)&&r.push({...f,index:u})}),a={name:"skipping"};break}}}}function Fde(t,e,n,r,i){const o=X8(t,e),s=n.length;if(e.size===s)return;let a={name:"skipping"};for(let l=s-1;l>-1;l--){const c=e.has(n[l]);switch(a.name){case"skipping":{if(!c)continue;a={name:"selecting",selectIndex:l};break}case"selecting":{if(c||!i?.considerAllShapes&&!o(n[l]))continue;Gd(n[l-1]?.index,n[l].index,a.selectIndex-l).forEach((d,u)=>{const p=n[l+u+1];e.has(p)&&r.push({...p,index:d})}),a={name:"skipping"};break}}}}function Z8({editor:t,ids:e}){const n=ut(e.map(s=>t.getShape(s))),r=t.getShapesSharedRotation(e),i=t.getShapesRotatedPageBounds(e);if(!i)return null;const o=i.center.clone().rotWith(i.point,r);return{initialPageCenter:o,initialCursorAngle:o.angle(t.inputs.originPagePoint),initialShapesRotation:r,shapeSnapshots:n.map(s=>({shape:s,initialPagePoint:t.getShapePageTransform(s.id).point()}))}}function LS({delta:t,editor:e,snapshot:n,stage:r,centerOverride:i}){const{initialPageCenter:o,shapeSnapshots:s}=n;e.updateShapes(s.map(({shape:l,initialPagePoint:c})=>{const d=co(l.parentId)?e.getShapePageTransform(l.parentId):xe.Identity(),u=T.RotWith(c,i??o,t),p=xe.applyToPoint(xe.Inverse(d),u),f=hb(l.rotation+t);return{id:l.id,type:l.type,x:p.x,y:p.y,rotation:f}}));const a=[];s.forEach(({shape:l})=>{const c=e.getShape(l.id);if(!c)return;const d=e.getShapeUtil(l);if(r==="start"||r==="one-off"){const p=d.onRotateStart?.(l);p&&a.push(p)}const u=d.onRotate?.(l,c);if(u&&a.push(u),r==="end"||r==="one-off"){const p=d.onRotateEnd?.(l,c);p&&a.push(p)}}),a.length>0&&e.updateShapes(a)}function u4(t){const e=t.get(),n=new Map;for(const r of e){const{fromId:i,toId:o}=r,s=n.get(i);s?s.push(r):n.set(i,[r]);const a=n.get(o);a?a.push(r):n.set(o,[r])}return n}const Bde=t=>{const{store:e}=t,n=e.query.filterHistory("binding"),r=e.query.records("binding");return fe("arrowBindingsIndex",(i,o)=>{if(Fd(i))return u4(r);const s=i,a=n.getDiffSince(o);if(a===bs)return u4(r);let l;function c(p){l??=new Map(s);const y=l.get(p.fromId)?.filter(b=>b.id!==p.id);y?.length?l.set(p.fromId,y):l.delete(p.fromId);const x=l.get(p.toId)?.filter(b=>b.id!==p.id);x?.length?l.set(p.toId,x):l.delete(p.toId)}function d(p){l??=new Map(s);let f=l.get(p);return f?f===s.get(p)&&(f=f.slice(0),l.set(p,f)):(f=[],l.set(p,f)),f}function u(p){d(p.fromId).push(p),d(p.toId).push(p)}for(const p of a){for(const f of ar(p.added))u(f);for(const[f,y]of ar(p.updated))c(f),u(y);for(const f of ar(p.removed))c(f)}return l??s})};function Ude(t){const e=t.getCurrentPageShapeIds(),n=t.getViewportPageBounds(),r=new Set;return e.forEach(i=>{const o=t.getShape(i);if(!o||!t.getShapeUtil(o.type).canCull(o))return;const a=t.getShapePageBounds(i);(a===void 0||!n.includes(a))&&r.add(i)}),r}function Hde(t){return fe("notVisibleShapes",function(n){const r=Ude(t);if(Fd(n)||n.size!==r.size)return r;for(const i of n)if(!r.has(i))return r;return n})}function d4(t,e){const n={},r=t.get(),i=Array(r.size);return r.forEach(o=>i.push(e.get(o))),i.sort(Yr),i.forEach(o=>{n[o.parentId]||(n[o.parentId]=[]),n[o.parentId].push(o.id)}),n}const Wde=t=>{const e=t.query.ids("shape"),n=t.query.filterHistory("shape");return fe("parentsToChildrenWithIndexes",(r,i)=>{if(Fd(r))return d4(e,t);const o=n.getDiffSince(i);if(o===bs)return d4(e,t);if(o.length===0)return r;let s=null;const a=d=>{s||(s={...r}),s[d]?s[d]===r[d]&&(s[d]=[...s[d]]):s[d]=[]},l=new Set;let c;for(let d=0,u=o.length;d<u;d++){c=o[d];for(const p of Object.values(c.added))Lp(p)&&(a(p.parentId),s[p.parentId].push(p.id),l.add(s[p.parentId]));for(const[p,f]of Object.values(c.updated))if(Lp(f)&&Lp(p)){if(p.parentId!==f.parentId)a(p.parentId),a(f.parentId),s[p.parentId].splice(s[p.parentId].indexOf(f.id),1),s[f.parentId].push(f.id),l.add(s[f.parentId]);else if(p.index!==f.index){a(f.parentId);const y=s[f.parentId].indexOf(f.id);s[f.parentId][y]=f.id,l.add(s[f.parentId])}}for(const p of Object.values(c.removed))Lp(p)&&(a(p.parentId),s[p.parentId].splice(s[p.parentId].indexOf(p.id),1))}for(const d of l){const u=ut(d.map(p=>t.get(p)));u.sort(Yr),d.splice(0,d.length,...u.map(p=>p.id))}return s??r})},VC=(t,e,n)=>{for(;!hi(n.parentId);){const r=t.get(n.parentId);if(!r)return!1;n=r}return n.parentId===e},Vde=(t,e)=>{const n=t.query.ids("shape");let r=null;function i(){const o=e();return r=o,new Set([...n.get()].filter(s=>VC(t,o,t.get(s))))}return fe("_shapeIdsInCurrentPage",(o,s)=>{if(Fd(o))return i();const a=e();if(a!==r)return i();const l=t.history.getDiffSince(s);if(l===bs)return i();const c=new jS(o);for(const u of l){for(const p of Object.values(u.added))Lp(p)&&VC(t,a,p)&&c.add(p.id);for(const[p,f]of Object.values(u.updated))Lp(f)&&(VC(t,a,f)?c.add(f.id):c.remove(f.id));for(const p of Object.keys(u.removed))co(p)&&c.remove(p)}const d=c.get();return d?am(d.value,d.diff):o})};var Kde=Object.create,J8=Object.defineProperty,qde=Object.getOwnPropertyDescriptor,Gde=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),Q8=t=>{throw TypeError(t)},e9=(t,e,n)=>e in t?J8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Yde=t=>[,,,Kde(null)],t9=["class","method","getter","setter","accessor","field","value","get","set"],n9=t=>t!==void 0&&typeof t!="function"?Q8("Function expected"):t,Xde=(t,e,n,r,i)=>({kind:t9[t],name:e,metadata:r,addInitializer:o=>n._?Q8("Already initialized"):i.push(n9(o||null))}),Zde=(t,e)=>e9(e,Gde("metadata"),t[3]),Jde=(t,e,n,r)=>{for(var i=0,o=t[e>>1],s=o&&o.length;i<s;i++)o[i].call(n);return r},r9=(t,e,n,r,i,o)=>{for(var s,a,l,c,d=e&7,u=!1,p=!1,f=2,y=t9[d+5],v=t[f]||(t[f]=[]),x=(i=i.prototype,qde(i,n)),b=r.length-1;b>=0;b--)l=Xde(d,n,a={},t[3],v),l.static=u,l.private=p,c=l.access={has:w=>n in w},c.get=w=>w[n],s=(0,r[b])(x[y],l),a._=1,n9(s)&&(x[y]=s);return x&&J8(i,n,x),i},dp=(t,e,n)=>e9(t,typeof e!="symbol"?e+"":e,n),i9,o9,Qy;const Qde=40;o9=[qo],i9=[qo];class c0{constructor(e){this.editor=e,Jde(Qy,5,this),dp(this,"_clickId",""),dp(this,"_clickTimeout"),dp(this,"_clickScreenPoint"),dp(this,"_previousScreenPoint"),dp(this,"_clickState","idle"),dp(this,"lastPointerInfo",{})}_getClickTimeout(e,n=Qt()){this._clickId=n,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout(()=>{if(this._clickState===e&&this._clickId===n){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},e==="idle"||e==="pendingDouble"?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)}get clickState(){return this._clickState}handlePointerEvent(e){switch(e.name){case"pointer_down":{if(!this._clickState)return e;switch(this._clickScreenPoint=T.From(e.point),this._previousScreenPoint&&T.Dist2(this._previousScreenPoint,this._clickScreenPoint)>Qde**2&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"idle":{this._clickState="pendingDouble";break}case"pendingOverflow":{this._clickState="overflow";break}}return this._clickTimeout=this._getClickTimeout(this._clickState),e}case"pointer_up":{if(!this._clickState)return e;switch(this._clickScreenPoint=T.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}return e}case"pointer_move":return this._clickState!=="idle"&&this._clickScreenPoint&&T.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout(),e}return e}cancelDoubleClickTimeout(){this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"}}Qy=Yde();r9(Qy,1,"_getClickTimeout",o9,c0);r9(Qy,1,"cancelDoubleClickTimeout",i9,c0);Zde(Qy,c0);class ehe{constructor(e){this.editor=e}_isEdgeScrolling=!1;_edgeScrollDuration=-1;updateEdgeScrolling(e){const{editor:n}=this,r=this.getEdgeScroll();if(r.x===0&&r.y===0)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=e,this._edgeScrollDuration>n.options.edgeScrollDelay){const i=n.options.edgeScrollEaseDuration>0?Ui.easeInCubic(Math.min(1,this._edgeScrollDuration/(n.options.edgeScrollDelay+n.options.edgeScrollEaseDuration))):1;this.moveCameraWhenCloseToEdge({x:r.x*i,y:r.y*i})}}getEdgeProximityFactors(e,n,r,i,o){const{editor:s}=this,a=s.options.edgeScrollDistance,l=r?s.options.coarsePointerWidth:0,c=e-l,d=e+l,u=i?0:a,p=o?n:n-a;return c<u?Math.min(1,(u-c)/a):d>p?-Math.min(1,(d-p)/a):0}getEdgeScroll(){const{editor:e}=this,{inputs:{currentScreenPoint:{x:n,y:r}}}=e,i=e.getViewportScreenBounds(),{isCoarsePointer:o,insets:[s,a,l,c]}=e.getInstanceState(),d=this.getEdgeProximityFactors(n,i.w,o,c,a),u=this.getEdgeProximityFactors(r,i.h,o,s,l);return{x:d,y:u}}moveCameraWhenCloseToEdge(e){const{editor:n}=this;if(!n.inputs.isDragging||n.inputs.isPanning||n.getCameraOptions().isLocked||e.x===0&&e.y===0)return;const r=n.getViewportScreenBounds(),i=r.w<1e3?.612:1,o=r.h<1e3?.612:1,s=n.getZoomLevel(),a=n.user.getEdgeScrollSpeed()*n.options.edgeScrollSpeed,l=a*e.x*i/s,c=a*e.y*o/s,{x:d,y:u,z:p}=n.getCamera();n.setCamera(new T(d+l,u+c,p))}}class the{constructor(e,n){this.editor=e,this.disposeSideEffectListener=e.sideEffects.registerAfterChangeHandler("instance",(i,o)=>{i.isFocused!==o.isFocused&&this.updateContainerClass()});const r=e.getInstanceState().isFocused;n!==r&&e.updateInstanceState({isFocused:!!n}),this.updateContainerClass(),document.body.addEventListener("keydown",this.handleKeyDown.bind(this)),document.body.addEventListener("mousedown",this.handleMouseDown.bind(this))}disposeSideEffectListener;updateContainerClass(){const e=this.editor.getContainer();this.editor.getInstanceState().isFocused?e.classList.add("tl-container__focused"):e.classList.remove("tl-container__focused"),e.classList.add("tl-container__no-focus-ring")}handleKeyDown(e){const n=this.editor.getContainer(),r=document.activeElement;this.editor.isIn("select.editing_shape")&&!r?.closest(".tlui-contextual-toolbar")||r===n&&this.editor.getSelectedShapeIds().length>0||["Tab","ArrowUp","ArrowDown"].includes(e.key)&&n.classList.remove("tl-container__no-focus-ring")}handleMouseDown(){this.editor.getContainer().classList.add("tl-container__no-focus-ring")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){document.body.removeEventListener("keydown",this.handleKeyDown.bind(this)),document.body.removeEventListener("mousedown",this.handleMouseDown.bind(this)),this.disposeSideEffectListener?.()}}class nhe{constructor(e,n){this.editor=e,this.assetUrls=n,this.shapeFontFacesCache=e.store.createComputedCache("shape font faces",r=>this.editor.getShapeUtil(r).getFontFaces(r),{areResultsEqual:JS,areRecordsEqual:(r,i)=>r.props===i.props&&r.meta===i.meta}),this.shapeFontLoadStateCache=e.store.createCache(r=>{const i=fe("font faces",()=>this.getShapeFontFaces(r));return fe("font load state",()=>i.get().map(s=>this.getFontState(s)),{isEqual:JS})})}shapeFontFacesCache;shapeFontLoadStateCache;getShapeFontFaces(e){const n=typeof e=="string"?e:e.id;return this.shapeFontFacesCache.get(n)??ur}trackFontsForShape(e){const n=typeof e=="string"?e:e.id;this.shapeFontLoadStateCache.get(n)}async loadRequiredFontsForCurrentPage(e=1/0){const n=new Set;for(const i of this.editor.getCurrentPageShapeIds())for(const o of this.getShapeFontFaces(this.editor.getShape(i)))n.add(o);if(n.size>e)return;const r=Array.from(n,i=>this.ensureFontIsLoaded(i));await Promise.all(r)}fontStates=new fT("font states");getFontState(e){return this.fontStates.get(e)??null}ensureFontIsLoaded(e){const n=this.getFontState(e);if(n)return n.loadingPromise;const r=this.findOrCreateFontFace(e),i={state:"loading",instance:r,loadingPromise:r.load().then(()=>{document.fonts.add(r),this.fontStates.update(e,o=>({...o,state:"ready"}))}).catch(o=>{console.error(o),this.fontStates.update(e,s=>({...s,state:"error"}))})};return this.fontStates.set(e,i),i.loadingPromise}fontsToLoad=new Set;requestFonts(e){this.fontsToLoad.size||queueMicrotask(()=>{if(this.editor.isDisposed)return;const n=this.fontsToLoad;this.fontsToLoad=new Set,ws(()=>{for(const r of n)this.ensureFontIsLoaded(r)})});for(const n of e)this.fontsToLoad.add(n)}findOrCreateFontFace(e){for(const i of document.fonts)if(i.family===e.family&&go(h4).every(([o,s])=>i[o]===(e[o]??s)))return i;const n=this.assetUrls?.[e.src.url]??e.src.url,r=new FontFace(e.family,`url(${JSON.stringify(n)})`,{...Uu(h4,i=>e[i]),display:"swap"});return document.fonts.add(r),r}async toEmbeddedCssDeclaration(e){const n=this.assetUrls?.[e.src.url]??e.src.url,r=await Si.urlToDataUrl(n),i=ut([`url("${r}")`,e.src.format?`format(${e.src.format})`:null,e.src.tech?`tech(${e.src.tech})`:null]).join(" ");return ut(["@font-face {",`  font-family: "${e.family}";`,e.ascentOverride?`  ascent-override: ${e.ascentOverride};`:null,e.descentOverride?`  descent-override: ${e.descentOverride};`:null,e.stretch?`  font-stretch: ${e.stretch};`:null,e.style?`  font-style: ${e.style};`:null,e.weight?`  font-weight: ${e.weight};`:null,e.featureSettings?`  font-feature-settings: ${e.featureSettings};`:null,e.lineGapOverride?`  line-gap-override: ${e.lineGapOverride};`:null,e.unicodeRange?`  unicode-range: ${e.unicodeRange};`:null,`  src: ${i};`,"}"]).join(`
`)}}const h4={style:"normal",weight:"normal",stretch:"normal",unicodeRange:"U+0-10FFFF",featureSettings:"normal",ascentOverride:"normal",descentOverride:"normal",lineGapOverride:"normal"};class rhe{store;dispose;state="recording";pendingDiff=new ohe;stacks=qt("HistoryManager.stacks",{undos:Ug(),redos:Ug()},{isEqual:(e,n)=>e.undos===n.undos&&e.redos===n.redos});annotateError;constructor(e){this.store=e.store,this.annotateError=e.annotateError??Xm,this.dispose=this.store.addHistoryInterceptor((n,r)=>{if(r==="user")switch(this.state){case"recording":this.pendingDiff.apply(n.changes),this.stacks.update(({undos:i})=>({undos:i,redos:Ug()}));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(n.changes);break;case"paused":break;default:Wt(this.state)}})}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;const e=this.pendingDiff.clear();this.stacks.update(({undos:n,redos:r})=>({undos:n.push({type:"diff",diff:e}),redos:r}))}getNumUndos(){return this.stacks.get().undos.length+(this.pendingDiff.isEmpty()?0:1)}getNumRedos(){return this.stacks.get().redos.length}_isInBatch=!1;batch(e,n){const r=this.state;r!=="paused"&&n?.history&&(this.state=ihe[n.history]);try{if(this._isInBatch)return ws(e),this;this._isInBatch=!0;try{ws(e)}catch(i){throw this.annotateError(i),i}finally{this._isInBatch=!1}return this}finally{this.state=r}}_undo({pushToRedoStack:e,toMark:n=void 0}){const r=this.state;this.state="paused";try{let{undos:i,redos:o}=this.stacks.get();const s=this.pendingDiff.clear(),a=Kw(s),l=lf(s);e&&!a&&(o=o.push({type:"diff",diff:s}));let c=!1;if(a)for(;i.head?.type==="stop";){const d=i.head;if(i=i.tail,e&&(o=o.push(d)),d.id===n){c=!0;break}}if(!c)e:for(;i.head;){const d=i.head;switch(i=i.tail,e&&(o=o.push(d)),d.type){case"diff":Am(l,[lf(d.diff)]);break;case"stop":if(!n)break e;if(d.id===n){c=!0;break e}break;default:Wt(d)}}if(!c&&n)return this;this.store.applyDiff(l,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:i,redos:o})}finally{this.state=r}return this}undo(){return this._undo({pushToRedoStack:!0}),this}redo(){const e=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:n,redos:r}=this.stacks.get();if(r.length===0)return this;for(;r.head?.type==="stop";)n=n.push(r.head),r=r.tail;const i=ib();for(;r.head;){const o=r.head;if(n=n.push(o),r=r.tail,o.type==="diff")Am(i,[o.diff]);else break}this.store.applyDiff(i,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:n,redos:r})}finally{this.state=e}return this}bail(){return this._undo({pushToRedoStack:!1}),this}bailToMark(e){return e&&this._undo({pushToRedoStack:!1,toMark:e}),this}squashToMark(e){let n=this.stacks.get().undos;const r=[];for(;n.head&&!(n.head.type==="stop"&&n.head.id===e);)n.head.type==="diff"&&r.push(n.head.diff),n=n.tail;if(!n.head||n.head?.id!==e)return console.error("Could not find mark to squash to: ",e),this;if(r.length===0)return this;const i=ib();return Am(i,r.reverse()),this.stacks.update(({redos:o})=>({undos:n.push({type:"diff",diff:i}),redos:o})),this}_mark(e){ws(()=>{this.flushPendingDiff(),this.stacks.update(({undos:n,redos:r})=>({undos:n.push({type:"stop",id:e}),redos:r}))})}clear(){this.stacks.set({undos:Ug(),redos:Ug()}),this.pendingDiff.clear()}getMarkIdMatching(e){let n=this.stacks.get().undos;for(;n.head;){if(n.head.type==="stop"&&n.head.id.includes(e))return n.head.id;n=n.tail}return null}debug(){const{undos:e,redos:n}=this.stacks.get();return{undos:e.toArray(),redos:n.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}}const ihe={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class ohe{diff=ib();isEmptyAtom=qt("PendingDiff.isEmpty",!0);clear(){const e=this.diff;return this.diff=ib(),this.isEmptyAtom.set(!0),e}isEmpty(){return this.isEmptyAtom.get()}apply(e){Am(this.diff,[e]),this.isEmptyAtom.set(Kw(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}function Ug(t){return ahe}class she{length=0;head=null;tail=this;push(e){return new dA(e,this)}toArray(){return ur}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const ahe=new she;class dA{constructor(e,n){this.head=e,this.tail=n,this.length=n.length+1}length;push(e){return new dA(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(e.length){const n=e.head;return e=e.tail,{value:n,done:!1}}else return{value:void 0,done:!0}}}}}class lhe{constructor(e){this.editor=e}scribbleItems=new Map;state="paused";addScribble(e,n=Qt()){const r={id:n,scribble:{id:n,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(n,r),r}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}stop(e){const n=this.scribbleItems.get(e);if(!n)throw Error(`Scribble with id ${e} not found`);return n.delayRemaining=Math.min(n.delayRemaining,200),n.scribble.state="stopping",n}addPoint(e,n,r,i=.5){const o=this.scribbleItems.get(e);if(!o)throw Error(`Scribble with id ${e} not found`);const{prev:s}=o,a={x:n,y:r,z:i};return(!s||T.Dist(s,a)>=1)&&(o.next=a),o}tick(e){this.scribbleItems.size!==0&&this.editor.run(()=>{this.scribbleItems.forEach(n=>{if(n.scribble.state==="starting"){const{next:l,prev:c}=n;l&&l!==c&&(n.prev=l,n.scribble.points.push(l)),n.scribble.points.length>8&&(n.scribble.state="active");return}n.delayRemaining>0&&(n.delayRemaining=Math.max(0,n.delayRemaining-e)),n.timeoutMs+=e,n.timeoutMs>=16&&(n.timeoutMs=0);const{delayRemaining:r,timeoutMs:i,prev:o,next:s,scribble:a}=n;switch(a.state){case"active":{s&&s!==o?(n.prev=s,a.points.push(s),r===0&&a.points.length>8&&a.points.shift()):i===0&&(a.points.length>1?a.points.shift():n.delayRemaining=a.delay);break}case"stopping":{if(n.delayRemaining===0&&i===0){if(a.points.length===1){this.scribbleItems.delete(n.id);return}a.shrink&&(a.size=Math.max(1,a.size*(1-a.shrink))),a.points.shift()}break}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:n})=>({...n,points:[...n.points]})).slice(-5)})})}}var che=Object.create,s9=Object.defineProperty,uhe=Object.getOwnPropertyDescriptor,dhe=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),a9=t=>{throw TypeError(t)},l9=(t,e,n)=>e in t?s9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,hhe=t=>[,,,che(null)],c9=["class","method","getter","setter","accessor","field","value","get","set"],u9=t=>t!==void 0&&typeof t!="function"?a9("Function expected"):t,phe=(t,e,n,r,i)=>({kind:c9[t],name:e,metadata:r,addInitializer:o=>n._?a9("Already initialized"):i.push(u9(o||null))}),fhe=(t,e)=>l9(e,dhe("metadata"),t[3]),ghe=(t,e,n,r)=>{for(var i=0,o=t[e>>1],s=o&&o.length;i<s;i++)o[i].call(n);return r},u0=(t,e,n,r,i,o)=>{for(var s,a,l,c,d=e&7,u=!1,p=!1,f=2,y=c9[d+5],v=t[f]||(t[f]=[]),x=(i=i.prototype,uhe(i,n)),b=r.length-1;b>=0;b--)l=phe(d,n,a={},t[3],v),l.static=u,l.private=p,c=l.access={has:w=>n in w},c.get=w=>w[n],s=(0,r[b])(x[y],l),a._=1,u9(s)&&(x[y]=s);return x&&s9(i,n,x),i},mhe=(t,e,n)=>l9(t,e+"",n),d9,h9,p9,f9,Ch;const lt=t=>Math.round(t*10**8)/10**8;function oc(t,e,n,r,i){const o=t.filter(a=>(r==="forward"?a.startNode.id===e:a.endNode.id===e)&&lt(a.length)===lt(n)&&Oa(a.breadthIntersection[0],a.breadthIntersection[1],i[0],i[1]));if(o.length===0)return[];const s=new Set;return o.forEach(a=>{const l=r==="forward"?a.endNode.id:a.startNode.id;if(!s.has(l)){s.add(l);const c=oc(t,l,n,r,Oa(a.breadthIntersection[0],a.breadthIntersection[1],i[0],i[1]));o.push(...c)}}),o}function yhe(t){t.sort((e,n)=>n.gaps.length-e.gaps.length);for(let e=t.length-1;e>0;e--){const n=t[e];for(let r=e-1;r>=0;r--){const i=t[r];if(i.direction===n.direction&&n.gaps.every(o=>i.gaps.some(s=>lt(o.startEdge[0].x)===lt(s.startEdge[0].x)&&lt(o.startEdge[0].y)===lt(s.startEdge[0].y)&&lt(o.startEdge[1].x)===lt(s.startEdge[1].x)&&lt(o.startEdge[1].y)===lt(s.startEdge[1].y))&&i.gaps.some(s=>lt(o.endEdge[0].x)===lt(s.endEdge[0].x)&&lt(o.endEdge[0].y)===lt(s.endEdge[0].y)&&lt(o.endEdge[1].x)===lt(s.endEdge[1].x)&&lt(o.endEdge[1].y)===lt(s.endEdge[1].y)))){t.splice(e,1);break}}}}f9=[fe],p9=[fe],h9=[fe],d9=[fe];class Df{constructor(e){this.manager=e,ghe(Ch,5,this),mhe(this,"editor"),this.editor=e.editor}getSnapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",n=>{const r=e.getShapePageTransform(n.id);if(!r)return;const o=e.getShapeUtil(n).getBoundsSnapGeometry(n).points??e.getShapeGeometry(n).bounds.cornersAndCenter;if(!(!r||!o))return o.map((s,a)=>{const{x:l,y:c}=xe.applyToPoint(r,s);return{x:l,y:c,id:`${n.id}:${a}`}})})}getSnapPoints(e){return this.getSnapPointsCache().get(e)??[]}getSnappablePoints(){const e=this.getSnapPointsCache(),n=this.manager.getSnappableShapes(),r=[];for(const i of n){const o=e.get(i);o&&r.push(...o)}return r}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),e=>({id:e,pageBounds:Gr(this.editor.getShapePageBounds(e))}))}getVisibleGaps(){const e=[],n=[];let r,i;const o=this.getSnappableGapNodes().sort((a,l)=>a.pageBounds.minX-l.pageBounds.minX);for(let a=0;a<o.length;a++){r=o[a];for(let l=a+1;l<o.length;l++)i=o[l],r.pageBounds.maxX<i.pageBounds.minX&&Fg(r.pageBounds.minY,r.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)&&e.push({startNode:r,endNode:i,startEdge:[new T(r.pageBounds.maxX,r.pageBounds.minY),new T(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new T(i.pageBounds.minX,i.pageBounds.minY),new T(i.pageBounds.minX,i.pageBounds.maxY)],length:i.pageBounds.minX-r.pageBounds.maxX,breadthIntersection:Oa(r.pageBounds.minY,r.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)})}const s=o.sort((a,l)=>a.pageBounds.minY-l.pageBounds.minY);for(let a=0;a<s.length;a++){r=s[a];for(let l=a+1;l<s.length;l++)i=s[l],r.pageBounds.maxY<i.pageBounds.minY&&Fg(r.pageBounds.minX,r.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)&&n.push({startNode:r,endNode:i,startEdge:[new T(r.pageBounds.minX,r.pageBounds.maxY),new T(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new T(i.pageBounds.minX,i.pageBounds.minY),new T(i.pageBounds.maxX,i.pageBounds.minY)],length:i.pageBounds.minY-r.pageBounds.maxY,breadthIntersection:Oa(r.pageBounds.minX,r.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)})}return{horizontal:e,vertical:n}}snapTranslateShapes({lockedAxis:e,initialSelectionPageBounds:n,initialSelectionSnapPoints:r,dragDelta:i}){const o=this.manager.getSnapThreshold(),s=this.getSnappablePoints(),a=n.clone().translate(i),l=r.map(({x,y:b},w)=>({id:"selection:"+w,x:x+i.x,y:b+i.y})),c=s,d=[],u=[],p=new T(o,o);this.collectPointSnaps({minOffset:p,nearestSnapsX:d,nearestSnapsY:u,otherNodeSnapPoints:c,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:u,minOffset:p});const f=new T(e==="x"?0:d[0]?.nudge??0,e==="y"?0:u[0]?.nudge??0);p.x=0,p.y=0,d.length=0,u.length=0,l.forEach(x=>{x.x+=f.x,x.y+=f.y}),a.translate(f),this.collectPointSnaps({minOffset:p,nearestSnapsX:d,nearestSnapsY:u,otherNodeSnapPoints:c,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:u,minOffset:p});const y=this.getPointSnapLines({nearestSnapsX:d,nearestSnapsY:u}),v=this.getGapSnapLines({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:u});return this.manager.setIndicators([...v,...y]),{nudge:f}}snapResizeShapes({initialSelectionPageBounds:e,dragDelta:n,handle:r,isAspectRatioLocked:i,isResizingFromCenter:o}){const s=this.manager.getSnapThreshold(),{box:a,scaleX:l,scaleY:c}=pe.Resize(e,r,o?n.x*2:n.x,o?n.y*2:n.y,i);let d=r;l<0&&(d=kue(d)),c<0&&(d=wue(d)),o&&(a.center=e.center);const u=d==="top"||d==="bottom",p=d==="left"||d==="right",f=p4(d,a),y=this.getSnappablePoints(),v=[],x=[],b=new T(s,s);this.collectPointSnaps({minOffset:b,nearestSnapsX:v,nearestSnapsY:x,otherNodeSnapPoints:y,selectionSnapPoints:f});const w=new T(u?0:v[0]?.nudge??0,p?0:x[0]?.nudge??0);if(i&&Iue(d)&&w.len()!==0){const O=v.length&&x.length?Math.abs(w.x)<Math.abs(w.y)?"x":"y":v.length?"x":"y",D=e.aspectRatio;O==="x"?(x.length=0,w.y=w.x/D,(d==="bottom_left"||d==="top_right")&&(w.y=-w.y)):(v.length=0,w.x=w.y*D,(d==="bottom_left"||d==="top_right")&&(w.x=-w.x))}const _=T.Add(n,w),{box:C}=pe.Resize(e,r,o?_.x*2:_.x,o?_.y*2:_.y,i);o&&(C.center=e.center);const A=p4("any",C);v.length=0,x.length=0,b.x=0,b.y=0,this.collectPointSnaps({minOffset:b,nearestSnapsX:v,nearestSnapsY:x,otherNodeSnapPoints:y,selectionSnapPoints:A});const E=this.getPointSnapLines({nearestSnapsX:v,nearestSnapsY:x});return this.manager.setIndicators([...E]),{nudge:w}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:n,minOffset:r,nearestSnapsX:i,nearestSnapsY:o}){for(const s of e)for(const a of n){const l=T.Sub(s,a),c=Math.abs(l.x),d=Math.abs(l.y);lt(c)<=lt(r.x)&&(lt(c)<lt(r.x)&&(i.length=0),i.push({type:"points",points:{thisPoint:s,otherPoint:a},nudge:a.x-s.x}),r.x=c),lt(d)<=lt(r.y)&&(lt(d)<lt(r.y)&&(o.length=0),o.push({type:"points",points:{thisPoint:s,otherPoint:a},nudge:a.y-s.y}),r.y=d)}}collectGapSnaps({selectionPageBounds:e,minOffset:n,nearestSnapsX:r,nearestSnapsY:i}){const{horizontal:o,vertical:s}=this.getVisibleGaps();for(const a of o){if(!Fg(a.breadthIntersection[0],a.breadthIntersection[1],e.minY,e.maxY))continue;const c=a.startEdge[0].x+a.length/2-e.center.x;if(a.length>e.width&&lt(Math.abs(c))<=lt(n.x)){lt(Math.abs(c))<lt(n.x)&&(r.length=0),n.x=Math.abs(c);const b={type:"gap_center",gap:a,nudge:c},w=r.find(({type:C})=>C==="gap_center"),_=w&&Oa(a.breadthIntersection[0],a.breadthIntersection[1],w.gap.breadthIntersection[0],w.gap.breadthIntersection[1]);w&&w.gap.length>a.length&&_?r[r.indexOf(w)]=b:(!w||!_)&&r.push(b)}const u=a.startNode.pageBounds.minX-a.length,p=e.maxX,f=u-p;lt(Math.abs(f))<=lt(n.x)&&(lt(Math.abs(f))<lt(n.x)&&(r.length=0),n.x=Math.abs(f),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"left",nudge:f}));const y=a.endNode.pageBounds.maxX+a.length,v=e.minX,x=y-v;lt(Math.abs(x))<=lt(n.x)&&(lt(Math.abs(x))<lt(n.x)&&(r.length=0),n.x=Math.abs(x),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"right",nudge:x}))}for(const a of s){if(!Fg(a.breadthIntersection[0],a.breadthIntersection[1],e.minX,e.maxX))continue;const c=a.startEdge[0].y+a.length/2-e.center.y;if(a.length>e.height&&lt(Math.abs(c))<=lt(n.y)){lt(Math.abs(c))<lt(n.y)&&(i.length=0),n.y=Math.abs(c);const b={type:"gap_center",gap:a,nudge:c},w=i.find(({type:C})=>C==="gap_center"),_=w&&Fg(w.gap.breadthIntersection[0],w.gap.breadthIntersection[1],a.breadthIntersection[0],a.breadthIntersection[1]);w&&w.gap.length>a.length&&_?i[i.indexOf(w)]=b:(!w||!_)&&i.push(b);continue}const u=a.startNode.pageBounds.minY-a.length,p=e.maxY,f=u-p;lt(Math.abs(f))<=lt(n.y)&&(lt(Math.abs(f))<lt(n.y)&&(i.length=0),n.y=Math.abs(f),i.push({type:"gap_duplicate",gap:a,protrusionDirection:"top",nudge:f}));const y=a.endNode.pageBounds.maxY+a.length,v=e.minY,x=y-v;lt(Math.abs(x))<=lt(n.y)&&(lt(Math.abs(x))<lt(n.y)&&(i.length=0),n.y=Math.abs(x),i.push({type:"gap_duplicate",gap:a,protrusionDirection:"bottom",nudge:x}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:n}){const r={},i={};if(e.length>0){for(const o of e)if(o.type==="points"){const s=lt(o.points.otherPoint.x);r[s]||(r[s]=[]),r[s].push(o.points)}}if(n.length>0){for(const o of n)if(o.type==="points"){const s=lt(o.points.otherPoint.y);i[s]||(i[s]=[]),i[s].push(o.points)}}return Object.values(r).concat(Object.values(i)).map(o=>({id:Qt(),type:"points",points:a2(o.map(s=>T.From(s.otherPoint)).concat(o.map(s=>T.From(s.thisPoint))),(s,a)=>s.equals(a))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:n,nearestSnapsY:r}){const{vertical:i,horizontal:o}=this.getVisibleGaps(),s={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},a=[];if(n.length>0)for(const l of n){if(l.type==="points")continue;const{gap:{breadthIntersection:c,startEdge:d,startNode:u,endNode:p,length:f,endEdge:y}}=l;switch(l.type){case"gap_center":{const v=(f-e.width)/2,x=Oa(c[0],c[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:Qt(),gaps:[...oc(o,u.id,v,"backward",x),{startEdge:d,endEdge:s.left},{startEdge:s.right,endEdge:y},...oc(o,p.id,v,"forward",x)]});break}case"gap_duplicate":{const v=Oa(c[0],c[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:Qt(),gaps:l.protrusionDirection==="left"?[{startEdge:s.right,endEdge:d.map(x=>x.clone().addXY(-u.pageBounds.width,0))},{startEdge:d,endEdge:y},...oc(o,p.id,f,"forward",v)]:[...oc(o,u.id,f,"backward",v),{startEdge:d,endEdge:y},{startEdge:y.map(x=>x.clone().addXY(l.gap.endNode.pageBounds.width,0)),endEdge:s.left}]});break}}}if(r.length>0)for(const l of r){if(l.type==="points")continue;const{gap:{breadthIntersection:c,startEdge:d,startNode:u,endNode:p,length:f,endEdge:y}}=l;switch(l.type){case"gap_center":{const v=(f-e.height)/2,x=Oa(c[0],c[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:Qt(),gaps:[...oc(i,u.id,v,"backward",x),{startEdge:d,endEdge:s.top},{startEdge:s.bottom,endEdge:y},...oc(i,l.gap.endNode.id,v,"forward",x)]});break}case"gap_duplicate":{const v=Oa(c[0],c[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:Qt(),gaps:l.protrusionDirection==="top"?[{startEdge:s.bottom,endEdge:d.map(x=>x.clone().addXY(0,-u.pageBounds.height))},{startEdge:d,endEdge:y},...oc(i,p.id,f,"forward",v)]:[...oc(i,u.id,f,"backward",v),{startEdge:d,endEdge:y},{startEdge:y.map(x=>x.clone().addXY(0,p.pageBounds.height)),endEdge:s.top}]})}break}}return yhe(a),a}}Ch=hhe();u0(Ch,1,"getSnapPointsCache",f9,Df);u0(Ch,1,"getSnappablePoints",p9,Df);u0(Ch,1,"getSnappableGapNodes",h9,Df);u0(Ch,1,"getVisibleGaps",d9,Df);fhe(Ch,Df);function p4(t,e){const{minX:n,maxX:r,minY:i,maxY:o}=e,s=[];switch(t){case"top":case"left":case"top_left":case"any":s.push({id:"top_left",handle:"top_left",x:n,y:i})}switch(t){case"top":case"right":case"top_right":case"any":s.push({id:"top_right",handle:"top_right",x:r,y:i})}switch(t){case"bottom":case"right":case"bottom_right":case"any":s.push({id:"bottom_right",handle:"bottom_right",x:r,y:o})}switch(t){case"bottom":case"left":case"bottom_left":case"any":s.push({id:"bottom_left",handle:"bottom_left",x:n,y:o})}return s}var vhe=Object.create,g9=Object.defineProperty,xhe=Object.getOwnPropertyDescriptor,She=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),m9=t=>{throw TypeError(t)},y9=(t,e,n)=>e in t?g9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,bhe=t=>[,,,vhe(null)],v9=["class","method","getter","setter","accessor","field","value","get","set"],x9=t=>t!==void 0&&typeof t!="function"?m9("Function expected"):t,whe=(t,e,n,r,i)=>({kind:v9[t],name:e,metadata:r,addInitializer:o=>n._?m9("Already initialized"):i.push(x9(o||null))}),khe=(t,e)=>y9(e,She("metadata"),t[3]),Ihe=(t,e,n,r)=>{for(var i=0,o=t[e>>1],s=o&&o.length;i<s;i++)o[i].call(n);return r},_he=(t,e,n,r,i,o)=>{for(var s,a,l,c,d=e&7,u=!1,p=!1,f=2,y=v9[d+5],v=t[f]||(t[f]=[]),x=(i=i.prototype,xhe(i,n)),b=r.length-1;b>=0;b--)l=whe(d,n,a={},t[3],v),l.static=u,l.private=p,c=l.access={has:w=>n in w},c.get=w=>w[n],s=(0,r[b])(x[y],l),a._=1,x9(s)&&(x[y]=s);return x&&g9(i,n,x),i},Che=(t,e,n)=>y9(t,e+"",n),S9,d0;const Phe=()=>null,The=()=>[];S9=[fe];class hA{constructor(e){this.manager=e,Ihe(d0,5,this),Che(this,"editor"),this.editor=e.editor}getSnapGeometryCache(){const{editor:e}=this;return e.store.createComputedCache("handle snap geometry",n=>{const r=e.getShapeUtil(n).getHandleSnapGeometry(n),i=r.getSelfSnapOutline?r.getSelfSnapOutline.bind(r):Phe,o=r.getSelfSnapPoints?r.getSelfSnapPoints.bind(r):The;return{outline:r.outline===void 0?e.getShapeGeometry(n):r.outline,points:r.points??[],getSelfSnapOutline:i,getSelfSnapPoints:o}})}*iterateSnapPointsInPageSpace(e,n){const r=this.getSnapGeometryCache().get(e)?.getSelfSnapPoints(n);if(r&&r.length){const i=Gr(this.editor.getShapePageTransform(e));for(const o of r)yield i.applyToPoint(o)}for(const i of this.manager.getSnappableShapes()){if(i===e)continue;const o=this.getSnapGeometryCache().get(i)?.points;if(!o||!o.length)continue;const s=Gr(this.editor.getShapePageTransform(i));for(const a of o)yield s.applyToPoint(a)}}*iterateSnapOutlines(e,n){const r=this.getSnapGeometryCache().get(e)?.getSelfSnapOutline(n);r&&(yield{shapeId:e,outline:r});for(const i of this.manager.getSnappableShapes()){if(i===e)continue;const o=this.getSnapGeometryCache().get(i)?.outline;o&&(yield{shapeId:i,outline:o})}}getHandleSnapPosition({currentShapeId:e,handle:n,handleInPageSpace:r}){const i=this.manager.getSnapThreshold();let o=i,s=null;for(const c of this.iterateSnapPointsInPageSpace(e,n))T.DistMin(r,c,o)&&(o=T.Dist(r,c),s=c);if(s)return s;let a=i,l=null;for(const{shapeId:c,outline:d}of this.iterateSnapOutlines(e,n)){const u=Gr(this.editor.getShapePageTransform(c)),p=this.editor.getPointInShapeSpace(c,r),f=d.nearestPoint(p),y=u.applyToPoint(f);T.DistMin(r,y,a)&&(a=T.Dist(r,y),l=y)}return l||null}getHandleSnapData({handle:e,currentShapeId:n}){const r=this.manager.getSnapThreshold(),o=Gr(this.editor.getShapePageTransform(n)).applyToPoint(e);let s=null,a=null,l=r,c=r;for(const f of this.iterateSnapPointsInPageSpace(n,e)){const y=Math.abs(o.x-f.x),v=Math.abs(o.y-f.y);y<l&&(l=y,s=f),v<c&&(c=v,a=f)}if(!s&&!a)return null;const d=new T(s?s.x-o.x:0,a?a.y-o.y:0),u=T.Add(o,d),p=[];if(s){const f=new T(s.x,u.y);p.push({id:Qt(),type:"points",points:[s,f]})}if(a){const f=new T(u.x,a.y);p.push({id:Qt(),type:"points",points:[a,f]})}return{snaps:p,nudge:d}}snapHandle({currentShapeId:e,handle:n}){const i=Gr(this.editor.getShapePageTransform(e)).applyToPoint(n),o=n.canSnap?"point":n.snapType;if(o==="point"){const s=this.getHandleSnapPosition({currentShapeId:e,handle:n,handleInPageSpace:i});return s?(this.manager.setIndicators([{id:Qt(),type:"points",points:[s]}]),{nudge:T.Sub(s,i)}):null}if(o==="align"){const s=this.getHandleSnapData({handle:n,currentShapeId:e});return s?(this.manager.setIndicators(s.snaps),{nudge:s.nudge}):null}return null}}d0=bhe();_he(d0,1,"getSnapGeometryCache",S9,hA);khe(d0,hA);var Ehe=Object.create,b9=Object.defineProperty,Ahe=Object.getOwnPropertyDescriptor,Mhe=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),w9=t=>{throw TypeError(t)},k9=(t,e,n)=>e in t?b9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ohe=t=>[,,,Ehe(null)],I9=["class","method","getter","setter","accessor","field","value","get","set"],_9=t=>t!==void 0&&typeof t!="function"?w9("Function expected"):t,Dhe=(t,e,n,r,i)=>({kind:I9[t],name:e,metadata:r,addInitializer:o=>n._?w9("Already initialized"):i.push(_9(o||null))}),jhe=(t,e)=>k9(e,Mhe("metadata"),t[3]),Rhe=(t,e,n,r)=>{for(var i=0,o=t[e>>1],s=o&&o.length;i<s;i++)o[i].call(n);return r},pA=(t,e,n,r,i,o)=>{for(var s,a,l,c,d=e&7,u=!1,p=!1,f=2,y=I9[d+5],v=t[f]||(t[f]=[]),x=(i=i.prototype,Ahe(i,n)),b=r.length-1;b>=0;b--)l=Dhe(d,n,a={},t[3],v),l.static=u,l.private=p,c=l.access={has:w=>n in w},c.get=w=>w[n],s=(0,r[b])(x[y],l),a._=1,_9(s)&&(x[y]=s);return x&&b9(i,n,x),i},KC=(t,e,n)=>k9(t,typeof e!="symbol"?e+"":e,n),C9,P9,T9,jf;T9=[fe],P9=[fe],C9=[fe];class ev{constructor(e){this.editor=e,Rhe(jf,5,this),KC(this,"shapeBounds"),KC(this,"handles"),KC(this,"_snapIndicators",qt("snapLines",void 0)),this.shapeBounds=new Df(this),this.handles=new hA(this)}getIndicators(){return this._snapIndicators.get()??ur}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(e){this._snapIndicators.set(e)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:e}=this,n=e.getViewportPageBounds(),r=e.getSelectedShapeIds(),i=new Set,o=s=>{if(co(s)){const l=e.getShape(s);l&&e.isShapeOfType(l,"frame")&&i.add(s)}const a=e.getSortedChildIdsForParent(s);for(const l of a){if(r.includes(l))continue;const c=e.getShape(l);if(!c||!e.getShapeUtil(c).canSnap(c))continue;const u=e.getShapePageBounds(l);if(u&&n.includes(u)){if(e.isShapeOfType(c,"group")){o(l);continue}i.add(l)}}};return o(this.getCurrentCommonAncestor()??e.getCurrentPageId()),i}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}jf=Ohe();pA(jf,1,"getSnapThreshold",T9,ev);pA(jf,1,"getSnappableShapes",P9,ev);pA(jf,1,"getCurrentCommonAncestor",C9,ev);jhe(jf,ev);const $he=/\r?\n|\r/g;function f4(t){return t.replace($he,`
`).split(`
`).map(e=>e||" ").join(`
`)}const Nhe={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},Lhe=/\s/,g4=Object.freeze({"overflow-wrap":"break-word","word-break":"auto",width:null,height:null,"max-width":null,"min-width":null});class zhe{constructor(e){this.editor=e;const n=document.createElement("div");n.classList.add("tl-text"),n.classList.add("tl-text-measure"),n.setAttribute("dir","auto"),n.tabIndex=-1,this.editor.getContainer().appendChild(n),this.elm=n;for(const r of Tm(g4))n.style.setProperty(r,g4[r])}elm;setElementStyles(e){const n={};for(const r of Tm(e))if(typeof e[r]=="string"){const i=this.elm.style.getPropertyValue(r);if(i===e[r])continue;n[r]=i,this.elm.style.setProperty(r,e[r])}return()=>{for(const r of Tm(n))this.elm.style.setProperty(r,n[r])}}dispose(){return this.elm.remove()}measureText(e,n){const r=document.createElement("div");return r.textContent=f4(e),this.measureHtml(r.innerHTML,n)}measureHtml(e,n){const{elm:r}=this,i={"font-family":n.fontFamily,"font-style":n.fontStyle,"font-weight":n.fontWeight,"font-size":n.fontSize+"px","line-height":n.lineHeight.toString(),padding:n.padding,"max-width":n.maxWidth?n.maxWidth+"px":void 0,"min-width":n.minWidth?n.minWidth+"px":void 0,"overflow-wrap":n.disableOverflowWrapBreaking?"normal":void 0,...n.otherStyles},o=this.setElementStyles(i);try{r.innerHTML=e;const s=n.measureScrollWidth?r.scrollWidth:0,a=r.getBoundingClientRect();return{x:0,y:0,w:a.width,h:a.height,scrollWidth:s}}finally{o()}}measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:n=!1}={}){const r=[],i=e.getBoundingClientRect(),o=-i.left,s=-i.top,a=new Range,l=e.childNodes[0];let c=0,d=null,u=null,p=0,f=0,y=!1;for(const v of e.childNodes)if(v.nodeType===Node.TEXT_NODE)for(const x of v.textContent??""){a.setStart(l,c),a.setEnd(l,c+x.length);const b=a.getClientRects(),w=b[b.length-1],_=w.top+s,C=w.left+o,A=w.right+o,E=C<f,O=Lhe.test(x);if(O!==u||_!==p||!d){if(d){if(n&&_!==p){y=!0;break}r.push(d)}d={box:{x:C,y:_,w:w.width,h:w.height},text:x},f=C}else E&&(d.box.x=C),d.box.w=E?d.box.w+w.width:A-d.box.x,d.text+=x;x===`
`&&(f=0),u=O,p=_,c+=x.length}return d&&r.push(d),{spans:r,didTruncate:y}}measureTextSpans(e,n){if(e==="")return[];const{elm:r}=this,i=n.overflow==="truncate-ellipsis"||n.overflow==="truncate-clip",o=Math.ceil(n.width-n.padding*2),s={"font-family":n.fontFamily,"font-style":n.fontStyle,"font-weight":n.fontWeight,"font-size":n.fontSize+"px","line-height":n.lineHeight.toString(),width:`${o}px`,height:"min-content","text-align":Nhe[n.textAlign],"overflow-wrap":i?"anywhere":void 0,"word-break":i?"break-all":void 0,...n.otherStyles},a=this.setElementStyles(s);try{const l=f4(e);r.textContent=l;const{spans:c,didTruncate:d}=this.measureElementTextNodeSpans(r,{shouldTruncateToFirstLine:i});if(n.overflow==="truncate-ellipsis"&&d){r.textContent="…";const u=Math.ceil(this.measureElementTextNodeSpans(r).spans[0].box.w);r.style.setProperty("width",`${o-u}px`),r.textContent=l;const p=this.measureElementTextNodeSpans(r,{shouldTruncateToFirstLine:!0}).spans,f=p[p.length-1];return p.push({text:"…",box:{x:Math.min(f.box.x+f.box.w,n.width-n.padding-u),y:f.box.y,w:u,h:f.box.h}}),p}return c}finally{a()}}}var Fhe=Object.create,E9=Object.defineProperty,Bhe=Object.getOwnPropertyDescriptor,Uhe=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),A9=t=>{throw TypeError(t)},M9=(t,e,n)=>e in t?E9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Hhe=t=>[,,,Fhe(null)],O9=["class","method","getter","setter","accessor","field","value","get","set"],D9=t=>t!==void 0&&typeof t!="function"?A9("Function expected"):t,Whe=(t,e,n,r,i)=>({kind:O9[t],name:e,metadata:r,addInitializer:o=>n._?A9("Already initialized"):i.push(D9(o||null))}),Vhe=(t,e)=>M9(e,Uhe("metadata"),t[3]),Khe=(t,e,n,r)=>{for(var i=0,o=t[e>>1],s=o&&o.length;i<s;i++)o[i].call(n);return r},j9=(t,e,n,r,i,o)=>{for(var s,a,l,c,d=e&7,u=!1,p=!1,f=2,y=O9[d+5],v=t[f]||(t[f]=[]),x=(i=i.prototype,Bhe(i,n)),b=r.length-1;b>=0;b--)l=Whe(d,n,a={},t[3],v),l.static=u,l.private=p,c=l.access={has:w=>n in w},c.get=w=>w[n],s=(0,r[b])(x[y],l),a._=1,D9(s)&&(x[y]=s);return x&&E9(i,n,x),i},zx=(t,e,n)=>M9(t,typeof e!="symbol"?e+"":e,n),R9,$9,tv;const m4=g2;$9=[qo],R9=[qo];class h0{constructor(e){this.editor=e,Khe(tv,5,this),zx(this,"cancelRaf"),zx(this,"isPaused",!0),zx(this,"now",0),zx(this,"prevPoint",new T),this.editor.disposables.add(this.dispose),this.start()}start(){this.isPaused=!1,this.cancelRaf?.(),this.cancelRaf=m4(this.tick),this.now=Date.now()}tick(){if(this.isPaused)return;const e=Date.now(),n=e-this.now;this.now=e,this.updatePointerVelocity(n),this.editor.emit("frame",n),this.editor.emit("tick",n),this.cancelRaf=m4(this.tick)}dispose(){this.isPaused=!0,this.cancelRaf?.()}updatePointerVelocity(e){const{prevPoint:n,editor:{inputs:{currentScreenPoint:r,pointerVelocity:i}}}=this;if(e===0)return;const o=T.Sub(r,n);this.prevPoint=r.clone();const s=o.len(),a=s?o.div(s):new T(0,0),l=i.clone().lrp(a.mul(s/e),.5);Math.abs(l.x)<.01&&(l.x=0),Math.abs(l.y)<.01&&(l.y=0),i.equals(l)||(this.editor.inputs.pointerVelocity=l)}}tv=Hhe();j9(tv,1,"tick",$9,h0);j9(tv,1,"dispose",R9,h0);Vhe(tv,h0);var qhe=Object.create,N9=Object.defineProperty,Ghe=Object.getOwnPropertyDescriptor,Yhe=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),L9=t=>{throw TypeError(t)},z9=(t,e,n)=>e in t?N9(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Xhe=t=>[,,,qhe(null)],F9=["class","method","getter","setter","accessor","field","value","get","set"],B9=t=>t!==void 0&&typeof t!="function"?L9("Function expected"):t,Zhe=(t,e,n,r,i)=>({kind:F9[t],name:e,metadata:r,addInitializer:o=>n._?L9("Already initialized"):i.push(B9(o||null))}),Jhe=(t,e)=>z9(e,Yhe("metadata"),t[3]),Qhe=(t,e,n,r)=>{for(var i=0,o=t[e>>1],s=o&&o.length;i<s;i++)o[i].call(n);return r},Co=(t,e,n,r,i,o)=>{for(var s,a,l,c,d=e&7,u=!1,p=!1,f=2,y=F9[d+5],v=t[f]||(t[f]=[]),x=(i=i.prototype,Ghe(i,n)),b=r.length-1;b>=0;b--)l=Zhe(d,n,a={},t[3],v),l.static=u,l.private=p,c=l.access={has:w=>n in w},c.get=w=>w[n],s=(0,r[b])(x[y],l),a._=1,B9(s)&&(x[y]=s);return x&&N9(i,n,x),i},y4=(t,e,n)=>z9(t,typeof e!="symbol"?e+"":e,n),U9,H9,W9,V9,K9,q9,G9,Y9,X9,Z9,J9,Q9,eH,tH,nH,si;nH=[fe],tH=[fe],eH=[fe],Q9=[fe],J9=[fe],Z9=[fe],X9=[fe],Y9=[fe],G9=[fe],q9=[fe],K9=[fe],V9=[fe],W9=[fe],H9=[fe],U9=[fe];class Ii{constructor(e,n){if(this.user=e,this.inferDarkMode=n,Qhe(si,5,this),y4(this,"systemColorScheme",qt("systemColorScheme","light")),y4(this,"disposables",new Set),typeof window>"u"||!window.matchMedia)return;const r=window.matchMedia("(prefers-color-scheme: dark)");r?.matches&&this.systemColorScheme.set("dark");const i=o=>{o.matches?this.systemColorScheme.set("dark"):this.systemColorScheme.set("light")};r?.addEventListener("change",i),this.disposables.add(()=>r?.removeEventListener("change",i))}dispose(){this.disposables.forEach(e=>e())}updateUserPreferences(e){this.user.setUserPreferences({...this.user.userPreferences.get(),...e})}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),areKeyboardShortcutsEnabled:this.getAreKeyboardShortcutsEnabled(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode(),enhancedA11yMode:this.getEnhancedA11yMode(),inputMode:this.getInputMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return this.systemColorScheme.get()==="dark";default:return this.inferDarkMode?this.systemColorScheme.get()==="dark":!1}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??Fo.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??Fo.animationSpeed}getAreKeyboardShortcutsEnabled(){return this.user.userPreferences.get().areKeyboardShortcutsEnabled??Fo.areKeyboardShortcutsEnabled}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name?.trim()??Fo.name}getLocale(){return this.user.userPreferences.get().locale??Fo.locale}getColor(){return this.user.userPreferences.get().color??Fo.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??Fo.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??Fo.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??Fo.isDynamicSizeMode}getIsPasteAtCursorMode(){return this.user.userPreferences.get().isPasteAtCursorMode??Fo.isPasteAtCursorMode}getEnhancedA11yMode(){return this.user.userPreferences.get().enhancedA11yMode??Fo.enhancedA11yMode}getInputMode(){return this.user.userPreferences.get().inputMode??Fo.inputMode}}si=Xhe();Co(si,1,"getUserPreferences",nH,Ii);Co(si,1,"getIsDarkMode",tH,Ii);Co(si,1,"getEdgeScrollSpeed",eH,Ii);Co(si,1,"getAnimationSpeed",Q9,Ii);Co(si,1,"getAreKeyboardShortcutsEnabled",J9,Ii);Co(si,1,"getId",Z9,Ii);Co(si,1,"getName",X9,Ii);Co(si,1,"getLocale",Y9,Ii);Co(si,1,"getColor",G9,Ii);Co(si,1,"getIsSnapMode",q9,Ii);Co(si,1,"getIsWrapMode",K9,Ii);Co(si,1,"getIsDynamicResizeMode",V9,Ii);Co(si,1,"getIsPasteAtCursorMode",W9,Ii);Co(si,1,"getEnhancedA11yMode",H9,Ii);Co(si,1,"getInputMode",U9,Ii);Jhe(si,Ii);const epe={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},tpe=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class We{constructor(e,n){this.editor=e;const{id:r,children:i,initial:o,isLockable:s,useCoalescedEvents:a}=this.constructor;this.id=r,this._isActive=qt("toolIsActive"+this.id,!1),this._current=qt("toolState"+this.id,void 0),this._path=fe("toolPath"+this.id,()=>{const l=this.getCurrent();return this.id+(l?`.${l.getPath()}`:"")}),this.parent=n??{},n?i&&o?(this.type="branch",this.initial=o,this.children=Object.fromEntries(i().map(l=>[l.id,new l(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",i&&o&&(this.initial=o,this.children=Object.fromEntries(i().map(l=>[l.id,new l(this.editor,this)])),this._current.set(this.children[this.initial]))),this.isLockable=s,this.useCoalescedEvents=a,this.performanceTracker=new c5}performanceTracker;static id;static initial;static children;static isLockable=!0;static useCoalescedEvents=!1;id;type;shapeType;initial;children;isLockable;useCoalescedEvents;parent;getPath(){return this._path.get()}_path;getCurrent(){return this._current.get()}_current;getIsActive(){return this._isActive.get()}_isActive;transition(e,n={}){const r=e.split(".");let i=this;for(let o=0;o<r.length;o++){const s=r[o],a=i.getCurrent(),l=i.children?.[s];if(!l)throw Error(`${i.id} - no child state exists with the id ${s}.`);if(a?.id!==l.id&&(a?.exit(n,s),i._current.set(l),l.enter(n,a?.id||"initial"),!l.getIsActive()))break;i=l}return this}handleEvent(e){const n=epe[e.name],r=this._current.__unsafe__getWithoutCapture();this[n]?.(e),this._isActive.__unsafe__getWithoutCapture()&&r&&r===this._current.__unsafe__getWithoutCapture()&&r.handleEvent(e)}enter(e,n){if(Vn.measurePerformance.get()&&tpe.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),this.onEnter?.(e,n),this.children&&this.initial&&this.getIsActive()){const r=this.children[this.initial];this._current.set(r),r.enter(e,n)}}exit(e,n){Vn.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),this.onExit?.(e,n),this.getIsActive()||this.getCurrent()?.exit(e,n)}_currentToolIdMask=qt("curent tool id mask",void 0);getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}addChild(e){if(this.type==="leaf")throw new Error("StateNode.addChild: cannot add child to a leaf node");this.children||(this.children={});const n=new e(this.editor,this);if(this.children[n.id])throw new Error(`StateNode.addChild: a child with id '${n.id}' already exists`);return this.children[n.id]=n,this}}class npe extends We{static id="root";static initial="";static children(){return[]}onKeyDown(e){switch(e.code){case"KeyZ":{if(!(e.shiftKey||e.ctrlKey)){const n=this.getCurrent();n&&n.getCurrent()?.id==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...e,onInteractionEnd:n.id})}break}}}}var rpe=Object.create,rH=Object.defineProperty,ipe=Object.getOwnPropertyDescriptor,iH=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),oH=t=>{throw TypeError(t)},sH=(t,e,n)=>e in t?rH(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,ope=t=>[,,,rpe(t?.[iH("metadata")]??null)],aH=["class","method","getter","setter","accessor","field","value","get","set"],lH=t=>t!==void 0&&typeof t!="function"?oH("Function expected"):t,spe=(t,e,n,r,i)=>({kind:aH[t],name:e,metadata:r,addInitializer:o=>n._?oH("Already initialized"):i.push(lH(o||null))}),ape=(t,e)=>sH(e,iH("metadata"),t[3]),lpe=(t,e,n,r)=>{for(var i=0,o=t[e>>1],s=o&&o.length;i<s;i++)o[i].call(n);return r},Be=(t,e,n,r,i,o)=>{for(var s,a,l,c,d=e&7,u=!1,p=!1,f=2,y=aH[d+5],v=t[f]||(t[f]=[]),x=(i=i.prototype,ipe(i,n)),b=r.length-1;b>=0;b--)l=spe(d,n,a={},t[3],v),l.static=u,l.private=p,c=l.access={has:w=>n in w},c.get=w=>w[n],s=(0,r[b])(x[y],l),a._=1,lH(s)&&(x[y]=s);return x&&rH(i,n,x),i},tt=(t,e,n)=>sH(t,typeof e!="symbol"?e+"":e,n),cH,uH,dH,hH,pH,fH,gH,mH,yH,vH,xH,SH,bH,wH,kH,IH,_H,CH,PH,TH,EH,AH,MH,OH,DH,jH,RH,$H,NH,LH,zH,FH,BH,UH,HH,WH,VH,KH,qH,GH,YH,XH,ZH,JH,QH,e7,t7,n7,r7,i7,o7,s7,a7,l7,c7,u7,d7,h7,p7,f7,g7,m7,y7,v7,x7,S7,b7,w7,k7,I7,_7,ET,Le;let Ne=class extends(ET=mue,_7=[fe],I7=[fe],k7=[fe],w7=[fe],b7=[fe],S7=[fe],x7=[fe],v7=[fe],y7=[fe],m7=[fe],g7=[fe],f7=[fe],p7=[fe],h7=[fe],d7=[fe],u7=[fe],c7=[fe],l7=[fe],a7=[fe],s7=[fe],o7=[fe],i7=[fe],r7=[fe],n7=[fe],t7=[fe],e7=[fe],QH=[fe],JH=[fe],ZH=[fe],XH=[fe],YH=[fe],GH=[fe],qH=[fe],KH=[fe],VH=[fe],WH=[fe],HH=[fe],UH=[fe],BH=[fe],FH=[fe],zH=[fe],LH=[fe],NH=[fe],$H=[fe],RH=[fe],jH=[fe],DH=[fe],OH=[fe],MH=[fe],AH=[fe],EH=[fe],TH=[fe],PH=[fe],CH=[fe],_H=[fe],IH=[fe],kH=[fe],wH=[fe],bH=[fe],SH=[fe],xH=[fe],vH=[fe],yH=[fe],mH=[fe({isEqual:(e,n)=>e.equals(n)})],gH=[fe],fH=[fe],pH=[fe],hH=[qo],dH=[qo],uH=[qo],cH=[qo],ET){constructor({store:e,user:n,shapeUtils:r,bindingUtils:i,tools:o,getContainer:s,cameraOptions:a,textOptions:l,initialState:c,autoFocus:d,inferDarkMode:u,options:p,getShapeVisibility:f,fontAssetUrls:y}){super(),lpe(Le,5,this),tt(this,"id",Qt()),tt(this,"_getShapeVisibility"),tt(this,"options"),tt(this,"contextId",Qt()),tt(this,"store"),tt(this,"root"),tt(this,"disposables",new Set),tt(this,"isDisposed",!1),tt(this,"_tickManager"),tt(this,"snaps"),tt(this,"timers",yb.forContext(this.contextId)),tt(this,"user"),tt(this,"textMeasure"),tt(this,"fonts"),tt(this,"scribbles"),tt(this,"sideEffects"),tt(this,"edgeScrollManager"),tt(this,"focusManager"),tt(this,"getContainer"),tt(this,"shapeUtils"),tt(this,"styleProps"),tt(this,"bindingUtils"),tt(this,"history"),tt(this,"_shouldIgnoreShapeLock",!1),tt(this,"_crashingError",null),tt(this,"_isChangingStyleTimeout",-1),tt(this,"menus",ho.forContext(this.contextId)),tt(this,"_currentRichTextEditor",qt("rich text editor",null)),tt(this,"_textOptions"),tt(this,"_cameraOptions",qt("camera options",Kz)),tt(this,"_viewportAnimation",null),tt(this,"_willSetInitialBounds",!0),tt(this,"_isLockedOnFollowingUser",qt("isLockedOnFollowingUser",!1)),tt(this,"_cameraState",qt("camera state","idle")),tt(this,"_cameraStateTimeoutRemaining",0),tt(this,"_currentPageShapeIds"),tt(this,"_shapeGeometryCaches",{}),tt(this,"_notVisibleShapes",Hde(this)),tt(this,"_parentIdsToChildIds"),tt(this,"animatingShapes",new Map),tt(this,"externalAssetContentHandlers",{file:null,url:null}),tt(this,"temporaryAssetPreview",new Map),tt(this,"externalContentHandlers",{text:null,files:null,"file-replace":null,embed:null,"svg-text":null,url:null,tldraw:null,excalidraw:null}),tt(this,"inputs",{originPagePoint:new T,originScreenPoint:new T,previousPagePoint:new T,previousScreenPoint:new T,currentPagePoint:new T,currentScreenPoint:new T,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,isSpacebarPanning:!1,pointerVelocity:new T}),tt(this,"_clickManager",new c0(this)),tt(this,"_prevCursor","default"),tt(this,"_shiftKeyTimeout",-1),tt(this,"_altKeyTimeout",-1),tt(this,"_ctrlKeyTimeout",-1),tt(this,"_metaKeyTimeout",-1),tt(this,"_restoreToolId","select"),tt(this,"_pinchStart",1),tt(this,"_didPinch",!1),tt(this,"_selectedShapeIdsAtPointerDown",[]),tt(this,"_longPressTimeout",-1),tt(this,"capturedPointerId",null),tt(this,"performanceTracker"),tt(this,"performanceTrackerTimeout",-1),tt(this,"handledEvents",new WeakSet),tt(this,"_pendingEventsForNextTick",[]),this._getShapeVisibility=f,this.options={...Ade,...p},this.store=e,this.history=new rhe({store:e,annotateError:j=>{this.annotateError(j,{origin:"history.batch",willCrashApp:!0}),this.crash(j)}}),this.snaps=new ev(this),this.disposables.add(this.timers.dispose),this._cameraOptions.set({...Kz,...a}),this._textOptions=qt("text options",l??null),this.user=new Ii(n??g8(),u??!1),this.disposables.add(()=>this.user.dispose()),this.getContainer=s,this.textMeasure=new zhe(this),this.disposables.add(()=>this.textMeasure.dispose()),this.fonts=new nhe(this,y),this._tickManager=new h0(this);class v extends npe{static initial=c??""}this.root=new v(this),this.root.children={},this.markEventAsHandled=this.markEventAsHandled.bind(this);const x=_8(r),b={},w={},_=new Map;for(const j of x){const F=new j(this);b[j.type]=F;const z=gU(j.props??{});w[j.type]=z;for(const $ of z.keys())if(!_.has($.id))_.set($.id,$);else if(_.get($.id)!==$)throw Error(`Multiple style props with id "${$.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=b,this.styleProps=w;const C=S8(i),A={};for(const j of C){const F=new j(this);A[j.type]=F}this.bindingUtils=A;for(const j of[...o]){if(sa(this.root.children,j.id))throw Error(`Can't override tool with id "${j.id}"`);this.root.children[j.id]=new j(this,this.root)}this.scribbles=new lhe(this);const E=(j,F)=>{let z=null;const $=j.selectedShapeIds.filter(re=>!F.has(re));$.length!==j.selectedShapeIds.length&&(z||(z={...j}),z.selectedShapeIds=$);const V=j.erasingShapeIds.filter(re=>!F.has(re));V.length!==j.erasingShapeIds.length&&(z||(z={...j}),z.erasingShapeIds=V),j.hoveredShapeId&&F.has(j.hoveredShapeId)&&(z||(z={...j}),z.hoveredShapeId=null),j.editingShapeId&&F.has(j.editingShapeId)&&(z||(z={...j}),z.editingShapeId=null);const Y=j.hintingShapeIds.filter(re=>!F.has(re));return Y.length!==j.hintingShapeIds.length&&(z||(z={...j}),z.hintingShapeIds=Y),j.focusedGroupId&&F.has(j.focusedGroupId)&&(z||(z={...j}),z.focusedGroupId=null),z};this.sideEffects=this.store.sideEffects;let O=new Map;const D=new Set,B=new Set;let L=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler(()=>{D.clear();for(const j of B){B.delete(j);const F=this.getShape(j);if(!F)continue;const $=this.getShapeUtil(F).onChildrenChange?.(F);$?.length&&this.updateShapes($)}if(L.size){const j=L;L=new Set;for(const F of j)this.getBindingUtil(F).onOperationComplete?.()}if(O.size){const j=O;O=new Map;for(const F of j.values())this.getBindingUtil(F.binding).onAfterDelete?.(F)}this.emit("update")})),this.disposables.add(this.sideEffects.register({shape:{afterChange:(j,F)=>{for(const z of this.getBindingsInvolvingShape(F))L.add(z.type),z.fromId===F.id&&this.getBindingUtil(z).onAfterChangeFromShape?.({binding:z,shapeBefore:j,shapeAfter:F,reason:"self"}),z.toId===F.id&&this.getBindingUtil(z).onAfterChangeToShape?.({binding:z,shapeBefore:j,shapeAfter:F,reason:"self"});if(j.parentId!==F.parentId){const z=$=>{const V=this.getShape($);if(V)for(const Y of this.getBindingsInvolvingShape(V))L.add(Y.type),Y.fromId===V.id&&this.getBindingUtil(Y).onAfterChangeFromShape?.({binding:Y,shapeBefore:V,shapeAfter:V,reason:"ancestry"}),Y.toId===V.id&&this.getBindingUtil(Y).onAfterChangeToShape?.({binding:Y,shapeBefore:V,shapeAfter:V,reason:"ancestry"})};z(F.id),this.visitDescendants(F.id,z)}if(j.parentId!==F.parentId&&hi(F.parentId)){const z=new Set([j.id]);this.visitDescendants(j.id,$=>{z.add($)});for(const $ of this.getPageStates()){if($.pageId===F.parentId)continue;const V=E($,z);V&&this.store.put([V])}}j.parentId&&co(j.parentId)&&B.add(j.parentId),F.parentId!==j.parentId&&co(F.parentId)&&B.add(F.parentId)},beforeDelete:j=>{if(D.has(j.id))return;j.parentId&&co(j.parentId)&&B.add(j.parentId),D.add(j.id);const F=[];for(const V of this.getBindingsInvolvingShape(j)){L.add(V.type),F.push(V.id);const Y=this.getBindingUtil(V);V.fromId===j.id?(Y.onBeforeIsolateToShape?.({binding:V,removedShape:j}),Y.onBeforeDeleteFromShape?.({binding:V,shape:j})):(Y.onBeforeIsolateFromShape?.({binding:V,removedShape:j}),Y.onBeforeDeleteToShape?.({binding:V,shape:j}))}F.length&&this.deleteBindings(F);const z=new Set([j.id]),$=ut(this.getPageStates().map(V=>E(V,z)));$.length&&this.store.put($)}},binding:{beforeCreate:j=>{const F=this.getBindingUtil(j).onBeforeCreate?.({binding:j});return F||j},afterCreate:j=>{L.add(j.type),this.getBindingUtil(j).onAfterCreate?.({binding:j})},beforeChange:(j,F)=>{const z=this.getBindingUtil(F).onBeforeChange?.({bindingBefore:j,bindingAfter:F});return z||F},afterChange:(j,F)=>{L.add(F.type),this.getBindingUtil(F).onAfterChange?.({bindingBefore:j,bindingAfter:F})},beforeDelete:j=>{this.getBindingUtil(j).onBeforeDelete?.({binding:j})},afterDelete:j=>{this.getBindingUtil(j).onAfterDelete?.({binding:j}),L.add(j.type)}},page:{afterCreate:j=>{const F=yl.createId(j.id),z=$a.createId(j.id);this.store.has(F)||this.store.put([yl.create({id:F})]),this.store.has(z)||this.store.put([$a.create({id:z,pageId:j.id})])},afterDelete:(j,F)=>{if(this.getInstanceState()?.currentPageId===j.id){const V=this.getPages().find(Y=>Y.id!==j.id)?.id;V?this.store.put([{...this.getInstanceState(),currentPageId:V}]):F==="user"&&this.store.ensureStoreIsUsable()}const z=yl.createId(j.id),$=$a.createId(j.id);this.store.remove([z,$])}},instance:{afterChange:(j,F,z)=>{if(!this.store.has(F.currentPageId)){const $=this.store.has(j.currentPageId)?j.currentPageId:this.getPages()[0]?.id;$?this.store.update(F.id,V=>({...V,currentPageId:$})):z==="user"&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(j,F)=>{if(j?.selectedShapeIds!==F?.selectedShapeIds){const z=F.selectedShapeIds.filter(V=>{let Y=this.getShape(V)?.parentId;for(;co(Y);){if(F.selectedShapeIds.includes(Y))return!1;Y=this.getShape(Y)?.parentId}return!0});let $=null;if(z.length>0){const V=this.findCommonAncestor(ut(z.map(Y=>this.getShape(Y))),Y=>this.isShapeOfType(Y,"group"));V&&($=V)}else F?.focusedGroupId&&($=F.focusedGroupId);(z.length!==F.selectedShapeIds.length||$!==F.focusedGroupId)&&this.store.put([{...F,selectedShapeIds:z,focusedGroupId:$??null}])}}}})),this._currentPageShapeIds=Vde(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=Wde(this.store),this.disposables.add(this.store.listen(j=>{this.emit("change",j)})),this.disposables.add(this.history.dispose),this.run(()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})},{history:"ignore"}),c&&this.root.children[c]===void 0)throw Error(`No state found for initialState "${c}".`);if(this.root.enter(void 0,"initial"),this.edgeScrollManager=new ehe(this),this.focusManager=new the(this,d),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame(()=>{this._tickManager.start()}),this.performanceTracker=new c5,this.store.props.collaboration?.mode){const j=this.store.props.collaboration.mode;this.disposables.add(mo("update collaboration mode",()=>{this.store.put([{...this.getInstanceState(),isReadonly:j.get()==="readonly"}])}))}}getIsShapeHiddenCache(){return this._getShapeVisibility?this.store.createComputedCache("isShapeHidden",e=>{const n=this._getShapeVisibility(e,this);return(yo.isId(e.parentId)?!1:this.isShapeHidden(e.parentId))?n!=="visible":n==="hidden"}):null}isShapeHidden(e){return this._getShapeVisibility?!!this.getIsShapeHiddenCache().get(typeof e=="string"?e:e.id):!1}dispose(){this.disposables.forEach(e=>e()),this.disposables.clear(),this.store.dispose(),this.isDisposed=!0}getShapeUtil(e){const n=typeof e=="string"?e:e.type,r=wr(this.shapeUtils,n);return Ge(r,`No shape util found for type "${n}"`),r}hasShapeUtil(e){const n=typeof e=="string"?e:e.type;return sa(this.shapeUtils,n)}getBindingUtil(e){const n=typeof e=="string"?e:e.type,r=wr(this.bindingUtils,n);return Ge(r,`No binding util found for type "${n}"`),r}undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}clearHistory(){return this.history.clear(),this}getCanRedo(){return this.history.getNumRedos()>0}markHistoryStoppingPoint(e){const n=`[${e??"stop"}]_${Qt()}`;return this.history._mark(n),n}getMarkIdMatching(e){return this.history.getMarkIdMatching(e)}squashToMark(e){return this.history.squashToMark(e),this}bail(){return this.history.bail(),this}bailToMark(e){return this.history.bailToMark(e),this}run(e,n){const r=this._shouldIgnoreShapeLock;this._shouldIgnoreShapeLock=n?.ignoreShapeLock??r;try{this.history.batch(e,n)}finally{this._shouldIgnoreShapeLock=r}return this}annotateError(e,{origin:n,willCrashApp:r,tags:i,extras:o}){const s=this.createErrorAnnotations(n,r);return c2(e,{tags:{...s.tags,...i},extras:{...s.extras,...o}}),r&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(e,n){try{const r=this.getEditingShapeId();return{tags:{origin:e,willCrashApp:n},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes().map(i=>{const{props:o,...s}=i,{text:a,richText:l,...c}=o;return{...s,props:c}}),selectionCount:this.getSelectedShapes().length,editingShape:r?this.getShape(r):void 0,inputs:this.inputs,pageState:this.getCurrentPageState(),instanceState:this.getInstanceState(),collaboratorCount:this.getCollaboratorsOnCurrentPage().length}}}catch{return{tags:{origin:e,willCrashApp:n},extras:{}}}}getCrashingError(){return this._crashingError}crash(e){return this._crashingError=e,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:e}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(e){const n=e.split(".").reverse();let r=this.root;for(;n.length>0;){const i=n.pop();if(!i)return!0;const o=r.getCurrent();if(o?.id===i){if(n.length===0)return!0;r=o;continue}else return!1}return!1}isInAny(...e){return e.some(n=>this.isIn(n))}setCurrentTool(e,n={}){return this.root.transition(e,n),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const e=this.getCurrentTool();return e?e.getCurrentToolIdMask()??e.id:""}getStateDescendant(e){const n=e.split(".").reverse();let r=this.root;for(;n.length>0;){const i=n.pop();if(!i)return r;const o=r.children?.[i];if(!o)return;r=o}return r}getDocumentSettings(){return this.store.get(xT)}updateDocumentSettings(e){return this.run(()=>{this.store.put([{...this.getDocumentSettings(),...e}])},{history:"ignore"}),this}getInstanceState(){return this.store.get(uo)}updateInstanceState(e,n){return this._updateInstanceState(e,{history:"ignore",...n}),e.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),e.isChangingStyle===!0&&(this._isChangingStyleTimeout=this.timers.setTimeout(()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})},1e3))),this}_updateInstanceState(e,n){this.run(()=>{this.store.put([{...this.getInstanceState(),...e}])},n)}setCursor(e){return this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...e}}),this}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return $a.createId(this.getCurrentPageId())}updateCurrentPageState(e){return this._updateCurrentPageState(e),this}_updateCurrentPageState(e){this.store.update(e.id??this.getCurrentPageState().id,n=>({...n,...e}))}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){return ut(this.getSelectedShapeIds().map(e=>this.store.get(e)))}setSelectedShapes(e){return this.run(()=>{const n=e.map(o=>typeof o=="string"?o:o.id),{selectedShapeIds:r}=this.getCurrentPageState(),i=new Set(r);if(n.length===i.size&&n.every(o=>i.has(o)))return null;this.store.put([{...this.getCurrentPageState(),selectedShapeIds:n}])},{history:"record-preserveRedoStack"})}isAncestorSelected(e){const n=typeof e=="string"?e:e?.id??null,r=this.getShape(n);if(!r)return!1;const i=this.getSelectedShapeIds();return!!this.findShapeAncestor(r,o=>i.includes(o.id))}select(...e){const n=typeof e[0]=="string"?e:e.map(r=>r.id);return this.setSelectedShapes(n),this}deselect(...e){const n=typeof e[0]=="string"?e:e.map(i=>i.id),r=this.getSelectedShapeIds();return r.length>0&&n.length>0&&this.setSelectedShapes(r.filter(i=>!n.includes(i))),this}selectAll(){let e=null;const n=this.getSelectedShapeIds();if(n.length>0)for(const i of n){const o=this.getShape(i);if(o){if(e===null)e=o.parentId;else if(e!==o.parentId)return this}}e||(e=this.getCurrentPageId());const r=this.getSortedChildIdsForParent(e);return r.length<=0?this:(this.setSelectedShapes(this._getUnlockedShapeIds(r)),this)}selectAdjacentShape(e){const n=this.getSelectedShapeIds(),r=n[0]?this.getShape(n[0])?.parentId:null,i=r&&n.every(d=>this.getShape(d)?.parentId===r)&&!hi(r),o=i?this.getCurrentPageShapes().filter(d=>d.parentId===r):this.getCurrentPageShapes().filter(d=>hi(d.parentId)),s=i?this._getShapesInReadingOrder(o):this.getCurrentPageShapesInReadingOrder(),a=n.length===1?n[0]:s.find(d=>n.includes(d.id))?.id;let l;if(e==="next"||e==="prev"){const d=s.map(f=>f.id),p=((a?d.indexOf(a):-1)+(e==="next"?1:-1)+d.length)%d.length;l=d[p]}else{if(!a)return;l=this.getNearestAdjacentShape(o,a,e)}const c=this.getShape(l);c&&this._selectShapesAndZoom([c.id])}getCurrentPageShapesInReadingOrder(){const e=this.getCurrentPageShapes().filter(n=>hi(n.parentId));return this._getShapesInReadingOrder(e)}_getShapesInReadingOrder(e){const i=e.filter(a=>this.getShapeUtil(a).canTabTo(a));if(i.length<=1)return i;const o=i.map(a=>({shape:a,center:this.getShapePageBounds(a).center}));o.sort((a,l)=>a.center.y-l.center.y);const s=[];for(const a of o){let l=-1;for(let c=s.length-1;c>=0;c--){const d=s[c],u=d[d.length-1];if(Math.abs(a.center.y-u.center.y)<100){l=c;break}}l===-1?s.push([a]):s[l].push(a)}for(const a of s)a.sort((l,c)=>l.center.x-c.center.x);for(const a of s)if(!(a.length<=2))for(let l=0;l<a.length-2;l++){const c=a[l],d=a[l+1],u=a[l+2],p=T.Dist2(c.center,d.center);T.Dist2(c.center,u.center)<p*.9&&Math.abs(T.Angle(c.center,u.center)*(180/Math.PI))<=20&&([a[l+1],a[l+2]]=[a[l+2],a[l+1]])}return s.flat().map(a=>a.shape)}getNearestAdjacentShape(e,n,r){const i={right:0,left:180,down:90,up:270},o=this.getShape(n);if(!o)return n;const s=e.filter(u=>this.getShapeUtil(u).canTabTo(u)&&u.id!==n);if(!s.length)return n;const a=this.getShapePageBounds(o).center,c=s.map(u=>({shape:u,center:this.getShapePageBounds(u).center})).filter(({center:u})=>{const p=u.x>a.x,f=u.y>a.y,y=u.x-a.x,v=u.y-a.y,x=Math.abs(v)<Math.abs(y)*2,b=Math.abs(y)<Math.abs(v)*2;if(r==="left"||r==="right")return x&&(r==="right"?p:!p);if(r==="up"||r==="down")return b&&(r==="down"?f:!f)});return c.length===0?n:t5(c,({center:u})=>{const p=T.Dist2(a,u),f=["left","right"].includes(r)?"x":"y",y=Math.abs(u[f]-a[f]),v=["left","right"].includes(r)?"y":"x",x=Math.abs(u[v]-a[v]),b=Math.abs(T.Angle(a,u)*(180/Math.PI)),w=Math.abs(b-i[r]);return p*1+x*2+(p-y)*1.5+w*.5}).shape.id}selectParentShape(){const e=this.getOnlySelectedShape();if(!e)return;const n=this.getShape(e.parentId);n&&this._selectShapesAndZoom([n.id])}selectFirstChildShape(){const e=this.getSelectedShapes();if(!e.length)return;const n=e[0],r=this.getSortedChildIdsForParent(n.id).map(o=>this.getShape(o)).filter(o=>o),i=this._getShapesInReadingOrder(r);i.length!==0&&this._selectShapesAndZoom([i[0].id])}_selectShapesAndZoom(e){this.setSelectedShapes(e),this.zoomToSelectionIfOffscreen(256,{animation:{duration:this.options.animationMediumMs},inset:0})}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){return this.getOnlySelectedShape()?.id??null}getOnlySelectedShape(){const e=this.getSelectedShapes();return e.length===1?e[0]:null}getShapesPageBounds(e){const n=ut(e.map(r=>this.getShapePageBounds(r)));return n.length===0?null:pe.Common(n)}getSelectionPageBounds(){return this.getShapesPageBounds(this.getSelectedShapeIds())}getSelectionScreenBounds(){const e=this.getSelectionPageBounds();if(!e)return;const{x:n,y:r}=this.pageToScreen(e.point),i=this.getZoomLevel();return new pe(n,r,e.width*i,e.height*i)}getShapesSharedRotation(e){let n=!1,r=0;for(let i=0,o=e.length;i<o;i++){const s=this.getShapePageTransform(e[i]);if(s)if(n){if(s.rotation()!==r)return 0}else n=!0,r=s.rotation()}return r}getSelectionRotation(){return this.getShapesSharedRotation(this.getSelectedShapeIds())}getShapesRotatedPageBounds(e){if(e.length===0)return;const n=this.getShapesSharedRotation(e);if(n===0)return this.getShapesPageBounds(e)??void 0;if(e.length===1){const i=this.getShapeGeometry(e[0]).bounds.clone(),o=this.getShapePageTransform(e[0]);return i.point=o.applyToPoint(i.point),i}const r=pe.FromPoints(e.flatMap(i=>{const o=this.getShapePageTransform(i);return o?o.applyToPoints(this.getShapeGeometry(i).bounds.corners):[]}).map(i=>i.rot(-n)));return r.point=r.point.rot(n),r}getSelectionRotatedPageBounds(){return this.getShapesRotatedPageBounds(this.getSelectedShapeIds())}getSelectionRotatedScreenBounds(){const e=this.getSelectionRotatedPageBounds();if(!e)return;const{x:n,y:r}=this.pageToScreen(e.point),i=this.getZoomLevel();return new pe(n,r,e.width*i,e.height*i)}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const e=this.getFocusedGroupId();return e?this.getShape(e):void 0}setFocusedGroup(e){const n=typeof e=="string"?e:e?.id??null;if(n!==null){const r=this.getShape(n);if(!r)throw Error(`Editor.setFocusedGroup: Shape with id ${n} does not exist`);if(!this.isShapeOfType(r,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${r.type}`)}return n===this.getFocusedGroupId()?this:this.run(()=>{this.store.update(this.getCurrentPageState().id,r=>({...r,focusedGroupId:n}))},{history:"record-preserveRedoStack"})}popFocusedGroupId(){const e=this.getFocusedGroup();if(e){const n=this.findShapeAncestor(e,r=>this.isShapeOfType(r,"group"));this.setFocusedGroup(n?.id??null),this.select(e.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const e=this.getEditingShapeId();return e?this.getShape(e):void 0}setEditingShape(e){const n=typeof e=="string"?e:e?.id??null;this.setRichTextEditor(null);const r=this.getEditingShapeId();if(n!==r){if(n){const i=this.getShape(n);if(i&&this.getShapeUtil(i).canEdit(i))return this.run(()=>{if(this._updateCurrentPageState({editingShapeId:n}),r){const o=this.getShape(r);o&&this.getShapeUtil(o).onEditEnd?.(o)}this.getShapeUtil(i).onEditStart?.(i)},{history:"ignore"}),this}this.run(()=>{if(this._updateCurrentPageState({editingShapeId:null}),this._currentRichTextEditor.set(null),r){const i=this.getShape(r);i&&this.getShapeUtil(i).onEditEnd?.(i)}},{history:"ignore"})}return this}getRichTextEditor(){return this._currentRichTextEditor.get()}setRichTextEditor(e){return this._currentRichTextEditor.set(e),this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const e=this.getHoveredShapeId();return e?this.getShape(e):void 0}setHoveredShape(e){const n=typeof e=="string"?e:e?.id??null;return n===this.getHoveredShapeId()?this:(this.run(()=>{this.updateCurrentPageState({hoveredShapeId:n})},{history:"ignore"}),this)}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const e=this.getHintingShapeIds();return ut(e.map(n=>this.getShape(n)))}setHintingShapes(e){const n=typeof e[0]=="string"?e:e.map(r=>r.id);return this.run(()=>{this._updateCurrentPageState({hintingShapeIds:a2(n)})},{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const e=this.getErasingShapeIds();return ut(e.map(n=>this.getShape(n)))}setErasingShapes(e){const n=typeof e[0]=="string"?e:e.map(i=>i.id);n.sort();const r=this.getErasingShapeIds();return this.run(()=>{if(n.length===r.length){for(let i=0;i<n.length;i++)if(n[i]!==r[i]){this._updateCurrentPageState({erasingShapeIds:n});break}}else this._updateCurrentPageState({erasingShapeIds:n})},{history:"ignore"}),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(e){const n=typeof e=="string"?e:e?.id??null;return n!==this.getCroppingShapeId()&&this.run(()=>{if(!n)this.updateCurrentPageState({croppingShapeId:null});else{const r=this.getShape(n),i=this.getShapeUtil(r);r&&i.canCrop(r)&&this.updateCurrentPageState({croppingShapeId:n})}},{history:"ignore"}),this}getTextOptions(){return Gr(this._textOptions.get(),"Cannot use text without setting textOptions")}_unsafe_getCameraId(){return yl.createId(this.getCurrentPageId())}getCamera(){const e=this.store.get(this._unsafe_getCameraId());if(this._isLockedOnFollowingUser.get()){const n=this.getCameraForFollowing();if(n)return{...e,...n}}return e}_getFollowingPresence(e){const n=[this.user.getId()],r=this.getCollaborators();let i=null;for(;e&&!n.includes(e);)i=r.find(o=>o.userId===e)??null,e=i?.followingUserId??null,i&&n.push(i.userId);return i}getViewportPageBoundsForFollowing(){const e=this._getFollowingPresence(this.getInstanceState().followingUserId);if(!e?.camera||!e?.screenBounds)return null;const{w:n,h:r}=e.screenBounds,{x:i,y:o,z:s}=e.camera,a=new pe(-i,-o,n/s,r/s),l=this.getViewportScreenBounds().clone(),c=l.width/l.height;return l.width=a.width,l.height=l.width/c,l.height<a.height&&(l.height=a.height,l.width=l.height*c),l.center=a.center,l}getCameraForFollowing(){const e=this.getViewportPageBoundsForFollowing();return e?{x:-e.x,y:-e.y,z:this.getViewportScreenBounds().w/e.width}:null}getZoomLevel(){return this.getCamera().z}getInitialZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.initialZoom==="default")return 1;const{zx:n,zy:r}=x4(this,e);switch(e.constraints.initialZoom){case"fit-min":return Math.max(n,r);case"fit-max":return Math.min(n,r);case"fit-x":return n;case"fit-y":return r;case"fit-min-100":return Math.min(1,Math.max(n,r));case"fit-max-100":return Math.min(1,Math.min(n,r));case"fit-x-100":return Math.min(1,n);case"fit-y-100":return Math.min(1,r);default:throw Wt(e.constraints.initialZoom)}}getBaseZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.baseZoom==="default")return 1;const{zx:n,zy:r}=x4(this,e);switch(e.constraints.baseZoom){case"fit-min":return Math.max(n,r);case"fit-max":return Math.min(n,r);case"fit-x":return n;case"fit-y":return r;case"fit-min-100":return Math.min(1,Math.max(n,r));case"fit-max-100":return Math.min(1,Math.min(n,r));case"fit-x-100":return Math.min(1,n);case"fit-y-100":return Math.min(1,r);default:throw Wt(e.constraints.baseZoom)}}getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(e){const n=fn({...this._cameraOptions.__unsafe__getWithoutCapture(),...e});return n.zoomSteps?.length<1&&(n.zoomSteps=[1]),this._cameraOptions.set(n),this.setCamera(this.getCamera()),this}getConstrainedCamera(e,n){const r=this.getCamera();let{x:i,y:o,z:s=r.z}=e;if(!n?.force){const a=this.getCameraOptions(),l=a.zoomSteps[0],c=gi(a.zoomSteps),d=this.getViewportScreenBounds();if(a.constraints){const{constraints:u}=a,p=Math.min(u.padding.y,d.w/2),f=Math.min(u.padding.x,d.h/2),y=pe.From(a.constraints.bounds),v=(d.w-f*2)/y.w,x=(d.h-p*2)/y.h,b=this.getBaseZoom(),w=c*b,_=l*b;if(n?.reset&&(s=this.getInitialZoom()),s<_||s>w){const{x:F,y:z,z:$}=r,V=-F+d.w/$/2,Y=-z+d.h/$/2;s=pt(s,_,w);const re=-F+d.w/s/2,q=-z+d.h/s/2;i=F+re-V,o=z+q-Y}const C=f/s-y.x,A=p/s-y.y,E=(d.w-f*2)/s-y.w,O=(d.h-p*2)/s-y.h,D=C+E*u.origin.x,B=A+O*u.origin.y,L=typeof u.behavior=="string"?u.behavior:u.behavior.x,j=typeof u.behavior=="string"?u.behavior:u.behavior.y;if(n?.reset)i=D,o=B;else{switch(L){case"fixed":{i=D;break}case"contain":{s<v?i=D:i=pt(i,C+E,C);break}case"inside":{s<v?i=pt(i,C,(d.w-f)/s-y.w):i=pt(i,C+E,C);break}case"outside":{i=pt(i,f/s-y.w,(d.w-f)/s);break}case"free":break;default:throw Wt(L)}switch(j){case"fixed":{o=B;break}case"contain":{s<x?o=B:o=pt(o,A+O,A);break}case"inside":{s<x?o=pt(o,A,(d.h-p)/s-y.h):o=pt(o,A+O,A);break}case"outside":{o=pt(o,p/s-y.h,(d.h-p)/s);break}case"free":break;default:throw Wt(j)}}}else if(s>c||s<l){const{x:u,y:p,z:f}=r;s=pt(s,l,c),i=u+(-u+d.w/s/2)-(-u+d.w/f/2),o=p+(-p+d.h/s/2)-(-p+d.h/f/2)}}return{x:i,y:o,z:s}}_setCamera(e,n){const r=this.getCamera(),{x:i,y:o,z:s}=this.getConstrainedCamera(e,n);return r.x===i&&r.y===o&&r.z===s?this:(ws(()=>{const a={...r,x:i,y:o,z:s};this.run(()=>{this.store.put([a])},{history:"ignore"});const{currentScreenPoint:l,currentPagePoint:c}=this.inputs;(l.x/s-i!==c.x||l.y/s-o!==c.y)&&this.updatePointer({immediate:n?.immediate,pointerId:qz.CAMERA_MOVE}),this._tickCameraState()}),this)}setCamera(e,n){const{isLocked:r}=this._cameraOptions.__unsafe__getWithoutCapture();if(r&&!n?.force)return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();const i=T.Cast(e);Number.isFinite(i.x)||(i.x=0),Number.isFinite(i.y)||(i.y=0),(i.z===void 0||!Number.isFinite(i.z))&&(e.z=this.getZoomLevel());const o=this.getConstrainedCamera(i,n);if(n?.animation){const{width:s,height:a}=this.getViewportScreenBounds();this._animateToViewport(new pe(-o.x,-o.y,s/o.z,a/o.z),n)}else this._setCamera(o,{...n,force:!0});return this}centerOnPoint(e,n){const{isLocked:r}=this.getCameraOptions();if(r&&!n?.force)return this;const{width:i,height:o}=this.getViewportPageBounds();return this.setCamera(new T(-(e.x-i/2),-(e.y-o/2),this.getCamera().z),n),this}zoomToFit(e){const n=[...this.getCurrentPageShapeIds()];if(n.length<=0)return this;const r=pe.Common(ut(n.map(i=>this.getShapePageBounds(i))));return this.zoomToBounds(r,e),this}resetZoom(e=this.getViewportScreenCenter(),n){const{isLocked:r,constraints:i}=this.getCameraOptions();if(r&&!n?.force)return this;const o=this.getCamera(),{x:s,y:a,z:l}=o,{x:c,y:d}=e;let u=1;if(i){const p=this.getInitialZoom();l!==p&&(u=p)}return this.setCamera(new T(s+(c/u-c)-(c/l-c),a+(d/u-d)-(d/l-d),u),n),this}zoomIn(e=this.getViewportScreenCenter(),n){const{isLocked:r}=this.getCameraOptions();if(r&&!n?.force)return this;const{x:i,y:o,z:s}=this.getCamera(),{zoomSteps:a}=this.getCameraOptions();if(a!==null&&a.length>1){const l=this.getBaseZoom();let c=gi(a)*l;for(let d=1;d<a.length;d++){const u=a[d-1]*l,p=a[d]*l;if(!(p-s<=(p-u)/2)){c=p;break}}this.setCamera(new T(i+(e.x/c-e.x)-(e.x/s-e.x),o+(e.y/c-e.y)-(e.y/s-e.y),c),n)}return this}zoomOut(e=this.getViewportScreenCenter(),n){const{isLocked:r}=this.getCameraOptions();if(r&&!n?.force)return this;const{zoomSteps:i}=this.getCameraOptions();if(i!==null&&i.length>1){const o=this.getBaseZoom(),{x:s,y:a,z:l}=this.getCamera();let c=i[0]*o;for(let d=i.length-1;d>0;d--){const u=i[d-1]*o,p=i[d]*o;if(!(p-l>=(p-u)/2)){c=u;break}}this.setCamera(new T(s+(e.x/c-e.x)-(e.x/l-e.x),a+(e.y/c-e.y)-(e.y/l-e.y),c),n)}return this}zoomToSelection(e){const{isLocked:n}=this.getCameraOptions();if(n&&!e?.force)return this;const r=this.getSelectionPageBounds();return r&&this.zoomToBounds(r,{targetZoom:Math.max(1,this.getZoomLevel()),...e}),this}zoomToSelectionIfOffscreen(e=16,n){const r=this.getSelectionPageBounds(),i=this.getViewportPageBounds();if(r&&!i.contains(r)){const o=r.clone().expandBy(e/this.getZoomLevel()).expand(i),s=i.clone().translate({x:(o.center.x-i.center.x)*2,y:(o.center.y-i.center.y)*2});this.zoomToBounds(s,n)}}zoomToBounds(e,n){const r=this._cameraOptions.__unsafe__getWithoutCapture();if(r.isLocked&&!n?.force)return this;const i=this.getViewportScreenBounds(),o=n?.inset??Math.min(Vce,i.width*.28),s=this.getBaseZoom(),a=r.zoomSteps[0],l=gi(r.zoomSteps);let c=pt(Math.min((i.width-o)/e.w,(i.height-o)/e.h),a*s,l*s);return n?.targetZoom!==void 0&&(c=Math.min(n.targetZoom,c)),this.setCamera(new T(-e.x+(i.width-e.w*c)/2/c,-e.y+(i.height-e.h*c)/2/c,c),n),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(e){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=e;const{elapsed:n,easing:r,duration:i,start:o,end:s}=this._viewportAnimation;if(n>i){this.off("tick",this._animateViewport),this._viewportAnimation=null,this._setCamera(new T(-s.x,-s.y,this.getViewportScreenBounds().width/s.width));return}const a=i-n,l=r(1-a/i),c=o.minX+(s.minX-o.minX)*l,d=o.minY+(s.minY-o.minY)*l,u=o.maxX+(s.maxX-o.maxX)*l;this._setCamera(new T(-c,-d,this.getViewportScreenBounds().width/(u-c)),{force:!0})}_animateToViewport(e,n={animation:$C}){const{animation:r,...i}=n;if(!r)return;const{duration:o=0,easing:s=Ui.easeInOutCubic}=r,a=this.user.getAnimationSpeed(),l=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),o===0||a===0?this._setCamera(new T(-e.x,-e.y,this.getViewportScreenBounds().width/e.width),{...i}):(this._viewportAnimation={elapsed:0,duration:o/a,easing:s,start:l.clone(),end:e.clone()},this.once("stop-camera-animation",()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null}),this.on("tick",this._animateViewport),this)}slideCamera(e={}){const{isLocked:n}=this.getCameraOptions();if(n&&!e?.force)return this;if(this.user.getAnimationSpeed()===0)return this;this.stopCameraAnimation();const{speed:i,friction:o=this.options.cameraSlideFriction,direction:s,speedThreshold:a=.01}=e;let l=Math.min(i,1);const c=()=>{this.off("tick",d),this.off("stop-camera-animation",c)};this.once("stop-camera-animation",c);const d=u=>{const{x:p,y:f,z:y}=this.getCamera(),v=T.Mul(s,l*u/y);l*=1-o,l<a?c():this._setCamera(new T(p+v.x,f+v.y,y))};return this.on("tick",d),this}zoomToUser(e,n={animation:{duration:500}}){const r=this.getCollaborators().find(o=>o.userId===e);if(!r)return this;const i=r.cursor;return i?(this.run(()=>{this.getInstanceState().followingUserId!==null&&this.stopFollowingUser();const o=r.currentPageId===this.getCurrentPageId();o||this.setCurrentPage(r.currentPageId),n&&n.animation&&!o&&(n.animation=void 0),this.centerOnPoint(i,n);const{highlightedUserIds:s}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...s,e]}),this.timers.setTimeout(()=>{const a=[...this.getInstanceState().highlightedUserIds],l=a.indexOf(e);l<0||(a.splice(l,1),this.updateInstanceState({highlightedUserIds:a}))},this.options.collaboratorIdleTimeoutMs)}),this):this}updateViewportScreenBounds(e,n=!1){if(e instanceof pe)e.width=Math.max(e.width,1),e.height=Math.max(e.height,1);else{const a=e.getBoundingClientRect();e=new pe(a.left||a.x,a.top||a.y,Math.max(a.width,1),Math.max(a.height,1))}const r=[e.minY!==0,!Ir(document.body.scrollWidth,e.maxX,1),!Ir(document.body.scrollHeight,e.maxY,1),e.minX!==0],{_willSetInitialBounds:i}=this;this._willSetInitialBounds=!1;const{screenBounds:o,insets:s}=this.getInstanceState();if(e.equals(o)&&r.every((a,l)=>a===s[l]))return this;if(i)this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this.setCamera(this.getCamera());else if(n&&!this.getInstanceState().followingUserId){const a=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this.centerOnPoint(a)}else this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this._setCamera(T.From({...this.getCamera()}));return this._tickCameraState(),this}getViewportScreenBounds(){const{x:e,y:n,w:r,h:i}=this.getInstanceState().screenBounds;return new pe(e,n,r,i)}getViewportScreenCenter(){const e=this.getViewportScreenBounds();return new T(e.w/2,e.h/2)}getViewportPageBounds(){const{w:e,h:n}=this.getViewportScreenBounds(),{x:r,y:i,z:o}=this.getCamera();return new pe(-r,-i,e/o,n/o)}screenToPage(e){const{screenBounds:n}=this.store.unsafeGetWithoutCapture(uo),{x:r,y:i,z:o=1}=this.getCamera();return new T((e.x-n.x)/o-r,(e.y-n.y)/o-i,e.z??.5)}pageToScreen(e){const{screenBounds:n}=this.store.unsafeGetWithoutCapture(uo),{x:r,y:i,z:o=1}=this.getCamera();return new T((e.x+r)*o+n.x,(e.y+i)*o+n.y,e.z??.5)}pageToViewport(e){const{x:n,y:r,z:i=1}=this.getCamera();return new T((e.x+n)*i,(e.y+r)*i,e.z??.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",()=>({userId:{neq:this.user.getId()}}))}getCollaborators(){const e=this._getCollaboratorsQuery().get();return e.length?[...new Set(e.map(r=>r.userId))].sort().map(r=>zoe(e.filter(o=>o.userId===r),o=>o.lastActivityTimestamp??0)):ur}getCollaboratorsOnCurrentPage(){const e=this.getCurrentPageId();return this.getCollaborators().filter(n=>n.currentPageId===e)}startFollowingUser(e){if(this.stopFollowingUser(),this.user.getId()||console.warn("You should set the userId for the current instance before following a user"),!this._getFollowingPresence(e))return this;const i=fe("latestLeaderPresence",()=>this._getFollowingPresence(e));return ws(()=>{this.updateInstanceState({followingUserId:e},{history:"ignore"});const o=mo("update current page",()=>{const l=i.get();if(!l){this.stopFollowingUser();return}l.currentPageId!==this.getCurrentPageId()&&this.getPage(l.currentPageId)&&this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:l.currentPageId}]),this._isLockedOnFollowingUser.set(!0)},{history:"ignore"})}),s=()=>{o(),this._isLockedOnFollowingUser.set(!1),this.off("frame",a),this.off("stop-following",s)},a=()=>{if(!i.get()){this.stopFollowingUser();return}if(this._isLockedOnFollowingUser.get())return;const c=this.user.getAnimationSpeed();if(c===0){this._isLockedOnFollowingUser.set(!0);return}const d=this.getViewportPageBoundsForFollowing();if(!d){this.stopFollowingUser();return}const u=this.getViewportPageBounds(),p=Math.abs(d.minX-u.minX)+Math.abs(d.maxX-u.maxX),f=Math.abs(d.minY-u.minY)+Math.abs(d.maxY-u.maxY);if(p<this.options.followChaseViewportSnap&&f<this.options.followChaseViewportSnap){this._isLockedOnFollowingUser.set(!0);return}const y=pt(c*.5,.1,.8),v=new pe(St(u.minX,d.minX,y),St(u.minY,d.minY,y),St(u.width,d.width,y),St(u.height,d.height,y)),x=new T(-v.x,-v.y,this.getViewportScreenBounds().width/v.width);this.stopCameraAnimation(),this._setCamera(x)};this.once("stop-following",s),this.addListener("frame",a),a()}),this}stopFollowingUser(){return this.run(()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")},{history:"ignore"}),this}getUnorderedRenderingShapes(e){const n=[];let r=this.options.maxShapesPerPage*2,i=this.options.maxShapesPerPage;const o=this.getErasingShapeIds(),s=(l,c,d)=>{const u=this.getShape(l);if(!u)return;if(this.isShapeHidden(u)){const x=d||o.includes(l);for(const b of this.getSortedChildIdsForParent(l))s(b,c,x);return}c*=u.opacity;let p=!1;const f=this.getShapeUtil(u);e&&(p=!d&&o.includes(l),p&&(c*=.32)),n.push({id:l,shape:u,util:f,index:r,backgroundIndex:i,opacity:c}),r+=1,i+=1;const y=this.getSortedChildIdsForParent(l);if(!y.length)return;let v=null;f.providesBackgroundForChildren(u)&&(v=i,i=r,r+=this.options.maxShapesPerPage);for(const x of y)s(x,c,d||p);v!==null&&(i=v)},a=e?[this.getCurrentPage()]:this.getPages();for(const l of a)for(const c of this.getSortedChildIdsForParent(l.id))s(c,1,!1);return n}_decayCameraStateTimeout(e){this._cameraStateTimeoutRemaining-=e,!(this._cameraStateTimeoutRemaining>0)&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"))}_tickCameraState(){this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,this._cameraState.__unsafe__getWithoutCapture()==="idle"&&(this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout))}getCameraState(){return this._cameraState.get()}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(lse)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return Array.from(this._getAllPagesQuery().get()).sort(Yr)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(e){return this.store.get(typeof e=="string"?e:e.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(e){const n=typeof e=="string"?e:e.id,r=this.store.query.exec("shape",{parentId:{eq:n}});return this.getShapeAndDescendantIds(r.map(i=>i.id))}setCurrentPage(e){const n=typeof e=="string"?e:e.id;return this.store.has(n)?(this.stopFollowingUser(),this.complete(),this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:n}]),this.setCamera(this.getCamera())},{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(e){return this.getIsReadonly()?this:this.getPage(e.id)?this.run(()=>this.store.update(e.id,r=>({...r,...e}))):this}createPage(e){return this.run(()=>{if(this.getIsReadonly()||this.getPages().length>=this.options.maxPages)return;const n=this.getPages(),r=$de(e.name??"Page 1",n.map(s=>s.name));let i=e.index;(!i||n.some(s=>s.index===i))&&(i=na(n[n.length-1].index));const o=yo.create({meta:{},...e,name:r,index:i});this.store.put([o])}),this}deletePage(e){const n=typeof e=="string"?e:e.id;return this.run(()=>{if(this.getIsReadonly())return;const r=this.getPages();if(r.length===1)return;const i=this.getPage(n);if(!i)return;if(n===this.getCurrentPageId()){const s=r.findIndex(l=>l.id===n),a=r[s-1]??r[s+1];this.setCurrentPage(a.id)}const o=this.getSortedChildIdsForParent(i.id);this.deleteShapes(o),this.store.remove([i.id])},{ignoreShapeLock:!0}),this}duplicatePage(e,n=yo.createId()){if(this.getPages().length>=this.options.maxPages)return this;const r=typeof e=="string"?e:e.id,i=this.getPage(r);if(!i)return this;const o={...this.getCamera()},s=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(i.id));return this.run(()=>{const a=this.getPages(),l=rf(i.index,a[a.indexOf(i)+1]?.index);if(this.createPage({name:i.name+" Copy",id:n,index:l}),this.setCurrentPage(n),this.setCamera(o),s)return this.putContentOntoCurrentPage(s)}),this}renamePage(e,n){const r=typeof e=="string"?e:e.id;return this.getIsReadonly()?this:(this.updatePage({id:r,name:n}),this)}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(e){return this.getIsReadonly()?this:e.length<=0?this:(this.run(()=>this.store.put(e),{history:"ignore"}),this)}updateAssets(e){return this.getIsReadonly()?this:e.length<=0?this:(this.run(()=>{this.store.put(e.map(n=>({...this.store.get(n.id),...n})))},{history:"ignore"}),this)}deleteAssets(e){if(this.getIsReadonly())return this;const n=typeof e[0]=="string"?e:e.map(r=>r.id);return n.length<=0?this:(this.run(()=>{this.store.props.assets.remove?.(n),this.store.remove(n)},{history:"ignore"}),this)}getAsset(e){return this.store.get(typeof e=="string"?e:e.id)}async resolveAssetUrl(e,n){if(!e)return null;const r=this.getAsset(e);if(!r)return null;const{screenScale:i=1,shouldResolveToOriginal:o=!1,dpr:s=this.getInstanceState().devicePixelRatio}=n,l=(d=>Math.pow(2,Math.ceil(Math.log2(d))))(i),c="connection"in navigator?navigator.connection.effectiveType:null;return await this.store.props.assets.resolve(r,{screenScale:i||1,steppedScreenScale:l,dpr:s,networkEffectiveType:c,shouldResolveToOriginal:o})}async uploadAsset(e,n,r){return await this.store.props.assets.upload(e,n,r)}getShapeGeometry(e,n){const r=n?.context??"none";return this._shapeGeometryCaches[r]||(this._shapeGeometryCaches[r]=this.store.createComputedCache("bounds",i=>(this.fonts.trackFontsForShape(i),this.getShapeUtil(i).getGeometry(i,n)),{areRecordsEqual:PT})),this._shapeGeometryCaches[r].get(typeof e=="string"?e:e.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",e=>this.getShapeUtil(e).getHandles?.(e),{areRecordsEqual:PT})}getShapeHandles(e){return this._getShapeHandlesCache().get(typeof e=="string"?e:e.id)}getShapeLocalTransform(e){const n=typeof e=="string"?e:e.id,r=this.getShape(n);if(!r)throw Error("Editor.getTransform: shape not found");return xe.Identity().translate(r.x,r.y).rotate(r.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",e=>{if(hi(e.parentId))return this.getShapeLocalTransform(e);const n=this._getShapePageTransformCache().get(e.parentId)??xe.Identity();return xe.Compose(n,this.getShapeLocalTransform(e))})}getShapeParentTransform(e){const n=typeof e=="string"?e:e.id,r=this.getShape(n);return!r||hi(r.parentId)?xe.Identity():this._getShapePageTransformCache().get(r.parentId)??xe.Identity()}getShapePageTransform(e){const n=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(n)??xe.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",e=>{const n=this.getShapePageTransform(e);if(n)return pe.FromPoints(n.applyToPoints(this.getShapeGeometry(e).boundsVertices))})}getShapePageBounds(e){return this._getShapePageBoundsCache().get(typeof e=="string"?e:e.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",e=>{const n=this._getShapeMaskCache().get(e.id);if(!n)return;if(n.length===0)return"polygon(0px 0px, 0px 0px, 0px 0px)";const r=this._getShapePageTransformCache().get(e.id);return r?`polygon(${xe.applyToPoints(xe.Inverse(r),n).map(o=>`${o.x}px ${o.y}px`).join(",")})`:void 0})}getShapeClipPath(e){return this._getShapeClipPathCache().get(typeof e=="string"?e:e.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",e=>{if(hi(e.parentId))return;const n=[];for(const i of this.getShapeAncestors(e.id)){const o=this.getShapeUtil(i),s=o.getClipPath?.(i);if(!s||o.shouldClipChild?.(e)===!1)continue;const a=this.getShapePageTransform(i.id);n.push(a.applyToPoints(s))}return n.length===0?void 0:n.reduce((i,o)=>{const s=mb(i,o);return s?s.map(T.Cast):[]})})}getShapeMask(e){return this._getShapeMaskCache().get(typeof e=="string"?e:e.id)}getShapeMaskedPageBounds(e){return typeof e!="string"&&(e=e.id),this._getShapeMaskedPageBoundsCache().get(e)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",e=>{const n=this._getShapePageBoundsCache().get(e.id);if(!n)return;const r=this._getShapeMaskCache().get(e.id);if(r){if(r.length===0)return;const{corners:i}=n;if(i.every((s,a)=>s&&T.Equals(s,r[a])))return n.clone();const o=mb(r,i);return o?pe.FromPoints(o):void 0}return n})}getShapeAncestors(e,n=[]){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)return n;const o=i.parentId;if(hi(o))return n.reverse(),n;const s=this.store.get(o);return s?(n.push(s),this.getShapeAncestors(s,n)):n}findShapeAncestor(e,n){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)return;const o=i.parentId;if(hi(o))return;const s=this.getShape(o);if(s)return n(s)?s:this.findShapeAncestor(s,n)}hasAncestor(e,n){const r=typeof e=="string"?e:e?.id,i=r&&this.getShape(r);return i?i.parentId===n?!0:this.hasAncestor(this.getShapeParent(i),n):!1}findCommonAncestor(e,n){if(e.length===0)return;const r=typeof e[0]=="string"?e:e.map(l=>l.id),i=ut(r.map(l=>this.getShape(l)));if(i.length===1){const l=i[0].parentId;return hi(l)?void 0:n?this.findShapeAncestor(i[0],n)?.id:l}const[o,...s]=i;let a=this.getShapeParent(o);for(;a;){if(n&&!n(a)){a=this.getShapeParent(a);continue}if(s.every(l=>this.hasAncestor(l,a.id)))return a.id;a=this.getShapeParent(a)}}isShapeOrAncestorLocked(e){const n=e&&this.getShape(e);return n===void 0?!1:n.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(n))}getNotVisibleShapes(){return this._notVisibleShapes.get()}getCulledShapes(){const e=this.getNotVisibleShapes(),n=this.getSelectedShapeIds(),r=this.getEditingShapeId(),i=new Set(e);return r&&i.delete(r),n.forEach(o=>{i.delete(o)}),i}getCurrentPageBounds(){let e;return this.getCurrentPageShapeIdsSorted().forEach(n=>{const r=this.getShapeMaskedPageBounds(n);r&&(e?e=e.expand(r):e=r.clone())}),e}getSelectedShapeAtPoint(e){const n=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(r=>r.type!=="group"&&n.includes(r.id)).reverse().find(r=>this.isPointInShape(r,e,{hitInside:!0,margin:0}))}getShapeAtPoint(e,n={}){const r=this.getZoomLevel(),i=this.getViewportPageBounds(),{filter:o,margin:s=0,hitLocked:a=!1,hitLabels:l=!1,hitInside:c=!1,hitFrameInside:d=!1}=n,[u,p]=Array.isArray(s)?s:[s,s];let f=1/0,y=null,v=1/0,x=null;const b=(n.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(w=>{if(w.isLocked&&!a||this.isShapeHidden(w)||this.isShapeOfType(w,"group"))return!1;const _=this.getShapeMask(w);return!(_&&!fo(e,_)||o&&!o(w))});for(let w=b.length-1;w>=0;w--){const _=b[w],C=this.getShapeGeometry(_),A=C instanceof Zo,E=this.getPointInShapeSpace(_,e);if(this.isShapeOfType(_,"frame")||(this.isShapeOfType(_,"note")||this.isShapeOfType(_,"arrow")||this.isShapeOfType(_,"geo")&&_.props.fill==="none")&&this.getShapeUtil(_).getText(_)?.trim()){for(const D of C.children)if(D.isLabel&&D.isPointInBounds(E))return _}if(this.isShapeOfType(_,"frame")){const D=C.distanceToPoint(E,d);if(d?D>0&&D<=p||D<=0&&D>-u:D>0&&D<=p)return x||_;if(C.hitTestPoint(E,0,!0))return x||y||(d?_:void 0);continue}let O;if(A){let D=1/0;for(const B of C.children){if(B.isLabel&&!l)continue;const L=B.distanceToPoint(E,c);L<D&&(D=L)}O=D}else p===0&&(C.bounds.w<1||C.bounds.h<1)||C.bounds.containsPoint(E,p)?O=C.distanceToPoint(E,c):O=1/0;if(C.isClosed){if(O<=p||c&&O<=0&&O>-u){if(C.isFilled||A&&C.children[0].isFilled)return x||_;if(this.getShapePageBounds(_).contains(i))continue;if(c?O>0&&O<=p||O<=0&&O>-u:Math.abs(O)<=Math.max(u,p))Math.abs(O)<v&&(v=Math.abs(O),x=_);else if(!x){const{area:D}=C;D<f&&(f=D,y=_)}}}else if(O<this.options.hitTestMargin/r)return _}return x||y||void 0}getShapesAtPoint(e,n={}){return this.getCurrentPageShapesSorted().filter(r=>!this.isShapeHidden(r)&&this.isPointInShape(r,e,n)).reverse()}isPointInShape(e,n,r={}){const{hitInside:i=!1,margin:o=0}=r,s=typeof e=="string"?e:e.id,a=this.getShapeMask(s);return a&&!fo(n,a)?!1:this.getShapeGeometry(s).hitTestPoint(this.getPointInShapeSpace(e,n),o,i)}getPointInShapeSpace(e,n){const r=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(r).clone().invert().applyToPoint(n)}getPointInParentSpace(e,n){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)return new T(0,0);if(hi(i.parentId))return T.From(n);const o=this.getShapePageTransform(i.parentId);return o?o.clone().invert().applyToPoint(n):T.From(n)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),e=>this.store.get(e))}getCurrentPageShapesSorted(){const e=[],n=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let r=0,i=n.length;r<i;r++)C7(this,n[r],e);return e}getCurrentPageRenderingShapesSorted(){const e=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter(({id:n})=>!e.has(n)&&!this.isShapeHidden(n))}isShapeOfType(e,n){const r=typeof e=="string"?this.getShape(e):e;return r?r.type===n:!1}getShape(e){const n=typeof e=="string"?e:e.id;if(co(n))return this.store.get(n)}getShapeParent(e){const n=typeof e=="string"?e:e?.id;if(!n)return;const r=this.getShape(n);if(!(r===void 0||!co(r.parentId)))return this.getShape(r.parentId)}getShapeNearestSibling(e,n){return n?n.parentId===e.parentId?n:this.findShapeAncestor(n,i=>i.parentId===e.parentId):void 0}isShapeInPage(e,n=this.getCurrentPageId()){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)return!1;let o=!1;if(i.parentId===n)o=!0;else{let s=this.getShape(i.parentId);e:for(;s;){if(s.parentId===n){o=!0;break e}s=this.getShape(s.parentId)}}return o}getAncestorPageId(e){const n=typeof e=="string"?e:e?.id,r=n&&this.getShape(n);if(r)return hi(r.parentId)?r.parentId:this.getAncestorPageId(this.getShape(r.parentId))}reparentShapes(e,n,r){const i=typeof e[0]=="string"?e:e.map(p=>p.id);if(i.length===0)return this;const o=[],s=hi(n)?xe.Identity():this.getShapePageTransform(n),a=s.rotation();let l=[];const c=ut(this.getSortedChildIdsForParent(n).map(p=>this.getShape(p)));if(r){const p=c.find(f=>f.index===r);if(p){const f=c[c.indexOf(p)+1];f?l=Gd(r,f.index,i.length):l=PI(r,i.length)}else{const f=c.sort(Yr).find(y=>y.index>r);f?l=Gd(r,f.index,i.length):l=PI(r,i.length)}}else{const p=c.length&&c[c.length-1];l=p?PI(p.index,i.length):Qm(i.length)}const d=s.clone().invert(),u=ut(i.map(p=>this.getShape(p))).sort(Yr);return this.run(()=>{for(let p=0;p<u.length;p++){const f=u[p],y=this.getShapePageTransform(f);if(!y)continue;const v=y.point();if(!v)continue;const x=d.applyToPoint(v),b=y.rotation()-a;if(f.id===n)throw Error("Attempted to reparent a shape to itself!");o.push({id:f.id,type:f.type,parentId:n,x:x.x,y:x.y,rotation:b,index:l[p]})}this.updateShapes(o)},{ignoreShapeLock:!0}),this}getHighestIndexForParent(e){const n=typeof e=="string"?e:e.id,r=this._parentIdsToChildIds.get()[n];if(!r||r.length===0)return na(d2);const i=this.getShape(r[r.length-1]);return na(i.index)}getSortedChildIdsForParent(e){const n=typeof e=="string"?e:e.id,r=this._parentIdsToChildIds.get()[n];return r||ur}visitDescendants(e,n){const r=this.getSortedChildIdsForParent(e);for(const i of r)n(i)!==!1&&this.visitDescendants(i,n);return this}getShapeAndDescendantIds(e){const n=new Set;for(const r of e.map(i=>this.getShape(i)).sort(Yr))n.add(r.id),this.visitDescendants(r,i=>{n.add(i)});return n}getDraggingOverShape(e,n){const r=ut(n.map(o=>this.getShape(o))).filter(o=>!o.isLocked&&!this.isShapeHidden(o)),i=this.getShapesAtPoint(e,{hitInside:!0,margin:0}).filter(o=>!n.includes(o)&&!o.isLocked&&!this.isShapeHidden(o)&&!r.includes(o));for(const o of i){const s=this.getShapeUtil(o);if(s.onDragShapesOver||s.onDragShapesIn||s.onDragShapesOut||s.onDropShapesOver)return o}}getOutermostSelectableShape(e,n){const r=typeof e=="string"?e:e.id,i=this.getShape(r);let o=i,s=i;const a=this.getFocusedGroup();for(;s;){if(this.isShapeOfType(s,"group")&&a?.id!==s.id&&!this.hasAncestor(a,s.id)&&(n?.(s)??!0))o=s;else if(a?.id===s.id)break;s=this.getShapeParent(s)}return o}_getBindingsIndexCache(){const e=Bde(this);return this.store.createComputedCache("bindingsIndex",n=>e.get().get(n.id),{areRecordsEqual:()=>!0})}getBinding(e){return this.store.get(e)}getBindingsFromShape(e,n){const r=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(r).filter(i=>i.fromId===r&&i.type===n)}getBindingsToShape(e,n){const r=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(r).filter(i=>i.toId===r&&i.type===n)}getBindingsInvolvingShape(e,n){const r=typeof e=="string"?e:e.id,i=this._getBindingsIndexCache().get(r)??ur;return n?i.filter(o=>o.type===n):i}createBindings(e){const n=[];for(const r of e){const i=this.getShape(r.fromId),o=this.getShape(r.toId);if(!i||!o||!this.canBindShapes({fromShape:i,toShape:o,binding:r}))continue;const a=this.getBindingUtil(r.type).getDefaultProps(),l=this.store.schema.types.binding.create({...r,id:r.id??Bd(),props:{...a,...r.props}});n.push(l)}return this.store.put(n),this}createBinding(e){return this.createBindings([e])}updateBindings(e){const n=[];for(const r of e){if(!r)continue;const i=this.getBinding(r.id);if(!i)continue;const o=sl(i,r);if(o===i)continue;const s=this.getShape(o.fromId),a=this.getShape(o.toId);!s||!a||this.canBindShapes({fromShape:s,toShape:a,binding:o})&&n.push(o)}return this.store.put(n),this}updateBinding(e){return this.updateBindings([e])}deleteBindings(e,{isolateShapes:n=!1}={}){const r=e.map(i=>typeof i=="string"?i:i.id);return n?this.store.atomic(()=>{for(const i of r){const o=this.getBinding(i);if(!o)continue;const s=this.getBindingUtil(o);s.onBeforeIsolateFromShape?.({binding:o,removedShape:this.getShape(o.toId)}),s.onBeforeIsolateToShape?.({binding:o,removedShape:this.getShape(o.fromId)}),this.store.remove([i])}}):this.store.remove(r),this}deleteBinding(e,n){return this.deleteBindings([e],n)}canBindShapes({fromShape:e,toShape:n,binding:r}){const i=typeof e=="string"?e:e.type,o=typeof n=="string"?n:n.type,s=typeof r=="string"?r:r.type,a={fromShapeType:i,toShapeType:o,bindingType:s};return i===o?this.getShapeUtil(i).canBind(a):this.getShapeUtil(i).canBind(a)&&this.getShapeUtil(o).canBind(a)}rotateShapesBy(e,n,r){const i=typeof e[0]=="string"?e:e.map(s=>s.id);if(i.length<=0)return this;const o=Z8({editor:this,ids:i});return o?(LS({delta:n,snapshot:o,editor:this,stage:"one-off",centerOverride:r?.center}),this):this}getChangesToTranslateShape(e,n){let r=e;const i=this.getShapeUtil(e),o=i.onTranslateStart?.(r);o&&(r=sl(r,o)),r=sl(r,{id:e.id,type:e.type,x:n.x,y:n.y});const s=i.onTranslate?.(e,r);s&&(r=sl(r,s));const a=i.onTranslateEnd?.(e,r);return a&&(r=sl(r,a)),r}nudgeShapes(e,n){const r=typeof e[0]=="string"?e:e.map(o=>o.id);if(r.length<=0)return this;const i=[];for(const o of r){const s=this.getShape(o),a=T.From(n),l=this.getShapeParentTransform(s);l&&a.rot(-l.rotation()),i.push(this.getChangesToTranslateShape(s,a.add(s)))}return this.updateShapes(i),this}duplicateShapes(e,n){return this.run(()=>{const r=typeof e[0]=="string"?e:e.map(p=>p.id),i=this._shouldIgnoreShapeLock?r:this._getUnlockedShapeIds(r);if(i.length<=0)return this;const o=new Set(i),s=this.getShapeAndDescendantIds(i),a=[...s].reverse(),l=new Map;for(const p of s)l.set(p,sn());const{shapesToCreateWithOriginals:c,bindingsToCreate:d}=v4(this,s,p=>{const f=[];for(const v of p){const x=this.getBinding(v);if(!x)continue;const b=Bd();f.push({...x,id:b,fromId:Gr(l.get(x.fromId)),toId:Gr(l.get(x.toId))})}const y=[];for(const v of a){const x=Gr(l.get(v)),b=this.getShape(v);if(!b)continue;let w=0,_=0;if(n&&o.has(v)){const C=this.getShapeParentTransform(b),A=new T(n.x,n.y).rot(-C.rotation());w=A.x,_=A.y}y.push({shape:{...b,id:x,x:b.x+w,y:b.y+_,index:"a1",parentId:l.get(b.parentId)??b.parentId},originalShape:b})}return{shapesToCreateWithOriginals:y,bindingsToCreate:f}});c.forEach(({shape:p,originalShape:f})=>{const y=f.parentId,v=this.getSortedChildIdsForParent(y),x=v.indexOf(f.id),b=v[x+1],w=b?this.getShape(b):void 0,_=rf(f.index,w?.index);p.index=_});const u=c.map(({shape:p})=>p);if(!this.canCreateShapes(u)){Fx(this);return}if(this.createShapes(u),this.createBindings(d),this.setSelectedShapes(ut(i.map(p=>{const f=l.get(p);return!f||!this.getShape(f)?null:f}))),n!==void 0){const p=this.getSelectionPageBounds(),f=this.getViewportPageBounds();p&&!f.contains(p)&&this.centerOnPoint(p.center,{animation:{duration:this.options.animationMediumMs}})}}),this}moveShapesToPage(e,n){const r=typeof e[0]=="string"?e:e.map(a=>a.id);if(r.length===0)return this;if(this.getIsReadonly())return this;const i=this.getCurrentPageId();if(n===i)return this;if(!this.store.has(n))return this;const o=this.getContentFromCurrentPage(r);if(!o)return this;if(this.getPageShapeIds(n).size+o.shapes.length>this.options.maxShapesPerPage)return Fx(this,n),this;const s=this.getCamera().z;return this.run(()=>{this.deleteShapes(r),this.setCurrentPage(n),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(o,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:s}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(e){const n=typeof e[0]=="string"?e:e.map(s=>s.id);if(this.getIsReadonly()||n.length===0)return this;let r=!0,i=!0;const o=[];for(const s of n){const a=this.getShape(s);a&&(o.push(a),a.isLocked?i=!1:r=!1)}return this.run(()=>{i?(this.updateShapes(o.map(s=>({id:s.id,type:s.type,isLocked:!0}))),this.setSelectedShapes([])):r?this.updateShapes(o.map(s=>({id:s.id,type:s.type,isLocked:!1}))):this.updateShapes(o.map(s=>({id:s.id,type:s.type,isLocked:!0})))}),this}sendToBack(e){const n=typeof e[0]=="string"?e:e.map(i=>i.id),r=Lx(this,"toBack",n,{considerAllShapes:!0});return r&&this.updateShapes(r),this}sendBackward(e,n={}){const r=typeof e[0]=="string"?e:e.map(o=>o.id),i=Lx(this,"backward",r,n);return i&&this.updateShapes(i),this}bringForward(e,n={}){const r=typeof e[0]=="string"?e:e.map(o=>o.id),i=Lx(this,"forward",r,n);return i&&this.updateShapes(i),this}bringToFront(e){const n=typeof e[0]=="string"?e:e.map(i=>i.id),r=Lx(this,"toFront",n);return r&&this.updateShapes(r),this}collectShapesViaArrowBindings(e){const{initialShapes:n,resultShapes:r,resultBounds:i,bindings:o,visited:s}=e;for(const a of o)for(const l of[a.fromId,a.toId])if(!s.has(l)){const c=n.find(d=>d.id===l);if(c&&!s.has(c.id)){s.add(c.id);const d=this.getShapePageBounds(c);if(!d)continue;r.push(c),i.push(d),this.collectShapesViaArrowBindings({...e,bindings:this.getBindingsInvolvingShape(c,"arrow")})}}}flipShapes(e,n){if(this.getIsReadonly())return this;const r=typeof e[0]=="string"?e:e.map(l=>l.id),i=ut(r.map(l=>this.getShape(l)));for(const l of i)if(this.isShapeOfType(l,"group")){const c=ut(this.getSortedChildIdsForParent(l.id).map(d=>this.getShape(d)));i.push(...c)}const o=[],s=[];for(const l of i){const c=this.getShapeUtil(l);if(!c.canBeLaidOut(l,{type:"flip",shapes:i}))continue;const d=this.getShapePageBounds(l),u=this.getShapeGeometry(l).bounds,p=this.getShapePageTransform(l.id);d&&u&&p&&(o.push({shape:l,localBounds:u,pageTransform:p,isAspectRatioLocked:c.isAspectRatioLocked(l)}),s.push(d))}if(!o.length)return this;const a=pe.Common(s).center;return this.run(()=>{for(const{shape:l,localBounds:c,pageTransform:d,isAspectRatioLocked:u}of o)this.resizeShape(l.id,{x:n==="horizontal"?-1:1,y:n==="vertical"?-1:1},{initialBounds:c,initialPageTransform:d,initialShape:l,isAspectRatioLocked:u,mode:"scale_shape",scaleOrigin:a,scaleAxisRotation:0})}),this}stackShapes(e,n,r){const i=r??this.options.adjacentShapeMargin,o=typeof e[0]=="string"?e:e.map(b=>b.id);if(this.getIsReadonly())return this;const s=ut(o.map(b=>this.getShape(b))),a=[],l=new Set;for(const b of s){if(l.has(b.id))continue;l.add(b.id);const w=this.getShapePageBounds(b);if(!w||!this.getShapeUtil(b).canBeLaidOut?.(b,{type:"stack",shapes:s}))continue;const _=[b],C=[w];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(b.id,"arrow"),initialShapes:s,resultShapes:_,resultBounds:C,visited:l});const A=pe.Common(C);A&&a.push({shapes:_,pageBounds:A})}const c=a.length;if(i===0&&c<3||c<2)return this;let d,u,p,f;n==="horizontal"?(d="x",u="minX",p="maxX",f="width"):(d="y",u="minY",p="maxY",f="height");let y=0;if(i===0){const b={};a.sort((_,C)=>_.pageBounds[u]-C.pageBounds[u]);for(let _=0;_<c-1;_++){const C=a[_],E=a[_+1].pageBounds[u]-C.pageBounds[p];b[E]||(b[E]=0),b[E]++}let w=1;for(const[_,C]of Object.entries(b))C>w&&(w=C,y=parseFloat(_));if(w===1){let _=0;for(const[C,A]of Object.entries(b))y+=parseFloat(C)*A,_+=A;y/=_}}else y=i;const v=[];let x=a[0].pageBounds[p];for(let b=1;b<a.length;b++){const{shapes:w,pageBounds:_}=a[b],C=new T;C[d]=x+y-_[d];for(const A of w){const E=C.clone(),O=this.getShapeParent(A);if(O){const D=this.getShapePageTransform(O);D&&E.rot(-D.rotation())}E.add(A),v.push(this.getChangesToTranslateShape(A,E))}x+=_[f]+y}return this.updateShapes(v),this}packShapes(e,n){if(this.getIsReadonly())return this;const r=n??this.options.adjacentShapeMargin,i=typeof e[0]=="string"?e:e.map(A=>A.id),o=ut(i.map(A=>this.getShape(A))),s=[],a=[],l=new Set;for(const A of o){if(l.has(A.id))continue;l.add(A.id);const E=this.getShapePageBounds(A);if(!E||!this.getShapeUtil(A).canBeLaidOut?.(A,{type:"pack",shapes:o}))continue;const O=[A],D=[E];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(A.id,"arrow"),initialShapes:o,resultShapes:O,resultBounds:D,visited:l});const B=pe.Common(D);B&&(s.push({shapes:O,pageBounds:B,nextPageBounds:B.clone()}),a.push(B))}if(s.length<2)return this;let c=0;for(const{pageBounds:A}of s)c+=A.width*A.height;const d=pe.Common(a),u=d.width;s.sort((A,E)=>A.pageBounds.width-E.pageBounds.width).sort((A,E)=>A.pageBounds.height-E.pageBounds.height);const p=Math.max(Math.ceil(Math.sqrt(c/.95)),u),f=[new pe(d.x,d.y,p,1/0)];let y=0,v=0,x,b;for(const{nextPageBounds:A}of s)for(let E=f.length-1;E>=0;E--)if(x=f[E],!(A.width>x.width||A.height>x.height)){A.x=x.x,A.y=x.y,v=Math.max(v,A.maxY),y=Math.max(y,A.maxX),A.width===x.width&&A.height===x.height?(b=f.pop(),E<f.length&&(f[E]=b)):A.height===x.height?(x.x+=A.width+r,x.width-=A.width+r):A.width===x.width?(x.y+=A.height+r,x.height-=A.height+r):(f.push(new pe(x.x+(A.width+r),x.y,x.width-(A.width+r),A.height)),x.y+=A.height+r,x.height-=A.height+r);break}const w=pe.Common(s.map(A=>A.nextPageBounds)),_=T.Sub(d.center,w.center),C=[];for(const{shapes:A,pageBounds:E,nextPageBounds:O}of s){const D=T.Sub(O.point,E.point).add(_);for(const B of A){const L=D.clone();if(this.getShapeParent(B)){const F=this.getShapeParentTransform(B);F&&L.rot(-F.rotation())}L.add(B),C.push(this.getChangesToTranslateShape(B,L))}}return C.length&&this.updateShapes(C),this}alignShapes(e,n){if(this.getIsReadonly())return this;const r=typeof e[0]=="string"?e:e.map(d=>d.id),i=ut(r.map(d=>this.getShape(d))),o=[],s=[],a=new Set;for(const d of i){if(a.has(d.id))continue;a.add(d.id);const u=this.getShapePageBounds(d);if(!u||!this.getShapeUtil(d).canBeLaidOut?.(d,{type:"align",shapes:i}))continue;const p=[d],f=[u];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(d.id,"arrow"),initialShapes:i,resultShapes:p,resultBounds:f,visited:a});const y=pe.Common(f);y&&(o.push({shapes:p,pageBounds:y}),s.push(y))}if(o.length<2)return this;const l=pe.Common(s),c=[];return o.forEach(({shapes:d,pageBounds:u})=>{const p=new T;switch(n){case"top":{p.y=l.minY-u.minY;break}case"center-vertical":{p.y=l.midY-u.minY-u.height/2;break}case"bottom":{p.y=l.maxY-u.minY-u.height;break}case"left":{p.x=l.minX-u.minX;break}case"center-horizontal":{p.x=l.midX-u.minX-u.width/2;break}case"right":{p.x=l.maxX-u.minX-u.width;break}}for(const f of d){const y=p.clone(),v=this.getShapeParent(f);if(v){const x=this.getShapePageTransform(v);x&&y.rot(-x.rotation())}y.add(f),c.push(this.getChangesToTranslateShape(f,y))}}),this.updateShapes(c),this}distributeShapes(e,n){if(this.getIsReadonly())return this;const r=typeof e[0]=="string"?e:e.map(_=>_.id),i=ut(r.map(_=>this.getShape(_))),o=[],s=new Set;for(const _ of i){if(s.has(_.id))continue;s.add(_.id);const C=this.getShapePageBounds(_);if(!C||!this.getShapeUtil(_).canBeLaidOut?.(_,{type:"distribute",shapes:i}))continue;const A=[_],E=[C];this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(_.id,"arrow"),initialShapes:i,resultShapes:A,resultBounds:E,visited:s});const O=pe.Common(E);O&&o.push({shapes:A,pageBounds:O})}if(o.length<3)return this;let a,l,c,d;n==="horizontal"?(a="x",l="minX",c="maxX",d="width"):(a="y",l="minY",c="maxY",d="height");const u=[],p=o.sort((_,C)=>_.pageBounds[l]-C.pageBounds[l])[0],f=o.sort((_,C)=>C.pageBounds[c]-_.pageBounds[c])[0];if(p===f){const _=new Set(p.shapes.map(C=>C.id));return this.distributeShapes(r.filter(C=>!_.has(C)),n)}const y=o.filter(_=>_!==p&&_!==f).sort((_,C)=>_.pageBounds[l]===C.pageBounds[l]?_.shapes[0].id<C.shapes[0].id?-1:1:_.pageBounds[l]-C.pageBounds[l]),v=p.pageBounds[c],x=f.pageBounds[l]-v,b=y.reduce((_,C)=>_+C.pageBounds[d],0),w=(x-b)/(y.length+1);for(let _=v+w,C=0;C<y.length;C++){const{shapes:A,pageBounds:E}=y[C],O=new T;O[a]=_-E[a],_+E[d]>f.pageBounds[c]-1&&(O[a]=f.pageBounds[c]-E[c]-1);for(const D of A){const B=O.clone(),L=this.getShapeParent(D);if(L){const j=this.getShapePageTransform(L);j&&B.rot(-j.rotation())}B.add(D),u.push(this.getChangesToTranslateShape(D,B))}_+=E[d]+w}return this.updateShapes(u),this}stretchShapes(e,n){const r=typeof e[0]=="string"?e:e.map(p=>p.id);if(this.getIsReadonly())return this;const i=ut(r.map(p=>this.getShape(p))).filter(p=>this.getShapePageTransform(p)?.rotation()%(nn/2)===0),o=[],s=[],a=new Set;for(const p of i){if(a.has(p.id))continue;a.add(p.id);const f=this.getShapePageBounds(p);if(!f)continue;const y=[p],v=[f];if(!this.getShapeUtil(p).canBeLaidOut?.(p,{type:"stretch"}))continue;this.collectShapesViaArrowBindings({bindings:this.getBindingsToShape(p.id,"arrow"),initialShapes:i,resultShapes:y,resultBounds:v,visited:a});const x=pe.Common(v);x&&(o.push({shapes:y,pageBounds:x}),s.push(x))}if(o.length<2)return this;const l=pe.Common(s);let c,d,u;return n==="horizontal"?(c="x",d="minX",u="width"):(c="y",d="minY",u="height"),this.run(()=>{o.forEach(({shapes:p,pageBounds:f})=>{const y=new T;y[c]=l[d]-f[d];const v=f.center.clone();v[c]=l[d];const x=new T(1,1);x[c]=l[u]/f[u];for(const b of p){const w=y.clone(),_=this.getShapeParentTransform(b);_&&y.rot(-_.rotation()),w.add(b);const C=this.getChangesToTranslateShape(b,w);this.updateShape(C),this.resizeShape(b.id,x,{initialBounds:this.getShapeGeometry(b).bounds,scaleOrigin:v,isAspectRatioLocked:this.getShapeUtil(b).isAspectRatioLocked(b),scaleAxisRotation:0})}})}),this}resizeShape(e,n,r={}){const i=typeof e=="string"?e:e.id;if(this.getIsReadonly())return this;Number.isFinite(n.x)||(n=new T(1,n.y)),Number.isFinite(n.y)||(n=new T(n.x,1));const o=r.initialShape??this.getShape(i);if(!o)return this;const s=r.scaleOrigin??this.getShapePageBounds(i)?.center;if(!s)return this;const a=r.initialPageTransform?xe.Cast(r.initialPageTransform):this.getShapePageTransform(i);if(!a)return this;const l=a.rotation();if(l==null)return this;const c=r.scaleAxisRotation??l,d=r.initialBounds??this.getShapeGeometry(i).bounds;if(!d)return this;const u=r.isAspectRatioLocked??this.getShapeUtil(o).isAspectRatioLocked(o);if(!XU(l,c))return this._resizeUnalignedShape(i,n,{...r,initialBounds:d,scaleOrigin:s,scaleAxisRotation:c,initialPageTransform:a,isAspectRatioLocked:u,initialShape:o});const p=this.getShapeUtil(o);u&&(Math.abs(n.x)>Math.abs(n.y)?n=new T(n.x,Math.sign(n.y)*Math.abs(n.x)):n=new T(Math.sign(n.x)*Math.abs(n.y),n.y));let f=!1;if(p.onResize&&p.canResize(o)){const y=this._scalePagePoint(xe.applyToPoint(a,new T(0,0)),s,n,c),v=this.getPointInParentSpace(o.id,y),x=new T(n.x,n.y),b=Ir((l-c)%Math.PI,0);x.x=b?n.x:n.y,x.y=b?n.y:n.x;const w=xe.applyToPoint(a,new T),{x:_,y:C}=this.getPointInParentSpace(o.id,w);let A=o;r.skipStartAndEndCallbacks||(A=sl(o,p.onResizeStart?.(o)??void 0));const E=p.onResize({...o,x:_,y:C},{newPoint:v,handle:r.dragHandle??"bottom_right",mode:r.mode??"scale_shape",scaleX:x.x,scaleY:x.y,initialBounds:d,initialShape:o});E&&(f=!0),A=sl(A,{id:i,type:o.type,x:v.x,y:v.y,...E}),r.skipStartAndEndCallbacks||(A=sl(A,p.onResizeEnd?.(o,A)??void 0)),this.updateShapes([A])}if(!f){const y=xe.applyToPoint(a,d.center),v=this._scalePagePoint(y,s,n,c),x=this.getPointInParentSpace(o.id,y),b=this.getPointInParentSpace(o.id,v),w=T.Sub(b,x);this.updateShapes([{id:i,type:o.type,x:o.x+w.x,y:o.y+w.y}])}return this}_scalePagePoint(e,n,r,i){const o=T.RotWith(e,n,-i).sub(n),s=T.MulV(o,r);return T.Add(s,n).rotWith(n,i)}_resizeUnalignedShape(e,n,r){const{type:i}=r.initialShape,o=new T(n.x,n.y);if(Math.abs(n.x)>Math.abs(n.y)?o.x=Math.sign(n.x)*Math.abs(n.y):o.y=Math.sign(n.y)*Math.abs(n.x),this.resizeShape(e,o,{initialShape:r.initialShape,initialBounds:r.initialBounds,isAspectRatioLocked:r.isAspectRatioLocked}),Math.sign(n.x)*Math.sign(n.y)<0){let{rotation:x}=xe.Decompose(r.initialPageTransform);x-=2*x,this.updateShapes([{id:e,type:i,rotation:x}])}const s=xe.applyToPoint(r.initialPageTransform,r.initialBounds.center),a=this._scalePagePoint(s,r.scaleOrigin,n,r.scaleAxisRotation),l=this.getShapePageBounds(e),c=this.getShapePageTransform(e),d=l.center,u=c.point();if(!d||!u)return this;const p=T.Sub(a,d),f=T.Add(u,p),{x:y,y:v}=this.getPointInParentSpace(e,f);return this.updateShapes([{id:e,type:i,x:y,y:v}]),this}getInitialMetaForShape(e){return{}}canCreateShape(e){return this.canCreateShapes([e])}canCreateShapes(e){return e.length+this.getCurrentPageShapeIds().size<=this.options.maxShapesPerPage}createShape(e){return this.createShapes([e]),this}createShapes(e){if(!Array.isArray(e))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getIsReadonly())return this;if(e.length<=0)return this;const n=this.getCurrentPageShapeIds();if(e.length+n.size>this.options.maxShapesPerPage)return Fx(this),this;const i=this.getFocusedGroupId();return this.run(()=>{const o=this.getCurrentPageShapesSorted(),s=e.map(d=>{if(d.id||(d={id:sn(),...d}),!d.parentId||!(this.store.has(d.parentId)||e.some(u=>u.id===d.parentId))){let u=this.getFocusedGroupId();if(d.x!==void 0&&d.y!==void 0)for(let y=o.length-1;y>=0;y--){const v=o[y];if(this.getShapeUtil(v).canReceiveNewChildrenOfType(v,d.type)&&!this.isShapeHidden(v)&&this.isPointInShape(v,{x:d.x??0,y:d.y??0},{margin:0,hitInside:!0})){u=v.id;break}}const f=d.parentId;if(u===d.id&&(u=i),u!==f&&(d={...d},d.parentId=u,co(u))){const y=this.getPointInShapeSpace(this.getShape(u),{x:d.x??0,y:d.y??0});d.x=y.x,d.y=y.y,d.rotation=-this.getShapePageTransform(u).rotation()+(d.rotation??0)}}return d}),a=new Map,l=[],{opacityForNextShape:c}=this.getInstanceState();for(const d of s){const u=this.getShapeUtil(d);let p=d.index;if(!p){const x=d.parentId??i;a.has(x)||a.set(x,this.getHighestIndexForParent(x)),p=a.get(x),a.set(x,na(p))}const f=u.getDefaultProps();for(const[x,b]of this.styleProps[d.type])f[b]=this.getStyleForNextShape(x);let y=this.store.schema.types.shape.create({...d,index:p,opacity:d.opacity??c,parentId:d.parentId??i,props:"props"in d?{...f,...d.props}:f});if(y.index===void 0)throw Error("no index!");const v=this.getShapeUtil(y).onBeforeCreate?.(y);v&&(y=v),l.push(y)}l.forEach(d=>{d.meta={...this.getInitialMetaForShape(d),...d.meta}}),this.emit("created-shapes",l),this.emit("edit"),this.store.put(l)}),this}animateShape(e,n={animation:$C}){return this.animateShapes([e],n)}animateShapes(e,n={animation:$C}){if(!n.animation)return this;const{duration:r=500,easing:i=Ui.linear}=n.animation,o=Qt();let s=r,a;const l=[];let c,d;for(let p=0,f=e.length;p<f;p++){if(c=e[p],!c)continue;const y=this.getShape(c.id);y&&(d={start:fn(y),end:sl(fn(y),c)},l.push(d),this.animatingShapes.set(y.id,o))}const u=p=>{if(s-=p,s<0){const{animatingShapes:x}=this,b=e.filter(w=>w&&x.get(w.id)===o);b.length&&this.updateShapes(b),this.off("tick",u);return}a=i(1-s/r);const{animatingShapes:f}=this,y=[];let v;for(let x=0,b=l.length;x<b;x++){const{start:w,end:_}=l[x];v=f.get(w.id),v===o&&y.push({..._,x:w.x+(_.x-w.x)*a,y:w.y+(_.y-w.y)*a,opacity:w.opacity+(_.opacity-w.opacity)*a,rotation:w.rotation+(_.rotation-w.rotation)*a,props:this.getShapeUtil(_).getInterpolatedProps?.(w,_,a)??_.props})}this._updateShapes(y)};return this.on("tick",u),this}groupShapes(e,n={}){const{groupId:r=sn(),select:i=!0}=n;if(!Array.isArray(e))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getIsReadonly())return this;const o=typeof e[0]=="string"?e:e.map(y=>y.id);if(o.length<=1)return this;const s=ut((this._shouldIgnoreShapeLock?o:this._getUnlockedShapeIds(o)).map(y=>this.getShape(y))),a=s.sort(Yr).map(y=>y.id),l=pe.Common(ut(s.map(y=>this.getShapePageBounds(y)))),{x:c,y:d}=l.point,u=this.findCommonAncestor(s)??this.getCurrentPageId();if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const p=s.filter(y=>y.parentId===u).sort(Yr),f=p[p.length-1]?.index;return this.run(()=>{this.createShapes([{id:r,type:"group",parentId:u,index:f,x:c,y:d,opacity:1,props:{}}]),this.reparentShapes(a,r),i&&this.select(r)}),this}ungroupShapes(e,n={}){if(this.getIsReadonly())return this;const{select:r=!0}=n,i=typeof e[0]=="string"?e:e.map(l=>l.id),o=ut((this._shouldIgnoreShapeLock?i:this._getUnlockedShapeIds(i)).map(l=>this.getShape(l)));if(o.length===0)return this;if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const s=new Set,a=[];return o.forEach(l=>{this.isShapeOfType(l,"group")?a.push(l):s.add(l.id)}),a.length===0?this:(this.run(()=>{let l;for(let c=0,d=a.length;c<d;c++){l=a[c];const u=this.getSortedChildIdsForParent(l.id);for(let p=0,f=u.length;p<f;p++)s.add(u[p]);this.reparentShapes(u,l.parentId,l.index)}this.deleteShapes(a.map(c=>c.id)),r&&this.select(...s)}),this)}updateShape(e){return this.updateShapes([e]),this}updateShapes(e){const n=Array(e.length);for(let r=0,i=e.length;r<i;r++){const o=e[r];if(!o)continue;const s=this.getShape(o.id);if(s){if(!this._shouldIgnoreShapeLock){if(s.isLocked){if(!(Object.hasOwn(o,"isLocked")&&!o.isLocked))continue}else if(this.isShapeOrAncestorLocked(s))continue}this.animatingShapes.delete(o.id),n.push(o)}}return this._updateShapes(n),this}_updateShapes(e){this.getIsReadonly()||this.run(()=>{const n=[];let r,i;for(let o=0,s=e.length;o<s;o++){const a=e[o];a&&(r=this.getShape(a.id),r&&(i=sl(r,a),i!==r&&(i=this.getShapeUtil(r).onBeforeUpdate?.(r,i)??i,n.push(i))))}this.emit("edited-shapes",n),this.emit("edit"),this.store.put(n)})}_getUnlockedShapeIds(e){return e.filter(n=>!this.getShape(n)?.isLocked)}deleteShapes(e){if(this.getIsReadonly())return this;if(!Array.isArray(e))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");const n=typeof e[0]=="string"?e:e.map(o=>o.id),r=this._shouldIgnoreShapeLock?n:this._getUnlockedShapeIds(n);if(r.length===0)return this;const i=new Set(r);for(const o of r)this.visitDescendants(o,s=>{i.add(s)});return this.emit("deleted-shapes",[...i]),this.emit("edit"),this.run(()=>this.store.remove([...i]))}deleteShape(e){return this.deleteShapes([typeof e=="string"?e:e.id]),this}_extractSharedStyles(e,n){if(this.isShapeOfType(e,"group")){const r=this._parentIdsToChildIds.get()[e.id];if(!r)return;for(let i=0,o=r.length;i<o;i++)this._extractSharedStyles(this.getShape(r[i]),n)}else for(const[r,i]of this.styleProps[e.type])n.applyValue(r,wr(e.props,i))}_getSelectionSharedStyles(){const e=this.getSelectedShapes(),n=new TT;for(const r of e)this._extractSharedStyles(r,n);return n}getStyleForNextShape(e){const n=this.getInstanceState().stylesForNextShape[e.id];return n===void 0?e.defaultValue:n}getShapeStyleIfExists(e,n){const r=this.styleProps[e.type].get(n);if(r!==void 0)return wr(e.props,r)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();const e=this.root.getCurrent(),n=new TT;if(!e)return n;if(e.shapeType)if(e.shapeType==="frame"&&!this.getShapeUtil("frame").options.showColors)for(const r of this.styleProps[e.shapeType].keys())r.id!=="tldraw:color"&&n.applyValue(r,this.getStyleForNextShape(r));else for(const r of this.styleProps[e.shapeType].keys())n.applyValue(r,this.getStyleForNextShape(r));return n}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const e=[],n=i=>{const o=this.getShape(i);if(o)if(this.isShapeOfType(o,"group"))for(const s of this.getSortedChildIdsForParent(o.id))n(s);else e.push(o)};for(const i of this.getSelectedShapeIds())n(i);let r=null;for(const i of e)if(r===null)r=i.opacity;else if(r!==i.opacity)return{type:"mixed"};if(r!==null)return{type:"shared",value:r}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(e,n){return this.updateInstanceState({opacityForNextShape:e},n),this}setOpacityForSelectedShapes(e){const n=this.getSelectedShapes();if(n.length>0){const r=[],i=o=>{if(this.isShapeOfType(o,"group")){const s=this.getSortedChildIdsForParent(o);for(const a of s)i(this.getShape(a))}else r.push(o)};for(const o of n)i(o);this.updateShapes(r.map(o=>({id:o.id,type:o.type,opacity:e})))}return this}setStyleForNextShapes(e,n,r){const i=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...i,[e.id]:n}},r),this}setStyleForSelectedShapes(e,n){const r=this.getSelectedShapes();if(r.length>0){const i=[],o=s=>{if(this.isShapeOfType(s,"group")){const a=this.getSortedChildIdsForParent(s.id);for(const l of a)o(this.getShape(l))}else{const a=this.getShapeUtil(s),l=this.styleProps[s.type].get(e);if(l){const c={id:s.id,type:s.type,props:{[l]:n}};i.push({util:a,originalShape:s,updatePartial:c})}}};for(const s of r)o(s);this.updateShapes(i.map(({updatePartial:s})=>s))}return this}registerExternalAssetHandler(e,n){return this.externalAssetContentHandlers[e]=n,this}createTemporaryAssetPreview(e,n){if(this.temporaryAssetPreview.has(e))return this.temporaryAssetPreview.get(e);const r=URL.createObjectURL(n);return this.temporaryAssetPreview.set(e,r),setTimeout(()=>{this.temporaryAssetPreview.delete(e),URL.revokeObjectURL(r)},this.options.temporaryAssetPreviewLifetimeMs),r}getTemporaryAssetPreview(e){return this.temporaryAssetPreview.get(e)}async getAssetForExternalContent(e){return await this.externalAssetContentHandlers[e.type]?.(e)}hasExternalAssetHandler(e){return!!this.externalAssetContentHandlers[e]}registerExternalContentHandler(e,n){return this.externalContentHandlers[e]=n,this}async putExternalContent(e,n={}){if(!(!n.force&&this.getIsReadonly()))return this.externalContentHandlers[e.type]?.(e)}async replaceExternalContent(e,n={}){if(!(!n.force&&this.getIsReadonly()))return this.externalContentHandlers[e.type]?.(e)}getContentFromCurrentPage(e){const n=typeof e[0]=="string"?e:e.map(i=>i.id);if(!n||n.length===0)return;const r=this.getShapeAndDescendantIds(n);return v4(this,r,i=>{const o=[];for(const d of i){const u=this.getBinding(d);u&&o.push(u)}const s=[],a=[];for(const d of r){const u=this.getShape(d);if(!u)continue;if(!r.has(u.parentId)){const f=this.getShapePageTransform(u.id),y=f.point();a.push({...u,x:y.x,y:y.y,rotation:f.rotation(),parentId:this.getCurrentPageId()}),s.push(u.id)}else a.push(u)}const l=[],c=new Set;for(const d of a){if(!("assetId"in d.props))continue;const u=d.props.assetId;if(!u||c.has(u))continue;c.add(u);const p=this.getAsset(u);p&&l.push(p)}return{schema:this.store.schema.serialize(),shapes:a,rootShapeIds:s,bindings:o,assets:l}})}async resolveAssetsInContent(e){if(!e)return;const n=[];return await Promise.allSettled(e.assets.map(async r=>{if((r.type==="image"||r.type==="video")&&!r.props.src?.startsWith("data:image")&&!r.props.src?.startsWith("data:video")&&!r.props.src?.startsWith("http")){const i=fn(r),o=await this.store.props.assets.resolve(r,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginal:!0});i.props.src=await Si.blobToDataUrl(await gc(o).then(s=>s.blob())),n.push(i)}else n.push(r)})),e.assets=n,e}putContentOntoCurrentPage(e,n={}){if(this.getIsReadonly())return this;if(!e.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:r=!1,preserveIds:i=!1,preservePosition:o=!1}=n;let{point:s=void 0}=n;const a=this.getCurrentPageId(),{rootShapeIds:l}=e,c=[],d=[],u=[],p={store:{...Object.fromEntries(e.assets.map(L=>[L.id,L])),...Object.fromEntries(e.shapes.map(L=>[L.id,L])),...Object.fromEntries(e.bindings?.map(L=>[L.id,L])??[])},schema:e.schema},f=this.store.schema.migrateStoreSnapshot(p);if(f.type==="error")throw Error("Could not put content: could not migrate content");for(const L of Object.values(f.value))switch(L.typeName){case"asset":{c.push(L);break}case"shape":{d.push(L);break}case"binding":{u.push(L);break}}const y=new Map(i?d.map(L=>[L.id,L.id]):d.map(L=>[L.id,sn()])),v=new Map(i?u.map(L=>[L.id,L.id]):u.map(L=>[L.id,Bd()]));let x=this.getCurrentPageId(),b=1/0,w=[];for(const L of this.getSelectedShapes()){if(b===0)break;const j=this.isShapeOfType(L,"frame"),F=this.getShapeAncestors(L);j&&F.push(L);const z=j?F.length+1:F.length;if(z<b)b=z,w=F,x=j?L.id:L.parentId;else if(z===b){if(w.length!==F.length)throw Error(`Ancestors: ${w.length} !== ${F.length}`);if(w.length===0){x=a;break}else{x=a;for(let $=0;$<w.length&&F[$]===w[$];$++)x=F[$].id}}}let _=!1;if(!hi(x)){const L=this.getShape(x);if(L){if(!this.getViewportPageBounds().includes(this.getShapePageBounds(L)))x=a;else if(l.length===1){const j=d.find(F=>F.id===l[0]);this.isShapeOfType(L,"frame")&&this.isShapeOfType(j,"frame")&&j.props.w===L?.props.w&&j.props.h===L?.props.h&&(_=!0)}}else x=a}_||(_=y.has(x)),_&&(x=this.getShape(x).parentId);let C=this.getHighestIndexForParent(x);const A=[],E=d.map(L=>{const j=y.get(L.id),F={...L,id:j};return l.includes(L.id)&&(F.parentId=a,A.push(F)),y.has(F.parentId)?F.parentId=y.get(L.parentId):(l.push(F.id),F.index=C,C=na(C)),F});if(E.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return Fx(this),this;const O=u.map(L=>({...L,id:Gr(v.get(L.id)),fromId:Gr(y.get(L.fromId)),toId:Gr(y.get(L.toId))})),D=[],B=[];for(const L of c)this.store.has(L.id)||((L.type==="image"&&L.props.src?.startsWith("data:image")||L.type==="video"&&L.props.src?.startsWith("data:video"))&&(B.push(fn(L)),L.props.src=null),D.push(L));return Promise.allSettled(B.map(async L=>{const j=await Ode(L.props.src,L.props.name,L.props.mimeType??"image/png"),F=await this.getAssetForExternalContent({type:"file",file:j,assetId:L.id});if(!F){this.deleteAssets([L.id]);return}this.updateAssets([{...F,id:L.id}])})),this.run(()=>{D.length>0&&this.createAssets(D),this.createShapes(E),this.createBindings(O),r&&this.select(...A.map($=>$.id)),x!==a&&this.reparentShapes(A.map($=>$.id),x);const L=E.map($=>this.getShape($.id)),j=pe.Common(L.map($=>this.getShapePageBounds($)));if(s===void 0)if(hi(x)){const $=this.getViewportPageBounds();o||$.includes(pe.From(j))?s=j.center:s=$.center}else{const $=this.getShape(x);s=xe.applyToPoint(this.getShapePageTransform($),this.getShapeGeometry($).bounds.center)}if(A.length===1){const $=A[0];if(this.isShapeOfType($,"frame"))for(;this.getShapesAtPoint(s).some(V=>this.isShapeOfType(V,"frame")&&V.props.w===$.props.w&&V.props.h===$.props.h);)s.x+=j.w+16}const F=pe.Common(ut(A.map(({id:$})=>this.getShapePageBounds($)))).center,z=T.Sub(s,F);this.updateShapes(A.map(({id:$})=>{const V=this.getShape($),Y=this.getShapeParentTransform($).decompose().rotation,re=T.Rot(z,-Y);return{id:V.id,type:V.type,x:V.x+re.x,y:V.y+re.y}}))}),this}async getSvgElement(e,n={}){const r=e.length===0?this.getCurrentPageShapeIdsSorted():typeof e[0]=="string"?e:e.map(i=>i.id);if(r.length!==0)return kde(this,r,n)}async getSvgString(e,n={}){const r=await this.getSvgElement(e,n);return r?{svg:new XMLSerializer().serializeToString(r.svg),width:r.width,height:r.height}:void 0}async toImage(e,n={}){const r={format:"png",scale:1,pixelRatio:n.format==="svg"?void 0:2,...n},i=await this.getSvgString(e,r);if(!i)throw new Error("Could not create SVG");switch(r.format){case"svg":return{blob:new Blob([i.svg],{type:"image/svg+xml"}),width:i.width,height:i.height};case"jpeg":case"png":case"webp":{const o=await Ede(i.svg,{type:r.format,quality:r.quality,pixelRatio:r.pixelRatio,width:i.width,height:i.height});if(!o)throw new Error("Could not construct image.");return{blob:o,width:i.width,height:i.height}}default:Wt(r.format)}}async toImageDataUrl(e,n={}){const{blob:r,width:i,height:o}=await this.toImage(e,n);return{url:await Si.blobToDataUrl(r),width:i,height:o}}_updateInputsFromEvent(e){const{pointerVelocity:n,previousScreenPoint:r,previousPagePoint:i,currentScreenPoint:o,currentPagePoint:s,originScreenPoint:a,originPagePoint:l}=this.inputs,{screenBounds:c}=this.store.unsafeGetWithoutCapture(uo),{x:d,y:u,z:p}=lm(()=>this.getCamera()),f=e.point.x-c.x,y=e.point.y-c.y,v=e.point.z??.5;r.setTo(o),i.setTo(s),o.set(f,y);const x=f/p-d,b=y/p-u;isFinite(x)&&isFinite(b)&&s.set(x,b,v),this.inputs.isPen=e.type==="pointer"&&e.isPen,(e.name==="pointer_down"||this.inputs.isPinching)&&(n.set(0,0),a.setTo(o),l.setTo(s)),this.run(()=>{this.store.put([{id:cb,typeName:"pointer",x:s.x,y:s.y,lastActivityTimestamp:e.type==="pointer"&&e.pointerId===qz.CAMERA_MOVE?this.store.unsafeGetWithoutCapture(cb)?.lastActivityTimestamp??this._tickManager.now:this._tickManager.now,meta:{}}])},{history:"ignore"})}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}updatePointer(e){const n={type:"pointer",target:"canvas",name:"pointer_move",point:e?.point??T.Add(this.inputs.currentScreenPoint,this.store.unsafeGetWithoutCapture(uo).screenBounds),pointerId:e?.pointerId??0,button:e?.button??0,isPen:e?.isPen??this.inputs.isPen,shiftKey:e?.shiftKey??this.inputs.shiftKey,altKey:e?.altKey??this.inputs.altKey,ctrlKey:e?.ctrlKey??this.inputs.ctrlKey,metaKey:e?.metaKey??this.inputs.metaKey,accelKey:e?.accelKey??Rn(this.inputs)};return e?.immediate?this._flushEventForTick(n):this.dispatch(n),this}focus({focusContainer:e=!0}={}){return this.getIsFocused()?this:(e&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0}),this)}blur({blurContainer:e=!0}={}){return this.getIsFocused()?(e?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1}),this):this}getIsFocused(){return this.getInstanceState().isFocused}getIsReadonly(){return this.getInstanceState().isReadonly}getSnapshot(){return bue(this.store)}loadSnapshot(e,n){return v8(this.store,e,n),this}_zoomToFitPageContentAt100Percent(){const e=this.getCurrentPageBounds();e&&this.zoomToBounds(e,{immediate:!0,targetZoom:this.getBaseZoom()})}_navigateToDeepLink(e){this.run(()=>{switch(e.type){case"page":{const n=this.getPage(e.pageId);n&&this.setCurrentPage(n),this._zoomToFitPageContentAt100Percent();return}case"shapes":{const n=ut(e.shapeIds.map(s=>this.getShape(s))),r={};for(const s of n){const a=this.getAncestorPageId(s);a&&(r[a]??=[],r[a].push(s))}const[i,o]=Object.entries(r).sort(([s,a],[l,c])=>c.length-a.length)[0]??["",[]];if(!i||!o.length)this._zoomToFitPageContentAt100Percent();else{this.setCurrentPage(i);const s=pe.Common(o.map(a=>this.getShapePageBounds(a)));this.zoomToBounds(s,{immediate:!0,targetZoom:this.getBaseZoom()})}return}case"viewport":{if(e.pageId){if(!this.getPage(e.pageId)){this._zoomToFitPageContentAt100Percent();return}this.setCurrentPage(e.pageId)}this.zoomToBounds(e.bounds,{immediate:!0,inset:0});return}default:Wt(e)}})}navigateToDeepLink(e){if(e&&"type"in e)return this._navigateToDeepLink(e),this;const r=new URL(e?.url??window.location.href).searchParams.get(e?.param??"d");if(!r)return this._zoomToFitPageContentAt100Percent(),this;try{this._navigateToDeepLink(Rde(r))}catch(i){console.warn(i),this._zoomToFitPageContentAt100Percent()}return this}createDeepLink(e){const n=new URL(e?.url??window.location.href);return n.searchParams.set(e?.param??"d",jde(e?.to??{type:"viewport",pageId:this.options.maxPages===1?void 0:this.getCurrentPageId(),bounds:this.getViewportPageBounds()})),n}registerDeepLinkListener(e){if(e?.getUrl&&!e?.onChange)throw Error("[tldraw:urlStateSync] If you specify getUrl, you must also specify the onChange callback.");const n=fe("url with state",()=>{const s=e?.getUrl?.(this)??window.location.href;return this.createDeepLink({param:e?.param,url:s,to:e?.getTarget?.(this)}).toString()}),r=e?.onChange??(()=>{const s=this.createDeepLink({param:e?.param,to:e?.getTarget?.(this)});window.history.replaceState({},document.title,s.toString())}),i=Lw(s=>s(),e?.debounceMs??500),o=mo("update url on state change",()=>r(new URL(n.get()),this),{scheduleEffect:i});return()=>{o(),i.cancel()}}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_setShiftKeyTimeout(){this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:Rn(this.inputs),code:"ShiftLeft"})}_setAltKeyTimeout(){this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:Rn(this.inputs),code:"AltLeft"})}_setCtrlKeyTimeout(){this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:Rn(this.inputs),code:"ControlLeft"})}_setMetaKeyTimeout(){this.inputs.metaKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Meta",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:Rn(this.inputs),code:"MetaLeft"})}markEventAsHandled(e){const n="nativeEvent"in e?e.nativeEvent:e;this.handledEvents.add(n)}wasEventAlreadyHandled(e){const n="nativeEvent"in e?e.nativeEvent:e;return this.handledEvents.has(n)}dispatch(e){return this._pendingEventsForNextTick.push(e),e.type==="pointer"&&e.name==="pointer_move"||e.type==="wheel"||e.type==="pinch"||this._flushEventsForTick(0),this}_flushEventsForTick(e){this.run(()=>{if(this._pendingEventsForNextTick.length>0){const n=[...this._pendingEventsForNextTick];this._pendingEventsForNextTick.length=0;for(const r of n)this._flushEventForTick(r)}e>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed:e}),this.scribbles.tick(e)})}_flushEventForTick(e){if(this.getCrashingError())return this;this.emit("before-event",e);const{inputs:n}=this,{type:r}=e;if(e.type==="misc"){(e.name==="cancel"||e.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0}))),this.root.handleEvent(e);return}e.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,n.shiftKey=!0):!e.shiftKey&&n.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),e.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,n.altKey=!0):!e.altKey&&n.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),e.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,n.ctrlKey=!0):!e.ctrlKey&&n.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150)),e.metaKey?(clearTimeout(this._metaKeyTimeout),this._metaKeyTimeout=-1,n.metaKey=!0):!e.metaKey&&n.metaKey&&this._metaKeyTimeout===-1&&(this._metaKeyTimeout=this.timers.setTimeout(this._setMetaKeyTimeout,150));const{originPagePoint:i,currentPagePoint:o}=n;n.isPointing||(n.isDragging=!1);const s=this.store.unsafeGetWithoutCapture(uo),a=this.store.get(this._getCurrentPageStateId()),l=this._cameraOptions.__unsafe__getWithoutCapture();switch(r){case"pinch":{if(l.isLocked)return;switch(clearTimeout(this._longPressTimeout),this._updateInputsFromEvent(e),e.name){case"pinch_start":{if(n.isPinching)return;n.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=[...a.selectedShapeIds]),this._didPinch=!0,n.isPinching=!0,this.interrupt());return}case"pinch":{if(!n.isPinching)return;const{point:{z:c=1},delta:{x:d,y:u}}=e,{x:p,y:f}=T.SubXY(e.point,s.screenBounds.x,s.screenBounds.y);this.stopCameraAnimation(),s.followingUserId&&this.stopFollowingUser();const{x:y,y:v,z:x}=lm(()=>this.getCamera()),{panSpeed:b}=l;this._setCamera(new T(y+d*b/x-p/x+p/c,v+u*b/x-f/x+f/c,c),{immediate:!0});return}case"pinch_end":{if(!n.isPinching)return this;n.isPinching=!1;const{_selectedShapeIdsAtPointerDown:c}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,c.length>0&&this.once("tick",()=>{this._didPinch||this.setSelectedShapes(c)}));return}}}case"wheel":{if(l.isLocked)return;this._updateInputsFromEvent(e);const{panSpeed:c,zoomSpeed:d}=l;let u=l.wheelBehavior;const p=this.user.getUserPreferences().inputMode;if(p!==null&&(u=p==="trackpad"?"pan":"zoom"),u!=="none"){this.stopCameraAnimation(),s.followingUserId&&this.stopFollowingUser();const{x:f,y,z:v}=lm(()=>this.getCamera()),{x,y:b,z:w=0}=e.delta;let _=u;switch(e.ctrlKey&&(_=u==="pan"?"zoom":"pan"),_){case"zoom":{const{x:C,y:A}=this.inputs.currentScreenPoint;let E=w;u==="zoom"&&(Math.abs(b)>10?E=10*Math.sign(b)/100:E=b/100);const O=v+(E??0)*d*v;this._setCamera(new T(f+C/O-C/v,y+A/O-A/v,O),{immediate:!0}),this.maybeTrackPerformance("Zooming");return}case"pan":{this._setCamera(new T(f+x*c/v,y+b*c/v,v),{immediate:!0}),this.maybeTrackPerformance("Panning");return}}}break}case"pointer":{if(n.isPinching)return;this._updateInputsFromEvent(e);const{isPen:c}=e,{isPenMode:d}=s;switch(e.name){case"pointer_down":{if(d&&!c)return;if(this.inputs.isPanning||(this._longPressTimeout=this.timers.setTimeout(()=>{const u=this.getViewportScreenBounds();this.dispatch({...e,point:this.inputs.originScreenPoint.clone().addXY(u.x,u.y),name:"long_press"})},this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),e.button===Gz&&(this.capturedPointerId=e.pointerId),n.buttons.add(e.button),n.isPointing=!0,n.isDragging=!1,!d&&c&&this.updateInstanceState({isPenMode:!0}),e.button===Yz?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):e.button===jx&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout)),this.inputs.isPanning)return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break}case"pointer_move":{if(!c&&d)return;const{x:u,y:p,z:f}=lm(()=>this.getCamera());if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:y,previousScreenPoint:v}=this.inputs,x=T.Sub(y,v);this.setCamera(new T(u+x.x/f,p+x.y/f,f),{immediate:!0}),this.maybeTrackPerformance("Panning");return}n.isPointing&&!n.isDragging&&T.Dist2(i,o)*this.getZoomLevel()>(s.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/f&&(n.isDragging=!0,clearTimeout(this._longPressTimeout));break}case"pointer_up":{if(n.isDragging=!1,n.isPointing=!1,clearTimeout(this._longPressTimeout),n.buttons.delete(e.button),s.isPenMode&&!c)return;if(this.capturedPointerId===e.pointerId&&(this.capturedPointerId=null,e.button=0),n.isPanning){n.keys.has("Space")||(n.isPanning=!1,n.isSpacebarPanning=!1);const u=this.inputs.pointerVelocity,p=Math.min(2,u.len());switch(e.button){case Gz:{this.setCursor({type:"grab",rotation:0});break}case jx:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}p>0&&this.slideCamera({speed:p,direction:u})}else e.button===Yz&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(e.key==="ShiftRight"&&(e.key="ShiftLeft"),e.key==="AltRight"&&(e.key="AltLeft"),e.code==="ControlRight"&&(e.code="ControlLeft"),e.code==="MetaRight"&&(e.code="MetaLeft"),e.name){case"key_down":{if(n.keys.add(e.code),e.code==="Space"&&!e.ctrlKey&&(this.inputs.isPanning||(this._prevCursor=s.cursor.type),this.inputs.isPanning=!0,this.inputs.isSpacebarPanning=!0,clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.isPointing?"grabbing":"grab",rotation:0})),this.inputs.isSpacebarPanning){let c;switch(e.code){case"ArrowUp":{c=new T(0,-1);break}case"ArrowRight":{c=new T(1,0);break}case"ArrowDown":{c=new T(0,1);break}case"ArrowLeft":{c=new T(-1,0);break}}if(c){const d=this.getViewportPageBounds(),u=d.clone().translate(c.mulV({x:d.w,y:d.h}));this._animateToViewport(u,{animation:{duration:320}})}}break}case"key_up":{n.keys.delete(e.code),e.code==="Space"&&(this.inputs.buttons.has(jx)||(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0})));break}}break}}if(e.type==="pointer"){e.button===jx?e.name="middle_click":e.button===Z2&&(e.name="right_click");const{isPenMode:c}=this.store.unsafeGetWithoutCapture(uo);if(e.isPen===c){const d=this._clickManager.handlePointerEvent(e);if(e.name!==d.name){this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(d),this.emit("event",d);return}}}return this.root.handleEvent(e),this.emit("event",e),e.type==="pointer"&&e.name==="pointer_down"&&this.menus.clearOpenMenus(),this}maybeTrackPerformance(e){Vn.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(e),this.performanceTrackerTimeout=this.timers.setTimeout(()=>{this.performanceTracker.stop()},50))}};Le=ope(ET);Be(Le,1,"getIsShapeHiddenCache",_7,Ne);Be(Le,1,"getCanUndo",I7,Ne);Be(Le,1,"getCanRedo",k7,Ne);Be(Le,1,"getPath",w7,Ne);Be(Le,1,"getCurrentTool",b7,Ne);Be(Le,1,"getCurrentToolId",S7,Ne);Be(Le,1,"getDocumentSettings",x7,Ne);Be(Le,1,"getInstanceState",v7,Ne);Be(Le,1,"getPageStates",y7,Ne);Be(Le,1,"_getPageStatesQuery",m7,Ne);Be(Le,1,"getCurrentPageState",g7,Ne);Be(Le,1,"_getCurrentPageStateId",f7,Ne);Be(Le,1,"getSelectedShapeIds",p7,Ne);Be(Le,1,"getSelectedShapes",h7,Ne);Be(Le,1,"getCurrentPageShapesInReadingOrder",d7,Ne);Be(Le,1,"getOnlySelectedShapeId",u7,Ne);Be(Le,1,"getOnlySelectedShape",c7,Ne);Be(Le,1,"getSelectionPageBounds",l7,Ne);Be(Le,1,"getSelectionRotation",a7,Ne);Be(Le,1,"getSelectionRotatedPageBounds",s7,Ne);Be(Le,1,"getSelectionRotatedScreenBounds",o7,Ne);Be(Le,1,"getFocusedGroupId",i7,Ne);Be(Le,1,"getFocusedGroup",r7,Ne);Be(Le,1,"getEditingShapeId",n7,Ne);Be(Le,1,"getEditingShape",t7,Ne);Be(Le,1,"getRichTextEditor",e7,Ne);Be(Le,1,"getHoveredShapeId",QH,Ne);Be(Le,1,"getHoveredShape",JH,Ne);Be(Le,1,"getHintingShapeIds",ZH,Ne);Be(Le,1,"getHintingShape",XH,Ne);Be(Le,1,"getErasingShapeIds",YH,Ne);Be(Le,1,"getErasingShapes",GH,Ne);Be(Le,1,"_unsafe_getCameraId",qH,Ne);Be(Le,1,"getCamera",KH,Ne);Be(Le,1,"getViewportPageBoundsForFollowing",VH,Ne);Be(Le,1,"getCameraForFollowing",WH,Ne);Be(Le,1,"getZoomLevel",HH,Ne);Be(Le,1,"getViewportScreenBounds",UH,Ne);Be(Le,1,"getViewportScreenCenter",BH,Ne);Be(Le,1,"getViewportPageBounds",FH,Ne);Be(Le,1,"_getCollaboratorsQuery",zH,Ne);Be(Le,1,"getCollaborators",LH,Ne);Be(Le,1,"getCollaboratorsOnCurrentPage",NH,Ne);Be(Le,1,"getRenderingShapes",$H,Ne);Be(Le,1,"_getAllPagesQuery",RH,Ne);Be(Le,1,"getPages",jH,Ne);Be(Le,1,"getCurrentPageId",DH,Ne);Be(Le,1,"getCurrentPageShapeIdsSorted",OH,Ne);Be(Le,1,"_getAllAssetsQuery",MH,Ne);Be(Le,1,"_getShapeHandlesCache",AH,Ne);Be(Le,1,"_getShapePageTransformCache",EH,Ne);Be(Le,1,"_getShapePageBoundsCache",TH,Ne);Be(Le,1,"_getShapeClipPathCache",PH,Ne);Be(Le,1,"_getShapeMaskCache",CH,Ne);Be(Le,1,"_getShapeMaskedPageBoundsCache",_H,Ne);Be(Le,1,"getNotVisibleShapes",IH,Ne);Be(Le,1,"getCulledShapes",kH,Ne);Be(Le,1,"getCurrentPageBounds",wH,Ne);Be(Le,1,"getCurrentPageShapes",bH,Ne);Be(Le,1,"getCurrentPageShapesSorted",SH,Ne);Be(Le,1,"getCurrentPageRenderingShapesSorted",xH,Ne);Be(Le,1,"_getBindingsIndexCache",vH,Ne);Be(Le,1,"_getSelectionSharedStyles",yH,Ne);Be(Le,1,"getSharedStyles",mH,Ne);Be(Le,1,"getSharedOpacity",gH,Ne);Be(Le,1,"getIsFocused",fH,Ne);Be(Le,1,"getIsReadonly",pH,Ne);Be(Le,1,"_setShiftKeyTimeout",hH,Ne);Be(Le,1,"_setAltKeyTimeout",dH,Ne);Be(Le,1,"_setCtrlKeyTimeout",uH,Ne);Be(Le,1,"_setMetaKeyTimeout",cH,Ne);ape(Le,Ne);function Fx(t,e=t.getCurrentPageId()){const n=t.getPage(e).name;t.emit("max-shapes",{name:n,pageId:e,count:t.options.maxShapesPerPage})}function sl(t,e){if(!e)return t;let n=null;const r=Object.entries(e);for(let i=0,o=r.length;i<o;i++){const[s,a]=r[i];if(a!==void 0&&!(s==="id"||s==="type"||s==="typeName")&&a!==t[s]){if(n||(n={...t}),s==="props"||s==="meta"){n[s]={...t[s]};for(const[l,c]of Object.entries(a))n[s][l]=c;continue}n[s]=a}}return n||t}function C7(t,e,n){const r=t.getShape(e);if(!r)return;n.push(r);const i=t.getSortedChildIdsForParent(e);for(let o=0,s=i.length;o<s;o++)C7(t,i[o],n)}function v4(t,e,n){let r;if(t.run(()=>{const i=t.store.extractingChanges(()=>{const o=new Set,s=new Set;for(const a of e)if(t.getShape(a))for(const c of t.getBindingsInvolvingShape(a)){const d=e.has(c.fromId),u=e.has(c.toId);if(d&&u){o.add(c.id);continue}(!d||!u)&&s.add(c.id)}t.deleteBindings([...s],{isolateShapes:!0});try{r=Iu.ok(n(o))}catch(a){r=Iu.err(a)}});t.store.applyDiff(lf(i),{runCallbacks:!1})},{history:"ignore"}),r.ok)return r.value;throw r.error}function x4(t,e){if(!e.constraints)throw Error("Should have constraints here");const{padding:{x:n,y:r}}=e.constraints,i=t.getViewportScreenBounds(),o=pe.From(e.constraints.bounds),s=(i.w-n*2)/o.w,a=(i.h-r*2)/o.h;return{zx:s,zy:a}}function p0(){const t=ne(),e=Jy();return J("isDarkMode",()=>e?.isDarkMode??t.user.getIsDarkMode(),[e,t])}const S4="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",b4="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",Bx='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function Qc(t,e,n,r,i,o=16,s=16){const a=(-n-e)*(nn/180),l=Math.sin(a),c=Math.cos(a),d=1*c-1*l,u=1*l+1*c;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${i};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${d}' dy='${u}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${e+n} 16 16)${r?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+t.replaceAll('"',"'")+`</g></svg>") ${o} ${s}, pointer`}const cpe=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],upe={none:()=>"none","ew-resize":(t,e,n)=>Qc(b4,t,0,e,n),"ns-resize":(t,e,n)=>Qc(b4,t,90,e,n),"nesw-resize":(t,e,n)=>Qc(S4,t,0,e,n),"nwse-resize":(t,e,n)=>Qc(S4,t,90,e,n),"nwse-rotate":(t,e,n)=>Qc(Bx,t,0,e,n),"nesw-rotate":(t,e,n)=>Qc(Bx,t,90,e,n),"senw-rotate":(t,e,n)=>Qc(Bx,t,180,e,n),"swne-rotate":(t,e,n)=>Qc(Bx,t,270,e,n)};function ps(t,e=0,n="black"){return upe[t](Fce(e),!1,n)}function dpe(){const t=ne(),e=Cr(),n=p0();Yd("useCursor",()=>{const{type:r,rotation:i}=t.getInstanceState().cursor;if(cpe.includes(r)){e.style.setProperty("--tl-cursor",`var(--tl-cursor-${r})`);return}e.style.setProperty("--tl-cursor",ps(r,i,n?"white":"black"))},[t,e,n])}function hpe(){const t=ne(),e=Cr(),n=p0(),r=J(Vn.forceSrgb);rt.useEffect(()=>{n?(e.setAttribute("data-color-mode","dark"),e.classList.remove("tl-theme__light"),e.classList.add("tl-theme__dark")):(e.setAttribute("data-color-mode","light"),e.classList.remove("tl-theme__dark"),e.classList.add("tl-theme__light")),r?e.classList.add("tl-theme__force-sRGB"):e.classList.remove("tl-theme__force-sRGB")},[t,e,r,n])}function ppe(){const[t,e]=I.useState(0);I.useEffect(()=>e(n=>n+1),[])}const fpe=t=>t.props.src,gpe={upload:async(t,e)=>({src:await Si.blobToDataUrl(e)})};function mpe(t){return"schema"in t&&t.schema?t.schema:Ace({shapes:"shapeUtils"in t&&t.shapeUtils?w4(_8(t.shapeUtils)):void 0,bindings:"bindingUtils"in t&&t.bindingUtils?w4(S8(t.bindingUtils)):void 0,migrations:"migrations"in t?t.migrations:void 0})}function vb({initialData:t,defaultName:e="",id:n,assets:r=gpe,onMount:i,collaboration:o,...s}={}){const a=mpe(s),l=new L2({id:n,schema:a,initialData:t,props:{defaultName:e,assets:{upload:r.upload,resolve:r.resolve??fpe,remove:r.remove??(()=>Promise.resolve())},onMount:c=>{Ge(c instanceof Ne),i?.(c)},collaboration:o}});if(s.snapshot){if(t)throw new Error("Cannot provide both initialData and snapshot");v8(l,s.snapshot,{forceOverwriteSessionState:!0})}return l}function w4(t){return Object.fromEntries(t.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}const ype=(t,e)=>e.some(n=>t instanceof n);let k4,I4;function vpe(){return k4||(k4=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function xpe(){return I4||(I4=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const P7=new WeakMap,AT=new WeakMap,T7=new WeakMap,qC=new WeakMap,fA=new WeakMap;function Spe(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",o),t.removeEventListener("error",s)},o=()=>{n(hc(t.result)),i()},s=()=>{r(t.error),i()};t.addEventListener("success",o),t.addEventListener("error",s)});return e.then(n=>{n instanceof IDBCursor&&P7.set(n,t)}).catch(()=>{}),fA.set(e,t),e}function bpe(t){if(AT.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",s),t.removeEventListener("abort",s)},o=()=>{n(),i()},s=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",o),t.addEventListener("error",s),t.addEventListener("abort",s)});AT.set(t,e)}let MT={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return AT.get(t);if(e==="objectStoreNames")return t.objectStoreNames||T7.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return hc(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function wpe(t){MT=t(MT)}function kpe(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(GC(this),e,...n);return T7.set(r,e.sort?e.sort():[e]),hc(r)}:xpe().includes(t)?function(...e){return t.apply(GC(this),e),hc(P7.get(this))}:function(...e){return hc(t.apply(GC(this),e))}}function Ipe(t){return typeof t=="function"?kpe(t):(t instanceof IDBTransaction&&bpe(t),ype(t,vpe())?new Proxy(t,MT):t)}function hc(t){if(t instanceof IDBRequest)return Spe(t);if(qC.has(t))return qC.get(t);const e=Ipe(t);return e!==t&&(qC.set(t,e),fA.set(e,t)),e}const GC=t=>fA.get(t);function E7(t,e,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){const s=indexedDB.open(t,e),a=hc(s);return r&&s.addEventListener("upgradeneeded",l=>{r(hc(s.result),l.oldVersion,l.newVersion,hc(s.transaction),l)}),n&&s.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{o&&l.addEventListener("close",()=>o()),i&&l.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}function A7(t,{blocked:e}={}){const n=indexedDB.deleteDatabase(t);return e&&n.addEventListener("blocked",r=>e(r.oldVersion,r)),hc(n).then(()=>{})}const _pe=["get","getKey","getAll","getAllKeys","count"],Cpe=["put","add","delete","clear"],YC=new Map;function _4(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(YC.get(e))return YC.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=Cpe.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||_pe.includes(n)))return;const o=async function(s,...a){const l=this.transaction(s,i?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),i&&l.done]))[0]};return YC.set(e,o),o}wpe(t=>({...t,get:(e,n,r)=>_4(e,n)||t.get(e,n,r),has:(e,n)=>!!_4(e,n)||t.has(e,n)}));const Ppe="TLDRAW_DOCUMENT_v2",Tpe="TLDRAW_ASSET_STORE_v1",M7="TLDRAW_DB_NAME_INDEX_v2",Rt={Records:"records",Schema:"schema",SessionState:"session_state",Assets:"assets"};async function O7(t){const e=Ppe+t;return Ape(e),await E7(e,4,{upgrade(n){n.objectStoreNames.contains(Rt.Records)||n.createObjectStore(Rt.Records),n.objectStoreNames.contains(Rt.Schema)||n.createObjectStore(Rt.Schema),n.objectStoreNames.contains(Rt.SessionState)||n.createObjectStore(Rt.SessionState),n.objectStoreNames.contains(Rt.Assets)||n.createObjectStore(Rt.Assets)}})}async function Epe(t){const e=window.indexedDB.databases?(await window.indexedDB.databases()).map(p=>p.name):gA(),n=Tpe+t;if(!e.find(p=>p===n))return;const i=await E7(n,1,{upgrade(p){p.objectStoreNames.contains("assets")||p.createObjectStore("assets")}});if(!i.objectStoreNames.contains("assets"))return;const o=i.transaction(["assets"],"readonly"),s=o.objectStore("assets"),a=await s.getAllKeys(),l=await Promise.all(a.map(async p=>[p,await s.get(p)]));await o.done;const c=await O7(t),d=c.transaction([Rt.Assets],"readwrite"),u=d.objectStore(Rt.Assets);for(const[p,f]of l)u.put(f,p);await d.done,i.close(),c.close(),await A7(n)}class iy{getDbPromise;isClosed=!1;pendingTransactionSet=new Set;static connectedInstances=new Set;constructor(e){iy.connectedInstances.add(this),this.getDbPromise=(async()=>(await Epe(e),await O7(e)))()}getDb(){return this.getDbPromise}pending(){return Promise.allSettled([this.getDbPromise,...this.pendingTransactionSet]).then(Xm)}async close(){this.isClosed||(this.isClosed=!0,await this.pending(),(await this.getDb()).close(),iy.connectedInstances.delete(this))}tx(e,n,r){const i=(async()=>{Ge(!this.isClosed,"db is closed");const s=(await this.getDb()).transaction(n,e),a=s.done.catch(l=>{if(!this.isClosed)throw l});try{return await r(s)}finally{this.isClosed?s.abort():await a}})();return this.pendingTransactionSet.add(i),i.finally(()=>this.pendingTransactionSet.delete(i)),i}async load({sessionId:e}={}){return await this.tx("readonly",[Rt.Records,Rt.Schema,Rt.SessionState],async n=>{const r=n.objectStore(Rt.Records),i=n.objectStore(Rt.Schema),o=n.objectStore(Rt.SessionState);let s=e?(await o.get(e))?.snapshot:null;return s||(s=(await o.getAll()).sort((c,d)=>c.updatedAt-d.updatedAt).pop()?.snapshot),{records:await r.getAll(),schema:await i.get(Rt.Schema),sessionStateSnapshot:s}})}async storeChanges({schema:e,changes:n,sessionId:r,sessionStateSnapshot:i}){await this.tx("readwrite",[Rt.Records,Rt.Schema,Rt.SessionState],async o=>{const s=o.objectStore(Rt.Records),a=o.objectStore(Rt.Schema),l=o.objectStore(Rt.SessionState);for(const[c,d]of Object.entries(n.added))await s.put(d,c);for(const[c,d]of Object.values(n.updated))await s.put(d,d.id);for(const c of Object.keys(n.removed))await s.delete(c);a.put(e.serialize(),Rt.Schema),i&&r?l.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async storeSnapshot({schema:e,snapshot:n,sessionId:r,sessionStateSnapshot:i}){await this.tx("readwrite",[Rt.Records,Rt.Schema,Rt.SessionState],async o=>{const s=o.objectStore(Rt.Records),a=o.objectStore(Rt.Schema),l=o.objectStore(Rt.SessionState);await s.clear();for(const[c,d]of Object.entries(n))await s.put(d,c);a.put(e.serialize(),Rt.Schema),i&&r?l.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async pruneSessions(){await this.tx("readwrite",[Rt.SessionState],async e=>{const n=e.objectStore(Rt.SessionState),r=(await n.getAll()).sort((o,s)=>o.updatedAt-s.updatedAt);if(r.length<10){await e.done;return}const i=r.slice(0,r.length-10);for(const{id:o}of i)await n.delete(o)})}async getAsset(e){return await this.tx("readonly",[Rt.Assets],async n=>await n.objectStore(Rt.Assets).get(e))}async storeAsset(e,n){await this.tx("readwrite",[Rt.Assets],async r=>{await r.objectStore(Rt.Assets).put(n,e)})}async removeAssets(e){await this.tx("readwrite",[Rt.Assets],async n=>{const r=n.objectStore(Rt.Assets);for(const i of e)await r.delete(i)})}}function gA(){const t=JSON.parse(h2(M7)||"[]")??[];return Array.isArray(t)?t:[]}function Ape(t){const e=new Set(gA());e.add(t),p2(M7,JSON.stringify([...e]))}function Mpe(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
• If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
• If your hard disk is full, try clearing up some space and then reload the page.`)}function Ope(){window.alert(`Oops! We could not access your browser's storage—and the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
• If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const Dpe=350,jpe=1e4,C4=Symbol("UPDATE_INSTANCE_STATE"),Rpe=t=>t;class $pe{onmessage;constructor(e){}postMessage(e){}close(){}}const Npe=typeof BroadcastChannel>"u"?$pe:BroadcastChannel;class Lpe{constructor(e,{persistenceKey:n,sessionId:r=gb,onLoad:i,onLoadError:o},s=new Npe(`tldraw-tab-sync-${n}`)){this.store=e,this.channel=s,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=n,this.sessionId=r,this.db=new iy(n),this.disposables.add(()=>this.db.close()),this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=rA(this.store),this.disposables.add(e.listen(({changes:a})=>{this.diffQueue.push(a),this.channel.postMessage(Rpe({type:"diff",storeId:this.store.id,changes:a,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(C4),this.schedulePersist()},{scope:"session"})),this.connect(i,o),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(a=>a.scope==="document").map(a=>a.typeName))}disposables=new Set;diffQueue=[];didDispose=!1;shouldDoFullDBWrite=!0;isReloading=!1;persistenceKey;sessionId;serializedSchema;isDebugging=!1;documentTypes;$sessionStateSnapshot;db;initTime=Date.now();debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,n){this.debug("connecting");let r;try{r=await this.db.load({sessionId:this.sessionId})}catch(i){n(i),Ope();return}if(this.debug("loaded data from store",r,"didDispose",this.didDispose),!this.didDispose)try{if(r){const i=Object.fromEntries(r.records.map(l=>[l.id,l])),o=r.sessionStateSnapshot??Sue(i),s=this.store.schema.migrateStoreSnapshot({store:i,schema:r.schema??this.store.schema.serializeEarliestVersion()});if(s.type==="error"){console.error("failed to migrate store",s),n(new Error(`Failed to migrate store: ${s.reason}`));return}const a=Object.values(s.value).filter(l=>this.documentTypes.has(l.typeName));a.length>0&&this.store.mergeRemoteChanges(()=>{this.store.put(a,"initialize")}),o&&IT(this.store,o,{forceOverwrite:!0})}this.channel.onmessage=({data:i})=>{this.debug("got message",i);const o=i,s=this.store.schema.getMigrationsSince(o.schema);if(s.ok){if(s.value.length>0){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}}else{if(Date.now()-this.initTime<5e3){n(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,window?.location?.reload?.();return}o.type==="diff"&&(this.debug("applying diff"),ws(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(o.changes)})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(i){if(this.debug("error loading data from store",i),this.didDispose)return;n(i);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}isPersisting=!1;didLastWriteError=!1;scheduledPersistTimeout=null;schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?jpe:Dpe))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){if(Ge(!this.isPersisting,"persist already in progress"),this.didDispose)return;this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await this.db.storeSnapshot({schema:this.store.schema,snapshot:this.store.serialize(),sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const n=Vy(e.filter(r=>r!==C4));await this.db.storeChanges({changes:n,schema:this.store.schema,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(n){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",n),Mpe(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function D7(t){const e=I.useRef(t),[n,r]=I.useState(t);n!==e.current&&r(e.current);const i=I.useCallback(o=>{typeof o=="function"?e.current=o(e.current):e.current=o,r(e.current)},[]);return[n,i]}function zpe(t){const[e,n]=D7({status:"loading"});return t=Of(t),I.useEffect(()=>{const{persistenceKey:r,sessionId:i,...o}=t;if(!r){n({status:"not-synced",store:vb(o)});return}n({status:"loading"});const s=new ki,a={upload:async(u,p)=>(await d.db.storeAsset(u.id,p),{src:u.id}),resolve:async u=>u.props.src?u.props.src.startsWith("asset:")?await s.get(u,async()=>{const p=await d.db.getAsset(u.id);return p?URL.createObjectURL(p):null}):u.props.src:null,remove:async u=>{await d.db.removeAssets(u)},...o.assets},l=vb({...o,assets:a});let c=!1;const d=new Lpe(l,{sessionId:i,persistenceKey:r,onLoad(){c||n({store:l,status:"synced-local"})},onLoadError(u){c||n({status:"error",error:u})}});return()=>{c=!0,d.close()}},[t,n]),e}function Fpe(){const t=ne();I.useLayoutEffect(()=>mo("stateAttribute",()=>{t.getContainer().setAttribute("data-state",t.getPath())}),[t])}function Bpe(){const t=ne(),e=Cr();I.useEffect(()=>{const n=o=>e.style.setProperty("--tl-zoom",o.toString()),r=Lw(n,100),i=new wh("useZoomCss",()=>{t.getCurrentPageShapeIds().size<300?n(t.getZoomLevel()):r(t.getZoomLevel())});return i.attach(),i.execute(),()=>{i.detach(),r.cancel()}},[t,e])}function OT(t){const e=new ArrayBuffer(t.length),n=new Uint8Array(e);for(let r=0,i=t.length;r<i;r++)n[r]=t.charCodeAt(r);return e}function Upe(t){const e=atob(t),n=OT(e);return crypto.subtle.importKey("spki",new Uint8Array(n),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}const Hpe=30,Td={ANNUAL_LICENSE:1,PERPETUAL_LICENSE:2,INTERNAL_LICENSE:4,WITH_WATERMARK:8,EVALUATION_LICENSE:16,NATIVE_LICENSE:32},Wpe=Math.max(...Object.values(Td)),cm={ID:0,HOSTS:1,FLAGS:2,EXPIRY_DATE:3},Vpe=Object.keys(cm).length,hp="sales@tldraw.com",Kpe=`${Ar()}/watermarks/watermark-track.svg`;class f0{publicKey="MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHJh0uUfxHtCGyerXmmatE368Hd9rI6LH9oPDQihnaCryRFWEVeOvf9U/SPbyxX74LFyJs5tYeAHq5Nc0Ax25LQ";isDevelopment;isTest;isCryptoAvailable;state=qt("license state","pending");verbose=!0;constructor(e,n){this.isTest=!1,this.isDevelopment=this.getIsDevelopment(),this.publicKey=n||this.publicKey,this.isCryptoAvailable=!!crypto.subtle,this.getLicenseFromKey(e).then(r=>{const i=qpe(r,o=>this.outputMessages(o),this.isDevelopment);this.maybeTrack(r,i),this.state.set(i)}).catch(r=>{console.error("License validation failed:",r),this.state.set("unlicensed")})}getIsDevelopment(){return!["https:","vscode-webview:"].includes(window.location.protocol)||window.location.hostname==="localhost"||!1}getTrackType(e,n){return n==="unlicensed-production"?"unlicensed":this.isDevelopment||!e.isLicenseParseable?null:e.isEvaluationLicense?"evaluation":n==="licensed-with-watermark"?"with_watermark":null}maybeTrack(e,n){const r=this.getTrackType(e,n);if(!r)return;const i=new URL(Kpe);i.searchParams.set("version",tA),i.searchParams.set("license_type",r),"license"in e&&i.searchParams.set("license_id",e.license.id),i.searchParams.set("environment","production"),fetch(i.toString())}async extractLicenseKey(e){const[n,r]=e.split("."),[i,o]=n.split("/");if(!i.startsWith("tldraw-"))throw new Error(`Unsupported prefix '${i}'`);const s=await Upe(this.publicKey);let a;try{a=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},s,new Uint8Array(OT(atob(r))),new Uint8Array(OT(atob(o))))}catch(c){throw console.error(c),new Error("Could not perform signature validation")}if(!a)throw new Error("Invalid signature");let l;try{l=JSON.parse(atob(o))}catch{throw new Error("Could not parse object")}return l.length>Vpe&&this.outputMessages(["License key contains some unknown properties.","You may want to update tldraw packages to a newer version to get access to new functionality."]),{id:l[cm.ID],hosts:l[cm.HOSTS],flags:l[cm.FLAGS],expiryDate:l[cm.EXPIRY_DATE]}}async getLicenseFromKey(e){if(!e)return this.isDevelopment||this.outputNoLicenseKeyProvided(),{isLicenseParseable:!1,reason:"no-key-provided"};if(this.isDevelopment&&!this.isCryptoAvailable)return this.verbose&&(console.log("tldraw: you seem to be in a development environment that does not support crypto. License not verified."),console.log("You should check that this works in production separately.")),{isLicenseParseable:!1,reason:"has-key-development-mode"};let n=e.replace(/[\u200B-\u200D\uFEFF]/g,"");n=n.replace(/\r?\n|\r/g,"");try{const r=await this.extractLicenseKey(n),i=new Date(r.expiryDate),o=this.isFlagEnabled(r.flags,Td.ANNUAL_LICENSE),s=this.isFlagEnabled(r.flags,Td.PERPETUAL_LICENSE),a=this.isFlagEnabled(r.flags,Td.EVALUATION_LICENSE),l=this.getDaysSinceExpiry(i),c={license:r,isLicenseParseable:!0,isDevelopment:this.isDevelopment,isDomainValid:this.isDomainValid(r),expiryDate:i,isAnnualLicense:o,isAnnualLicenseExpired:o&&this.isAnnualLicenseExpired(i),isPerpetualLicense:s,isPerpetualLicenseExpired:s&&this.isPerpetualLicenseExpired(i),isInternalLicense:this.isFlagEnabled(r.flags,Td.INTERNAL_LICENSE),isNativeLicense:this.isNativeLicense(r),isLicensedWithWatermark:this.isFlagEnabled(r.flags,Td.WITH_WATERMARK),isEvaluationLicense:a,isEvaluationLicenseExpired:a&&this.isEvaluationLicenseExpired(i),daysSinceExpiry:l};return this.outputLicenseInfoIfNeeded(c),c}catch(r){return this.outputInvalidLicenseKey(r.message),{isLicenseParseable:!1,reason:"invalid-license-key"}}}isDomainValid(e){const n=window.location.hostname.toLowerCase();return e.hosts.some(r=>{const i=r.toLowerCase().trim();if(i===n||`www.${i}`===n||i===`www.${n}`||r==="*")return!0;if(this.isNativeLicense(e))return new RegExp(i).test(window.location.href);if(r.includes("*")){const o=new RegExp(r.replace(/\*/g,".*?"));return o.test(n)||o.test(`www.${n}`)}if(window.location.protocol==="vscode-webview:"){const s=new URL(window.location.href).searchParams.get("extensionId");if(i===s)return!0}return!1})}isNativeLicense(e){return this.isFlagEnabled(e.flags,Td.NATIVE_LICENSE)}getExpirationDateWithoutGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}getExpirationDateWithGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+Hpe+1)}isAnnualLicenseExpired(e){const n=this.getExpirationDateWithGracePeriod(e);return new Date>=n}isPerpetualLicenseExpired(e){const n=this.getExpirationDateWithGracePeriod(e),r={major:new Date(Zz.major),minor:new Date(Zz.minor)};return r.major>=n||r.minor>=n}getDaysSinceExpiry(e){const n=new Date,r=this.getExpirationDateWithoutGracePeriod(e),i=n.getTime()-r.getTime(),o=Math.floor(i/(1e3*60*60*24));return Math.max(0,o)}isEvaluationLicenseExpired(e){const n=new Date,r=this.getExpirationDateWithoutGracePeriod(e);return n>=r}isFlagEnabled(e,n){return(e&n)===n}outputNoLicenseKeyProvided(){}outputInvalidLicenseKey(e){this.outputMessages(["Invalid tldraw license key",`Reason: ${e}`])}outputLicenseInfoIfNeeded(e){e.license.flags>=Wpe*2&&this.outputMessages(["Warning: This tldraw license contains some unknown flags.","This will still work, however, you may want to update tldraw packages to a newer version to get access to new functionality."],"warning")}outputMessages(e,n="error"){if(!this.isTest&&this.verbose){this.outputDelimiter();for(const r of e){const i=n==="warning"?"orange":"crimson",o=n==="warning"?"orange":"crimson";console.log(`%c${r}`,`color: ${i}; background: ${o}; padding: 2px; border-radius: 3px;`)}this.outputDelimiter()}}outputDelimiter(){console.log("%c-------------------------------------------------------------------","color: white; background: crimson; padding: 2px; border-radius: 3px;")}static className="tl-watermark_SEE-LICENSE"}function qpe(t,e,n){if(!t.isLicenseParseable)return n?"unlicensed":(t.reason==="no-key-provided"?e(["No tldraw license key provided!","A license is required for production deployments.",`Please reach out to ${hp} to purchase a license.`]):e(["Invalid license key. tldraw requires a valid license for production use.",`Please reach out to ${hp} to purchase a license.`]),"unlicensed-production");if(!t.isDomainValid&&!t.isDevelopment)return e(["License key is not valid for this domain.","A license is required for production deployments.",`Please reach out to ${hp} to purchase a license.`]),"unlicensed-production";if(t.isEvaluationLicense)return t.isEvaluationLicenseExpired?(e(["Your tldraw evaluation license has expired!",`Please reach out to ${hp} to purchase a full license.`]),"expired"):"licensed";if(t.isPerpetualLicenseExpired||t.isAnnualLicenseExpired)return e(["Your tldraw license has been expired for more than 30 days!",`Please reach out to ${hp} to renew your license.`]),"expired";const r=t.daysSinceExpiry;return r>0&&!t.isEvaluationLicense?(e(["Your tldraw license has expired.",`License expired ${r} days ago.`,`Please reach out to ${hp} to renew your license.`]),"licensed"):t.isLicensedWithWatermark?"licensed-with-watermark":"licensed"}var pp={};const j7=I.createContext({}),Gpe=()=>I.useContext(j7);function P4(t){return t==="expired"||t==="unlicensed-production"}const Ype=5e3;function Xpe({licenseKey:t=Jpe()??void 0,children:e}){const[n]=I.useState(()=>new f0(t)),r=J(n.state),[i,o]=I.useState(!0);return I.useEffect(()=>{if(P4(r)&&i){const s=setTimeout(()=>{o(!1)},Ype);return()=>clearTimeout(s)}},[r,i]),P4(r)&&!i?g.jsx(Zpe,{}):g.jsx(j7.Provider,{value:n,children:e})}function Zpe(){return g.jsx("div",{"data-testid":"tl-license-expired",style:{display:"none"}})}let Ux;function Jpe(){return Ux!==void 0||(Ux=qs(()=>pp.TLDRAW_LICENSE_KEY)||qs(()=>pp.NEXT_PUBLIC_TLDRAW_LICENSE_KEY)||qs(()=>pp.REACT_APP_TLDRAW_LICENSE_KEY)||qs(()=>pp.GATSBY_TLDRAW_LICENSE_KEY)||qs(()=>pp.VITE_TLDRAW_LICENSE_KEY)||qs(()=>pp.PUBLIC_TLDRAW_LICENSE_KEY)||qs(()=>{})||qs(()=>{})||qs(()=>{})||qs(()=>{})||qs(()=>{})||qs(()=>{})||null),Ux}function qs(t){try{return t()}catch{return}}function Rl(t){if(!t)throw Error("usePassThroughWheelEvents must be passed a ref");const e=Cr(),n=hr();I.useEffect(()=>{function r(o){if(!n?.getInstanceState().isFocused||o.isSpecialRedispatchedEvent)return;const s=t.current;if(s&&s.scrollHeight>s.clientHeight)return;dt(o);const a=e.querySelector(".tl-canvas");if(!a)return;const l=new WheelEvent("wheel",o);l.isSpecialRedispatchedEvent=!0,a.dispatchEvent(l)}const i=t.current;if(i)return i.addEventListener("wheel",r,{passive:!1}),()=>{i.removeEventListener("wheel",r)}},[e,n,t])}const Qpe='<svg xmlns="http://www.w3.org/2000/svg" width="3001" height="1000" fill="none"><path fill="#000" d="M590.656 300.449c0 49.706-40.294 90-90 90-49.705 0-90-40.294-90-90 0-49.705 40.295-90 90-90 49.706 0 90 40.295 90 90M569.431 719.011c-15.247 32.821-56.006 91.589-98.338 91.438-32.004-.115-38.642-30.904-17.414-50.856 17.381-16.337 28.246-48.075 31.995-72.719.415-2.728-1.556-5.197-4.272-5.679-39.666-7.04-70.746-40.877-70.746-83.417 0-48.23 38.983-87.329 87.07-87.329 39.936 0 70.172 22.237 83.369 52.397 18.839 43.055 7.117 115.733-11.664 156.165M2613.29 385.681V239.319c0-11.363 9.22-20.569 20.59-20.569h8.26c11.37 0 20.59 9.206 20.59 20.569v36.911c0 8.629 7 15.625 15.63 15.625h35.25c8.63 0 15.63-6.996 15.63-15.625v-36.911c0-11.363 9.22-20.569 20.59-20.569h8.17c11.37 0 20.59 9.206 20.59 20.569v146.362c0 11.363-9.22 20.569-20.59 20.569h-8.17c-11.37 0-20.59-9.206-20.59-20.569v-36.999c0-8.63-7-15.625-15.63-15.625h-35.25c-8.63 0-15.63 6.995-15.63 15.625v36.999c0 11.363-9.22 20.569-20.59 20.569h-8.26c-11.37 0-20.59-9.206-20.59-20.569M2391.97 239.319v146.362c0 11.348-9.16 20.569-20.49 20.569h-8.2c-11.33 0-20.49-9.221-20.49-20.569V239.319c0-11.348 9.16-20.569 20.49-20.569h8.2c11.33 0 20.49 9.221 20.49 20.569M2098.23 391.43l-42.69-146.361c-3.85-13.171 6.06-26.319 19.79-26.319h10.6c9.59 0 17.93 6.611 20.08 15.952l17.01 73.045c1.48 6.348 10.47 6.478 12.14.176l19.47-73.838c2.38-9.04 10.57-15.335 19.93-15.335h12.1c9.37 0 17.56 6.3 19.94 15.346l19.49 74.067c1.66 6.305 10.65 6.178 12.13-.171l17.09-73.294c2.15-9.339 10.49-15.948 20.08-15.948h10.53c13.72 0 23.63 13.141 19.79 26.31l-42.63 146.361c-2.56 8.789-10.63 14.829-19.79 14.829h-15.68c-9.12 0-17.16-5.98-19.76-14.709l-21.17-71.059c-1.77-5.948-10.19-5.957-11.97-.012l-21.33 71.071c-2.6 8.729-10.64 14.709-19.76 14.709h-15.59c-9.17 0-17.23-6.035-19.8-14.82M2443.23 218.75h118.59c11.38 0 20.62 9.195 20.62 20.557s-9.24 20.556-20.62 20.556h-24.79c-5.53 0-10 4.477-10 10v115.818c0 11.368-9.25 20.569-20.63 20.569h-7.65c-11.39 0-20.63-9.201-20.63-20.569V269.863c0-5.523-4.48-10-10-10h-24.89c-11.37 0-20.61-9.195-20.61-20.556s9.24-20.557 20.61-20.557M1174.15 218.75h24.64c8.35 0 15.88 5.042 19.04 12.764l34.61 83.942c2.13 5.161 9.44 5.155 11.56-.01l34.43-83.932a20.58 20.58 0 0 1 19.04-12.764h24.64c11.37 0 20.58 9.208 20.58 20.569v146.362c0 11.361-9.21 20.569-20.58 20.569h-7.09c-11.36 0-20.58-9.208-20.58-20.569l-.12-50.645c-.01-6.888-9.53-8.688-12.06-2.283l-23.46 59.332a20.57 20.57 0 0 1-19.14 13.009h-3.03a20.57 20.57 0 0 1-19.15-13.046l-23.47-59.68c-2.52-6.416-12.05-4.623-12.06 2.271l-.13 51.042c0 11.361-9.21 20.569-20.57 20.569h-7.1c-11.36 0-20.57-9.208-20.57-20.569V239.319c0-11.361 9.21-20.569 20.57-20.569"/><path fill="#000" fill-rule="evenodd" d="m1449.94 391.836 6.12-19.392a6.255 6.255 0 0 1 5.96-4.369l50.22-.061a6.24 6.24 0 0 1 5.96 4.348l6.23 19.486c2.71 8.581 10.71 14.402 19.74 14.402h9.34c14.13 0 24.15-13.791 19.61-27.151l-49.74-146.361c-2.85-8.37-10.74-13.988-19.61-13.988h-33.16c-8.87 0-16.77 5.618-19.61 13.988l-49.74 146.361c-4.54 13.36 5.48 27.151 19.61 27.151h9.32c9.04 0 17.04-5.827 19.75-14.414m31.1-98.858c1.85-5.807 10.08-5.796 11.91.016l8.83 27.916c1.28 4.028-1.73 8.134-5.96 8.134h-17.74c-4.23 0-7.24-4.119-5.95-8.151zM1681.81 406.25c18.91 0 35.39-3.686 49.36-11.168 13.97-7.544 24.73-18.394 32.24-32.489 7.56-14.105 11.29-30.866 11.29-50.182 0-19.256-3.73-35.957-11.29-50.004-7.57-14.094-18.35-24.912-32.32-32.397-13.91-7.545-30.4-11.26-49.37-11.26h-49.5c-11.38 0-20.63 9.201-20.63 20.569v146.362c0 11.368 9.25 20.569 20.63 20.569zm23.13-47.701c-6.62 3.215-14.85 4.886-24.79 4.886-10.49 0-19-8.507-19-19v-64.34c0-10.149 8.23-18.376 18.38-18.376 10.18 0 18.56 1.703 25.23 4.974 6.59 3.149 11.63 8.315 15.08 15.633 3.45 7.269 5.28 17.268 5.28 30.162 0 12.891-1.82 22.951-5.28 30.347-3.39 7.319-8.36 12.509-14.9 15.714" clip-rule="evenodd"/><path fill="#000" d="M1804.21 385.681V239.319c0-11.361 9.21-20.569 20.58-20.569h91.28c11.36 0 20.57 9.202 20.57 20.557s-9.21 20.556-20.57 20.556h-54.64a7.807 7.807 0 0 0-7.81 7.813v16.366a7.806 7.806 0 0 0 7.81 7.812h48.13c11.37 0 20.58 9.246 20.58 20.602s-9.21 20.601-20.58 20.601h-48.13a7.806 7.806 0 0 0-7.81 7.812v16.455a7.807 7.807 0 0 0 7.81 7.813h54.64c11.36 0 20.57 9.202 20.57 20.556s-9.21 20.557-20.57 20.557h-91.28c-11.37 0-20.58-9.208-20.58-20.569"/><path fill="#000" fill-rule="evenodd" d="M2875.5 68.75h-2750c-31.066 0-56.25 25.184-56.25 56.25v750c0 31.066 25.184 56.25 56.25 56.25h2750c31.07 0 56.25-25.184 56.25-56.25V125c0-31.066-25.18-56.25-56.25-56.25M125.5 0C56.464 0 .5 55.964.5 125v750c0 69.036 55.965 125 125 125h2750c69.04 0 125-55.964 125-125V125c0-69.036-55.96-125-125-125z" clip-rule="evenodd"/><path fill="#000" d="M2476.06 804.813c-10.54 0-19.82-6.947-22.81-17.068L2390.79 575.7c-4.49-15.248 6.92-30.534 22.8-30.534h27.75c11.1 0 20.72 7.686 23.18 18.52L2489 671.402c2.07 9.093 14.93 9.321 17.32.308l28.83-108.844c2.76-10.435 12.19-17.7 22.98-17.7h25.17c10.8 0 20.25 7.293 22.99 17.755l28.27 107.739c2.36 9.001 15.18 8.829 17.3-.232l25.01-106.888c2.51-10.763 12.1-18.374 23.14-18.374h27.87c15.88 0 27.29 15.286 22.8 30.534l-62.46 212.045a23.78 23.78 0 0 1-22.81 17.068h-32.12c-10.39 0-19.58-6.763-22.69-16.696l-32.08-102.694c-2.62-8.397-14.51-8.331-17.04.095l-30.74 102.346c-3.02 10.061-12.27 16.949-22.76 16.949zM1742.44 804.813h-75.81c-13.09 0-23.71-10.656-23.71-23.801V568.967c0-13.145 10.62-23.801 23.71-23.801h74.8c26.6 0 49.59 5.198 68.95 15.594 19.45 10.312 34.44 25.187 44.96 44.627 10.61 19.355 15.91 42.556 15.91 69.602q0 40.57-15.78 69.73c-10.53 19.355-25.43 34.231-44.71 44.627-19.28 10.311-42.05 15.467-68.32 15.467m-29.3-83.642c0 13.145 10.61 23.801 23.71 23.801h3.06c12.8 0 23.7-2.07 32.71-6.212 9.09-4.141 16-11.283 20.71-21.426q7.2-15.213 7.2-42.345 0-27.13-7.32-42.344c-4.8-10.143-11.87-17.285-21.22-21.426-9.26-4.142-20.63-6.212-34.1-6.212h-1.04c-13.1 0-23.71 10.656-23.71 23.801zM1460.86 804.813c-13.12 0-23.76-10.656-23.76-23.801V568.967c0-13.145 10.64-23.801 23.76-23.801h22.84c13.13 0 23.76 10.656 23.76 23.801v155.247c0 13.145 10.64 23.801 23.76 23.801h57.27c13.12 0 23.76 10.656 23.76 23.801v9.196c0 13.145-10.64 23.801-23.76 23.801zM1204.45 601.964c-13.13 0-23.77-10.656-23.77-23.801v-9.196c0-13.145 10.64-23.801 23.77-23.801h177.89c13.13 0 23.78 10.656 23.78 23.801v9.196c0 13.145-10.65 23.801-23.78 23.801h-39.38c-8.21 0-14.86 6.66-14.86 14.875v164.173c0 13.145-10.64 23.801-23.78 23.801h-21.85c-13.13 0-23.78-10.656-23.78-23.801V616.839c0-8.215-6.65-14.875-14.86-14.875z"/><path fill="#000" fill-rule="evenodd" d="M2223.05 787.891c-3.02 10.047-12.27 16.922-22.74 16.922h-25.43c-16.19 0-27.64-15.862-22.57-31.261l69.88-212.045c3.21-9.753 12.31-16.341 22.56-16.341h61.84c10.25 0 19.35 6.588 22.56 16.341l69.87 212.045c5.08 15.399-6.37 31.261-22.56 31.261h-25.43c-10.48 0-19.72-6.875-22.74-16.922l-6.7-22.2a14.84 14.84 0 0 0-14.21-10.576h-63.42c-6.55 0-12.32 4.296-14.22 10.576zm76.13-96.945-14.13-48.436c-2.46-8.451-14.36-8.602-17.04-.217l-15.46 48.436c-1.84 5.759 2.45 11.645 8.48 11.645h29.6c5.94 0 10.22-5.715 8.55-11.428" clip-rule="evenodd"/><path fill="#000" d="M1939.6 804.813c-13.13 0-23.77-10.656-23.77-23.801V568.967c0-13.145 10.64-23.801 23.77-23.801h88.13c19.24 0 36.08 3.508 50.51 10.523s25.65 17.115 33.67 30.3q12.03 19.779 12.03 47.416c0 18.595-4.14 34.273-12.41 47.036-7.64 11.913-18.18 21.101-31.63 27.564-16.98 8.159-36 11.104-54.7 11.104h-43.07c-76.56 0 4.08-135.84 4.08-84.706v7.996c0 12.117 9.81 21.941 21.91 21.941 8.12 0 16.3-.345 24.04-3.043 5.91-2.113 10.43-5.451 13.55-10.015 3.2-4.565 4.81-10.523 4.81-17.877 0-7.437-1.61-13.481-4.81-18.129-3.12-4.733-7.64-8.199-13.55-10.396-7.05-2.766-14.67-3.423-22.18-3.423-13.13 0-23.77 10.656-23.77 23.801v47.71c0 11.825 11.14 16.003 19.91 20.752 12.31 6.671 7.58 25.389-6.42 25.389-7.45 0-13.49 6.048-13.49 13.508v48.395c0 13.145-10.63 23.801-23.76 23.801zm134.89-106.758 5.41 9.95 33.51 61.622c8.62 15.86-2.84 35.186-20.87 35.186h-22.27c-8.74 0-16.77-4.798-20.92-12.496l-35.05-65.04a15.52 15.52 0 0 0-13.66-8.168c-42.24 0 40.62-82.154 73.85-21.054M931.652 0h68.748v1000h-68.748z"/></svg>',efe='<svg xmlns="http://www.w3.org/2000/svg" width="400" height="1601" fill="none"><path fill="#000" d="M72 1319.8c0-10.73 7.071-20.18 17.372-23.22l215.823-63.62c15.519-4.57 31.078 7.05 31.078 23.22v28.26c0 11.31-7.824 21.1-18.85 23.61l-109.636 24.94c-9.254 2.1-9.487 15.2-.313 17.63l110.784 29.37a24.21 24.21 0 0 1 18.015 23.4v25.64c0 11-7.423 20.62-18.071 23.41l-109.659 28.79c-9.162 2.41-8.986 15.47.236 17.63l108.792 25.46c10.955 2.56 18.702 12.33 18.702 23.57v28.39c0 16.17-15.559 27.79-31.078 23.22l-215.823-63.62c-10.3-3.04-17.372-12.49-17.372-23.22v-32.72c0-10.59 6.883-19.95 16.994-23.11l104.523-32.67c8.547-2.67 8.479-14.79-.096-17.36l-104.17-31.3C79.01 1372.42 72 1363 72 1352.31zM72 572.638V495.43c0-13.336 10.846-24.147 24.225-24.147h215.823c13.379 0 24.225 10.811 24.225 24.147v76.179q0 40.645-15.872 70.228-15.743 29.712-45.422 45.79-29.55 16.206-70.843 16.206-41.292 0-70.971-16.078-29.55-16.077-45.422-45.532Q72 612.767 72 572.638m85.132-29.84c-13.379 0-24.225 10.81-24.225 24.146v3.122q0 19.55 6.323 33.313 6.323 13.89 21.807 21.094 15.485 7.332 43.099 7.331t43.1-7.46q15.484-7.33 21.807-21.608 6.323-14.15 6.323-34.728v-1.064c0-13.336-10.846-24.146-24.225-24.146zM72 285.858c0-13.363 10.846-24.197 24.225-24.197h215.823c13.379 0 24.225 10.834 24.225 24.197v23.27c0 13.364-10.846 24.197-24.225 24.197H154.035c-13.379 0-24.225 10.834-24.225 24.197v58.328c0 13.364-10.846 24.197-24.225 24.197h-9.36C82.845 440.047 72 429.214 72 415.85zM278.463 24.72c0-13.374 10.846-24.216 24.225-24.216h9.36c13.379 0 24.225 10.842 24.225 24.216v181.174c0 13.374-10.846 24.216-24.225 24.216h-9.36c-13.379 0-24.225-10.842-24.225-24.216v-40.108c0-8.359-6.779-15.135-15.141-15.135H96.225c-13.38 0-24.225-10.842-24.225-24.216v-22.256c0-13.374 10.846-24.216 24.225-24.216h167.097c8.362 0 15.141-6.776 15.141-15.135z"/><path fill="#000" fill-rule="evenodd" d="M89.224 1062.13C78.997 1059.04 72 1049.63 72 1038.96v-25.9c0-16.486 16.145-28.147 31.818-22.979l215.823 71.169a24.19 24.19 0 0 1 16.632 22.98v62.97c0 10.45-6.706 19.71-16.632 22.98l-215.823 71.17C88.145 1246.51 72 1234.86 72 1218.37v-25.9c0-10.67 6.997-20.08 17.224-23.17l22.595-6.81a15.13 15.13 0 0 0 10.765-14.48v-64.59a15.13 15.13 0 0 0-10.765-14.48zm98.672 77.53 49.299-14.39c8.601-2.51 8.755-14.62.22-17.35l-49.299-15.75c-5.861-1.88-11.852 2.49-11.852 8.64v30.14c0 6.05 5.817 10.41 11.632 8.71" clip-rule="evenodd"/><path fill="#000" d="M72 773.439c0-13.367 10.846-24.203 24.225-24.203h215.823c13.379 0 24.225 10.836 24.225 24.203v89.762q0 29.395-10.711 51.439-10.71 22.046-30.84 34.293t-48.261 12.248q-28.388 0-47.873-12.635-18.187-11.672-28.056-32.218c-8.303-17.289-11.301-36.661-11.301-55.705v-43.867c0-77.976 138.26 4.16 86.215 4.16h-8.138c-12.334 0-22.332 9.989-22.332 22.311 0 8.269.351 16.6 3.097 24.487q3.225 9.024 10.194 13.794 6.968 4.899 18.194 4.899 11.356 0 18.453-4.899 7.226-4.77 10.581-13.794c2.815-7.188 3.484-14.944 3.484-22.596 0-13.366-10.846-24.202-24.225-24.202h-48.56c-12.036 0-16.288 11.345-21.122 20.272-6.79 12.539-25.841 7.72-25.841-6.536 0-7.586-6.156-13.736-13.749-13.736H96.225C82.845 820.916 72 810.08 72 796.714zm108.66 137.378-10.128 5.511-62.72 34.131C91.67 959.243 72 947.569 72 929.205V906.52a24.2 24.2 0 0 1 12.719-21.299l66.199-35.696a15.82 15.82 0 0 0 8.313-13.921c0-43.012 83.618 41.371 21.429 75.213"/></svg>';function tfe(t){return J("watermarkState",()=>t.state.get(),[t])}const nfe=`data:image/svg+xml;utf8,${encodeURIComponent(Qpe)}`,rfe=`data:image/svg+xml;utf8,${encodeURIComponent(efe)}`,ife=I.memo(function(){const e=Gpe(),n=ne(),r=J("is mobile",()=>n.getViewportScreenBounds().width<700,[n]),i=tfe(e);return["licensed-with-watermark","unlicensed"].includes(i)?g.jsxs(g.Fragment,{children:[g.jsx(afe,{}),g.jsx(sfe,{src:r?rfe:nfe,isUnlicensed:i==="unlicensed"})]}):null}),ofe=I.memo(function({isDebugMode:e,isMobile:n}){const r=ne(),i=e0(),o=I.useRef(null);Rl(o);const s="https://tldraw.dev/pricing?utm_source=dotcom&utm_medium=organic&utm_campaign=watermark";return g.jsx("div",{ref:o,className:f0.className,"data-debug":e,"data-mobile":n,"data-unlicensed":!0,"data-testid":"tl-watermark-unlicensed",draggable:!1,...i,children:g.jsx("button",{draggable:!1,role:"button",onPointerDown:a=>{r.markEventAsHandled(a),dt(a)},title:"The tldraw SDK requires a license key to work in production. You can get a free 100-day trial license at tldraw.dev/pricing.",onClick:()=>Yy.openWindow(s,"_blank"),children:"Get a license for production"})})}),sfe=I.memo(function({src:e,isUnlicensed:n}){const r=ne(),i=J("debug mode",()=>r.getInstanceState().isDebugMode,[r]),o=J("is mobile",()=>r.getViewportScreenBounds().width<700,[r]),s=e0(),a=I.useRef(null);Rl(a);const l=`url('${e}') center 100% / 100% no-repeat`,c="https://tldraw.dev/?utm_source=dotcom&utm_medium=organic&utm_campaign=watermark";return n?g.jsx(ofe,{isDebugMode:i,isMobile:o}):g.jsx("div",{ref:a,className:f0.className,"data-debug":i,"data-mobile":o,"data-testid":"tl-watermark-licensed",draggable:!1,...s,children:g.jsx("button",{draggable:!1,role:"button",onPointerDown:d=>{r.markEventAsHandled(d),dt(d)},title:"Build infinite canvas applications with the tldraw SDK. Learn more at https://tldraw.dev.",onClick:()=>Yy.openWindow(c,"_blank"),style:{mask:l,WebkitMask:l}})})}),afe=I.memo(function(){const e=ne(),n=f0.className,r=`
/* ------------------- SEE LICENSE -------------------
The tldraw watermark is part of tldraw's license. It is shown for unlicensed
or "licensed-with-watermark" users. By using this library, you agree to
preserve the watermark's behavior, keeping it visible, unobscured, and
available to user-interaction.

To remove the watermark, please purchase a license at tldraw.dev.
*/

.${n} {
	position: absolute;
	bottom: max(var(--tl-space-2), env(safe-area-inset-bottom));
	right: max(var(--tl-space-2), env(safe-area-inset-right));
	width: 96px;
	height: 32px;
	display: flex;
	align-items: center;
	justify-content: center;
	z-index: var(--tl-layer-watermark) !important;
	background-color: color-mix(in srgb, var(--tl-color-background) 62%, transparent);
	opacity: 1;
	border-radius: 5px;
	pointer-events: all;
	padding: 2px;
	box-sizing: content-box;
}

.${n} > button {
	position: absolute;
	width: 96px;
	height: 32px;
	pointer-events: all;
	cursor: inherit;
	color: var(--tl-color-text);
	opacity: .38;
	border: 0;
	padding: 0;
	background-color: currentColor;
}

.${n}[data-debug='true'] {
	bottom: max(46px, env(safe-area-inset-bottom));
}

.${n}[data-mobile='true'] {
	border-radius: 4px 0px 0px 4px;
	right: max(-2px, calc(env(safe-area-inset-right) - 2px));
	width: 8px;
	height: 48px;
}

.${n}[data-mobile='true'] > button {
	width: 8px;
	height: 32px;
}

.${n}[data-unlicensed='true'] > button {
	font-size: 100px;
	position: absolute;
	pointer-events: all;
	cursor: pointer;
	color: var(--tl-color-text);
	opacity: 0.8;
	border: 0;
	padding: 0;
	background-color: transparent;
	font-size: 11px;
	font-weight: 600;
	text-align: center;
}

.${n}[data-mobile='true'][data-unlicensed='true'] > button {
	display: none;
}

@media (hover: hover) {
	.${n} > button {
		pointer-events: none;
	}

	.${n}:hover {
		background-color: var(--tl-color-background);
		transition: background-color 0.2s ease-in-out;
		transition-delay: 0.32s;
	}

	.${n}:hover > button {
		animation: ${n}_delayed_link 0.2s forwards ease-in-out;
		animation-delay: 0.32s;
	}

	.${n} > button:focus-visible {
		opacity: 1;
	}
}

@keyframes ${n}_delayed_link {
	0% {
		cursor: inherit;
		opacity: .38;
		pointer-events: none;
	}
	100% {
		cursor: pointer;
		opacity: 1;
		pointer-events: all;
	}
}`;return g.jsx("style",{nonce:e.options.nonce,children:r})}),lfe=[],cfe=[],ufe=[],dfe="tl-container",R7=I.memo(function({store:e,components:n,className:r,user:i,options:o,...s}){const[a,l]=I.useState(null),c=I.useMemo(()=>i??g8(),[i]),d=n?.ErrorFallback===void 0?i8:n?.ErrorFallback,u={...s,shapeUtils:s.shapeUtils??lfe,bindingUtils:s.bindingUtils??cfe,tools:s.tools??ufe,components:n,options:Of(o)};return g.jsx("div",{ref:l,"data-tldraw":tA,draggable:!1,className:Ye(`${dfe} tl-theme__light`,r),tabIndex:-1,role:"application","aria-label":o?.branding??"tldraw",children:g.jsx(ny,{fallback:d,onError:p=>c2(p,{tags:{origin:"react.tldraw-before-app"}}),children:a&&g.jsx(Xpe,{licenseKey:s.licenseKey,children:g.jsx(n8,{container:a,children:g.jsx(_fe,{overrides:n,children:e?e instanceof L2?g.jsx(N7,{...u,store:e,user:c}):g.jsx($7,{...u,store:e,user:c}):g.jsx(hfe,{...u,store:e,user:c})})})})})})});function hfe(t){const{defaultName:e,snapshot:n,initialData:r,shapeUtils:i,bindingUtils:o,persistenceKey:s,sessionId:a,user:l,assets:c,migrations:d}=t,u=zpe({shapeUtils:i,bindingUtils:o,initialData:r,persistenceKey:s,sessionId:a,defaultName:e,snapshot:n,assets:c,migrations:d});return g.jsx($7,{...t,store:u,user:l})}const $7=I.memo(function({store:e,user:n,...r}){const i=Cr();I.useLayoutEffect(()=>{n.userPreferences.get().colorScheme==="dark"&&(i.classList.remove("tl-theme__light"),i.classList.add("tl-theme__dark"))},[i,n]);const{LoadingScreen:o}=gn();switch(e.status){case"error":throw e.error;case"loading":return o?g.jsx(o,{}):null}return g.jsx(N7,{...r,store:e.store,user:n})}),XC=()=>document.location.search.includes("tldraw_preserve_focus");function N7({onMount:t,children:e,store:n,tools:r,shapeUtils:i,bindingUtils:o,user:s,initialState:a,autoFocus:l=!0,inferDarkMode:c,cameraOptions:d,textOptions:u,options:p,licenseKey:f,deepLinks:y,getShapeVisibility:v,assetUrls:x}){const{ErrorFallback:b}=gn(),w=Cr(),[_,C]=D7(null),A=I.useRef(null),E=Of(y===!0?{}:y),O=I.useRef({autoFocus:l&&!XC(),inferDarkMode:c,initialState:a,cameraOptions:d,deepLinks:E});I.useLayoutEffect(()=>{O.current={autoFocus:l&&!XC(),inferDarkMode:c,initialState:a,cameraOptions:d,deepLinks:E}},[l,c,a,d,E]),I.useLayoutEffect(()=>{const{autoFocus:$,inferDarkMode:V,initialState:Y,cameraOptions:re,deepLinks:q}=O.current,X=new Ne({store:n,shapeUtils:i,bindingUtils:o,tools:r,getContainer:()=>w,user:s,initialState:Y,autoFocus:$,inferDarkMode:V,cameraOptions:re,textOptions:u,options:p,licenseKey:f,getShapeVisibility:v,fontAssetUrls:x?.fonts});return X.updateViewportScreenBounds(A.current??w),q&&(q?.getUrl?X.navigateToDeepLink({...q,url:q.getUrl(X)}):X.navigateToDeepLink(q)),C(X),()=>{X.dispose()}},[o,w,p,i,n,r,s,C,f,v,u,x]),I.useLayoutEffect(()=>{if(_&&E)return _.registerDeepLinkListener(E)},[_,E]),I.useLayoutEffect(()=>{_&&d&&_.setCameraOptions(d)},[_,d]);const D=I.useSyncExternalStore(I.useCallback($=>_?(_.on("crash",$),()=>_.off("crash",$)):()=>{},[_]),()=>_?.getCrashingError()??null);I.useEffect(function(){if(!_)return;function V(){_&&_.focus()}function Y(){_&&_.blur()}if(l&&XC())return _.getContainer().addEventListener("pointerdown",V),document.body.addEventListener("pointerdown",Y),()=>{_.getContainer()?.removeEventListener("pointerdown",V),document.body.removeEventListener("pointerdown",Y)}},[_,l]);const[B,L]=I.useState(null);let j=B;_!==j?.editor&&(j=null),I.useLayoutEffect(()=>{if(!_)return;if(_.options.maxFontsToLoadBeforeRender===0){L({editor:_,isLoaded:!0});return}let $=!1;return L({editor:_,isLoaded:!1}),_.fonts.loadRequiredFontsForCurrentPage(_.options.maxFontsToLoadBeforeRender).finally(()=>{$||L({editor:_,isLoaded:!0})}),()=>{$=!0}},[_]);const{Canvas:F,LoadingScreen:z}=gn();return!_||!j?.isLoaded?g.jsxs(g.Fragment,{children:[z&&g.jsx(z,{}),g.jsx("div",{className:"tl-canvas",ref:A})]}):g.jsx(ny,{fallback:b,onError:$=>_.annotateError($,{origin:"react.tldraw",willCrashApp:!0}),children:D?g.jsx(ffe,{crashingError:D}):g.jsx(eA,{editor:_,children:g.jsxs(pfe,{onMount:t,children:[e??(F?g.jsx(F,{},_.contextId):null),g.jsx(ife,{})]})})})}function pfe({children:t,onMount:e}){return Bpe(),dpe(),hpe(),ppe(),Fpe(),z7(n=>{const r=n.store.props.onMount(n),i=e?.(n);return()=>{r?.(),i?.()}}),t}function ffe({crashingError:t}){throw t}function L7({children:t}){return g.jsx("div",{className:"tl-loading","aria-busy":"true",tabIndex:0,children:t})}function z7(t){const e=ne(),n=pl(r=>{let i;return r.run(()=>{i=t?.(r),r.emit("mount")},{history:"ignore"}),window.tldrawReady=!0,i});rt.useLayoutEffect(()=>{if(e)return n?.(e)},[e,n])}const gfe=()=>{const{Spinner:t}=gn();return g.jsx(L7,{children:t?g.jsx(t,{}):null})};function F7(t,e=!0){const n=t.length;if(n<2)return"";let r=t[0],i=t[1];if(n===2)return`M${mi(r)}L${mi(i)}`;let o="";for(let s=2,a=n-1;s<a;s++)r=t[s],i=t[s+1],o+=Wo(r,i);return e?`M${Wo(t[0],t[1])}Q${mi(t[1])}${Wo(t[1],t[2])}T${o}${Wo(t[n-1],t[0])}${Wo(t[0],t[1])}Z`:`M${mi(t[0])}Q${mi(t[1])}${Wo(t[1],t[2])}${t.length>3?"T":""}${o}L${mi(t[n-1])}`}function T4({scribble:t,zoom:e,color:n,opacity:r,className:i}){return t.points.length?g.jsx("svg",{className:i&&Ye("tl-overlays__item",i),children:g.jsx("path",{className:"tl-scribble",d:F7(t.points,!1),stroke:n??`var(--tl-color-${t.color})`,fill:"none",strokeWidth:8/e,opacity:r??t.opacity})}):null}function mfe({bounds:t,rotation:e}){const n=ne(),r=I.useRef(null),i=J("only selected shape",()=>n.getOnlySelectedShape(),[n]),o=i?n.getShapeUtil(i).expandSelectionOutlinePx(i):0;return Ky(r,t?.x,t?.y,1,e,{x:-o,y:-o}),t=o instanceof pe?t.clone().expand(o).zeroFix():t.clone().expandBy(o).zeroFix(),g.jsx("svg",{ref:r,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:g.jsx("rect",{className:Ye("tl-selection__fg__outline"),width:ee(t.width),height:ee(t.height)})})}const yfe=()=>g.jsx("div",{className:"tl-shape-error-boundary"}),vfe=I.memo(({shape:t,util:e})=>Hw("Indicator: "+t.type,()=>e.indicator(e.editor.store.unsafeGetWithoutCapture(t.id))),(t,e)=>t.shape.props===e.shape.props&&t.shape.meta===e.shape.meta),xfe=I.memo(({editor:t,id:e})=>{const n=J("shape for indicator",()=>t.store.get(e),[t,e]),{ShapeIndicatorErrorFallback:r}=gn();return!n||n.isLocked?null:g.jsx(ny,{fallback:r,onError:i=>t.annotateError(i,{origin:"react.shapeIndicator",willCrashApp:!1}),children:g.jsx(vfe,{shape:n,util:t.getShapeUtil(n)},n.id)})}),E4=I.memo(function({shapeId:e,className:n,color:r,hidden:i,opacity:o}){const s=ne(),a=I.useRef(null);return Yd("indicator transform",()=>{if(i)return;const l=a.current;if(!l)return;const c=s.getShapePageTransform(e);c&&l.style.setProperty("transform",c.toCssString())},[s,e,i]),I.useLayoutEffect(()=>{const l=a.current;l&&l.style.setProperty("display",i?"none":"block")},[i]),g.jsx("svg",{ref:a,className:Ye("tl-overlays__item",n),"aria-hidden":"true",children:g.jsx("g",{className:"tl-shape-indicator",stroke:r??"var(--tl-color-selected)",opacity:o,children:g.jsx(xfe,{editor:s,id:e})})})}),Sfe=()=>g.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"}),B7=I.memo(function({hideAll:e,showAll:n}){const r=ne();if(e&&n)throw Error("You cannot set both hideAll and showAll props to true, cmon now");const i=I.useRef(new Set),o=J("should display selected ids",()=>{const l=i.current,c=new Set,d=r.getInstanceState(),u=d.isChangingStyle,p=r.isInAny("select.idle","select.editing_shape"),f=r.isInAny("select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","select.pointing_handle");if(u||!(p||f))return i.current=c,c;for(const y of r.getSelectedShapeIds())c.add(y);if(p&&d.isHoveringCanvas&&!d.isCoarsePointer){const y=r.getHoveredShapeId();y&&c.add(y)}if(l.size!==c.size)return i.current=c,c;for(const y of c)if(!l.has(y))return i.current=c,c;return l},[r]),s=J("rendering shapes",()=>r.getRenderingShapes(),[r]),{ShapeIndicator:a}=gn();return a?s.map(({id:l})=>g.jsx(a,{shapeId:l,hidden:!n&&(e||!o.has(l))},l+"_indicator")):null}),U7=I.forwardRef(function({children:e,shape:n,isBackground:r,...i},o){const s="fill"in n.props&&n.props.fill!=="none";return g.jsx("div",{ref:o,"data-shape-type":n.type,"data-shape-is-filled":r?void 0:s,"data-shape-id":n.id,draggable:!1,...i,className:Ye("tl-shape",r&&"tl-shape-background",i.className),children:e})});function bfe({points:t,zoom:e}){const n=2.5/e,r=t.reduce((p,f)=>Math.min(p,f.x),1/0),i=t.reduce((p,f)=>Math.max(p,f.x),-1/0),o=t.reduce((p,f)=>Math.min(p,f.y),1/0),s=t.reduce((p,f)=>Math.max(p,f.y),-1/0),a=t.some(p=>p.x===r&&p.y===o);let l,c,d,u;return a?(l=r,c=o,d=i,u=s):(l=r,c=s,d=i,u=o),g.jsxs("g",{className:"tl-snap-indicator",stroke:"lime",children:[g.jsx("line",{x1:l,y1:c,x2:d,y2:u}),t.map((p,f)=>g.jsx("g",{transform:`translate(${p.x},${p.y})`,children:g.jsx("path",{className:"tl-snap-point",d:`M ${-n},${-n} L ${n},${n} M ${-n},${n} L ${n},${-n}`})},f))]})}function wfe({gaps:t,direction:e,zoom:n}){const r=3.5/n;let i=[-1/0,1/0],o=null;const s=e==="horizontal";for(const l of t){if(o=Oa(i[0],i[1],s?l.startEdge[0].y:l.startEdge[0].x,s?l.startEdge[1].y:l.startEdge[1].x),o)i=o;else continue;if(o=Oa(i[0],i[1],s?l.endEdge[0].y:l.endEdge[0].x,s?l.endEdge[1].y:l.endEdge[1].x),o)i=o;else continue}if(i===null)return null;const a=(i[0]+i[1])/2;return g.jsx("g",{className:"tl-snap-indicator",stroke:"cyan",children:t.map(({startEdge:l,endEdge:c},d)=>g.jsx(I.Fragment,{children:s?g.jsxs(g.Fragment,{children:[g.jsx("line",{x1:l[0].x,y1:a-2*r,x2:l[1].x,y2:a+2*r}),g.jsx("line",{x1:c[0].x,y1:a-2*r,x2:c[1].x,y2:a+2*r}),g.jsx("line",{x1:l[0].x,y1:a,x2:c[0].x,y2:a}),g.jsx("line",{x1:(l[0].x+c[0].x)/2,y1:a-r,x2:(l[0].x+c[0].x)/2,y2:a+r})]}):g.jsxs(g.Fragment,{children:[g.jsx("line",{x1:a-2*r,y1:l[0].y,x2:a+2*r,y2:l[1].y}),g.jsx("line",{x1:a-2*r,y1:c[0].y,x2:a+2*r,y2:c[1].y}),g.jsx("line",{x1:a,y1:l[0].y,x2:a,y2:c[0].y}),g.jsx("line",{x1:a-r,y1:(l[0].y+c[0].y)/2,x2:a+r,y2:(l[0].y+c[0].y)/2})]})},d))})}function kfe({className:t,line:e,zoom:n}){return g.jsx("svg",{className:Ye("tl-overlays__item",t),"aria-hidden":"true",children:e.type==="points"?g.jsx(bfe,{...e,zoom:n}):e.type==="gaps"?g.jsx(wfe,{...e,zoom:n}):null})}function H7(t){return g.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16","aria-hidden":"false",...t,className:Ye("tl-spinner",t.className),children:g.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[g.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),g.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor"})]})})}const Ife=()=>null,W7=I.createContext(null);function _fe({overrides:t={},children:e}){const n=Of(t),r=I.useMemo(()=>({Background:jce,Brush:jC,Canvas:Bge,CollaboratorBrush:jC,CollaboratorCursor:Xz,CollaboratorHint:Qce,CollaboratorScribble:T4,CollaboratorShapeIndicator:E4,Cursor:Xz,Grid:rue,Handle:iue,Handles:oue,InFrontOfTheCanvas:null,LoadingScreen:gfe,OnTheCanvas:null,Overlays:null,Scribble:T4,SelectionBackground:null,SelectionForeground:mfe,ShapeIndicator:E4,ShapeIndicators:B7,ShapeWrapper:U7,SnapIndicator:kfe,Spinner:H7,SvgDefs:Ife,ZoomBrush:jC,ErrorFallback:i8,ShapeErrorFallback:yfe,ShapeIndicatorErrorFallback:Sfe,...n}),[n]);return g.jsx(W7.Provider,{value:r,children:e})}function gn(){const t=I.useContext(W7);if(!t)throw new Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return t}const Cfe=["textarea","input"];function Pfe(t){const e=ne();I.useEffect(()=>{const n=t.current;if(!n)return;const r=i=>{if(i instanceof PointerEvent&&i.pointerType==="pen"){e.markEventAsHandled(i);const{target:o}=i;if(Cfe.includes(o.tagName?.toLocaleLowerCase())||o.isContentEditable||e.isIn("select.editing_shape"))return;dt(i)}};return n.addEventListener("touchstart",r),n.addEventListener("touchend",r),()=>{n.removeEventListener("touchstart",r),n.removeEventListener("touchend",r)}},[e,t])}function Tfe(t,e,n){return Math.max(e,Math.min(t,n))}const bi={toVector(t,e){return t===void 0&&(t=e),Array.isArray(t)?t:[t,t]},add(t,e){return[t[0]+e[0],t[1]+e[1]]},sub(t,e){return[t[0]-e[0],t[1]-e[1]]},addTo(t,e){t[0]+=e[0],t[1]+=e[1]},subTo(t,e){t[0]-=e[0],t[1]-=e[1]}};function A4(t,e,n){return e===0||Math.abs(e)===1/0?Math.pow(t,n*5):t*e*n/(e+n*t)}function M4(t,e,n,r=.15){return r===0?Tfe(t,e,n):t<e?-A4(e-t,n-e,r)+e:t>n?+A4(t-n,n-e,r)+n:t}function Efe(t,[e,n],[r,i]){const[[o,s],[a,l]]=t;return[M4(e,o,s,r),M4(n,a,l,i)]}function Afe(t,e){if(typeof t!="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Mfe(t){var e=Afe(t,"string");return typeof e=="symbol"?e:String(e)}function Bi(t,e,n){return e=Mfe(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function O4(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function er(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?O4(Object(n),!0).forEach(function(r){Bi(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):O4(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const V7={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function D4(t){return t?t[0].toUpperCase()+t.slice(1):""}const Ofe=["enter","leave"];function Dfe(t=!1,e){return t&&!Ofe.includes(e)}function jfe(t,e="",n=!1){const r=V7[t],i=r&&r[e]||e;return"on"+D4(t)+D4(i)+(Dfe(n,i)?"Capture":"")}const Rfe=["gotpointercapture","lostpointercapture"];function $fe(t){let e=t.substring(2).toLowerCase();const n=!!~e.indexOf("passive");n&&(e=e.replace("passive",""));const r=Rfe.includes(e)?"capturecapture":"capture",i=!!~e.indexOf(r);return i&&(e=e.replace("capture","")),{device:e,capture:i,passive:n}}function Nfe(t,e=""){const n=V7[t],r=n&&n[e]||e;return t+r}function K7(t){return"touches"in t}function Lfe(t){return K7(t)?"touch":"pointerType"in t?t.pointerType:"mouse"}function zfe(t){return Array.from(t.touches).filter(e=>{var n,r;return e.target===t.currentTarget||((n=t.currentTarget)===null||n===void 0||(r=n.contains)===null||r===void 0?void 0:r.call(n,e.target))})}function DT(t,e){try{const n=e.clientX-t.clientX,r=e.clientY-t.clientY,i=(e.clientX+t.clientX)/2,o=(e.clientY+t.clientY)/2,s=Math.hypot(n,r);return{angle:-(Math.atan2(n,r)*180)/Math.PI,distance:s,origin:[i,o]}}catch{}return null}function Ffe(t){return zfe(t).map(e=>e.identifier)}function j4(t,e){const[n,r]=Array.from(t.touches).filter(i=>e.includes(i.identifier));return DT(n,r)}const R4=40,$4=800;function q7(t){let{deltaX:e,deltaY:n,deltaMode:r}=t;return r===1?(e*=R4,n*=R4):r===2&&(e*=$4,n*=$4),[e,n]}function Bfe(t){const e={};if("buttons"in t&&(e.buttons=t.buttons),"shiftKey"in t){const{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o}=t;Object.assign(e,{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o})}return e}function xb(t,...e){return typeof t=="function"?t(...e):t}function Ufe(){}function Hfe(...t){return t.length===0?Ufe:t.length===1?t[0]:function(){let e;for(const n of t)e=n.apply(this,arguments)||e;return e}}function N4(t,e){return Object.assign({},e,t||{})}const Wfe=32;class G7{constructor(e,n,r){this.ctrl=e,this.args=n,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:n,ingKey:r,args:i}=this;n[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const n=this.state,r=this.config;n._active||(this.reset(),this.computeInitial(),n._active=!0,n.target=e.target,n.currentTarget=e.currentTarget,n.lastOffset=r.from?xb(r.from,n):n.offset,n.offset=n.lastOffset,n.startTime=n.timeStamp=e.timeStamp)}computeValues(e){const n=this.state;n._values=e,n.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:n,config:r,shared:i}=this;n.args=this.args;let o=0;if(e&&(n.event=e,r.preventDefault&&e.cancelable&&n.event.preventDefault(),n.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,Bfe(e)),i.down=i.pressed=i.buttons%2===1||i.touches>0,o=e.timeStamp-n.timeStamp,n.timeStamp=e.timeStamp,n.elapsedTime=n.timeStamp-n.startTime),n._active){const E=n._delta.map(Math.abs);bi.addTo(n._distance,E)}this.axisIntent&&this.axisIntent(e);const[s,a]=n._movement,[l,c]=r.threshold,{_step:d,values:u}=n;if(r.hasCustomTransform?(d[0]===!1&&(d[0]=Math.abs(s)>=l&&u[0]),d[1]===!1&&(d[1]=Math.abs(a)>=c&&u[1])):(d[0]===!1&&(d[0]=Math.abs(s)>=l&&Math.sign(s)*l),d[1]===!1&&(d[1]=Math.abs(a)>=c&&Math.sign(a)*c)),n.intentional=d[0]!==!1||d[1]!==!1,!n.intentional)return;const p=[0,0];if(r.hasCustomTransform){const[E,O]=u;p[0]=d[0]!==!1?E-d[0]:0,p[1]=d[1]!==!1?O-d[1]:0}else p[0]=d[0]!==!1?s-d[0]:0,p[1]=d[1]!==!1?a-d[1]:0;this.restrictToAxis&&!n._blocked&&this.restrictToAxis(p);const f=n.offset,y=n._active&&!n._blocked||n.active;y&&(n.first=n._active&&!n.active,n.last=!n._active&&n.active,n.active=i[this.ingKey]=n._active,e&&(n.first&&("bounds"in r&&(n._bounds=xb(r.bounds,n)),this.setup&&this.setup()),n.movement=p,this.computeOffset()));const[v,x]=n.offset,[[b,w],[_,C]]=n._bounds;n.overflow=[v<b?-1:v>w?1:0,x<_?-1:x>C?1:0],n._movementBound[0]=n.overflow[0]?n._movementBound[0]===!1?n._movement[0]:n._movementBound[0]:!1,n._movementBound[1]=n.overflow[1]?n._movementBound[1]===!1?n._movement[1]:n._movementBound[1]:!1;const A=n._active?r.rubberband||[0,0]:[0,0];if(n.offset=Efe(n._bounds,n.offset,A),n.delta=bi.sub(n.offset,f),this.computeMovement(),y&&(!n.last||o>Wfe)){n.delta=bi.sub(n.offset,f);const E=n.delta.map(Math.abs);bi.addTo(n.distance,E),n.direction=n.delta.map(Math.sign),n._direction=n._delta.map(Math.sign),!n.first&&o>0&&(n.velocity=[E[0]/o,E[1]/o],n.timeDelta=o)}}emit(){const e=this.state,n=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;const i=this.handler(er(er(er({},n),e),{},{[this.aliasKey]:e.values}));i!==void 0&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function Vfe([t,e],n){const r=Math.abs(t),i=Math.abs(e);if(r>i&&r>n)return"x";if(i>r&&i>n)return"y"}class Kfe extends G7{constructor(...e){super(...e),Bi(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=bi.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=bi.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const n=this.state,r=this.config;if(!n.axis&&e){const i=typeof r.axisThreshold=="object"?r.axisThreshold[Lfe(e)]:r.axisThreshold;n.axis=Vfe(n._movement,i)}n._blocked=(r.lockDirection||!!r.axis)&&!n.axis||!!r.axis&&r.axis!==n.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const qfe=t=>t,L4=.15,Y7={enabled(t=!0){return t},eventOptions(t,e,n){return er(er({},n.shared.eventOptions),t)},preventDefault(t=!1){return t},triggerAllEvents(t=!1){return t},rubberband(t=0){switch(t){case!0:return[L4,L4];case!1:return[0,0];default:return bi.toVector(t)}},from(t){if(typeof t=="function")return t;if(t!=null)return bi.toVector(t)},transform(t,e,n){const r=t||n.shared.transform;return this.hasCustomTransform=!!r,r||qfe},threshold(t){return bi.toVector(t,0)}},Gfe=0,nv=er(er({},Y7),{},{axis(t,e,{axis:n}){if(this.lockDirection=n==="lock",!this.lockDirection)return n},axisThreshold(t=Gfe){return t},bounds(t={}){if(typeof t=="function")return o=>nv.bounds(t(o));if("current"in t)return()=>t.current;if(typeof HTMLElement=="function"&&t instanceof HTMLElement)return t;const{left:e=-1/0,right:n=1/0,top:r=-1/0,bottom:i=1/0}=t;return[[e,n],[r,i]]}}),rv=typeof window<"u"&&window.document&&window.document.createElement;function X7(){return rv&&"ontouchstart"in window}function Yfe(){return X7()||rv&&window.navigator.maxTouchPoints>1}function Xfe(){return rv&&"onpointerdown"in window}function Zfe(){return rv&&"exitPointerLock"in window.document}function Jfe(){try{return"constructor"in GestureEvent}catch{return!1}}const Qs={isBrowser:rv,gesture:Jfe(),touch:X7(),touchscreen:Yfe(),pointer:Xfe(),pointerLock:Zfe()},Qfe=250,ege=180,tge=.5,nge=50,rge=250,ige=10,z4={mouse:0,touch:0,pen:8};er(er({},nv),{},{device(t,e,{pointer:{touch:n=!1,lock:r=!1,mouse:i=!1}={}}){return this.pointerLock=r&&Qs.pointerLock,Qs.touch&&n?"touch":this.pointerLock?"mouse":Qs.pointer&&!i?"pointer":Qs.touch?"touch":"mouse"},preventScrollAxis(t,e,{preventScroll:n}){if(this.preventScrollDelay=typeof n=="number"?n:n||n===void 0&&t?Qfe:void 0,!(!Qs.touchscreen||n===!1))return t||(n!==void 0?"y":void 0)},pointerCapture(t,e,{pointer:{capture:n=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&this.device==="pointer"&&n},threshold(t,e,{filterTaps:n=!1,tapsThreshold:r=3,axis:i=void 0}){const o=bi.toVector(t,n?r:i?1:0);return this.filterTaps=n,this.tapsThreshold=r,o},swipe({velocity:t=tge,distance:e=nge,duration:n=rge}={}){return{velocity:this.transform(bi.toVector(t)),distance:this.transform(bi.toVector(e)),duration:n}},delay(t=0){switch(t){case!0:return ege;case!1:return 0;default:return t}},axisThreshold(t){return t?er(er({},z4),t):z4},keyboardDisplacement(t=ige){return t}});function Z7(t){const[e,n]=t.overflow,[r,i]=t._delta,[o,s]=t._direction;(e<0&&r>0&&o<0||e>0&&r<0&&o>0)&&(t._movement[0]=t._movementBound[0]),(n<0&&i>0&&s<0||n>0&&i<0&&s>0)&&(t._movement[1]=t._movementBound[1])}const oge=30,sge=100;class age extends G7{constructor(...e){super(...e),Bi(this,"ingKey","pinching"),Bi(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:n,lastOffset:r}=this.state;e==="wheel"?this.state.offset=bi.add(n,r):this.state.offset=[(1+n[0])*r[0],n[1]+r[1]]}computeMovement(){const{offset:e,lastOffset:n}=this.state;this.state.movement=[e[0]/n[0],e[1]-n[1]]}axisIntent(){const e=this.state,[n,r]=e._movement;if(!e.axis){const i=Math.abs(n)*oge-Math.abs(r);i<0?e.axis="angle":i>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&(this.state.axis==="scale"?e[1]=0:this.state.axis==="angle"&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const n=this.state,r=this.ctrl.touchIds;if(n._active&&n._touchIds.every(o=>r.has(o))||r.size<2)return;this.start(e),n._touchIds=Array.from(r).slice(0,2);const i=j4(e,n._touchIds);i&&this.pinchStart(e,i)}pointerStart(e){if(e.buttons!=null&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const n=this.state,r=n._pointerEvents,i=this.ctrl.pointerIds;if(n._active&&Array.from(r.keys()).every(s=>i.has(s))||(r.size<2&&r.set(e.pointerId,e),n._pointerEvents.size<2))return;this.start(e);const o=DT(...Array.from(r.values()));o&&this.pinchStart(e,o)}pinchStart(e,n){const r=this.state;r.origin=n.origin,this.computeValues([n.distance,n.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const n=j4(e,this.state._touchIds);n&&this.pinchMove(e,n)}pointerMove(e){const n=this.state._pointerEvents;if(n.has(e.pointerId)&&n.set(e.pointerId,e),!this.state._active)return;const r=DT(...Array.from(n.values()));r&&this.pinchMove(e,r)}pinchMove(e,n){const r=this.state,i=r._values[1],o=n.angle-i;let s=0;Math.abs(o)>270&&(s+=Math.sign(o)),this.computeValues([n.distance,n.angle-360*s]),r.origin=n.origin,r.turns=s,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(n=>!this.ctrl.touchIds.has(n))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const n=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}n._pointerEvents.has(e.pointerId)&&n._pointerEvents.delete(e.pointerId),n._active&&n._pointerEvents.size<2&&(n._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const n=this.state;n._active||(this.start(e),this.computeValues([e.scale,e.rotation]),n.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const n=this.state;this.computeValues([e.scale,e.rotation]),n.origin=[e.clientX,e.clientY];const r=n._movement;n._movement=[e.scale-1,e.rotation],n._delta=bi.sub(n._movement,r),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const n=this.config.modifierKey;n&&(Array.isArray(n)?!n.find(r=>e[r]):!e[n])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const r=this.state;r._delta=[-q7(e)[1]/sge*r.offset[0],0],bi.addTo(r._movement,r._delta),Z7(r),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const n=this.config.device;n&&(e(n,"start",this[n+"Start"].bind(this)),e(n,"change",this[n+"Move"].bind(this)),e(n,"end",this[n+"End"].bind(this)),e(n,"cancel",this[n+"End"].bind(this)),e("lostPointerCapture","",this[n+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const lge=er(er({},Y7),{},{device(t,e,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!Qs.touch&&Qs.gesture)return"gesture";if(Qs.touch&&r)return"touch";if(Qs.touchscreen){if(Qs.pointer)return"pointer";if(Qs.touch)return"touch"}},bounds(t,e,{scaleBounds:n={},angleBounds:r={}}){const i=s=>{const a=N4(xb(n,s),{min:-1/0,max:1/0});return[a.min,a.max]},o=s=>{const a=N4(xb(r,s),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof n!="function"&&typeof r!="function"?[i(),o()]:s=>[i(s),o(s)]},threshold(t,e,n){return this.lockDirection=n.axis==="lock",bi.toVector(t,this.lockDirection?[.1,3]:0)},modifierKey(t){return t===void 0?"ctrlKey":t},pinchOnWheel(t=!0){return t}});er(er({},nv),{},{mouseOnly:(t=!0)=>t});class cge extends Kfe{constructor(...e){super(...e),Bi(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const n=this.state;n._delta=q7(e),bi.addTo(n._movement,n._delta),Z7(n),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const uge=nv;er(er({},nv),{},{mouseOnly:(t=!0)=>t});const mA=new Map,jT=new Map;function dge(t){mA.set(t.key,t.engine),jT.set(t.key,t.resolver)}const hge={key:"pinch",engine:age,resolver:lge},pge={key:"wheel",engine:cge,resolver:uge};function fge(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,o;for(o=0;o<r.length;o++)i=r[o],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function gge(t,e){if(t==null)return{};var n=fge(t,e),r,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)r=o[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}const mge={target(t){if(t)return()=>"current"in t?t.current:t},enabled(t=!0){return t},window(t=Qs.isBrowser?window:void 0){return t},eventOptions({passive:t=!0,capture:e=!1}={}){return{passive:t,capture:e}},transform(t){return t}},yge=["target","eventOptions","window","enabled","transform"];function zS(t={},e){const n={};for(const[r,i]of Object.entries(e))switch(typeof i){case"function":n[r]=i.call(n,t[r],r,t);break;case"object":n[r]=zS(t[r],i);break;case"boolean":i&&(n[r]=t[r]);break}return n}function vge(t,e,n={}){const r=t,{target:i,eventOptions:o,window:s,enabled:a,transform:l}=r,c=gge(r,yge);if(n.shared=zS({target:i,eventOptions:o,window:s,enabled:a,transform:l},mge),e){const d=jT.get(e);n[e]=zS(er({shared:n.shared},c),d)}else for(const d in c){const u=jT.get(d);u&&(n[d]=zS(er({shared:n.shared},c[d]),u))}return n}class J7{constructor(e,n){Bi(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=n}add(e,n,r,i,o){const s=this._listeners,a=Nfe(n,r),l=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},c=er(er({},l),o);e.addEventListener(a,i,c);const d=()=>{e.removeEventListener(a,i,c),s.delete(d)};return s.add(d),d}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class xge{constructor(){Bi(this,"_timeouts",new Map)}add(e,n,r=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(n,r,...i))}remove(e){const n=this._timeouts.get(e);n&&window.clearTimeout(n)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class Sge{constructor(e){Bi(this,"gestures",new Set),Bi(this,"_targetEventStore",new J7(this)),Bi(this,"gestureEventStores",{}),Bi(this,"gestureTimeoutStores",{}),Bi(this,"handlers",{}),Bi(this,"config",{}),Bi(this,"pointerIds",new Set),Bi(this,"touchIds",new Set),Bi(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),bge(this,e)}setEventIds(e){if(K7(e))return this.touchIds=new Set(Ffe(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,n){this.handlers=e,this.nativeHandlers=n}applyConfig(e,n){this.config=vge(e,n,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const n=this.config.shared,r={};let i;if(!(n.target&&(i=n.target(),!i))){if(n.enabled){for(const s of this.gestures){const a=this.config[s],l=F4(r,a.eventOptions,!!i);if(a.enabled){const c=mA.get(s);new c(this,e,s).bind(l)}}const o=F4(r,n.eventOptions,!!i);for(const s in this.nativeHandlers)o(s,"",a=>this.nativeHandlers[s](er(er({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const o in r)r[o]=Hfe(...r[o]);if(!i)return r;for(const o in r){const{device:s,capture:a,passive:l}=$fe(o);this._targetEventStore.add(i,s,"",r[o],{capture:a,passive:l})}}}}function fp(t,e){t.gestures.add(e),t.gestureEventStores[e]=new J7(t,e),t.gestureTimeoutStores[e]=new xge}function bge(t,e){e.drag&&fp(t,"drag"),e.wheel&&fp(t,"wheel"),e.scroll&&fp(t,"scroll"),e.move&&fp(t,"move"),e.pinch&&fp(t,"pinch"),e.hover&&fp(t,"hover")}const F4=(t,e,n)=>(r,i,o,s={},a=!1)=>{var l,c;const d=(l=s.capture)!==null&&l!==void 0?l:e.capture,u=(c=s.passive)!==null&&c!==void 0?c:e.passive;let p=a?r:jfe(r,i,d);n&&u&&(p+="Passive"),t[p]=t[p]||[],t[p].push(o)},wge=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function kge(t){const e={},n={},r=new Set;for(let i in t)wge.test(i)?(r.add(RegExp.lastMatch),n[i]=t[i]):e[i]=t[i];return[n,e,r]}function gp(t,e,n,r,i,o){if(!t.has(n)||!mA.has(r))return;const s=n+"Start",a=n+"End",l=c=>{let d;return c.first&&s in e&&e[s](c),n in e&&(d=e[n](c)),c.last&&a in e&&e[a](c),d};i[r]=l,o[r]=o[r]||{}}function Ige(t,e){const[n,r,i]=kge(t),o={};return gp(i,n,"onDrag","drag",o,e),gp(i,n,"onWheel","wheel",o,e),gp(i,n,"onScroll","scroll",o,e),gp(i,n,"onPinch","pinch",o,e),gp(i,n,"onMove","move",o,e),gp(i,n,"onHover","hover",o,e),{handlers:o,config:e,nativeHandlers:r}}function _ge(t,e={},n,r){const i=rt.useMemo(()=>new Sge(t),[]);if(i.applyHandlers(t,r),i.applyConfig(e,n),rt.useEffect(i.effect.bind(i)),rt.useEffect(()=>i.clean.bind(i),[]),e.target===void 0)return i.bind.bind(i)}function Cge(t){return t.forEach(dge),function(n,r){const{handlers:i,nativeHandlers:o,config:s}=Ige(n,r||{});return _ge(i,s,void 0,o)}}const B4=10,Pge=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function Q7(t){let{deltaY:e,deltaX:n}=t,r=0;return t.ctrlKey||t.altKey||t.metaKey?r=(Math.abs(e)>B4?B4*Math.sign(e):e)/100:t.shiftKey&&!Pge&&(n=e,e=0),{x:-n,y:-e,z:-r}}const Tge=Cge([pge,hge]);let mp;const Ege=t=>mp===void 0?(mp=t,!1):t-mp>120&&t-mp<160?(mp=t,!0):(mp=t,!1);function Age(t){const e=ne(),n=I.useMemo(()=>{let r="not sure";const i=({event:y})=>{if(!e.getInstanceState().isFocused||(r="not sure",Ege(Date.now())))return;const v=e.getEditingShapeId();if(v){const w=e.getShape(v);if(w&&e.getShapeUtil(w).canScroll(w)&&e.getShapePageBounds(v)?.containsPoint(e.inputs.currentPagePoint))return}dt(y),y.stopPropagation();const x=Q7(y);if(x.x===0&&x.y===0)return;const b={type:"wheel",name:"wheel",delta:x,point:new T(y.clientX,y.clientY),shiftKey:y.shiftKey,altKey:y.altKey,ctrlKey:y.metaKey||y.ctrlKey,metaKey:y.metaKey,accelKey:Rn(y)};e.dispatch(b)};let o=1,s=1,a=0;const l=new T,c=new T,d=y=>{const v=t.current;r="not sure";const{event:x,origin:b,da:w}=y;x instanceof WheelEvent||(x.target===v||v?.contains(x.target))&&(c.x=b[0],c.y=b[1],l.x=b[0],l.y=b[1],o=w[0],s=e.getZoomLevel(),e.dispatch({type:"pinch",name:"pinch_start",point:{x:b[0],y:b[1],z:e.getZoomLevel()},delta:{x:0,y:0},shiftKey:x.shiftKey,altKey:x.altKey,ctrlKey:x.metaKey||x.ctrlKey,metaKey:x.metaKey,accelKey:Rn(x)}))},u=y=>{if(y&&(r="zooming"),r==="zooming")return;const v=Math.abs(a-o),x=T.Dist(l,c);switch(r){case"not sure":{v>24?r="zooming":x>16&&(r="panning");break}case"panning":{v>64&&(r="zooming");break}}};return{onWheel:i,onPinchStart:d,onPinchEnd:y=>{const v=t.current,{event:x,origin:b,offset:w}=y;if(x instanceof WheelEvent||!(x.target===v||v?.contains(x.target)))return;const _=w[0]**e.getCameraOptions().zoomSpeed;r="not sure",e.timers.requestAnimationFrame(()=>{e.dispatch({type:"pinch",name:"pinch_end",point:{x:b[0],y:b[1],z:_},delta:{x:b[0],y:b[1]},shiftKey:x.shiftKey,altKey:x.altKey,ctrlKey:x.metaKey||x.ctrlKey,metaKey:x.metaKey,accelKey:Rn(x)})})},onPinch:y=>{const v=t.current,{event:x,origin:b,offset:w,da:_}=y;if(x instanceof WheelEvent||!(x.target===v||v?.contains(x.target)))return;const C=y.type==="gesturechange"||y.type==="gestureend";a=_[0];const A=b[0]-c.x,E=b[1]-c.y;switch(c.x=b[0],c.y=b[1],u(C),r){case"zooming":{const O=w[0]**e.getCameraOptions().zoomSpeed;e.dispatch({type:"pinch",name:"pinch",point:{x:b[0],y:b[1],z:O},delta:{x:A,y:E},shiftKey:x.shiftKey,altKey:x.altKey,ctrlKey:x.metaKey||x.ctrlKey,metaKey:x.metaKey,accelKey:Rn(x)});break}case"panning":{e.dispatch({type:"pinch",name:"pinch",point:{x:b[0],y:b[1],z:s},delta:{x:A,y:E},shiftKey:x.shiftKey,altKey:x.altKey,ctrlKey:x.metaKey||x.ctrlKey,metaKey:x.metaKey,accelKey:Rn(x)});break}}}}},[e,t]);Tge(n,{target:t,eventOptions:{passive:!1},pinch:{from:()=>{const{zoomSpeed:r}=e.getCameraOptions();return[e.getZoomLevel()**(1/r),0]},scaleBounds:()=>{const r=e.getBaseZoom(),{zoomSteps:i,zoomSpeed:o}=e.getCameraOptions(),s=i[0]*r;return{max:(i[i.length-1]*r)**(1/o),min:s**(1/o)}}}})}function ZC(t,e,n){const r=t.getShape(e),i=t.getShapeHandles(r);return{shape:r,handle:i.find(o=>o.id===n)}}function Mge(t,e){const n=ne();return I.useMemo(()=>{const r=l=>{if(n.wasEventAlreadyHandled(l))return;const c=fb(l.currentTarget);qy(c,l);const{shape:d,handle:u}=ZC(n,t,e);u&&n.dispatch({type:"pointer",target:"handle",handle:u,shape:d,name:"pointer_down",...Hi(n,l)})};let i,o;return{onPointerDown:r,onPointerMove:l=>{if(n.wasEventAlreadyHandled(l)||l.clientX===i&&l.clientY===o)return;i=l.clientX,o=l.clientY;const{shape:c,handle:d}=ZC(n,t,e);d&&n.dispatch({type:"pointer",target:"handle",handle:d,shape:c,name:"pointer_move",...Hi(n,l)})},onPointerUp:l=>{if(n.wasEventAlreadyHandled(l))return;const c=fb(l.currentTarget);Gy(c,l);const{shape:d,handle:u}=ZC(n,t,e);u&&n.dispatch({type:"pointer",target:"handle",handle:u,shape:d,name:"pointer_up",...Hi(n,l)})}}},[n,t,e])}function Oge(t){const e=ne();I.useLayoutEffect(()=>{const n=e5(()=>{t.current&&e.updateViewportScreenBounds(t.current)},200,{trailing:!0}),r=e.timers.setInterval(n,1e3);window.addEventListener("resize",n);const i=new ResizeObserver(a=>{a[0].contentRect&&n()}),o=t.current;let s=null;return o&&(i.observe(o),s=Dge(o),s.addEventListener("scroll",n)),()=>{clearInterval(r),window.removeEventListener("resize",n),i.disconnect(),s?.removeEventListener("scroll",n),n.cancel()}},[e,t])}/*!
 * Author: excalidraw
 * MIT License: https://github.com/excalidraw/excalidraw/blob/master/LICENSE
 * https://github.com/excalidraw/excalidraw/blob/48c3465b19f10ec755b3eb84e21a01a468e96e43/packages/excalidraw/utils.ts#L600
 */const Dge=t=>{let e=t.parentElement;for(;e;){if(e===document.body)return document;const{overflowY:n}=window.getComputedStyle(e);if(e.scrollHeight>e.clientHeight&&(n==="auto"||n==="scroll"||n==="overlay"))return e;e=e.parentElement}return document};function jge(t=!0){const[e,n]=I.useState(0),r=ne();I.useEffect(()=>{if(!t)return;const i=()=>n(o=>o+1);return r.on("tick",i),()=>{r.off("tick",i)}},[r,t])}const Rge=_r(function({showStroke:e=!0,showVertices:n=!0,showClosestPointOnOutline:r=!0}){const i=ne();jge(r);const o=i.getZoomLevel(),s=i.getRenderingShapes(),{inputs:{currentPagePoint:a}}=i;return g.jsx("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:s.map(l=>{const c=i.getShape(l.id);if(c.type==="group")return null;const d=i.getShapeGeometry(c),u=i.getShapePageTransform(c),p=i.getPointInShapeSpace(c,a),f=d.nearestPoint(p),y=d.distanceToPoint(p,!0),v=Math.abs(y)*o,x=y<0,{vertices:b}=d;return g.jsxs("g",{transform:u.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&g.jsx("g",{stroke:d.debugColor??"red",opacity:"1",strokeWidth:2/o,fill:"none",children:g.jsx(eW,{geometry:d})}),n&&b.map((w,_)=>g.jsx("circle",{cx:w.x,cy:w.y,r:2/o,fill:`hsl(${Ha(_,[0,b.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/o},`v${_}`)),r&&v<150&&g.jsx("line",{x1:f.x,y1:f.y,x2:p.x,y2:p.y,opacity:1-v/150,stroke:x?"goldenrod":"dodgerblue",strokeWidth:2/o})]},l.id+"_outline")})})});function eW({geometry:t}){return t instanceof Zo?g.jsx("g",{stroke:t.debugColor,children:[...t.children,...t.ignoredChildren].map((e,n)=>g.jsx(eW,{geometry:e},n))}):g.jsx("path",{d:t.toSimpleSvgPath(),stroke:t.debugColor})}function tW(t){return Loe(t)}function nW(){const t=ne(),e=Lae("userIds",()=>tW(t.getCollaborators().map(n=>n.userId)).sort(),{isEqual:(n,r)=>n.join(",")===r.join?.(",")},[t]);return J(e)}function g0(t){const e=ne();return J(`latestPresence:${t}`,()=>e.getCollaborators().find(r=>r.userId===t),[e,t])??null}const $ge=_r(function(){return nW().map(n=>g.jsx(Nge,{collaboratorId:n},n))}),Nge=_r(function({collaboratorId:e}){const n=ne(),r=g0(e),i=zge(n,r);if(!(r&&r.currentPageId===n.getCurrentPageId()))return null;switch(i){case"inactive":{const{followingUserId:o,highlightedUserIds:s}=n.getInstanceState();if(!(o===r.userId||s.includes(r.userId)))return null;break}case"idle":{const{highlightedUserIds:o}=n.getInstanceState();if(r.followingUserId===n.user.getId()&&!(r.chatMessage||o.includes(r.userId)))return null;break}}return g.jsx(Lge,{latestPresence:r})}),Lge=_r(function({latestPresence:e}){const n=ne(),{CollaboratorBrush:r,CollaboratorScribble:i,CollaboratorCursor:o,CollaboratorHint:s,CollaboratorShapeIndicator:a}=gn(),l=n.getZoomLevel(),c=n.getViewportPageBounds(),{userId:d,chatMessage:u,brush:p,scribbles:f,selectedShapeIds:y,userName:v,cursor:x,color:b}=e;if(!x)return null;const w=!(x.x<c.minX-12/l||x.y<c.minY-16/l||x.x>c.maxX-12/l||x.y>c.maxY-16/l);return g.jsxs(g.Fragment,{children:[p&&r?g.jsx(r,{className:"tl-collaborator__brush",userId:d,brush:p,color:b,opacity:.1},d+"_brush"):null,w&&o?g.jsx(o,{className:"tl-collaborator__cursor",userId:d,point:x,color:b,zoom:l,name:v!=="New User"?v:null,chatMessage:u??""},d+"_cursor"):s?g.jsx(s,{className:"tl-collaborator__cursor-hint",userId:d,point:x,color:b,zoom:l,viewport:c},d+"_cursor_hint"):null,i&&f.length?g.jsx(g.Fragment,{children:f.map(_=>g.jsx(i,{className:"tl-collaborator__scribble",userId:d,scribble:_,color:b,zoom:l,opacity:_.color==="laser"?.5:.1},d+"_scribble_"+_.id))}):null,a&&y.filter(_=>!n.isShapeHidden(_)).map(_=>g.jsx(a,{className:"tl-collaborator__shape-indicator",userId:d,shapeId:_,color:b,opacity:.5},d+"_"+_))]})});function U4(t,e){return e>t.options.collaboratorInactiveTimeoutMs?"inactive":e>t.options.collaboratorIdleTimeoutMs?"idle":"active"}function zge(t,e){const n=I.useRef(e?.lastActivityTimestamp??-1),[r,i]=I.useState(()=>U4(t,Date.now()-n.current));return I.useEffect(()=>{const o=t.timers.setInterval(()=>{i(U4(t,Date.now()-n.current))},t.options.collaboratorCheckIntervalMs);return()=>clearInterval(o)},[t]),e&&(n.current=e.lastActivityTimestamp??1/0),r}function Fge(){const t=ne(),e=J("is menu open",()=>t.menus.hasAnyOpenMenus(),[t]),[n,r]=I.useState(!1),i=e||n,o=e0(),s=I.useRef({isDown:!1,isDragging:!1,start:new T}),a=I.useCallback(d=>{d.button===0&&(r(!0),s.current={isDown:!0,isDragging:!1,start:new T(d.clientX,d.clientY)}),t.menus.clearOpenMenus()},[t]),l=I.useCallback(d=>{if(s.current.isDown&&T.Dist2(s.current.start,new T(d.clientX,d.clientY))>t.options.dragDistanceSquared){s.current={...s.current,isDown:!0,isDragging:!0};const{x:u,y:p}=s.current.start;o.onPointerDown?.({...d,clientX:u,clientY:p,button:0})}},[o,t]),c=I.useCallback(d=>{o.onPointerUp?.(d),r(!1),s.current={isDown:!1,isDragging:!1,start:new T(d.clientX,d.clientY)}},[o]);return i&&g.jsx("div",{className:"tlui-menu-click-capture","data-testid":"menu-click-capture.content",...o,onPointerDown:a,onPointerMove:l,onPointerUp:c})}function Bge({className:t}){const e=ne(),{SelectionBackground:n,Background:r,SvgDefs:i,ShapeIndicators:o}=gn(),s=I.useRef(null),a=I.useRef(null),l=I.useRef(null),c=Cr();Oge(s),Jce(),Zce(),Age(s),Pfe(s);const d=I.useRef({lodDisableTextOutline:!1,allowTextOutline:!0});Yd("position layers",function(){const{x:_,y:C,z:A}=e.getCamera();if(d.current.allowTextOutline&&Jt.isSafari&&(c.style.setProperty("--tl-text-outline","none"),d.current.allowTextOutline=!1),d.current.allowTextOutline&&A<e.options.textShadowLod!==d.current.lodDisableTextOutline){const D=A<e.options.textShadowLod;c.style.setProperty("--tl-text-outline",D?"none":"var(--tl-text-outline-reference)"),d.current.lodDisableTextOutline=D}const E=A>=1?Ha(A,[1,8],[.125,.5],!0):Ha(A,[.1,1],[-2,.125],!0),O=`scale(${ee(A)}) translate(${ee(_+E)}px,${ee(C+E)}px)`;Li(a.current,"transform",O),Li(l.current,"transform",O)},[e,c]);const u=e0(),p=J("shapeSvgDefs",()=>{const w=new Map;for(const _ of ar(e.shapeUtils)){if(!_)return;const C=_.getCanvasSvgDefs();for(const{key:A,component:E}of C)w.has(A)||w.set(A,g.jsx(E,{},A))}return[...w.values()]},[e]),f=J("debug_shapes",()=>Vn.hideShapes.get(),[Vn]),y=J("debug_svg",()=>Vn.debugSvg.get(),[Vn]),v=J("debug_geometry",()=>Vn.debugGeometry.get(),[Vn]),x=J("isEditingAnything",()=>e.getEditingShapeId()!==null,[e]),b=J("isSelectingAnything",()=>!!e.getSelectedShapeIds().length,[e]);return g.jsxs(g.Fragment,{children:[g.jsxs("div",{ref:s,draggable:!1,"data-iseditinganything":x,"data-isselectinganything":b,className:Ye("tl-canvas",t),"data-testid":"canvas",...u,children:[g.jsx("svg",{className:"tl-svg-context","aria-hidden":"true",children:g.jsxs("defs",{children:[p,g.jsx(nme,{}),g.jsx(rme,{}),i&&g.jsx(i,{})]})}),r&&g.jsx("div",{className:"tl-background__wrapper",children:g.jsx(r,{})}),g.jsx(Hge,{}),g.jsxs("div",{ref:a,className:"tl-html-layer tl-shapes",draggable:!1,children:[g.jsx(ame,{}),n&&g.jsx(sme,{}),f?null:y?g.jsx(Jge,{}):g.jsx(eme,{})]}),g.jsx("div",{className:"tl-overlays",children:g.jsxs("div",{ref:l,className:"tl-html-layer",children:[v?g.jsx(Rge,{}):null,g.jsx(Vge,{}),g.jsx(Wge,{}),g.jsx(Kge,{}),o&&g.jsx(o,{}),g.jsx(tme,{}),g.jsx(qge,{}),g.jsx(ome,{}),g.jsx(Gge,{}),g.jsx(Zge,{}),g.jsx($ge,{})]})}),g.jsx("div",{className:"tl-canvas__in-front",onPointerDown:e.markEventAsHandled,onPointerUp:e.markEventAsHandled,onTouchStart:e.markEventAsHandled,onTouchEnd:e.markEventAsHandled,children:g.jsx(Uge,{})}),g.jsx(lme,{})]}),g.jsx(Fge,{})]})}function Uge(){const{InFrontOfTheCanvas:t}=gn();return t?g.jsx(t,{}):null}function Hge(){const t=ne(),e=J("gridSize",()=>t.getDocumentSettings().gridSize,[t]),{x:n,y:r,z:i}=J("camera",()=>t.getCamera(),[t]),o=J("isGridMode",()=>t.getInstanceState().isGridMode,[t]),{Grid:s}=gn();return s&&o?g.jsx(s,{x:n,y:r,z:i,size:e}):null}function Wge(){const t=ne(),e=J("scribbles",()=>t.getInstanceState().scribbles,[t]),n=J("zoomLevel",()=>t.getZoomLevel(),[t]),{Scribble:r}=gn();return r&&e.length?e.map(i=>g.jsx(r,{className:"tl-user-scribble",scribble:i,zoom:n},i.id)):null}function Vge(){const t=ne(),e=J("brush",()=>t.getInstanceState().brush,[t]),{Brush:n}=gn();return n&&e?g.jsx(n,{className:"tl-user-brush",brush:e}):null}function Kge(){const t=ne(),e=J("zoomBrush",()=>t.getInstanceState().zoomBrush,[t]),{ZoomBrush:n}=gn();return n&&e?g.jsx(n,{className:"tl-user-brush tl-zoom-brush",brush:e}):null}function qge(){const t=ne(),e=J("snapLines",()=>t.snaps.getIndicators(),[t]),n=J("zoomLevel",()=>t.getZoomLevel(),[t]),{SnapIndicator:r}=gn();return r&&e.length>0?e.map(i=>g.jsx(r,{className:"tl-user-snapline",line:i,zoom:n},i.id)):null}function Gge(){const t=ne(),e=J("handles shapeIdWithHandles",()=>{const{isReadonly:n,isChangingStyle:r}=t.getInstanceState();if(n||r)return!1;const i=t.getOnlySelectedShape();return!i||!t.getShapeHandles(i)?!1:i.id},[t]);return e?g.jsx(Yge,{shapeId:e}):null}function Yge({shapeId:t}){const e=ne(),{Handles:n}=gn(),r=J("zoomLevel",()=>e.getZoomLevel(),[e]),i=J("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),o=J("handles transform",()=>e.getShapePageTransform(t),[e,t]),s=J("handles",()=>{const l=e.getShapeHandles(t);if(!l)return null;const c=(i?e.options.coarseHandleRadius:e.options.handleRadius)/r*2;return l.filter(d=>d.type!=="virtual"||!l.some(u=>u!==d&&u.type==="vertex"&&T.Dist(d,u)<c)).sort(d=>d.type==="vertex"?1:-1)},[e,r,i,t]),a=J("isHidden",()=>e.isShapeHidden(t),[e,t]);return!n||!s||!o||a?null:g.jsx(n,{children:g.jsx("g",{transform:xe.toCssString(o),children:s.map(l=>g.jsx(Xge,{shapeId:t,handle:l,zoom:r,isCoarse:i},l.id))})})}function Xge({shapeId:t,handle:e,zoom:n,isCoarse:r}){const i=Mge(t,e.id),{Handle:o}=gn();return o?g.jsx("g",{role:"button","aria-label":e.label||"handle",transform:`translate(${e.x}, ${e.y})`,...i,children:g.jsx(o,{shapeId:t,handle:e,zoom:n,isCoarse:r})}):null}function Zge(){const{Overlays:t}=gn();return t?g.jsx("div",{className:"tl-custom-overlays tl-overlays__item",children:g.jsx(t,{})}):null}function Jge(){const t=ne();return J("rendering shapes",()=>t.getRenderingShapes(),[t]).map(n=>g.jsxs(I.Fragment,{children:[g.jsx(B8,{...n}),g.jsx(ime,{id:n.id,mode:"iframe"})]},n.id+"_fragment"))}function Qge(){const t=ne(),e=I.useRef(new Set);return Yd("reflow for culled shapes",()=>{const n=t.getCulledShapes();if(e.current.size===n.size&&[...n].every(i=>e.current.has(i)))return;e.current=n;const r=document.getElementsByClassName("tl-canvas");r.length!==0&&r[0].offsetHeight},[t]),null}function eme(){const t=ne(),e=J("rendering shapes",()=>t.getRenderingShapes(),[t]);return g.jsxs(g.Fragment,{children:[e.map(n=>g.jsx(B8,{...n},n.id+"_shape")),Jt.isSafari&&g.jsx(Qge,{})]})}function tme(){const t=ne(),{ShapeIndicator:e}=gn(),n=J("hinting shape ids",()=>a2(t.getHintingShapeIds()),[t]);return!n.length||!e?null:n.map(r=>g.jsx(e,{className:"tl-user-indicator__hint",shapeId:r},r+"_hinting"))}function nme(){return g.jsxs("g",{id:za("cursor"),children:[g.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[g.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),g.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),g.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[g.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),g.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),g.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[g.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),g.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function rme(){const t=za("cursor_hint");return g.jsx("path",{id:t,fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function ime({id:t,mode:e}){const n=ne(),[r,i]=I.useState(null),o=J("is in root",()=>n.getShape(t)?.parentId===n.getCurrentPageId(),[n,t]);return I.useEffect(()=>{if(!o)return;let s=null;const a=mo("shape to svg",async()=>{const l=Math.random();s=l;const d=n.isShapeOfType(t,"frame")?0:10;let u=n.getShapePageBounds(t);if(!u)return;u=u.clone().expandBy(d);const p=await n.getSvgString([t],{padding:d});if(s!==l||!p)return;const f=`data:image/svg+xml;utf8,${encodeURIComponent(p.svg)}`;i({src:f,bounds:u})});return()=>{s=null,a()}},[n,t,o]),!o||!r?null:e==="iframe"?g.jsx("iframe",{src:r.src,width:r.bounds.width,height:r.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,border:"none",transform:`translate(${r.bounds.x}px, ${r.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}}):g.jsx("img",{src:r.src,width:r.bounds.width,height:r.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${r.bounds.x}px, ${r.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}})}function ome(){const t=ne(),e=J("selection rotation",function(){return t.getSelectionRotation()},[t]),n=J("selection bounds",()=>t.getSelectionRotatedPageBounds(),[t]),{SelectionForeground:r}=gn();return!n||!r?null:g.jsx(r,{bounds:n,rotation:e})}function sme(){const t=ne(),e=J("selection rotation",()=>t.getSelectionRotation(),[t]),n=J("selection bounds",()=>t.getSelectionRotatedPageBounds(),[t]),{SelectionBackground:r}=gn();return!n||!r?null:g.jsx(r,{bounds:n,rotation:e})}function ame(){const{OnTheCanvas:t}=gn();return t?g.jsx(t,{}):null}function lme(){const t=ne(),e=J("camera state",()=>t.getCameraState(),[t]);return g.jsx("div",{className:Ye("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":e==="idle"})})}function _u({children:t,className:e="",...n}){return g.jsx("div",{...n,className:Ye("tl-html-container",e),children:t})}class cme{constructor(e){this.editor=e}static props;static migrations;static type}function m0(t,e,n={}){const{newPoint:r,handle:i,scaleX:o,scaleY:s}=e,{minWidth:a=1,maxWidth:l=1/0,minHeight:c=1,maxHeight:d=1/0}=n;let u=t.props.w*o,p=t.props.h*s;const f=new T(0,0);if(u>0){if(u<a){switch(i){case"top_left":case"left":case"bottom_left":{f.x=u-a;break}case"top":case"bottom":{f.x=(u-a)/2;break}default:f.x=0}u=a}}else if(f.x=u,u=-u,u<a){switch(i){case"top_left":case"left":case"bottom_left":{f.x=-u;break}default:f.x=-a}u=a}if(p>0){if(p<c){switch(i){case"top_left":case"top":case"top_right":{f.y=p-c;break}case"right":case"left":{f.y=(p-c)/2;break}default:f.y=0}p=c}}else if(f.y=p,p=-p,p<c){switch(i){case"top_left":case"top":case"top_right":{f.y=-p;break}default:f.y=-c}p=c}const{x:y,y:v}=f.rot(t.rotation).add(r);return{...t,x:y,y:v,props:{w:Math.min(l,u),h:Math.min(d,p)}}}class Rf extends Yu{getGeometry(e){return new Cl({width:e.props.w,height:e.props.h,isFilled:!0})}onResize(e,n){return m0(e,n)}getHandleSnapGeometry(e){return{points:this.getGeometry(e).bounds.cornersAndCenter}}getInterpolatedProps(e,n,r){return{...n.props,w:St(e.props.w,n.props.w,r),h:St(e.props.h,n.props.h,r)}}}function rW(t,{initialBounds:e,scaleX:n,scaleY:r,newPoint:i,handle:o}){let s;switch(o){case"bottom_left":case"bottom_right":case"top_left":case"top_right":{s=Math.max(.01,Math.max(Math.abs(n),Math.abs(r)));break}case"left":case"right":{s=Math.max(.01,Math.abs(n));break}case"bottom":case"top":{s=Math.max(.01,Math.abs(r));break}default:throw Wt(o)}const a=new T(0,0);n<0&&(a.x=-(e.width*s)),r<0&&(a.y=-(e.height*s));const{x:l,y:c}=T.Add(i,a.rot(t.rotation));return{x:l,y:c,props:{scale:s*t.props.scale}}}let ume=class extends We{static id="idle";onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},dme=class extends We{static id="pointing";onPointerMove(e){const{editor:n}=this;if(n.inputs.isDragging){const{originPagePoint:r}=n.inputs,i=this.parent.shapeType,o=sn(),s=n.markHistoryStoppingPoint(`creating_box:${o}`),a=Ps(r,n);if(this.editor.createShapes([{id:o,type:i,x:a.x,y:a.y,props:{w:1,h:1}}]),!n.getShape(o)){this.cancel();return}n.select(o);const c=this.parent;this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:s,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:c.onCreate?d=>c.onCreate?.(d):void 0})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint:e}=this.editor.inputs,n=this.parent.shapeType,r=sn();this.editor.markHistoryStoppingPoint(`creating_box:${r}`),this.editor.createShapes([{id:r,type:n,x:e.x,y:e.y}]);const i=this.editor.getShape(r);if(!i){this.cancel();return}let{w:o,h:s}=i.props;const a=new T(o/2,s/2),l=this.editor.getShapeParentTransform(i);l&&a.rot(-l.rotation());let c=1;this.editor.user.getIsDynamicResizeMode()&&(c=1/this.editor.getZoomLevel(),o*=c,s*=c,a.mul(c));const d=fn(i),u=Ps(new T(i.x-a.x,i.y-a.y),this.editor);d.x=u.x,d.y=u.y,d.props.w=o,d.props.h=s,"scale"in i.props&&(d.props.scale=c),this.editor.updateShape(d),this.editor.setSelectedShapes([r]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}};function Ps(t,e){const n=e.getInstanceState().isGridMode,r=e.getDocumentSettings().gridSize;return n?t.clone().snapToGrid(r):t.clone()}class hme extends We{static id="box";static initial="idle";static children(){return[ume,dme]}}function pme(t,e,n){const r=I.useRef(!1),i=I.useCallback(s=>{r.current=s,s?ho.addOpenMenu(t):ho.deleteOpenMenu(t),e?.(s)},[t,e]),o=J("is menu open",()=>ho.getOpenMenus().includes(t),[t]);return I.useEffect(()=>(r.current&&(n?.("open-menu"),ho.addOpenMenu(t)),()=>{r.current&&(ho.deleteOpenMenu(t),ho.getOpenMenus().forEach(s=>{s.startsWith(t)&&(n?.("close-menu"),ho.deleteOpenMenu(s))}),r.current=!1)}),[t,n]),[o,i]}function iv(t){const e=ne();return J("isEditing",()=>e.getEditingShapeId()===t,[e,t])}function fme(t){if(!t)throw Error("usePassThroughWheelEvents must be passed a ref");const e=Cr(),n=hr();I.useEffect(()=>{function r(o){if(!n?.getInstanceState().isFocused||o.isSpecialRedispatchedEvent)return;dt(o);const s=e.querySelector(".tl-canvas");if(!s)return;const a=new PointerEvent(o.type,o);a.isSpecialRedispatchedEvent=!0,s.dispatchEvent(a)}const i=t.current;if(i)return i.addEventListener("mouseover",r,{passive:!1}),()=>{i.removeEventListener("mouseover",r)}},[e,n,t])}function ll(t){const e=ne();return I.useMemo(function(){const i=c=>{if(e.wasEventAlreadyHandled(c))return;if(c.button===Z2){e.dispatch({type:"pointer",target:"selection",handle:t,name:"right_click",...Hi(e,c)});return}if(c.button!==0)return;const d=fb(c.currentTarget);function u(){d.removeEventListener("pointerup",u),Gy(d,c)}qy(d,c),d.addEventListener("pointerup",u),e.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:t,...Hi(e,c)}),e.markEventAsHandled(c)};let o,s;function a(c){e.wasEventAlreadyHandled(c)||c.button===0&&(c.clientX===o&&c.clientY===s||(o=c.clientX,s=c.clientY,e.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:t,...Hi(e,c)})))}return{onPointerDown:i,onPointerMove:a,onPointerUp:c=>{e.wasEventAlreadyHandled(c)||c.button===0&&e.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:t,...Hi(e,c)})}}},[e,t])}function gme(t){const[e,n]=I.useState(()=>({store:vb(t),opts:t}));if(!l5(e.opts,t)){const r={store:vb(t),opts:t};return n(r),r.store}return e.store}const mme=20,yme=8;function y0(t,e=mme){return Math.max(yme,Math.ceil(t/e))}class iW extends Gu{_center;_radius;_start;_end;_largeArcFlag;_sweepFlag;_measure;_angleStart;_angleEnd;constructor(e){super({...e,isFilled:!1,isClosed:!1});const{center:n,sweepFlag:r,largeArcFlag:i,start:o,end:s}=e;if(o.equals(s))throw Error("Arc must have different start and end points.");this._angleStart=T.Angle(n,o),this._angleEnd=T.Angle(n,s),this._radius=T.Dist(n,o),this._measure=Bce(this._angleStart,this._angleEnd,r,i),this._start=o,this._end=s,this._sweepFlag=r,this._largeArcFlag=i,this._center=n}nearestPoint(e){const{_center:n,_measure:r,_radius:i,_angleEnd:o,_angleStart:s,_start:a,_end:l}=this,c=Wz(r,s,o,n.angle(e));if(c<=0)return a;if(c>=1)return l;const d=T.Sub(e,n).uni().mul(i).add(n);let u,p=1/0,f;for(const y of[a,l,d])f=T.Dist2(e,y),f<p&&(u=y,p=f);if(!u)throw Error("nearest point not found");return u}hitTestLineSegment(e,n){const{_center:r,_radius:i,_measure:o,_angleStart:s,_angleEnd:a}=this,l=Xy(e,n,r,i);return l===null?!1:l.some(c=>{const d=Wz(o,s,a,r.angle(c));return d>=0&&d<=1})}getVertices(){const{_center:e,_measure:n,length:r,_radius:i,_angleStart:o}=this,s=[];for(let a=0,l=y0(Math.abs(r));a<l+1;a++){const c=a/l*n,d=o+c;s.push(X2(e,i,d))}return s}getSvgPathData(e=!0){const{_start:n,_end:r,_radius:i,_largeArcFlag:o,_sweepFlag:s}=this;return`${e?`M${n.toFixed()}`:""} A${i} ${i} 0 ${o} ${s} ${r.toFixed()}`}getLength(){return Math.abs(this._measure*this._radius)}}class Sb extends Gu{constructor(e){super({isClosed:!0,...e}),this.config=e;const{x:n=0,y:r=0,radius:i}=e;this._x=n,this._y=r,this._center=new T(i+n,i+r),this._radius=i}_center;_radius;_x;_y;getBounds(){return new pe(this._x,this._y,this._radius*2,this._radius*2)}getVertices(){const{_center:e,_radius:n}=this,r=Sn*n,i=[];for(let o=0,s=y0(r);o<s;o++){const a=o/s*Sn;i.push(X2(e,n,a))}return i}nearestPoint(e){const{_center:n,_radius:r}=this;return n.equals(e)?T.AddXY(n,r,0):T.Sub(e,n).uni().mul(r).add(n)}hitTestLineSegment(e,n,r=0){const{_center:i,_radius:o}=this;return Xy(e,n,i,o+r)!==null}getSvgPathData(){const{_center:e,_radius:n}=this;return`M${e.x+n},${e.y} a${n},${n} 0 1,0 ${n*2},0a${n},${n} 0 1,0 -${n*2},0`}}class yA extends Zy{_a;_b;_c;_d;_resolution;constructor(e){const{start:n,cp1:r,cp2:i,end:o}=e;super({...e,points:[n,o]}),this._a=n,this._b=r,this._c=i,this._d=o,this._resolution=e.resolution??10}getVertices(){const e=[],{_a:n,_b:r,_c:i,_d:o}=this;for(let s=0,a=this._resolution;s<=a;s++){const l=s/a;e.push(new T((1-l)*(1-l)*(1-l)*n.x+3*((1-l)*(1-l))*l*r.x+3*(1-l)*(l*l)*i.x+l*l*l*o.x,(1-l)*(1-l)*(1-l)*n.y+3*((1-l)*(1-l))*l*r.y+3*(1-l)*(l*l)*i.y+l*l*l*o.y))}return e}nearestPoint(e){let n,r=1/0,i,o;for(const s of this.segments)o=s.nearestPoint(e),i=T.Dist2(o,e),i<r&&(n=o,r=i);if(!n)throw Error("nearest point not found");return n}getSvgPathData(e=!0){const{_a:n,_b:r,_c:i,_d:o}=this;return`${e?`M ${n.toFixed()} `:""} C${r.toFixed()} ${i.toFixed()} ${o.toFixed()}`}static GetAtT(e,n){const{_a:r,_b:i,_c:o,_d:s}=e;return new T((1-n)*(1-n)*(1-n)*r.x+3*((1-n)*(1-n))*n*i.x+3*(1-n)*(n*n)*o.x+n*n*n*s.x,(1-n)*(1-n)*(1-n)*r.y+3*((1-n)*(1-n))*n*i.y+3*(1-n)*(n*n)*o.y+n*n*n*s.y)}getLength(e,n=32){let r,i=this._a,o=0;for(let s=1;s<=n;s++)r=yA.GetAtT(this,s/n),o+=T.Dist(i,r),i=r;return o}}class vme extends Gu{constructor(e){super({...e,isClosed:!0}),this.config=e;const{width:n,height:r}=e;this._w=n,this._h=r}_w;_h;_edges;get edges(){if(!this._edges){const{vertices:e}=this;this._edges=[];for(let n=0,r=e.length;n<r;n++){const i=e[n],o=e[(n+1)%r];this._edges.push(new cf({start:i,end:o}))}}return this._edges}getVertices(){const e=Math.max(1,this._w),n=Math.max(1,this._h),r=e/2,i=n/2,o=Math.pow(r-i,2)/Math.pow(r+i,2),s=nn*(r+i)*(1+3*o/(10+Math.sqrt(4-3*o))),a=y0(s),l=Sn/a,c=Math.cos(l),d=Math.sin(l);let u=0,p=1,f=0,y=1;const v=Array(a);for(let x=0;x<a;x++)v[x]=new T(pt(r+r*p,0,e),pt(i+i*u,0,n)),f=d*p+c*u,y=c*p-d*u,u=f,p=y;return v}nearestPoint(e){let n,r=1/0,i,o;for(const s of this.edges)o=s.nearestPoint(e),i=T.Dist2(o,e),i<r&&(n=o,r=i);if(!n)throw Error("nearest point not found");return n}hitTestLineSegment(e,n){return this.edges.some(r=>r.hitTestLineSegment(e,n))}getBounds(){return new pe(0,0,this._w,this._h)}getLength(){const{_w:e,_h:n}=this,r=e/2,i=n/2,o=Math.max(0,r),s=Math.max(0,i);return Nce(o,s)}getSvgPathData(e=!1){const{_w:n,_h:r}=this,i=n/2,o=r/2,s=Math.max(0,i),a=Math.max(0,o);return`${e?`M${i-s},${o}`:""} a${s},${a},0,1,1,${s*2},0a${s},${a},0,1,1,-${s*2},0`}}class xme{constructor(e,n){this.name=e,this.getInitialState=n}states=new ki;getAtom(e){return this.states.get(e,()=>qt(this.name,this.getInitialState(e)))}get(e){return this.getAtom(e).get()}update(e,n){return this.getAtom(e).update(n)}set(e,n){return this.getAtom(e).set(n)}}function un(t,e,n){const r=new Set;for(const a of e){const l=t.getShape(a);if(!l)continue;r.add(l);const c=t.getShape(l.parentId);c&&r.add(c)}const i=new Map;for(const a of r){const l=t.getSortedChildIdsForParent(a);if(n?.filter&&!n.filter(a))i.set(a,l);else{const c=Sme(t,a.id,l);c.length<l.length&&i.set(a,l.filter(d=>!c.includes(d)))}}const o=t.getCurrentPageShapesSorted().map(a=>a.id),s={};for(const[a,l]of i){const c=ut(l.map(p=>t.getShape(p))),{reparenting:d,remainingShapesToReparent:u}=bme(t,c,(p,f)=>n?.filter&&!n.filter(f)?!1:f.id!==a.id&&o.indexOf(f.id)<o.indexOf(p.id));if(d.forEach((p,f)=>{p.length!==0&&(s[f]||(s[f]={parentId:f,shapeIds:[]}),s[f].shapeIds.push(...p.map(y=>y.id)))}),u.size>0){const p=t.findShapeAncestor(a,f=>t.isShapeOfType(f,"group"))?.id??t.getCurrentPageId();u.forEach(f=>{if(!s[p]){let y;const v=t.getSortedChildIdsForParent(p),x=v.indexOf(a.id);if(x>-1){const b=v[x+1],w=b?t.getShape(b).index:na(a.index);y=rf(a.index,w)}s[p]={parentId:p,shapeIds:[],index:y}}s[p].shapeIds.push(f.id)})}}t.run(()=>{Object.values(s).forEach(({parentId:a,shapeIds:l,index:c})=>{l.length!==0&&(l.sort((d,u)=>o.indexOf(d)<o.indexOf(u)?-1:1),t.reparentShapes(l,a,c))})})}function Sme(t,e,n){if(n.length===0)return ur;const r=t.getShapePageBounds(e);if(!r)return ur;const i=t.getShapeGeometry(e),s=t.getShapePageTransform(e).applyToPoints(i.vertices),a=t.getShape(e);if(!a)return ur;const l=t.getShapePageTransform(e),c=t.getShapeUtil(a.type).getClipPath?.(a),d=c?l.applyToPoints(c):void 0,u=d?mb(d,s):s;return u?n.filter(p=>{const f=t.getShapePageBounds(p);if(!f||!r.includes(f))return!1;const y=t.getShapePageTransform(p).clone().invert().applyToPoints(u);return t.getShapeGeometry(p).overlapsPolygon(y)}):ur}function bme(t,e,n){const r=new Set(e),i=new Set;for(const c of e){const d=t.getShapeParent(c);d&&t.isShapeOfType(d,"group")&&(i.has(d)||i.add(d))}for(const c of i){const d=ut(t.getSortedChildIdsForParent(c).map(u=>t.getShape(u)));for(const u of d)r.delete(u);r.add(c)}const o=new Map,s=new Map,a=new Set(r),l=t.getCurrentPageShapesSorted().filter(c=>t.getShapeUtil(c).canReceiveNewChildrenOfType?.(c,c.type)&&!a.has(c));e:for(let c=l.length-1;c>=0;c--){const d=l[c],u=t.findShapeAncestor(d,w=>t.isShapeOfType(w,"group"))?.id,p=t.getShapeGeometry(d),f=t.getShapePageTransform(d),y=t.getShapeMask(d),v=f.applyToPoints(p.vertices),x=y?mb(y,v):v;if(!x)continue e;const b=[];t:for(const w of a){if(d.id===w.id||n&&!n(w,d)||(o.has(w.id)||o.set(w.id,t.findShapeAncestor(w,A=>t.isShapeOfType(A,"group"))?.id),o.get(w.id)!==u)||t.findShapeAncestor(d,A=>w.id===A.id))continue t;const C=t.getShapePageTransform(w).clone().invert().applyToPoints(x);if(t.getShapeGeometry(w).overlapsPolygon(C)){if(!t.getShapeUtil(d).canReceiveNewChildrenOfType?.(d,w.type))continue t;w.parentId!==d.id&&b.push(w),a.delete(w);continue t}}b.length&&s.set(d.id,b)}return{reparenting:s,remainingShapesToReparent:a}}function pi(t){this.content=t}pi.prototype={constructor:pi,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,i=r.find(t),o=r.content.slice();return i==-1?o.push(n||t,e):(o[i+1]=e,n&&(o[i]=n)),new pi(o)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new pi(n)},addToStart:function(t,e){return new pi([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new pi(n)},addBefore:function(t,e,n){var r=this.remove(e),i=r.content.slice(),o=r.find(t);return i.splice(o==-1?i.length:o,0,e,n),new pi(i)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=pi.from(t),t.size?new pi(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=pi.from(t),t.size?new pi(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=pi.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};pi.from=function(t){if(t instanceof pi)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new pi(e)};function oW(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let i=t.child(r),o=e.child(r);if(i==o){n+=i.nodeSize;continue}if(!i.sameMarkup(o))return n;if(i.isText&&i.text!=o.text){for(let s=0;i.text[s]==o.text[s];s++)n++;return n}if(i.content.size||o.content.size){let s=oW(i.content,o.content,n+1);if(s!=null)return s}n+=i.nodeSize}}function sW(t,e,n,r){for(let i=t.childCount,o=e.childCount;;){if(i==0||o==0)return i==o?null:{a:n,b:r};let s=t.child(--i),a=e.child(--o),l=s.nodeSize;if(s==a){n-=l,r-=l;continue}if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){let c=0,d=Math.min(s.text.length,a.text.length);for(;c<d&&s.text[s.text.length-c-1]==a.text[a.text.length-c-1];)c++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){let c=sW(s.content,a.content,n-1,r-1);if(c)return c}n-=l,r-=l}}class Pe{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,i=0,o){for(let s=0,a=0;a<n;s++){let l=this.content[s],c=a+l.nodeSize;if(c>e&&r(l,i+a,o||null,s)!==!1&&l.content.size){let d=a+1;l.nodesBetween(Math.max(0,e-d),Math.min(l.content.size,n-d),r,i+d)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,i){let o="",s=!0;return this.nodesBetween(e,n,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,n-l):a.isLeaf?i?typeof i=="function"?i(a):i:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&r&&(s?s=!1:o+=r),o+=c},0),o}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,i=this.content.slice(),o=0;for(n.isText&&n.sameMarkup(r)&&(i[i.length-1]=n.withText(n.text+r.text),o=1);o<e.content.length;o++)i.push(e.content[o]);return new Pe(i,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],i=0;if(n>e)for(let o=0,s=0;s<n;o++){let a=this.content[o],l=s+a.nodeSize;l>e&&((s<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-s),Math.min(a.text.length,n-s)):a=a.cut(Math.max(0,e-s-1),Math.min(a.content.size,n-s-1))),r.push(a),i+=a.nodeSize),s=l}return new Pe(r,i)}cutByIndex(e,n){return e==n?Pe.empty:e==0&&n==this.content.length?this:new Pe(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let i=this.content.slice(),o=this.size+n.nodeSize-r.nodeSize;return i[e]=n,new Pe(i,o)}addToStart(e){return new Pe([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new Pe(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let i=this.content[n];e(i,r,n),r+=i.nodeSize}}findDiffStart(e,n=0){return oW(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return sW(this,e,n,r)}findIndex(e){if(e==0)return Hx(0,e);if(e==this.size)return Hx(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let i=this.child(n),o=r+i.nodeSize;if(o>=e)return o==e?Hx(n+1,o):Hx(n,r);r=o}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return Pe.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new Pe(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return Pe.empty;let n,r=0;for(let i=0;i<e.length;i++){let o=e[i];r+=o.nodeSize,i&&o.isText&&e[i-1].sameMarkup(o)?(n||(n=e.slice(0,i)),n[n.length-1]=o.withText(n[n.length-1].text+o.text)):n&&n.push(o)}return new Pe(n||e,r)}static from(e){if(!e)return Pe.empty;if(e instanceof Pe)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new Pe([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Pe.empty=new Pe([],0);const JC={index:0,offset:0};function Hx(t,e){return JC.index=t,JC.offset=e,JC}function bb(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!bb(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!bb(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}let xn=class RT{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let i=0;i<e.length;i++){let o=e[i];if(this.eq(o))return e;if(this.type.excludes(o.type))n||(n=e.slice(0,i));else{if(o.type.excludes(this.type))return e;!r&&o.type.rank>this.type.rank&&(n||(n=e.slice(0,i)),n.push(this),r=!0),n&&n.push(o)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&bb(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let i=r.create(n.attrs);return r.checkAttrs(i.attrs),i}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return RT.none;if(e instanceof RT)return[e];let n=e.slice();return n.sort((r,i)=>r.type.rank-i.type.rank),n}};xn.none=[];class wb extends Error{}class He{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=lW(this.content,e+this.openStart,n);return r&&new He(r,this.openStart,this.openEnd)}removeBetween(e,n){return new He(aW(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return He.empty;let r=n.openStart||0,i=n.openEnd||0;if(typeof r!="number"||typeof i!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new He(Pe.fromJSON(e,n.content),r,i)}static maxOpen(e,n=!0){let r=0,i=0;for(let o=e.firstChild;o&&!o.isLeaf&&(n||!o.type.spec.isolating);o=o.firstChild)r++;for(let o=e.lastChild;o&&!o.isLeaf&&(n||!o.type.spec.isolating);o=o.lastChild)i++;return new He(e,r,i)}}He.empty=new He(Pe.empty,0,0);function aW(t,e,n){let{index:r,offset:i}=t.findIndex(e),o=t.maybeChild(r),{index:s,offset:a}=t.findIndex(n);if(i==e||o.isText){if(a!=n&&!t.child(s).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=s)throw new RangeError("Removing non-flat range");return t.replaceChild(r,o.copy(aW(o.content,e-i-1,n-i-1)))}function lW(t,e,n,r){let{index:i,offset:o}=t.findIndex(e),s=t.maybeChild(i);if(o==e||s.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=lW(s.content,e-o-1,n,s);return a&&t.replaceChild(i,s.copy(a))}function wme(t,e,n){if(n.openStart>t.depth)throw new wb("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new wb("Inconsistent open depths");return cW(t,e,n,0)}function cW(t,e,n,r){let i=t.index(r),o=t.node(r);if(i==e.index(r)&&r<t.depth-n.openStart){let s=cW(t,e,n,r+1);return o.copy(o.content.replaceChild(i,s))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let s=t.parent,a=s.content;return Hd(s,a.cut(0,t.parentOffset).append(n.content).append(a.cut(e.parentOffset)))}else{let{start:s,end:a}=kme(n,t);return Hd(o,dW(t,s,a,e,r))}else return Hd(o,kb(t,e,r))}function uW(t,e){if(!e.type.compatibleContent(t.type))throw new wb("Cannot join "+e.type.name+" onto "+t.type.name)}function $T(t,e,n){let r=t.node(n);return uW(r,e.node(n)),r}function Ud(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function Dm(t,e,n,r){let i=(e||t).node(n),o=0,s=e?e.index(n):i.childCount;t&&(o=t.index(n),t.depth>n?o++:t.textOffset&&(Ud(t.nodeAfter,r),o++));for(let a=o;a<s;a++)Ud(i.child(a),r);e&&e.depth==n&&e.textOffset&&Ud(e.nodeBefore,r)}function Hd(t,e){return t.type.checkContent(e),t.copy(e)}function dW(t,e,n,r,i){let o=t.depth>i&&$T(t,e,i+1),s=r.depth>i&&$T(n,r,i+1),a=[];return Dm(null,t,i,a),o&&s&&e.index(i)==n.index(i)?(uW(o,s),Ud(Hd(o,dW(t,e,n,r,i+1)),a)):(o&&Ud(Hd(o,kb(t,e,i+1)),a),Dm(e,n,i,a),s&&Ud(Hd(s,kb(n,r,i+1)),a)),Dm(r,null,i,a),new Pe(a)}function kb(t,e,n){let r=[];if(Dm(null,t,n,r),t.depth>n){let i=$T(t,e,n+1);Ud(Hd(i,kb(t,e,n+1)),r)}return Dm(e,null,n,r),new Pe(r)}function kme(t,e){let n=e.depth-t.openStart,i=e.node(n).copy(t.content);for(let o=n-1;o>=0;o--)i=e.node(o).copy(Pe.from(i));return{start:i.resolveNoCache(t.openStart+n),end:i.resolveNoCache(i.content.size-t.openEnd-n)}}class oy{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],i=e.child(n);return r?e.child(n).cut(r):i}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],i=n==0?0:this.path[n*3-1]+1;for(let o=0;o<e;o++)i+=r.child(o).nodeSize;return i}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return xn.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),i=e.maybeChild(n);if(!r){let a=r;r=i,i=a}let o=r.marks;for(var s=0;s<o.length;s++)o[s].type.spec.inclusive===!1&&(!i||!o[s].isInSet(i.marks))&&(o=o[s--].removeFromSet(o));return o}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,i=e.parent.maybeChild(e.index());for(var o=0;o<r.length;o++)r[o].type.spec.inclusive===!1&&(!i||!r[o].isInSet(i.marks))&&(r=r[o--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new Ib(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],i=0,o=n;for(let s=e;;){let{index:a,offset:l}=s.content.findIndex(o),c=o-l;if(r.push(s,a,i+l),!c||(s=s.child(a),s.isText))break;o=c-1,i+=l+1}return new oy(n,r,o)}static resolveCached(e,n){let r=H4.get(e);if(r)for(let o=0;o<r.elts.length;o++){let s=r.elts[o];if(s.pos==n)return s}else H4.set(e,r=new Ime);let i=r.elts[r.i]=oy.resolve(e,n);return r.i=(r.i+1)%_me,i}}class Ime{constructor(){this.elts=[],this.i=0}}const _me=12,H4=new WeakMap;class Ib{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const Cme=Object.create(null);let Fa=class NT{constructor(e,n,r,i=xn.none){this.type=e,this.attrs=n,this.marks=i,this.content=r||Pe.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,i=0){this.content.nodesBetween(e,n,r,i,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,i){return this.content.textBetween(e,n,r,i)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&bb(this.attrs,n||e.defaultAttrs||Cme)&&xn.sameSet(this.marks,r||xn.none)}copy(e=null){return e==this.content?this:new NT(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new NT(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return He.empty;let i=this.resolve(e),o=this.resolve(n),s=r?0:i.sharedDepth(n),a=i.start(s),c=i.node(s).content.cut(i.pos-a,o.pos-a);return new He(c,i.depth-s,o.depth-s)}replace(e,n,r){return wme(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:i}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(i==e||n.isText)return n;e-=i+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let i=this.content.child(n-1);return{node:i,index:n-1,offset:r-i.nodeSize}}resolve(e){return oy.resolveCached(this,e)}resolveNoCache(e){return oy.resolve(this,e)}rangeHasMark(e,n,r){let i=!1;return n>e&&this.nodesBetween(e,n,o=>(r.isInSet(o.marks)&&(i=!0),!i)),i}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),hW(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=Pe.empty,i=0,o=r.childCount){let s=this.contentMatchAt(e).matchFragment(r,i,o),a=s&&s.matchFragment(this.content,n);if(!a||!a.validEnd)return!1;for(let l=i;l<o;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,n,r,i){if(i&&!this.type.allowsMarks(i))return!1;let o=this.contentMatchAt(e).matchType(r),s=o&&o.matchFragment(this.content,n);return s?s.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=xn.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!xn.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let i=Pe.fromJSON(e,n.content),o=e.nodeType(n.type).create(n.attrs,i,r);return o.type.checkAttrs(o.attrs),o}};Fa.prototype.text=void 0;class _b extends Fa{constructor(e,n,r,i){if(super(e,n,null,i),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):hW(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new _b(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new _b(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function hW(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class rh{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new Pme(e,n);if(r.next==null)return rh.empty;let i=pW(r);r.next&&r.err("Unexpected trailing text");let o=jme(Dme(i));return Rme(o,r),o}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let i=this;for(let o=n;i&&o<r;o++)i=i.matchType(e.child(o).type);return i}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let i=[this];function o(s,a){let l=s.matchFragment(e,r);if(l&&(!n||l.validEnd))return Pe.from(a.map(c=>c.createAndFill()));for(let c=0;c<s.next.length;c++){let{type:d,next:u}=s.next[c];if(!(d.isText||d.hasRequiredAttrs())&&i.indexOf(u)==-1){i.push(u);let p=o(u,a.concat(d));if(p)return p}}return null}return o(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let i=r.shift(),o=i.match;if(o.matchType(e)){let s=[];for(let a=i;a.type;a=a.via)s.push(a.type);return s.reverse()}for(let s=0;s<o.next.length;s++){let{type:a,next:l}=o.next[s];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in n)&&(!i.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:i}),n[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let i=0;i<r.next.length;i++)e.indexOf(r.next[i].next)==-1&&n(r.next[i].next)}return n(this),e.map((r,i)=>{let o=i+(r.validEnd?"*":" ")+" ";for(let s=0;s<r.next.length;s++)o+=(s?", ":"")+r.next[s].type.name+"->"+e.indexOf(r.next[s].next);return o}).join(`
`)}}rh.empty=new rh(!0);class Pme{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function pW(t){let e=[];do e.push(Tme(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function Tme(t){let e=[];do e.push(Eme(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function Eme(t){let e=Ome(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=Ame(t,e);else break;return e}function W4(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function Ame(t,e){let n=W4(t),r=n;return t.eat(",")&&(t.next!="}"?r=W4(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function Mme(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let i=[];for(let o in n){let s=n[o];s.isInGroup(e)&&i.push(s)}return i.length==0&&t.err("No node type or group '"+e+"' found"),i}function Ome(t){if(t.eat("(")){let e=pW(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=Mme(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function Dme(t){let e=[[]];return i(o(t,0),n()),e;function n(){return e.push([])-1}function r(s,a,l){let c={term:l,to:a};return e[s].push(c),c}function i(s,a){s.forEach(l=>l.to=a)}function o(s,a){if(s.type=="choice")return s.exprs.reduce((l,c)=>l.concat(o(c,a)),[]);if(s.type=="seq")for(let l=0;;l++){let c=o(s.exprs[l],a);if(l==s.exprs.length-1)return c;i(c,a=n())}else if(s.type=="star"){let l=n();return r(a,l),i(o(s.expr,l),l),[r(l)]}else if(s.type=="plus"){let l=n();return i(o(s.expr,a),l),i(o(s.expr,l),l),[r(l)]}else{if(s.type=="opt")return[r(a)].concat(o(s.expr,a));if(s.type=="range"){let l=a;for(let c=0;c<s.min;c++){let d=n();i(o(s.expr,l),d),l=d}if(s.max==-1)i(o(s.expr,l),l);else for(let c=s.min;c<s.max;c++){let d=n();r(l,d),i(o(s.expr,l),d),l=d}return[r(l)]}else{if(s.type=="name")return[r(a,void 0,s.value)];throw new Error("Unknown expr type")}}}}function fW(t,e){return e-t}function V4(t,e){let n=[];return r(e),n.sort(fW);function r(i){let o=t[i];if(o.length==1&&!o[0].term)return r(o[0].to);n.push(i);for(let s=0;s<o.length;s++){let{term:a,to:l}=o[s];!a&&n.indexOf(l)==-1&&r(l)}}}function jme(t){let e=Object.create(null);return n(V4(t,0));function n(r){let i=[];r.forEach(s=>{t[s].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let d=0;d<i.length;d++)i[d][0]==a&&(c=i[d][1]);V4(t,l).forEach(d=>{c||i.push([a,c=[]]),c.indexOf(d)==-1&&c.push(d)})})});let o=e[r.join(",")]=new rh(r.indexOf(t.length-1)>-1);for(let s=0;s<i.length;s++){let a=i[s][1].sort(fW);o.next.push({type:i[s][0],next:e[a.join(",")]||n(a)})}return o}}function Rme(t,e){for(let n=0,r=[t];n<r.length;n++){let i=r[n],o=!i.validEnd,s=[];for(let a=0;a<i.next.length;a++){let{type:l,next:c}=i.next[a];s.push(l.name),o&&!(l.isText||l.hasRequiredAttrs())&&(o=!1),r.indexOf(c)==-1&&r.push(c)}o&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function gW(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function mW(t,e){let n=Object.create(null);for(let r in t){let i=e&&e[r];if(i===void 0){let o=t[r];if(o.hasDefault)i=o.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=i}return n}function yW(t,e,n,r){for(let i in e)if(!(i in t))throw new RangeError(`Unsupported attribute ${i} for ${n} of type ${i}`);for(let i in t){let o=t[i];o.validate&&o.validate(e[i])}}function vW(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new Nme(t,r,e[r]);return n}let K4=class xW{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=vW(e,r.attrs),this.defaultAttrs=gW(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==rh.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:mW(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Fa(this,this.computeAttrs(e),Pe.from(n),xn.setFrom(r))}createChecked(e=null,n,r){return n=Pe.from(n),this.checkContent(n),new Fa(this,this.computeAttrs(e),n,xn.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=Pe.from(n),n.size){let s=this.contentMatch.fillBefore(n);if(!s)return null;n=s.append(n)}let i=this.contentMatch.matchFragment(n),o=i&&i.fillBefore(Pe.empty,!0);return o?new Fa(this,e,n.append(o),xn.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){yW(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:xn.none:e}static compile(e,n){let r=Object.create(null);e.forEach((o,s)=>r[o]=new xW(o,n,s));let i=n.spec.topNode||"doc";if(!r[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let o in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function $me(t,e,n){let r=n.split("|");return i=>{let o=i===null?"null":typeof i;if(r.indexOf(o)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${o}`)}}class Nme{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?$me(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class v0{constructor(e,n,r,i){this.name=e,this.rank=n,this.schema=r,this.spec=i,this.attrs=vW(e,i.attrs),this.excluded=null;let o=gW(this.attrs);this.instance=o?new xn(this,o):null}create(e=null){return!e&&this.instance?this.instance:new xn(this,mW(this.attrs,e))}static compile(e,n){let r=Object.create(null),i=0;return e.forEach((o,s)=>r[o]=new v0(o,i++,n,s)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){yW(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}let SW=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let i in e)n[i]=e[i];n.nodes=pi.from(e.nodes),n.marks=pi.from(e.marks||{}),this.nodes=K4.compile(this.spec.nodes,this),this.marks=v0.compile(this.spec.marks,this);let r=Object.create(null);for(let i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");let o=this.nodes[i],s=o.spec.content||"",a=o.spec.marks;if(o.contentMatch=r[s]||(r[s]=rh.parse(s,this.nodes)),o.inlineContent=o.contentMatch.inlineContent,o.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!o.isInline||!o.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=o}o.markSet=a=="_"?null:a?q4(this,a.split(" ")):a==""||!o.inlineContent?[]:null}for(let i in this.marks){let o=this.marks[i],s=o.spec.excludes;o.excluded=s==null?[o]:s==""?[]:q4(this,s.split(" "))}this.nodeFromJSON=i=>Fa.fromJSON(this,i),this.markFromJSON=i=>xn.fromJSON(this,i),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,i){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof K4){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,i)}text(e,n){let r=this.nodes.text;return new _b(r,r.defaultAttrs,e,xn.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}};function q4(t,e){let n=[];for(let r=0;r<e.length;r++){let i=e[r],o=t.marks[i],s=o;if(o)n.push(o);else for(let a in t.marks){let l=t.marks[a];(i=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(i)>-1)&&n.push(s=l)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function Lme(t){return t.tag!=null}function zme(t){return t.style!=null}let Gp=class LT{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(i=>{if(Lme(i))this.tags.push(i);else if(zme(i)){let o=/[^=]*/.exec(i.style)[0];r.indexOf(o)<0&&r.push(o),this.styles.push(i)}}),this.normalizeLists=!this.tags.some(i=>{if(!/^(ul|ol)\b/.test(i.tag)||!i.node)return!1;let o=e.nodes[i.node];return o.contentMatch.matchType(o)})}parse(e,n={}){let r=new Y4(this,n,!1);return r.addAll(e,xn.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new Y4(this,n,!0);return r.addAll(e,xn.none,n.from,n.to),He.maxOpen(r.finish())}matchTag(e,n,r){for(let i=r?this.tags.indexOf(r)+1:0;i<this.tags.length;i++){let o=this.tags[i];if(Ume(e,o.tag)&&(o.namespace===void 0||e.namespaceURI==o.namespace)&&(!o.context||n.matchesContext(o.context))){if(o.getAttrs){let s=o.getAttrs(e);if(s===!1)continue;o.attrs=s||void 0}return o}}}matchStyle(e,n,r,i){for(let o=i?this.styles.indexOf(i)+1:0;o<this.styles.length;o++){let s=this.styles[o],a=s.style;if(!(a.indexOf(e)!=0||s.context&&!r.matchesContext(s.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(s.getAttrs){let l=s.getAttrs(n);if(l===!1)continue;s.attrs=l||void 0}return s}}}static schemaRules(e){let n=[];function r(i){let o=i.priority==null?50:i.priority,s=0;for(;s<n.length;s++){let a=n[s];if((a.priority==null?50:a.priority)<o)break}n.splice(s,0,i)}for(let i in e.marks){let o=e.marks[i].spec.parseDOM;o&&o.forEach(s=>{r(s=X4(s)),s.mark||s.ignore||s.clearMark||(s.mark=i)})}for(let i in e.nodes){let o=e.nodes[i].spec.parseDOM;o&&o.forEach(s=>{r(s=X4(s)),s.node||s.ignore||s.mark||(s.node=i)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new LT(e,LT.schemaRules(e)))}};const bW={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Fme={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},wW={ol:!0,ul:!0},sy=1,zT=2,jm=4;function G4(t,e,n){return e!=null?(e?sy:0)|(e==="full"?zT:0):t&&t.whitespace=="pre"?sy|zT:n&~jm}class Wx{constructor(e,n,r,i,o,s){this.type=e,this.attrs=n,this.marks=r,this.solid=i,this.options=s,this.content=[],this.activeMarks=xn.none,this.match=o||(s&jm?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(Pe.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,i;return(i=r.findWrapping(e.type))?(this.match=r,i):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&sy)){let r=this.content[this.content.length-1],i;if(r&&r.isText&&(i=/[ \t\r\n\u000c]+$/.exec(r.text))){let o=r;r.text.length==i[0].length?this.content.pop():this.content[this.content.length-1]=o.withText(o.text.slice(0,o.text.length-i[0].length))}}let n=Pe.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(Pe.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!bW.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class Y4{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let i=n.topNode,o,s=G4(null,n.preserveWhitespace,0)|(r?jm:0);i?o=new Wx(i.type,i.attrs,xn.none,!0,n.topMatch||i.type.contentMatch,s):r?o=new Wx(null,null,xn.none,!0,null,s):o=new Wx(e.schema.topNodeType,null,xn.none,!0,null,s),this.nodes=[o],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,i=this.top,o=i.options&zT?"full":this.localPreserveWS||(i.options&sy)>0;if(o==="full"||i.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(o)o!=="full"?r=r.replace(/\r?\n|\r/g," "):r=r.replace(/\r\n?/g,`
`);else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let s=i.content[i.content.length-1],a=e.previousSibling;(!s||a&&a.nodeName=="BR"||s.isText&&/[ \t\r\n\u000c]$/.test(s.text))&&(r=r.slice(1))}r&&this.insertNode(this.parser.schema.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let i=this.localPreserveWS,o=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let s=e.nodeName.toLowerCase(),a;wW.hasOwnProperty(s)&&this.parser.normalizeLists&&Bme(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));e:if(l?l.ignore:Fme.hasOwnProperty(s))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,d=this.needsBlock;if(bW.hasOwnProperty(s))o.content.length&&o.content[0].isInline&&this.open&&(this.open--,o=this.top),c=!0,o.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let u=l&&l.skip?n:this.readStyles(e,n);u&&this.addAll(e,u),c&&this.sync(o),this.needsBlock=d}else{let c=this.readStyles(e,n);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=i}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let i=0;i<this.parser.matchedStyles.length;i++){let o=this.parser.matchedStyles[i],s=r.getPropertyValue(o);if(s)for(let a=void 0;;){let l=this.parser.matchStyle(o,s,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(c=>!l.clearMark(c)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return n}addElementByRule(e,n,r,i){let o,s;if(n.node)if(s=this.parser.schema.nodes[n.node],s.isLeaf)this.insertNode(s.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(s,n.attrs||null,r,n.preserveWhitespace);l&&(o=!0,r=l)}else{let l=this.parser.schema.marks[n.mark];r=r.concat(l.create(n.attrs))}let a=this.top;if(s&&s.isLeaf)this.findInside(e);else if(i)this.addElement(e,r,i);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}o&&this.sync(a)&&this.open--}addAll(e,n,r,i){let o=r||0;for(let s=r?e.childNodes[r]:e.firstChild,a=i==null?null:e.childNodes[i];s!=a;s=s.nextSibling,++o)this.findAtPoint(e,o),this.addDOM(s,n);this.findAtPoint(e,o)}findPlace(e,n,r){let i,o;for(let s=this.open,a=0;s>=0;s--){let l=this.nodes[s],c=l.findWrapping(e);if(c&&(!i||i.length>c.length+a)&&(i=c,o=l,!c.length))break;if(l.solid){if(r)break;a+=2}}if(!i)return null;this.sync(o);for(let s=0;s<i.length;s++)n=this.enterInner(i[s],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let o=this.textblockFromContext();o&&(n=this.enterInner(o,null,n))}let i=this.findPlace(e,n,r);if(i){this.closeExtra();let o=this.top;o.match&&(o.match=o.match.matchType(e.type));let s=xn.none;for(let a of i.concat(e.marks))(o.type?o.type.allowsMarkType(a.type):Z4(a.type,e.type))&&(s=a.addToSet(s));return o.content.push(e.mark(s)),!0}return!1}enter(e,n,r,i){let o=this.findPlace(e.create(n),r,!1);return o&&(o=this.enterInner(e,n,r,!0,i)),o}enterInner(e,n,r,i=!1,o){this.closeExtra();let s=this.top;s.match=s.match&&s.match.matchType(e);let a=G4(e,o,s.options);s.options&jm&&s.content.length==0&&(a|=jm);let l=xn.none;return r=r.filter(c=>(s.type?s.type.allowsMarkType(c.type):Z4(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new Wx(e,n,l,i,null,a)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=sy)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let i=r.length-1;i>=0;i--)e+=r[i].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let i=0;i<this.find.length;i++)this.find[i].pos==null&&e.nodeType==1&&e.contains(this.find[i].node)&&n.compareDocumentPosition(this.find[i].node)&(r?2:4)&&(this.find[i].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,i=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),o=-(r?r.depth+1:0)+(i?0:1),s=(a,l)=>{for(;a>=0;a--){let c=n[a];if(c==""){if(a==n.length-1||a==0)continue;for(;l>=o;l--)if(s(a-1,l))return!0;return!1}else{let d=l>0||l==0&&i?this.nodes[l].type:r&&l>=o?r.node(l-o).type:null;if(!d||d.name!=c&&!d.isInGroup(c))return!1;l--}}return!0};return s(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function Bme(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&wW.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function Ume(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function X4(t){let e={};for(let n in t)e[n]=t[n];return e}function Z4(t,e){let n=e.schema.nodes;for(let r in n){let i=n[r];if(!i.allowsMarkType(t))continue;let o=[],s=a=>{o.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:d}=a.edge(l);if(c==e||o.indexOf(d)<0&&s(d))return!0}};if(s(i.contentMatch))return!0}}class Ph{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=QC(n).createDocumentFragment());let i=r,o=[];return e.forEach(s=>{if(o.length||s.marks.length){let a=0,l=0;for(;a<o.length&&l<s.marks.length;){let c=s.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(o[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<o.length;)i=o.pop()[1];for(;l<s.marks.length;){let c=s.marks[l++],d=this.serializeMark(c,s.isInline,n);d&&(o.push([c,i]),i.appendChild(d.dom),i=d.contentDOM||d.dom)}}i.appendChild(this.serializeNodeInner(s,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:i}=FS(QC(n),this.nodes[e.type.name](e),null,e.attrs);if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,i)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let i=e.marks.length-1;i>=0;i--){let o=this.serializeMark(e.marks[i],e.isInline,n);o&&((o.contentDOM||o.dom).appendChild(r),r=o.dom)}return r}serializeMark(e,n,r={}){let i=this.marks[e.type.name];return i&&FS(QC(r),i(e,n),null,e.attrs)}static renderSpec(e,n,r=null,i){return FS(e,n,r,i)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new Ph(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=J4(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return J4(e.marks)}}function J4(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function QC(t){return t.document||window.document}const Q4=new WeakMap;function Hme(t){let e=Q4.get(t);return e===void 0&&Q4.set(t,e=Wme(t)),e}function Wme(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let i=0;i<r.length;i++)n(r[i]);else for(let i in r)n(r[i])}return n(t),e}function FS(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let i=e[0],o;if(typeof i!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(o=Hme(r))&&o.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let s=i.indexOf(" ");s>0&&(n=i.slice(0,s),i=i.slice(s+1));let a,l=n?t.createElementNS(n,i):t.createElement(i),c=e[1],d=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){d=2;for(let u in c)if(c[u]!=null){let p=u.indexOf(" ");p>0?l.setAttributeNS(u.slice(0,p),u.slice(p+1),c[u]):u=="style"&&l.style?l.style.cssText=c[u]:l.setAttribute(u,c[u])}}for(let u=d;u<e.length;u++){let p=e[u];if(p===0){if(u<e.length-1||u>d)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:f,contentDOM:y}=FS(t,p,n,r);if(l.appendChild(f),y){if(a)throw new RangeError("Multiple content holes");a=y}}}return{dom:l,contentDOM:a}}const kW=65535,IW=Math.pow(2,16);function Vme(t,e){return t+e*IW}function eF(t){return t&kW}function Kme(t){return(t-(t&kW))/IW}const _W=1,CW=2,BS=4,PW=8;class FT{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&PW)>0}get deletedBefore(){return(this.delInfo&(_W|BS))>0}get deletedAfter(){return(this.delInfo&(CW|BS))>0}get deletedAcross(){return(this.delInfo&BS)>0}}class ms{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&ms.empty)return ms.empty}recover(e){let n=0,r=eF(e);if(!this.inverted)for(let i=0;i<r;i++)n+=this.ranges[i*3+2]-this.ranges[i*3+1];return this.ranges[r*3]+n+Kme(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let i=0,o=this.inverted?2:1,s=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?i:0);if(l>e)break;let c=this.ranges[a+o],d=this.ranges[a+s],u=l+c;if(e<=u){let p=c?e==l?-1:e==u?1:n:n,f=l+i+(p<0?0:d);if(r)return f;let y=e==(n<0?l:u)?null:Vme(a/3,e-l),v=e==l?CW:e==u?_W:BS;return(n<0?e!=l:e!=u)&&(v|=PW),new FT(f,v,y)}i+=d-c}return r?e+i:new FT(e+i,0,null)}touches(e,n){let r=0,i=eF(n),o=this.inverted?2:1,s=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let c=this.ranges[a+o],d=l+c;if(e<=d&&a==i*3)return!0;r+=this.ranges[a+s]-c}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let i=0,o=0;i<this.ranges.length;i+=3){let s=this.ranges[i],a=s-(this.inverted?o:0),l=s+(this.inverted?0:o),c=this.ranges[i+n],d=this.ranges[i+r];e(a,a+c,l,l+d),o+=d-c}}invert(){return new ms(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?ms.empty:new ms(e<0?[0,-e,0]:[0,0,e])}}ms.empty=new ms([]);class ay{constructor(e,n,r=0,i=e?e.length:0){this.mirror=n,this.from=r,this.to=i,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new ay(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,r=this._maps.length;n<e._maps.length;n++){let i=e.getMirror(n);this.appendMap(e._maps[n],i!=null&&i<n?r+i:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this._maps.length+e._maps.length;n>=0;n--){let i=e.getMirror(n);this.appendMap(e._maps[n].invert(),i!=null&&i>n?r-i-1:void 0)}}invert(){let e=new ay;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let i=0;for(let o=this.from;o<this.to;o++){let s=this._maps[o],a=s.mapResult(e,n);if(a.recover!=null){let l=this.getMirror(o);if(l!=null&&l>o&&l<this.to){o=l,e=this._maps[l].recover(a.recover);continue}}i|=a.delInfo,e=a.pos}return r?e:new FT(e,i,null)}}const eP=Object.create(null);class Zi{getMap(){return ms.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=eP[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in eP)throw new RangeError("Duplicate use of step JSON ID "+e);return eP[e]=n,n.prototype.jsonID=e,n}}class jr{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new jr(e,null)}static fail(e){return new jr(null,e)}static fromReplace(e,n,r,i){try{return jr.ok(e.replace(n,r,i))}catch(o){if(o instanceof wb)return jr.fail(o.message);throw o}}}function vA(t,e,n){let r=[];for(let i=0;i<t.childCount;i++){let o=t.child(i);o.content.size&&(o=o.copy(vA(o.content,e,o))),o.isInline&&(o=e(o,n,i)),r.push(o)}return Pe.fromArray(r)}class Su extends Zi{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),i=r.node(r.sharedDepth(this.to)),o=new He(vA(n.content,(s,a)=>!s.isAtom||!a.type.allowsMarkType(this.mark.type)?s:s.mark(this.mark.addToSet(s.marks)),i),n.openStart,n.openEnd);return jr.fromReplace(e,this.from,this.to,o)}invert(){return new xl(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Su(n.pos,r.pos,this.mark)}merge(e){return e instanceof Su&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Su(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Su(n.from,n.to,e.markFromJSON(n.mark))}}Zi.jsonID("addMark",Su);class xl extends Zi{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new He(vA(n.content,i=>i.mark(this.mark.removeFromSet(i.marks)),e),n.openStart,n.openEnd);return jr.fromReplace(e,this.from,this.to,r)}invert(){return new Su(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new xl(n.pos,r.pos,this.mark)}merge(e){return e instanceof xl&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new xl(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new xl(n.from,n.to,e.markFromJSON(n.mark))}}Zi.jsonID("removeMark",xl);class bu extends Zi{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return jr.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return jr.fromReplace(e,this.pos,this.pos+1,new He(Pe.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let i=0;i<n.marks.length;i++)if(!n.marks[i].isInSet(r))return new bu(this.pos,n.marks[i]);return new bu(this.pos,this.mark)}}return new ih(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new bu(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new bu(n.pos,e.markFromJSON(n.mark))}}Zi.jsonID("addNodeMark",bu);class ih extends Zi{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return jr.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return jr.fromReplace(e,this.pos,this.pos+1,new He(Pe.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new bu(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new ih(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new ih(n.pos,e.markFromJSON(n.mark))}}Zi.jsonID("removeNodeMark",ih);class Xr extends Zi{constructor(e,n,r,i=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=i}apply(e){return this.structure&&BT(e,this.from,this.to)?jr.fail("Structure replace would overwrite content"):jr.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new ms([this.from,this.to-this.from,this.slice.size])}invert(e){return new Xr(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new Xr(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof Xr)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?He.empty:new He(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Xr(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?He.empty:new He(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Xr(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Xr(n.from,n.to,He.fromJSON(e,n.slice),!!n.structure)}}Zi.jsonID("replace",Xr);class ei extends Zi{constructor(e,n,r,i,o,s,a=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=i,this.slice=o,this.insert=s,this.structure=a}apply(e){if(this.structure&&(BT(e,this.from,this.gapFrom)||BT(e,this.gapTo,this.to)))return jr.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return jr.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?jr.fromReplace(e,this.from,this.to,r):jr.fail("Content does not fit in gap")}getMap(){return new ms([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new ei(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),i=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),o=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||i<n.pos||o>r.pos?null:new ei(n.pos,r.pos,i,o,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ei(n.from,n.to,n.gapFrom,n.gapTo,He.fromJSON(e,n.slice),n.insert,!!n.structure)}}Zi.jsonID("replaceAround",ei);function BT(t,e,n){let r=t.resolve(e),i=n-e,o=r.depth;for(;i>0&&o>0&&r.indexAfter(o)==r.node(o).childCount;)o--,i--;if(i>0){let s=r.node(o).maybeChild(r.indexAfter(o));for(;i>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,i--}}return!1}function qme(t,e,n,r){let i=[],o=[],s,a;t.doc.nodesBetween(e,n,(l,c,d)=>{if(!l.isInline)return;let u=l.marks;if(!r.isInSet(u)&&d.type.allowsMarkType(r.type)){let p=Math.max(c,e),f=Math.min(c+l.nodeSize,n),y=r.addToSet(u);for(let v=0;v<u.length;v++)u[v].isInSet(y)||(s&&s.to==p&&s.mark.eq(u[v])?s.to=f:i.push(s=new xl(p,f,u[v])));a&&a.to==p?a.to=f:o.push(a=new Su(p,f,r))}}),i.forEach(l=>t.step(l)),o.forEach(l=>t.step(l))}function Gme(t,e,n,r){let i=[],o=0;t.doc.nodesBetween(e,n,(s,a)=>{if(!s.isInline)return;o++;let l=null;if(r instanceof v0){let c=s.marks,d;for(;d=r.isInSet(c);)(l||(l=[])).push(d),c=d.removeFromSet(c)}else r?r.isInSet(s.marks)&&(l=[r]):l=s.marks;if(l&&l.length){let c=Math.min(a+s.nodeSize,n);for(let d=0;d<l.length;d++){let u=l[d],p;for(let f=0;f<i.length;f++){let y=i[f];y.step==o-1&&u.eq(i[f].style)&&(p=y)}p?(p.to=c,p.step=o):i.push({style:u,from:Math.max(a,e),to:c,step:o})}}}),i.forEach(s=>t.step(new xl(s.from,s.to,s.style)))}function xA(t,e,n,r=n.contentMatch,i=!0){let o=t.doc.nodeAt(e),s=[],a=e+1;for(let l=0;l<o.childCount;l++){let c=o.child(l),d=a+c.nodeSize,u=r.matchType(c.type);if(!u)s.push(new Xr(a,d,He.empty));else{r=u;for(let p=0;p<c.marks.length;p++)n.allowsMarkType(c.marks[p].type)||t.step(new xl(a,d,c.marks[p]));if(i&&c.isText&&n.whitespace!="pre"){let p,f=/\r?\n|\r/g,y;for(;p=f.exec(c.text);)y||(y=new He(Pe.from(n.schema.text(" ",n.allowedMarks(c.marks))),0,0)),s.push(new Xr(a+p.index,a+p.index+p[0].length,y))}}a=d}if(!r.validEnd){let l=r.fillBefore(Pe.empty,!0);t.replace(a,a,new He(l,0,0))}for(let l=s.length-1;l>=0;l--)t.step(s[l])}function Yme(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function $f(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth;;--r){let i=t.$from.node(r),o=t.$from.index(r),s=t.$to.indexAfter(r);if(r<t.depth&&i.canReplace(o,s,n))return r;if(r==0||i.type.spec.isolating||!Yme(i,o,s))break}return null}function Xme(t,e,n){let{$from:r,$to:i,depth:o}=e,s=r.before(o+1),a=i.after(o+1),l=s,c=a,d=Pe.empty,u=0;for(let y=o,v=!1;y>n;y--)v||r.index(y)>0?(v=!0,d=Pe.from(r.node(y).copy(d)),u++):l--;let p=Pe.empty,f=0;for(let y=o,v=!1;y>n;y--)v||i.after(y+1)<i.end(y)?(v=!0,p=Pe.from(i.node(y).copy(p)),f++):c++;t.step(new ei(l,c,s,a,new He(d.append(p),u,f),d.size-u,!0))}function SA(t,e,n=null,r=t){let i=Zme(t,e),o=i&&Jme(r,e);return o?i.map(tF).concat({type:e,attrs:n}).concat(o.map(tF)):null}function tF(t){return{type:t,attrs:null}}function Zme(t,e){let{parent:n,startIndex:r,endIndex:i}=t,o=n.contentMatchAt(r).findWrapping(e);if(!o)return null;let s=o.length?o[0]:e;return n.canReplaceWith(r,i,s)?o:null}function Jme(t,e){let{parent:n,startIndex:r,endIndex:i}=t,o=n.child(r),s=e.contentMatch.findWrapping(o.type);if(!s)return null;let l=(s.length?s[s.length-1]:e).contentMatch;for(let c=r;l&&c<i;c++)l=l.matchType(n.child(c).type);return!l||!l.validEnd?null:s}function Qme(t,e,n){let r=Pe.empty;for(let s=n.length-1;s>=0;s--){if(r.size){let a=n[s].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=Pe.from(n[s].type.create(n[s].attrs,r))}let i=e.start,o=e.end;t.step(new ei(i,o,i,o,new He(r,0,0),n.length,!0))}function eye(t,e,n,r,i){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let o=t.steps.length;t.doc.nodesBetween(e,n,(s,a)=>{let l=typeof i=="function"?i(s):i;if(s.isTextblock&&!s.hasMarkup(r,l)&&tye(t.doc,t.mapping.slice(o).map(a),r)){let c=null;if(r.schema.linebreakReplacement){let f=r.whitespace=="pre",y=!!r.contentMatch.matchType(r.schema.linebreakReplacement);f&&!y?c=!1:!f&&y&&(c=!0)}c===!1&&EW(t,s,a,o),xA(t,t.mapping.slice(o).map(a,1),r,void 0,c===null);let d=t.mapping.slice(o),u=d.map(a,1),p=d.map(a+s.nodeSize,1);return t.step(new ei(u,p,u+1,p-1,new He(Pe.from(r.create(l,null,s.marks)),0,0),1,!0)),c===!0&&TW(t,s,a,o),!1}})}function TW(t,e,n,r){e.forEach((i,o)=>{if(i.isText){let s,a=/\r?\n|\r/g;for(;s=a.exec(i.text);){let l=t.mapping.slice(r).map(n+1+o+s.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function EW(t,e,n,r){e.forEach((i,o)=>{if(i.type==i.type.schema.linebreakReplacement){let s=t.mapping.slice(r).map(n+1+o);t.replaceWith(s,s+1,e.type.schema.text(`
`))}})}function tye(t,e,n){let r=t.resolve(e),i=r.index();return r.parent.canReplaceWith(i,i+1,n)}function nye(t,e,n,r,i){let o=t.doc.nodeAt(e);if(!o)throw new RangeError("No node at given position");n||(n=o.type);let s=n.create(r,null,i||o.marks);if(o.isLeaf)return t.replaceWith(e,e+o.nodeSize,s);if(!n.validContent(o.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new ei(e,e+o.nodeSize,e+1,e+o.nodeSize-1,new He(Pe.from(s),0,0),1,!0))}function pc(t,e,n=1,r){let i=t.resolve(e),o=i.depth-n,s=r&&r[r.length-1]||i.parent;if(o<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!s.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,d=n-2;c>o;c--,d--){let u=i.node(c),p=i.index(c);if(u.type.spec.isolating)return!1;let f=u.content.cutByIndex(p,u.childCount),y=r&&r[d+1];y&&(f=f.replaceChild(0,y.type.create(y.attrs)));let v=r&&r[d]||u;if(!u.canReplace(p+1,u.childCount)||!v.type.validContent(f))return!1}let a=i.indexAfter(o),l=r&&r[0];return i.node(o).canReplaceWith(a,a,l?l.type:i.node(o+1).type)}function rye(t,e,n=1,r){let i=t.doc.resolve(e),o=Pe.empty,s=Pe.empty;for(let a=i.depth,l=i.depth-n,c=n-1;a>l;a--,c--){o=Pe.from(i.node(a).copy(o));let d=r&&r[c];s=Pe.from(d?d.type.create(d.attrs,s):i.node(a).copy(s))}t.step(new Xr(e,e,new He(o.append(s),n,n),!0))}function Xu(t,e){let n=t.resolve(e),r=n.index();return AW(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function iye(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let i=0;i<e.childCount;i++){let o=e.child(i),s=o.type==r?t.type.schema.nodes.text:o.type;if(n=n.matchType(s),!n||!t.type.allowsMarks(o.marks))return!1}return n.validEnd}function AW(t,e){return!!(t&&e&&!t.isLeaf&&iye(t,e))}function x0(t,e,n=-1){let r=t.resolve(e);for(let i=r.depth;;i--){let o,s,a=r.index(i);if(i==r.depth?(o=r.nodeBefore,s=r.nodeAfter):n>0?(o=r.node(i+1),a++,s=r.node(i).maybeChild(a)):(o=r.node(i).maybeChild(a-1),s=r.node(i+1)),o&&!o.isTextblock&&AW(o,s)&&r.node(i).canReplace(a,a+1))return e;if(i==0)break;e=n<0?r.before(i):r.after(i)}}function oye(t,e,n){let r=null,{linebreakReplacement:i}=t.doc.type.schema,o=t.doc.resolve(e-n),s=o.node().type;if(i&&s.inlineContent){let d=s.whitespace=="pre",u=!!s.contentMatch.matchType(i);d&&!u?r=!1:!d&&u&&(r=!0)}let a=t.steps.length;if(r===!1){let d=t.doc.resolve(e+n);EW(t,d.node(),d.before(),a)}s.inlineContent&&xA(t,e+n-1,s,o.node().contentMatchAt(o.index()),r==null);let l=t.mapping.slice(a),c=l.map(e-n);if(t.step(new Xr(c,l.map(e+n,-1),He.empty,!0)),r===!0){let d=t.doc.resolve(c);TW(t,d.node(),d.before(),t.steps.length)}return t}function sye(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let i=r.depth-1;i>=0;i--){let o=r.index(i);if(r.node(i).canReplaceWith(o,o,n))return r.before(i+1);if(o>0)return null}if(r.parentOffset==r.parent.content.size)for(let i=r.depth-1;i>=0;i--){let o=r.indexAfter(i);if(r.node(i).canReplaceWith(o,o,n))return r.after(i+1);if(o<r.node(i).childCount)return null}return null}function MW(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let i=n.content;for(let o=0;o<n.openStart;o++)i=i.firstChild.content;for(let o=1;o<=(n.openStart==0&&n.size?2:1);o++)for(let s=r.depth;s>=0;s--){let a=s==r.depth?0:r.pos<=(r.start(s+1)+r.end(s+1))/2?-1:1,l=r.index(s)+(a>0?1:0),c=r.node(s),d=!1;if(o==1)d=c.canReplace(l,l,i);else{let u=c.contentMatchAt(l).findWrapping(i.firstChild.type);d=u&&c.canReplaceWith(l,l,u[0])}if(d)return a==0?r.pos:a<0?r.before(s+1):r.after(s+1)}return null}function S0(t,e,n=e,r=He.empty){if(e==n&&!r.size)return null;let i=t.resolve(e),o=t.resolve(n);return OW(i,o,r)?new Xr(e,n,r):new aye(i,o,r).fit()}function OW(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class aye{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=Pe.empty;for(let i=0;i<=e.depth;i++){let o=e.node(i);this.frontier.push({type:o.type,match:o.contentMatchAt(e.indexAfter(i))})}for(let i=e.depth;i>0;i--)this.placed=Pe.from(e.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,i=this.close(e<0?this.$to:r.doc.resolve(e));if(!i)return null;let o=this.placed,s=r.depth,a=i.depth;for(;s&&a&&o.childCount==1;)o=o.firstChild.content,s--,a--;let l=new He(o,s,a);return e>-1?new ei(r.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||r.pos!=this.$to.pos?new Xr(r.pos,i.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,i=this.unplaced.openEnd;r<e;r++){let o=n.firstChild;if(n.childCount>1&&(i=0),o.type.spec.isolating&&i<=r){e=r;break}n=o.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let i,o=null;r?(o=tP(this.unplaced.content,r-1).firstChild,i=o.content):i=this.unplaced.content;let s=i.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],d,u=null;if(n==1&&(s?c.matchType(s.type)||(u=c.fillBefore(Pe.from(s),!1)):o&&l.compatibleContent(o.type)))return{sliceDepth:r,frontierDepth:a,parent:o,inject:u};if(n==2&&s&&(d=c.findWrapping(s.type)))return{sliceDepth:r,frontierDepth:a,parent:o,wrap:d};if(o&&c.matchType(o.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,i=tP(e,n);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new He(e,n+1,Math.max(r,i.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,i=tP(e,n);if(i.childCount<=1&&n>0){let o=e.size-n<=n+i.size;this.unplaced=new He(um(e,n-1,1),n-1,o?n-1:r)}else this.unplaced=new He(um(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:i,wrap:o}){for(;this.depth>n;)this.closeFrontierNode();if(o)for(let v=0;v<o.length;v++)this.openFrontierNode(o[v]);let s=this.unplaced,a=r?r.content:s.content,l=s.openStart-e,c=0,d=[],{match:u,type:p}=this.frontier[n];if(i){for(let v=0;v<i.childCount;v++)d.push(i.child(v));u=u.matchFragment(i)}let f=a.size+e-(s.content.size-s.openEnd);for(;c<a.childCount;){let v=a.child(c),x=u.matchType(v.type);if(!x)break;c++,(c>1||l==0||v.content.size)&&(u=x,d.push(DW(v.mark(p.allowedMarks(v.marks)),c==1?l:0,c==a.childCount?f:-1)))}let y=c==a.childCount;y||(f=-1),this.placed=dm(this.placed,n,Pe.from(d)),this.frontier[n].match=u,y&&f<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let v=0,x=a;v<f;v++){let b=x.lastChild;this.frontier.push({type:b.type,match:b.contentMatchAt(b.childCount)}),x=b.content}this.unplaced=y?e==0?He.empty:new He(um(s.content,e-1,1),e-1,f<0?s.openEnd:e-1):new He(um(s.content,e,c),s.openStart,s.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!nP(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,i=this.$to.after(r);for(;r>1&&i==this.$to.end(--r);)++i;return i}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:i}=this.frontier[n],o=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),s=nP(e,n,i,r,o);if(s){for(let a=n-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],d=nP(e,a,c,l,!0);if(!d||d.childCount)continue e}return{depth:n,fit:s,move:o?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=dm(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let i=e.node(r),o=i.type.contentMatch.fillBefore(i.content,!0,e.index(r));this.openFrontierNode(i.type,i.attrs,o)}return e}openFrontierNode(e,n=null,r){let i=this.frontier[this.depth];i.match=i.match.matchType(e),this.placed=dm(this.placed,this.depth,Pe.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(Pe.empty,!0);n.childCount&&(this.placed=dm(this.placed,this.frontier.length,n))}}function um(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(um(t.firstChild.content,e-1,n)))}function dm(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(dm(t.lastChild.content,e-1,n)))}function tP(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function DW(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,DW(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(Pe.empty,!0)))),t.copy(r)}function nP(t,e,n,r,i){let o=t.node(e),s=i?t.indexAfter(e):t.index(e);if(s==o.childCount&&!n.compatibleContent(o.type))return null;let a=r.fillBefore(o.content,!0,s);return a&&!lye(n,o.content,s)?a:null}function lye(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function cye(t){return t.spec.defining||t.spec.definingForContent}function uye(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let i=t.doc.resolve(e),o=t.doc.resolve(n);if(OW(i,o,r))return t.step(new Xr(e,n,r));let s=RW(i,t.doc.resolve(n));s[s.length-1]==0&&s.pop();let a=-(i.depth+1);s.unshift(a);for(let p=i.depth,f=i.pos-1;p>0;p--,f--){let y=i.node(p).type.spec;if(y.defining||y.definingAsContext||y.isolating)break;s.indexOf(p)>-1?a=p:i.before(p)==f&&s.splice(1,0,-p)}let l=s.indexOf(a),c=[],d=r.openStart;for(let p=r.content,f=0;;f++){let y=p.firstChild;if(c.push(y),f==r.openStart)break;p=y.content}for(let p=d-1;p>=0;p--){let f=c[p],y=cye(f.type);if(y&&!f.sameMarkup(i.node(Math.abs(a)-1)))d=p;else if(y||!f.type.isTextblock)break}for(let p=r.openStart;p>=0;p--){let f=(p+d+1)%(r.openStart+1),y=c[f];if(y)for(let v=0;v<s.length;v++){let x=s[(v+l)%s.length],b=!0;x<0&&(b=!1,x=-x);let w=i.node(x-1),_=i.index(x-1);if(w.canReplaceWith(_,_,y.type,y.marks))return t.replace(i.before(x),b?o.after(x):n,new He(jW(r.content,0,r.openStart,f),f,r.openEnd))}}let u=t.steps.length;for(let p=s.length-1;p>=0&&(t.replace(e,n,r),!(t.steps.length>u));p--){let f=s[p];f<0||(e=i.before(f),n=o.after(f))}}function jW(t,e,n,r,i){if(e<n){let o=t.firstChild;t=t.replaceChild(0,o.copy(jW(o.content,e+1,n,r,o)))}if(e>r){let o=i.contentMatchAt(0),s=o.fillBefore(t).append(t);t=s.append(o.matchFragment(s).fillBefore(Pe.empty,!0))}return t}function dye(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let i=sye(t.doc,e,r.type);i!=null&&(e=n=i)}t.replaceRange(e,n,new He(Pe.from(r),0,0))}function hye(t,e,n){let r=t.doc.resolve(e),i=t.doc.resolve(n),o=RW(r,i);for(let s=0;s<o.length;s++){let a=o[s],l=s==o.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return t.delete(r.start(a),i.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),i.indexAfter(a-1))))return t.delete(r.before(a),i.after(a))}for(let s=1;s<=r.depth&&s<=i.depth;s++)if(e-r.start(s)==r.depth-s&&n>r.end(s)&&i.end(s)-n!=i.depth-s&&r.start(s-1)==i.start(s-1)&&r.node(s-1).canReplace(r.index(s-1),i.index(s-1)))return t.delete(r.before(s),n);t.delete(e,n)}function RW(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let i=r;i>=0;i--){let o=t.start(i);if(o<t.pos-(t.depth-i)||e.end(i)>e.pos+(e.depth-i)||t.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(o==e.start(i)||i==t.depth&&i==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==o-1)&&n.push(i)}return n}class Yp extends Zi{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return jr.fail("No node at attribute step's position");let r=Object.create(null);for(let o in n.attrs)r[o]=n.attrs[o];r[this.attr]=this.value;let i=n.type.create(r,null,n.marks);return jr.fromReplace(e,this.pos,this.pos+1,new He(Pe.from(i),0,n.isLeaf?0:1))}getMap(){return ms.empty}invert(e){return new Yp(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Yp(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new Yp(n.pos,n.attr,n.value)}}Zi.jsonID("attr",Yp);class ly extends Zi{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let i in e.attrs)n[i]=e.attrs[i];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return jr.ok(r)}getMap(){return ms.empty}invert(e){return new ly(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new ly(n.attr,n.value)}}Zi.jsonID("docAttr",ly);let df=class extends Error{};df=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};df.prototype=Object.create(Error.prototype);df.prototype.constructor=df;df.prototype.name="TransformError";class $W{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new ay}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new df(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=He.empty){let i=S0(this.doc,e,n,r);return i&&this.step(i),this}replaceWith(e,n,r){return this.replace(e,n,new He(Pe.from(r),0,0))}delete(e,n){return this.replace(e,n,He.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return uye(this,e,n,r),this}replaceRangeWith(e,n,r){return dye(this,e,n,r),this}deleteRange(e,n){return hye(this,e,n),this}lift(e,n){return Xme(this,e,n),this}join(e,n=1){return oye(this,e,n),this}wrap(e,n){return Qme(this,e,n),this}setBlockType(e,n=e,r,i=null){return eye(this,e,n,r,i),this}setNodeMarkup(e,n,r=null,i){return nye(this,e,n,r,i),this}setNodeAttribute(e,n,r){return this.step(new Yp(e,n,r)),this}setDocAttribute(e,n){return this.step(new ly(e,n)),this}addNodeMark(e,n){return this.step(new bu(e,n)),this}removeNodeMark(e,n){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n instanceof xn)n.isInSet(r.marks)&&this.step(new ih(e,n));else{let i=r.marks,o,s=[];for(;o=n.isInSet(i);)s.push(new ih(e,o)),i=o.removeFromSet(i);for(let a=s.length-1;a>=0;a--)this.step(s[a])}return this}split(e,n=1,r){return rye(this,e,n,r),this}addMark(e,n,r){return qme(this,e,n,r),this}removeMark(e,n,r){return Gme(this,e,n,r),this}clearIncompatible(e,n,r){return xA(this,e,n,r),this}}const rP=Object.create(null);class Mt{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new pye(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=He.empty){let r=n.content.lastChild,i=null;for(let a=0;a<n.openEnd;a++)i=r,r=r.lastChild;let o=e.steps.length,s=this.ranges;for(let a=0;a<s.length;a++){let{$from:l,$to:c}=s[a],d=e.mapping.slice(o);e.replaceRange(d.map(l.pos),d.map(c.pos),a?He.empty:n),a==0&&iF(e,o,(r?r.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,i=this.ranges;for(let o=0;o<i.length;o++){let{$from:s,$to:a}=i[o],l=e.mapping.slice(r),c=l.map(s.pos),d=l.map(a.pos);o?e.deleteRange(c,d):(e.replaceRangeWith(c,d,n),iF(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let i=e.parent.inlineContent?new wt(e):Ap(e.node(0),e.parent,e.pos,e.index(),n,r);if(i)return i;for(let o=e.depth-1;o>=0;o--){let s=n<0?Ap(e.node(0),e.node(o),e.before(o+1),e.index(o),n,r):Ap(e.node(0),e.node(o),e.after(o+1),e.index(o)+1,n,r);if(s)return s}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new Is(e.node(0))}static atStart(e){return Ap(e,e,0,0,1)||new Is(e)}static atEnd(e){return Ap(e,e,e.content.size,e.childCount,-1)||new Is(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=rP[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in rP)throw new RangeError("Duplicate use of selection JSON ID "+e);return rP[e]=n,n.prototype.jsonID=e,n}getBookmark(){return wt.between(this.$anchor,this.$head).getBookmark()}}Mt.prototype.visible=!0;class pye{constructor(e,n){this.$from=e,this.$to=n}}let nF=!1;function rF(t){!nF&&!t.parent.inlineContent&&(nF=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class wt extends Mt{constructor(e,n=e){rF(e),rF(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return Mt.near(r);let i=e.resolve(n.map(this.anchor));return new wt(i.parent.inlineContent?i:r,r)}replace(e,n=He.empty){if(super.replace(e,n),n==He.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof wt&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new b0(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new wt(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let i=e.resolve(n);return new this(i,r==n?i:e.resolve(r))}static between(e,n,r){let i=e.pos-n.pos;if((!r||i)&&(r=i>=0?1:-1),!n.parent.inlineContent){let o=Mt.findFrom(n,r,!0)||Mt.findFrom(n,-r,!0);if(o)n=o.$head;else return Mt.near(n,r)}return e.parent.inlineContent||(i==0?e=n:(e=(Mt.findFrom(e,-r,!0)||Mt.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=i<0&&(e=n))),new wt(e,n)}}Mt.jsonID("text",wt);class b0{constructor(e,n){this.anchor=e,this.head=n}map(e){return new b0(e.map(this.anchor),e.map(this.head))}resolve(e){return wt.between(e.resolve(this.anchor),e.resolve(this.head))}}class ot extends Mt{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:i}=n.mapResult(this.anchor),o=e.resolve(i);return r?Mt.near(o):new ot(o)}content(){return new He(Pe.from(this.node),0,0)}eq(e){return e instanceof ot&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new bA(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new ot(e.resolve(n.anchor))}static create(e,n){return new ot(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}ot.prototype.visible=!1;Mt.jsonID("node",ot);class bA{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new b0(r,r):new bA(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&ot.isSelectable(r)?new ot(n):Mt.near(n)}}class Is extends Mt{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=He.empty){if(n==He.empty){e.delete(0,e.doc.content.size);let r=Mt.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new Is(e)}map(e){return new Is(e)}eq(e){return e instanceof Is}getBookmark(){return fye}}Mt.jsonID("all",Is);const fye={map(){return this},resolve(t){return new Is(t)}};function Ap(t,e,n,r,i,o=!1){if(e.inlineContent)return wt.create(t,n);for(let s=r-(i>0?0:1);i>0?s<e.childCount:s>=0;s+=i){let a=e.child(s);if(a.isAtom){if(!o&&ot.isSelectable(a))return ot.create(t,n-(i<0?a.nodeSize:0))}else{let l=Ap(t,a,n+i,i<0?a.childCount:0,i,o);if(l)return l}n+=a.nodeSize*i}return null}function iF(t,e,n){let r=t.steps.length-1;if(r<e)return;let i=t.steps[r];if(!(i instanceof Xr||i instanceof ei))return;let o=t.mapping.maps[r],s;o.forEach((a,l,c,d)=>{s==null&&(s=d)}),t.setSelection(Mt.near(t.doc.resolve(s),n))}const oF=1,Vx=2,sF=4;class gye extends $W{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|oF)&~Vx,this.storedMarks=null,this}get selectionSet(){return(this.updated&oF)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Vx,this}ensureMarks(e){return xn.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Vx)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~Vx,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||xn.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let i=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(i.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),r=r??n,!e)return this.deleteRange(n,r);let o=this.storedMarks;if(!o){let s=this.doc.resolve(n);o=r==n?s.marks():s.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,i.text(e,o)),this.selection.empty||this.setSelection(Mt.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=sF,this}get scrolledIntoView(){return(this.updated&sF)>0}}function aF(t,e){return!e||!t?t:t.bind(e)}class hm{constructor(e,n,r){this.name=e,this.init=aF(n.init,r),this.apply=aF(n.apply,r)}}const mye=[new hm("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new hm("selection",{init(t,e){return t.selection||Mt.atStart(e.doc)},apply(t){return t.selection}}),new hm("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new hm("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class iP{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=mye.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new hm(r.key,r.spec.state,r))})}}class zp{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let i=this.config.plugins[r];if(i.spec.filterTransaction&&!i.spec.filterTransaction.call(i,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),i=null;for(;;){let o=!1;for(let s=0;s<this.config.plugins.length;s++){let a=this.config.plugins[s];if(a.spec.appendTransaction){let l=i?i[s].n:0,c=i?i[s].state:this,d=l<n.length&&a.spec.appendTransaction.call(a,l?n.slice(l):n,c,r);if(d&&r.filterTransaction(d,s)){if(d.setMeta("appendedTransaction",e),!i){i=[];for(let u=0;u<this.config.plugins.length;u++)i.push(u<s?{state:r,n:n.length}:{state:this,n:0})}n.push(d),r=r.applyInner(d),o=!0}i&&(i[s]={state:r,n:n.length})}}if(!o)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new zp(this.config),r=this.config.fields;for(let i=0;i<r.length;i++){let o=r[i];n[o.name]=o.apply(e,this[o.name],this,n)}return n}get tr(){return new gye(this)}static create(e){let n=new iP(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new zp(n);for(let i=0;i<n.fields.length;i++)r[n.fields[i].name]=n.fields[i].init(e,r);return r}reconfigure(e){let n=new iP(this.schema,e.plugins),r=n.fields,i=new zp(n);for(let o=0;o<r.length;o++){let s=r[o].name;i[s]=this.hasOwnProperty(s)?this[s]:r[o].init(e,i)}return i}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let i=e[r],o=i.spec.state;o&&o.toJSON&&(n[r]=o.toJSON.call(i,this[i.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let i=new iP(e.schema,e.plugins),o=new zp(i);return i.fields.forEach(s=>{if(s.name=="doc")o.doc=Fa.fromJSON(e.schema,n.doc);else if(s.name=="selection")o.selection=Mt.fromJSON(o.doc,n.selection);else if(s.name=="storedMarks")n.storedMarks&&(o.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],c=l.spec.state;if(l.key==s.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(n,a)){o[s.name]=c.fromJSON.call(l,e,n[a],o);return}}o[s.name]=s.init(e,o)}}),o}}function NW(t,e,n){for(let r in t){let i=t[r];i instanceof Function?i=i.bind(e):r=="handleDOMEvents"&&(i=NW(i,e,{})),n[r]=i}return n}class _i{constructor(e){this.spec=e,this.props={},e.props&&NW(e.props,this,this.props),this.key=e.key?e.key.key:LW("plugin")}getState(e){return e[this.key]}}const oP=Object.create(null);function LW(t){return t in oP?t+"$"+ ++oP[t]:(oP[t]=0,t+"$")}class As{constructor(e="key"){this.key=LW(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const yi=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},hf=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let UT=null;const ac=function(t,e,n){let r=UT||(UT=document.createRange());return r.setEnd(t,n??t.nodeValue.length),r.setStart(t,e||0),r},yye=function(){UT=null},oh=function(t,e,n,r){return n&&(lF(t,e,n,r,-1)||lF(t,e,n,r,1))},vye=/^(img|br|input|textarea|hr)$/i;function lF(t,e,n,r,i){for(var o;;){if(t==n&&e==r)return!0;if(e==(i<0?0:ra(t))){let s=t.parentNode;if(!s||s.nodeType!=1||ov(t)||vye.test(t.nodeName)||t.contentEditable=="false")return!1;e=yi(t)+(i<0?0:1),t=s}else if(t.nodeType==1){let s=t.childNodes[e+(i<0?-1:0)];if(s.nodeType==1&&s.contentEditable=="false")if(!((o=s.pmViewDesc)===null||o===void 0)&&o.ignoreForSelection)e+=i;else return!1;else t=s,e=i<0?ra(t):0}else return!1}}function ra(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function xye(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=ra(t)}else if(t.parentNode&&!ov(t))e=yi(t),t=t.parentNode;else return null}}function Sye(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!ov(t))e=yi(t)+1,t=t.parentNode;else return null}}function bye(t,e,n){for(let r=e==0,i=e==ra(t);r||i;){if(t==n)return!0;let o=yi(t);if(t=t.parentNode,!t)return!1;r=r&&o==0,i=i&&o==ra(t)}}function ov(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const w0=function(t){return t.focusNode&&oh(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function Ad(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function wye(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function kye(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(ra(r.offsetNode),r.offset)}}catch{}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(ra(r.startContainer),r.startOffset)}}}const Pl=typeof navigator<"u"?navigator:null,cF=typeof document<"u"?document:null,Zu=Pl&&Pl.userAgent||"",HT=/Edge\/(\d+)/.exec(Zu),zW=/MSIE \d/.exec(Zu),WT=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Zu),Yo=!!(zW||WT||HT),Cu=zW?document.documentMode:WT?+WT[1]:HT?+HT[1]:0,aa=!Yo&&/gecko\/(\d+)/i.test(Zu);aa&&+(/Firefox\/(\d+)/.exec(Zu)||[0,0])[1];const VT=!Yo&&/Chrome\/(\d+)/.exec(Zu),Wi=!!VT,FW=VT?+VT[1]:0,xo=!Yo&&!!Pl&&/Apple Computer/.test(Pl.vendor),pf=xo&&(/Mobile\/\w+/.test(Zu)||!!Pl&&Pl.maxTouchPoints>2),Zs=pf||(Pl?/Mac/.test(Pl.platform):!1),Iye=Pl?/Win/.test(Pl.platform):!1,cc=/Android \d/.test(Zu),sv=!!cF&&"webkitFontSmoothing"in cF.documentElement.style,_ye=sv?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function Cye(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function ec(t,e){return typeof t=="number"?t:t[e]}function Pye(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function uF(t,e,n){let r=t.someProp("scrollThreshold")||0,i=t.someProp("scrollMargin")||5,o=t.dom.ownerDocument;for(let s=n||t.dom;s;){if(s.nodeType!=1){s=hf(s);continue}let a=s,l=a==o.body,c=l?Cye(o):Pye(a),d=0,u=0;if(e.top<c.top+ec(r,"top")?u=-(c.top-e.top+ec(i,"top")):e.bottom>c.bottom-ec(r,"bottom")&&(u=e.bottom-e.top>c.bottom-c.top?e.top+ec(i,"top")-c.top:e.bottom-c.bottom+ec(i,"bottom")),e.left<c.left+ec(r,"left")?d=-(c.left-e.left+ec(i,"left")):e.right>c.right-ec(r,"right")&&(d=e.right-c.right+ec(i,"right")),d||u)if(l)o.defaultView.scrollBy(d,u);else{let f=a.scrollLeft,y=a.scrollTop;u&&(a.scrollTop+=u),d&&(a.scrollLeft+=d);let v=a.scrollLeft-f,x=a.scrollTop-y;e={left:e.left-v,top:e.top-x,right:e.right-v,bottom:e.bottom-x}}let p=l?"fixed":getComputedStyle(s).position;if(/^(fixed|sticky)$/.test(p))break;s=p=="absolute"?s.offsetParent:hf(s)}}function Tye(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,i;for(let o=(e.left+e.right)/2,s=n+1;s<Math.min(innerHeight,e.bottom);s+=5){let a=t.root.elementFromPoint(o,s);if(!a||a==t.dom||!t.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=n-20){r=a,i=l.top;break}}return{refDOM:r,refTop:i,stack:BW(t.dom)}}function BW(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=hf(r));return e}function Eye({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;UW(n,r==0?0:r-e)}function UW(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:i,left:o}=t[n];r.scrollTop!=i+e&&(r.scrollTop=i+e),r.scrollLeft!=o&&(r.scrollLeft=o)}}let yp=null;function Aye(t){if(t.setActive)return t.setActive();if(yp)return t.focus(yp);let e=BW(t);t.focus(yp==null?{get preventScroll(){return yp={preventScroll:!0},!0}}:void 0),yp||(yp=!1,UW(e,0))}function HW(t,e){let n,r=2e8,i,o=0,s=e.top,a=e.top,l,c;for(let d=t.firstChild,u=0;d;d=d.nextSibling,u++){let p;if(d.nodeType==1)p=d.getClientRects();else if(d.nodeType==3)p=ac(d).getClientRects();else continue;for(let f=0;f<p.length;f++){let y=p[f];if(y.top<=s&&y.bottom>=a){s=Math.max(y.bottom,s),a=Math.min(y.top,a);let v=y.left>e.left?y.left-e.left:y.right<e.left?e.left-y.right:0;if(v<r){n=d,r=v,i=v&&n.nodeType==3?{left:y.right<e.left?y.right:y.left,top:e.top}:e,d.nodeType==1&&v&&(o=u+(e.left>=(y.left+y.right)/2?1:0));continue}}else y.top>e.top&&!l&&y.left<=e.left&&y.right>=e.left&&(l=d,c={left:Math.max(y.left,Math.min(y.right,e.left)),top:y.top});!n&&(e.left>=y.right&&e.top>=y.top||e.left>=y.left&&e.top>=y.bottom)&&(o=u+1)}}return!n&&l&&(n=l,i=c,r=0),n&&n.nodeType==3?Mye(n,i):!n||r&&n.nodeType==1?{node:t,offset:o}:HW(n,i)}function Mye(t,e){let n=t.nodeValue.length,r=document.createRange();for(let i=0;i<n;i++){r.setEnd(t,i+1),r.setStart(t,i);let o=lu(r,1);if(o.top!=o.bottom&&wA(e,o))return{node:t,offset:i+(e.left>=(o.left+o.right)/2?1:0)}}return{node:t,offset:0}}function wA(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function Oye(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function Dye(t,e,n){let{node:r,offset:i}=HW(e,n),o=-1;if(r.nodeType==1&&!r.firstChild){let s=r.getBoundingClientRect();o=s.left!=s.right&&n.left>(s.left+s.right)/2?1:-1}return t.docView.posFromDOM(r,i,o)}function jye(t,e,n,r){let i=-1;for(let o=e,s=!1;o!=t.dom;){let a=t.docView.nearestDesc(o,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!s&&l.left>r.left||l.top>r.top?i=a.posBefore:(!s&&l.right<r.left||l.bottom<r.top)&&(i=a.posAfter),s=!0),!a.contentDOM&&i<0&&!a.node.isText))return(a.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;o=a.dom.parentNode}return i>-1?i:t.docView.posFromDOM(e,n,-1)}function WW(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let i=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),o=i;;){let s=t.childNodes[o];if(s.nodeType==1){let a=s.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(wA(e,c))return WW(s,e,c)}}if((o=(o+1)%r)==i)break}return t}function Rye(t,e){let n=t.dom.ownerDocument,r,i=0,o=kye(n,e.left,e.top);o&&({node:r,offset:i}=o);let s=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),a;if(!s||!t.dom.contains(s.nodeType!=1?s.parentNode:s)){let c=t.dom.getBoundingClientRect();if(!wA(e,c)||(s=WW(t.dom,e,c),!s))return null}if(xo)for(let c=s;r&&c;c=hf(c))c.draggable&&(r=void 0);if(s=Oye(s,e),r){if(aa&&r.nodeType==1&&(i=Math.min(i,r.childNodes.length),i<r.childNodes.length)){let d=r.childNodes[i],u;d.nodeName=="IMG"&&(u=d.getBoundingClientRect()).right<=e.left&&u.bottom>e.top&&i++}let c;sv&&i&&r.nodeType==1&&(c=r.childNodes[i-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=e.top&&i--,r==t.dom&&i==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?a=t.state.doc.content.size:(i==0||r.nodeType!=1||r.childNodes[i-1].nodeName!="BR")&&(a=jye(t,r,i,e))}a==null&&(a=Dye(t,s,e));let l=t.docView.nearestDesc(s,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function dF(t){return t.top<t.bottom||t.left<t.right}function lu(t,e){let n=t.getClientRects();if(n.length){let r=n[e<0?0:n.length-1];if(dF(r))return r}return Array.prototype.find.call(n,dF)||t.getBoundingClientRect()}const $ye=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function VW(t,e,n){let{node:r,offset:i,atom:o}=t.docView.domFromPos(e,n<0?-1:1),s=sv||aa;if(r.nodeType==3)if(s&&($ye.test(r.nodeValue)||(n<0?!i:i==r.nodeValue.length))){let l=lu(ac(r,i,i),n);if(aa&&i&&/\s/.test(r.nodeValue[i-1])&&i<r.nodeValue.length){let c=lu(ac(r,i-1,i-1),-1);if(c.top==l.top){let d=lu(ac(r,i,i+1),-1);if(d.top!=l.top)return Hg(d,d.left<c.left)}}return l}else{let l=i,c=i,d=n<0?1:-1;return n<0&&!i?(c++,d=-1):n>=0&&i==r.nodeValue.length?(l--,d=1):n<0?l--:c++,Hg(lu(ac(r,l,c),d),d<0)}if(!t.state.doc.resolve(e-(o||0)).parent.inlineContent){if(o==null&&i&&(n<0||i==ra(r))){let l=r.childNodes[i-1];if(l.nodeType==1)return sP(l.getBoundingClientRect(),!1)}if(o==null&&i<ra(r)){let l=r.childNodes[i];if(l.nodeType==1)return sP(l.getBoundingClientRect(),!0)}return sP(r.getBoundingClientRect(),n>=0)}if(o==null&&i&&(n<0||i==ra(r))){let l=r.childNodes[i-1],c=l.nodeType==3?ac(l,ra(l)-(s?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return Hg(lu(c,1),!1)}if(o==null&&i<ra(r)){let l=r.childNodes[i];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?ac(l,0,s?0:1):l.nodeType==1?l:null:null;if(c)return Hg(lu(c,-1),!0)}return Hg(lu(r.nodeType==3?ac(r):r,-n),n>=0)}function Hg(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function sP(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function KW(t,e,n){let r=t.state,i=t.root.activeElement;r!=e&&t.updateState(e),i!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),i!=t.dom&&i&&i.focus()}}function Nye(t,e,n){let r=e.selection,i=n=="up"?r.$from:r.$to;return KW(t,e,()=>{let{node:o}=t.docView.domFromPos(i.pos,n=="up"?-1:1);for(;;){let a=t.docView.nearestDesc(o,!0);if(!a)break;if(a.node.isBlock){o=a.contentDOM||a.dom;break}o=a.dom.parentNode}let s=VW(t,i.pos,1);for(let a=o.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=ac(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let d=l[c];if(d.bottom>d.top+1&&(n=="up"?s.top-d.top>(d.bottom-s.top)*2:d.bottom-s.bottom>(s.bottom-d.top)*2))return!1}}return!0})}const Lye=/[\u0590-\u08ac]/;function zye(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let i=r.parentOffset,o=!i,s=i==r.parent.content.size,a=t.domSelection();return a?!Lye.test(r.parent.textContent)||!a.modify?n=="left"||n=="backward"?o:s:KW(t,e,()=>{let{focusNode:l,focusOffset:c,anchorNode:d,anchorOffset:u}=t.domSelectionRange(),p=a.caretBidiLevel;a.modify("move",n,"character");let f=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:y,focusOffset:v}=t.domSelectionRange(),x=y&&!f.contains(y.nodeType==1?y:y.parentNode)||l==y&&c==v;try{a.collapse(d,u),l&&(l!=d||c!=u)&&a.extend&&a.extend(l,c)}catch{}return p!=null&&(a.caretBidiLevel=p),x}):r.pos==r.start()||r.pos==r.end()}let hF=null,pF=null,fF=!1;function Fye(t,e,n){return hF==e&&pF==n?fF:(hF=e,pF=n,fF=n=="up"||n=="down"?Nye(t,e,n):zye(t,e,n))}const la=0,gF=1,Od=2,Tl=3;class av{constructor(e,n,r,i){this.parent=e,this.children=n,this.dom=r,this.contentDOM=i,this.dirty=la,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let i=this.children[n];if(i==e)return r;r+=i.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let o,s;if(e==this.contentDOM)o=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;o=e.previousSibling}for(;o&&!((s=o.pmViewDesc)&&s.parent==this);)o=o.previousSibling;return o?this.posBeforeChild(s)+s.size:this.posAtStart}else{let o,s;if(e==this.contentDOM)o=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;o=e.nextSibling}for(;o&&!((s=o.pmViewDesc)&&s.parent==this);)o=o.nextSibling;return o?this.posBeforeChild(s):this.posAtEnd}let i;if(e==this.dom&&this.contentDOM)i=n>yi(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))i=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let o=e;;o=o.parentNode){if(o==this.dom){i=!1;break}if(o.previousSibling)break}if(i==null&&n==e.childNodes.length)for(let o=e;;o=o.parentNode){if(o==this.dom){i=!0;break}if(o.nextSibling)break}}return i??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,i=e;i;i=i.parentNode){let o=this.getDesc(i),s;if(o&&(!n||o.node))if(r&&(s=o.nodeDOM)&&!(s.nodeType==1?s.contains(e.nodeType==1?e:e.parentNode):s==e))r=!1;else return o}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let i=e;i;i=i.parentNode){let o=this.getDesc(i);if(o)return o.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let i=this.children[n],o=r+i.size;if(r==e&&o!=r){for(;!i.border&&i.children.length;)for(let s=0;s<i.children.length;s++){let a=i.children[s];if(a.size){i=a;break}}return i}if(e<o)return i.descAt(e-r-i.border);r=o}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,i=0;for(let o=0;r<this.children.length;r++){let s=this.children[r],a=o+s.size;if(a>e||s instanceof GW){i=e-o;break}o=a}if(i)return this.children[r].domFromPos(i-this.children[r].border,n);for(let o;r&&!(o=this.children[r-1]).size&&o instanceof qW&&o.side>=0;r--);if(n<=0){let o,s=!0;for(;o=r?this.children[r-1]:null,!(!o||o.dom.parentNode==this.contentDOM);r--,s=!1);return o&&n&&s&&!o.border&&!o.domAtom?o.domFromPos(o.size,n):{node:this.contentDOM,offset:o?yi(o.dom)+1:0}}else{let o,s=!0;for(;o=r<this.children.length?this.children[r]:null,!(!o||o.dom.parentNode==this.contentDOM);r++,s=!1);return o&&s&&!o.border&&!o.domAtom?o.domFromPos(0,n):{node:this.contentDOM,offset:o?yi(o.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let i=-1,o=-1;for(let s=r,a=0;;a++){let l=this.children[a],c=s+l.size;if(i==-1&&e<=c){let d=s+l.border;if(e>=d&&n<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,d);e=s;for(let u=a;u>0;u--){let p=this.children[u-1];if(p.size&&p.dom.parentNode==this.contentDOM&&!p.emptyChildAt(1)){i=yi(p.dom)+1;break}e-=p.size}i==-1&&(i=0)}if(i>-1&&(c>n||a==this.children.length-1)){n=c;for(let d=a+1;d<this.children.length;d++){let u=this.children[d];if(u.size&&u.dom.parentNode==this.contentDOM&&!u.emptyChildAt(-1)){o=yi(u.dom);break}n+=u.size}o==-1&&(o=this.contentDOM.childNodes.length);break}s=c}return{node:this.contentDOM,from:e,to:n,fromOffset:i,toOffset:o}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,i=!1){let o=Math.min(e,n),s=Math.max(e,n);for(let f=0,y=0;f<this.children.length;f++){let v=this.children[f],x=y+v.size;if(o>y&&s<x)return v.setSelection(e-y-v.border,n-y-v.border,r,i);y=x}let a=this.domFromPos(e,e?-1:1),l=n==e?a:this.domFromPos(n,n?-1:1),c=r.root.getSelection(),d=r.domSelectionRange(),u=!1;if((aa||xo)&&e==n){let{node:f,offset:y}=a;if(f.nodeType==3){if(u=!!(y&&f.nodeValue[y-1]==`
`),u&&y==f.nodeValue.length)for(let v=f,x;v;v=v.parentNode){if(x=v.nextSibling){x.nodeName=="BR"&&(a=l={node:x.parentNode,offset:yi(x)+1});break}let b=v.pmViewDesc;if(b&&b.node&&b.node.isBlock)break}}else{let v=f.childNodes[y-1];u=v&&(v.nodeName=="BR"||v.contentEditable=="false")}}if(aa&&d.focusNode&&d.focusNode!=l.node&&d.focusNode.nodeType==1){let f=d.focusNode.childNodes[d.focusOffset];f&&f.contentEditable=="false"&&(i=!0)}if(!(i||u&&xo)&&oh(a.node,a.offset,d.anchorNode,d.anchorOffset)&&oh(l.node,l.offset,d.focusNode,d.focusOffset))return;let p=!1;if((c.extend||e==n)&&!(u&&aa)){c.collapse(a.node,a.offset);try{e!=n&&c.extend(l.node,l.offset),p=!0}catch{}}if(!p){if(e>n){let y=a;a=l,l=y}let f=document.createRange();f.setEnd(l.node,l.offset),f.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(f)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,i=0;i<this.children.length;i++){let o=this.children[i],s=r+o.size;if(r==s?e<=s&&n>=r:e<s&&n>r){let a=r+o.border,l=s-o.border;if(e>=a&&n<=l){this.dirty=e==r||n==s?Od:gF,e==a&&n==l&&(o.contentLost||o.dom.parentNode!=this.contentDOM)?o.dirty=Tl:o.markDirty(e-a,n-a);return}else o.dirty=o.dom==o.contentDOM&&o.dom.parentNode==this.contentDOM&&!o.children.length?Od:Tl}r=s}this.dirty=Od}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?Od:gF;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class qW extends av{constructor(e,n,r,i){let o,s=n.type.toDOM;if(typeof s=="function"&&(s=s(r,()=>{if(!o)return i;if(o.parent)return o.parent.posBeforeChild(o)})),!n.type.spec.raw){if(s.nodeType!=1){let a=document.createElement("span");a.appendChild(s),s=a}s.contentEditable="false",s.classList.add("ProseMirror-widget")}super(e,[],s,null),this.widget=n,this.widget=n,o=this}matchesWidget(e){return this.dirty==la&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class Bye extends av{constructor(e,n,r,i){super(e,[],n,null),this.textDOM=r,this.text=i}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class sh extends av{constructor(e,n,r,i,o){super(e,[],r,i),this.mark=n,this.spec=o}static create(e,n,r,i){let o=i.nodeViews[n.type.name],s=o&&o(n,i,r);return(!s||!s.dom)&&(s=Ph.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new sh(e,n,s.dom,s.contentDOM||s.dom,s)}parseRule(){return this.dirty&Tl||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=Tl&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=la){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=la}}slice(e,n,r){let i=sh.create(this.parent,this.mark,!0,r),o=this.children,s=this.size;n<s&&(o=qT(o,n,s,r)),e>0&&(o=qT(o,0,e,r));for(let a=0;a<o.length;a++)o[a].parent=i;return i.children=o,i}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Pu extends av{constructor(e,n,r,i,o,s,a,l,c){super(e,[],o,s),this.node=n,this.outerDeco=r,this.innerDeco=i,this.nodeDOM=a}static create(e,n,r,i,o,s){let a=o.nodeViews[n.type.name],l,c=a&&a(n,o,()=>{if(!l)return s;if(l.parent)return l.parent.posBeforeChild(l)},r,i),d=c&&c.dom,u=c&&c.contentDOM;if(n.isText){if(!d)d=document.createTextNode(n.text);else if(d.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else d||({dom:d,contentDOM:u}=Ph.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!u&&!n.isText&&d.nodeName!="BR"&&(d.hasAttribute("contenteditable")||(d.contentEditable="false"),n.type.spec.draggable&&(d.draggable=!0));let p=d;return d=ZW(d,r,n),c?l=new Uye(e,n,r,i,d,u||null,p,c,o,s+1):n.isText?new k0(e,n,r,i,d,p,o):new Pu(e,n,r,i,d,u||null,p,o,s+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>Pe.empty)}return e}matchesNode(e,n,r){return this.dirty==la&&e.eq(this.node)&&Cb(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,i=n,o=e.composing?this.localCompositionInfo(e,n):null,s=o&&o.pos>-1?o:null,a=o&&o.pos<0,l=new Wye(this,s&&s.node,e);qye(this.node,this.innerDeco,(c,d,u)=>{c.spec.marks?l.syncToMarks(c.spec.marks,r,e):c.type.side>=0&&!u&&l.syncToMarks(d==this.node.childCount?xn.none:this.node.child(d).marks,r,e),l.placeWidget(c,e,i)},(c,d,u,p)=>{l.syncToMarks(c.marks,r,e);let f;l.findNodeMatch(c,d,u,p)||a&&e.state.selection.from>i&&e.state.selection.to<i+c.nodeSize&&(f=l.findIndexWithChild(o.node))>-1&&l.updateNodeAt(c,d,u,f,e)||l.updateNextNode(c,d,u,e,p,i)||l.addNode(c,d,u,e,i),i+=c.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==Od)&&(s&&this.protectLocalComposition(e,s),YW(this.contentDOM,this.children,e),pf&&Gye(this.dom))}localCompositionInfo(e,n){let{from:r,to:i}=e.state.selection;if(!(e.state.selection instanceof wt)||r<n||i>n+this.node.content.size)return null;let o=e.input.compositionNode;if(!o||!this.dom.contains(o.parentNode))return null;if(this.node.inlineContent){let s=o.nodeValue,a=Yye(this.node.content,s,r-n,i-n);return a<0?null:{node:o,pos:a,text:s}}else return{node:o,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:i}){if(this.getDesc(n))return;let o=n;for(;o.parentNode!=this.contentDOM;o=o.parentNode){for(;o.previousSibling;)o.parentNode.removeChild(o.previousSibling);for(;o.nextSibling;)o.parentNode.removeChild(o.nextSibling);o.pmViewDesc&&(o.pmViewDesc=void 0)}let s=new Bye(this,o,n,i);e.input.compositionNodes.push(s),this.children=qT(this.children,r,r+i.length,e,s)}update(e,n,r,i){return this.dirty==Tl||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,i),!0)}updateInner(e,n,r,i){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(i,this.posAtStart),this.dirty=la}updateOuterDeco(e){if(Cb(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=XW(this.dom,this.nodeDOM,KT(this.outerDeco,this.node,n),KT(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function mF(t,e,n,r,i){ZW(r,e,t);let o=new Pu(void 0,t,e,n,r,r,r,i,0);return o.contentDOM&&o.updateChildren(i,0),o}class k0 extends Pu{constructor(e,n,r,i,o,s,a){super(e,n,r,i,o,null,s,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,i){return this.dirty==Tl||this.dirty!=la&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=la||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,i.trackWrites==this.nodeDOM&&(i.trackWrites=null)),this.node=e,this.dirty=la,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let i=this.node.cut(e,n),o=document.createTextNode(i.text);return new k0(this.parent,i,this.outerDeco,this.innerDeco,o,o,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=Tl)}get domAtom(){return!1}isText(e){return this.node.text==e}}class GW extends av{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==la&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class Uye extends Pu{constructor(e,n,r,i,o,s,a,l,c,d){super(e,n,r,i,o,s,a,c,d),this.spec=l}update(e,n,r,i){if(this.dirty==Tl)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let o=this.spec.update(e,n,r);return o&&this.updateInner(e,n,r,i),o}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,i)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,i){this.spec.setSelection?this.spec.setSelection(e,n,r.root):super.setSelection(e,n,r,i)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function YW(t,e,n){let r=t.firstChild,i=!1;for(let o=0;o<e.length;o++){let s=e[o],a=s.dom;if(a.parentNode==t){for(;a!=r;)r=yF(r),i=!0;r=r.nextSibling}else i=!0,t.insertBefore(a,r);if(s instanceof sh){let l=r?r.previousSibling:t.lastChild;YW(s.contentDOM,s.children,n),r=l?l.nextSibling:t.firstChild}}for(;r;)r=yF(r),i=!0;i&&n.trackWrites==t&&(n.trackWrites=null)}const Rm=function(t){t&&(this.nodeName=t)};Rm.prototype=Object.create(null);const Dd=[new Rm];function KT(t,e,n){if(t.length==0)return Dd;let r=n?Dd[0]:new Rm,i=[r];for(let o=0;o<t.length;o++){let s=t[o].type.attrs;if(s){s.nodeName&&i.push(r=new Rm(s.nodeName));for(let a in s){let l=s[a];l!=null&&(n&&i.length==1&&i.push(r=new Rm(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return i}function XW(t,e,n,r){if(n==Dd&&r==Dd)return e;let i=e;for(let o=0;o<r.length;o++){let s=r[o],a=n[o];if(o){let l;a&&a.nodeName==s.nodeName&&i!=t&&(l=i.parentNode)&&l.nodeName.toLowerCase()==s.nodeName||(l=document.createElement(s.nodeName),l.pmIsDeco=!0,l.appendChild(i),a=Dd[0]),i=l}Hye(i,a||Dd[0],s)}return i}function Hye(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],i=n.class?n.class.split(" ").filter(Boolean):[];for(let o=0;o<r.length;o++)i.indexOf(r[o])==-1&&t.classList.remove(r[o]);for(let o=0;o<i.length;o++)r.indexOf(i[o])==-1&&t.classList.add(i[o]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,i;for(;i=r.exec(e.style);)t.style.removeProperty(i[1])}n.style&&(t.style.cssText+=n.style)}}function ZW(t,e,n){return XW(t,t,Dd,KT(e,n,t.nodeType!=1))}function Cb(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function yF(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class Wye{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=Vye(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let i=0,o=this.stack.length>>1,s=Math.min(o,e.length);for(;i<s&&(i==o-1?this.top:this.stack[i+1<<1]).matchesMark(e[i])&&e[i].type.spec.spanning!==!1;)i++;for(;i<o;)this.destroyRest(),this.top.dirty=la,this.index=this.stack.pop(),this.top=this.stack.pop(),o--;for(;o<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let c=this.top.children[l];if(c.matchesMark(e[o])&&!this.isLocked(c.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=sh.create(this.top,e[o],n,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,o++}}findNodeMatch(e,n,r,i){let o=-1,s;if(i>=this.preMatch.index&&(s=this.preMatch.matches[i-this.preMatch.index]).parent==this.top&&s.matchesNode(e,n,r))o=this.top.children.indexOf(s,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(e,n,r)&&!this.preMatch.matched.has(c)){o=a;break}}return o<0?!1:(this.destroyBetween(this.index,o),this.index++,!0)}updateNodeAt(e,n,r,i,o){let s=this.top.children[i];return s.dirty==Tl&&s.dom==s.contentDOM&&(s.dirty=Od),s.update(e,n,r,o)?(this.destroyBetween(this.index,i),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==r)return i}return-1}e=n}}updateNextNode(e,n,r,i,o,s){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof Pu){let c=this.preMatch.matched.get(l);if(c!=null&&c!=o)return!1;let d=l.dom,u,p=this.isLocked(d)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=Tl&&Cb(n,l.outerDeco));if(!p&&l.update(e,n,r,i))return this.destroyBetween(this.index,a),l.dom!=d&&(this.changed=!0),this.index++,!0;if(!p&&(u=this.recreateWrapper(l,e,n,r,i,s)))return this.destroyBetween(this.index,a),this.top.children[this.index]=u,u.contentDOM&&(u.dirty=Od,u.updateChildren(i,s+1),u.dirty=la),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,r,i,o,s){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!Cb(r,e.outerDeco)||!i.eq(e.innerDeco))return null;let a=Pu.create(this.top,n,r,i,o,s);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,n,r,i,o){let s=Pu.create(this.top,e,n,r,i,o);s.contentDOM&&s.updateChildren(i,o+1),this.top.children.splice(this.index++,0,s),this.changed=!0}placeWidget(e,n,r){let i=this.index<this.top.children.length?this.top.children[this.index]:null;if(i&&i.matchesWidget(e)&&(e==i.widget||!i.widget.type.toDOM.parentNode))this.index++;else{let o=new qW(this.top,e,n,r);this.top.children.splice(this.index++,0,o),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof sh;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof k0)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((xo||Wi)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let i=new GW(this.top,[],r,null);n!=this.top?n.children.push(i):n.children.splice(this.index++,0,i),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function Vye(t,e){let n=e,r=n.children.length,i=t.childCount,o=new Map,s=[];e:for(;i>0;){let a;for(;;)if(r){let c=n.children[r-1];if(c instanceof sh)n=c,r=c.children.length;else{a=c,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=t.child(i-1))break;--i,o.set(a,i),s.push(a)}}return{index:i,matched:o,matches:s.reverse()}}function Kye(t,e){return t.type.side-e.type.side}function qye(t,e,n,r){let i=e.locals(t),o=0;if(i.length==0){for(let c=0;c<t.childCount;c++){let d=t.child(c);r(d,i,e.forChild(o,d),c),o+=d.nodeSize}return}let s=0,a=[],l=null;for(let c=0;;){let d,u;for(;s<i.length&&i[s].to==o;){let x=i[s++];x.widget&&(d?(u||(u=[d])).push(x):d=x)}if(d)if(u){u.sort(Kye);for(let x=0;x<u.length;x++)n(u[x],c,!!l)}else n(d,c,!!l);let p,f;if(l)f=-1,p=l,l=null;else if(c<t.childCount)f=c,p=t.child(c++);else break;for(let x=0;x<a.length;x++)a[x].to<=o&&a.splice(x--,1);for(;s<i.length&&i[s].from<=o&&i[s].to>o;)a.push(i[s++]);let y=o+p.nodeSize;if(p.isText){let x=y;s<i.length&&i[s].from<x&&(x=i[s].from);for(let b=0;b<a.length;b++)a[b].to<x&&(x=a[b].to);x<y&&(l=p.cut(x-o),p=p.cut(0,x-o),y=x,f=-1)}else for(;s<i.length&&i[s].to<y;)s++;let v=p.isInline&&!p.isLeaf?a.filter(x=>!x.inline):a.slice();r(p,v,e.forChild(o,p),f),o=y}}function Gye(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function Yye(t,e,n,r){for(let i=0,o=0;i<t.childCount&&o<=r;){let s=t.child(i++),a=o;if(o+=s.nodeSize,!s.isText)continue;let l=s.text;for(;i<t.childCount;){let c=t.child(i++);if(o+=c.nodeSize,!c.isText)break;l+=c.text}if(o>=n){if(o>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let c=a<r?l.lastIndexOf(e,r-a-1):-1;if(c>=0&&c+e.length+a>=n)return a+c;if(n==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function qT(t,e,n,r,i){let o=[];for(let s=0,a=0;s<t.length;s++){let l=t[s],c=a,d=a+=l.size;c>=n||d<=e?o.push(l):(c<e&&o.push(l.slice(0,e-c,r)),i&&(o.push(i),i=void 0),d>n&&o.push(l.slice(n-c,l.size,r)))}return o}function kA(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let i=t.docView.nearestDesc(n.focusNode),o=i&&i.size==0,s=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(s<0)return null;let a=r.resolve(s),l,c;if(w0(n)){for(l=s;i&&!i.node;)i=i.parent;let u=i.node;if(i&&u.isAtom&&ot.isSelectable(u)&&i.parent&&!(u.isInline&&bye(n.focusNode,n.focusOffset,i.dom))){let p=i.posBefore;c=new ot(s==p?a:r.resolve(p))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let u=s,p=s;for(let f=0;f<n.rangeCount;f++){let y=n.getRangeAt(f);u=Math.min(u,t.docView.posFromDOM(y.startContainer,y.startOffset,1)),p=Math.max(p,t.docView.posFromDOM(y.endContainer,y.endOffset,-1))}if(u<0)return null;[l,s]=p==t.state.selection.anchor?[p,u]:[u,p],a=r.resolve(s)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let d=r.resolve(l);if(!c){let u=e=="pointer"||t.state.selection.head<a.pos&&!o?1:-1;c=IA(t,d,a,u)}return c}function JW(t){return t.editable?t.hasFocus():eV(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function fc(t,e=!1){let n=t.state.selection;if(QW(t,n),!!JW(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&Wi){let r=t.domSelectionRange(),i=t.domObserver.currentSelection;if(r.anchorNode&&i.anchorNode&&oh(r.anchorNode,r.anchorOffset,i.anchorNode,i.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)Zye(t);else{let{anchor:r,head:i}=n,o,s;vF&&!(n instanceof wt)&&(n.$from.parent.inlineContent||(o=xF(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(s=xF(t,n.to))),t.docView.setSelection(r,i,t,e),vF&&(o&&SF(o),s&&SF(s)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Xye(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const vF=xo||Wi&&FW<63;function xF(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),i=r<n.childNodes.length?n.childNodes[r]:null,o=r?n.childNodes[r-1]:null;if(xo&&i&&i.contentEditable=="false")return aP(i);if((!i||i.contentEditable=="false")&&(!o||o.contentEditable=="false")){if(i)return aP(i);if(o)return aP(o)}}function aP(t){return t.contentEditable="true",xo&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function SF(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function Xye(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,i=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=i)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!JW(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function Zye(t){let e=t.domSelection();if(!e)return;let n=t.cursorWrapper.dom,r=n.nodeName=="IMG";r?e.collapse(n.parentNode,yi(n)+1):e.collapse(n,0),!r&&!t.state.selection.visible&&Yo&&Cu<=11&&(n.disabled=!0,n.disabled=!1)}function QW(t,e){if(e instanceof ot){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(bF(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else bF(t)}function bF(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function IA(t,e,n,r){return t.someProp("createSelectionBetween",i=>i(t,e,n))||wt.between(e,n,r)}function wF(t){return t.editable&&!t.hasFocus()?!1:eV(t)}function eV(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function Jye(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return oh(e.node,e.offset,n.anchorNode,n.anchorOffset)}function GT(t,e){let{$anchor:n,$head:r}=t.selection,i=e>0?n.max(r):n.min(r),o=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return o&&Mt.findFrom(o,e)}function hu(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function kF(t,e,n){let r=t.state.selection;if(r instanceof wt)if(n.indexOf("s")>-1){let{$head:i}=r,o=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!o||o.isText||!o.isLeaf)return!1;let s=t.state.doc.resolve(i.pos+o.nodeSize*(e<0?-1:1));return hu(t,new wt(r.$anchor,s))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let i=GT(t.state,e);return i&&i instanceof ot?hu(t,i):!1}else if(!(Zs&&n.indexOf("m")>-1)){let i=r.$head,o=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,s;if(!o||o.isText)return!1;let a=e<0?i.pos-o.nodeSize:i.pos;return o.isAtom||(s=t.docView.descAt(a))&&!s.contentDOM?ot.isSelectable(o)?hu(t,new ot(e<0?t.state.doc.resolve(i.pos-o.nodeSize):i)):sv?hu(t,new wt(t.state.doc.resolve(e<0?a:a+o.nodeSize))):!1:!1}}else return!1;else{if(r instanceof ot&&r.node.isInline)return hu(t,new wt(e>0?r.$to:r.$from));{let i=GT(t.state,e);return i?hu(t,i):!1}}}function Pb(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function $m(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function vp(t,e){return e<0?Qye(t):eve(t)}function Qye(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i,o,s=!1;for(aa&&n.nodeType==1&&r<Pb(n)&&$m(n.childNodes[r],-1)&&(s=!0);;)if(r>0){if(n.nodeType!=1)break;{let a=n.childNodes[r-1];if($m(a,-1))i=n,o=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}}else{if(tV(n))break;{let a=n.previousSibling;for(;a&&$m(a,-1);)i=n.parentNode,o=yi(a),a=a.previousSibling;if(a)n=a,r=Pb(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}s?YT(t,n,r):i&&YT(t,i,o)}function eve(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i=Pb(n),o,s;for(;;)if(r<i){if(n.nodeType!=1)break;let a=n.childNodes[r];if($m(a,1))o=n,s=++r;else break}else{if(tV(n))break;{let a=n.nextSibling;for(;a&&$m(a,1);)o=a.parentNode,s=yi(a)+1,a=a.nextSibling;if(a)n=a,r=0,i=Pb(n);else{if(n=n.parentNode,n==t.dom)break;r=i=0}}}o&&YT(t,o,s)}function tV(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function tve(t,e){for(;t&&e==t.childNodes.length&&!ov(t);)e=yi(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function nve(t,e){for(;t&&!e&&!ov(t);)e=yi(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function YT(t,e,n){if(e.nodeType!=3){let o,s;(s=tve(e,n))?(e=s,n=0):(o=nve(e,n))&&(e=o,n=o.nodeValue.length)}let r=t.domSelection();if(!r)return;if(w0(r)){let o=document.createRange();o.setEnd(e,n),o.setStart(e,n),r.removeAllRanges(),r.addRange(o)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:i}=t;setTimeout(()=>{t.state==i&&fc(t)},50)}function IF(t,e){let n=t.state.doc.resolve(e);if(!(Wi||Iye)&&n.parent.inlineContent){let i=t.coordsAtPos(e);if(e>n.start()){let o=t.coordsAtPos(e-1),s=(o.top+o.bottom)/2;if(s>i.top&&s<i.bottom&&Math.abs(o.left-i.left)>1)return o.left<i.left?"ltr":"rtl"}if(e<n.end()){let o=t.coordsAtPos(e+1),s=(o.top+o.bottom)/2;if(s>i.top&&s<i.bottom&&Math.abs(o.left-i.left)>1)return o.left>i.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function _F(t,e,n){let r=t.state.selection;if(r instanceof wt&&!r.empty||n.indexOf("s")>-1||Zs&&n.indexOf("m")>-1)return!1;let{$from:i,$to:o}=r;if(!i.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let s=GT(t.state,e);if(s&&s instanceof ot)return hu(t,s)}if(!i.parent.inlineContent){let s=e<0?i:o,a=r instanceof Is?Mt.near(s,e):Mt.findFrom(s,e);return a?hu(t,a):!1}return!1}function CF(t,e){if(!(t.state.selection instanceof wt))return!0;let{$head:n,$anchor:r,empty:i}=t.state.selection;if(!n.sameParent(r))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let o=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(o&&!o.isText){let s=t.state.tr;return e<0?s.delete(n.pos-o.nodeSize,n.pos):s.delete(n.pos,n.pos+o.nodeSize),t.dispatch(s),!0}return!1}function PF(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function rve(t){if(!xo||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;PF(t,r,"true"),setTimeout(()=>PF(t,r,"false"),20)}return!1}function ive(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function ove(t,e){let n=e.keyCode,r=ive(e);if(n==8||Zs&&n==72&&r=="c")return CF(t,-1)||vp(t,-1);if(n==46&&!e.shiftKey||Zs&&n==68&&r=="c")return CF(t,1)||vp(t,1);if(n==13||n==27)return!0;if(n==37||Zs&&n==66&&r=="c"){let i=n==37?IF(t,t.state.selection.from)=="ltr"?-1:1:-1;return kF(t,i,r)||vp(t,i)}else if(n==39||Zs&&n==70&&r=="c"){let i=n==39?IF(t,t.state.selection.from)=="ltr"?1:-1:1;return kF(t,i,r)||vp(t,i)}else{if(n==38||Zs&&n==80&&r=="c")return _F(t,-1,r)||vp(t,-1);if(n==40||Zs&&n==78&&r=="c")return rve(t)||_F(t,1,r)||vp(t,1);if(r==(Zs?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function _A(t,e){t.someProp("transformCopied",f=>{e=f(e,t)});let n=[],{content:r,openStart:i,openEnd:o}=e;for(;i>1&&o>1&&r.childCount==1&&r.firstChild.childCount==1;){i--,o--;let f=r.firstChild;n.push(f.type.name,f.attrs!=f.type.defaultAttrs?f.attrs:null),r=f.content}let s=t.someProp("clipboardSerializer")||Ph.fromSchema(t.state.schema),a=aV(),l=a.createElement("div");l.appendChild(s.serializeFragment(r,{document:a}));let c=l.firstChild,d,u=0;for(;c&&c.nodeType==1&&(d=sV[c.nodeName.toLowerCase()]);){for(let f=d.length-1;f>=0;f--){let y=a.createElement(d[f]);for(;l.firstChild;)y.appendChild(l.firstChild);l.appendChild(y),u++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${i} ${o}${u?` -${u}`:""} ${JSON.stringify(n)}`);let p=t.someProp("clipboardTextSerializer",f=>f(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:p,slice:e}}function nV(t,e,n,r,i){let o=i.parent.type.spec.code,s,a;if(!n&&!e)return null;let l=!!e&&(r||o||!n);if(l){if(t.someProp("transformPastedText",p=>{e=p(e,o||r,t)}),o)return a=new He(Pe.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",p=>{a=p(a,t,!0)}),a;let u=t.someProp("clipboardTextParser",p=>p(e,i,r,t));if(u)a=u;else{let p=i.marks(),{schema:f}=t.state,y=Ph.fromSchema(f);s=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(v=>{let x=s.appendChild(document.createElement("p"));v&&x.appendChild(y.serializeNode(f.text(v,p)))})}}else t.someProp("transformPastedHTML",u=>{n=u(n,t)}),s=cve(n),sv&&uve(s);let c=s&&s.querySelector("[data-pm-slice]"),d=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(d&&d[3])for(let u=+d[3];u>0;u--){let p=s.firstChild;for(;p&&p.nodeType!=1;)p=p.nextSibling;if(!p)break;s=p}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||Gp.fromSchema(t.state.schema)).parseSlice(s,{preserveWhitespace:!!(l||d),context:i,ruleFromNode(p){return p.nodeName=="BR"&&!p.nextSibling&&p.parentNode&&!sve.test(p.parentNode.nodeName)?{ignore:!0}:null}})),d)a=dve(TF(a,+d[1],+d[2]),d[4]);else if(a=He.maxOpen(ave(a.content,i),!0),a.openStart||a.openEnd){let u=0,p=0;for(let f=a.content.firstChild;u<a.openStart&&!f.type.spec.isolating;u++,f=f.firstChild);for(let f=a.content.lastChild;p<a.openEnd&&!f.type.spec.isolating;p++,f=f.lastChild);a=TF(a,u,p)}return t.someProp("transformPasted",u=>{a=u(a,t,l)}),a}const sve=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function ave(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let i=e.node(n).contentMatchAt(e.index(n)),o,s=[];if(t.forEach(a=>{if(!s)return;let l=i.findWrapping(a.type),c;if(!l)return s=null;if(c=s.length&&o.length&&iV(l,o,a,s[s.length-1],0))s[s.length-1]=c;else{s.length&&(s[s.length-1]=oV(s[s.length-1],o.length));let d=rV(a,l);s.push(d),i=i.matchType(d.type),o=l}}),s)return Pe.from(s)}return t}function rV(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,Pe.from(t));return t}function iV(t,e,n,r,i){if(i<t.length&&i<e.length&&t[i]==e[i]){let o=iV(t,e,n,r.lastChild,i+1);if(o)return r.copy(r.content.replaceChild(r.childCount-1,o));if(r.contentMatchAt(r.childCount).matchType(i==t.length-1?n.type:t[i+1]))return r.copy(r.content.append(Pe.from(rV(n,t,i+1))))}}function oV(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,oV(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(Pe.empty,!0);return t.copy(n.append(r))}function XT(t,e,n,r,i,o){let s=e<0?t.firstChild:t.lastChild,a=s.content;return t.childCount>1&&(o=0),i<r-1&&(a=XT(a,e,n,r,i+1,o)),i>=n&&(a=e<0?s.contentMatchAt(0).fillBefore(a,o<=i).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore(Pe.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,s.copy(a))}function TF(t,e,n){return e<t.openStart&&(t=new He(XT(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new He(XT(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const sV={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let EF=null;function aV(){return EF||(EF=document.implementation.createHTMLDocument("title"))}let lP=null;function lve(t){let e=window.trustedTypes;return e?(lP||(lP=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),lP.createHTML(t)):t}function cve(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=aV().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),i;if((i=r&&sV[r[1].toLowerCase()])&&(t=i.map(o=>"<"+o+">").join("")+t+i.map(o=>"</"+o+">").reverse().join("")),n.innerHTML=lve(t),i)for(let o=0;o<i.length;o++)n=n.querySelector(i[o])||n;return n}function uve(t){let e=t.querySelectorAll(Wi?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent==" "&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function dve(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:i,openStart:o,openEnd:s}=t;for(let a=r.length-2;a>=0;a-=2){let l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;i=Pe.from(l.create(r[a+1],i)),o++,s++}return new He(i,o,s)}const So={},bo={},hve={touchstart:!0,touchmove:!0};class pve{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function fve(t){for(let e in So){let n=So[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{mve(t,r)&&!CA(t,r)&&(t.editable||!(r.type in bo))&&n(t,r)},hve[e]?{passive:!0}:void 0)}xo&&t.dom.addEventListener("input",()=>null),ZT(t)}function wu(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function gve(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function ZT(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>CA(t,r))})}function CA(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function mve(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function yve(t,e){!CA(t,e)&&So[e.type]&&(t.editable||!(e.type in bo))&&So[e.type](t,e)}bo.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!cV(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(cc&&Wi&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),pf&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",i=>i(t,Ad(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||ove(t,n)?n.preventDefault():wu(t,"key")};bo.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};bo.keypress=(t,e)=>{let n=e;if(cV(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||Zs&&n.metaKey)return;if(t.someProp("handleKeyPress",i=>i(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof wt)||!r.$from.sameParent(r.$to)){let i=String.fromCharCode(n.charCode),o=()=>t.state.tr.insertText(i).scrollIntoView();!/[\r\n]/.test(i)&&!t.someProp("handleTextInput",s=>s(t,r.$from.pos,r.$to.pos,i,o))&&t.dispatch(o()),n.preventDefault()}};function I0(t){return{left:t.clientX,top:t.clientY}}function vve(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function PA(t,e,n,r,i){if(r==-1)return!1;let o=t.state.doc.resolve(r);for(let s=o.depth+1;s>0;s--)if(t.someProp(e,a=>s>o.depth?a(t,n,o.nodeAfter,o.before(s),i,!0):a(t,n,o.node(s),o.before(s),i,!1)))return!0;return!1}function Xp(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);r.setMeta("pointer",!0),t.dispatch(r)}function xve(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&ot.isSelectable(r)?(Xp(t,new ot(n)),!0):!1}function Sve(t,e){if(e==-1)return!1;let n=t.state.selection,r,i;n instanceof ot&&(r=n.node);let o=t.state.doc.resolve(e);for(let s=o.depth+1;s>0;s--){let a=s>o.depth?o.nodeAfter:o.node(s);if(ot.isSelectable(a)){r&&n.$from.depth>0&&s>=n.$from.depth&&o.before(n.$from.depth+1)==n.$from.pos?i=o.before(n.$from.depth):i=o.before(s);break}}return i!=null?(Xp(t,ot.create(t.state.doc,i)),!0):!1}function bve(t,e,n,r,i){return PA(t,"handleClickOn",e,n,r)||t.someProp("handleClick",o=>o(t,e,r))||(i?Sve(t,n):xve(t,n))}function wve(t,e,n,r){return PA(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",i=>i(t,e,r))}function kve(t,e,n,r){return PA(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",i=>i(t,e,r))||Ive(t,n,r)}function Ive(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(Xp(t,wt.create(r,0,r.content.size)),!0):!1;let i=r.resolve(e);for(let o=i.depth+1;o>0;o--){let s=o>i.depth?i.nodeAfter:i.node(o),a=i.before(o);if(s.inlineContent)Xp(t,wt.create(r,a+1,a+1+s.content.size));else if(ot.isSelectable(s))Xp(t,ot.create(r,a));else continue;return!0}}function TA(t){return Tb(t)}const lV=Zs?"metaKey":"ctrlKey";So.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=TA(t),i=Date.now(),o="singleClick";i-t.input.lastClick.time<500&&vve(n,t.input.lastClick)&&!n[lV]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?o="doubleClick":t.input.lastClick.type=="doubleClick"&&(o="tripleClick")),t.input.lastClick={time:i,x:n.clientX,y:n.clientY,type:o,button:n.button};let s=t.posAtCoords(I0(n));s&&(o=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new _ve(t,s,n,!!r)):(o=="doubleClick"?wve:kve)(t,s.pos,s.inside,n)?n.preventDefault():wu(t,"pointer"))};class _ve{constructor(e,n,r,i){this.view=e,this.pos=n,this.event=r,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[lV],this.allowDefault=r.shiftKey;let o,s;if(n.inside>-1)o=e.state.doc.nodeAt(n.inside),s=n.inside;else{let d=e.state.doc.resolve(n.pos);o=d.parent,s=d.depth?d.before():0}const a=i?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:c}=e.state;(r.button==0&&o.type.spec.draggable&&o.type.spec.selectable!==!1||c instanceof ot&&c.from<=s&&c.to>s)&&(this.mightDrag={node:o,pos:s,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&aa&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),wu(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>fc(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(I0(e))),this.updateAllowDefault(e),this.allowDefault||!n?wu(this.view,"pointer"):bve(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||xo&&this.mightDrag&&!this.mightDrag.node.isAtom||Wi&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(Xp(this.view,Mt.near(this.view.state.doc.resolve(n.pos))),e.preventDefault()):wu(this.view,"pointer")}move(e){this.updateAllowDefault(e),wu(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}So.touchstart=t=>{t.input.lastTouch=Date.now(),TA(t),wu(t,"pointer")};So.touchmove=t=>{t.input.lastTouch=Date.now(),wu(t,"pointer")};So.contextmenu=t=>TA(t);function cV(t,e){return t.composing?!0:xo&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const Cve=cc?5e3:-1;bo.compositionstart=bo.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof wt&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)))t.markCursor=t.state.storedMarks||n.marks(),Tb(t,!0),t.markCursor=null;else if(Tb(t,!e.selection.empty),aa&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let i=r.focusNode,o=r.focusOffset;i&&i.nodeType==1&&o!=0;){let s=o<0?i.lastChild:i.childNodes[o-1];if(!s)break;if(s.nodeType==3){let a=t.domSelection();a&&a.collapse(s,s.nodeValue.length);break}else i=s,o=-1}}t.input.composing=!0}uV(t,Cve)};bo.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,uV(t,20))};function uV(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>Tb(t),e))}function dV(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=Tve());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function Pve(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=xye(e.focusNode,e.focusOffset),r=Sye(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let i=r.pmViewDesc,o=t.domObserver.lastChangedTextNode;if(n==o||r==o)return o;if(!i||!i.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let s=n.pmViewDesc;if(!(!s||!s.isText(n.nodeValue)))return r}}return n||r}function Tve(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function Tb(t,e=!1){if(!(cc&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),dV(t),e||t.docView&&t.docView.dirty){let n=kA(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function Eve(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),i=document.createRange();i.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const cy=Yo&&Cu<15||pf&&_ye<604;So.copy=bo.cut=(t,e)=>{let n=e,r=t.state.selection,i=n.type=="cut";if(r.empty)return;let o=cy?null:n.clipboardData,s=r.content(),{dom:a,text:l}=_A(t,s);o?(n.preventDefault(),o.clearData(),o.setData("text/html",a.innerHTML),o.setData("text/plain",l)):Eve(t,a),i&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function Ave(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function Mve(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let i=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?uy(t,r.value,null,i,e):uy(t,r.textContent,r.innerHTML,i,e)},50)}function uy(t,e,n,r,i){let o=nV(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,i,o||He.empty)))return!0;if(!o)return!1;let s=Ave(o),a=s?t.state.tr.replaceSelectionWith(s,r):t.state.tr.replaceSelection(o);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function hV(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}bo.paste=(t,e)=>{let n=e;if(t.composing&&!cc)return;let r=cy?null:n.clipboardData,i=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&uy(t,hV(r),r.getData("text/html"),i,n)?n.preventDefault():Mve(t,n)};let pV=class{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}};const Ove=Zs?"altKey":"ctrlKey";function fV(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[Ove]}So.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let i=t.state.selection,o=i.empty?null:t.posAtCoords(I0(n)),s;if(!(o&&o.pos>=i.from&&o.pos<=(i instanceof ot?i.to-1:i.to))){if(r&&r.mightDrag)s=ot.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let u=t.docView.nearestDesc(n.target,!0);u&&u.node.type.spec.draggable&&u!=t.docView&&(s=ot.create(t.state.doc,u.posBefore))}}let a=(s||t.state.selection).content(),{dom:l,text:c,slice:d}=_A(t,a);(!n.dataTransfer.files.length||!Wi||FW>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(cy?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",cy||n.dataTransfer.setData("text/plain",c),t.dragging=new pV(d,fV(t,n),s)};So.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};bo.dragover=bo.dragenter=(t,e)=>e.preventDefault();bo.drop=(t,e)=>{let n=e,r=t.dragging;if(t.dragging=null,!n.dataTransfer)return;let i=t.posAtCoords(I0(n));if(!i)return;let o=t.state.doc.resolve(i.pos),s=r&&r.slice;s?t.someProp("transformPasted",y=>{s=y(s,t,!1)}):s=nV(t,hV(n.dataTransfer),cy?null:n.dataTransfer.getData("text/html"),!1,o);let a=!!(r&&fV(t,n));if(t.someProp("handleDrop",y=>y(t,n,s||He.empty,a))){n.preventDefault();return}if(!s)return;n.preventDefault();let l=s?MW(t.state.doc,o.pos,s):o.pos;l==null&&(l=o.pos);let c=t.state.tr;if(a){let{node:y}=r;y?y.replace(c):c.deleteSelection()}let d=c.mapping.map(l),u=s.openStart==0&&s.openEnd==0&&s.content.childCount==1,p=c.doc;if(u?c.replaceRangeWith(d,d,s.content.firstChild):c.replaceRange(d,d,s),c.doc.eq(p))return;let f=c.doc.resolve(d);if(u&&ot.isSelectable(s.content.firstChild)&&f.nodeAfter&&f.nodeAfter.sameMarkup(s.content.firstChild))c.setSelection(new ot(f));else{let y=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach((v,x,b,w)=>y=w),c.setSelection(IA(t,f,c.doc.resolve(y)))}t.focus(),t.dispatch(c.setMeta("uiEvent","drop"))};So.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&fc(t)},20))};So.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};So.beforeinput=(t,e)=>{if(Wi&&cc&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",o=>o(t,Ad(8,"Backspace")))))return;let{$cursor:i}=t.state.selection;i&&i.pos>0&&t.dispatch(t.state.tr.delete(i.pos-1,i.pos).scrollIntoView())},50)}};for(let t in bo)So[t]=bo[t];function dy(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class Eb{constructor(e,n){this.toDOM=e,this.spec=n||Wd,this.side=this.spec.side||0}map(e,n,r,i){let{pos:o,deleted:s}=e.mapResult(n.from+i,this.side<0?-1:1);return s?null:new ia(o-r,o-r,this)}valid(){return!0}eq(e){return this==e||e instanceof Eb&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&dy(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Tu{constructor(e,n){this.attrs=e,this.spec=n||Wd}map(e,n,r,i){let o=e.map(n.from+i,this.spec.inclusiveStart?-1:1)-r,s=e.map(n.to+i,this.spec.inclusiveEnd?1:-1)-r;return o>=s?null:new ia(o,s,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof Tu&&dy(this.attrs,e.attrs)&&dy(this.spec,e.spec)}static is(e){return e.type instanceof Tu}destroy(){}}class EA{constructor(e,n){this.attrs=e,this.spec=n||Wd}map(e,n,r,i){let o=e.mapResult(n.from+i,1);if(o.deleted)return null;let s=e.mapResult(n.to+i,-1);return s.deleted||s.pos<=o.pos?null:new ia(o.pos-r,s.pos-r,this)}valid(e,n){let{index:r,offset:i}=e.content.findIndex(n.from),o;return i==n.from&&!(o=e.child(r)).isText&&i+o.nodeSize==n.to}eq(e){return this==e||e instanceof EA&&dy(this.attrs,e.attrs)&&dy(this.spec,e.spec)}destroy(){}}class ia{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new ia(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new ia(e,e,new Eb(n,r))}static inline(e,n,r,i){return new ia(e,n,new Tu(r,i))}static node(e,n,r,i){return new ia(e,n,new EA(r,i))}get spec(){return this.type.spec}get inline(){return this.type instanceof Tu}get widget(){return this.type instanceof Eb}}const Mp=[],Wd={};class Fr{constructor(e,n){this.local=e.length?e:Mp,this.children=n.length?n:Mp}static create(e,n){return n.length?Ab(n,e,0,Wd):Fi}find(e,n,r){let i=[];return this.findInner(e??0,n??1e9,i,0,r),i}findInner(e,n,r,i,o){for(let s=0;s<this.local.length;s++){let a=this.local[s];a.from<=n&&a.to>=e&&(!o||o(a.spec))&&r.push(a.copy(a.from+i,a.to+i))}for(let s=0;s<this.children.length;s+=3)if(this.children[s]<n&&this.children[s+1]>e){let a=this.children[s]+1;this.children[s+2].findInner(e-a,n-a,r,i+a,o)}}map(e,n,r){return this==Fi||e.maps.length==0?this:this.mapInner(e,n,0,0,r||Wd)}mapInner(e,n,r,i,o){let s;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,i);l&&l.type.valid(n,l)?(s||(s=[])).push(l):o.onRemove&&o.onRemove(this.local[a].spec)}return this.children.length?Dve(this.children,s||[],e,n,r,i,o):s?new Fr(s.sort(Vd),Mp):Fi}add(e,n){return n.length?this==Fi?Fr.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let i,o=0;e.forEach((a,l)=>{let c=l+r,d;if(d=mV(n,a,c)){for(i||(i=this.children.slice());o<i.length&&i[o]<l;)o+=3;i[o]==l?i[o+2]=i[o+2].addInner(a,d,c+1):i.splice(o,0,l,l+a.nodeSize,Ab(d,a,c+1,Wd)),o+=3}});let s=gV(o?yV(n):n,-r);for(let a=0;a<s.length;a++)s[a].type.valid(e,s[a])||s.splice(a--,1);return new Fr(s.length?this.local.concat(s).sort(Vd):this.local,i||this.children)}remove(e){return e.length==0||this==Fi?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,i=this.local;for(let o=0;o<r.length;o+=3){let s,a=r[o]+n,l=r[o+1]+n;for(let d=0,u;d<e.length;d++)(u=e[d])&&u.from>a&&u.to<l&&(e[d]=null,(s||(s=[])).push(u));if(!s)continue;r==this.children&&(r=this.children.slice());let c=r[o+2].removeInner(s,a+1);c!=Fi?r[o+2]=c:(r.splice(o,3),o-=3)}if(i.length){for(let o=0,s;o<e.length;o++)if(s=e[o])for(let a=0;a<i.length;a++)i[a].eq(s,n)&&(i==this.local&&(i=this.local.slice()),i.splice(a--,1))}return r==this.children&&i==this.local?this:i.length||r.length?new Fr(i,r):Fi}forChild(e,n){if(this==Fi)return this;if(n.isLeaf)return Fr.empty;let r,i;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let o=e+1,s=o+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<s&&l.to>o&&l.type instanceof Tu){let c=Math.max(o,l.from)-o,d=Math.min(s,l.to)-o;c<d&&(i||(i=[])).push(l.copy(c,d))}}if(i){let a=new Fr(i.sort(Vd),Mp);return r?new mu([a,r]):a}return r||Fi}eq(e){if(this==e)return!0;if(!(e instanceof Fr)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return AA(this.localsInner(e))}localsInner(e){if(this==Fi)return Mp;if(e.inlineContent||!this.local.some(Tu.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof Tu||n.push(this.local[r]);return n}forEachSet(e){e(this)}}Fr.empty=new Fr([],[]);Fr.removeOverlap=AA;const Fi=Fr.empty;class mu{constructor(e){this.members=e}map(e,n){const r=this.members.map(i=>i.map(e,n,Wd));return mu.from(r)}forChild(e,n){if(n.isLeaf)return Fr.empty;let r=[];for(let i=0;i<this.members.length;i++){let o=this.members[i].forChild(e,n);o!=Fi&&(o instanceof mu?r=r.concat(o.members):r.push(o))}return mu.from(r)}eq(e){if(!(e instanceof mu)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let i=0;i<this.members.length;i++){let o=this.members[i].localsInner(e);if(o.length)if(!n)n=o;else{r&&(n=n.slice(),r=!1);for(let s=0;s<o.length;s++)n.push(o[s])}}return n?AA(r?n:n.sort(Vd)):Mp}static from(e){switch(e.length){case 0:return Fi;case 1:return e[0];default:return new mu(e.every(n=>n instanceof Fr)?e:e.reduce((n,r)=>n.concat(r instanceof Fr?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function Dve(t,e,n,r,i,o,s){let a=t.slice();for(let c=0,d=o;c<n.maps.length;c++){let u=0;n.maps[c].forEach((p,f,y,v)=>{let x=v-y-(f-p);for(let b=0;b<a.length;b+=3){let w=a[b+1];if(w<0||p>w+d-u)continue;let _=a[b]+d-u;f>=_?a[b+1]=p<=_?-2:-1:p>=d&&x&&(a[b]+=x,a[b+1]+=x)}u+=x}),d=n.maps[c].map(d,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let d=n.map(t[c]+o),u=d-i;if(u<0||u>=r.content.size){l=!0;continue}let p=n.map(t[c+1]+o,-1),f=p-i,{index:y,offset:v}=r.content.findIndex(u),x=r.maybeChild(y);if(x&&v==u&&v+x.nodeSize==f){let b=a[c+2].mapInner(n,x,d+1,t[c]+o+1,s);b!=Fi?(a[c]=u,a[c+1]=f,a[c+2]=b):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=jve(a,t,e,n,i,o,s),d=Ab(c,r,0,s);e=d.local;for(let u=0;u<a.length;u+=3)a[u+1]<0&&(a.splice(u,3),u-=3);for(let u=0,p=0;u<d.children.length;u+=3){let f=d.children[u];for(;p<a.length&&a[p]<f;)p+=3;a.splice(p,0,d.children[u],d.children[u+1],d.children[u+2])}}return new Fr(e.sort(Vd),a)}function gV(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let i=t[r];n.push(new ia(i.from+e,i.to+e,i.type))}return n}function jve(t,e,n,r,i,o,s){function a(l,c){for(let d=0;d<l.local.length;d++){let u=l.local[d].map(r,i,c);u?n.push(u):s.onRemove&&s.onRemove(l.local[d].spec)}for(let d=0;d<l.children.length;d+=3)a(l.children[d+2],l.children[d]+c+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+o+1);return n}function mV(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,i=null;for(let o=0,s;o<t.length;o++)(s=t[o])&&s.from>n&&s.to<r&&((i||(i=[])).push(s),t[o]=null);return i}function yV(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function Ab(t,e,n,r){let i=[],o=!1;e.forEach((a,l)=>{let c=mV(t,a,l+n);if(c){o=!0;let d=Ab(c,a,n+l+1,r);d!=Fi&&i.push(l,l+a.nodeSize,d)}});let s=gV(o?yV(t):t,-n).sort(Vd);for(let a=0;a<s.length;a++)s[a].type.valid(e,s[a])||(r.onRemove&&r.onRemove(s[a].spec),s.splice(a--,1));return s.length||i.length?new Fr(s,i):Fi}function Vd(t,e){return t.from-e.from||t.to-e.to}function AA(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let i=n+1;i<e.length;i++){let o=e[i];if(o.from==r.from){o.to!=r.to&&(e==t&&(e=t.slice()),e[i]=o.copy(o.from,r.to),AF(e,i+1,o.copy(r.to,o.to)));continue}else{o.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,o.from),AF(e,i,r.copy(o.from,r.to)));break}}}return e}function AF(t,e,n){for(;e<t.length&&Vd(n,t[e])>0;)e++;t.splice(e,0,n)}function cP(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=Fi&&e.push(r)}),t.cursorWrapper&&e.push(Fr.create(t.state.doc,[t.cursorWrapper.deco])),mu.from(e)}const Rve={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},$ve=Yo&&Cu<=11;class Nve{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class Lve{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new Nve,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let i=0;i<r.length;i++)this.queue.push(r[i]);Yo&&Cu<=11&&r.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),$ve&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Rve)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(wF(this.view)){if(this.suppressingSelectionUpdates)return fc(this.view);if(Yo&&Cu<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&oh(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let o=e.focusNode;o;o=hf(o))n.add(o);for(let o=e.anchorNode;o;o=hf(o))if(n.has(o)){r=o;break}let i=r&&this.view.docView.nearestDesc(r);if(i&&i.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let r=e.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&wF(e)&&!this.ignoreSelectionChange(r),o=-1,s=-1,a=!1,l=[];if(e.editable)for(let d=0;d<n.length;d++){let u=this.registerMutation(n[d],l);u&&(o=o<0?u.from:Math.min(u.from,o),s=s<0?u.to:Math.max(u.to,s),u.typeOver&&(a=!0))}if(aa&&l.length){let d=l.filter(u=>u.nodeName=="BR");if(d.length==2){let[u,p]=d;u.parentNode&&u.parentNode.parentNode==p.parentNode?p.remove():u.remove()}else{let{focusNode:u}=this.currentSelection;for(let p of d){let f=p.parentNode;f&&f.nodeName=="LI"&&(!u||Bve(e,u)!=f)&&p.remove()}}}let c=null;o<0&&i&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&w0(r)&&(c=kA(e))&&c.eq(Mt.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,fc(e),this.currentSelection.set(r),e.scrollToSelection()):(o>-1||i)&&(o>-1&&(e.docView.markDirty(o,s),zve(e)),this.handleDOMChange(o,s,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||fc(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let d=0;d<e.addedNodes.length;d++){let u=e.addedNodes[d];n.push(u),u.nodeType==3&&(this.lastChangedTextNode=u)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let i=e.previousSibling,o=e.nextSibling;if(Yo&&Cu<=11&&e.addedNodes.length)for(let d=0;d<e.addedNodes.length;d++){let{previousSibling:u,nextSibling:p}=e.addedNodes[d];(!u||Array.prototype.indexOf.call(e.addedNodes,u)<0)&&(i=u),(!p||Array.prototype.indexOf.call(e.addedNodes,p)<0)&&(o=p)}let s=i&&i.parentNode==e.target?yi(i)+1:0,a=r.localPosFromDOM(e.target,s,-1),l=o&&o.parentNode==e.target?yi(o):e.target.childNodes.length,c=r.localPosFromDOM(e.target,l,1);return{from:a,to:c}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let MF=new WeakMap,OF=!1;function zve(t){if(!MF.has(t)&&(MF.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=aa,OF)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),OF=!0}}function DF(t,e){let n=e.startContainer,r=e.startOffset,i=e.endContainer,o=e.endOffset,s=t.domAtPos(t.state.selection.anchor);return oh(s.node,s.offset,i,o)&&([n,r,i,o]=[i,o,n,r]),{anchorNode:n,anchorOffset:r,focusNode:i,focusOffset:o}}function Fve(t,e){if(e.getComposedRanges){let i=e.getComposedRanges(t.root)[0];if(i)return DF(t,i)}let n;function r(i){i.preventDefault(),i.stopImmediatePropagation(),n=i.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?DF(t,n):null}function Bve(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function Uve(t,e,n){let{node:r,fromOffset:i,toOffset:o,from:s,to:a}=t.docView.parseRange(e,n),l=t.domSelectionRange(),c,d=l.anchorNode;if(d&&t.dom.contains(d.nodeType==1?d:d.parentNode)&&(c=[{node:d,offset:l.anchorOffset}],w0(l)||c.push({node:l.focusNode,offset:l.focusOffset})),Wi&&t.input.lastKeyCode===8)for(let x=o;x>i;x--){let b=r.childNodes[x-1],w=b.pmViewDesc;if(b.nodeName=="BR"&&!w){o=x;break}if(!w||w.size)break}let u=t.state.doc,p=t.someProp("domParser")||Gp.fromSchema(t.state.schema),f=u.resolve(s),y=null,v=p.parse(r,{topNode:f.parent,topMatch:f.parent.contentMatchAt(f.index()),topOpen:!0,from:i,to:o,preserveWhitespace:f.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:Hve,context:f});if(c&&c[0].pos!=null){let x=c[0].pos,b=c[1]&&c[1].pos;b==null&&(b=x),y={anchor:x+s,head:b+s}}return{doc:v,sel:y,from:s,to:a}}function Hve(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(xo&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||xo&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const Wve=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Vve(t,e,n,r,i){let o=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let O=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,D=kA(t,O);if(D&&!t.state.selection.eq(D)){if(Wi&&cc&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",L=>L(t,Ad(13,"Enter"))))return;let B=t.state.tr.setSelection(D);O=="pointer"?B.setMeta("pointer",!0):O=="key"&&B.scrollIntoView(),o&&B.setMeta("composition",o),t.dispatch(B)}return}let s=t.state.doc.resolve(e),a=s.sharedDepth(n);e=s.before(a+1),n=t.state.doc.resolve(n).after(a+1);let l=t.state.selection,c=Uve(t,e,n),d=t.state.doc,u=d.slice(c.from,c.to),p,f;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(p=t.state.selection.to,f="end"):(p=t.state.selection.from,f="start"),t.input.lastKeyCode=null;let y=Gve(u.content,c.doc.content,c.from,p,f);if(y&&t.input.domChangeCount++,(pf&&t.input.lastIOSEnter>Date.now()-225||cc)&&i.some(O=>O.nodeType==1&&!Wve.test(O.nodeName))&&(!y||y.endA>=y.endB)&&t.someProp("handleKeyDown",O=>O(t,Ad(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!y)if(r&&l instanceof wt&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))y={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let O=jF(t,t.state.doc,c.sel);if(O&&!O.eq(t.state.selection)){let D=t.state.tr.setSelection(O);o&&D.setMeta("composition",o),t.dispatch(D)}}return}t.state.selection.from<t.state.selection.to&&y.start==y.endB&&t.state.selection instanceof wt&&(y.start>t.state.selection.from&&y.start<=t.state.selection.from+2&&t.state.selection.from>=c.from?y.start=t.state.selection.from:y.endA<t.state.selection.to&&y.endA>=t.state.selection.to-2&&t.state.selection.to<=c.to&&(y.endB+=t.state.selection.to-y.endA,y.endA=t.state.selection.to)),Yo&&Cu<=11&&y.endB==y.start+1&&y.endA==y.start&&y.start>c.from&&c.doc.textBetween(y.start-c.from-1,y.start-c.from+1)=="  "&&(y.start--,y.endA--,y.endB--);let v=c.doc.resolveNoCache(y.start-c.from),x=c.doc.resolveNoCache(y.endB-c.from),b=d.resolve(y.start),w=v.sameParent(x)&&v.parent.inlineContent&&b.end()>=y.endA;if((pf&&t.input.lastIOSEnter>Date.now()-225&&(!w||i.some(O=>O.nodeName=="DIV"||O.nodeName=="P"))||!w&&v.pos<c.doc.content.size&&(!v.sameParent(x)||!v.parent.inlineContent)&&v.pos<x.pos&&!/\S/.test(c.doc.textBetween(v.pos,x.pos,"","")))&&t.someProp("handleKeyDown",O=>O(t,Ad(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>y.start&&qve(d,y.start,y.endA,v,x)&&t.someProp("handleKeyDown",O=>O(t,Ad(8,"Backspace")))){cc&&Wi&&t.domObserver.suppressSelectionUpdates();return}Wi&&y.endB==y.start&&(t.input.lastChromeDelete=Date.now()),cc&&!w&&v.start()!=x.start()&&x.parentOffset==0&&v.depth==x.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==y.endA&&(y.endB-=2,x=c.doc.resolveNoCache(y.endB-c.from),setTimeout(()=>{t.someProp("handleKeyDown",function(O){return O(t,Ad(13,"Enter"))})},20));let _=y.start,C=y.endA,A=O=>{let D=O||t.state.tr.replace(_,C,c.doc.slice(y.start-c.from,y.endB-c.from));if(c.sel){let B=jF(t,D.doc,c.sel);B&&!(Wi&&t.composing&&B.empty&&(y.start!=y.endB||t.input.lastChromeDelete<Date.now()-100)&&(B.head==_||B.head==D.mapping.map(C)-1)||Yo&&B.empty&&B.head==_)&&D.setSelection(B)}return o&&D.setMeta("composition",o),D.scrollIntoView()},E;if(w)if(v.pos==x.pos){Yo&&Cu<=11&&v.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>fc(t),20));let O=A(t.state.tr.delete(_,C)),D=d.resolve(y.start).marksAcross(d.resolve(y.endA));D&&O.ensureMarks(D),t.dispatch(O)}else if(y.endA==y.endB&&(E=Kve(v.parent.content.cut(v.parentOffset,x.parentOffset),b.parent.content.cut(b.parentOffset,y.endA-b.start())))){let O=A(t.state.tr);E.type=="add"?O.addMark(_,C,E.mark):O.removeMark(_,C,E.mark),t.dispatch(O)}else if(v.parent.child(v.index()).isText&&v.index()==x.index()-(x.textOffset?0:1)){let O=v.parent.textBetween(v.parentOffset,x.parentOffset),D=()=>A(t.state.tr.insertText(O,_,C));t.someProp("handleTextInput",B=>B(t,_,C,O,D))||t.dispatch(D())}else t.dispatch(A());else t.dispatch(A())}function jF(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:IA(t,e.resolve(n.anchor),e.resolve(n.head))}function Kve(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,i=n,o=r,s,a,l;for(let d=0;d<r.length;d++)i=r[d].removeFromSet(i);for(let d=0;d<n.length;d++)o=n[d].removeFromSet(o);if(i.length==1&&o.length==0)a=i[0],s="add",l=d=>d.mark(a.addToSet(d.marks));else if(i.length==0&&o.length==1)a=o[0],s="remove",l=d=>d.mark(a.removeFromSet(d.marks));else return null;let c=[];for(let d=0;d<e.childCount;d++)c.push(l(e.child(d)));if(Pe.from(c).eq(t))return{mark:a,type:s}}function qve(t,e,n,r,i){if(n-e<=i.pos-r.pos||uP(r,!0,!1)<i.pos)return!1;let o=t.resolve(e);if(!r.parent.isTextblock){let a=o.nodeAfter;return a!=null&&n==e+a.nodeSize}if(o.parentOffset<o.parent.content.size||!o.parent.isTextblock)return!1;let s=t.resolve(uP(o,!0,!0));return!s.parent.isTextblock||s.pos>n||uP(s,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(s.parent.content)}function uP(t,e,n){let r=t.depth,i=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,i++,e=!1;if(n){let o=t.node(r).maybeChild(t.indexAfter(r));for(;o&&!o.isLeaf;)o=o.firstChild,i++}return i}function Gve(t,e,n,r,i){let o=t.findDiffStart(e,n);if(o==null)return null;let{a:s,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if(i=="end"){let l=Math.max(0,o-Math.min(s,a));r-=s+l-o}if(s<o&&t.size<e.size){let l=r<=o&&r>=s?o-r:0;o-=l,o&&o<e.size&&RF(e.textBetween(o-1,o+1))&&(o+=l?1:-1),a=o+(a-s),s=o}else if(a<o){let l=r<=o&&r>=a?o-r:0;o-=l,o&&o<t.size&&RF(t.textBetween(o-1,o+1))&&(o+=l?1:-1),s=o+(s-a),a=o}return{start:o,endA:s,endB:a}}function RF(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class vV{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new pve,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(FF),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=LF(this),NF(this),this.nodeViews=zF(this),this.docView=mF(this.state.doc,$F(this),cP(this),this.dom,this),this.domObserver=new Lve(this,(r,i,o,s)=>Vve(this,r,i,o,s)),this.domObserver.start(),fve(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&ZT(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(FF),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var r;let i=this.state,o=!1,s=!1;e.storedMarks&&this.composing&&(dV(this),s=!0),this.state=e;let a=i.plugins!=e.plugins||this._props.plugins!=n.plugins;if(a||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let f=zF(this);Xve(f,this.nodeViews)&&(this.nodeViews=f,o=!0)}(a||n.handleDOMEvents!=this._props.handleDOMEvents)&&ZT(this),this.editable=LF(this),NF(this);let l=cP(this),c=$F(this),d=i.plugins!=e.plugins&&!i.doc.eq(e.doc)?"reset":e.scrollToSelection>i.scrollToSelection?"to selection":"preserve",u=o||!this.docView.matchesNode(e.doc,c,l);(u||!e.selection.eq(i.selection))&&(s=!0);let p=d=="preserve"&&s&&this.dom.style.overflowAnchor==null&&Tye(this);if(s){this.domObserver.stop();let f=u&&(Yo||Wi)&&!this.composing&&!i.selection.empty&&!e.selection.empty&&Yve(i.selection,e.selection);if(u){let y=Wi?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=Pve(this)),(o||!this.docView.update(e.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=mF(e.doc,c,l,this.dom,this)),y&&!this.trackWrites&&(f=!0)}f||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&Jye(this))?fc(this,f):(QW(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(i),!((r=this.dragging)===null||r===void 0)&&r.node&&!i.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,i),d=="reset"?this.dom.scrollTop=0:d=="to selection"?this.scrollToSelection():p&&Eye(p)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof ot){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&uF(this,n.getBoundingClientRect(),e)}else uF(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}updateDraggedNode(e,n){let r=e.node,i=-1;if(this.state.doc.nodeAt(r.from)==r.node)i=r.from;else{let o=r.from+(this.state.doc.content.size-n.doc.content.size);(o>0&&this.state.doc.nodeAt(o))==r.node&&(i=o)}this.dragging=new pV(e.slice,e.move,i<0?void 0:ot.create(this.state.doc,i))}someProp(e,n){let r=this._props&&this._props[e],i;if(r!=null&&(i=n?n(r):r))return i;for(let s=0;s<this.directPlugins.length;s++){let a=this.directPlugins[s].props[e];if(a!=null&&(i=n?n(a):a))return i}let o=this.state.plugins;if(o)for(let s=0;s<o.length;s++){let a=o[s].props[e];if(a!=null&&(i=n?n(a):a))return i}}hasFocus(){if(Yo){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&Aye(this.dom),fc(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return Rye(this,e)}coordsAtPos(e,n=1){return VW(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let i=this.docView.posFromDOM(e,n,r);if(i==null)throw new RangeError("DOM position not inside the editor");return i}endOfTextblock(e,n){return Fye(this,n||this.state,e)}pasteHTML(e,n){return uy(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return uy(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return _A(this,e)}destroy(){this.docView&&(gve(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],cP(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,yye())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return yve(this,e)}domSelectionRange(){let e=this.domSelection();return e?xo&&this.root.nodeType===11&&wye(this.dom.ownerDocument)==this.dom&&Fve(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}vV.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function $F(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"?e.class+=" "+n[r]:r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[ia.node(0,t.state.doc.content.size,e)]}function NF(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:ia.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function LF(t){return!t.someProp("editable",e=>e(t.state)===!1)}function Yve(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function zF(t){let e=Object.create(null);function n(r){for(let i in r)Object.prototype.hasOwnProperty.call(e,i)||(e[i]=r[i])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function Xve(t,e){let n=0,r=0;for(let i in t){if(t[i]!=e[i])return!0;n++}for(let i in e)r++;return n!=r}function FF(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Du={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Mb={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Zve=typeof navigator<"u"&&/Mac/.test(navigator.platform),Jve=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var vi=0;vi<10;vi++)Du[48+vi]=Du[96+vi]=String(vi);for(var vi=1;vi<=24;vi++)Du[vi+111]="F"+vi;for(var vi=65;vi<=90;vi++)Du[vi]=String.fromCharCode(vi+32),Mb[vi]=String.fromCharCode(vi);for(var dP in Du)Mb.hasOwnProperty(dP)||(Mb[dP]=Du[dP]);function Qve(t){var e=Zve&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||Jve&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?Mb:Du)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const exe=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),txe=typeof navigator<"u"&&/Win/.test(navigator.platform);function nxe(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,i,o,s;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))o=!0;else if(/^mod$/i.test(l))exe?s=!0:i=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),i&&(n="Ctrl-"+n),s&&(n="Meta-"+n),o&&(n="Shift-"+n),n}function rxe(t){let e=Object.create(null);for(let n in t)e[nxe(n)]=t[n];return e}function hP(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function ixe(t){return new _i({props:{handleKeyDown:xV(t)}})}function xV(t){let e=rxe(t);return function(n,r){let i=Qve(r),o,s=e[hP(i,r)];if(s&&s(n.state,n.dispatch,n))return!0;if(i.length==1&&i!=" "){if(r.shiftKey){let a=e[hP(i,r,!1)];if(a&&a(n.state,n.dispatch,n))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(txe&&r.ctrlKey&&r.altKey)&&(o=Du[r.keyCode])&&o!=i){let a=e[hP(o,r)];if(a&&a(n.state,n.dispatch,n))return!0}}return!1}}const MA=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function SV(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const bV=(t,e,n)=>{let r=SV(t,n);if(!r)return!1;let i=OA(r);if(!i){let s=r.blockRange(),a=s&&$f(s);return a==null?!1:(e&&e(t.tr.lift(s,a).scrollIntoView()),!0)}let o=i.nodeBefore;if(AV(t,i,e,-1))return!0;if(r.parent.content.size==0&&(ff(o,"end")||ot.isSelectable(o)))for(let s=r.depth;;s--){let a=S0(t.doc,r.before(s),r.after(s),He.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=t.tr.step(a);l.setSelection(ff(o,"end")?Mt.findFrom(l.doc.resolve(l.mapping.map(i.pos,-1)),-1):ot.create(l.doc,i.pos-o.nodeSize)),e(l.scrollIntoView())}return!0}if(s==1||r.node(s-1).childCount>1)break}return o.isAtom&&i.depth==r.depth-1?(e&&e(t.tr.delete(i.pos-o.nodeSize,i.pos).scrollIntoView()),!0):!1},oxe=(t,e,n)=>{let r=SV(t,n);if(!r)return!1;let i=OA(r);return i?wV(t,i,e):!1},sxe=(t,e,n)=>{let r=IV(t,n);if(!r)return!1;let i=DA(r);return i?wV(t,i,e):!1};function wV(t,e,n){let r=e.nodeBefore,i=r,o=e.pos-1;for(;!i.isTextblock;o--){if(i.type.spec.isolating)return!1;let d=i.lastChild;if(!d)return!1;i=d}let s=e.nodeAfter,a=s,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let d=a.firstChild;if(!d)return!1;a=d}let c=S0(t.doc,o,l,He.empty);if(!c||c.from!=o||c instanceof Xr&&c.slice.size>=l-o)return!1;if(n){let d=t.tr.step(c);d.setSelection(wt.create(d.doc,o)),n(d.scrollIntoView())}return!0}function ff(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const kV=(t,e,n)=>{let{$head:r,empty:i}=t.selection,o=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;o=OA(r)}let s=o&&o.nodeBefore;return!s||!ot.isSelectable(s)?!1:(e&&e(t.tr.setSelection(ot.create(t.doc,o.pos-s.nodeSize)).scrollIntoView()),!0)};function OA(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function IV(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const _V=(t,e,n)=>{let r=IV(t,n);if(!r)return!1;let i=DA(r);if(!i)return!1;let o=i.nodeAfter;if(AV(t,i,e,1))return!0;if(r.parent.content.size==0&&(ff(o,"start")||ot.isSelectable(o))){let s=S0(t.doc,r.before(),r.after(),He.empty);if(s&&s.slice.size<s.to-s.from){if(e){let a=t.tr.step(s);a.setSelection(ff(o,"start")?Mt.findFrom(a.doc.resolve(a.mapping.map(i.pos)),1):ot.create(a.doc,a.mapping.map(i.pos))),e(a.scrollIntoView())}return!0}}return o.isAtom&&i.depth==r.depth-1?(e&&e(t.tr.delete(i.pos,i.pos+o.nodeSize).scrollIntoView()),!0):!1},CV=(t,e,n)=>{let{$head:r,empty:i}=t.selection,o=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;o=DA(r)}let s=o&&o.nodeAfter;return!s||!ot.isSelectable(s)?!1:(e&&e(t.tr.setSelection(ot.create(t.doc,o.pos)).scrollIntoView()),!0)};function DA(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const axe=(t,e)=>{let n=t.selection,r=n instanceof ot,i;if(r){if(n.node.isTextblock||!Xu(t.doc,n.from))return!1;i=n.from}else if(i=x0(t.doc,n.from,-1),i==null)return!1;if(e){let o=t.tr.join(i);r&&o.setSelection(ot.create(o.doc,i-t.doc.resolve(i).nodeBefore.nodeSize)),e(o.scrollIntoView())}return!0},lxe=(t,e)=>{let n=t.selection,r;if(n instanceof ot){if(n.node.isTextblock||!Xu(t.doc,n.to))return!1;r=n.to}else if(r=x0(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},cxe=(t,e)=>{let{$from:n,$to:r}=t.selection,i=n.blockRange(r),o=i&&$f(i);return o==null?!1:(e&&e(t.tr.lift(i,o).scrollIntoView()),!0)},PV=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function jA(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const uxe=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let i=n.node(-1),o=n.indexAfter(-1),s=jA(i.contentMatchAt(o));if(!s||!i.canReplaceWith(o,o,s))return!1;if(e){let a=n.after(),l=t.tr.replaceWith(a,a,s.createAndFill());l.setSelection(Mt.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},TV=(t,e)=>{let n=t.selection,{$from:r,$to:i}=n;if(n instanceof Is||r.parent.inlineContent||i.parent.inlineContent)return!1;let o=jA(i.parent.contentMatchAt(i.indexAfter()));if(!o||!o.isTextblock)return!1;if(e){let s=(!r.parentOffset&&i.index()<i.parent.childCount?r:i).pos,a=t.tr.insert(s,o.createAndFill());a.setSelection(wt.create(a.doc,s+1)),e(a.scrollIntoView())}return!0},EV=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let o=n.before();if(pc(t.doc,o))return e&&e(t.tr.split(o).scrollIntoView()),!0}let r=n.blockRange(),i=r&&$f(r);return i==null?!1:(e&&e(t.tr.lift(r,i).scrollIntoView()),!0)};function dxe(t){return(e,n)=>{let{$from:r,$to:i}=e.selection;if(e.selection instanceof ot&&e.selection.node.isBlock)return!r.parentOffset||!pc(e.doc,r.pos)?!1:(n&&n(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.depth)return!1;let o=[],s,a,l=!1,c=!1;for(let f=r.depth;;f--)if(r.node(f).isBlock){l=r.end(f)==r.pos+(r.depth-f),c=r.start(f)==r.pos-(r.depth-f),a=jA(r.node(f-1).contentMatchAt(r.indexAfter(f-1))),o.unshift(l&&a?{type:a}:null),s=f;break}else{if(f==1)return!1;o.unshift(null)}let d=e.tr;(e.selection instanceof wt||e.selection instanceof Is)&&d.deleteSelection();let u=d.mapping.map(r.pos),p=pc(d.doc,u,o.length,o);if(p||(o[0]=a?{type:a}:null,p=pc(d.doc,u,o.length,o)),!p)return!1;if(d.split(u,o.length,o),!l&&c&&r.node(s).type!=a){let f=d.mapping.map(r.before(s)),y=d.doc.resolve(f);a&&r.node(s-1).canReplaceWith(y.index(),y.index()+1,a)&&d.setNodeMarkup(d.mapping.map(r.before(s)),a)}return n&&n(d.scrollIntoView()),!0}}const hxe=dxe(),pxe=(t,e)=>{let{$from:n,to:r}=t.selection,i,o=n.sharedDepth(r);return o==0?!1:(i=n.before(o),e&&e(t.tr.setSelection(ot.create(t.doc,i))),!0)};function fxe(t,e,n){let r=e.nodeBefore,i=e.nodeAfter,o=e.index();return!r||!i||!r.type.compatibleContent(i.type)?!1:!r.content.size&&e.parent.canReplace(o-1,o)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(o,o+1)||!(i.isTextblock||Xu(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function AV(t,e,n,r){let i=e.nodeBefore,o=e.nodeAfter,s,a,l=i.type.spec.isolating||o.type.spec.isolating;if(!l&&fxe(t,e,n))return!0;let c=!l&&e.parent.canReplace(e.index(),e.index()+1);if(c&&(s=(a=i.contentMatchAt(i.childCount)).findWrapping(o.type))&&a.matchType(s[0]||o.type).validEnd){if(n){let f=e.pos+o.nodeSize,y=Pe.empty;for(let b=s.length-1;b>=0;b--)y=Pe.from(s[b].create(null,y));y=Pe.from(i.copy(y));let v=t.tr.step(new ei(e.pos-1,f,e.pos,f,new He(y,1,0),s.length,!0)),x=v.doc.resolve(f+2*s.length);x.nodeAfter&&x.nodeAfter.type==i.type&&Xu(v.doc,x.pos)&&v.join(x.pos),n(v.scrollIntoView())}return!0}let d=o.type.spec.isolating||r>0&&l?null:Mt.findFrom(e,1),u=d&&d.$from.blockRange(d.$to),p=u&&$f(u);if(p!=null&&p>=e.depth)return n&&n(t.tr.lift(u,p).scrollIntoView()),!0;if(c&&ff(o,"start",!0)&&ff(i,"end")){let f=i,y=[];for(;y.push(f),!f.isTextblock;)f=f.lastChild;let v=o,x=1;for(;!v.isTextblock;v=v.firstChild)x++;if(f.canReplace(f.childCount,f.childCount,v.content)){if(n){let b=Pe.empty;for(let _=y.length-1;_>=0;_--)b=Pe.from(y[_].copy(b));let w=t.tr.step(new ei(e.pos-y.length,e.pos+o.nodeSize,e.pos+x,e.pos+o.nodeSize-x,new He(b,y.length,0),0,!0));n(w.scrollIntoView())}return!0}}return!1}function MV(t){return function(e,n){let r=e.selection,i=t<0?r.$from:r.$to,o=i.depth;for(;i.node(o).isInline;){if(!o)return!1;o--}return i.node(o).isTextblock?(n&&n(e.tr.setSelection(wt.create(e.doc,t<0?i.start(o):i.end(o)))),!0):!1}}const gxe=MV(-1),mxe=MV(1);function yxe(t,e=null){return function(n,r){let{$from:i,$to:o}=n.selection,s=i.blockRange(o),a=s&&SA(s,t,e);return a?(r&&r(n.tr.wrap(s,a).scrollIntoView()),!0):!1}}function BF(t,e=null){return function(n,r){let i=!1;for(let o=0;o<n.selection.ranges.length&&!i;o++){let{$from:{pos:s},$to:{pos:a}}=n.selection.ranges[o];n.doc.nodesBetween(s,a,(l,c)=>{if(i)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)i=!0;else{let d=n.doc.resolve(c),u=d.index();i=d.parent.canReplaceWith(u,u+1,t)}})}if(!i)return!1;if(r){let o=n.tr;for(let s=0;s<n.selection.ranges.length;s++){let{$from:{pos:a},$to:{pos:l}}=n.selection.ranges[s];o.setBlockType(a,l,t,e)}r(o.scrollIntoView())}return!0}}function RA(...t){return function(e,n,r){for(let i=0;i<t.length;i++)if(t[i](e,n,r))return!0;return!1}}RA(MA,bV,kV);RA(MA,_V,CV);RA(PV,TV,EV,hxe);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function vxe(t,e=null){return function(n,r){let{$from:i,$to:o}=n.selection,s=i.blockRange(o);if(!s)return!1;let a=r?n.tr:null;return xxe(a,s,t,e)?(r&&r(a.scrollIntoView()),!0):!1}}function xxe(t,e,n,r=null){let i=!1,o=e,s=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=s.resolve(e.start-2);o=new Ib(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new Ib(e.$from,s.resolve(e.$to.end(e.depth)),e.depth)),i=!0}let a=SA(o,n,r,e);return a?(t&&Sxe(t,e,a,i,n),!0):!1}function Sxe(t,e,n,r,i){let o=Pe.empty;for(let d=n.length-1;d>=0;d--)o=Pe.from(n[d].type.create(n[d].attrs,o));t.step(new ei(e.start-(r?2:0),e.end,e.start,e.end,new He(o,0,0),n.length,!0));let s=0;for(let d=0;d<n.length;d++)n[d].type==i&&(s=d+1);let a=n.length-s,l=e.start+n.length-(r?2:0),c=e.parent;for(let d=e.startIndex,u=e.endIndex,p=!0;d<u;d++,p=!1)!p&&pc(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=c.child(d).nodeSize;return t}function bxe(t){return function(e,n){let{$from:r,$to:i}=e.selection,o=r.blockRange(i,s=>s.childCount>0&&s.firstChild.type==t);return o?n?r.node(o.depth-1).type==t?wxe(e,n,t,o):kxe(e,n,o):!0:!1}}function wxe(t,e,n,r){let i=t.tr,o=r.end,s=r.$to.end(r.depth);o<s&&(i.step(new ei(o-1,s,o,s,new He(Pe.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new Ib(i.doc.resolve(r.$from.pos),i.doc.resolve(s),r.depth));const a=$f(r);if(a==null)return!1;i.lift(r,a);let l=i.doc.resolve(i.mapping.map(o,-1)-1);return Xu(i.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&i.join(l.pos),e(i.scrollIntoView()),!0}function kxe(t,e,n){let r=t.tr,i=n.parent;for(let f=n.end,y=n.endIndex-1,v=n.startIndex;y>v;y--)f-=i.child(y).nodeSize,r.delete(f-1,f+1);let o=r.doc.resolve(n.start),s=o.nodeAfter;if(r.mapping.map(n.end)!=n.start+o.nodeAfter.nodeSize)return!1;let a=n.startIndex==0,l=n.endIndex==i.childCount,c=o.node(-1),d=o.index(-1);if(!c.canReplace(d+(a?0:1),d+1,s.content.append(l?Pe.empty:Pe.from(i))))return!1;let u=o.pos,p=u+s.nodeSize;return r.step(new ei(u-(a?1:0),p+(l?1:0),u+1,p-1,new He((a?Pe.empty:Pe.from(i.copy(Pe.empty))).append(l?Pe.empty:Pe.from(i.copy(Pe.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function Ixe(t){return function(e,n){let{$from:r,$to:i}=e.selection,o=r.blockRange(i,c=>c.childCount>0&&c.firstChild.type==t);if(!o)return!1;let s=o.startIndex;if(s==0)return!1;let a=o.parent,l=a.child(s-1);if(l.type!=t)return!1;if(n){let c=l.lastChild&&l.lastChild.type==a.type,d=Pe.from(c?t.create():null),u=new He(Pe.from(t.create(null,Pe.from(a.type.create(null,d)))),c?3:1,0),p=o.start,f=o.end;n(e.tr.step(new ei(p-(c?3:1),f,p,f,u,1,!0)).scrollIntoView())}return!0}}function _0(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:i}=n,{storedMarks:o}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return o},get selection(){return r},get doc(){return i},get tr(){return r=n.selection,i=n.doc,o=n.storedMarks,n}}}class C0{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:n,state:r}=this,{view:i}=n,{tr:o}=r,s=this.buildProps(o);return Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...d)=>{const u=l(...d)(s);return!o.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(o),u}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,n=!0){const{rawCommands:r,editor:i,state:o}=this,{view:s}=i,a=[],l=!!e,c=e||o.tr,d=()=>(!l&&n&&!c.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(c),a.every(p=>p===!0)),u={...Object.fromEntries(Object.entries(r).map(([p,f])=>[p,(...v)=>{const x=this.buildProps(c,n),b=f(...v)(x);return a.push(b),u}])),run:d};return u}createCan(e){const{rawCommands:n,state:r}=this,i=!1,o=e||r.tr,s=this.buildProps(o,i);return{...Object.fromEntries(Object.entries(n).map(([l,c])=>[l,(...d)=>c(...d)({...s,dispatch:void 0})])),chain:()=>this.createChain(o,i)}}buildProps(e,n=!0){const{rawCommands:r,editor:i,state:o}=this,{view:s}=i,a={tr:e,editor:i,view:s,state:_0({state:o,transaction:e}),dispatch:n?()=>{}:void 0,chain:()=>this.createChain(e,n),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(r).map(([l,c])=>[l,(...d)=>c(...d)(a)]))}};return a}}class _xe{constructor(){this.callbacks={}}on(e,n){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(n),this}emit(e,...n){const r=this.callbacks[e];return r&&r.forEach(i=>i.apply(this,n)),this}off(e,n){const r=this.callbacks[e];return r&&(n?this.callbacks[e]=r.filter(i=>i!==n):delete this.callbacks[e]),this}once(e,n){const r=(...i)=>{this.off(e,r),n.apply(this,i)};return this.on(e,r)}removeAllListeners(){this.callbacks={}}}function Ze(t,e,n){return t.config[e]===void 0&&t.parent?Ze(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?Ze(t.parent,e,n):null}):t.config[e]}function P0(t){const e=t.filter(i=>i.type==="extension"),n=t.filter(i=>i.type==="node"),r=t.filter(i=>i.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function OV(t){const e=[],{nodeExtensions:n,markExtensions:r}=P0(t),i=[...n,...r],o={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(s=>{const a={name:s.name,options:s.options,storage:s.storage,extensions:i},l=Ze(s,"addGlobalAttributes",a);if(!l)return;l().forEach(d=>{d.types.forEach(u=>{Object.entries(d.attributes).forEach(([p,f])=>{e.push({type:u,name:p,attribute:{...o,...f}})})})})}),i.forEach(s=>{const a={name:s.name,options:s.options,storage:s.storage},l=Ze(s,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([d,u])=>{const p={...o,...u};typeof p?.default=="function"&&(p.default=p.default()),p?.isRequired&&p?.default===void 0&&delete p.default,e.push({type:s.name,name:d,attribute:p})})}),e}function ni(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function ri(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([i,o])=>{if(!r[i]){r[i]=o;return}if(i==="class"){const a=o?String(o).split(" "):[],l=r[i]?r[i].split(" "):[],c=a.filter(d=>!l.includes(d));r[i]=[...l,...c].join(" ")}else if(i==="style"){const a=o?o.split(";").map(d=>d.trim()).filter(Boolean):[],l=r[i]?r[i].split(";").map(d=>d.trim()).filter(Boolean):[],c=new Map;l.forEach(d=>{const[u,p]=d.split(":").map(f=>f.trim());c.set(u,p)}),a.forEach(d=>{const[u,p]=d.split(":").map(f=>f.trim());c.set(u,p)}),r[i]=Array.from(c.entries()).map(([d,u])=>`${d}: ${u}`).join("; ")}else r[i]=o}),r},{})}function JT(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>ri(n,r),{})}function DV(t){return typeof t=="function"}function Nt(t,e=void 0,...n){return DV(t)?e?t.bind(e)(...n):t(...n):t}function Cxe(t={}){return Object.keys(t).length===0&&t.constructor===Object}function Pxe(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function UF(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const i=e.reduce((o,s)=>{const a=s.attribute.parseHTML?s.attribute.parseHTML(n):Pxe(n.getAttribute(s.name));return a==null?o:{...o,[s.name]:a}},{});return{...r,...i}}}}function HF(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&Cxe(n)?!1:n!=null))}function jV(t,e){var n;const r=OV(t),{nodeExtensions:i,markExtensions:o}=P0(t),s=(n=i.find(c=>Ze(c,"topNode")))===null||n===void 0?void 0:n.name,a=Object.fromEntries(i.map(c=>{const d=r.filter(b=>b.type===c.name),u={name:c.name,options:c.options,storage:c.storage,editor:e},p=t.reduce((b,w)=>{const _=Ze(w,"extendNodeSchema",u);return{...b,..._?_(c):{}}},{}),f=HF({...p,content:Nt(Ze(c,"content",u)),marks:Nt(Ze(c,"marks",u)),group:Nt(Ze(c,"group",u)),inline:Nt(Ze(c,"inline",u)),atom:Nt(Ze(c,"atom",u)),selectable:Nt(Ze(c,"selectable",u)),draggable:Nt(Ze(c,"draggable",u)),code:Nt(Ze(c,"code",u)),whitespace:Nt(Ze(c,"whitespace",u)),linebreakReplacement:Nt(Ze(c,"linebreakReplacement",u)),defining:Nt(Ze(c,"defining",u)),isolating:Nt(Ze(c,"isolating",u)),attrs:Object.fromEntries(d.map(b=>{var w;return[b.name,{default:(w=b?.attribute)===null||w===void 0?void 0:w.default}]}))}),y=Nt(Ze(c,"parseHTML",u));y&&(f.parseDOM=y.map(b=>UF(b,d)));const v=Ze(c,"renderHTML",u);v&&(f.toDOM=b=>v({node:b,HTMLAttributes:JT(b,d)}));const x=Ze(c,"renderText",u);return x&&(f.toText=x),[c.name,f]})),l=Object.fromEntries(o.map(c=>{const d=r.filter(x=>x.type===c.name),u={name:c.name,options:c.options,storage:c.storage,editor:e},p=t.reduce((x,b)=>{const w=Ze(b,"extendMarkSchema",u);return{...x,...w?w(c):{}}},{}),f=HF({...p,inclusive:Nt(Ze(c,"inclusive",u)),excludes:Nt(Ze(c,"excludes",u)),group:Nt(Ze(c,"group",u)),spanning:Nt(Ze(c,"spanning",u)),code:Nt(Ze(c,"code",u)),attrs:Object.fromEntries(d.map(x=>{var b;return[x.name,{default:(b=x?.attribute)===null||b===void 0?void 0:b.default}]}))}),y=Nt(Ze(c,"parseHTML",u));y&&(f.parseDOM=y.map(x=>UF(x,d)));const v=Ze(c,"renderHTML",u);return v&&(f.toDOM=x=>v({mark:x,HTMLAttributes:JT(x,d)})),[c.name,f]}));return new SW({topNode:s,nodes:a,marks:l})}function pP(t,e){return e.nodes[t]||e.marks[t]||null}function WF(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function T0(t,e){const n=Ph.fromSchema(e).serializeFragment(t),i=document.implementation.createHTMLDocument().createElement("div");return i.appendChild(n),i.innerHTML}const Txe=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(i,o,s,a)=>{var l,c;const d=((c=(l=i.type.spec).toText)===null||c===void 0?void 0:c.call(l,{node:i,pos:o,parent:s,index:a}))||i.textContent||"%leaf%";n+=i.isAtom&&!i.isText?d:d.slice(0,Math.max(0,r-o))}),n};function $A(t){return Object.prototype.toString.call(t)==="[object RegExp]"}class E0{constructor(e){this.find=e.find,this.handler=e.handler}}const Exe=(t,e)=>{if($A(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function Kx(t){var e;const{editor:n,from:r,to:i,text:o,rules:s,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(r);if(c.parent.type.spec.code||!((e=c.nodeBefore||c.nodeAfter)===null||e===void 0)&&e.marks.find(p=>p.type.spec.code))return!1;let d=!1;const u=Txe(c)+o;return s.forEach(p=>{if(d)return;const f=Exe(u,p.find);if(!f)return;const y=l.state.tr,v=_0({state:l.state,transaction:y}),x={from:r-(f[0].length-o.length),to:i},{commands:b,chain:w,can:_}=new C0({editor:n,state:v});p.handler({state:v,range:x,match:f,commands:b,chain:w,can:_})===null||!y.steps.length||(y.setMeta(a,{transform:y,from:r,to:i,text:o}),l.dispatch(y),d=!0)}),d}function Axe(t){const{editor:e,rules:n}=t,r=new _i({state:{init(){return null},apply(i,o,s){const a=i.getMeta(r);if(a)return a;const l=i.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:d}=l;typeof d=="string"?d=d:d=T0(Pe.from(d),s.schema);const{from:u}=l,p=u+d.length;Kx({editor:e,from:u,to:p,text:d,rules:n,plugin:r})}),i.selectionSet||i.docChanged?null:o}},props:{handleTextInput(i,o,s,a){return Kx({editor:e,from:o,to:s,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:i=>(setTimeout(()=>{const{$cursor:o}=i.state.selection;o&&Kx({editor:e,from:o.pos,to:o.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(i,o){if(o.key!=="Enter")return!1;const{$cursor:s}=i.state.selection;return s?Kx({editor:e,from:s.pos,to:s.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function Mxe(t){return Object.prototype.toString.call(t).slice(8,-1)}function qx(t){return Mxe(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function A0(t,e){const n={...t};return qx(t)&&qx(e)&&Object.keys(e).forEach(r=>{qx(e[r])&&qx(t[r])?n[r]=A0(t[r],e[r]):n[r]=e[r]}),n}class El{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Nt(Ze(this,"addOptions",{name:this.name}))),this.storage=Nt(Ze(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new El(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>A0(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new El(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=Nt(Ze(n,"addOptions",{name:n.name})),n.storage=Nt(Ze(n,"addStorage",{name:n.name,options:n.options})),n}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,i=e.state.selection.$from;if(i.pos===i.end()){const s=i.marks();if(!!!s.find(c=>c?.type.name===n.name))return!1;const l=s.find(c=>c?.type.name===n.name);return l&&r.removeStoredMark(l),r.insertText(" ",i.pos),e.view.dispatch(r),!0}return!1}}function Oxe(t){return typeof t=="number"}class Dxe{constructor(e){this.find=e.find,this.handler=e.handler}}const jxe=(t,e,n)=>{if($A(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(i=>{const o=[i.text];return o.index=i.index,o.input=t,o.data=i.data,i.replaceWith&&(i.text.includes(i.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),o.push(i.replaceWith)),o}):[]};function Rxe(t){const{editor:e,state:n,from:r,to:i,rule:o,pasteEvent:s,dropEvent:a}=t,{commands:l,chain:c,can:d}=new C0({editor:e,state:n}),u=[];return n.doc.nodesBetween(r,i,(f,y)=>{if(!f.isTextblock||f.type.spec.code)return;const v=Math.max(r,y),x=Math.min(i,y+f.content.size),b=f.textBetween(v-y,x-y,void 0,"￼");jxe(b,o.find,s).forEach(_=>{if(_.index===void 0)return;const C=v+_.index+1,A=C+_[0].length,E={from:n.tr.mapping.map(C),to:n.tr.mapping.map(A)},O=o.handler({state:n,range:E,match:_,commands:l,chain:c,can:d,pasteEvent:s,dropEvent:a});u.push(O)})}),u.every(f=>f!==null)}let Gx=null;const $xe=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)===null||e===void 0||e.setData("text/html",t),n};function Nxe(t){const{editor:e,rules:n}=t;let r=null,i=!1,o=!1,s=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:d,from:u,to:p,rule:f,pasteEvt:y})=>{const v=d.tr,x=_0({state:d,transaction:v});if(!(!Rxe({editor:e,state:x,from:Math.max(u-1,0),to:p.b-1,rule:f,pasteEvent:y,dropEvent:a})||!v.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return s=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,v}};return n.map(d=>new _i({view(u){const p=y=>{var v;r=!((v=u.dom.parentElement)===null||v===void 0)&&v.contains(y.target)?u.dom.parentElement:null,r&&(Gx=e)},f=()=>{Gx&&(Gx=null)};return window.addEventListener("dragstart",p),window.addEventListener("dragend",f),{destroy(){window.removeEventListener("dragstart",p),window.removeEventListener("dragend",f)}}},props:{handleDOMEvents:{drop:(u,p)=>{if(o=r===u.dom.parentElement,a=p,!o){const f=Gx;f?.isEditable&&setTimeout(()=>{const y=f.state.selection;y&&f.commands.deleteRange({from:y.from,to:y.to})},10)}return!1},paste:(u,p)=>{var f;const y=(f=p.clipboardData)===null||f===void 0?void 0:f.getData("text/html");return s=p,i=!!y?.includes("data-pm-slice"),!1}}},appendTransaction:(u,p,f)=>{const y=u[0],v=y.getMeta("uiEvent")==="paste"&&!i,x=y.getMeta("uiEvent")==="drop"&&!o,b=y.getMeta("applyPasteRules"),w=!!b;if(!v&&!x&&!w)return;if(w){let{text:A}=b;typeof A=="string"?A=A:A=T0(Pe.from(A),f.schema);const{from:E}=b,O=E+A.length,D=$xe(A);return l({rule:d,state:f,from:E,to:{b:O},pasteEvt:D})}const _=p.doc.content.findDiffStart(f.doc.content),C=p.doc.content.findDiffEnd(f.doc.content);if(!(!Oxe(_)||!C||_===C.b))return l({rule:d,state:f,from:_,to:C,pasteEvt:s})}}))}function Lxe(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}class jd{constructor(e,n){this.splittableMarks=[],this.editor=n,this.extensions=jd.resolve(e),this.schema=jV(this.extensions,n),this.setupExtensions()}static resolve(e){const n=jd.sort(jd.flatten(e)),r=Lxe(n.map(i=>i.name));return r.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${r.map(i=>`'${i}'`).join(", ")}]. This can lead to issues.`),n}static flatten(e){return e.map(n=>{const r={name:n.name,options:n.options,storage:n.storage},i=Ze(n,"addExtensions",r);return i?[n,...this.flatten(i())]:n}).flat(10)}static sort(e){return e.sort((r,i)=>{const o=Ze(r,"priority")||100,s=Ze(i,"priority")||100;return o>s?-1:o<s?1:0})}get commands(){return this.extensions.reduce((e,n)=>{const r={name:n.name,options:n.options,storage:n.storage,editor:this.editor,type:pP(n.name,this.schema)},i=Ze(n,"addCommands",r);return i?{...e,...i()}:e},{})}get plugins(){const{editor:e}=this,n=jd.sort([...this.extensions].reverse()),r=[],i=[],o=n.map(s=>{const a={name:s.name,options:s.options,storage:s.storage,editor:e,type:pP(s.name,this.schema)},l=[],c=Ze(s,"addKeyboardShortcuts",a);let d={};if(s.type==="mark"&&Ze(s,"exitable",a)&&(d.ArrowRight=()=>El.handleExit({editor:e,mark:s})),c){const v=Object.fromEntries(Object.entries(c()).map(([x,b])=>[x,()=>b({editor:e})]));d={...d,...v}}const u=ixe(d);l.push(u);const p=Ze(s,"addInputRules",a);WF(s,e.options.enableInputRules)&&p&&r.push(...p());const f=Ze(s,"addPasteRules",a);WF(s,e.options.enablePasteRules)&&f&&i.push(...f());const y=Ze(s,"addProseMirrorPlugins",a);if(y){const v=y();l.push(...v)}return l}).flat();return[Axe({editor:e,rules:r}),...Nxe({editor:e,rules:i}),...o]}get attributes(){return OV(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:n}=P0(this.extensions);return Object.fromEntries(n.filter(r=>!!Ze(r,"addNodeView")).map(r=>{const i=this.attributes.filter(l=>l.type===r.name),o={name:r.name,options:r.options,storage:r.storage,editor:e,type:ni(r.name,this.schema)},s=Ze(r,"addNodeView",o);if(!s)return[];const a=(l,c,d,u,p)=>{const f=JT(l,i);return s()({node:l,view:c,getPos:d,decorations:u,innerDecorations:p,editor:e,extension:r,HTMLAttributes:f})};return[r.name,a]}))}setupExtensions(){this.extensions.forEach(e=>{var n;this.editor.extensionStorage[e.name]=e.storage;const r={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:pP(e.name,this.schema)};e.type==="mark"&&(!((n=Nt(Ze(e,"keepOnSplit",r)))!==null&&n!==void 0)||n)&&this.splittableMarks.push(e.name);const i=Ze(e,"onBeforeCreate",r),o=Ze(e,"onCreate",r),s=Ze(e,"onUpdate",r),a=Ze(e,"onSelectionUpdate",r),l=Ze(e,"onTransaction",r),c=Ze(e,"onFocus",r),d=Ze(e,"onBlur",r),u=Ze(e,"onDestroy",r);i&&this.editor.on("beforeCreate",i),o&&this.editor.on("create",o),s&&this.editor.on("update",s),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),d&&this.editor.on("blur",d),u&&this.editor.on("destroy",u)})}}class wi{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Nt(Ze(this,"addOptions",{name:this.name}))),this.storage=Nt(Ze(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new wi(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>A0(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new wi({...this.config,...e});return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=Nt(Ze(n,"addOptions",{name:n.name})),n.storage=Nt(Ze(n,"addStorage",{name:n.name,options:n.options})),n}}function RV(t,e,n){const{from:r,to:i}=e,{blockSeparator:o=`

`,textSerializers:s={}}=n||{};let a="";return t.nodesBetween(r,i,(l,c,d,u)=>{var p;l.isBlock&&c>r&&(a+=o);const f=s?.[l.type.name];if(f)return d&&(a+=f({node:l,pos:c,parent:d,index:u,range:e})),!1;l.isText&&(a+=(p=l?.text)===null||p===void 0?void 0:p.slice(Math.max(r,c)-c,i-c))}),a}function NA(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}const zxe=wi.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new _i({key:new As("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:i}=e,{ranges:o}=i,s=Math.min(...o.map(d=>d.$from.pos)),a=Math.max(...o.map(d=>d.$to.pos)),l=NA(n);return RV(r,{from:s,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),Fxe=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window?.getSelection())===null||n===void 0||n.removeAllRanges())}),!0),Bxe=(t=!1)=>({commands:e})=>e.setContent("",t),Uxe=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:i}=r;return n&&i.forEach(({$from:o,$to:s})=>{t.doc.nodesBetween(o.pos,s.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:d}=e,u=c.resolve(d.map(l)),p=c.resolve(d.map(l+a.nodeSize)),f=u.blockRange(p);if(!f)return;const y=$f(f);if(a.type.isTextblock){const{defaultType:v}=u.parent.contentMatchAt(u.index());e.setNodeMarkup(f.start,v)}(y||y===0)&&e.lift(f,y)})}),!0},Hxe=t=>e=>t(e),Wxe=()=>({state:t,dispatch:e})=>TV(t,e),Vxe=(t,e)=>({editor:n,tr:r})=>{const{state:i}=n,o=i.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const s=r.mapping.map(e);return r.insert(s,o.content),r.setSelection(new wt(r.doc.resolve(Math.max(s-1,0)))),!0},Kxe=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const i=t.selection.$anchor;for(let o=i.depth;o>0;o-=1)if(i.node(o).type===r.type){if(e){const a=i.before(o),l=i.after(o);t.delete(a,l).scrollIntoView()}return!0}return!1},qxe=t=>({tr:e,state:n,dispatch:r})=>{const i=ni(t,n.schema),o=e.selection.$anchor;for(let s=o.depth;s>0;s-=1)if(o.node(s).type===i){if(r){const l=o.before(s),c=o.after(s);e.delete(l,c).scrollIntoView()}return!0}return!1},Gxe=t=>({tr:e,dispatch:n})=>{const{from:r,to:i}=t;return n&&e.delete(r,i),!0},Yxe=()=>({state:t,dispatch:e})=>MA(t,e),Xxe=()=>({commands:t})=>t.keyboardShortcut("Enter"),Zxe=()=>({state:t,dispatch:e})=>uxe(t,e);function Ob(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(i=>n.strict?e[i]===t[i]:$A(e[i])?e[i].test(t[i]):e[i]===t[i]):!0}function $V(t,e,n={}){return t.find(r=>r.type===e&&Ob(Object.fromEntries(Object.keys(n).map(i=>[i,r.attrs[i]])),n))}function VF(t,e,n={}){return!!$V(t,e,n)}function M0(t,e,n){var r;if(!t||!e)return;let i=t.parent.childAfter(t.parentOffset);if((!i.node||!i.node.marks.some(d=>d.type===e))&&(i=t.parent.childBefore(t.parentOffset)),!i.node||!i.node.marks.some(d=>d.type===e)||(n=n||((r=i.node.marks[0])===null||r===void 0?void 0:r.attrs),!$V([...i.node.marks],e,n)))return;let s=i.index,a=t.start()+i.offset,l=s+1,c=a+i.node.nodeSize;for(;s>0&&VF([...t.parent.child(s-1).marks],e,n);)s-=1,a-=t.parent.child(s).nodeSize;for(;l<t.parent.childCount&&VF([...t.parent.child(l).marks],e,n);)c+=t.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function Ju(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const Jxe=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const o=Ju(t,r.schema),{doc:s,selection:a}=n,{$from:l,from:c,to:d}=a;if(i){const u=M0(l,o,e);if(u&&u.from<=c&&u.to>=d){const p=wt.create(s,u.from,u.to);n.setSelection(p)}}return!0},Qxe=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function NV(t){return t instanceof wt}function Rd(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function LV(t,e=null){if(!e)return null;const n=Mt.atStart(t),r=Mt.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const i=n.from,o=r.to;return e==="all"?wt.create(t,Rd(0,i,o),Rd(t.content.size,i,o)):wt.create(t,Rd(e,i,o),Rd(e,i,o))}function eSe(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function LA(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const tSe=(t=null,e={})=>({editor:n,view:r,tr:i,dispatch:o})=>{e={scrollIntoView:!0,...e};const s=()=>{(LA()||eSe())&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e?.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(o&&t===null&&!NV(n.state.selection))return s(),!0;const a=LV(i.doc,t)||n.state.selection,l=n.state.selection.eq(a);return o&&(l||i.setSelection(a),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),s()),!0},nSe=(t,e)=>n=>t.every((r,i)=>e(r,{...n,index:i})),rSe=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),zV=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&zV(r)}return t};function pm(t){const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return zV(n)}function hy(t,e,n){if(t instanceof Fa||t instanceof Pe)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,i=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return Pe.fromArray(t.map(a=>e.nodeFromJSON(a)));const s=e.nodeFromJSON(t);return n.errorOnInvalidContent&&s.check(),s}catch(o){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:o});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",o),hy("",e,n)}if(i){if(n.errorOnInvalidContent){let s=!1,a="";const l=new SW({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(s=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(n.slice?Gp.fromSchema(l).parseSlice(pm(t),n.parseOptions):Gp.fromSchema(l).parse(pm(t),n.parseOptions),n.errorOnInvalidContent&&s)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const o=Gp.fromSchema(e);return n.slice?o.parseSlice(pm(t),n.parseOptions).content:o.parse(pm(t),n.parseOptions)}return hy("",e,n)}function iSe(t,e,n){const r=t.steps.length-1;if(r<e)return;const i=t.steps[r];if(!(i instanceof Xr||i instanceof ei))return;const o=t.mapping.maps[r];let s=0;o.forEach((a,l,c,d)=>{s===0&&(s=d)}),t.setSelection(Mt.near(t.doc.resolve(s),n))}const oSe=t=>!("type"in t),sSe=(t,e,n)=>({tr:r,dispatch:i,editor:o})=>{var s;if(i){n={parseOptions:o.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const l=x=>{o.emit("contentError",{editor:o,error:x,disableCollaboration:()=>{o.storage.collaboration&&(o.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!o.options.enableContentCheck&&o.options.emitContentError)try{hy(e,o.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(x){l(x)}try{a=hy(e,o.schema,{parseOptions:c,errorOnInvalidContent:(s=n.errorOnInvalidContent)!==null&&s!==void 0?s:o.options.enableContentCheck})}catch(x){return l(x),!1}let{from:d,to:u}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},p=!0,f=!0;if((oSe(a)?a:[a]).forEach(x=>{x.check(),p=p?x.isText&&x.marks.length===0:!1,f=f?x.isBlock:!1}),d===u&&f){const{parent:x}=r.doc.resolve(d);x.isTextblock&&!x.type.spec.code&&!x.childCount&&(d-=1,u+=1)}let v;if(p){if(Array.isArray(e))v=e.map(x=>x.text||"").join("");else if(e instanceof Pe){let x="";e.forEach(b=>{b.text&&(x+=b.text)}),v=x}else typeof e=="object"&&e&&e.text?v=e.text:v=e;r.insertText(v,d,u)}else v=a,r.replaceWith(d,u,v);n.updateSelection&&iSe(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:d,text:v}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:d,text:v})}return!0},aSe=()=>({state:t,dispatch:e})=>axe(t,e),lSe=()=>({state:t,dispatch:e})=>lxe(t,e),cSe=()=>({state:t,dispatch:e})=>bV(t,e),uSe=()=>({state:t,dispatch:e})=>_V(t,e),dSe=()=>({state:t,dispatch:e,tr:n})=>{try{const r=x0(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},hSe=()=>({state:t,dispatch:e,tr:n})=>{try{const r=x0(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},pSe=()=>({state:t,dispatch:e})=>oxe(t,e),fSe=()=>({state:t,dispatch:e})=>sxe(t,e);function FV(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function gSe(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,i,o,s;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))i=!0;else if(/^s(hift)?$/i.test(l))o=!0;else if(/^mod$/i.test(l))LA()||FV()?s=!0:i=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),i&&(n=`Ctrl-${n}`),s&&(n=`Meta-${n}`),o&&(n=`Shift-${n}`),n}const mSe=t=>({editor:e,view:n,tr:r,dispatch:i})=>{const o=gSe(t).split(/-(?!$)/),s=o.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:s==="Space"?" ":s,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,a))});return l?.steps.forEach(c=>{const d=c.map(r.mapping);d&&i&&r.maybeStep(d)}),!0};function py(t,e,n={}){const{from:r,to:i,empty:o}=t.selection,s=e?ni(e,t.schema):null,a=[];t.doc.nodesBetween(r,i,(u,p)=>{if(u.isText)return;const f=Math.max(r,p),y=Math.min(i,p+u.nodeSize);a.push({node:u,from:f,to:y})});const l=i-r,c=a.filter(u=>s?s.name===u.node.type.name:!0).filter(u=>Ob(u.node.attrs,n,{strict:!1}));return o?!!c.length:c.reduce((u,p)=>u+p.to-p.from,0)>=l}const ySe=(t,e={})=>({state:n,dispatch:r})=>{const i=ni(t,n.schema);return py(n,i,e)?cxe(n,r):!1},vSe=()=>({state:t,dispatch:e})=>EV(t,e),xSe=t=>({state:e,dispatch:n})=>{const r=ni(t,e.schema);return bxe(r)(e,n)},SSe=()=>({state:t,dispatch:e})=>PV(t,e);function O0(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function KF(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,i)=>(n.includes(i)||(r[i]=t[i]),r),{})}const bSe=(t,e)=>({tr:n,state:r,dispatch:i})=>{let o=null,s=null;const a=O0(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(o=ni(t,r.schema)),a==="mark"&&(s=Ju(t,r.schema)),i&&n.selection.ranges.forEach(l=>{r.doc.nodesBetween(l.$from.pos,l.$to.pos,(c,d)=>{o&&o===c.type&&n.setNodeMarkup(d,void 0,KF(c.attrs,e)),s&&c.marks.length&&c.marks.forEach(u=>{s===u.type&&n.addMark(d,d+c.nodeSize,s.create(KF(u.attrs,e)))})})}),!0):!1},wSe=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),kSe=()=>({tr:t,dispatch:e})=>{if(e){const n=new Is(t.doc);t.setSelection(n)}return!0},ISe=()=>({state:t,dispatch:e})=>kV(t,e),_Se=()=>({state:t,dispatch:e})=>CV(t,e),CSe=()=>({state:t,dispatch:e})=>pxe(t,e),PSe=()=>({state:t,dispatch:e})=>mxe(t,e),TSe=()=>({state:t,dispatch:e})=>gxe(t,e);function QT(t,e,n={},r={}){return hy(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}const ESe=(t,e=!1,n={},r={})=>({editor:i,tr:o,dispatch:s,commands:a})=>{var l,c;const{doc:d}=o;if(n.preserveWhitespace!=="full"){const u=QT(t,i.schema,n,{errorOnInvalidContent:(l=r.errorOnInvalidContent)!==null&&l!==void 0?l:i.options.enableContentCheck});return s&&o.replaceWith(0,d.content.size,u).setMeta("preventUpdate",!e),!0}return s&&o.setMeta("preventUpdate",!e),a.insertContentAt({from:0,to:d.content.size},t,{parseOptions:n,errorOnInvalidContent:(c=r.errorOnInvalidContent)!==null&&c!==void 0?c:i.options.enableContentCheck})};function BV(t,e){const n=Ju(e,t.schema),{from:r,to:i,empty:o}=t.selection,s=[];o?(t.storedMarks&&s.push(...t.storedMarks),s.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,i,l=>{s.push(...l.marks)});const a=s.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function ASe(t,e){const n=new $W(t);return e.forEach(r=>{r.steps.forEach(i=>{n.step(i)})}),n}function MSe(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function OSe(t,e,n){const r=[];return t.nodesBetween(e.from,e.to,(i,o)=>{n(i)&&r.push({node:i,pos:o})}),r}function DSe(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function zA(t){return e=>DSe(e.$from,t)}function D0(t,e){const n=jd.resolve(t);return jV(n,e)}function jSe(t,e){const n=D0(e),r=Fa.fromJSON(n,t);return T0(r.content,n)}function RSe(t,e){const n=D0(e),r=pm(t);return Gp.fromSchema(n).parse(r).toJSON()}function UV(t,e){const n={from:0,to:t.content.size};return RV(t,n,e)}function $Se(t,e,n){const{blockSeparator:r=`

`,textSerializers:i={}}=n||{},o=D0(e),s=Fa.fromJSON(o,t);return UV(s,{blockSeparator:r,textSerializers:{...NA(o),...i}})}function NSe(t,e){const n=ni(e,t.schema),{from:r,to:i}=t.selection,o=[];t.doc.nodesBetween(r,i,a=>{o.push(a)});const s=o.reverse().find(a=>a.type.name===n.name);return s?{...s.attrs}:{}}function HV(t,e){const n=O0(typeof e=="string"?e:e.name,t.schema);return n==="node"?NSe(t,e):n==="mark"?BV(t,e):{}}function LSe(t,e=JSON.stringify){const n={};return t.filter(r=>{const i=e(r);return Object.prototype.hasOwnProperty.call(n,i)?!1:n[i]=!0})}function zSe(t){const e=LSe(t);return e.length===1?e:e.filter((n,r)=>!e.filter((o,s)=>s!==r).some(o=>n.oldRange.from>=o.oldRange.from&&n.oldRange.to<=o.oldRange.to&&n.newRange.from>=o.newRange.from&&n.newRange.to<=o.newRange.to))}function FSe(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((i,o)=>{const s=[];if(i.ranges.length)i.forEach((a,l)=>{s.push({from:a,to:l})});else{const{from:a,to:l}=n[o];if(a===void 0||l===void 0)return;s.push({from:a,to:l})}s.forEach(({from:a,to:l})=>{const c=e.slice(o).map(a,-1),d=e.slice(o).map(l),u=e.invert().map(c,-1),p=e.invert().map(d);r.push({oldRange:{from:u,to:p},newRange:{from:c,to:d}})})}),zSe(r)}function FA(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(i=>{const o=n.resolve(t),s=M0(o,i.type);s&&r.push({mark:i,...s})}):n.nodesBetween(t,e,(i,o)=>{!i||i?.nodeSize===void 0||r.push(...i.marks.map(s=>({from:o,to:o+i.nodeSize,mark:s})))}),r}function US(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const i=t.find(o=>o.type===e&&o.name===r);return i?i.attribute.keepOnSplit:!1}))}function eE(t,e,n={}){const{empty:r,ranges:i}=t.selection,o=e?Ju(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(u=>o?o.name===u.type.name:!0).find(u=>Ob(u.attrs,n,{strict:!1}));let s=0;const a=[];if(i.forEach(({$from:u,$to:p})=>{const f=u.pos,y=p.pos;t.doc.nodesBetween(f,y,(v,x)=>{if(!v.isText&&!v.marks.length)return;const b=Math.max(f,x),w=Math.min(y,x+v.nodeSize),_=w-b;s+=_,a.push(...v.marks.map(C=>({mark:C,from:b,to:w})))})}),s===0)return!1;const l=a.filter(u=>o?o.name===u.mark.type.name:!0).filter(u=>Ob(u.mark.attrs,n,{strict:!1})).reduce((u,p)=>u+p.to-p.from,0),c=a.filter(u=>o?u.mark.type!==o&&u.mark.type.excludes(o):!0).reduce((u,p)=>u+p.to-p.from,0);return(l>0?l+c:l)>=s}function BSe(t,e,n={}){if(!e)return py(t,null,n)||eE(t,null,n);const r=O0(e,t.schema);return r==="node"?py(t,e,n):r==="mark"?eE(t,e,n):!1}function qF(t,e){const{nodeExtensions:n}=P0(e),r=n.find(s=>s.name===t);if(!r)return!1;const i={name:r.name,options:r.options,storage:r.storage},o=Nt(Ze(r,"group",i));return typeof o!="string"?!1:o.split(" ").includes("list")}function BA(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!==null&&r!==void 0?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let i=!0;return t.content.forEach(o=>{i!==!1&&(BA(o,{ignoreWhitespace:n,checkChildren:e})||(i=!1))}),i}return!1}function USe(t){return t instanceof ot}function HSe(t,e,n){var r;const{selection:i}=e;let o=null;if(NV(i)&&(o=i.$cursor),o){const a=(r=t.storedMarks)!==null&&r!==void 0?r:o.marks();return!!n.isInSet(a)||!a.some(l=>l.type.excludes(n))}const{ranges:s}=i;return s.some(({$from:a,$to:l})=>{let c=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(d,u,p)=>{if(c)return!1;if(d.isInline){const f=!p||p.type.allowsMarkType(n),y=!!n.isInSet(d.marks)||!d.marks.some(v=>v.type.excludes(n));c=f&&y}return!c}),c})}const WSe=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const{selection:o}=n,{empty:s,ranges:a}=o,l=Ju(t,r.schema);if(i)if(s){const c=BV(r,l);n.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const d=c.$from.pos,u=c.$to.pos;r.doc.nodesBetween(d,u,(p,f)=>{const y=Math.max(f,d),v=Math.min(f+p.nodeSize,u);p.marks.find(b=>b.type===l)?p.marks.forEach(b=>{l===b.type&&n.addMark(y,v,l.create({...b.attrs,...e}))}):n.addMark(y,v,l.create(e))})});return HSe(r,n,l)},VSe=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),KSe=(t,e={})=>({state:n,dispatch:r,chain:i})=>{const o=ni(t,n.schema);let s;return n.selection.$anchor.sameParent(n.selection.$head)&&(s=n.selection.$anchor.parent.attrs),o.isTextblock?i().command(({commands:a})=>BF(o,{...s,...e})(n)?!0:a.clearNodes()).command(({state:a})=>BF(o,{...s,...e})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},qSe=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,i=Rd(t,0,r.content.size),o=ot.create(r,i);e.setSelection(o)}return!0},GSe=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:i,to:o}=typeof t=="number"?{from:t,to:t}:t,s=wt.atStart(r).from,a=wt.atEnd(r).to,l=Rd(i,s,a),c=Rd(o,s,a),d=wt.create(r,l,c);e.setSelection(d)}return!0},YSe=t=>({state:e,dispatch:n})=>{const r=ni(t,e.schema);return Ixe(r)(e,n)};function GF(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(i=>e?.includes(i.type.name));t.tr.ensureMarks(r)}}const XSe=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:i})=>{const{selection:o,doc:s}=e,{$from:a,$to:l}=o,c=i.extensionManager.attributes,d=US(c,a.node().type.name,a.node().attrs);if(o instanceof ot&&o.node.isBlock)return!a.parentOffset||!pc(s,a.pos)?!1:(r&&(t&&GF(n,i.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const u=l.parentOffset===l.parent.content.size,p=a.depth===0?void 0:MSe(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=u&&p?[{type:p,attrs:d}]:void 0,y=pc(e.doc,e.mapping.map(a.pos),1,f);if(!f&&!y&&pc(e.doc,e.mapping.map(a.pos),1,p?[{type:p}]:void 0)&&(y=!0,f=p?[{type:p,attrs:d}]:void 0),r){if(y&&(o instanceof wt&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,f),p&&!u&&!a.parentOffset&&a.parent.type!==p)){const v=e.mapping.map(a.before()),x=e.doc.resolve(v);a.node(-1).canReplaceWith(x.index(),x.index()+1,p)&&e.setNodeMarkup(e.mapping.map(a.before()),p)}t&&GF(n,i.extensionManager.splittableMarks),e.scrollIntoView()}return y},ZSe=(t,e={})=>({tr:n,state:r,dispatch:i,editor:o})=>{var s;const a=ni(t,r.schema),{$from:l,$to:c}=r.selection,d=r.selection.node;if(d&&d.isBlock||l.depth<2||!l.sameParent(c))return!1;const u=l.node(-1);if(u.type!==a)return!1;const p=o.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(i){let b=Pe.empty;const w=l.index(-1)?1:l.index(-2)?2:3;for(let D=l.depth-w;D>=l.depth-3;D-=1)b=Pe.from(l.node(D).copy(b));const _=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,C={...US(p,l.node().type.name,l.node().attrs),...e},A=((s=a.contentMatch.defaultType)===null||s===void 0?void 0:s.createAndFill(C))||void 0;b=b.append(Pe.from(a.createAndFill(null,A)||void 0));const E=l.before(l.depth-(w-1));n.replace(E,l.after(-_),new He(b,4-w,0));let O=-1;n.doc.nodesBetween(E,n.doc.content.size,(D,B)=>{if(O>-1)return!1;D.isTextblock&&D.content.size===0&&(O=B+1)}),O>-1&&n.setSelection(wt.near(n.doc.resolve(O))),n.scrollIntoView()}return!0}const f=c.pos===l.end()?u.contentMatchAt(0).defaultType:null,y={...US(p,u.type.name,u.attrs),...e},v={...US(p,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,c.pos);const x=f?[{type:a,attrs:y},{type:f,attrs:v}]:[{type:a,attrs:y}];if(!pc(n.doc,l.pos,2))return!1;if(i){const{selection:b,storedMarks:w}=r,{splittableMarks:_}=o.extensionManager,C=w||b.$to.parentOffset&&b.$from.marks();if(n.split(l.pos,2,x).scrollIntoView(),!C||!i)return!0;const A=C.filter(E=>_.includes(E.type.name));n.ensureMarks(A)}return!0},fP=(t,e)=>{const n=zA(s=>s.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const i=t.doc.nodeAt(r);return n.node.type===i?.type&&Xu(t.doc,n.pos)&&t.join(n.pos),!0},gP=(t,e)=>{const n=zA(s=>s.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const i=t.doc.nodeAt(r);return n.node.type===i?.type&&Xu(t.doc,r)&&t.join(r),!0},JSe=(t,e,n,r={})=>({editor:i,tr:o,state:s,dispatch:a,chain:l,commands:c,can:d})=>{const{extensions:u,splittableMarks:p}=i.extensionManager,f=ni(t,s.schema),y=ni(e,s.schema),{selection:v,storedMarks:x}=s,{$from:b,$to:w}=v,_=b.blockRange(w),C=x||v.$to.parentOffset&&v.$from.marks();if(!_)return!1;const A=zA(E=>qF(E.type.name,u))(v);if(_.depth>=1&&A&&_.depth-A.depth<=1){if(A.node.type===f)return c.liftListItem(y);if(qF(A.node.type.name,u)&&f.validContent(A.node.content)&&a)return l().command(()=>(o.setNodeMarkup(A.pos,f),!0)).command(()=>fP(o,f)).command(()=>gP(o,f)).run()}return!n||!C||!a?l().command(()=>d().wrapInList(f,r)?!0:c.clearNodes()).wrapInList(f,r).command(()=>fP(o,f)).command(()=>gP(o,f)).run():l().command(()=>{const E=d().wrapInList(f,r),O=C.filter(D=>p.includes(D.type.name));return o.ensureMarks(O),E?!0:c.clearNodes()}).wrapInList(f,r).command(()=>fP(o,f)).command(()=>gP(o,f)).run()},QSe=(t,e={},n={})=>({state:r,commands:i})=>{const{extendEmptyMarkRange:o=!1}=n,s=Ju(t,r.schema);return eE(r,s,e)?i.unsetMark(s,{extendEmptyMarkRange:o}):i.setMark(s,e)},ebe=(t,e,n={})=>({state:r,commands:i})=>{const o=ni(t,r.schema),s=ni(e,r.schema),a=py(r,o,n);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?i.setNode(s,l):i.setNode(o,{...l,...n})},tbe=(t,e={})=>({state:n,commands:r})=>{const i=ni(t,n.schema);return py(n,i,e)?r.lift(i):r.wrapIn(i,e)},nbe=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const i=n[r];let o;if(i.spec.isInputRules&&(o=i.getState(t))){if(e){const s=t.tr,a=o.transform;for(let l=a.steps.length-1;l>=0;l-=1)s.step(a.steps[l].invert(a.docs[l]));if(o.text){const l=s.doc.resolve(o.from).marks();s.replaceWith(o.from,o.to,t.schema.text(o.text,l))}else s.delete(o.from,o.to)}return!0}}return!1},rbe=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:i}=n;return r||e&&i.forEach(o=>{t.removeMark(o.$from.pos,o.$to.pos)}),!0},ibe=(t,e={})=>({tr:n,state:r,dispatch:i})=>{var o;const{extendEmptyMarkRange:s=!1}=e,{selection:a}=n,l=Ju(t,r.schema),{$from:c,empty:d,ranges:u}=a;if(!i)return!0;if(d&&s){let{from:p,to:f}=a;const y=(o=c.marks().find(x=>x.type===l))===null||o===void 0?void 0:o.attrs,v=M0(c,l,y);v&&(p=v.from,f=v.to),n.removeMark(p,f,l)}else u.forEach(p=>{n.removeMark(p.$from.pos,p.$to.pos,l)});return n.removeStoredMark(l),!0},obe=(t,e={})=>({tr:n,state:r,dispatch:i})=>{let o=null,s=null;const a=O0(typeof t=="string"?t:t.name,r.schema);return a?(a==="node"&&(o=ni(t,r.schema)),a==="mark"&&(s=Ju(t,r.schema)),i&&n.selection.ranges.forEach(l=>{const c=l.$from.pos,d=l.$to.pos;let u,p,f,y;n.selection.empty?r.doc.nodesBetween(c,d,(v,x)=>{o&&o===v.type&&(f=Math.max(x,c),y=Math.min(x+v.nodeSize,d),u=x,p=v)}):r.doc.nodesBetween(c,d,(v,x)=>{x<c&&o&&o===v.type&&(f=Math.max(x,c),y=Math.min(x+v.nodeSize,d),u=x,p=v),x>=c&&x<=d&&(o&&o===v.type&&n.setNodeMarkup(x,void 0,{...v.attrs,...e}),s&&v.marks.length&&v.marks.forEach(b=>{if(s===b.type){const w=Math.max(x,c),_=Math.min(x+v.nodeSize,d);n.addMark(w,_,s.create({...b.attrs,...e}))}}))}),p&&(u!==void 0&&n.setNodeMarkup(u,void 0,{...p.attrs,...e}),s&&p.marks.length&&p.marks.forEach(v=>{s===v.type&&n.addMark(f,y,s.create({...v.attrs,...e}))}))}),!0):!1},sbe=(t,e={})=>({state:n,dispatch:r})=>{const i=ni(t,n.schema);return yxe(i,e)(n,r)},abe=(t,e={})=>({state:n,dispatch:r})=>{const i=ni(t,n.schema);return vxe(i,e)(n,r)};var lbe=Object.freeze({__proto__:null,blur:Fxe,clearContent:Bxe,clearNodes:Uxe,command:Hxe,createParagraphNear:Wxe,cut:Vxe,deleteCurrentNode:Kxe,deleteNode:qxe,deleteRange:Gxe,deleteSelection:Yxe,enter:Xxe,exitCode:Zxe,extendMarkRange:Jxe,first:Qxe,focus:tSe,forEach:nSe,insertContent:rSe,insertContentAt:sSe,joinBackward:cSe,joinDown:lSe,joinForward:uSe,joinItemBackward:dSe,joinItemForward:hSe,joinTextblockBackward:pSe,joinTextblockForward:fSe,joinUp:aSe,keyboardShortcut:mSe,lift:ySe,liftEmptyBlock:vSe,liftListItem:xSe,newlineInCode:SSe,resetAttributes:bSe,scrollIntoView:wSe,selectAll:kSe,selectNodeBackward:ISe,selectNodeForward:_Se,selectParentNode:CSe,selectTextblockEnd:PSe,selectTextblockStart:TSe,setContent:ESe,setMark:WSe,setMeta:VSe,setNode:KSe,setNodeSelection:qSe,setTextSelection:GSe,sinkListItem:YSe,splitBlock:XSe,splitListItem:ZSe,toggleList:JSe,toggleMark:QSe,toggleNode:ebe,toggleWrap:tbe,undoInputRule:nbe,unsetAllMarks:rbe,unsetMark:ibe,updateAttributes:obe,wrapIn:sbe,wrapInList:abe});const cbe=wi.create({name:"commands",addCommands(){return{...lbe}}}),ube=wi.create({name:"drop",addProseMirrorPlugins(){return[new _i({key:new As("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),dbe=wi.create({name:"editable",addProseMirrorPlugins(){return[new _i({key:new As("editable"),props:{editable:()=>this.editor.options.editable}})]}}),hbe=new As("focusEvents"),pbe=wi.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new _i({key:hbe,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),fbe=wi.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:s})=>[()=>s.undoInputRule(),()=>s.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:d,$anchor:u}=l,{pos:p,parent:f}=u,y=u.parent.isTextblock&&p>0?a.doc.resolve(p-1):u,v=y.parent.type.spec.isolating,x=u.pos-u.parentOffset,b=v&&y.parent.childCount===1?x===u.pos:Mt.atStart(c).from===p;return!d||!f.type.isTextblock||f.textContent.length||!b||b&&u.parent.type.name==="paragraph"?!1:s.clearNodes()}),()=>s.deleteSelection(),()=>s.joinBackward(),()=>s.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:s})=>[()=>s.deleteSelection(),()=>s.deleteCurrentNode(),()=>s.joinForward(),()=>s.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:s})=>[()=>s.newlineInCode(),()=>s.createParagraphNear(),()=>s.liftEmptyBlock(),()=>s.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},i={...r},o={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return LA()||FV()?o:i},addProseMirrorPlugins(){return[new _i({key:new As("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(v=>v.getMeta("composition")))return;const r=t.some(v=>v.docChanged)&&!e.doc.eq(n.doc),i=t.some(v=>v.getMeta("preventClearDocument"));if(!r||i)return;const{empty:o,from:s,to:a}=e.selection,l=Mt.atStart(e.doc).from,c=Mt.atEnd(e.doc).to;if(o||!(s===l&&a===c)||!BA(n.doc))return;const p=n.tr,f=_0({state:n,transaction:p}),{commands:y}=new C0({editor:this.editor,state:f});if(y.clearNodes(),!!p.steps.length)return p}})]}}),gbe=wi.create({name:"paste",addProseMirrorPlugins(){return[new _i({key:new As("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),mbe=wi.create({name:"tabindex",addProseMirrorPlugins(){return[new _i({key:new As("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}});class Md{get name(){return this.node.type.name}constructor(e,n,r=!1,i=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=i}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!==null&&e!==void 0?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You can’t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new Md(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Md(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Md(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const i=n.isBlock&&!n.isTextblock,o=n.isAtom&&!n.isText,s=this.pos+r+(o?0:1);if(s<0||s>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(s);if(!i&&a.depth<=this.depth)return;const l=new Md(a,this.editor,i,i?n:null);i&&(l.actualDepth=this.depth+1),e.push(new Md(a,this.editor,i,i?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,i=this.parent;for(;i&&!r;){if(i.node.type.name===e)if(Object.keys(n).length>0){const o=i.node.attrs,s=Object.keys(n);for(let a=0;a<s.length;a+=1){const l=s[a];if(o[l]!==n[l])break}}else r=i;i=i.parent}return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let i=[];if(!this.children||this.children.length===0)return i;const o=Object.keys(n);return this.children.forEach(s=>{r&&i.length>0||(s.node.type.name===e&&o.every(l=>n[l]===s.node.attrs[l])&&i.push(s),!(r&&i.length>0)&&(i=i.concat(s.querySelectorAll(e,n,r))))}),i}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}}const ybe=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function vbe(t,e,n){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const i=document.createElement("style");return e&&i.setAttribute("nonce",e),i.setAttribute("data-tiptap-style",""),i.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(i),i}class xbe extends _xe{constructor(e={}){super(),this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:n})=>{throw n},onPaste:()=>null,onDrop:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("contentError",this.options.onContentError),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:n,slice:r,moved:i})=>this.options.onDrop(n,r,i)),this.on("paste",({event:n,slice:r})=>this.options.onPaste(n,r)),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=vbe(ybe,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,n=!0){this.setOptions({editable:e}),n&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,n){const r=DV(n)?n(e,[...this.state.plugins]):[...this.state.plugins,e],i=this.state.reconfigure({plugins:r});return this.view.updateState(i),i}unregisterPlugin(e){if(this.isDestroyed)return;const n=this.state.plugins;let r=n;if([].concat(e).forEach(o=>{const s=typeof o=="string"?`${o}$`:o.key;r=r.filter(a=>!a.key.startsWith(s))}),n.length===r.length)return;const i=this.state.reconfigure({plugins:r});return this.view.updateState(i),i}createExtensionManager(){var e,n;const i=[...this.options.enableCoreExtensions?[dbe,zxe.configure({blockSeparator:(n=(e=this.options.coreExtensionOptions)===null||e===void 0?void 0:e.clipboardTextSerializer)===null||n===void 0?void 0:n.blockSeparator}),cbe,pbe,fbe,mbe,ube,gbe].filter(o=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[o.name]!==!1:!0):[],...this.options.extensions].filter(o=>["extension","node","mark"].includes(o?.type));this.extensionManager=new jd(i,this)}createCommandManager(){this.commandManager=new C0({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){var e;let n;try{n=QT(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(s){if(!(s instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(s.message))throw s;this.emit("contentError",{editor:this,error:s,disableCollaboration:()=>{this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(a=>a.name!=="collaboration"),this.createExtensionManager()}}),n=QT(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}const r=LV(n,this.options.autofocus);this.view=new vV(this.options.element,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)===null||e===void 0?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:zp.create({doc:n,selection:r||void 0})});const i=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(i),this.createNodeViews(),this.prependClass();const o=this.view.dom;o.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const n=this.capturedTransaction;return this.capturedTransaction=null,n}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=e;return}e.steps.forEach(s=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(s)});return}const n=this.state.apply(e),r=!this.state.selection.eq(n.selection);this.emit("beforeTransaction",{editor:this,transaction:e,nextState:n}),this.view.updateState(n),this.emit("transaction",{editor:this,transaction:e}),r&&this.emit("selectionUpdate",{editor:this,transaction:e});const i=e.getMeta("focus"),o=e.getMeta("blur");i&&this.emit("focus",{editor:this,event:i.event,transaction:e}),o&&this.emit("blur",{editor:this,event:o.event,transaction:e}),!(!e.docChanged||e.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return HV(this.state,e)}isActive(e,n){const r=typeof e=="string"?e:null,i=typeof e=="string"?n:e;return BSe(this.state,r,i)}getJSON(){return this.state.doc.toJSON()}getHTML(){return T0(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:n=`

`,textSerializers:r={}}=e||{};return UV(this.state.doc,{blockSeparator:n,textSerializers:{...NA(this.schema),...r}})}get isEmpty(){return BA(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){if(this.emit("destroy"),this.view){const e=this.view.dom;e&&e.editor&&delete e.editor,this.view.destroy()}this.removeAllListeners()}get isDestroyed(){var e;return!(!((e=this.view)===null||e===void 0)&&e.docView)}$node(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelector(e,n))||null}$nodes(e,n){var r;return((r=this.$doc)===null||r===void 0?void 0:r.querySelectorAll(e,n))||null}$pos(e){const n=this.state.doc.resolve(e);return new Md(n,this)}get $doc(){return this.$pos(0)}}function ah(t){return new E0({find:t.find,handler:({state:e,range:n,match:r})=>{const i=Nt(t.getAttributes,void 0,r);if(i===!1||i===null)return null;const{tr:o}=e,s=r[r.length-1],a=r[0];if(s){const l=a.search(/\S/),c=n.from+a.indexOf(s),d=c+s.length;if(FA(n.from,n.to,e.doc).filter(f=>f.mark.type.excluded.find(v=>v===t.type&&v!==f.mark.type)).filter(f=>f.to>c).length)return null;d<n.to&&o.delete(d,n.to),c>n.from&&o.delete(n.from+l,c);const p=n.from+l+s.length;o.addMark(n.from+l,p,t.type.create(i||{})),o.removeStoredMark(t.type)}}})}function Sbe(t){return new E0({find:t.find,handler:({state:e,range:n,match:r})=>{const i=Nt(t.getAttributes,void 0,r)||{},{tr:o}=e,s=n.from;let a=n.to;const l=t.type.create(i);if(r[1]){const c=r[0].lastIndexOf(r[1]);let d=s+c;d>a?d=a:a=d+r[1].length;const u=r[0][r[0].length-1];o.insertText(u,s+r[0].length-1),o.replaceWith(d,a,l)}else if(r[0]){const c=t.type.isInline?s:s-1;o.insert(c,t.type.create(i)).delete(o.mapping.map(s),o.mapping.map(a))}o.scrollIntoView()}})}function tE(t){return new E0({find:t.find,handler:({state:e,range:n,match:r})=>{const i=e.doc.resolve(n.from),o=Nt(t.getAttributes,void 0,r)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,o)}})}function fy(t){return new E0({find:t.find,handler:({state:e,range:n,match:r,chain:i})=>{const o=Nt(t.getAttributes,void 0,r)||{},s=e.tr.delete(n.from,n.to),l=s.doc.resolve(n.from).blockRange(),c=l&&SA(l,t.type,o);if(!c)return null;if(s.wrap(l,c),t.keepMarks&&t.editor){const{selection:u,storedMarks:p}=e,{splittableMarks:f}=t.editor.extensionManager,y=p||u.$to.parentOffset&&u.$from.marks();if(y){const v=y.filter(x=>f.includes(x.type.name));s.ensureMarks(v)}}if(t.keepAttributes){const u=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";i().updateAttributes(u,o).run()}const d=s.doc.resolve(n.from-1).nodeBefore;d&&d.type===t.type&&Xu(s.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,d))&&s.join(n.from-1)}})}let Ya=class nE{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=Nt(Ze(this,"addOptions",{name:this.name}))),this.storage=Nt(Ze(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new nE(e)}configure(e={}){const n=this.extend({...this.config,addOptions:()=>A0(this.options,e)});return n.name=this.name,n.parent=this.parent,n}extend(e={}){const n=new nE(e);return n.parent=this,this.child=n,n.name=e.name?e.name:n.parent.name,e.defaultOptions&&Object.keys(e.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${n.name}".`),n.options=Nt(Ze(n,"addOptions",{name:n.name})),n.storage=Nt(Ze(n,"addStorage",{name:n.name,options:n.options})),n}};function ju(t){return new Dxe({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:i})=>{const o=Nt(t.getAttributes,void 0,r,i);if(o===!1||o===null)return null;const{tr:s}=e,a=r[r.length-1],l=r[0];let c=n.to;if(a){const d=l.search(/\S/),u=n.from+l.indexOf(a),p=u+a.length;if(FA(n.from,n.to,e.doc).filter(y=>y.mark.type.excluded.find(x=>x===t.type&&x!==y.mark.type)).filter(y=>y.to>u).length)return null;p<n.to&&s.delete(p,n.to),u>n.from&&s.delete(n.from+d,u),c=n.from+d+a.length,s.addMark(n.from+d,c,t.type.create(o||{})),s.removeStoredMark(t.type)}}})}function bbe(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof ot){const o=r.index();return r.parent.canReplaceWith(o,o+1,e)}let i=r.depth;for(;i>=0;){const o=r.index(i);if(r.node(i).contentMatchAt(o).matchType(e))return!0;i-=1}return!1}const wbe=new ki;function kbe(t){return wbe.get(t,()=>D0(t.extensions??[]))}function j0(t,e,n){const{tipTapConfig:r,addFontsFromNode:i}=t.getTextOptions();Ge(r,"textOptions.tipTapConfig must be set to use rich text"),Ge(i,"textOptions.addFontsFromNode must be set to use rich text");const o=kbe(r),s=Fa.fromJSON(o,e),a=new Set;function l(d){a.add(d)}function c(d,u){u=i(d,u,l);for(const p of d.children)c(p,u)}return c(s,n),Array.from(a)}async function Ibe({shouldReload:t=!0}={}){use();for(const e of iy.connectedInstances)await e.close();await Promise.all(gA().map(e=>A7(e))),cse(),t&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=Ibe);function _be(t,e="_blank"){Yy.openWindow(t,e)}Fu("@tldraw/editor","4.1.1","esm");class Zt{static lineThroughPoints(e,n){const r=new Zt;r.moveTo(e[0].x,e[0].y,{...n,offset:n?.endOffsets??n?.offset});for(let i=1;i<e.length;i++){const o=i===e.length-1;r.lineTo(e[i].x,e[i].y,o?{offset:n?.endOffsets}:void 0)}return r}static cubicSplineThroughPoints(e,n){const r=new Zt,i=e.length,o=i-2,s=1.25;r.moveTo(e[0].x,e[0].y,{...n,offset:n?.endOffsets??n?.offset});for(let a=0;a<i-1;a++){const l=a===0?e[0]:e[a-1],c=e[a],d=e[a+1],u=a===o?d:e[a+2];let p,f,y,v;a===0?(p=l.x,f=l.y):(p=c.x+(d.x-l.x)/6*s,f=c.y+(d.y-l.y)/6*s);let x;a===o?(y=d.x,v=d.y,x={offset:n?.endOffsets}):(y=d.x-(u.x-c.x)/6*s,v=d.y-(u.y-c.y)/6*s),r.cubicBezierTo(d.x,d.y,p,f,y,v,x)}return r}constructor(){}commands=[];lastMoveTo=null;assertHasMoveTo(){return Ge(this.lastMoveTo,"Start an SVGPathBuilder with `.moveTo()`"),this.lastMoveTo}moveTo(e,n,r){return this.lastMoveTo={type:"move",x:e,y:n,closeIdx:null,isClose:!1,opts:r},this.commands.push(this.lastMoveTo),this}lineTo(e,n,r){return this.assertHasMoveTo(),this.commands.push({type:"line",x:e,y:n,isClose:!1,opts:r}),this}circularArcTo(e,n,r,i,o,s){return this.arcTo(e,e,n,r,0,i,o,s)}arcTo(e,n,r,i,o,s,a,l){this.assertHasMoveTo();const c=this.commands[this.commands.length-1].x,d=this.commands[this.commands.length-1].y;if(c===s&&d===a)return this;if(e===0||n===0)return this.lineTo(s,a,l);const u=o,p=Math.sin(u),f=Math.cos(u);let y=Math.abs(e),v=Math.abs(n);const x=(c-s)/2,b=(d-a)/2,w=f*x+p*b,_=-p*x+f*b,C=w*w/(y*y)+_*_/(v*v);if(C>1){const ye=Math.sqrt(C);y*=ye,v*=ye}const A=r!==i?1:-1,E=y*y*v*v-y*y*_*_-v*v*w*w,O=y*y*_*_+v*v*w*w;let D=E/O;D=D<0?0:D;const B=A*Math.sqrt(D),L=B*(y*_/v),j=B*(-(v*w)/y),F=f*L-p*j+(c+s)/2,z=p*L+f*j+(d+a)/2,$=(w-L)/y,V=(_-j)/v,Y=(-w-L)/y,re=(-_-j)/v,q=Math.atan2(V,$);let X=Math.atan2(re,Y);!i&&X>q?X-=2*Math.PI:i&&X<q&&(X+=2*Math.PI);const N=X-q,H=Math.max(y,v)*Math.abs(N),ie=Math.min(4,Math.ceil(Math.abs(N)/(Math.PI/2))),U=Math.ceil(y0(H)/ie),ke=N/ie,ge=ye=>({x:F+y*Math.cos(ye)*f-v*Math.sin(ye)*p,y:z+y*Math.cos(ye)*p+v*Math.sin(ye)*f}),Te=ye=>({x:-y*Math.sin(ye)*f-v*Math.cos(ye)*p,y:-y*Math.sin(ye)*p+v*Math.cos(ye)*f});for(let ye=0;ye<ie;ye++){const Se=q+ye*ke,Re=q+(ye+1)*ke,$e=Re-Se,Ft=ge(Se),rn=ge(Re),Dt=Te(Se),Kt=Te(Re),Gt=4/3*Math.tan($e/4),Gn=Ft.x+Gt*Dt.x,Ln=Ft.y+Gt*Dt.y,Pr=rn.x-Gt*Kt.x,Tr=rn.y-Gt*Kt.y,fr=ye===0?l:{...l,mergeWithPrevious:!0};this.cubicBezierToWithResolution(rn.x,rn.y,Gn,Ln,Pr,Tr,fr,U)}return this}cubicBezierTo(e,n,r,i,o,s,a){return this.cubicBezierToWithResolution(e,n,r,i,o,s,a)}cubicBezierToWithResolution(e,n,r,i,o,s,a,l){return this.assertHasMoveTo(),this.commands.push({type:"cubic",x:e,y:n,cp1:{x:r,y:i},cp2:{x:o,y:s},isClose:!1,opts:a,resolution:l}),this}close(){const e=this.assertHasMoveTo(),n=this.commands[this.commands.length-1];return Ir(e.x,n.x)&&Ir(e.y,n.y)?n.isClose=!0:this.commands.push({type:"line",x:e.x,y:e.y,isClose:!0}),e.closeIdx=this.commands.length-1,this.lastMoveTo=null,this}toD(e={}){const{startIdx:n=0,endIdx:r=this.commands.length,onlyFilled:i=!1}=e,o=[];let s=!1,a=!1,l=!1;const c=d=>{if(a||d===0)return;a=!0;const u=this.commands[d-1];o.push("M",ee(u.x),ee(u.y))};for(let d=n;d<r;d++){const u=this.commands[d];switch(u.type){case"move":{const p=u.opts?.geometry===!1?!1:u.opts?.geometry?.isFilled??!1;i&&!p?s=!0:(s=!1,a=!0,l=!0,o.push("M",ee(u.x),ee(u.y)));break}case"line":if(s)break;c(d),u.isClose&&l?o.push("Z"):o.push("L",ee(u.x),ee(u.y));break;case"cubic":if(s)break;c(d),o.push("C",ee(u.cp1.x),ee(u.cp1.y),ee(u.cp2.x),ee(u.cp2.y),ee(u.x),ee(u.y));break;default:Wt(u,"type")}}return o.join(" ")}toSvg(e){if(e.forceSolid)return this.toSolidSvg(e);switch(e.style){case"solid":return this.toSolidSvg(e);case"dashed":case"dotted":return this.toDashedSvg(e);case"draw":return this.toDrawSvg(e);default:Wt(e,"style")}}toGeometry(){const e=[];let n=null;for(let r=0;r<this.commands.length;r++){const i=this.commands[r];i.type==="move"&&(n&&n.opts?.geometry!==!1&&e.push(new rE(this,n.startIdx,r,{...n.opts?.geometry,isFilled:n.opts?.geometry?.isFilled??!1,isClosed:n.moveCommand.closeIdx!==null})),n={startIdx:r,moveCommand:i,opts:i.opts,isClosed:!1}),i.isClose&&(Ge(n,"No current move command"),n.isClosed=!0)}return n&&n.opts?.geometry!==!1&&e.push(new rE(this,n.startIdx,this.commands.length,{...n.opts?.geometry,isFilled:n.opts?.geometry?.isFilled??!1,isClosed:n.moveCommand.closeIdx!==null})),Ge(e.length>0),e.length===1?e[0]:new Zo({children:e})}toSolidSvg(e){const{strokeWidth:n,props:r}=e;return g.jsx("path",{strokeWidth:n,d:this.toD({onlyFilled:e.onlyFilled}),...r})}toDashedSvg(e){const{style:n,strokeWidth:r,snap:i,lengthRatio:o,props:{markerStart:s,markerEnd:a,...l}={}}=e,c=[];let d=!1,u=!1,p,f=null;const y=()=>{if(!f)return;const{startIdx:v,endIdx:x,isFirst:b,isLast:w,length:_,lineOpts:C,pathIsClosed:A}=f;if(f=null,v===x&&this.commands[v].type==="move")return;const E=C?.dashStart??e.start,O=C?.dashEnd??e.end,{strokeDasharray:D,strokeDashoffset:B}=k8(_,r,{style:n,snap:i,lengthRatio:o,start:b?E??(A?"outset":"none"):"outset",end:w?O??(A?"outset":"none"):"outset"}),L=this.toD({startIdx:v,endIdx:x+1});c.push(g.jsx("path",{d:L,strokeDasharray:D,strokeDashoffset:B,markerStart:b?s:void 0,markerEnd:w?a:void 0},c.length))};for(let v=0;v<this.commands.length;v++){const x=this.commands[v],b=this.commands[v-1];if(x.type==="move"){d=x.closeIdx!==null;const A=x.opts?.geometry===!1?!1:x.opts?.geometry?.isFilled??!1;e.onlyFilled&&!A?u=!0:(u=!1,p=x.opts);continue}if(u)continue;const w=this.calculateSegmentLength(b,x),_=b.type==="move",C=x.isClose||v===this.commands.length-1||this.commands[v+1]?.type==="move";f&&x.opts?.mergeWithPrevious?(f.length+=w,f.endIdx=v,f.isLast=C):(y(),f={startIdx:v,endIdx:v,isFirst:_,isLast:C,length:w,lineOpts:p,pathIsClosed:d})}return y(),g.jsx("g",{strokeWidth:r,...l,children:c})}toDrawSvg(e){return g.jsx("path",{strokeWidth:e.strokeWidth,d:this.toDrawD(e),...e.props})}toDrawD(e){const{strokeWidth:n,randomSeed:r,offset:i=n/3,roundness:o=n*2,passes:s=2,onlyFilled:a=!1}=e,l=[],c=this.getCommandInfo(),d=[];let u=null;for(let p=0;p<this.commands.length;p++){const f=this.commands[p],y=f.opts?.offset??i,v=f.opts?.roundness??o;f.type==="move"&&(u=p);const x=f.isClose?Gr(u)+1:!this.commands[p+1]||this.commands[p+1].type==="move"?void 0:p+1,b=x!==void 0&&this.commands[x]&&this.commands[x]?.type!=="move"?c[x]:void 0,w=YF[f.type],_=x!==void 0?YF[this.commands[x].type]:!1,C=c[p],A=C?.tangentEnd,E=b?.tangentStart,O=w&&_&&A&&E&&T.Len2(A)>.01&&T.Len2(E)>.01?Ha(Math.abs(T.AngleBetween(A,E)),[Math.PI/2,Math.PI],[v,0],!0):0,B=Math.min(C?.length??1/0,b?.length??1/0)-O*2,L=pt(y,0,B/4),j=Math.min(O,(C?.length??1/0)/4),F=Math.min(O,(b?.length??1/0)/4),z={command:f,offsetAmount:L,roundnessBefore:j,roundnessAfter:F,tangentToPrev:c[p]?.tangentEnd,tangentToNext:b?.tangentStart,moveDidClose:!1};if(d.push(z),f.isClose&&u!==null){const $=d[u];$.moveDidClose=!0,$.roundnessAfter=F}else f.type==="move"&&(u=p)}for(let p=0;p<s;p++){const f=xh(r+p);let y={x:0,y:0},v=!1;for(const{command:x,offsetAmount:b,roundnessBefore:w,roundnessAfter:_,tangentToNext:C,tangentToPrev:A}of d){const E=x.isClose?y:{x:f()*b,y:f()*b};if(x.type==="move"){y=E;const L=x.opts?.geometry===!1?!1:x.opts?.geometry?.isFilled??!1;a&&!L?v=!0:v=!1}if(v)continue;const O=T.Add(x,E),D=C&&_>0?T.Mul(C,-_).add(O):O,B=A&&w>0?T.Mul(A,w).add(O):O;if(D===O||B===O)switch(x.type){case"move":l.push("M",ee(D.x),ee(D.y));break;case"line":l.push("L",ee(D.x),ee(D.y));break;case"cubic":{const L=T.Add(x.cp1,E),j=T.Add(x.cp2,E);l.push("C",ee(L.x),ee(L.y),ee(j.x),ee(j.y),ee(D.x),ee(D.y));break}default:Wt(x,"type")}else switch(x.type){case"move":l.push("M",ee(D.x),ee(D.y));break;case"line":l.push("L",ee(B.x),ee(B.y),"Q",ee(O.x),ee(O.y),ee(D.x),ee(D.y));break;case"cubic":{const L=T.Add(x.cp1,E),j=T.Add(x.cp2,E);l.push("C",ee(L.x),ee(L.y),ee(j.x),ee(j.y),ee(O.x),ee(O.y));break}default:Wt(x,"type")}}}return l.join(" ")}calculateSegmentLength(e,n){switch(n.type){case"move":return 0;case"line":return T.Dist(e,n);case"cubic":return fm.length(e.x,e.y,n.cp1.x,n.cp1.y,n.cp2.x,n.cp2.y,n.x,n.y);default:Wt(n,"type")}}getCommands(){return this.commands}getCommandInfo(){const e=[];for(let n=1;n<this.commands.length;n++){const r=this.commands[n-1],i=this.commands[n];if(i._info){e[n]=i._info;continue}if(i.type==="move")continue;let o,s;switch(i.type){case"line":o=s=T.Sub(r,i).uni();break;case"cubic":{o=T.Sub(i.cp1,r).uni(),s=T.Sub(i.cp2,i).uni();break}default:Wt(i,"type")}i._info={tangentStart:o,tangentEnd:s,length:this.calculateSegmentLength(r,i)},e[n]=i._info}return e}}const YF={line:!0,move:!0,cubic:!1};class rE extends Gu{constructor(e,n,r,i){super(i),this.path=e,this.startIdx=n,this.endIdx=r}_segments=null;getSegments(){if(this._segments)return this._segments;this._segments=[];let e=this.path.commands[this.startIdx];Ge(e.type==="move");for(let n=this.startIdx+1;n<this.endIdx;n++){const r=this.path.commands[n];switch(Ge(r.type!=="move"),r.type){case"line":this._segments.push(new cf({start:T.From(e),end:T.From(r)}));break;case"cubic":{this._segments.push(new yA({start:T.From(e),cp1:T.From(r.cp1),cp2:T.From(r.cp2),end:T.From(r),resolution:r.resolution}));break}default:Wt(r,"type")}e=r}return this._segments}getVertices(e){const n=this.getSegments().flatMap(r=>r.getVertices(e)).filter((r,i,o)=>{const s=o[i-1];return s?!T.Equals(s,r):!0});if(this.isClosed){const r=n[n.length-1],i=n[0];T.Equals(r,i)||n.push(i)}return n}nearestPoint(e,n){let r=null,i=1/0;for(const o of this.getSegments()){const s=o.nearestPoint(e),a=T.Dist2(e,s);a<i&&(i=a,r=s)}return Ge(r,"No nearest point found"),r}hitTestLineSegment(e,n,r=0,i){return super.hitTestLineSegment(e,n,r,i)}getSvgPathData(){return this.path.toD({startIdx:this.startIdx,endIdx:this.endIdx})}}/*!
 * Adapted from https://github.com/adobe-webplatform/Snap.svg/tree/master
 * Apache License: https://github.com/adobe-webplatform/Snap.svg/blob/master/LICENSE
 * https://github.com/adobe-webplatform/Snap.svg/blob/c8e483c9694517e24b282f8f59f985629f4994ce/dist/snap.svg.js#L5786
 */const fm={base3(t,e,n,r,i){const o=-3*e+9*n-9*r+3*i,s=t*o+6*e-12*n+6*r;return t*s-3*e+3*n},length(t,e,n,r,i,o,s,a,l=1){l=l>1?1:l<0?0:l;const c=l/2,d=12;let u=0;u=0;for(let p=0;p<d;p++){const f=c*fm.Tvalues[p]+c,y=fm.base3(f,t,n,i,s),v=fm.base3(f,e,r,o,a),x=y*y+v*v;u+=fm.Cvalues[p]*Math.sqrt(x)}return c*u},Tvalues:[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],Cvalues:[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472]};function WV(){const t=hr(),e=J("animationSpeed",()=>t?.user.getAnimationSpeed(),[t]),[n,r]=I.useState(!1);return I.useEffect(()=>{if(e!==void 0){r(e===0);return}if(typeof window>"u"||!("matchMedia"in window))return;const i=window.matchMedia("(prefers-reduced-motion: reduce)"),o=()=>{r(i.matches)};return o(),i.addEventListener("change",o),()=>i.removeEventListener("change",o)},[e]),n}const iE=I.createContext(null);function Cbe({children:t}){const e=Hy("a11y",{msg:"",priority:"assertive"}),n=I.useContext(iE),r=I.useMemo(()=>({currentMsg:e,announce(i){i&&e.set(i)}}),[e]);return n?g.jsx(g.Fragment,{children:t}):g.jsx(iE.Provider,{value:r,children:t})}function R0(){const t=I.useContext(iE);if(!t)throw new Error("useA11y must be used within a A11yContext.Provider");return t}const VV=I.createContext(null);function KV({assetUrls:t,children:e}){return I.useEffect(()=>{for(const n of Object.values(t.icons)){if(!n)continue;const r=Zm();r.crossOrigin="anonymous",r.src=n,r.decode()}for(const n of Object.values(t.embedIcons)){if(!n)continue;const r=Zm();r.crossOrigin="anonymous",r.src=n,r.decode()}},[t]),g.jsx(VV.Provider,{value:t,children:e})}function UA(){const t=I.useContext(VV);if(!t)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return t}const oE={"action.toggle-auto-pan":"Auto (trackpad)","action.toggle-auto-zoom":"Auto (mouse)","action.toggle-auto-none":"Auto","action.toggle-mouse":"Mouse","action.toggle-trackpad":"Trackpad","action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.download-original":"Download original","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-kbd-shortcuts":"Open keyboard shortcuts","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.paste-error-title":"Pasting failed","action.paste-error-description":"Could not paste due to missing clipboard permissions. Please enable the permissions and try again.","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-paste-at-cursor.menu":"Paste at cursor","action.toggle-paste-at-cursor":"Toggle paste at cursor","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-keyboard-shortcuts.menu":"Enable keyboard shortcuts","action.toggle-keyboard-shortcuts":"Toggle keyboard shortcuts","action.enhanced-a11y-mode.menu":"Enhanced accessibility mode","action.enhanced-a11y-mode":"Toggle enhanced accessibility mode","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.size-too-big":"File size is too big","assets.files.maximum-size":"Maximum file size is {size}","assets.files.type-not-allowed":"File type is not allowed","assets.files.upload-failed":"Upload failed","assets.files.amount-too-many":"Too many files","assets.url.failed":"Couldn’t load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.cloud":"Cloud","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.heart":"Heart","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus":"Rhombus","geo-style.rhombus-2":"Rhombus left","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","arrow-kind-style.arc":"Arc","arrow-kind-style.elbow":"Elbow","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.heart":"Heart","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.media":"Media","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","tool.pointer-down":"Pointer down","tool.image-zoom":"Zoom","tool.replace-media":"Replace media","tool.flip-horz":"Flip horizontally","tool.flip-vert":"Flip vertically","tool.rotate-cw":"Rotate","tool.aspect-ratio":"Aspect ratio","tool.aspect-ratio.original":"Original","tool.aspect-ratio.square":"Square (1:1)","tool.aspect-ratio.circle":"Circle (1:1)","tool.aspect-ratio.landscape":"Landscape (4:3)","tool.aspect-ratio.portrait":"Portrait (3:4)","tool.aspect-ratio.wide":"Wide (16:9)","tool.image-toolbar-title":"Image tools","tool.image-crop":"Crop image","tool.image-crop-confirm":"Confirm","tool.media-alt-text":"Alternative text","tool.media-alt-text-desc":"Give a description…","tool.media-alt-text-confirm":"Confirm","tool.rich-text-bold":"Bold","tool.rich-text-italic":"Italic","tool.rich-text-code":"Code","tool.rich-text-highlight":"Highlight","tool.rich-text-strikethrough":"Strikethrough","tool.rich-text-link":"Link","tool.rich-text-link-visit":"Visit link","tool.rich-text-link-remove":"Remove link","tool.rich-text-header":"Header","tool.rich-text-bulletList":"Bulleted list","tool.rich-text-toolbar-title":"Text formatting","tool.rich-text-orderedList":"Ordered list","tool.bookmark":"Bookmark","a11y.status":"Status","a11y.skip-to-main-content":"Move focus to canvas","a11y.shape-index":"{num} of {total}","a11y.shape-image":"Image","a11y.shape-video":"Video","a11y.multiple-shapes":"{num} shapes selected","a11y.select-shape":"Select next shape","a11y.select-shape-direction":"Select shape in direction","a11y.enter-leave-container":"Enter/leave container","a11y.repeat-shape":"Repeat shape","a11y.move-shape":"Move shape","a11y.move-shape-faster":"Move shape faster","a11y.rotate-shape-cw":"Rotate shape clockwise","a11y.rotate-shape-ccw":"Rotate shape counterclockwise","a11y.rotate-shape-cw-fine":"Rotate shape clockwise (fine)","a11y.rotate-shape-ccw-fine":"Rotate shape counterclockwise (fine)","a11y.enlarge-shape":"Enlarge shape","a11y.shrink-shape":"Shrink shape","a11y.pan-camera":"Pan camera","a11y.adjust-shape-styles":"Adjust shape styles","a11y.open-context-menu":"Open context menu","a11y.open-keyboard-shortcuts":"Open keyboard shortcuts","menu.title":"Menu","menu.theme":"Theme","menu.accessibility":"Accessibility","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","menu.input-mode":"Input mode","context-menu.title":"Context menu","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.copy-link":"Copy editor link","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project can’t be shared because it’s too large. We’re working on it!","share-menu.upload-failed":"Sorry, we couldn’t upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new project…","share-menu.copied":"Copied link","document-name-menu.copy-link":"Copy link","status.offline":"Offline","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.avatar-color":"Avatar color","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","people-menu.anonymous-user":"New user","help-menu.import-tldr-file":"Import file…","help-menu.title":"Help and resources","help-menu.about":"About tldraw","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","help-menu.terms":"Terms of service","help-menu.privacy":"Privacy policy","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","edit-link-dialog.external-link":"External link","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site’s URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","shortcuts-dialog.a11y":"Accessibility","shortcuts-dialog.text-formatting":"Text formatting","style-panel.title":"Styles","style-panel.align":"Align","style-panel.label-align":"Label align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.arrow-kind":"Line","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","style-panel.selected":"selected","tool-panel.title":"Tools","tool-panel.more":"More","navigation-zone.title":"Navigation","navigation-zone.minimap":"Minimap","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","toast.success":"Success","toast.error":"Error","toast.info":"Info","toast.warning":"Warning","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn’t look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don’t ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don’t ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don’t ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We’ve updated this document to work with the current version of tldraw. If you’d like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don’t ask again","cursor-chat.type-to-chat":"Type to chat…","app.loading":"Loading tldraw…","handle.resize-top":"Resize top","handle.resize-bottom":"Resize bottom","handle.resize-left":"Resize left","handle.resize-right":"Resize right","handle.resize-top-left":"Resize top left","handle.resize-top-right":"Resize top right","handle.resize-bottom-left":"Resize bottom left","handle.resize-bottom-right":"Resize bottom right","handle.rotate.top_left_rotate":"Rotate top left","handle.rotate.top_right_rotate":"Rotate top right","handle.rotate.bottom_left_rotate":"Rotate bottom left","handle.rotate.bottom_right_rotate":"Rotate bottom right","handle.rotate.mobile_rotate":"Rotate","handle.crop.top":"Crop top","handle.crop.bottom":"Crop bottom","handle.crop.left":"Crop left","handle.crop.right":"Crop right","handle.crop.top-left":"Crop top left","handle.crop.top-right":"Crop top right","handle.crop.bottom-left":"Crop bottom left","handle.crop.bottom-right":"Crop bottom right","ui.close":"Close","ui.checked":"Checked","ui.unchecked":"Unchecked"},Pbe=new Set(["ar","fa","he","ur","ku"]),xp={locale:"en",label:"English",messages:oE,dir:"ltr"};async function Tbe(t,e){if(!(await gc(e.translations.en)).ok)return console.warn("No main translations found."),xp;if(t==="en")return xp;const r=ty.find(s=>s.locale===t);if(!r)return console.warn(`No translation found for locale ${t}`),xp;const o=await(await gc(e.translations[r.locale])).json();if(!o)return console.warn(`No messages found for locale ${t}`),xp;for(const s in xp.messages)o[s];return{locale:t,label:r.label,dir:Pbe.has(r.locale)?"rtl":"ltr",messages:{...xp.messages,...o}}}const qV=I.createContext(null);function GV(){const t=I.useContext(qV);if(!t)throw new Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return t}function YV({overrides:t,locale:e,children:n}){const r=UA(),[i,o]=I.useState(()=>t&&t.en?{locale:"en",label:"English",dir:"ltr",messages:{...oE,...t.en}}:{locale:"en",label:"English",dir:"ltr",messages:oE});return I.useEffect(()=>{let s=!1;async function a(){const l=await Tbe(e,r);l&&!s&&(t&&t[e]?o({...l,messages:{...l.messages,...t[e]}}):o(l))}return a(),()=>{s=!0}},[r,e,t]),g.jsx(qV.Provider,{value:i,children:n})}function Ve(){const t=GV();return I.useCallback(function(n){return t.messages[n]??n},[t])}const Ebe={normal:"tlui-button__normal",primary:"tlui-button__primary",danger:"tlui-button__danger",low:"tlui-button__low",icon:"tlui-button__icon",tool:"tlui-button__tool",menu:"tlui-button__menu",help:"tlui-button__help"},It=I.forwardRef(function({children:e,type:n,isActive:r,...i},o){return g.jsx("button",{ref:o,type:"button",draggable:!1,"data-isactive":r,...i,className:Ye("tlui-button",Ebe[n],i.className),children:e})});function Abe(){const t=ne(),e=Ve(),n=I.useRef(null),r=I.useCallback(i=>{t.markEventAsHandled(i),n.current?.blur();const o=t.getCurrentPageShapesInReadingOrder();o.length&&(t.setSelectedShapes([o[0].id]),t.zoomToSelectionIfOffscreen(256,{animation:{duration:t.options.animationMediumMs},inset:0}),t.timers.setTimeout(()=>t.getContainer().focus(),100))},[t]);return g.jsx(It,{ref:n,type:"low",tabIndex:0,className:"tl-skip-to-main-content",onClick:r,children:e("a11y.skip-to-main-content")})}const Mbe=I.memo(function(){const e=R0(),n=Ve(),r=J("a11y-msg",()=>e.currentMsg.get(),[]);return Dbe(r.msg),Obe(),r.msg&&g.jsx("div",{"aria-label":n("a11y.status"),"aria-live":r.priority||"assertive",role:"status","aria-hidden":"false",style:{position:"absolute",top:"-10000px",left:"-10000px"},children:r.msg})});function XV(t){const{editor:e,selectedShapeIds:n,msg:r}=t;let i="";const o=n.length;if(o>1)i=r("a11y.multiple-shapes").replace("{num}",o.toString());else if(o===1){const s=n[0],a=e.getShape(s);if(!a)return"";const l=e.getShapeUtil(a.type),c=["image","video"].includes(a.type);let d="";a.type==="geo"?d=r(`geo-style.${a.props.geo}`):c?d=r(`a11y.shape-${a.type}`):d=r(`tool.${a.type}`);const u=e.getCurrentPageShapesInReadingOrder(),p=(u.findIndex(x=>x.id===s)+1).toString(),f=u.length.toString(),y=r("a11y.shape-index").replace("{num}",p).replace("{total}",f),v=l.getAriaDescriptor(a)||l.getText(a)||"";i=(v?`${v}, `:"")+`${d}. ${y}`}return i}const Obe=()=>{const t=hr(),e=R0(),n=Ve(),r=I.useRef([]);E2("announce selection",()=>{if(!t)return;if(t.isIn("select.idle")){const o=t.getSelectedShapeIds();o!==r.current&&(r.current=o,lm(()=>{const s=XV({editor:t,selectedShapeIds:o,msg:n});s&&e.announce({msg:s})}))}},[t,e,n])},Dbe=t=>{const e=Cr();I.useEffect(()=>{if(Vn.a11y.get()){const n=i=>{console.debug(`%ca11y%c: ${i}`,"color: white; background: #40C057; padding: 2px;border-radius: 3px;","font-weight: normal")},r=i=>{const o=document.activeElement;if(i.key==="Tab"&&o&&o!==document.body&&!o.classList.contains("tl-container")){const s=o.getAttribute("aria-label")||o.getAttribute("title")||o.textContent;s&&n(s)}};return t&&n(t),document.addEventListener("keyup",r),()=>document.removeEventListener("keyup",r)}},[e,t])};function jbe(t,e){const n=ut(e.map(i=>t.getShape(i)).filter(i=>i&&t.isShapeOfType(i,"frame")));if(!n.length)return;const r=[];t.run(()=>{n.map(i=>{const o=t.getSortedChildIdsForParent(i.id);o.length&&(un(t,o,{filter:s=>!n.find(a=>a.id===s.id)}),r.push(...o))}),t.setSelectedShapes(r),t.deleteShapes(e)})}const XF=50;function ZV(t,e,n={padding:XF}){const r=pe.FromPoints(t.flatMap(c=>{if(!c)return[];const d=e.getShapeGeometry(c.id);return e.getShapeLocalTransform(c)?.applyToPoints(d.vertices)??[]})),i=n.padding??XF,o=r.w+2*i,s=r.h+2*i,a=i-r.minX,l=i-r.minY;return{w:o,h:s,dx:a,dy:l}}function JV(t,e,n={}){const r=t.getShape(e);if(!r)return;const i=t.getSortedChildIdsForParent(r.id),o=ut(i.map(u=>t.getShape(u)));if(!o.length)return;const{w:s,h:a,dx:l,dy:c}=ZV(o,t,n);if(l===0&&c===0&&r.props.w===s&&r.props.h===a)return;const d=new T(l,c).rot(r.rotation);t.run(()=>{const u=i.map(p=>{const f=t.getShape(p);return{id:f.id,type:f.type,x:f.x+l,y:f.y+c}});u.push({id:r.id,type:r.type,x:r.x-d.x,y:r.y-d.y,props:{w:s,h:a}}),t.updateShapes(u)})}function dr({children:t}){return g.jsx("span",{className:"tlui-button__label",children:t})}function ZF(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function $0(...t){return e=>{let n=!1;const r=t.map(i=>{const o=ZF(i,e);return!n&&typeof o=="function"&&(n=!0),o});if(n)return()=>{for(let i=0;i<r.length;i++){const o=r[i];typeof o=="function"?o():ZF(t[i],null)}}}}function hn(...t){return I.useCallback($0(...t),t)}function lh(t){const e=Rbe(t),n=I.forwardRef((r,i)=>{const{children:o,...s}=r,a=I.Children.toArray(o),l=a.find(Nbe);if(l){const c=l.props.children,d=a.map(u=>u===l?I.Children.count(c)>1?I.Children.only(null):I.isValidElement(c)?c.props.children:null:u);return g.jsx(e,{...s,ref:i,children:I.isValidElement(c)?I.cloneElement(c,void 0,d):null})}return g.jsx(e,{...s,ref:i,children:o})});return n.displayName=`${t}.Slot`,n}var HA=lh("Slot");function Rbe(t){const e=I.forwardRef((n,r)=>{const{children:i,...o}=n;if(I.isValidElement(i)){const s=zbe(i),a=Lbe(o,i.props);return i.type!==I.Fragment&&(a.ref=r?$0(r,s):s),I.cloneElement(i,a)}return I.Children.count(i)>1?I.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var QV=Symbol("radix.slottable");function $be(t){const e=({children:n})=>g.jsx(g.Fragment,{children:n});return e.displayName=`${t}.Slottable`,e.__radixId=QV,e}function Nbe(t){return I.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===QV}function Lbe(t,e){const n={...e};for(const r in e){const i=t[r],o=e[r];/^on[A-Z]/.test(r)?i&&o?n[r]=(...a)=>{const l=o(...a);return i(...a),l}:i&&(n[r]=i):r==="style"?n[r]={...i,...o}:r==="className"&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...t,...n}}function zbe(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var Fbe=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ct=Fbe.reduce((t,e)=>{const n=lh(`Primitive.${e}`),r=I.forwardRef((i,o)=>{const{asChild:s,...a}=i,l=s?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),g.jsx(l,{...a,ref:o})});return r.displayName=`Primitive.${e}`,{...t,[e]:r}},{});function WA(t,e){t&&_h.flushSync(()=>t.dispatchEvent(e))}var Bbe=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),Ube="VisuallyHidden",N0=I.forwardRef((t,e)=>g.jsx(Ct.span,{...t,ref:e,style:{...Bbe,...t.style}}));N0.displayName=Ube;var Hbe=N0;function Wbe(t,e){const n=I.createContext(e),r=o=>{const{children:s,...a}=o,l=I.useMemo(()=>a,Object.values(a));return g.jsx(n.Provider,{value:l,children:s})};r.displayName=t+"Provider";function i(o){const s=I.useContext(n);if(s)return s;if(e!==void 0)return e;throw new Error(`\`${o}\` must be used within \`${t}\``)}return[r,i]}function Ms(t,e=[]){let n=[];function r(o,s){const a=I.createContext(s),l=n.length;n=[...n,s];const c=u=>{const{scope:p,children:f,...y}=u,v=p?.[t]?.[l]||a,x=I.useMemo(()=>y,Object.values(y));return g.jsx(v.Provider,{value:x,children:f})};c.displayName=o+"Provider";function d(u,p){const f=p?.[t]?.[l]||a,y=I.useContext(f);if(y)return y;if(s!==void 0)return s;throw new Error(`\`${u}\` must be used within \`${o}\``)}return[c,d]}const i=()=>{const o=n.map(s=>I.createContext(s));return function(a){const l=a?.[t]||o;return I.useMemo(()=>({[`__scope${t}`]:{...a,[t]:l}}),[a,l])}};return i.scopeName=t,[r,Vbe(i,...e)]}function Vbe(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(o){const s=r.reduce((a,{useScope:l,scopeName:c})=>{const u=l(o)[`__scope${c}`];return{...a,...u}},{});return I.useMemo(()=>({[`__scope${e.scopeName}`]:s}),[s])}};return n.scopeName=e.scopeName,n}function L0(t){const e=t+"CollectionProvider",[n,r]=Ms(e),[i,o]=n(e,{collectionRef:{current:null},itemMap:new Map}),s=v=>{const{scope:x,children:b}=v,w=rt.useRef(null),_=rt.useRef(new Map).current;return g.jsx(i,{scope:x,itemMap:_,collectionRef:w,children:b})};s.displayName=e;const a=t+"CollectionSlot",l=lh(a),c=rt.forwardRef((v,x)=>{const{scope:b,children:w}=v,_=o(a,b),C=hn(x,_.collectionRef);return g.jsx(l,{ref:C,children:w})});c.displayName=a;const d=t+"CollectionItemSlot",u="data-radix-collection-item",p=lh(d),f=rt.forwardRef((v,x)=>{const{scope:b,children:w,..._}=v,C=rt.useRef(null),A=hn(x,C),E=o(d,b);return rt.useEffect(()=>(E.itemMap.set(C,{ref:C,..._}),()=>void E.itemMap.delete(C))),g.jsx(p,{[u]:"",ref:A,children:w})});f.displayName=d;function y(v){const x=o(t+"CollectionConsumer",v);return rt.useCallback(()=>{const w=x.collectionRef.current;if(!w)return[];const _=Array.from(w.querySelectorAll(`[${u}]`));return Array.from(x.itemMap.values()).sort((E,O)=>_.indexOf(E.ref.current)-_.indexOf(O.ref.current))},[x.collectionRef,x.itemMap])}return[{Provider:s,Slot:c,ItemSlot:f},y,r]}function Fe(t,e,{checkForDefaultPrevented:n=!0}={}){return function(i){if(t?.(i),n===!1||!i.defaultPrevented)return e?.(i)}}var yc=globalThis?.document?I.useLayoutEffect:()=>{},Kbe=ZB[" useInsertionEffect ".trim().toString()]||yc;function ha({prop:t,defaultProp:e,onChange:n=()=>{},caller:r}){const[i,o,s]=qbe({defaultProp:e,onChange:n}),a=t!==void 0,l=a?t:i;{const d=I.useRef(t!==void 0);I.useEffect(()=>{const u=d.current;u!==a&&console.warn(`${r} is changing from ${u?"controlled":"uncontrolled"} to ${a?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),d.current=a},[a,r])}const c=I.useCallback(d=>{if(a){const u=Gbe(d)?d(t):d;u!==t&&s.current?.(u)}else o(d)},[a,t,o,s]);return[l,c]}function qbe({defaultProp:t,onChange:e}){const[n,r]=I.useState(t),i=I.useRef(n),o=I.useRef(e);return Kbe(()=>{o.current=e},[e]),I.useEffect(()=>{i.current!==n&&(o.current?.(n),i.current=n)},[n,i]),[n,r,o]}function Gbe(t){return typeof t=="function"}function Ybe(t,e){return I.useReducer((n,r)=>e[n][r]??n,t)}var pa=t=>{const{present:e,children:n}=t,r=Xbe(e),i=typeof n=="function"?n({present:r.isPresent}):I.Children.only(n),o=hn(r.ref,Zbe(i));return typeof n=="function"||r.isPresent?I.cloneElement(i,{ref:o}):null};pa.displayName="Presence";function Xbe(t){const[e,n]=I.useState(),r=I.useRef(null),i=I.useRef(t),o=I.useRef("none"),s=t?"mounted":"unmounted",[a,l]=Ybe(s,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return I.useEffect(()=>{const c=Yx(r.current);o.current=a==="mounted"?c:"none"},[a]),yc(()=>{const c=r.current,d=i.current;if(d!==t){const p=o.current,f=Yx(c);t?l("MOUNT"):f==="none"||c?.display==="none"?l("UNMOUNT"):l(d&&p!==f?"ANIMATION_OUT":"UNMOUNT"),i.current=t}},[t,l]),yc(()=>{if(e){let c;const d=e.ownerDocument.defaultView??window,u=f=>{const v=Yx(r.current).includes(CSS.escape(f.animationName));if(f.target===e&&v&&(l("ANIMATION_END"),!i.current)){const x=e.style.animationFillMode;e.style.animationFillMode="forwards",c=d.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=x)})}},p=f=>{f.target===e&&(o.current=Yx(r.current))};return e.addEventListener("animationstart",p),e.addEventListener("animationcancel",u),e.addEventListener("animationend",u),()=>{d.clearTimeout(c),e.removeEventListener("animationstart",p),e.removeEventListener("animationcancel",u),e.removeEventListener("animationend",u)}}else l("ANIMATION_END")},[e,l]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:I.useCallback(c=>{r.current=c?getComputedStyle(c):null,n(c)},[])}}function Yx(t){return t?.animationName||"none"}function Zbe(t){let e=Object.getOwnPropertyDescriptor(t.props,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=Object.getOwnPropertyDescriptor(t,"ref")?.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var Jbe=ZB[" useId ".trim().toString()]||(()=>{}),Qbe=0;function wl(t){const[e,n]=I.useState(Jbe());return yc(()=>{n(r=>r??String(Qbe++))},[t]),e?`radix-${e}`:""}var ewe=I.createContext(void 0);function lv(t){const e=I.useContext(ewe);return t||e||"ltr"}function wo(t){const e=I.useRef(t);return I.useEffect(()=>{e.current=t}),I.useMemo(()=>(...n)=>e.current?.(...n),[])}function twe(t,e=globalThis?.document){const n=wo(t);I.useEffect(()=>{const r=i=>{i.key==="Escape"&&n(i)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[n,e])}var nwe="DismissableLayer",sE="dismissableLayer.update",rwe="dismissableLayer.pointerDownOutside",iwe="dismissableLayer.focusOutside",JF,eK=I.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Nf=I.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:o,onInteractOutside:s,onDismiss:a,...l}=t,c=I.useContext(eK),[d,u]=I.useState(null),p=d?.ownerDocument??globalThis?.document,[,f]=I.useState({}),y=hn(e,O=>u(O)),v=Array.from(c.layers),[x]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),b=v.indexOf(x),w=d?v.indexOf(d):-1,_=c.layersWithOutsidePointerEventsDisabled.size>0,C=w>=b,A=swe(O=>{const D=O.target,B=[...c.branches].some(L=>L.contains(D));!C||B||(i?.(O),s?.(O),O.defaultPrevented||a?.())},p),E=awe(O=>{const D=O.target;[...c.branches].some(L=>L.contains(D))||(o?.(O),s?.(O),O.defaultPrevented||a?.())},p);return twe(O=>{w===c.layers.size-1&&(r?.(O),!O.defaultPrevented&&a&&(O.preventDefault(),a()))},p),I.useEffect(()=>{if(d)return n&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(JF=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(d)),c.layers.add(d),QF(),()=>{n&&c.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=JF)}},[d,p,n,c]),I.useEffect(()=>()=>{d&&(c.layers.delete(d),c.layersWithOutsidePointerEventsDisabled.delete(d),QF())},[d,c]),I.useEffect(()=>{const O=()=>f({});return document.addEventListener(sE,O),()=>document.removeEventListener(sE,O)},[]),g.jsx(Ct.div,{...l,ref:y,style:{pointerEvents:_?C?"auto":"none":void 0,...t.style},onFocusCapture:Fe(t.onFocusCapture,E.onFocusCapture),onBlurCapture:Fe(t.onBlurCapture,E.onBlurCapture),onPointerDownCapture:Fe(t.onPointerDownCapture,A.onPointerDownCapture)})});Nf.displayName=nwe;var owe="DismissableLayerBranch",tK=I.forwardRef((t,e)=>{const n=I.useContext(eK),r=I.useRef(null),i=hn(e,r);return I.useEffect(()=>{const o=r.current;if(o)return n.branches.add(o),()=>{n.branches.delete(o)}},[n.branches]),g.jsx(Ct.div,{...t,ref:i})});tK.displayName=owe;function swe(t,e=globalThis?.document){const n=wo(t),r=I.useRef(!1),i=I.useRef(()=>{});return I.useEffect(()=>{const o=a=>{if(a.target&&!r.current){let l=function(){nK(rwe,n,c,{discrete:!0})};const c={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=l,e.addEventListener("click",i.current,{once:!0})):l()}else e.removeEventListener("click",i.current);r.current=!1},s=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(s),e.removeEventListener("pointerdown",o),e.removeEventListener("click",i.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function awe(t,e=globalThis?.document){const n=wo(t),r=I.useRef(!1);return I.useEffect(()=>{const i=o=>{o.target&&!r.current&&nK(iwe,n,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function QF(){const t=new CustomEvent(sE);document.dispatchEvent(t)}function nK(t,e,n,{discrete:r}){const i=n.originalEvent.target,o=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&i.addEventListener(t,e,{once:!0}),r?WA(i,o):i.dispatchEvent(o)}var lwe=Nf,cwe=tK,mP="focusScope.autoFocusOnMount",yP="focusScope.autoFocusOnUnmount",e3={bubbles:!1,cancelable:!0},uwe="FocusScope",z0=I.forwardRef((t,e)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:o,...s}=t,[a,l]=I.useState(null),c=wo(i),d=wo(o),u=I.useRef(null),p=hn(e,v=>l(v)),f=I.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;I.useEffect(()=>{if(r){let v=function(_){if(f.paused||!a)return;const C=_.target;a.contains(C)?u.current=C:cu(u.current,{select:!0})},x=function(_){if(f.paused||!a)return;const C=_.relatedTarget;C!==null&&(a.contains(C)||cu(u.current,{select:!0}))},b=function(_){if(document.activeElement===document.body)for(const A of _)A.removedNodes.length>0&&cu(a)};document.addEventListener("focusin",v),document.addEventListener("focusout",x);const w=new MutationObserver(b);return a&&w.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",v),document.removeEventListener("focusout",x),w.disconnect()}}},[r,a,f.paused]),I.useEffect(()=>{if(a){n3.add(f);const v=document.activeElement;if(!a.contains(v)){const b=new CustomEvent(mP,e3);a.addEventListener(mP,c),a.dispatchEvent(b),b.defaultPrevented||(dwe(mwe(rK(a)),{select:!0}),document.activeElement===v&&cu(a))}return()=>{a.removeEventListener(mP,c),setTimeout(()=>{const b=new CustomEvent(yP,e3);a.addEventListener(yP,d),a.dispatchEvent(b),b.defaultPrevented||cu(v??document.body,{select:!0}),a.removeEventListener(yP,d),n3.remove(f)},0)}}},[a,c,d,f]);const y=I.useCallback(v=>{if(!n&&!r||f.paused)return;const x=v.key==="Tab"&&!v.altKey&&!v.ctrlKey&&!v.metaKey,b=document.activeElement;if(x&&b){const w=v.currentTarget,[_,C]=hwe(w);_&&C?!v.shiftKey&&b===C?(v.preventDefault(),n&&cu(_,{select:!0})):v.shiftKey&&b===_&&(v.preventDefault(),n&&cu(C,{select:!0})):b===w&&v.preventDefault()}},[n,r,f.paused]);return g.jsx(Ct.div,{tabIndex:-1,...s,ref:p,onKeyDown:y})});z0.displayName=uwe;function dwe(t,{select:e=!1}={}){const n=document.activeElement;for(const r of t)if(cu(r,{select:e}),document.activeElement!==n)return}function hwe(t){const e=rK(t),n=t3(e,t),r=t3(e.reverse(),t);return[n,r]}function rK(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function t3(t,e){for(const n of t)if(!pwe(n,{upTo:e}))return n}function pwe(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function fwe(t){return t instanceof HTMLInputElement&&"select"in t}function cu(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&fwe(t)&&e&&t.select()}}var n3=gwe();function gwe(){let t=[];return{add(e){const n=t[0];e!==n&&n?.pause(),t=r3(t,e),t.unshift(e)},remove(e){t=r3(t,e),t[0]?.resume()}}}function r3(t,e){const n=[...t],r=n.indexOf(e);return r!==-1&&n.splice(r,1),n}function mwe(t){return t.filter(e=>e.tagName!=="A")}var ywe="Portal",cv=I.forwardRef((t,e)=>{const{container:n,...r}=t,[i,o]=I.useState(!1);yc(()=>o(!0),[]);const s=n||i&&globalThis?.document?.body;return s?Due.createPortal(g.jsx(Ct.div,{...r,ref:e}),s):null});cv.displayName=ywe;var vP=0;function VA(){I.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??i3()),document.body.insertAdjacentElement("beforeend",t[1]??i3()),vP++,()=>{vP===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),vP--}},[])}function i3(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var gl=function(){return gl=Object.assign||function(e){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},gl.apply(this,arguments)};function iK(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n}function vwe(t,e,n){if(n||arguments.length===2)for(var r=0,i=e.length,o;r<i;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}var HS="right-scroll-bar-position",WS="width-before-scroll-bar",xwe="with-scroll-bars-hidden",Swe="--removed-body-scroll-bar-size";function xP(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function bwe(t,e){var n=I.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(r){var i=n.value;i!==r&&(n.value=r,n.callback(r,i))}}}})[0];return n.callback=e,n.facade}var wwe=typeof window<"u"?I.useLayoutEffect:I.useEffect,o3=new WeakMap;function kwe(t,e){var n=bwe(null,function(r){return t.forEach(function(i){return xP(i,r)})});return wwe(function(){var r=o3.get(n);if(r){var i=new Set(r),o=new Set(t),s=n.current;i.forEach(function(a){o.has(a)||xP(a,null)}),o.forEach(function(a){i.has(a)||xP(a,s)})}o3.set(n,t)},[t]),n}function Iwe(t){return t}function _we(t,e){e===void 0&&(e=Iwe);var n=[],r=!1,i={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(o){var s=e(o,r);return n.push(s),function(){n=n.filter(function(a){return a!==s})}},assignSyncMedium:function(o){for(r=!0;n.length;){var s=n;n=[],s.forEach(o)}n={push:function(a){return o(a)},filter:function(){return n}}},assignMedium:function(o){r=!0;var s=[];if(n.length){var a=n;n=[],a.forEach(o),s=n}var l=function(){var d=s;s=[],d.forEach(o)},c=function(){return Promise.resolve().then(l)};c(),n={push:function(d){s.push(d),c()},filter:function(d){return s=s.filter(d),n}}}};return i}function Cwe(t){t===void 0&&(t={});var e=_we(null);return e.options=gl({async:!0,ssr:!1},t),e}var oK=function(t){var e=t.sideCar,n=iK(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return I.createElement(r,gl({},n))};oK.isSideCarExport=!0;function Pwe(t,e){return t.useMedium(e),oK}var sK=Cwe(),SP=function(){},F0=I.forwardRef(function(t,e){var n=I.useRef(null),r=I.useState({onScrollCapture:SP,onWheelCapture:SP,onTouchMoveCapture:SP}),i=r[0],o=r[1],s=t.forwardProps,a=t.children,l=t.className,c=t.removeScrollBar,d=t.enabled,u=t.shards,p=t.sideCar,f=t.noRelative,y=t.noIsolation,v=t.inert,x=t.allowPinchZoom,b=t.as,w=b===void 0?"div":b,_=t.gapMode,C=iK(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),A=p,E=kwe([n,e]),O=gl(gl({},C),i);return I.createElement(I.Fragment,null,d&&I.createElement(A,{sideCar:sK,removeScrollBar:c,shards:u,noRelative:f,noIsolation:y,inert:v,setCallbacks:o,allowPinchZoom:!!x,lockRef:n,gapMode:_}),s?I.cloneElement(I.Children.only(a),gl(gl({},O),{ref:E})):I.createElement(w,gl({},O,{className:l,ref:E}),a))});F0.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};F0.classNames={fullWidth:WS,zeroRight:HS};var Twe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Ewe(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=Twe();return e&&t.setAttribute("nonce",e),t}function Awe(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function Mwe(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var Owe=function(){var t=0,e=null;return{add:function(n){t==0&&(e=Ewe())&&(Awe(e,n),Mwe(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},Dwe=function(){var t=Owe();return function(e,n){I.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},aK=function(){var t=Dwe(),e=function(n){var r=n.styles,i=n.dynamic;return t(r,i),null};return e},jwe={left:0,top:0,right:0,gap:0},bP=function(t){return parseInt(t||"",10)||0},Rwe=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],r=e[t==="padding"?"paddingTop":"marginTop"],i=e[t==="padding"?"paddingRight":"marginRight"];return[bP(n),bP(r),bP(i)]},$we=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return jwe;var e=Rwe(t),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-n+e[2]-e[0])}},Nwe=aK(),Zp="data-scroll-locked",Lwe=function(t,e,n,r){var i=t.left,o=t.top,s=t.right,a=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(xwe,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(Zp,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(s,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(HS,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(WS,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(HS," .").concat(HS,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(WS," .").concat(WS,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(Zp,`] {
    `).concat(Swe,": ").concat(a,`px;
  }
`)},s3=function(){var t=parseInt(document.body.getAttribute(Zp)||"0",10);return isFinite(t)?t:0},zwe=function(){I.useEffect(function(){return document.body.setAttribute(Zp,(s3()+1).toString()),function(){var t=s3()-1;t<=0?document.body.removeAttribute(Zp):document.body.setAttribute(Zp,t.toString())}},[])},Fwe=function(t){var e=t.noRelative,n=t.noImportant,r=t.gapMode,i=r===void 0?"margin":r;zwe();var o=I.useMemo(function(){return $we(i)},[i]);return I.createElement(Nwe,{styles:Lwe(o,!e,i,n?"":"!important")})},aE=!1;if(typeof window<"u")try{var Xx=Object.defineProperty({},"passive",{get:function(){return aE=!0,!0}});window.addEventListener("test",Xx,Xx),window.removeEventListener("test",Xx,Xx)}catch{aE=!1}var Sp=aE?{passive:!1}:!1,Bwe=function(t){return t.tagName==="TEXTAREA"},lK=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!Bwe(t)&&n[e]==="visible")},Uwe=function(t){return lK(t,"overflowY")},Hwe=function(t){return lK(t,"overflowX")},a3=function(t,e){var n=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var i=cK(t,r);if(i){var o=uK(t,r),s=o[1],a=o[2];if(s>a)return!0}r=r.parentNode}while(r&&r!==n.body);return!1},Wwe=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},Vwe=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},cK=function(t,e){return t==="v"?Uwe(e):Hwe(e)},uK=function(t,e){return t==="v"?Wwe(e):Vwe(e)},Kwe=function(t,e){return t==="h"&&e==="rtl"?-1:1},qwe=function(t,e,n,r,i){var o=Kwe(t,window.getComputedStyle(e).direction),s=o*r,a=n.target,l=e.contains(a),c=!1,d=s>0,u=0,p=0;do{if(!a)break;var f=uK(t,a),y=f[0],v=f[1],x=f[2],b=v-x-o*y;(y||b)&&cK(t,a)&&(u+=b,p+=y);var w=a.parentNode;a=w&&w.nodeType===Node.DOCUMENT_FRAGMENT_NODE?w.host:w}while(!l&&a!==document.body||l&&(e.contains(a)||e===a));return(d&&Math.abs(u)<1||!d&&Math.abs(p)<1)&&(c=!0),c},Zx=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},l3=function(t){return[t.deltaX,t.deltaY]},c3=function(t){return t&&"current"in t?t.current:t},Gwe=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Ywe=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},Xwe=0,bp=[];function Zwe(t){var e=I.useRef([]),n=I.useRef([0,0]),r=I.useRef(),i=I.useState(Xwe++)[0],o=I.useState(aK)[0],s=I.useRef(t);I.useEffect(function(){s.current=t},[t]),I.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(i));var v=vwe([t.lockRef.current],(t.shards||[]).map(c3),!0).filter(Boolean);return v.forEach(function(x){return x.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),v.forEach(function(x){return x.classList.remove("allow-interactivity-".concat(i))})}}},[t.inert,t.lockRef.current,t.shards]);var a=I.useCallback(function(v,x){if("touches"in v&&v.touches.length===2||v.type==="wheel"&&v.ctrlKey)return!s.current.allowPinchZoom;var b=Zx(v),w=n.current,_="deltaX"in v?v.deltaX:w[0]-b[0],C="deltaY"in v?v.deltaY:w[1]-b[1],A,E=v.target,O=Math.abs(_)>Math.abs(C)?"h":"v";if("touches"in v&&O==="h"&&E.type==="range")return!1;var D=a3(O,E);if(!D)return!0;if(D?A=O:(A=O==="v"?"h":"v",D=a3(O,E)),!D)return!1;if(!r.current&&"changedTouches"in v&&(_||C)&&(r.current=A),!A)return!0;var B=r.current||A;return qwe(B,x,v,B==="h"?_:C)},[]),l=I.useCallback(function(v){var x=v;if(!(!bp.length||bp[bp.length-1]!==o)){var b="deltaY"in x?l3(x):Zx(x),w=e.current.filter(function(A){return A.name===x.type&&(A.target===x.target||x.target===A.shadowParent)&&Gwe(A.delta,b)})[0];if(w&&w.should){x.cancelable&&x.preventDefault();return}if(!w){var _=(s.current.shards||[]).map(c3).filter(Boolean).filter(function(A){return A.contains(x.target)}),C=_.length>0?a(x,_[0]):!s.current.noIsolation;C&&x.cancelable&&x.preventDefault()}}},[]),c=I.useCallback(function(v,x,b,w){var _={name:v,delta:x,target:b,should:w,shadowParent:Jwe(b)};e.current.push(_),setTimeout(function(){e.current=e.current.filter(function(C){return C!==_})},1)},[]),d=I.useCallback(function(v){n.current=Zx(v),r.current=void 0},[]),u=I.useCallback(function(v){c(v.type,l3(v),v.target,a(v,t.lockRef.current))},[]),p=I.useCallback(function(v){c(v.type,Zx(v),v.target,a(v,t.lockRef.current))},[]);I.useEffect(function(){return bp.push(o),t.setCallbacks({onScrollCapture:u,onWheelCapture:u,onTouchMoveCapture:p}),document.addEventListener("wheel",l,Sp),document.addEventListener("touchmove",l,Sp),document.addEventListener("touchstart",d,Sp),function(){bp=bp.filter(function(v){return v!==o}),document.removeEventListener("wheel",l,Sp),document.removeEventListener("touchmove",l,Sp),document.removeEventListener("touchstart",d,Sp)}},[]);var f=t.removeScrollBar,y=t.inert;return I.createElement(I.Fragment,null,y?I.createElement(o,{styles:Ywe(i)}):null,f?I.createElement(Fwe,{noRelative:t.noRelative,gapMode:t.gapMode}):null)}function Jwe(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const Qwe=Pwe(sK,Zwe);var B0=I.forwardRef(function(t,e){return I.createElement(F0,gl({},t,{ref:e,sideCar:Qwe}))});B0.classNames=F0.classNames;var e0e=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},wp=new WeakMap,Jx=new WeakMap,Qx={},wP=0,dK=function(t){return t&&(t.host||dK(t.parentNode))},t0e=function(t,e){return e.map(function(n){if(t.contains(n))return n;var r=dK(n);return r&&t.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},n0e=function(t,e,n,r){var i=t0e(e,Array.isArray(t)?t:[t]);Qx[n]||(Qx[n]=new WeakMap);var o=Qx[n],s=[],a=new Set,l=new Set(i),c=function(u){!u||a.has(u)||(a.add(u),c(u.parentNode))};i.forEach(c);var d=function(u){!u||l.has(u)||Array.prototype.forEach.call(u.children,function(p){if(a.has(p))d(p);else try{var f=p.getAttribute(r),y=f!==null&&f!=="false",v=(wp.get(p)||0)+1,x=(o.get(p)||0)+1;wp.set(p,v),o.set(p,x),s.push(p),v===1&&y&&Jx.set(p,!0),x===1&&p.setAttribute(n,"true"),y||p.setAttribute(r,"true")}catch(b){console.error("aria-hidden: cannot operate on ",p,b)}})};return d(e),a.clear(),wP++,function(){s.forEach(function(u){var p=wp.get(u)-1,f=o.get(u)-1;wp.set(u,p),o.set(u,f),p||(Jx.has(u)||u.removeAttribute(r),Jx.delete(u)),f||u.removeAttribute(n)}),wP--,wP||(wp=new WeakMap,wp=new WeakMap,Jx=new WeakMap,Qx={})}},KA=function(t,e,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(t)?t:[t]),i=e0e(t);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live], script"))),n0e(r,i,n,"aria-hidden")):function(){return null}},U0="Dialog",[hK]=Ms(U0),[r0e,Xa]=hK(U0),pK=t=>{const{__scopeDialog:e,children:n,open:r,defaultOpen:i,onOpenChange:o,modal:s=!0}=t,a=I.useRef(null),l=I.useRef(null),[c,d]=ha({prop:r,defaultProp:i??!1,onChange:o,caller:U0});return g.jsx(r0e,{scope:e,triggerRef:a,contentRef:l,contentId:wl(),titleId:wl(),descriptionId:wl(),open:c,onOpenChange:d,onOpenToggle:I.useCallback(()=>d(u=>!u),[d]),modal:s,children:n})};pK.displayName=U0;var fK="DialogTrigger",i0e=I.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Xa(fK,n),o=hn(e,i.triggerRef);return g.jsx(Ct.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":YA(i.open),...r,ref:o,onClick:Fe(t.onClick,i.onOpenToggle)})});i0e.displayName=fK;var qA="DialogPortal",[o0e,gK]=hK(qA,{forceMount:void 0}),mK=t=>{const{__scopeDialog:e,forceMount:n,children:r,container:i}=t,o=Xa(qA,e);return g.jsx(o0e,{scope:e,forceMount:n,children:I.Children.map(r,s=>g.jsx(pa,{present:n||o.open,children:g.jsx(cv,{asChild:!0,container:i,children:s})}))})};mK.displayName=qA;var Db="DialogOverlay",yK=I.forwardRef((t,e)=>{const n=gK(Db,t.__scopeDialog),{forceMount:r=n.forceMount,...i}=t,o=Xa(Db,t.__scopeDialog);return o.modal?g.jsx(pa,{present:r||o.open,children:g.jsx(a0e,{...i,ref:e})}):null});yK.displayName=Db;var s0e=lh("DialogOverlay.RemoveScroll"),a0e=I.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Xa(Db,n);return g.jsx(B0,{as:s0e,allowPinchZoom:!0,shards:[i.contentRef],children:g.jsx(Ct.div,{"data-state":YA(i.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),ch="DialogContent",vK=I.forwardRef((t,e)=>{const n=gK(ch,t.__scopeDialog),{forceMount:r=n.forceMount,...i}=t,o=Xa(ch,t.__scopeDialog);return g.jsx(pa,{present:r||o.open,children:o.modal?g.jsx(l0e,{...i,ref:e}):g.jsx(c0e,{...i,ref:e})})});vK.displayName=ch;var l0e=I.forwardRef((t,e)=>{const n=Xa(ch,t.__scopeDialog),r=I.useRef(null),i=hn(e,n.contentRef,r);return I.useEffect(()=>{const o=r.current;if(o)return KA(o)},[]),g.jsx(xK,{...t,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Fe(t.onCloseAutoFocus,o=>{o.preventDefault(),n.triggerRef.current?.focus()}),onPointerDownOutside:Fe(t.onPointerDownOutside,o=>{const s=o.detail.originalEvent,a=s.button===0&&s.ctrlKey===!0;(s.button===2||a)&&o.preventDefault()}),onFocusOutside:Fe(t.onFocusOutside,o=>o.preventDefault())})}),c0e=I.forwardRef((t,e)=>{const n=Xa(ch,t.__scopeDialog),r=I.useRef(!1),i=I.useRef(!1);return g.jsx(xK,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{t.onCloseAutoFocus?.(o),o.defaultPrevented||(r.current||n.triggerRef.current?.focus(),o.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:o=>{t.onInteractOutside?.(o),o.defaultPrevented||(r.current=!0,o.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const s=o.target;n.triggerRef.current?.contains(s)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&i.current&&o.preventDefault()}})}),xK=I.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,...s}=t,a=Xa(ch,n),l=I.useRef(null),c=hn(e,l);return VA(),g.jsxs(g.Fragment,{children:[g.jsx(z0,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o,children:g.jsx(Nf,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":YA(a.open),...s,ref:c,onDismiss:()=>a.onOpenChange(!1)})}),g.jsxs(g.Fragment,{children:[g.jsx(d0e,{titleId:a.titleId}),g.jsx(p0e,{contentRef:l,descriptionId:a.descriptionId})]})]})}),GA="DialogTitle",SK=I.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Xa(GA,n);return g.jsx(Ct.h2,{id:i.titleId,...r,ref:e})});SK.displayName=GA;var bK="DialogDescription",u0e=I.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Xa(bK,n);return g.jsx(Ct.p,{id:i.descriptionId,...r,ref:e})});u0e.displayName=bK;var wK="DialogClose",kK=I.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,i=Xa(wK,n);return g.jsx(Ct.button,{type:"button",...r,ref:e,onClick:Fe(t.onClick,()=>i.onOpenChange(!1))})});kK.displayName=wK;function YA(t){return t?"open":"closed"}var IK="DialogTitleWarning",[yHe,_K]=Wbe(IK,{contentName:ch,titleName:GA,docsSlug:"dialog"}),d0e=({titleId:t})=>{const e=_K(IK),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return I.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},h0e="DialogDescriptionWarning",p0e=({contentRef:t,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${_K(h0e).contentName}}.`;return I.useEffect(()=>{const i=t.current?.getAttribute("aria-describedby");e&&i&&(document.getElementById(e)||console.warn(r))},[r,t,e]),null},f0e=pK,g0e=mK,m0e=yK,y0e=vK,v0e=SK;function x0e(t){const e=I.useRef({value:t,previous:t});return I.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}function CK(t){const[e,n]=I.useState(void 0);return yc(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const o=i[0];let s,a;if("borderBoxSize"in o){const l=o.borderBoxSize,c=Array.isArray(l)?l[0]:l;s=c.inlineSize,a=c.blockSize}else s=t.offsetWidth,a=t.offsetHeight;n({width:s,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}const S0e=["top","right","bottom","left"],Ru=Math.min,gs=Math.max,jb=Math.round,eS=Math.floor,kl=t=>({x:t,y:t}),b0e={left:"right",right:"left",bottom:"top",top:"bottom"},w0e={start:"end",end:"start"};function lE(t,e,n){return gs(t,Ru(e,n))}function vc(t,e){return typeof t=="function"?t(e):t}function xc(t){return t.split("-")[0]}function Lf(t){return t.split("-")[1]}function XA(t){return t==="x"?"y":"x"}function ZA(t){return t==="y"?"height":"width"}const k0e=new Set(["top","bottom"]);function Sl(t){return k0e.has(xc(t))?"y":"x"}function JA(t){return XA(Sl(t))}function I0e(t,e,n){n===void 0&&(n=!1);const r=Lf(t),i=JA(t),o=ZA(i);let s=i==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[o]>e.floating[o]&&(s=Rb(s)),[s,Rb(s)]}function _0e(t){const e=Rb(t);return[cE(t),e,cE(e)]}function cE(t){return t.replace(/start|end/g,e=>w0e[e])}const u3=["left","right"],d3=["right","left"],C0e=["top","bottom"],P0e=["bottom","top"];function T0e(t,e,n){switch(t){case"top":case"bottom":return n?e?d3:u3:e?u3:d3;case"left":case"right":return e?C0e:P0e;default:return[]}}function E0e(t,e,n,r){const i=Lf(t);let o=T0e(xc(t),n==="start",r);return i&&(o=o.map(s=>s+"-"+i),e&&(o=o.concat(o.map(cE)))),o}function Rb(t){return t.replace(/left|right|bottom|top/g,e=>b0e[e])}function A0e(t){return{top:0,right:0,bottom:0,left:0,...t}}function PK(t){return typeof t!="number"?A0e(t):{top:t,right:t,bottom:t,left:t}}function $b(t){const{x:e,y:n,width:r,height:i}=t;return{width:r,height:i,top:n,left:e,right:e+r,bottom:n+i,x:e,y:n}}function h3(t,e,n){let{reference:r,floating:i}=t;const o=Sl(e),s=JA(e),a=ZA(s),l=xc(e),c=o==="y",d=r.x+r.width/2-i.width/2,u=r.y+r.height/2-i.height/2,p=r[a]/2-i[a]/2;let f;switch(l){case"top":f={x:d,y:r.y-i.height};break;case"bottom":f={x:d,y:r.y+r.height};break;case"right":f={x:r.x+r.width,y:u};break;case"left":f={x:r.x-i.width,y:u};break;default:f={x:r.x,y:r.y}}switch(Lf(e)){case"start":f[s]-=p*(n&&c?-1:1);break;case"end":f[s]+=p*(n&&c?-1:1);break}return f}const M0e=async(t,e,n)=>{const{placement:r="bottom",strategy:i="absolute",middleware:o=[],platform:s}=n,a=o.filter(Boolean),l=await(s.isRTL==null?void 0:s.isRTL(e));let c=await s.getElementRects({reference:t,floating:e,strategy:i}),{x:d,y:u}=h3(c,r,l),p=r,f={},y=0;for(let v=0;v<a.length;v++){const{name:x,fn:b}=a[v],{x:w,y:_,data:C,reset:A}=await b({x:d,y:u,initialPlacement:r,placement:p,strategy:i,middlewareData:f,rects:c,platform:s,elements:{reference:t,floating:e}});d=w??d,u=_??u,f={...f,[x]:{...f[x],...C}},A&&y<=50&&(y++,typeof A=="object"&&(A.placement&&(p=A.placement),A.rects&&(c=A.rects===!0?await s.getElementRects({reference:t,floating:e,strategy:i}):A.rects),{x:d,y:u}=h3(c,p,l)),v=-1)}return{x:d,y:u,placement:p,strategy:i,middlewareData:f}};async function gy(t,e){var n;e===void 0&&(e={});const{x:r,y:i,platform:o,rects:s,elements:a,strategy:l}=t,{boundary:c="clippingAncestors",rootBoundary:d="viewport",elementContext:u="floating",altBoundary:p=!1,padding:f=0}=vc(e,t),y=PK(f),x=a[p?u==="floating"?"reference":"floating":u],b=$b(await o.getClippingRect({element:(n=await(o.isElement==null?void 0:o.isElement(x)))==null||n?x:x.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(a.floating)),boundary:c,rootBoundary:d,strategy:l})),w=u==="floating"?{x:r,y:i,width:s.floating.width,height:s.floating.height}:s.reference,_=await(o.getOffsetParent==null?void 0:o.getOffsetParent(a.floating)),C=await(o.isElement==null?void 0:o.isElement(_))?await(o.getScale==null?void 0:o.getScale(_))||{x:1,y:1}:{x:1,y:1},A=$b(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:w,offsetParent:_,strategy:l}):w);return{top:(b.top-A.top+y.top)/C.y,bottom:(A.bottom-b.bottom+y.bottom)/C.y,left:(b.left-A.left+y.left)/C.x,right:(A.right-b.right+y.right)/C.x}}const O0e=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:i,rects:o,platform:s,elements:a,middlewareData:l}=e,{element:c,padding:d=0}=vc(t,e)||{};if(c==null)return{};const u=PK(d),p={x:n,y:r},f=JA(i),y=ZA(f),v=await s.getDimensions(c),x=f==="y",b=x?"top":"left",w=x?"bottom":"right",_=x?"clientHeight":"clientWidth",C=o.reference[y]+o.reference[f]-p[f]-o.floating[y],A=p[f]-o.reference[f],E=await(s.getOffsetParent==null?void 0:s.getOffsetParent(c));let O=E?E[_]:0;(!O||!await(s.isElement==null?void 0:s.isElement(E)))&&(O=a.floating[_]||o.floating[y]);const D=C/2-A/2,B=O/2-v[y]/2-1,L=Ru(u[b],B),j=Ru(u[w],B),F=L,z=O-v[y]-j,$=O/2-v[y]/2+D,V=lE(F,$,z),Y=!l.arrow&&Lf(i)!=null&&$!==V&&o.reference[y]/2-($<F?L:j)-v[y]/2<0,re=Y?$<F?$-F:$-z:0;return{[f]:p[f]+re,data:{[f]:V,centerOffset:$-V-re,...Y&&{alignmentOffset:re}},reset:Y}}}),D0e=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,r;const{placement:i,middlewareData:o,rects:s,initialPlacement:a,platform:l,elements:c}=e,{mainAxis:d=!0,crossAxis:u=!0,fallbackPlacements:p,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:v=!0,...x}=vc(t,e);if((n=o.arrow)!=null&&n.alignmentOffset)return{};const b=xc(i),w=Sl(a),_=xc(a)===a,C=await(l.isRTL==null?void 0:l.isRTL(c.floating)),A=p||(_||!v?[Rb(a)]:_0e(a)),E=y!=="none";!p&&E&&A.push(...E0e(a,v,y,C));const O=[a,...A],D=await gy(e,x),B=[];let L=((r=o.flip)==null?void 0:r.overflows)||[];if(d&&B.push(D[b]),u){const $=I0e(i,s,C);B.push(D[$[0]],D[$[1]])}if(L=[...L,{placement:i,overflows:B}],!B.every($=>$<=0)){var j,F;const $=(((j=o.flip)==null?void 0:j.index)||0)+1,V=O[$];if(V&&(!(u==="alignment"?w!==Sl(V):!1)||L.every(q=>Sl(q.placement)===w?q.overflows[0]>0:!0)))return{data:{index:$,overflows:L},reset:{placement:V}};let Y=(F=L.filter(re=>re.overflows[0]<=0).sort((re,q)=>re.overflows[1]-q.overflows[1])[0])==null?void 0:F.placement;if(!Y)switch(f){case"bestFit":{var z;const re=(z=L.filter(q=>{if(E){const X=Sl(q.placement);return X===w||X==="y"}return!0}).map(q=>[q.placement,q.overflows.filter(X=>X>0).reduce((X,N)=>X+N,0)]).sort((q,X)=>q[1]-X[1])[0])==null?void 0:z[0];re&&(Y=re);break}case"initialPlacement":Y=a;break}if(i!==Y)return{reset:{placement:Y}}}return{}}}};function p3(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function f3(t){return S0e.some(e=>t[e]>=0)}const j0e=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:r="referenceHidden",...i}=vc(t,e);switch(r){case"referenceHidden":{const o=await gy(e,{...i,elementContext:"reference"}),s=p3(o,n.reference);return{data:{referenceHiddenOffsets:s,referenceHidden:f3(s)}}}case"escaped":{const o=await gy(e,{...i,altBoundary:!0}),s=p3(o,n.floating);return{data:{escapedOffsets:s,escaped:f3(s)}}}default:return{}}}}},TK=new Set(["left","top"]);async function R0e(t,e){const{placement:n,platform:r,elements:i}=t,o=await(r.isRTL==null?void 0:r.isRTL(i.floating)),s=xc(n),a=Lf(n),l=Sl(n)==="y",c=TK.has(s)?-1:1,d=o&&l?-1:1,u=vc(e,t);let{mainAxis:p,crossAxis:f,alignmentAxis:y}=typeof u=="number"?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:u.mainAxis||0,crossAxis:u.crossAxis||0,alignmentAxis:u.alignmentAxis};return a&&typeof y=="number"&&(f=a==="end"?y*-1:y),l?{x:f*d,y:p*c}:{x:p*c,y:f*d}}const $0e=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,r;const{x:i,y:o,placement:s,middlewareData:a}=e,l=await R0e(e,t);return s===((n=a.offset)==null?void 0:n.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:i+l.x,y:o+l.y,data:{...l,placement:s}}}}},N0e=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:i}=e,{mainAxis:o=!0,crossAxis:s=!1,limiter:a={fn:x=>{let{x:b,y:w}=x;return{x:b,y:w}}},...l}=vc(t,e),c={x:n,y:r},d=await gy(e,l),u=Sl(xc(i)),p=XA(u);let f=c[p],y=c[u];if(o){const x=p==="y"?"top":"left",b=p==="y"?"bottom":"right",w=f+d[x],_=f-d[b];f=lE(w,f,_)}if(s){const x=u==="y"?"top":"left",b=u==="y"?"bottom":"right",w=y+d[x],_=y-d[b];y=lE(w,y,_)}const v=a.fn({...e,[p]:f,[u]:y});return{...v,data:{x:v.x-n,y:v.y-r,enabled:{[p]:o,[u]:s}}}}}},L0e=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:r,placement:i,rects:o,middlewareData:s}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=vc(t,e),d={x:n,y:r},u=Sl(i),p=XA(u);let f=d[p],y=d[u];const v=vc(a,e),x=typeof v=="number"?{mainAxis:v,crossAxis:0}:{mainAxis:0,crossAxis:0,...v};if(l){const _=p==="y"?"height":"width",C=o.reference[p]-o.floating[_]+x.mainAxis,A=o.reference[p]+o.reference[_]-x.mainAxis;f<C?f=C:f>A&&(f=A)}if(c){var b,w;const _=p==="y"?"width":"height",C=TK.has(xc(i)),A=o.reference[u]-o.floating[_]+(C&&((b=s.offset)==null?void 0:b[u])||0)+(C?0:x.crossAxis),E=o.reference[u]+o.reference[_]+(C?0:((w=s.offset)==null?void 0:w[u])||0)-(C?x.crossAxis:0);y<A?y=A:y>E&&(y=E)}return{[p]:f,[u]:y}}}},z0e=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,r;const{placement:i,rects:o,platform:s,elements:a}=e,{apply:l=()=>{},...c}=vc(t,e),d=await gy(e,c),u=xc(i),p=Lf(i),f=Sl(i)==="y",{width:y,height:v}=o.floating;let x,b;u==="top"||u==="bottom"?(x=u,b=p===(await(s.isRTL==null?void 0:s.isRTL(a.floating))?"start":"end")?"left":"right"):(b=u,x=p==="end"?"top":"bottom");const w=v-d.top-d.bottom,_=y-d.left-d.right,C=Ru(v-d[x],w),A=Ru(y-d[b],_),E=!e.middlewareData.shift;let O=C,D=A;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(D=_),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(O=w),E&&!p){const L=gs(d.left,0),j=gs(d.right,0),F=gs(d.top,0),z=gs(d.bottom,0);f?D=y-2*(L!==0||j!==0?L+j:gs(d.left,d.right)):O=v-2*(F!==0||z!==0?F+z:gs(d.top,d.bottom))}await l({...e,availableWidth:D,availableHeight:O});const B=await s.getDimensions(a.floating);return y!==B.width||v!==B.height?{reset:{rects:!0}}:{}}}};function H0(){return typeof window<"u"}function zf(t){return EK(t)?(t.nodeName||"").toLowerCase():"#document"}function _s(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function $l(t){var e;return(e=(EK(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function EK(t){return H0()?t instanceof Node||t instanceof _s(t).Node:!1}function Va(t){return H0()?t instanceof Element||t instanceof _s(t).Element:!1}function Al(t){return H0()?t instanceof HTMLElement||t instanceof _s(t).HTMLElement:!1}function g3(t){return!H0()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof _s(t).ShadowRoot}const F0e=new Set(["inline","contents"]);function uv(t){const{overflow:e,overflowX:n,overflowY:r,display:i}=Ka(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!F0e.has(i)}const B0e=new Set(["table","td","th"]);function U0e(t){return B0e.has(zf(t))}const H0e=[":popover-open",":modal"];function W0(t){return H0e.some(e=>{try{return t.matches(e)}catch{return!1}})}const W0e=["transform","translate","scale","rotate","perspective"],V0e=["transform","translate","scale","rotate","perspective","filter"],K0e=["paint","layout","strict","content"];function QA(t){const e=eM(),n=Va(t)?Ka(t):t;return W0e.some(r=>n[r]?n[r]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||V0e.some(r=>(n.willChange||"").includes(r))||K0e.some(r=>(n.contain||"").includes(r))}function q0e(t){let e=$u(t);for(;Al(e)&&!gf(e);){if(QA(e))return e;if(W0(e))return null;e=$u(e)}return null}function eM(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const G0e=new Set(["html","body","#document"]);function gf(t){return G0e.has(zf(t))}function Ka(t){return _s(t).getComputedStyle(t)}function V0(t){return Va(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function $u(t){if(zf(t)==="html")return t;const e=t.assignedSlot||t.parentNode||g3(t)&&t.host||$l(t);return g3(e)?e.host:e}function AK(t){const e=$u(t);return gf(e)?t.ownerDocument?t.ownerDocument.body:t.body:Al(e)&&uv(e)?e:AK(e)}function my(t,e,n){var r;e===void 0&&(e=[]),n===void 0&&(n=!0);const i=AK(t),o=i===((r=t.ownerDocument)==null?void 0:r.body),s=_s(i);if(o){const a=uE(s);return e.concat(s,s.visualViewport||[],uv(i)?i:[],a&&n?my(a):[])}return e.concat(i,my(i,[],n))}function uE(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function MK(t){const e=Ka(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=Al(t),o=i?t.offsetWidth:n,s=i?t.offsetHeight:r,a=jb(n)!==o||jb(r)!==s;return a&&(n=o,r=s),{width:n,height:r,$:a}}function tM(t){return Va(t)?t:t.contextElement}function Jp(t){const e=tM(t);if(!Al(e))return kl(1);const n=e.getBoundingClientRect(),{width:r,height:i,$:o}=MK(e);let s=(o?jb(n.width):n.width)/r,a=(o?jb(n.height):n.height)/i;return(!s||!Number.isFinite(s))&&(s=1),(!a||!Number.isFinite(a))&&(a=1),{x:s,y:a}}const Y0e=kl(0);function OK(t){const e=_s(t);return!eM()||!e.visualViewport?Y0e:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function X0e(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==_s(t)?!1:e}function uh(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const i=t.getBoundingClientRect(),o=tM(t);let s=kl(1);e&&(r?Va(r)&&(s=Jp(r)):s=Jp(t));const a=X0e(o,n,r)?OK(o):kl(0);let l=(i.left+a.x)/s.x,c=(i.top+a.y)/s.y,d=i.width/s.x,u=i.height/s.y;if(o){const p=_s(o),f=r&&Va(r)?_s(r):r;let y=p,v=uE(y);for(;v&&r&&f!==y;){const x=Jp(v),b=v.getBoundingClientRect(),w=Ka(v),_=b.left+(v.clientLeft+parseFloat(w.paddingLeft))*x.x,C=b.top+(v.clientTop+parseFloat(w.paddingTop))*x.y;l*=x.x,c*=x.y,d*=x.x,u*=x.y,l+=_,c+=C,y=_s(v),v=uE(y)}}return $b({width:d,height:u,x:l,y:c})}function K0(t,e){const n=V0(t).scrollLeft;return e?e.left+n:uh($l(t)).left+n}function DK(t,e){const n=t.getBoundingClientRect(),r=n.left+e.scrollLeft-K0(t,n),i=n.top+e.scrollTop;return{x:r,y:i}}function Z0e(t){let{elements:e,rect:n,offsetParent:r,strategy:i}=t;const o=i==="fixed",s=$l(r),a=e?W0(e.floating):!1;if(r===s||a&&o)return n;let l={scrollLeft:0,scrollTop:0},c=kl(1);const d=kl(0),u=Al(r);if((u||!u&&!o)&&((zf(r)!=="body"||uv(s))&&(l=V0(r)),Al(r))){const f=uh(r);c=Jp(r),d.x=f.x+r.clientLeft,d.y=f.y+r.clientTop}const p=s&&!u&&!o?DK(s,l):kl(0);return{width:n.width*c.x,height:n.height*c.y,x:n.x*c.x-l.scrollLeft*c.x+d.x+p.x,y:n.y*c.y-l.scrollTop*c.y+d.y+p.y}}function J0e(t){return Array.from(t.getClientRects())}function Q0e(t){const e=$l(t),n=V0(t),r=t.ownerDocument.body,i=gs(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),o=gs(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let s=-n.scrollLeft+K0(t);const a=-n.scrollTop;return Ka(r).direction==="rtl"&&(s+=gs(e.clientWidth,r.clientWidth)-i),{width:i,height:o,x:s,y:a}}const m3=25;function e1e(t,e){const n=_s(t),r=$l(t),i=n.visualViewport;let o=r.clientWidth,s=r.clientHeight,a=0,l=0;if(i){o=i.width,s=i.height;const d=eM();(!d||d&&e==="fixed")&&(a=i.offsetLeft,l=i.offsetTop)}const c=K0(r);if(c<=0){const d=r.ownerDocument,u=d.body,p=getComputedStyle(u),f=d.compatMode==="CSS1Compat"&&parseFloat(p.marginLeft)+parseFloat(p.marginRight)||0,y=Math.abs(r.clientWidth-u.clientWidth-f);y<=m3&&(o-=y)}else c<=m3&&(o+=c);return{width:o,height:s,x:a,y:l}}const t1e=new Set(["absolute","fixed"]);function n1e(t,e){const n=uh(t,!0,e==="fixed"),r=n.top+t.clientTop,i=n.left+t.clientLeft,o=Al(t)?Jp(t):kl(1),s=t.clientWidth*o.x,a=t.clientHeight*o.y,l=i*o.x,c=r*o.y;return{width:s,height:a,x:l,y:c}}function y3(t,e,n){let r;if(e==="viewport")r=e1e(t,n);else if(e==="document")r=Q0e($l(t));else if(Va(e))r=n1e(e,n);else{const i=OK(t);r={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return $b(r)}function jK(t,e){const n=$u(t);return n===e||!Va(n)||gf(n)?!1:Ka(n).position==="fixed"||jK(n,e)}function r1e(t,e){const n=e.get(t);if(n)return n;let r=my(t,[],!1).filter(a=>Va(a)&&zf(a)!=="body"),i=null;const o=Ka(t).position==="fixed";let s=o?$u(t):t;for(;Va(s)&&!gf(s);){const a=Ka(s),l=QA(s);!l&&a.position==="fixed"&&(i=null),(o?!l&&!i:!l&&a.position==="static"&&!!i&&t1e.has(i.position)||uv(s)&&!l&&jK(t,s))?r=r.filter(d=>d!==s):i=a,s=$u(s)}return e.set(t,r),r}function i1e(t){let{element:e,boundary:n,rootBoundary:r,strategy:i}=t;const s=[...n==="clippingAncestors"?W0(e)?[]:r1e(e,this._c):[].concat(n),r],a=s[0],l=s.reduce((c,d)=>{const u=y3(e,d,i);return c.top=gs(u.top,c.top),c.right=Ru(u.right,c.right),c.bottom=Ru(u.bottom,c.bottom),c.left=gs(u.left,c.left),c},y3(e,a,i));return{width:l.right-l.left,height:l.bottom-l.top,x:l.left,y:l.top}}function o1e(t){const{width:e,height:n}=MK(t);return{width:e,height:n}}function s1e(t,e,n){const r=Al(e),i=$l(e),o=n==="fixed",s=uh(t,!0,o,e);let a={scrollLeft:0,scrollTop:0};const l=kl(0);function c(){l.x=K0(i)}if(r||!r&&!o)if((zf(e)!=="body"||uv(i))&&(a=V0(e)),r){const f=uh(e,!0,o,e);l.x=f.x+e.clientLeft,l.y=f.y+e.clientTop}else i&&c();o&&!r&&i&&c();const d=i&&!r&&!o?DK(i,a):kl(0),u=s.left+a.scrollLeft-l.x-d.x,p=s.top+a.scrollTop-l.y-d.y;return{x:u,y:p,width:s.width,height:s.height}}function kP(t){return Ka(t).position==="static"}function v3(t,e){if(!Al(t)||Ka(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return $l(t)===n&&(n=n.ownerDocument.body),n}function RK(t,e){const n=_s(t);if(W0(t))return n;if(!Al(t)){let i=$u(t);for(;i&&!gf(i);){if(Va(i)&&!kP(i))return i;i=$u(i)}return n}let r=v3(t,e);for(;r&&U0e(r)&&kP(r);)r=v3(r,e);return r&&gf(r)&&kP(r)&&!QA(r)?n:r||q0e(t)||n}const a1e=async function(t){const e=this.getOffsetParent||RK,n=this.getDimensions,r=await n(t.floating);return{reference:s1e(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function l1e(t){return Ka(t).direction==="rtl"}const c1e={convertOffsetParentRelativeRectToViewportRelativeRect:Z0e,getDocumentElement:$l,getClippingRect:i1e,getOffsetParent:RK,getElementRects:a1e,getClientRects:J0e,getDimensions:o1e,getScale:Jp,isElement:Va,isRTL:l1e};function $K(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function u1e(t,e){let n=null,r;const i=$l(t);function o(){var a;clearTimeout(r),(a=n)==null||a.disconnect(),n=null}function s(a,l){a===void 0&&(a=!1),l===void 0&&(l=1),o();const c=t.getBoundingClientRect(),{left:d,top:u,width:p,height:f}=c;if(a||e(),!p||!f)return;const y=eS(u),v=eS(i.clientWidth-(d+p)),x=eS(i.clientHeight-(u+f)),b=eS(d),_={rootMargin:-y+"px "+-v+"px "+-x+"px "+-b+"px",threshold:gs(0,Ru(1,l))||1};let C=!0;function A(E){const O=E[0].intersectionRatio;if(O!==l){if(!C)return s();O?s(!1,O):r=setTimeout(()=>{s(!1,1e-7)},1e3)}O===1&&!$K(c,t.getBoundingClientRect())&&s(),C=!1}try{n=new IntersectionObserver(A,{..._,root:i.ownerDocument})}catch{n=new IntersectionObserver(A,_)}n.observe(t)}return s(!0),o}function d1e(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:o=!0,elementResize:s=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:l=!1}=r,c=tM(t),d=i||o?[...c?my(c):[],...my(e)]:[];d.forEach(b=>{i&&b.addEventListener("scroll",n,{passive:!0}),o&&b.addEventListener("resize",n)});const u=c&&a?u1e(c,n):null;let p=-1,f=null;s&&(f=new ResizeObserver(b=>{let[w]=b;w&&w.target===c&&f&&(f.unobserve(e),cancelAnimationFrame(p),p=requestAnimationFrame(()=>{var _;(_=f)==null||_.observe(e)})),n()}),c&&!l&&f.observe(c),f.observe(e));let y,v=l?uh(t):null;l&&x();function x(){const b=uh(t);v&&!$K(v,b)&&n(),v=b,y=requestAnimationFrame(x)}return n(),()=>{var b;d.forEach(w=>{i&&w.removeEventListener("scroll",n),o&&w.removeEventListener("resize",n)}),u?.(),(b=f)==null||b.disconnect(),f=null,l&&cancelAnimationFrame(y)}}const h1e=$0e,p1e=N0e,f1e=D0e,g1e=z0e,m1e=j0e,x3=O0e,y1e=L0e,v1e=(t,e,n)=>{const r=new Map,i={platform:c1e,...n},o={...i.platform,_c:r};return M0e(t,e,{...i,platform:o})};var x1e=typeof document<"u",S1e=function(){},VS=x1e?I.useLayoutEffect:S1e;function Nb(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,r,i;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(r=n;r--!==0;)if(!Nb(t[r],e[r]))return!1;return!0}if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(e,i[r]))return!1;for(r=n;r--!==0;){const o=i[r];if(!(o==="_owner"&&t.$$typeof)&&!Nb(t[o],e[o]))return!1}return!0}return t!==t&&e!==e}function NK(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function S3(t,e){const n=NK(t);return Math.round(e*n)/n}function IP(t){const e=I.useRef(t);return VS(()=>{e.current=t}),e}function b1e(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:r=[],platform:i,elements:{reference:o,floating:s}={},transform:a=!0,whileElementsMounted:l,open:c}=t,[d,u]=I.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[p,f]=I.useState(r);Nb(p,r)||f(r);const[y,v]=I.useState(null),[x,b]=I.useState(null),w=I.useCallback(q=>{q!==E.current&&(E.current=q,v(q))},[]),_=I.useCallback(q=>{q!==O.current&&(O.current=q,b(q))},[]),C=o||y,A=s||x,E=I.useRef(null),O=I.useRef(null),D=I.useRef(d),B=l!=null,L=IP(l),j=IP(i),F=IP(c),z=I.useCallback(()=>{if(!E.current||!O.current)return;const q={placement:e,strategy:n,middleware:p};j.current&&(q.platform=j.current),v1e(E.current,O.current,q).then(X=>{const N={...X,isPositioned:F.current!==!1};$.current&&!Nb(D.current,N)&&(D.current=N,_h.flushSync(()=>{u(N)}))})},[p,e,n,j,F]);VS(()=>{c===!1&&D.current.isPositioned&&(D.current.isPositioned=!1,u(q=>({...q,isPositioned:!1})))},[c]);const $=I.useRef(!1);VS(()=>($.current=!0,()=>{$.current=!1}),[]),VS(()=>{if(C&&(E.current=C),A&&(O.current=A),C&&A){if(L.current)return L.current(C,A,z);z()}},[C,A,z,L,B]);const V=I.useMemo(()=>({reference:E,floating:O,setReference:w,setFloating:_}),[w,_]),Y=I.useMemo(()=>({reference:C,floating:A}),[C,A]),re=I.useMemo(()=>{const q={position:n,left:0,top:0};if(!Y.floating)return q;const X=S3(Y.floating,d.x),N=S3(Y.floating,d.y);return a?{...q,transform:"translate("+X+"px, "+N+"px)",...NK(Y.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:X,top:N}},[n,a,Y.floating,d.x,d.y]);return I.useMemo(()=>({...d,update:z,refs:V,elements:Y,floatingStyles:re}),[d,z,V,Y,re])}const w1e=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:r,padding:i}=typeof t=="function"?t(n):t;return r&&e(r)?r.current!=null?x3({element:r.current,padding:i}).fn(n):{}:r?x3({element:r,padding:i}).fn(n):{}}}},k1e=(t,e)=>({...h1e(t),options:[t,e]}),I1e=(t,e)=>({...p1e(t),options:[t,e]}),_1e=(t,e)=>({...y1e(t),options:[t,e]}),C1e=(t,e)=>({...f1e(t),options:[t,e]}),P1e=(t,e)=>({...g1e(t),options:[t,e]}),T1e=(t,e)=>({...m1e(t),options:[t,e]}),E1e=(t,e)=>({...w1e(t),options:[t,e]});var A1e="Arrow",LK=I.forwardRef((t,e)=>{const{children:n,width:r=10,height:i=5,...o}=t;return g.jsx(Ct.svg,{...o,ref:e,width:r,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:g.jsx("polygon",{points:"0,0 30,0 15,10"})})});LK.displayName=A1e;var M1e=LK,nM="Popper",[zK,Ff]=Ms(nM),[O1e,FK]=zK(nM),BK=t=>{const{__scopePopper:e,children:n}=t,[r,i]=I.useState(null);return g.jsx(O1e,{scope:e,anchor:r,onAnchorChange:i,children:n})};BK.displayName=nM;var UK="PopperAnchor",HK=I.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...i}=t,o=FK(UK,n),s=I.useRef(null),a=hn(e,s),l=I.useRef(null);return I.useEffect(()=>{const c=l.current;l.current=r?.current||s.current,c!==l.current&&o.onAnchorChange(l.current)}),r?null:g.jsx(Ct.div,{...i,ref:a})});HK.displayName=UK;var rM="PopperContent",[D1e,j1e]=zK(rM),WK=I.forwardRef((t,e)=>{const{__scopePopper:n,side:r="bottom",sideOffset:i=0,align:o="center",alignOffset:s=0,arrowPadding:a=0,avoidCollisions:l=!0,collisionBoundary:c=[],collisionPadding:d=0,sticky:u="partial",hideWhenDetached:p=!1,updatePositionStrategy:f="optimized",onPlaced:y,...v}=t,x=FK(rM,n),[b,w]=I.useState(null),_=hn(e,ye=>w(ye)),[C,A]=I.useState(null),E=CK(C),O=E?.width??0,D=E?.height??0,B=r+(o!=="center"?"-"+o:""),L=typeof d=="number"?d:{top:0,right:0,bottom:0,left:0,...d},j=Array.isArray(c)?c:[c],F=j.length>0,z={padding:L,boundary:j.filter($1e),altBoundary:F},{refs:$,floatingStyles:V,placement:Y,isPositioned:re,middlewareData:q}=b1e({strategy:"fixed",placement:B,whileElementsMounted:(...ye)=>d1e(...ye,{animationFrame:f==="always"}),elements:{reference:x.anchor},middleware:[k1e({mainAxis:i+D,alignmentAxis:s}),l&&I1e({mainAxis:!0,crossAxis:!1,limiter:u==="partial"?_1e():void 0,...z}),l&&C1e({...z}),P1e({...z,apply:({elements:ye,rects:Se,availableWidth:Re,availableHeight:$e})=>{const{width:Ft,height:rn}=Se.reference,Dt=ye.floating.style;Dt.setProperty("--radix-popper-available-width",`${Re}px`),Dt.setProperty("--radix-popper-available-height",`${$e}px`),Dt.setProperty("--radix-popper-anchor-width",`${Ft}px`),Dt.setProperty("--radix-popper-anchor-height",`${rn}px`)}}),C&&E1e({element:C,padding:a}),N1e({arrowWidth:O,arrowHeight:D}),p&&T1e({strategy:"referenceHidden",...z})]}),[X,N]=qK(Y),H=wo(y);yc(()=>{re&&H?.()},[re,H]);const ie=q.arrow?.x,U=q.arrow?.y,ke=q.arrow?.centerOffset!==0,[ge,Te]=I.useState();return yc(()=>{b&&Te(window.getComputedStyle(b).zIndex)},[b]),g.jsx("div",{ref:$.setFloating,"data-radix-popper-content-wrapper":"",style:{...V,transform:re?V.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ge,"--radix-popper-transform-origin":[q.transformOrigin?.x,q.transformOrigin?.y].join(" "),...q.hide?.referenceHidden&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:g.jsx(D1e,{scope:n,placedSide:X,onArrowChange:A,arrowX:ie,arrowY:U,shouldHideArrow:ke,children:g.jsx(Ct.div,{"data-side":X,"data-align":N,...v,ref:_,style:{...v.style,animation:re?void 0:"none"}})})})});WK.displayName=rM;var VK="PopperArrow",R1e={top:"bottom",right:"left",bottom:"top",left:"right"},KK=I.forwardRef(function(e,n){const{__scopePopper:r,...i}=e,o=j1e(VK,r),s=R1e[o.placedSide];return g.jsx("span",{ref:o.onArrowChange,style:{position:"absolute",left:o.arrowX,top:o.arrowY,[s]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[o.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[o.placedSide],visibility:o.shouldHideArrow?"hidden":void 0},children:g.jsx(M1e,{...i,ref:n,style:{...i.style,display:"block"}})})});KK.displayName=VK;function $1e(t){return t!==null}var N1e=t=>({name:"transformOrigin",options:t,fn(e){const{placement:n,rects:r,middlewareData:i}=e,s=i.arrow?.centerOffset!==0,a=s?0:t.arrowWidth,l=s?0:t.arrowHeight,[c,d]=qK(n),u={start:"0%",center:"50%",end:"100%"}[d],p=(i.arrow?.x??0)+a/2,f=(i.arrow?.y??0)+l/2;let y="",v="";return c==="bottom"?(y=s?u:`${p}px`,v=`${-l}px`):c==="top"?(y=s?u:`${p}px`,v=`${r.floating.height+l}px`):c==="right"?(y=`${-l}px`,v=s?u:`${f}px`):c==="left"&&(y=`${r.floating.width+l}px`,v=s?u:`${f}px`),{data:{x:y,y:v}}}});function qK(t){const[e,n="center"]=t.split("-");return[e,n]}var q0=BK,G0=HK,iM=WK,oM=KK,_P="rovingFocusGroup.onEntryFocus",L1e={bubbles:!1,cancelable:!0},dv="RovingFocusGroup",[dE,GK,z1e]=L0(dv),[F1e,Bf]=Ms(dv,[z1e]),[B1e,U1e]=F1e(dv),YK=I.forwardRef((t,e)=>g.jsx(dE.Provider,{scope:t.__scopeRovingFocusGroup,children:g.jsx(dE.Slot,{scope:t.__scopeRovingFocusGroup,children:g.jsx(H1e,{...t,ref:e})})}));YK.displayName=dv;var H1e=I.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:i=!1,dir:o,currentTabStopId:s,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:l,onEntryFocus:c,preventScrollOnEntryFocus:d=!1,...u}=t,p=I.useRef(null),f=hn(e,p),y=lv(o),[v,x]=ha({prop:s,defaultProp:a??null,onChange:l,caller:dv}),[b,w]=I.useState(!1),_=wo(c),C=GK(n),A=I.useRef(!1),[E,O]=I.useState(0);return I.useEffect(()=>{const D=p.current;if(D)return D.addEventListener(_P,_),()=>D.removeEventListener(_P,_)},[_]),g.jsx(B1e,{scope:n,orientation:r,dir:y,loop:i,currentTabStopId:v,onItemFocus:I.useCallback(D=>x(D),[x]),onItemShiftTab:I.useCallback(()=>w(!0),[]),onFocusableItemAdd:I.useCallback(()=>O(D=>D+1),[]),onFocusableItemRemove:I.useCallback(()=>O(D=>D-1),[]),children:g.jsx(Ct.div,{tabIndex:b||E===0?-1:0,"data-orientation":r,...u,ref:f,style:{outline:"none",...t.style},onMouseDown:Fe(t.onMouseDown,()=>{A.current=!0}),onFocus:Fe(t.onFocus,D=>{const B=!A.current;if(D.target===D.currentTarget&&B&&!b){const L=new CustomEvent(_P,L1e);if(D.currentTarget.dispatchEvent(L),!L.defaultPrevented){const j=C().filter(Y=>Y.focusable),F=j.find(Y=>Y.active),z=j.find(Y=>Y.id===v),V=[F,z,...j].filter(Boolean).map(Y=>Y.ref.current);JK(V,d)}}A.current=!1}),onBlur:Fe(t.onBlur,()=>w(!1))})})}),XK="RovingFocusGroupItem",ZK=I.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:i=!1,tabStopId:o,children:s,...a}=t,l=wl(),c=o||l,d=U1e(XK,n),u=d.currentTabStopId===c,p=GK(n),{onFocusableItemAdd:f,onFocusableItemRemove:y,currentTabStopId:v}=d;return I.useEffect(()=>{if(r)return f(),()=>y()},[r,f,y]),g.jsx(dE.ItemSlot,{scope:n,id:c,focusable:r,active:i,children:g.jsx(Ct.span,{tabIndex:u?0:-1,"data-orientation":d.orientation,...a,ref:e,onMouseDown:Fe(t.onMouseDown,x=>{r?d.onItemFocus(c):x.preventDefault()}),onFocus:Fe(t.onFocus,()=>d.onItemFocus(c)),onKeyDown:Fe(t.onKeyDown,x=>{if(x.key==="Tab"&&x.shiftKey){d.onItemShiftTab();return}if(x.target!==x.currentTarget)return;const b=K1e(x,d.orientation,d.dir);if(b!==void 0){if(x.metaKey||x.ctrlKey||x.altKey||x.shiftKey)return;x.preventDefault();let _=p().filter(C=>C.focusable).map(C=>C.ref.current);if(b==="last")_.reverse();else if(b==="prev"||b==="next"){b==="prev"&&_.reverse();const C=_.indexOf(x.currentTarget);_=d.loop?q1e(_,C+1):_.slice(C+1)}setTimeout(()=>JK(_))}}),children:typeof s=="function"?s({isCurrentTabStop:u,hasTabStop:v!=null}):s})})});ZK.displayName=XK;var W1e={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function V1e(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function K1e(t,e,n){const r=V1e(t.key,n);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return W1e[r]}function JK(t,e=!1){const n=document.activeElement;for(const r of t)if(r===n||(r.focus({preventScroll:e}),document.activeElement!==n))return}function q1e(t,e){return t.map((n,r)=>t[(e+r)%t.length])}var sM=YK,Y0=ZK,hE=["Enter"," "],G1e=["ArrowDown","PageUp","Home"],QK=["ArrowUp","PageDown","End"],Y1e=[...G1e,...QK],X1e={ltr:[...hE,"ArrowRight"],rtl:[...hE,"ArrowLeft"]},Z1e={ltr:["ArrowLeft"],rtl:["ArrowRight"]},hv="Menu",[yy,J1e,Q1e]=L0(hv),[Th,X0]=Ms(hv,[Q1e,Ff,Bf]),pv=Ff(),eq=Bf(),[tq,Qu]=Th(hv),[eke,fv]=Th(hv),nq=t=>{const{__scopeMenu:e,open:n=!1,children:r,dir:i,onOpenChange:o,modal:s=!0}=t,a=pv(e),[l,c]=I.useState(null),d=I.useRef(!1),u=wo(o),p=lv(i);return I.useEffect(()=>{const f=()=>{d.current=!0,document.addEventListener("pointerdown",y,{capture:!0,once:!0}),document.addEventListener("pointermove",y,{capture:!0,once:!0})},y=()=>d.current=!1;return document.addEventListener("keydown",f,{capture:!0}),()=>{document.removeEventListener("keydown",f,{capture:!0}),document.removeEventListener("pointerdown",y,{capture:!0}),document.removeEventListener("pointermove",y,{capture:!0})}},[]),g.jsx(q0,{...a,children:g.jsx(tq,{scope:e,open:n,onOpenChange:u,content:l,onContentChange:c,children:g.jsx(eke,{scope:e,onClose:I.useCallback(()=>u(!1),[u]),isUsingKeyboardRef:d,dir:p,modal:s,children:r})})})};nq.displayName=hv;var tke="MenuAnchor",aM=I.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t,i=pv(n);return g.jsx(G0,{...i,...r,ref:e})});aM.displayName=tke;var lM="MenuPortal",[nke,rq]=Th(lM,{forceMount:void 0}),iq=t=>{const{__scopeMenu:e,forceMount:n,children:r,container:i}=t,o=Qu(lM,e);return g.jsx(nke,{scope:e,forceMount:n,children:g.jsx(pa,{present:n||o.open,children:g.jsx(cv,{asChild:!0,container:i,children:r})})})};iq.displayName=lM;var ca="MenuContent",[rke,cM]=Th(ca),oq=I.forwardRef((t,e)=>{const n=rq(ca,t.__scopeMenu),{forceMount:r=n.forceMount,...i}=t,o=Qu(ca,t.__scopeMenu),s=fv(ca,t.__scopeMenu);return g.jsx(yy.Provider,{scope:t.__scopeMenu,children:g.jsx(pa,{present:r||o.open,children:g.jsx(yy.Slot,{scope:t.__scopeMenu,children:s.modal?g.jsx(ike,{...i,ref:e}):g.jsx(oke,{...i,ref:e})})})})}),ike=I.forwardRef((t,e)=>{const n=Qu(ca,t.__scopeMenu),r=I.useRef(null),i=hn(e,r);return I.useEffect(()=>{const o=r.current;if(o)return KA(o)},[]),g.jsx(uM,{...t,ref:i,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:Fe(t.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),oke=I.forwardRef((t,e)=>{const n=Qu(ca,t.__scopeMenu);return g.jsx(uM,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),ske=lh("MenuContent.ScrollLock"),uM=I.forwardRef((t,e)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:i,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:a,onEntryFocus:l,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:p,onDismiss:f,disableOutsideScroll:y,...v}=t,x=Qu(ca,n),b=fv(ca,n),w=pv(n),_=eq(n),C=J1e(n),[A,E]=I.useState(null),O=I.useRef(null),D=hn(e,O,x.onContentChange),B=I.useRef(0),L=I.useRef(""),j=I.useRef(0),F=I.useRef(null),z=I.useRef("right"),$=I.useRef(0),V=y?B0:I.Fragment,Y=y?{as:ske,allowPinchZoom:!0}:void 0,re=X=>{const N=L.current+X,H=C().filter(ye=>!ye.disabled),ie=document.activeElement,U=H.find(ye=>ye.ref.current===ie)?.textValue,ke=H.map(ye=>ye.textValue),ge=vke(ke,N,U),Te=H.find(ye=>ye.textValue===ge)?.ref.current;(function ye(Se){L.current=Se,window.clearTimeout(B.current),Se!==""&&(B.current=window.setTimeout(()=>ye(""),1e3))})(N),Te&&setTimeout(()=>Te.focus())};I.useEffect(()=>()=>window.clearTimeout(B.current),[]),VA();const q=I.useCallback(X=>z.current===F.current?.side&&Ske(X,F.current?.area),[]);return g.jsx(rke,{scope:n,searchRef:L,onItemEnter:I.useCallback(X=>{q(X)&&X.preventDefault()},[q]),onItemLeave:I.useCallback(X=>{q(X)||(O.current?.focus(),E(null))},[q]),onTriggerLeave:I.useCallback(X=>{q(X)&&X.preventDefault()},[q]),pointerGraceTimerRef:j,onPointerGraceIntentChange:I.useCallback(X=>{F.current=X},[]),children:g.jsx(V,{...Y,children:g.jsx(z0,{asChild:!0,trapped:i,onMountAutoFocus:Fe(o,X=>{X.preventDefault(),O.current?.focus({preventScroll:!0})}),onUnmountAutoFocus:s,children:g.jsx(Nf,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:c,onPointerDownOutside:d,onFocusOutside:u,onInteractOutside:p,onDismiss:f,children:g.jsx(sM,{asChild:!0,..._,dir:b.dir,orientation:"vertical",loop:r,currentTabStopId:A,onCurrentTabStopIdChange:E,onEntryFocus:Fe(l,X=>{b.isUsingKeyboardRef.current||X.preventDefault()}),preventScrollOnEntryFocus:!0,children:g.jsx(iM,{role:"menu","aria-orientation":"vertical","data-state":wq(x.open),"data-radix-menu-content":"",dir:b.dir,...w,...v,ref:D,style:{outline:"none",...v.style},onKeyDown:Fe(v.onKeyDown,X=>{const H=X.target.closest("[data-radix-menu-content]")===X.currentTarget,ie=X.ctrlKey||X.altKey||X.metaKey,U=X.key.length===1;H&&(X.key==="Tab"&&X.preventDefault(),!ie&&U&&re(X.key));const ke=O.current;if(X.target!==ke||!Y1e.includes(X.key))return;X.preventDefault();const Te=C().filter(ye=>!ye.disabled).map(ye=>ye.ref.current);QK.includes(X.key)&&Te.reverse(),mke(Te)}),onBlur:Fe(t.onBlur,X=>{X.currentTarget.contains(X.target)||(window.clearTimeout(B.current),L.current="")}),onPointerMove:Fe(t.onPointerMove,vy(X=>{const N=X.target,H=$.current!==X.clientX;if(X.currentTarget.contains(N)&&H){const ie=X.clientX>$.current?"right":"left";z.current=ie,$.current=X.clientX}}))})})})})})})});oq.displayName=ca;var ake="MenuGroup",dM=I.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return g.jsx(Ct.div,{role:"group",...r,ref:e})});dM.displayName=ake;var lke="MenuLabel",sq=I.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return g.jsx(Ct.div,{...r,ref:e})});sq.displayName=lke;var Lb="MenuItem",b3="menu.itemSelect",Z0=I.forwardRef((t,e)=>{const{disabled:n=!1,onSelect:r,...i}=t,o=I.useRef(null),s=fv(Lb,t.__scopeMenu),a=cM(Lb,t.__scopeMenu),l=hn(e,o),c=I.useRef(!1),d=()=>{const u=o.current;if(!n&&u){const p=new CustomEvent(b3,{bubbles:!0,cancelable:!0});u.addEventListener(b3,f=>r?.(f),{once:!0}),WA(u,p),p.defaultPrevented?c.current=!1:s.onClose()}};return g.jsx(aq,{...i,ref:l,disabled:n,onClick:Fe(t.onClick,d),onPointerDown:u=>{t.onPointerDown?.(u),c.current=!0},onPointerUp:Fe(t.onPointerUp,u=>{c.current||u.currentTarget?.click()}),onKeyDown:Fe(t.onKeyDown,u=>{const p=a.searchRef.current!=="";n||p&&u.key===" "||hE.includes(u.key)&&(u.currentTarget.click(),u.preventDefault())})})});Z0.displayName=Lb;var aq=I.forwardRef((t,e)=>{const{__scopeMenu:n,disabled:r=!1,textValue:i,...o}=t,s=cM(Lb,n),a=eq(n),l=I.useRef(null),c=hn(e,l),[d,u]=I.useState(!1),[p,f]=I.useState("");return I.useEffect(()=>{const y=l.current;y&&f((y.textContent??"").trim())},[o.children]),g.jsx(yy.ItemSlot,{scope:n,disabled:r,textValue:i??p,children:g.jsx(Y0,{asChild:!0,...a,focusable:!r,children:g.jsx(Ct.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...o,ref:c,onPointerMove:Fe(t.onPointerMove,vy(y=>{r?s.onItemLeave(y):(s.onItemEnter(y),y.defaultPrevented||y.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Fe(t.onPointerLeave,vy(y=>s.onItemLeave(y))),onFocus:Fe(t.onFocus,()=>u(!0)),onBlur:Fe(t.onBlur,()=>u(!1))})})})}),cke="MenuCheckboxItem",lq=I.forwardRef((t,e)=>{const{checked:n=!1,onCheckedChange:r,...i}=t;return g.jsx(pq,{scope:t.__scopeMenu,checked:n,children:g.jsx(Z0,{role:"menuitemcheckbox","aria-checked":zb(n)?"mixed":n,...i,ref:e,"data-state":fM(n),onSelect:Fe(i.onSelect,()=>r?.(zb(n)?!0:!n),{checkForDefaultPrevented:!1})})})});lq.displayName=cke;var cq="MenuRadioGroup",[uke,dke]=Th(cq,{value:void 0,onValueChange:()=>{}}),uq=I.forwardRef((t,e)=>{const{value:n,onValueChange:r,...i}=t,o=wo(r);return g.jsx(uke,{scope:t.__scopeMenu,value:n,onValueChange:o,children:g.jsx(dM,{...i,ref:e})})});uq.displayName=cq;var dq="MenuRadioItem",hq=I.forwardRef((t,e)=>{const{value:n,...r}=t,i=dke(dq,t.__scopeMenu),o=n===i.value;return g.jsx(pq,{scope:t.__scopeMenu,checked:o,children:g.jsx(Z0,{role:"menuitemradio","aria-checked":o,...r,ref:e,"data-state":fM(o),onSelect:Fe(r.onSelect,()=>i.onValueChange?.(n),{checkForDefaultPrevented:!1})})})});hq.displayName=dq;var hM="MenuItemIndicator",[pq,hke]=Th(hM,{checked:!1}),fq=I.forwardRef((t,e)=>{const{__scopeMenu:n,forceMount:r,...i}=t,o=hke(hM,n);return g.jsx(pa,{present:r||zb(o.checked)||o.checked===!0,children:g.jsx(Ct.span,{...i,ref:e,"data-state":fM(o.checked)})})});fq.displayName=hM;var pke="MenuSeparator",gq=I.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return g.jsx(Ct.div,{role:"separator","aria-orientation":"horizontal",...r,ref:e})});gq.displayName=pke;var fke="MenuArrow",mq=I.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t,i=pv(n);return g.jsx(oM,{...i,...r,ref:e})});mq.displayName=fke;var pM="MenuSub",[gke,yq]=Th(pM),vq=t=>{const{__scopeMenu:e,children:n,open:r=!1,onOpenChange:i}=t,o=Qu(pM,e),s=pv(e),[a,l]=I.useState(null),[c,d]=I.useState(null),u=wo(i);return I.useEffect(()=>(o.open===!1&&u(!1),()=>u(!1)),[o.open,u]),g.jsx(q0,{...s,children:g.jsx(tq,{scope:e,open:r,onOpenChange:u,content:c,onContentChange:d,children:g.jsx(gke,{scope:e,contentId:wl(),triggerId:wl(),trigger:a,onTriggerChange:l,children:n})})})};vq.displayName=pM;var gm="MenuSubTrigger",xq=I.forwardRef((t,e)=>{const n=Qu(gm,t.__scopeMenu),r=fv(gm,t.__scopeMenu),i=yq(gm,t.__scopeMenu),o=cM(gm,t.__scopeMenu),s=I.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:l}=o,c={__scopeMenu:t.__scopeMenu},d=I.useCallback(()=>{s.current&&window.clearTimeout(s.current),s.current=null},[]);return I.useEffect(()=>d,[d]),I.useEffect(()=>{const u=a.current;return()=>{window.clearTimeout(u),l(null)}},[a,l]),g.jsx(aM,{asChild:!0,...c,children:g.jsx(aq,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":i.contentId,"data-state":wq(n.open),...t,ref:$0(e,i.onTriggerChange),onClick:u=>{t.onClick?.(u),!(t.disabled||u.defaultPrevented)&&(u.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:Fe(t.onPointerMove,vy(u=>{o.onItemEnter(u),!u.defaultPrevented&&!t.disabled&&!n.open&&!s.current&&(o.onPointerGraceIntentChange(null),s.current=window.setTimeout(()=>{n.onOpenChange(!0),d()},100))})),onPointerLeave:Fe(t.onPointerLeave,vy(u=>{d();const p=n.content?.getBoundingClientRect();if(p){const f=n.content?.dataset.side,y=f==="right",v=y?-5:5,x=p[y?"left":"right"],b=p[y?"right":"left"];o.onPointerGraceIntentChange({area:[{x:u.clientX+v,y:u.clientY},{x,y:p.top},{x:b,y:p.top},{x:b,y:p.bottom},{x,y:p.bottom}],side:f}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(u),u.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:Fe(t.onKeyDown,u=>{const p=o.searchRef.current!=="";t.disabled||p&&u.key===" "||X1e[r.dir].includes(u.key)&&(n.onOpenChange(!0),n.content?.focus(),u.preventDefault())})})})});xq.displayName=gm;var Sq="MenuSubContent",bq=I.forwardRef((t,e)=>{const n=rq(ca,t.__scopeMenu),{forceMount:r=n.forceMount,...i}=t,o=Qu(ca,t.__scopeMenu),s=fv(ca,t.__scopeMenu),a=yq(Sq,t.__scopeMenu),l=I.useRef(null),c=hn(e,l);return g.jsx(yy.Provider,{scope:t.__scopeMenu,children:g.jsx(pa,{present:r||o.open,children:g.jsx(yy.Slot,{scope:t.__scopeMenu,children:g.jsx(uM,{id:a.contentId,"aria-labelledby":a.triggerId,...i,ref:c,align:"start",side:s.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{s.isUsingKeyboardRef.current&&l.current?.focus(),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:Fe(t.onFocusOutside,d=>{d.target!==a.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:Fe(t.onEscapeKeyDown,d=>{s.onClose(),d.preventDefault()}),onKeyDown:Fe(t.onKeyDown,d=>{const u=d.currentTarget.contains(d.target),p=Z1e[s.dir].includes(d.key);u&&p&&(o.onOpenChange(!1),a.trigger?.focus(),d.preventDefault())})})})})})});bq.displayName=Sq;function wq(t){return t?"open":"closed"}function zb(t){return t==="indeterminate"}function fM(t){return zb(t)?"indeterminate":t?"checked":"unchecked"}function mke(t){const e=document.activeElement;for(const n of t)if(n===e||(n.focus(),document.activeElement!==e))return}function yke(t,e){return t.map((n,r)=>t[(e+r)%t.length])}function vke(t,e,n){const i=e.length>1&&Array.from(e).every(c=>c===e[0])?e[0]:e,o=n?t.indexOf(n):-1;let s=yke(t,Math.max(o,0));i.length===1&&(s=s.filter(c=>c!==n));const l=s.find(c=>c.toLowerCase().startsWith(i.toLowerCase()));return l!==n?l:void 0}function xke(t,e){const{x:n,y:r}=t;let i=!1;for(let o=0,s=e.length-1;o<e.length;s=o++){const a=e[o],l=e[s],c=a.x,d=a.y,u=l.x,p=l.y;d>r!=p>r&&n<(u-c)*(r-d)/(p-d)+c&&(i=!i)}return i}function Ske(t,e){if(!e)return!1;const n={x:t.clientX,y:t.clientY};return xke(n,e)}function vy(t){return e=>e.pointerType==="mouse"?t(e):void 0}var kq=nq,Iq=aM,_q=iq,Cq=oq,Pq=dM,Tq=sq,Eq=Z0,Aq=lq,Mq=uq,Oq=hq,Dq=fq,jq=gq,Rq=mq,$q=vq,Nq=xq,Lq=bq,gM="ContextMenu",[bke]=Ms(gM,[X0]),Ji=X0(),[wke,zq]=bke(gM),Fq=t=>{const{__scopeContextMenu:e,children:n,onOpenChange:r,dir:i,modal:o=!0}=t,[s,a]=I.useState(!1),l=Ji(e),c=wo(r),d=I.useCallback(u=>{a(u),c(u)},[c]);return g.jsx(wke,{scope:e,open:s,onOpenChange:d,modal:o,children:g.jsx(kq,{...l,dir:i,open:s,onOpenChange:d,modal:o,children:n})})};Fq.displayName=gM;var Bq="ContextMenuTrigger",Uq=I.forwardRef((t,e)=>{const{__scopeContextMenu:n,disabled:r=!1,...i}=t,o=zq(Bq,n),s=Ji(n),a=I.useRef({x:0,y:0}),l=I.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),c=I.useRef(0),d=I.useCallback(()=>window.clearTimeout(c.current),[]),u=p=>{a.current={x:p.clientX,y:p.clientY},o.onOpenChange(!0)};return I.useEffect(()=>d,[d]),I.useEffect(()=>void(r&&d()),[r,d]),g.jsxs(g.Fragment,{children:[g.jsx(Iq,{...s,virtualRef:l}),g.jsx(Ct.span,{"data-state":o.open?"open":"closed","data-disabled":r?"":void 0,...i,ref:e,style:{WebkitTouchCallout:"none",...t.style},onContextMenu:r?t.onContextMenu:Fe(t.onContextMenu,p=>{d(),u(p),p.preventDefault()}),onPointerDown:r?t.onPointerDown:Fe(t.onPointerDown,tS(p=>{d(),c.current=window.setTimeout(()=>u(p),700)})),onPointerMove:r?t.onPointerMove:Fe(t.onPointerMove,tS(d)),onPointerCancel:r?t.onPointerCancel:Fe(t.onPointerCancel,tS(d)),onPointerUp:r?t.onPointerUp:Fe(t.onPointerUp,tS(d))})]})});Uq.displayName=Bq;var kke="ContextMenuPortal",mM=t=>{const{__scopeContextMenu:e,...n}=t,r=Ji(e);return g.jsx(_q,{...r,...n})};mM.displayName=kke;var Hq="ContextMenuContent",Wq=I.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=zq(Hq,n),o=Ji(n),s=I.useRef(!1);return g.jsx(Cq,{...o,...r,ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{t.onCloseAutoFocus?.(a),!a.defaultPrevented&&s.current&&a.preventDefault(),s.current=!1},onInteractOutside:a=>{t.onInteractOutside?.(a),!a.defaultPrevented&&!i.modal&&(s.current=!0)},style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Wq.displayName=Hq;var Ike="ContextMenuGroup",_ke=I.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ji(n);return g.jsx(Pq,{...i,...r,ref:e})});_ke.displayName=Ike;var Cke="ContextMenuLabel",Pke=I.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ji(n);return g.jsx(Tq,{...i,...r,ref:e})});Pke.displayName=Cke;var Tke="ContextMenuItem",Vq=I.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ji(n);return g.jsx(Eq,{...i,...r,ref:e})});Vq.displayName=Tke;var Eke="ContextMenuCheckboxItem",Kq=I.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ji(n);return g.jsx(Aq,{...i,...r,ref:e})});Kq.displayName=Eke;var Ake="ContextMenuRadioGroup",Mke=I.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ji(n);return g.jsx(Mq,{...i,...r,ref:e})});Mke.displayName=Ake;var Oke="ContextMenuRadioItem",Dke=I.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ji(n);return g.jsx(Oq,{...i,...r,ref:e})});Dke.displayName=Oke;var jke="ContextMenuItemIndicator",Rke=I.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ji(n);return g.jsx(Dq,{...i,...r,ref:e})});Rke.displayName=jke;var $ke="ContextMenuSeparator",Nke=I.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ji(n);return g.jsx(jq,{...i,...r,ref:e})});Nke.displayName=$ke;var Lke="ContextMenuArrow",zke=I.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ji(n);return g.jsx(Rq,{...i,...r,ref:e})});zke.displayName=Lke;var qq="ContextMenuSub",Gq=t=>{const{__scopeContextMenu:e,children:n,onOpenChange:r,open:i,defaultOpen:o}=t,s=Ji(e),[a,l]=ha({prop:i,defaultProp:o??!1,onChange:r,caller:qq});return g.jsx($q,{...s,open:a,onOpenChange:l,children:n})};Gq.displayName=qq;var Fke="ContextMenuSubTrigger",Yq=I.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ji(n);return g.jsx(Nq,{...i,...r,ref:e})});Yq.displayName=Fke;var Bke="ContextMenuSubContent",Xq=I.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,i=Ji(n);return g.jsx(Lq,{...i,...r,ref:e,style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Xq.displayName=Bke;function tS(t){return e=>e.pointerType!=="mouse"?t(e):void 0}var Uke=Fq,Hke=Uq,Wke=mM,Vke=Wq,Kke=Vq,qke=Kq,J0="DropdownMenu",[Gke]=Ms(J0,[X0]),Qi=X0(),[Yke,Zq]=Gke(J0),Jq=t=>{const{__scopeDropdownMenu:e,children:n,dir:r,open:i,defaultOpen:o,onOpenChange:s,modal:a=!0}=t,l=Qi(e),c=I.useRef(null),[d,u]=ha({prop:i,defaultProp:o??!1,onChange:s,caller:J0});return g.jsx(Yke,{scope:e,triggerId:wl(),triggerRef:c,contentId:wl(),open:d,onOpenChange:u,onOpenToggle:I.useCallback(()=>u(p=>!p),[u]),modal:a,children:g.jsx(kq,{...l,open:d,onOpenChange:u,dir:r,modal:a,children:n})})};Jq.displayName=J0;var Qq="DropdownMenuTrigger",eG=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,disabled:r=!1,...i}=t,o=Zq(Qq,n),s=Qi(n);return g.jsx(Iq,{asChild:!0,...s,children:g.jsx(Ct.button,{type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...i,ref:$0(e,o.triggerRef),onPointerDown:Fe(t.onPointerDown,a=>{!r&&a.button===0&&a.ctrlKey===!1&&(o.onOpenToggle(),o.open||a.preventDefault())}),onKeyDown:Fe(t.onKeyDown,a=>{r||(["Enter"," "].includes(a.key)&&o.onOpenToggle(),a.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});eG.displayName=Qq;var Xke="DropdownMenuPortal",tG=t=>{const{__scopeDropdownMenu:e,...n}=t,r=Qi(e);return g.jsx(_q,{...r,...n})};tG.displayName=Xke;var nG="DropdownMenuContent",rG=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Zq(nG,n),o=Qi(n),s=I.useRef(!1);return g.jsx(Cq,{id:i.contentId,"aria-labelledby":i.triggerId,...o,...r,ref:e,onCloseAutoFocus:Fe(t.onCloseAutoFocus,a=>{s.current||i.triggerRef.current?.focus(),s.current=!1,a.preventDefault()}),onInteractOutside:Fe(t.onInteractOutside,a=>{const l=a.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,d=l.button===2||c;(!i.modal||d)&&(s.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});rG.displayName=nG;var Zke="DropdownMenuGroup",Jke=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Qi(n);return g.jsx(Pq,{...i,...r,ref:e})});Jke.displayName=Zke;var Qke="DropdownMenuLabel",eIe=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Qi(n);return g.jsx(Tq,{...i,...r,ref:e})});eIe.displayName=Qke;var tIe="DropdownMenuItem",iG=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Qi(n);return g.jsx(Eq,{...i,...r,ref:e})});iG.displayName=tIe;var nIe="DropdownMenuCheckboxItem",oG=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Qi(n);return g.jsx(Aq,{...i,...r,ref:e})});oG.displayName=nIe;var rIe="DropdownMenuRadioGroup",iIe=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Qi(n);return g.jsx(Mq,{...i,...r,ref:e})});iIe.displayName=rIe;var oIe="DropdownMenuRadioItem",sIe=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Qi(n);return g.jsx(Oq,{...i,...r,ref:e})});sIe.displayName=oIe;var aIe="DropdownMenuItemIndicator",sG=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Qi(n);return g.jsx(Dq,{...i,...r,ref:e})});sG.displayName=aIe;var lIe="DropdownMenuSeparator",cIe=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Qi(n);return g.jsx(jq,{...i,...r,ref:e})});cIe.displayName=lIe;var uIe="DropdownMenuArrow",dIe=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Qi(n);return g.jsx(Rq,{...i,...r,ref:e})});dIe.displayName=uIe;var hIe=t=>{const{__scopeDropdownMenu:e,children:n,open:r,onOpenChange:i,defaultOpen:o}=t,s=Qi(e),[a,l]=ha({prop:r,defaultProp:o??!1,onChange:i,caller:"DropdownMenuSub"});return g.jsx($q,{...s,open:a,onOpenChange:l,children:n})},pIe="DropdownMenuSubTrigger",aG=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Qi(n);return g.jsx(Nq,{...i,...r,ref:e})});aG.displayName=pIe;var fIe="DropdownMenuSubContent",lG=I.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,i=Qi(n);return g.jsx(Lq,{...i,...r,ref:e,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});lG.displayName=fIe;var yM=Jq,vM=eG,Q0=tG,xM=rG,gIe=iG,cG=oG,mIe=sG,yIe=hIe,vIe=aG,xIe=lG;function uG(t,[e,n]){return Math.min(n,Math.max(e,t))}var e1="Popover",[dG]=Ms(e1,[Ff]),gv=Ff(),[SIe,ed]=dG(e1),hG=t=>{const{__scopePopover:e,children:n,open:r,defaultOpen:i,onOpenChange:o,modal:s=!1}=t,a=gv(e),l=I.useRef(null),[c,d]=I.useState(!1),[u,p]=ha({prop:r,defaultProp:i??!1,onChange:o,caller:e1});return g.jsx(q0,{...a,children:g.jsx(SIe,{scope:e,contentId:wl(),triggerRef:l,open:u,onOpenChange:p,onOpenToggle:I.useCallback(()=>p(f=>!f),[p]),hasCustomAnchor:c,onCustomAnchorAdd:I.useCallback(()=>d(!0),[]),onCustomAnchorRemove:I.useCallback(()=>d(!1),[]),modal:s,children:n})})};hG.displayName=e1;var pG="PopoverAnchor",bIe=I.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,i=ed(pG,n),o=gv(n),{onCustomAnchorAdd:s,onCustomAnchorRemove:a}=i;return I.useEffect(()=>(s(),()=>a()),[s,a]),g.jsx(G0,{...o,...r,ref:e})});bIe.displayName=pG;var fG="PopoverTrigger",gG=I.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,i=ed(fG,n),o=gv(n),s=hn(e,i.triggerRef),a=g.jsx(Ct.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":SG(i.open),...r,ref:s,onClick:Fe(t.onClick,i.onOpenToggle)});return i.hasCustomAnchor?a:g.jsx(G0,{asChild:!0,...o,children:a})});gG.displayName=fG;var SM="PopoverPortal",[wIe,kIe]=dG(SM,{forceMount:void 0}),mG=t=>{const{__scopePopover:e,forceMount:n,children:r,container:i}=t,o=ed(SM,e);return g.jsx(wIe,{scope:e,forceMount:n,children:g.jsx(pa,{present:n||o.open,children:g.jsx(cv,{asChild:!0,container:i,children:r})})})};mG.displayName=SM;var mf="PopoverContent",yG=I.forwardRef((t,e)=>{const n=kIe(mf,t.__scopePopover),{forceMount:r=n.forceMount,...i}=t,o=ed(mf,t.__scopePopover);return g.jsx(pa,{present:r||o.open,children:o.modal?g.jsx(_Ie,{...i,ref:e}):g.jsx(CIe,{...i,ref:e})})});yG.displayName=mf;var IIe=lh("PopoverContent.RemoveScroll"),_Ie=I.forwardRef((t,e)=>{const n=ed(mf,t.__scopePopover),r=I.useRef(null),i=hn(e,r),o=I.useRef(!1);return I.useEffect(()=>{const s=r.current;if(s)return KA(s)},[]),g.jsx(B0,{as:IIe,allowPinchZoom:!0,children:g.jsx(vG,{...t,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Fe(t.onCloseAutoFocus,s=>{s.preventDefault(),o.current||n.triggerRef.current?.focus()}),onPointerDownOutside:Fe(t.onPointerDownOutside,s=>{const a=s.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0,c=a.button===2||l;o.current=c},{checkForDefaultPrevented:!1}),onFocusOutside:Fe(t.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1})})})}),CIe=I.forwardRef((t,e)=>{const n=ed(mf,t.__scopePopover),r=I.useRef(!1),i=I.useRef(!1);return g.jsx(vG,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{t.onCloseAutoFocus?.(o),o.defaultPrevented||(r.current||n.triggerRef.current?.focus(),o.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:o=>{t.onInteractOutside?.(o),o.defaultPrevented||(r.current=!0,o.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const s=o.target;n.triggerRef.current?.contains(s)&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&i.current&&o.preventDefault()}})}),vG=I.forwardRef((t,e)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:s,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onInteractOutside:d,...u}=t,p=ed(mf,n),f=gv(n);return VA(),g.jsx(z0,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o,children:g.jsx(Nf,{asChild:!0,disableOutsidePointerEvents:s,onInteractOutside:d,onEscapeKeyDown:a,onPointerDownOutside:l,onFocusOutside:c,onDismiss:()=>p.onOpenChange(!1),children:g.jsx(iM,{"data-state":SG(p.open),role:"dialog",id:p.contentId,...f,...u,ref:e,style:{...u.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),xG="PopoverClose",PIe=I.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,i=ed(xG,n);return g.jsx(Ct.button,{type:"button",...r,ref:e,onClick:Fe(t.onClick,()=>i.onOpenChange(!1))})});PIe.displayName=xG;var TIe="PopoverArrow",EIe=I.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,i=gv(n);return g.jsx(oM,{...i,...r,ref:e})});EIe.displayName=TIe;function SG(t){return t?"open":"closed"}var bM=hG,wM=gG,kM=mG,IM=yG,AIe="Separator",w3="horizontal",MIe=["horizontal","vertical"],bG=I.forwardRef((t,e)=>{const{decorative:n,orientation:r=w3,...i}=t,o=OIe(r)?r:w3,a=n?{role:"none"}:{"aria-orientation":o==="vertical"?o:void 0,role:"separator"};return g.jsx(Ct.div,{"data-orientation":o,...a,...i,ref:e})});bG.displayName=AIe;function OIe(t){return MIe.includes(t)}var DIe=bG,wG=["PageUp","PageDown"],kG=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],IG={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Uf="Slider",[pE,jIe,RIe]=L0(Uf),[_G]=Ms(Uf,[RIe]),[$Ie,t1]=_G(Uf),CG=I.forwardRef((t,e)=>{const{name:n,min:r=0,max:i=100,step:o=1,orientation:s="horizontal",disabled:a=!1,minStepsBetweenThumbs:l=0,defaultValue:c=[r],value:d,onValueChange:u=()=>{},onValueCommit:p=()=>{},inverted:f=!1,form:y,...v}=t,x=I.useRef(new Set),b=I.useRef(0),_=s==="horizontal"?NIe:LIe,[C=[],A]=ha({prop:d,defaultProp:c,onChange:j=>{[...x.current][b.current]?.focus(),u(j)}}),E=I.useRef(C);function O(j){const F=HIe(C,j);L(j,F)}function D(j){L(j,b.current)}function B(){const j=E.current[b.current];C[b.current]!==j&&p(C)}function L(j,F,{commit:z}={commit:!1}){const $=qIe(o),V=GIe(Math.round((j-r)/o)*o+r,$),Y=uG(V,[r,i]);A((re=[])=>{const q=BIe(re,Y,F);if(KIe(q,l*o)){b.current=q.indexOf(Y);const X=String(q)!==String(re);return X&&z&&p(q),X?q:re}else return re})}return g.jsx($Ie,{scope:t.__scopeSlider,name:n,disabled:a,min:r,max:i,valueIndexToChangeRef:b,thumbs:x.current,values:C,orientation:s,form:y,children:g.jsx(pE.Provider,{scope:t.__scopeSlider,children:g.jsx(pE.Slot,{scope:t.__scopeSlider,children:g.jsx(_,{"aria-disabled":a,"data-disabled":a?"":void 0,...v,ref:e,onPointerDown:Fe(v.onPointerDown,()=>{a||(E.current=C)}),min:r,max:i,inverted:f,onSlideStart:a?void 0:O,onSlideMove:a?void 0:D,onSlideEnd:a?void 0:B,onHomeKeyDown:()=>!a&&L(r,0,{commit:!0}),onEndKeyDown:()=>!a&&L(i,C.length-1,{commit:!0}),onStepKeyDown:({event:j,direction:F})=>{if(!a){const V=wG.includes(j.key)||j.shiftKey&&kG.includes(j.key)?10:1,Y=b.current,re=C[Y],q=o*V*F;L(re+q,Y,{commit:!0})}}})})})})});CG.displayName=Uf;var[PG,TG]=_G(Uf,{startEdge:"left",endEdge:"right",size:"width",direction:1}),NIe=I.forwardRef((t,e)=>{const{min:n,max:r,dir:i,inverted:o,onSlideStart:s,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...d}=t,[u,p]=I.useState(null),f=hn(e,_=>p(_)),y=I.useRef(void 0),v=lv(i),x=v==="ltr",b=x&&!o||!x&&o;function w(_){const C=y.current||u.getBoundingClientRect(),A=[0,C.width],O=_M(A,b?[n,r]:[r,n]);return y.current=C,O(_-C.left)}return g.jsx(PG,{scope:t.__scopeSlider,startEdge:b?"left":"right",endEdge:b?"right":"left",direction:b?1:-1,size:"width",children:g.jsx(EG,{dir:v,"data-orientation":"horizontal",...d,ref:f,style:{...d.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:_=>{const C=w(_.clientX);s?.(C)},onSlideMove:_=>{const C=w(_.clientX);a?.(C)},onSlideEnd:()=>{y.current=void 0,l?.()},onStepKeyDown:_=>{const A=IG[b?"from-left":"from-right"].includes(_.key);c?.({event:_,direction:A?-1:1})}})})}),LIe=I.forwardRef((t,e)=>{const{min:n,max:r,inverted:i,onSlideStart:o,onSlideMove:s,onSlideEnd:a,onStepKeyDown:l,...c}=t,d=I.useRef(null),u=hn(e,d),p=I.useRef(void 0),f=!i;function y(v){const x=p.current||d.current.getBoundingClientRect(),b=[0,x.height],_=_M(b,f?[r,n]:[n,r]);return p.current=x,_(v-x.top)}return g.jsx(PG,{scope:t.__scopeSlider,startEdge:f?"bottom":"top",endEdge:f?"top":"bottom",size:"height",direction:f?1:-1,children:g.jsx(EG,{"data-orientation":"vertical",...c,ref:u,style:{...c.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:v=>{const x=y(v.clientY);o?.(x)},onSlideMove:v=>{const x=y(v.clientY);s?.(x)},onSlideEnd:()=>{p.current=void 0,a?.()},onStepKeyDown:v=>{const b=IG[f?"from-bottom":"from-top"].includes(v.key);l?.({event:v,direction:b?-1:1})}})})}),EG=I.forwardRef((t,e)=>{const{__scopeSlider:n,onSlideStart:r,onSlideMove:i,onSlideEnd:o,onHomeKeyDown:s,onEndKeyDown:a,onStepKeyDown:l,...c}=t,d=t1(Uf,n);return g.jsx(Ct.span,{...c,ref:e,onKeyDown:Fe(t.onKeyDown,u=>{u.key==="Home"?(s(u),u.preventDefault()):u.key==="End"?(a(u),u.preventDefault()):wG.concat(kG).includes(u.key)&&(l(u),u.preventDefault())}),onPointerDown:Fe(t.onPointerDown,u=>{const p=u.target;p.setPointerCapture(u.pointerId),u.preventDefault(),d.thumbs.has(p)?p.focus():r(u)}),onPointerMove:Fe(t.onPointerMove,u=>{u.target.hasPointerCapture(u.pointerId)&&i(u)}),onPointerUp:Fe(t.onPointerUp,u=>{const p=u.target;p.hasPointerCapture(u.pointerId)&&(p.releasePointerCapture(u.pointerId),o(u))})})}),AG="SliderTrack",MG=I.forwardRef((t,e)=>{const{__scopeSlider:n,...r}=t,i=t1(AG,n);return g.jsx(Ct.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...r,ref:e})});MG.displayName=AG;var fE="SliderRange",OG=I.forwardRef((t,e)=>{const{__scopeSlider:n,...r}=t,i=t1(fE,n),o=TG(fE,n),s=I.useRef(null),a=hn(e,s),l=i.values.length,c=i.values.map(p=>RG(p,i.min,i.max)),d=l>1?Math.min(...c):0,u=100-Math.max(...c);return g.jsx(Ct.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...r,ref:a,style:{...t.style,[o.startEdge]:d+"%",[o.endEdge]:u+"%"}})});OG.displayName=fE;var gE="SliderThumb",DG=I.forwardRef((t,e)=>{const n=jIe(t.__scopeSlider),[r,i]=I.useState(null),o=hn(e,a=>i(a)),s=I.useMemo(()=>r?n().findIndex(a=>a.ref.current===r):-1,[n,r]);return g.jsx(zIe,{...t,ref:o,index:s})}),zIe=I.forwardRef((t,e)=>{const{__scopeSlider:n,index:r,name:i,...o}=t,s=t1(gE,n),a=TG(gE,n),[l,c]=I.useState(null),d=hn(e,w=>c(w)),u=l?s.form||!!l.closest("form"):!0,p=CK(l),f=s.values[r],y=f===void 0?0:RG(f,s.min,s.max),v=UIe(r,s.values.length),x=p?.[a.size],b=x?WIe(x,y,a.direction):0;return I.useEffect(()=>{if(l)return s.thumbs.add(l),()=>{s.thumbs.delete(l)}},[l,s.thumbs]),g.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${y}% + ${b}px)`},children:[g.jsx(pE.ItemSlot,{scope:t.__scopeSlider,children:g.jsx(Ct.span,{role:"slider","aria-label":t["aria-label"]||v,"aria-valuemin":s.min,"aria-valuenow":f,"aria-valuemax":s.max,"aria-orientation":s.orientation,"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0,tabIndex:s.disabled?void 0:0,...o,ref:d,style:f===void 0?{display:"none"}:t.style,onFocus:Fe(t.onFocus,()=>{s.valueIndexToChangeRef.current=r})})}),u&&g.jsx(jG,{name:i??(s.name?s.name+(s.values.length>1?"[]":""):void 0),form:s.form,value:f},r)]})});DG.displayName=gE;var FIe="RadioBubbleInput",jG=I.forwardRef(({__scopeSlider:t,value:e,...n},r)=>{const i=I.useRef(null),o=hn(i,r),s=x0e(e);return I.useEffect(()=>{const a=i.current;if(!a)return;const l=window.HTMLInputElement.prototype,d=Object.getOwnPropertyDescriptor(l,"value").set;if(s!==e&&d){const u=new Event("input",{bubbles:!0});d.call(a,e),a.dispatchEvent(u)}},[s,e]),g.jsx(Ct.input,{style:{display:"none"},...n,ref:o,defaultValue:e})});jG.displayName=FIe;function BIe(t=[],e,n){const r=[...t];return r[n]=e,r.sort((i,o)=>i-o)}function RG(t,e,n){const o=100/(n-e)*(t-e);return uG(o,[0,100])}function UIe(t,e){return e>2?`Value ${t+1} of ${e}`:e===2?["Minimum","Maximum"][t]:void 0}function HIe(t,e){if(t.length===1)return 0;const n=t.map(i=>Math.abs(i-e)),r=Math.min(...n);return n.indexOf(r)}function WIe(t,e,n){const r=t/2,o=_M([0,50],[0,r]);return(r-o(e)*n)*n}function VIe(t){return t.slice(0,-1).map((e,n)=>t[n+1]-e)}function KIe(t,e){if(e>0){const n=VIe(t);return Math.min(...n)>=e}return!0}function _M(t,e){return n=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const r=(e[1]-e[0])/(t[1]-t[0]);return e[0]+r*(n-t[0])}}function qIe(t){return(String(t).split(".")[1]||"").length}function GIe(t,e){const n=Math.pow(10,e);return Math.round(t*n)/n}var YIe=CG,XIe=MG,ZIe=OG,JIe=DG,CM="ToastProvider",[PM,QIe,e_e]=L0("Toast"),[$G]=Ms("Toast",[e_e]),[t_e,n1]=$G(CM),NG=t=>{const{__scopeToast:e,label:n="Notification",duration:r=5e3,swipeDirection:i="right",swipeThreshold:o=50,children:s}=t,[a,l]=I.useState(null),[c,d]=I.useState(0),u=I.useRef(!1),p=I.useRef(!1);return n.trim()||console.error(`Invalid prop \`label\` supplied to \`${CM}\`. Expected non-empty \`string\`.`),g.jsx(PM.Provider,{scope:e,children:g.jsx(t_e,{scope:e,label:n,duration:r,swipeDirection:i,swipeThreshold:o,toastCount:c,viewport:a,onViewportChange:l,onToastAdd:I.useCallback(()=>d(f=>f+1),[]),onToastRemove:I.useCallback(()=>d(f=>f-1),[]),isFocusedToastEscapeKeyDownRef:u,isClosePausedRef:p,children:s})})};NG.displayName=CM;var LG="ToastViewport",n_e=["F8"],mE="toast.viewportPause",yE="toast.viewportResume",zG=I.forwardRef((t,e)=>{const{__scopeToast:n,hotkey:r=n_e,label:i="Notifications ({hotkey})",...o}=t,s=n1(LG,n),a=QIe(n),l=I.useRef(null),c=I.useRef(null),d=I.useRef(null),u=I.useRef(null),p=hn(e,u,s.onViewportChange),f=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),y=s.toastCount>0;I.useEffect(()=>{const x=b=>{r.length!==0&&r.every(_=>b[_]||b.code===_)&&u.current?.focus()};return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[r]),I.useEffect(()=>{const x=l.current,b=u.current;if(y&&x&&b){const w=()=>{if(!s.isClosePausedRef.current){const E=new CustomEvent(mE);b.dispatchEvent(E),s.isClosePausedRef.current=!0}},_=()=>{if(s.isClosePausedRef.current){const E=new CustomEvent(yE);b.dispatchEvent(E),s.isClosePausedRef.current=!1}},C=E=>{!x.contains(E.relatedTarget)&&_()},A=()=>{x.contains(document.activeElement)||_()};return x.addEventListener("focusin",w),x.addEventListener("focusout",C),x.addEventListener("pointermove",w),x.addEventListener("pointerleave",A),window.addEventListener("blur",w),window.addEventListener("focus",_),()=>{x.removeEventListener("focusin",w),x.removeEventListener("focusout",C),x.removeEventListener("pointermove",w),x.removeEventListener("pointerleave",A),window.removeEventListener("blur",w),window.removeEventListener("focus",_)}}},[y,s.isClosePausedRef]);const v=I.useCallback(({tabbingDirection:x})=>{const w=a().map(_=>{const C=_.ref.current,A=[C,...g_e(C)];return x==="forwards"?A:A.reverse()});return(x==="forwards"?w.reverse():w).flat()},[a]);return I.useEffect(()=>{const x=u.current;if(x){const b=w=>{const _=w.altKey||w.ctrlKey||w.metaKey;if(w.key==="Tab"&&!_){const A=document.activeElement,E=w.shiftKey;if(w.target===x&&E){c.current?.focus();return}const B=v({tabbingDirection:E?"backwards":"forwards"}),L=B.findIndex(j=>j===A);CP(B.slice(L+1))?w.preventDefault():E?c.current?.focus():d.current?.focus()}};return x.addEventListener("keydown",b),()=>x.removeEventListener("keydown",b)}},[a,v]),g.jsxs(cwe,{ref:l,role:"region","aria-label":i.replace("{hotkey}",f),tabIndex:-1,style:{pointerEvents:y?void 0:"none"},children:[y&&g.jsx(vE,{ref:c,onFocusFromOutsideViewport:()=>{const x=v({tabbingDirection:"forwards"});CP(x)}}),g.jsx(PM.Slot,{scope:n,children:g.jsx(Ct.ol,{tabIndex:-1,...o,ref:p})}),y&&g.jsx(vE,{ref:d,onFocusFromOutsideViewport:()=>{const x=v({tabbingDirection:"backwards"});CP(x)}})]})});zG.displayName=LG;var FG="ToastFocusProxy",vE=I.forwardRef((t,e)=>{const{__scopeToast:n,onFocusFromOutsideViewport:r,...i}=t,o=n1(FG,n);return g.jsx(N0,{tabIndex:0,...i,ref:e,style:{position:"fixed"},onFocus:s=>{const a=s.relatedTarget;!o.viewport?.contains(a)&&r()}})});vE.displayName=FG;var mv="Toast",r_e="toast.swipeStart",i_e="toast.swipeMove",o_e="toast.swipeCancel",s_e="toast.swipeEnd",BG=I.forwardRef((t,e)=>{const{forceMount:n,open:r,defaultOpen:i,onOpenChange:o,...s}=t,[a,l]=ha({prop:r,defaultProp:i??!0,onChange:o,caller:mv});return g.jsx(pa,{present:n||a,children:g.jsx(c_e,{open:a,...s,ref:e,onClose:()=>l(!1),onPause:wo(t.onPause),onResume:wo(t.onResume),onSwipeStart:Fe(t.onSwipeStart,c=>{c.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Fe(t.onSwipeMove,c=>{const{x:d,y:u}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","move"),c.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${d}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${u}px`)}),onSwipeCancel:Fe(t.onSwipeCancel,c=>{c.currentTarget.setAttribute("data-swipe","cancel"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Fe(t.onSwipeEnd,c=>{const{x:d,y:u}=c.detail.delta;c.currentTarget.setAttribute("data-swipe","end"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),c.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),c.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${d}px`),c.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${u}px`),l(!1)})})})});BG.displayName=mv;var[a_e,l_e]=$G(mv,{onClose(){}}),c_e=I.forwardRef((t,e)=>{const{__scopeToast:n,type:r="foreground",duration:i,open:o,onClose:s,onEscapeKeyDown:a,onPause:l,onResume:c,onSwipeStart:d,onSwipeMove:u,onSwipeCancel:p,onSwipeEnd:f,...y}=t,v=n1(mv,n),[x,b]=I.useState(null),w=hn(e,$=>b($)),_=I.useRef(null),C=I.useRef(null),A=i||v.duration,E=I.useRef(0),O=I.useRef(A),D=I.useRef(0),{onToastAdd:B,onToastRemove:L}=v,j=wo(()=>{x?.contains(document.activeElement)&&v.viewport?.focus(),s()}),F=I.useCallback($=>{!$||$===1/0||(window.clearTimeout(D.current),E.current=new Date().getTime(),D.current=window.setTimeout(j,$))},[j]);I.useEffect(()=>{const $=v.viewport;if($){const V=()=>{F(O.current),c?.()},Y=()=>{const re=new Date().getTime()-E.current;O.current=O.current-re,window.clearTimeout(D.current),l?.()};return $.addEventListener(mE,Y),$.addEventListener(yE,V),()=>{$.removeEventListener(mE,Y),$.removeEventListener(yE,V)}}},[v.viewport,A,l,c,F]),I.useEffect(()=>{o&&!v.isClosePausedRef.current&&F(A)},[o,A,v.isClosePausedRef,F]),I.useEffect(()=>(B(),()=>L()),[B,L]);const z=I.useMemo(()=>x?GG(x):null,[x]);return v.viewport?g.jsxs(g.Fragment,{children:[z&&g.jsx(u_e,{__scopeToast:n,role:"status","aria-live":r==="foreground"?"assertive":"polite",children:z}),g.jsx(a_e,{scope:n,onClose:j,children:_h.createPortal(g.jsx(PM.ItemSlot,{scope:n,children:g.jsx(lwe,{asChild:!0,onEscapeKeyDown:Fe(a,()=>{v.isFocusedToastEscapeKeyDownRef.current||j(),v.isFocusedToastEscapeKeyDownRef.current=!1}),children:g.jsx(Ct.li,{tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":v.swipeDirection,...y,ref:w,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:Fe(t.onKeyDown,$=>{$.key==="Escape"&&(a?.($.nativeEvent),$.nativeEvent.defaultPrevented||(v.isFocusedToastEscapeKeyDownRef.current=!0,j()))}),onPointerDown:Fe(t.onPointerDown,$=>{$.button===0&&(_.current={x:$.clientX,y:$.clientY})}),onPointerMove:Fe(t.onPointerMove,$=>{if(!_.current)return;const V=$.clientX-_.current.x,Y=$.clientY-_.current.y,re=!!C.current,q=["left","right"].includes(v.swipeDirection),X=["left","up"].includes(v.swipeDirection)?Math.min:Math.max,N=q?X(0,V):0,H=q?0:X(0,Y),ie=$.pointerType==="touch"?10:2,U={x:N,y:H},ke={originalEvent:$,delta:U};re?(C.current=U,nS(i_e,u,ke,{discrete:!1})):k3(U,v.swipeDirection,ie)?(C.current=U,nS(r_e,d,ke,{discrete:!1}),$.target.setPointerCapture($.pointerId)):(Math.abs(V)>ie||Math.abs(Y)>ie)&&(_.current=null)}),onPointerUp:Fe(t.onPointerUp,$=>{const V=C.current,Y=$.target;if(Y.hasPointerCapture($.pointerId)&&Y.releasePointerCapture($.pointerId),C.current=null,_.current=null,V){const re=$.currentTarget,q={originalEvent:$,delta:V};k3(V,v.swipeDirection,v.swipeThreshold)?nS(s_e,f,q,{discrete:!0}):nS(o_e,p,q,{discrete:!0}),re.addEventListener("click",X=>X.preventDefault(),{once:!0})}})})})}),v.viewport)})]}):null}),u_e=t=>{const{__scopeToast:e,children:n,...r}=t,i=n1(mv,e),[o,s]=I.useState(!1),[a,l]=I.useState(!1);return p_e(()=>s(!0)),I.useEffect(()=>{const c=window.setTimeout(()=>l(!0),1e3);return()=>window.clearTimeout(c)},[]),a?null:g.jsx(cv,{asChild:!0,children:g.jsx(N0,{...r,children:o&&g.jsxs(g.Fragment,{children:[i.label," ",n]})})})},d_e="ToastTitle",UG=I.forwardRef((t,e)=>{const{__scopeToast:n,...r}=t;return g.jsx(Ct.div,{...r,ref:e})});UG.displayName=d_e;var h_e="ToastDescription",HG=I.forwardRef((t,e)=>{const{__scopeToast:n,...r}=t;return g.jsx(Ct.div,{...r,ref:e})});HG.displayName=h_e;var WG="ToastAction",VG=I.forwardRef((t,e)=>{const{altText:n,...r}=t;return n.trim()?g.jsx(qG,{altText:n,asChild:!0,children:g.jsx(TM,{...r,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${WG}\`. Expected non-empty \`string\`.`),null)});VG.displayName=WG;var KG="ToastClose",TM=I.forwardRef((t,e)=>{const{__scopeToast:n,...r}=t,i=l_e(KG,n);return g.jsx(qG,{asChild:!0,children:g.jsx(Ct.button,{type:"button",...r,ref:e,onClick:Fe(t.onClick,i.onClose)})})});TM.displayName=KG;var qG=I.forwardRef((t,e)=>{const{__scopeToast:n,altText:r,...i}=t;return g.jsx(Ct.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...i,ref:e})});function GG(t){const e=[];return Array.from(t.childNodes).forEach(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent&&e.push(r.textContent),f_e(r)){const i=r.ariaHidden||r.hidden||r.style.display==="none",o=r.dataset.radixToastAnnounceExclude==="";if(!i)if(o){const s=r.dataset.radixToastAnnounceAlt;s&&e.push(s)}else e.push(...GG(r))}}),e}function nS(t,e,n,{discrete:r}){const i=n.originalEvent.currentTarget,o=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:n});e&&i.addEventListener(t,e,{once:!0}),r?WA(i,o):i.dispatchEvent(o)}var k3=(t,e,n=0)=>{const r=Math.abs(t.x),i=Math.abs(t.y),o=r>i;return e==="left"||e==="right"?o&&r>n:!o&&i>n};function p_e(t=()=>{}){const e=wo(t);yc(()=>{let n=0,r=0;return n=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(n),window.cancelAnimationFrame(r)}},[e])}function f_e(t){return t.nodeType===t.ELEMENT_NODE}function g_e(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function CP(t){const e=document.activeElement;return t.some(n=>n===e?!0:(n.focus(),document.activeElement!==e))}var m_e=NG,y_e=BG,v_e=UG,x_e=HG,S_e=VG,I3=TM,YG="Toggle",XG=I.forwardRef((t,e)=>{const{pressed:n,defaultPressed:r,onPressedChange:i,...o}=t,[s,a]=ha({prop:n,onChange:i,defaultProp:r??!1,caller:YG});return g.jsx(Ct.button,{type:"button","aria-pressed":s,"data-state":s?"on":"off","data-disabled":t.disabled?"":void 0,...o,ref:e,onClick:Fe(t.onClick,()=>{t.disabled||a(!s)})})});XG.displayName=YG;var td="ToggleGroup",[ZG,JG]=Ms(td,[Bf]),QG=Bf(),EM=rt.forwardRef((t,e)=>{const{type:n,...r}=t;if(n==="single"){const i=r;return g.jsx(b_e,{...i,ref:e})}if(n==="multiple"){const i=r;return g.jsx(w_e,{...i,ref:e})}throw new Error(`Missing prop \`type\` expected on \`${td}\``)});EM.displayName=td;var[eY,tY]=ZG(td),b_e=rt.forwardRef((t,e)=>{const{value:n,defaultValue:r,onValueChange:i=()=>{},...o}=t,[s,a]=ha({prop:n,defaultProp:r??"",onChange:i,caller:td});return g.jsx(eY,{scope:t.__scopeToggleGroup,type:"single",value:rt.useMemo(()=>s?[s]:[],[s]),onItemActivate:a,onItemDeactivate:rt.useCallback(()=>a(""),[a]),children:g.jsx(nY,{...o,ref:e})})}),w_e=rt.forwardRef((t,e)=>{const{value:n,defaultValue:r,onValueChange:i=()=>{},...o}=t,[s,a]=ha({prop:n,defaultProp:r??[],onChange:i,caller:td}),l=rt.useCallback(d=>a((u=[])=>[...u,d]),[a]),c=rt.useCallback(d=>a((u=[])=>u.filter(p=>p!==d)),[a]);return g.jsx(eY,{scope:t.__scopeToggleGroup,type:"multiple",value:s,onItemActivate:l,onItemDeactivate:c,children:g.jsx(nY,{...o,ref:e})})});EM.displayName=td;var[k_e,I_e]=ZG(td),nY=rt.forwardRef((t,e)=>{const{__scopeToggleGroup:n,disabled:r=!1,rovingFocus:i=!0,orientation:o,dir:s,loop:a=!0,...l}=t,c=QG(n),d=lv(s),u={role:"group",dir:d,...l};return g.jsx(k_e,{scope:n,rovingFocus:i,disabled:r,children:i?g.jsx(sM,{asChild:!0,...c,orientation:o,dir:d,loop:a,children:g.jsx(Ct.div,{...u,ref:e})}):g.jsx(Ct.div,{...u,ref:e})})}),Fb="ToggleGroupItem",rY=rt.forwardRef((t,e)=>{const n=tY(Fb,t.__scopeToggleGroup),r=I_e(Fb,t.__scopeToggleGroup),i=QG(t.__scopeToggleGroup),o=n.value.includes(t.value),s=r.disabled||t.disabled,a={...t,pressed:o,disabled:s},l=rt.useRef(null);return r.rovingFocus?g.jsx(Y0,{asChild:!0,...i,focusable:!s,active:o,ref:l,children:g.jsx(_3,{...a,ref:e})}):g.jsx(_3,{...a,ref:e})});rY.displayName=Fb;var _3=rt.forwardRef((t,e)=>{const{__scopeToggleGroup:n,value:r,...i}=t,o=tY(Fb,n),s={role:"radio","aria-checked":t.pressed,"aria-pressed":void 0},a=o.type==="single"?s:void 0;return g.jsx(XG,{...a,...i,ref:e,onPressedChange:l=>{l?o.onItemActivate(r):o.onItemDeactivate(r)}})}),__e=EM,C_e=rY,AM="Toolbar",[P_e]=Ms(AM,[Bf,JG]),MM=Bf(),iY=JG(),[T_e,oY]=P_e(AM),sY=I.forwardRef((t,e)=>{const{__scopeToolbar:n,orientation:r="horizontal",dir:i,loop:o=!0,...s}=t,a=MM(n),l=lv(i);return g.jsx(T_e,{scope:n,orientation:r,dir:l,children:g.jsx(sM,{asChild:!0,...a,orientation:r,dir:l,loop:o,children:g.jsx(Ct.div,{role:"toolbar","aria-orientation":r,dir:l,...s,ref:e})})})});sY.displayName=AM;var aY="ToolbarSeparator",E_e=I.forwardRef((t,e)=>{const{__scopeToolbar:n,...r}=t,i=oY(aY,n);return g.jsx(DIe,{orientation:i.orientation==="horizontal"?"vertical":"horizontal",...r,ref:e})});E_e.displayName=aY;var A_e="ToolbarButton",OM=I.forwardRef((t,e)=>{const{__scopeToolbar:n,...r}=t,i=MM(n);return g.jsx(Y0,{asChild:!0,...i,focusable:!t.disabled,children:g.jsx(Ct.button,{type:"button",...r,ref:e})})});OM.displayName=A_e;var M_e="ToolbarLink",O_e=I.forwardRef((t,e)=>{const{__scopeToolbar:n,...r}=t,i=MM(n);return g.jsx(Y0,{asChild:!0,...i,focusable:!0,children:g.jsx(Ct.a,{...r,ref:e,onKeyDown:Fe(t.onKeyDown,o=>{o.key===" "&&o.currentTarget.click()})})})});O_e.displayName=M_e;var lY="ToolbarToggleGroup",cY=I.forwardRef((t,e)=>{const{__scopeToolbar:n,...r}=t,i=oY(lY,n),o=iY(n);return g.jsx(__e,{"data-orientation":i.orientation,dir:i.dir,...o,...r,ref:e,rovingFocus:!1})});cY.displayName=lY;var D_e="ToolbarToggleItem",uY=I.forwardRef((t,e)=>{const{__scopeToolbar:n,...r}=t,i=iY(n),o={__scopeToolbar:t.__scopeToolbar};return g.jsx(OM,{asChild:!0,...o,children:g.jsx(C_e,{...i,...r,ref:e})})});uY.displayName=D_e;var j_e=sY,R_e=OM,$_e=cY,N_e=uY,[r1]=Ms("Tooltip",[Ff]),i1=Ff(),dY="TooltipProvider",L_e=700,xE="tooltip.open",[z_e,DM]=r1(dY),hY=t=>{const{__scopeTooltip:e,delayDuration:n=L_e,skipDelayDuration:r=300,disableHoverableContent:i=!1,children:o}=t,s=I.useRef(!0),a=I.useRef(!1),l=I.useRef(0);return I.useEffect(()=>{const c=l.current;return()=>window.clearTimeout(c)},[]),g.jsx(z_e,{scope:e,isOpenDelayedRef:s,delayDuration:n,onOpen:I.useCallback(()=>{window.clearTimeout(l.current),s.current=!1},[]),onClose:I.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(()=>s.current=!0,r)},[r]),isPointerInTransitRef:a,onPointerInTransitChange:I.useCallback(c=>{a.current=c},[]),disableHoverableContent:i,children:o})};hY.displayName=dY;var xy="Tooltip",[F_e,o1]=r1(xy),pY=t=>{const{__scopeTooltip:e,children:n,open:r,defaultOpen:i,onOpenChange:o,disableHoverableContent:s,delayDuration:a}=t,l=DM(xy,t.__scopeTooltip),c=i1(e),[d,u]=I.useState(null),p=wl(),f=I.useRef(0),y=s??l.disableHoverableContent,v=a??l.delayDuration,x=I.useRef(!1),[b,w]=ha({prop:r,defaultProp:i??!1,onChange:O=>{O?(l.onOpen(),document.dispatchEvent(new CustomEvent(xE))):l.onClose(),o?.(O)},caller:xy}),_=I.useMemo(()=>b?x.current?"delayed-open":"instant-open":"closed",[b]),C=I.useCallback(()=>{window.clearTimeout(f.current),f.current=0,x.current=!1,w(!0)},[w]),A=I.useCallback(()=>{window.clearTimeout(f.current),f.current=0,w(!1)},[w]),E=I.useCallback(()=>{window.clearTimeout(f.current),f.current=window.setTimeout(()=>{x.current=!0,w(!0),f.current=0},v)},[v,w]);return I.useEffect(()=>()=>{f.current&&(window.clearTimeout(f.current),f.current=0)},[]),g.jsx(q0,{...c,children:g.jsx(F_e,{scope:e,contentId:p,open:b,stateAttribute:_,trigger:d,onTriggerChange:u,onTriggerEnter:I.useCallback(()=>{l.isOpenDelayedRef.current?E():C()},[l.isOpenDelayedRef,E,C]),onTriggerLeave:I.useCallback(()=>{y?A():(window.clearTimeout(f.current),f.current=0)},[A,y]),onOpen:C,onClose:A,disableHoverableContent:y,children:n})})};pY.displayName=xy;var SE="TooltipTrigger",fY=I.forwardRef((t,e)=>{const{__scopeTooltip:n,...r}=t,i=o1(SE,n),o=DM(SE,n),s=i1(n),a=I.useRef(null),l=hn(e,a,i.onTriggerChange),c=I.useRef(!1),d=I.useRef(!1),u=I.useCallback(()=>c.current=!1,[]);return I.useEffect(()=>()=>document.removeEventListener("pointerup",u),[u]),g.jsx(G0,{asChild:!0,...s,children:g.jsx(Ct.button,{"aria-describedby":i.open?i.contentId:void 0,"data-state":i.stateAttribute,...r,ref:l,onPointerMove:Fe(t.onPointerMove,p=>{p.pointerType!=="touch"&&!d.current&&!o.isPointerInTransitRef.current&&(i.onTriggerEnter(),d.current=!0)}),onPointerLeave:Fe(t.onPointerLeave,()=>{i.onTriggerLeave(),d.current=!1}),onPointerDown:Fe(t.onPointerDown,()=>{i.open&&i.onClose(),c.current=!0,document.addEventListener("pointerup",u,{once:!0})}),onFocus:Fe(t.onFocus,()=>{c.current||i.onOpen()}),onBlur:Fe(t.onBlur,i.onClose),onClick:Fe(t.onClick,i.onClose)})})});fY.displayName=SE;var B_e="TooltipPortal",[vHe,U_e]=r1(B_e,{forceMount:void 0}),yf="TooltipContent",gY=I.forwardRef((t,e)=>{const n=U_e(yf,t.__scopeTooltip),{forceMount:r=n.forceMount,side:i="top",...o}=t,s=o1(yf,t.__scopeTooltip);return g.jsx(pa,{present:r||s.open,children:s.disableHoverableContent?g.jsx(mY,{side:i,...o,ref:e}):g.jsx(H_e,{side:i,...o,ref:e})})}),H_e=I.forwardRef((t,e)=>{const n=o1(yf,t.__scopeTooltip),r=DM(yf,t.__scopeTooltip),i=I.useRef(null),o=hn(e,i),[s,a]=I.useState(null),{trigger:l,onClose:c}=n,d=i.current,{onPointerInTransitChange:u}=r,p=I.useCallback(()=>{a(null),u(!1)},[u]),f=I.useCallback((y,v)=>{const x=y.currentTarget,b={x:y.clientX,y:y.clientY},w=q_e(b,x.getBoundingClientRect()),_=G_e(b,w),C=Y_e(v.getBoundingClientRect()),A=Z_e([..._,...C]);a(A),u(!0)},[u]);return I.useEffect(()=>()=>p(),[p]),I.useEffect(()=>{if(l&&d){const y=x=>f(x,d),v=x=>f(x,l);return l.addEventListener("pointerleave",y),d.addEventListener("pointerleave",v),()=>{l.removeEventListener("pointerleave",y),d.removeEventListener("pointerleave",v)}}},[l,d,f,p]),I.useEffect(()=>{if(s){const y=v=>{const x=v.target,b={x:v.clientX,y:v.clientY},w=l?.contains(x)||d?.contains(x),_=!X_e(b,s);w?p():_&&(p(),c())};return document.addEventListener("pointermove",y),()=>document.removeEventListener("pointermove",y)}},[l,d,s,c,p]),g.jsx(mY,{...t,ref:o})}),[W_e,V_e]=r1(xy,{isInside:!1}),K_e=$be("TooltipContent"),mY=I.forwardRef((t,e)=>{const{__scopeTooltip:n,children:r,"aria-label":i,onEscapeKeyDown:o,onPointerDownOutside:s,...a}=t,l=o1(yf,n),c=i1(n),{onClose:d}=l;return I.useEffect(()=>(document.addEventListener(xE,d),()=>document.removeEventListener(xE,d)),[d]),I.useEffect(()=>{if(l.trigger){const u=p=>{p.target?.contains(l.trigger)&&d()};return window.addEventListener("scroll",u,{capture:!0}),()=>window.removeEventListener("scroll",u,{capture:!0})}},[l.trigger,d]),g.jsx(Nf,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:o,onPointerDownOutside:s,onFocusOutside:u=>u.preventDefault(),onDismiss:d,children:g.jsxs(iM,{"data-state":l.stateAttribute,...c,...a,ref:e,style:{...a.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[g.jsx(K_e,{children:r}),g.jsx(W_e,{scope:n,isInside:!0,children:g.jsx(Hbe,{id:l.contentId,role:"tooltip",children:i||r})})]})})});gY.displayName=yf;var yY="TooltipArrow",vY=I.forwardRef((t,e)=>{const{__scopeTooltip:n,...r}=t,i=i1(n);return V_e(yY,n).isInside?null:g.jsx(oM,{...i,...r,ref:e})});vY.displayName=yY;function q_e(t,e){const n=Math.abs(e.top-t.y),r=Math.abs(e.bottom-t.y),i=Math.abs(e.right-t.x),o=Math.abs(e.left-t.x);switch(Math.min(n,r,i,o)){case o:return"left";case i:return"right";case n:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function G_e(t,e,n=5){const r=[];switch(e){case"top":r.push({x:t.x-n,y:t.y+n},{x:t.x+n,y:t.y+n});break;case"bottom":r.push({x:t.x-n,y:t.y-n},{x:t.x+n,y:t.y-n});break;case"left":r.push({x:t.x+n,y:t.y-n},{x:t.x+n,y:t.y+n});break;case"right":r.push({x:t.x-n,y:t.y-n},{x:t.x-n,y:t.y+n});break}return r}function Y_e(t){const{top:e,right:n,bottom:r,left:i}=t;return[{x:i,y:e},{x:n,y:e},{x:n,y:r},{x:i,y:r}]}function X_e(t,e){const{x:n,y:r}=t;let i=!1;for(let o=0,s=e.length-1;o<e.length;s=o++){const a=e[o],l=e[s],c=a.x,d=a.y,u=l.x,p=l.y;d>r!=p>r&&n<(u-c)*(r-d)/(p-d)+c&&(i=!i)}return i}function Z_e(t){const e=t.slice();return e.sort((n,r)=>n.x<r.x?-1:n.x>r.x?1:n.y<r.y?-1:n.y>r.y?1:0),J_e(e)}function J_e(t){if(t.length<=1)return t.slice();const e=[];for(let r=0;r<t.length;r++){const i=t[r];for(;e.length>=2;){const o=e[e.length-1],s=e[e.length-2];if((o.x-s.x)*(i.y-s.y)>=(o.y-s.y)*(i.x-s.x))e.pop();else break}e.push(i)}e.pop();const n=[];for(let r=t.length-1;r>=0;r--){const i=t[r];for(;n.length>=2;){const o=n[n.length-1],s=n[n.length-2];if((o.x-s.x)*(i.y-s.y)>=(o.y-s.y)*(i.x-s.x))n.pop();else break}n.push(i)}return n.pop(),e.length===1&&n.length===1&&e[0].x===n[0].x&&e[0].y===n[0].y?e:e.concat(n)}var Q_e=hY,xY=pY,SY=fY,bY=gY,wY=vY;const Ml=I.memo(function({label:e,small:n,invertIcon:r,icon:i,color:o,className:s,...a}){return typeof i=="string"?g.jsx(eCe,{label:e,small:n,invertIcon:r,icon:i,color:o,className:s,...a}):I.cloneElement(i,{...a,className:Ye({"tlui-icon__small":n},s,i.props.className),"aria-label":e,style:{color:o,transform:r?"scale(-1, 1)":void 0,...i.props.style}})});function eCe({label:t,small:e,invertIcon:n,icon:r,color:i,className:o,...s}){const a=UA(),l=a.icons[r]??a.icons["question-mark-circle"],c=I.useRef(null);return I.useLayoutEffect(()=>{l||console.error(`Icon not found: ${r}. Add it to the assetUrls.icons object.`),c?.current&&(c.current.style.webkitMask=`url(${l}) center 100% / 100% no-repeat`)},[c,l,r]),r==="none"?g.jsx("div",{className:Ye("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":e},o),...s}):g.jsx("div",{...s,ref:c,"aria-label":t,role:"img",className:Ye("tlui-icon",{"tlui-icon__small":e},o),style:{color:i,mask:`url(${l}) center 100% / 100% no-repeat`,transform:n?"scale(-1, 1)":void 0}})}function it({icon:t,small:e,invertIcon:n}){return g.jsx(Ml,{"aria-hidden":"true",label:"",className:"tlui-button__icon",icon:t,small:e,invertIcon:n})}function s1({className:t,children:e}){return g.jsx("div",{className:Ye("tlui-dialog__header",t),children:e})}function a1({className:t,children:e,style:n}){return g.jsx(v0e,{dir:"ltr",className:Ye("tlui-dialog__header__title",t),style:n,children:e})}function l1(){const t=Ve();return g.jsx("div",{className:"tlui-dialog__header__close",children:g.jsx(kK,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:g.jsx(It,{type:"icon","aria-label":t("ui.close"),onTouchEnd:e=>e.target.click(),children:g.jsx(it,{small:!0,icon:"cross-2"})})})})}function Sy({className:t,children:e,style:n}){return g.jsx("div",{className:Ye("tlui-dialog__body",t),style:n,tabIndex:0,children:e})}function jM({className:t,children:e}){return g.jsx("div",{className:Ye("tlui-dialog__footer",t),children:e})}const Hf=I.forwardRef(function({className:e,label:n,icon:r,iconLeft:i,iconLabel:o,autoSelect:s=!1,autoFocus:a=!1,defaultValue:l,placeholder:c,onComplete:d,onValueChange:u,onCancel:p,onFocus:f,onBlur:y,shouldManuallyMaintainScrollPositionWhenFocused:v=!1,children:x,value:b,"data-testid":w,disabled:_,"aria-label":C},A){const E=hr(),O=I.useRef(null);I.useImperativeHandle(A,()=>O.current);const D=Ve(),B=I.useRef(l??""),L=I.useRef(l??""),j=I.useRef(!1),[F,z]=I.useState(!1),$=I.useCallback(N=>{z(!0);const H=N.currentTarget;L.current=H.value,E?E.timers.requestAnimationFrame(()=>{s&&H.select()}):yb.requestAnimationFrame("anon",()=>{s&&H.select()}),f?.()},[s,E,f]),V=I.useCallback(N=>{const H=N.currentTarget.value;L.current=H,u?.(H)},[u]),Y=I.useCallback(N=>{switch(N.key){case"Enter":{if(j.current)return;N.currentTarget.blur(),N.stopPropagation(),d?.(N.currentTarget.value);break}case"Escape":{N.currentTarget.value=B.current,p?.(N.currentTarget.value),N.currentTarget.blur(),N.stopPropagation();break}}},[d,p]),re=I.useCallback(N=>{z(!1);const H=N.currentTarget.value;y?.(H)},[y]),q=I.useCallback(()=>j.current=!0,[]),X=I.useCallback(()=>j.current=!1,[]);return I.useEffect(()=>{if(!Jt.isIos)return;const N=window.visualViewport;if(F&&v&&N){const H=()=>{O.current?.scrollIntoView({block:"center"})};return N.addEventListener("resize",H),N.addEventListener("scroll",H),E?E.timers.requestAnimationFrame(()=>{O.current?.scrollIntoView({block:"center"})}):yb.requestAnimationFrame("anon",()=>{O.current?.scrollIntoView({block:"center"})}),()=>{N.removeEventListener("resize",H),N.removeEventListener("scroll",H)}}},[F,E,v]),g.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[x,n&&g.jsx("label",{children:D(n)}),i&&g.jsx(Ml,{label:o?D(o):"",icon:i,className:"tlui-icon-left",small:!0}),g.jsx("input",{ref:O,className:Ye("tlui-input",e),type:"text",defaultValue:l,onKeyDownCapture:Y,onChange:V,onFocus:$,onBlur:re,onCompositionStart:q,onCompositionEnd:X,autoFocus:a,"aria-label":C,placeholder:c,value:b,"data-testid":w,disabled:_}),r&&g.jsx(Ml,{label:o?D(o):"",icon:r,small:!!n})]})});function C3(t){return Cs.isValid(t)?{isValid:!0,hasProtocol:!0}:Cs.isValid("https://"+t)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const tCe=_r(function({onClose:e}){const r=ne().getOnlySelectedShape();return r&&"url"in r.props&&typeof r.props.url=="string"?g.jsx(nCe,{onClose:e,selectedShape:r}):null}),nCe=_r(function({onClose:e,selectedShape:n}){const r=ne(),i=Ve(),o=I.useRef(null);I.useEffect(()=>{r.timers.requestAnimationFrame(()=>o.current?.focus())},[r]);const s=I.useRef(n.props.url),[a,l]=I.useState(()=>{const y=C3(n.props.url),v=y.isValid===!0?y.hasProtocol?n.props.url:"https://"+n.props.url:"https://";return{actual:v,safe:v,valid:!0}}),c=I.useCallback(y=>{const v=y.replace(/https?:\/\/(https?:\/\/)/,(w,_)=>_),x=C3(v),b=x.isValid===!0?x.hasProtocol?v:"https://"+v:"https://";l({actual:v,safe:b,valid:x.isValid})},[]),d=I.useCallback(()=>{const y=r.getOnlySelectedShape();y&&(r.updateShapes([{id:y.id,type:y.type,props:{url:""}}]),e())},[r,e]),u=I.useCallback(()=>{const y=r.getOnlySelectedShape();y&&(y&&"url"in y.props&&y.props.url!==a.safe&&r.updateShapes([{id:y.id,type:y.type,props:{url:a.safe}}]),e())},[r,e,a]),p=I.useCallback(()=>{e()},[e]);if(!n)return e(),null;const f=s.current&&!a.valid;return g.jsxs(g.Fragment,{children:[g.jsxs(s1,{children:[g.jsx(a1,{children:i("edit-link-dialog.title")}),g.jsx(l1,{})]}),g.jsx(Sy,{children:g.jsxs("div",{className:"tlui-edit-link-dialog",children:[g.jsx(Hf,{ref:o,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,autoSelect:!0,placeholder:"https://example.com",value:a.actual,onValueChange:c,onComplete:u,onCancel:p}),g.jsx("div",{children:a.valid?i("edit-link-dialog.detail"):i("edit-link-dialog.invalid-url")})]})}),g.jsxs(jM,{className:"tlui-dialog__footer__actions",children:[g.jsx(It,{type:"normal",onClick:p,onTouchEnd:p,children:g.jsx(dr,{children:i("edit-link-dialog.cancel")})}),f?g.jsx(It,{type:"danger",onTouchEnd:d,onClick:d,children:g.jsx(dr,{children:i("edit-link-dialog.clear")})}):g.jsx(It,{type:"primary",disabled:!a.valid,onTouchEnd:u,onClick:u,children:g.jsx(dr,{children:i("edit-link-dialog.save")})})]})]})});var rCe={};const P3=/(^\/[f|p|r|ro|s|v]\/[^/]+\/?$)/,RM=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:t=>{const e=ht(t);if(e&&e.pathname.match(P3))return e.searchParams.append("embed","true"),t},fromEmbedUrl:t=>{const e=ht(t);if(e&&e.pathname.match(P3))return e.searchParams.delete("embed"),t},embedOnPaste:!1},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:t=>{if(t.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto|design)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!t.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${t}`},fromEmbedUrl:t=>{const e=ht(t);if(e&&e.pathname.match(/^\/embed\/?$/)){const n=e.searchParams.get("url");if(n)return n}},embedOnPaste:!0},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:t=>{if(t.includes("/maps/embed?"))return t;if(t.includes("/maps/")){const e=t.match(/@(.*?),(.*?),(.*?)(z|m)/);let n;if(e){const[,r,i,o,s]=e,a=s==="z"?"roadmap":"satellite",l=a==="roadmap"?o:-Math.log2(parseInt(o)/14772321)/.8;n=`https://${new URL(t).host.replace("www.","")}/maps/embed/v1/view?key=${rCe.NEXT_PUBLIC_GC_API_KEY}&center=${r},${i}&zoom=${l}&maptype=${a}`}else n="";return n}},fromEmbedUrl:t=>{const e=ht(t);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const r=e.searchParams.get("zoom")??"12",i=e.searchParams.get("maptype")??"roadmap",o=i==="roadmap"?r:14772321*Math.pow(2,parseInt(r)*-.8),[s,a]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${s},${a},${o}${i==="roadmap"?"z":"m"}`}},embedOnPaste:!0},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=ht(t),n=e&&e.pathname.match(/\/v\/(.+)\/?/);if(n)return`https://www.val.town/embed/${n[1]}`},fromEmbedUrl:t=>{const e=ht(t),n=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(n)return`https://www.val.town/v/${n[1]}`},embedOnPaste:!0},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=ht(t),n=e&&e.pathname.match(/\/s\/([^/]+)\/?/);if(n)return`https://codesandbox.io/embed/${n[1]}`},fromEmbedUrl:t=>{const e=ht(t),n=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://codesandbox.io/s/${n[1]}`},embedOnPaste:!0},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:t=>{const e=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,n=t.match(e);if(n){const[r,i,o]=n;return`https://codepen.io/${i}/embed/${o}`}},fromEmbedUrl:t=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,n=t.match(e);if(n){const[r,i,o]=n;return`https://codepen.io/${i}/pen/${o}`}},embedOnPaste:!0},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,embedOnPaste:!0,toEmbedUrl:t=>{const e=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,n=t.match(e);if(n){const[r,i]=n;return`https://scratch.mit.edu/projects/embed/${i}`}},fromEmbedUrl:t=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,n=t.match(e);if(n){const[r,i]=n;return`https://scratch.mit.edu/projects/${i}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,embedOnPaste:!0,toEmbedUrl:t=>{const e=ht(t);if(!e)return;const n=e.hostname.replace(/^www./,"");if(n==="youtu.be"){const r=e.pathname.split("/").filter(Boolean)[0],i=new URLSearchParams(e.search),o=i.get("t");o&&(i.set("start",o),i.delete("t"));const s=i.toString()?"?"+i.toString():"";return`https://www.youtube.com/embed/${r}${s}`}else if((n==="youtube.com"||n==="m.youtube.com")&&e.pathname.match(/^\/watch/)){const r=e.searchParams.get("v"),i=new URLSearchParams(e.search);i.delete("v");const o=i.get("t");o&&(i.set("start",o),i.delete("t"));const s=i.toString()?"?"+i.toString():"";return`https://www.youtube.com/embed/${r}${s}`}},fromEmbedUrl:t=>{const e=ht(t);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const r=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(r){const i=new URLSearchParams(e.search);i.set("v",r?.[1]??"");const o=i.get("start");return o&&(i.set("t",o),i.delete("start")),`https://www.youtube.com/watch?${i.toString()}`}}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},embedOnPaste:!0,toEmbedUrl:t=>{const e=ht(t),n=e?.searchParams.get("cid");if(e?.pathname.match(/\/calendar\/u\/0/)&&n){e.pathname="/calendar/embed";const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.searchParams.set("src",n),e.href}},fromEmbedUrl:t=>{const e=ht(t),n=e?.searchParams.get("src");if(e?.pathname.match(/\/calendar\/embed/)&&n){e.pathname="/calendar/u/0";const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.searchParams.set("cid",n),e.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},embedOnPaste:!0,toEmbedUrl:t=>{const e=ht(t);if(e?.pathname.match(/^\/presentation/)&&e?.pathname.match(/\/pub\/?$/)){e.pathname=e.pathname.replace(/\/pub$/,"/embed");const n=Array.from(e.searchParams.keys());for(const r of n)e.searchParams.delete(r);return e.href}},fromEmbedUrl:t=>{const e=ht(t);if(e?.pathname.match(/^\/presentation/)&&e?.pathname.match(/\/embed\/?$/)){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const n=Array.from(e.searchParams.keys());for(const r of n)e.searchParams.delete(r);return e.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,embedOnPaste:!0,toEmbedUrl:t=>{const e=ht(t);if(e&&e.pathname.match(/\/([^/]+)\/([0-9a-f]+)$/))return t.split("/").pop()?t:void 0},fromEmbedUrl:t=>{const e=ht(t);if(e&&e.pathname.match(/\/([^/]+)\/([0-9a-f]+)$/))return t.split("/").pop()?t:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,embedOnPaste:!0,toEmbedUrl:t=>{const e=ht(t);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${t}?embed=true`},fromEmbedUrl:t=>{const e=ht(t);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,embedOnPaste:!0,toEmbedUrl:t=>{const e=ht(t);if(e&&e.pathname.match(/^\/map\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:t=>{const e=ht(t);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,embedOnPaste:!0,toEmbedUrl:t=>{const e=ht(t);if(e&&e.pathname.match(/^\/(artist|album)\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:t=>{const e=ht(t);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,embedOnPaste:!0,toEmbedUrl:t=>{const e=ht(t);if(e&&e.hostname==="vimeo.com"&&e.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+e.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:t=>{const e=ht(t);if(e&&e.hostname==="player.vimeo.com"){const n=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(n)return"https://vimeo.com/"+n[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!0,embedOnPaste:!0,toEmbedUrl:t=>{const e=ht(t);if(e&&e.hash.match(/#room=/))return t},fromEmbedUrl:t=>{const e=ht(t);if(e&&e.hash.match(/#room=/))return t}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",embedOnPaste:!0,toEmbedUrl:t=>{const e=ht(t);if(e&&e.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}/embed${e.pathname}?cell=*`;if(e&&e.pathname.match(/^\/d\/([^/]+)\/?$/)){const n=e.pathname.replace(/^\/d/,"");return`${e.origin}/embed${n}?cell=*`}},fromEmbedUrl:t=>{const e=ht(t);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,embedOnPaste:!0,toEmbedUrl:t=>{const e=ht(t);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search===""&&e.hash==="")return`${t}?embed`},fromEmbedUrl:t=>{const e=ht(t);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return t.replace("?embed","")}}],iCe={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},oCe=RM.map(t=>t.type);function sCe(t){return oCe.includes(t)}function aCe(t){return"icon"in t}function kY(){const t=hr();if(t&&t.hasShapeUtil("embed"))return t.getShapeUtil("embed")}function $M(){const t=kY();return e=>t?t.getEmbedDefinition(e):void 0}function lCe(){const t=kY();return t?t.getEmbedDefinitions():[]}const IY=_r(function({onClose:e}){const n=ne(),r=Ve(),i=UA(),[o,s]=I.useState(null),[a,l]=I.useState(""),[c,d]=I.useState(null),[u,p]=I.useState(!1),f=I.useRef(-1),y=lCe(),v=$M();return g.jsxs(g.Fragment,{children:[g.jsxs(s1,{children:[g.jsx(a1,{children:o?`${r("embed-dialog.title")} — ${o.title}`:r("embed-dialog.title")}),g.jsx(l1,{})]}),o?g.jsxs(g.Fragment,{children:[g.jsxs(Sy,{className:"tlui-embed-dialog__enter",children:[g.jsx(Hf,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"https://example.com",autoFocus:!0,onValueChange:x=>{l(x);const b=v(x);d(b&&b.definition.type===o.type?b:null),p(!1),clearTimeout(f.current),f.current=n.timers.setTimeout(()=>p(!b),320)}}),a===""?g.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[g.jsx("span",{children:r("embed-dialog.instruction")})," ",o.instructionLink&&g.jsxs(g.Fragment,{children:[g.jsx("a",{target:"_blank",rel:"noopener noreferrer",href:o.instructionLink,className:"tlui-embed-dialog__instruction__link",children:"Learn more"}),"."]})]}):g.jsx("div",{className:"tlui-embed-dialog__warning",children:u?r("embed-dialog.invalid-url"):" "})]}),g.jsxs(jM,{className:"tlui-dialog__footer__actions",children:[g.jsx(It,{type:"normal",onClick:()=>{s(null),d(null),l("")},children:g.jsx(dr,{children:r("embed-dialog.back")})}),g.jsx("div",{className:"tlui-embed__spacer"}),g.jsx(It,{type:"normal",onClick:e,children:g.jsx(dr,{children:r("embed-dialog.cancel")})}),g.jsx(It,{type:"primary",disabled:!c,onClick:()=>{c&&(n.putExternalContent({type:"embed",url:a,point:n.getViewportPageBounds().center,embed:c.definition}),e())},children:g.jsx(dr,{children:r("embed-dialog.create")})})]})]}):g.jsx(g.Fragment,{children:g.jsx(Sy,{className:"tlui-embed-dialog__list",children:y.map(x=>{const b=sCe(x.type)?i.embedIcons[x.type]:aCe(x)?x.icon:void 0;return g.jsxs(It,{type:"menu",onClick:()=>s(x),children:[g.jsx(dr,{children:x.title}),b&&g.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${b})`}})]},x.type)})})})]})}),KS=[0,389,436,476,580,640,840,1023];var nr=(t=>(t[t.ZERO=0]="ZERO",t[t.MOBILE_XXS=1]="MOBILE_XXS",t[t.MOBILE_XS=2]="MOBILE_XS",t[t.MOBILE_SM=3]="MOBILE_SM",t[t.MOBILE=4]="MOBILE",t[t.TABLET_SM=5]="TABLET_SM",t[t.TABLET=6]="TABLET",t[t.DESKTOP=7]="DESKTOP",t))(nr||{});const _Y=rt.createContext(null);function cCe({forceMobile:t=!1,children:e}){const n=hr(),r=J("breakpoint",()=>{const{width:i}=n?.getViewportScreenBounds()??{width:window.innerWidth},o=t?nr.MOBILE_SM:KS.length-1;for(let s=0;s<o;s++)if(i>KS[s]&&i<=KS[s+1])return s;return o},[n]);return g.jsx(_Y.Provider,{value:r,children:e})}function Ci(){const t=I.useContext(_Y);if(t===null)throw new Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return t}const CY=I.createContext(null);function c1(){const t=I.useContext(CY);if(!t)throw new Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return t}function qi({type:t,sourceId:e,children:n}){return g.jsx(CY.Provider,{value:{type:t,sourceId:e},children:n})}function u1(){return hr()?.store.props.collaboration!==void 0}function uCe(){const t=hr();return J("sync status",()=>t?.store.props.collaboration?.status?t.store.props.collaboration.status.get():null,[t])}function Os(){const t=hr();return J("isReadonlyMode",()=>!!t?.getIsReadonly(),[t])}const T3=Jt.isDarwin?"⌘":"__CTRL__",dCe=Jt.isDarwin?"⌃":"__CTRL__",E3=Jt.isDarwin?"⌥":"__ALT__";function PY(t){return t===","?[","]:t.split(",")[0].split(/(\[\[[^\]]+\]\])/g).map(e=>e.startsWith("[[")?e.replace(/[[\]]/g,""):e.replace(/cmd\+/g,T3).replace(/ctrl\+/g,dCe).replace(/alt\+/g,E3).replace(/shift\+/g,"⇧").replace(/\$/g,T3).replace(/\?/g,E3).replace(/!/g,"⇧").match(/__CTRL__|__ALT__|./g)||[]).flat().map((e,n)=>{if(e[0]==="+")return[];let r;return e==="__CTRL__"?r="Ctrl":e==="__ALT__"?r="Alt":r=e[0].toUpperCase()+e.slice(1),Jt.isDarwin||!n?r:["+",r]}).flat()}function Bb(t){return"— "+PY(t).join(" ")}function TY(t){const e=Ve();return g.jsx(H7,{"aria-label":e("app.loading"),...t})}const EY=()=>{},AY=I.createContext(null);function hCe({onEvent:t,children:e}){return g.jsx(AY.Provider,{value:t??EY,children:e})}function qn(){return I.useContext(AY)??EY}function _c(t,e){const n=hr(),r=I.useCallback(s=>{s&&n?.complete(),e?.(s)},[n,e]),i=qn(),o=I.useCallback(s=>{i(s,{source:"unknown",id:t})},[t,i]);return pme(n?`${t}-${n.contextId}`:t,r,o)}function d1({id:t,children:e,modal:n=!1,debugOpen:r=!1}){const[i,o]=_c(t);return g.jsx(yM,{open:r||i,dir:"ltr",modal:n,onOpenChange:o,children:e})}function h1({children:t,...e}){return g.jsx(vM,{dir:"ltr",asChild:!0,onTouchEnd:n=>dt(n),...e,children:t})}function p1({className:t,side:e="bottom",align:n="start",sideOffset:r=8,alignOffset:i=8,children:o}){const s=Cr();return g.jsx(Q0,{container:s,children:g.jsx(xM,{className:Ye("tlui-menu",t),side:e,sideOffset:r,align:n,alignOffset:i,collisionPadding:4,children:o})})}function pCe({id:t,children:e}){const[n,r]=_c(t);return g.jsx(yIe,{open:n,onOpenChange:r,children:e})}function fCe({id:t,label:e,title:n,disabled:r}){return g.jsx(vIe,{dir:"ltr",asChild:!0,disabled:r,children:g.jsxs(It,{"data-testid":t,type:"menu",className:"tlui-menu__submenu__trigger",disabled:r,title:n,children:[g.jsx(dr,{children:e}),g.jsx(it,{icon:"chevron-right",small:!0})]})})}function gCe({id:t,alignOffset:e=-1,sideOffset:n=-6,size:r="small",children:i}){const o=Cr();return g.jsx(Q0,{container:o,children:g.jsx(xIe,{"data-testid":t,className:"tlui-menu tlui-menu__submenu__content",alignOffset:e,sideOffset:n,collisionPadding:4,"data-size":r,children:i})})}function mCe({className:t,children:e}){return g.jsx("div",{dir:"ltr",className:Ye("tlui-menu__group",t),children:e})}function yCe({noClose:t,children:e}){return g.jsx(gIe,{dir:"ltr",asChild:!0,onClick:t?dt:void 0,children:e})}function vCe({children:t,onSelect:e,...n}){const r=Ve();return g.jsxs(cG,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:i=>{e?.(i),dt(i)},...n,children:[g.jsx("div",{className:"tlui-button__checkbox__indicator",children:g.jsx(mIe,{dir:"ltr",children:g.jsx(Ml,{label:r("ui.checked"),icon:"check",small:!0})})}),t]})}function Nm({children:t,visibleOnMobileLayout:e=!1}){const n=Ci();return!e&&n<nr.MOBILE?null:g.jsx("kbd",{className:"tlui-kbd",children:PY(t).map((r,i)=>g.jsx("span",{children:r},i))})}const MY=I.createContext({orientation:"horizontal",tooltipSide:"bottom"});function f1({children:t,orientation:e,tooltipSide:n}){const r=yv(),i=n??(e===r.orientation?r.tooltipSide:e==="horizontal"?"bottom":"right");return g.jsx(MY.Provider,{value:{orientation:e,tooltipSide:i},children:t})}function yv(){return I.useContext(MY)}const Eh=I.forwardRef(({asChild:t,className:e,tooltipSide:n,...r},i)=>{const o=t?HA:"div";return g.jsx(f1,{orientation:"horizontal",tooltipSide:n,children:g.jsx(o,{ref:i,className:Ye("tlui-row",e),...r})})}),NM=I.forwardRef(({asChild:t,className:e,tooltipSide:n,...r},i)=>{const o=t?HA:"div";return g.jsx(f1,{orientation:"vertical",tooltipSide:n,children:g.jsx(o,{ref:i,className:Ye("tlui-column",e),...r})})}),g1=I.forwardRef(({asChild:t,className:e,tooltipSide:n,...r},i)=>{const o=t?HA:"div";return g.jsx(f1,{orientation:"horizontal",tooltipSide:n,children:g.jsx(o,{ref:i,className:Ye("tlui-grid",e),...r})})}),xCe=700;class Fp{static instance=null;currentTooltip=qt("current tooltip",null);destroyTimeoutId=null;static getInstance(){return Fp.instance||(Fp.instance=new Fp),Fp.instance}showTooltip(e,n,r,i,o,s,a){this.destroyTimeoutId&&(clearTimeout(this.destroyTimeoutId),this.destroyTimeoutId=null),this.currentTooltip.set({id:e,content:n,side:i,sideOffset:o,showOnMobile:s,targetElement:r,delayDuration:a})}updateCurrentTooltip(e,n){this.currentTooltip.update(r=>r?.id===e?n(r):r)}hideTooltip(e,n,r=!1){const i=()=>{this.currentTooltip.get()?.id===n&&(this.currentTooltip.set(null),this.destroyTimeoutId=null)};e&&!r?this.destroyTimeoutId=e.timers.setTimeout(i,300):i()}hideAllTooltips(){this.currentTooltip.set(null),this.destroyTimeoutId=null}getCurrentTooltipData(){const e=this.currentTooltip.get();return!e||!this.supportsHover()&&!e.showOnMobile?null:e}supportsHoverAtom=null;supportsHover(){if(!this.supportsHoverAtom){const e=window.matchMedia("(hover: hover)"),n=qt("has hover",e.matches);this.supportsHoverAtom=n,e.addEventListener("change",r=>{n.set(r.matches)})}return this.supportsHoverAtom.get()}}const Js=Fp.getInstance(),OY=I.createContext(!1);function SCe({children:t}){return g.jsx(Q_e,{skipDelayDuration:700,children:g.jsxs(OY.Provider,{value:!0,children:[t,g.jsx(bCe,{})]})})}function bCe(){const[t,e]=I.useState(!1),n=I.useRef(null),r=I.useRef(!0),i=hr(),o=J("current tooltip",()=>Js.getCurrentTooltipData(),[]),s=J("camera state",()=>i?.getCameraState(),[i]);return I.useEffect(()=>{s==="moving"&&t&&o&&Js.hideTooltip(i,o.id,!0)},[s,t,o,i]),I.useEffect(()=>{function a(l){l.key==="Escape"&&o&&t&&(Js.hideTooltip(i,o.id),l.stopPropagation())}return document.addEventListener("keydown",a,{capture:!0}),()=>{document.removeEventListener("keydown",a,{capture:!0})}},[i,o,t]),I.useEffect(()=>{let a=null;if(o&&n.current){const l=o.targetElement.getBoundingClientRect(),c=n.current;c.style.position="fixed",c.style.left=`${l.left}px`,c.style.top=`${l.top}px`,c.style.width=`${l.width}px`,c.style.height=`${l.height}px`,c.style.pointerEvents="none",c.style.zIndex="9999",r.current?a=setTimeout(()=>{e(!0),r.current=!1},o.delayDuration):e(!0)}else e(!1),r.current=!0;return()=>{a!==null&&clearTimeout(a)}},[o]),o?g.jsxs(xY,{open:t,delayDuration:0,children:[g.jsx(SY,{asChild:!0,children:g.jsx("div",{ref:n})}),g.jsxs(bY,{className:"tlui-tooltip",side:o.side,sideOffset:o.sideOffset,avoidCollisions:!0,collisionPadding:8,dir:"ltr",children:[o.content,g.jsx(wY,{className:"tlui-tooltip__arrow"})]})]}):null}const m1=I.forwardRef(({children:t,content:e,side:n,sideOffset:r=5,disabled:i=!1,showOnMobile:o=!1,delayDuration:s},a)=>{const l=hr(),c=I.useRef(Qt()),d=I.useContext(OY),u=J("enhancedA11yMode",()=>l?.user.getEnhancedA11yMode(),[l]),p=yv(),f=n??p.tooltipSide;if(I.useEffect(()=>{const A=c.current;return()=>{d&&Js.hideTooltip(l,A,!0)}},[l,d]),I.useLayoutEffect(()=>{d&&Js.getCurrentTooltipData()?.id===c.current&&Js.updateCurrentTooltip(c.current,A=>({...A,content:e,side:f,sideOffset:r,showOnMobile:o}))},[e,f,r,o,d]),i||!e)return g.jsx(g.Fragment,{children:t});let y;if(u?y=0:y=s??(l?.options.tooltipDelayMs||xCe),!d||u)return g.jsxs(xY,{delayDuration:y,disableHoverableContent:!u,children:[g.jsx(SY,{asChild:!0,ref:a,children:t}),g.jsxs(bY,{className:"tlui-tooltip",side:f,sideOffset:r,avoidCollisions:!0,collisionPadding:8,dir:"ltr",children:[e,g.jsx(wY,{className:"tlui-tooltip__arrow"})]})]});const v=rt.Children.only(t);Ge(rt.isValidElement(v),"TldrawUiTooltip children must be a single element");const x=A=>{v.props.onMouseEnter?.(A),Js.showTooltip(c.current,e,A.currentTarget,f,r,o,y)},b=A=>{v.props.onMouseLeave?.(A),Js.hideTooltip(l,c.current)},w=A=>{v.props.onFocus?.(A),Js.showTooltip(c.current,e,A.currentTarget,f,r,o,y)},_=A=>{v.props.onBlur?.(A),Js.hideTooltip(l,c.current)};return rt.cloneElement(t,{onMouseEnter:x,onMouseLeave:b,onFocus:w,onBlur:_})}),wCe={horizontal:Eh,vertical:NM,grid:g1},ko=rt.forwardRef(({children:t,className:e,label:n,orientation:r="horizontal",tooltipSide:i,...o},s)=>{const a=wCe[r];return g.jsx(a,{asChild:!0,tooltipSide:i,children:g.jsx(j_e,{ref:s,...o,className:Ye("tlui-toolbar",e),"aria-label":n,orientation:r==="grid"?"horizontal":r,children:t})})}),vn=rt.forwardRef(({asChild:t,children:e,type:n,isActive:r,tooltip:i,...o},s)=>{const a=g.jsx(R_e,{ref:s,asChild:t,draggable:!1,"data-isactive":r,...o,"aria-label":o.title,title:void 0,className:Ye("tlui-button",`tlui-button__${n}`,o.className),children:e}),l=i||o.title;return g.jsx(m1,{content:l,children:a})}),kCe=({children:t,className:e,type:n,asChild:r,...i})=>g.jsx($_e,{asChild:r,type:n,...i,role:"radiogroup",className:Ye("tlui-toolbar-toggle-group",e),children:t}),ICe=({children:t,className:e,type:n,value:r,tooltip:i,...o})=>{const s=g.jsx(N_e,{...o,title:void 0,className:Ye("tlui-button",`tlui-button__${n}`,"tlui-toolbar-toggle-group-item",e),value:r,children:t}),a=i||o.title;return g.jsx(m1,{content:a,children:s})};function $t({disabled:t=!1,spinner:e=!1,readonlyOk:n=!1,id:r,kbd:i,label:o,icon:s,iconLeft:a,onSelect:l,noClose:c,isSelected:d,onDragStart:u}){const{type:p,sourceId:f}=c1(),y=Ve(),[v,x]=I.useState(!1);if(Os()&&!n)return null;const w=_y(o,p),_=i?Bb(i):void 0,C=w?y(w):void 0,A=C&&_?`${C} ${_}`:C;switch(p){case"menu":return g.jsx(yCe,{children:g.jsxs(It,{type:"menu","data-testid":`${f}.${r}`,disabled:t,onClick:E=>{c&&dt(E),v?x(!1):l(f)},children:[a&&g.jsx(it,{icon:a,small:!0}),g.jsx(dr,{children:C}),i&&g.jsx(Nm,{children:i})]})});case"context-menu":return t?null:g.jsxs(Kke,{dir:"ltr",draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${f}.${r}`,onSelect:E=>{c&&dt(E),v?x(!1):l(f)},children:[g.jsx("span",{className:"tlui-button__label",draggable:!1,children:C}),a&&g.jsx(it,{icon:a,small:!0}),i&&g.jsx(Nm,{children:i}),e&&g.jsx(TY,{})]});case"small-icons":case"icons":return g.jsx(vn,{"data-testid":`${f}.${r}`,type:"icon",title:A,disabled:t,onClick:()=>l(f),children:g.jsx(it,{icon:s,small:!0})});case"keyboard-shortcuts":return i?g.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${f}.${r}`,children:[g.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:C}),g.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:g.jsx(Nm,{visibleOnMobileLayout:!0,children:i})})]}):(console.warn(`Menu item '${o}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null);case"helper-buttons":return g.jsxs(It,{type:"low",onClick:()=>l(f),children:[g.jsx(it,{icon:s}),g.jsx(dr,{children:C})]});case"toolbar":return u?g.jsx(A3,{id:r,icon:s,onSelect:l,onDragStart:u,labelStr:C,titleStr:A,disabled:t,isSelected:d}):g.jsx(vn,{"aria-label":C,"aria-pressed":d?"true":"false","data-testid":`tools.${r}`,"data-value":r,disabled:t,onClick:()=>l("toolbar"),onTouchStart:E=>{dt(E),l("toolbar")},title:A,type:"tool",children:g.jsx(it,{icon:s})});case"toolbar-overflow":return u?g.jsx(A3,{id:r,icon:s,onSelect:l,onDragStart:u,labelStr:C,titleStr:A,disabled:t,isSelected:d,overflow:!0}):g.jsx(vn,{"aria-label":C,"aria-pressed":d?"true":"false",isActive:d,"data-testid":`tools.more.${r}`,"data-value":r,disabled:t,onClick:()=>l("toolbar"),title:A,type:"icon",children:g.jsx(it,{icon:s})});default:throw Wt(p)}}function _Ce(t,e){const n=ne();return I.useMemo(()=>{let i={name:"idle"};function o(c){i={name:"pointing",screenSpaceStart:{x:c.clientX,y:c.clientY}},c.currentTarget.setPointerCapture(c.pointerId)}function s(c){if(!c.isSpecialRedispatchedEvent&&i.name==="pointing"&&T.Dist2(i.screenSpaceStart,{x:c.clientX,y:c.clientY})>(n.getInstanceState().isCoarsePointer?n.options.uiCoarseDragDistanceSquared:n.options.uiDragDistanceSquared)){const u=i.screenSpaceStart;i={name:"dragging",screenSpaceStart:u},n.run(()=>{n.setCurrentTool("select"),n.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...Hi(n,c),point:u}),n.selectNone(),t?.("toolbar",{type:"pointer",target:"canvas",name:"pointer_move",...Hi(n,c),point:u}),Js.hideAllTooltips(),n.getContainer().focus()})}}function a(c){c.isSpecialRedispatchedEvent||(c.currentTarget.releasePointerCapture(c.pointerId),n.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...Hi(n,c)}))}function l(){if(i.name==="dragging"||i.name==="dragged")return i={name:"idle"},!0;i={name:"idle"},e?.("toolbar")}return{onPointerDown:o,onPointerMove:s,onPointerUp:a,onClick:l}},[t,n,e])}function A3({id:t,labelStr:e,titleStr:n,disabled:r,isSelected:i,icon:o,onSelect:s,onDragStart:a,overflow:l}){const c=_Ce(a,s);return l?g.jsx(vn,{"aria-label":e,"aria-pressed":i?"true":"false",isActive:i,className:"tlui-button-grid__button","data-testid":`tools.more.${t}`,"data-value":t,disabled:r,title:n,type:"icon",...c,children:g.jsx(it,{icon:o})}):g.jsx(vn,{"aria-label":e,"aria-pressed":i?"true":"false","data-testid":`tools.${t}`,"data-value":t,disabled:r,onTouchStart:d=>{dt(d),s("toolbar")},title:n,type:"tool",...c,children:g.jsx(it,{icon:o})})}function me({actionId:t="",...e}){const r=Fl()[t];return r?g.jsx($t,{...r,...e}):null}function bt({id:t,label:e,className:n,children:r}){const i=c1(),{orientation:o}=yv(),s=Ve(),a=_y(e,i.type),l=a?s(a):void 0;switch(i.type){case"menu":return g.jsx(mCe,{className:n,"data-testid":`${i.sourceId}-group.${t}`,children:r});case"context-menu":return g.jsx("div",{dir:"ltr",className:Ye("tlui-menu__group",n),"data-testid":`${i.sourceId}-group.${t}`,children:r});case"keyboard-shortcuts":return g.jsxs("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${i.sourceId}-group.${t}`,children:[g.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:l}),g.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:r})]});case"toolbar":{const c=o==="horizontal"?Eh:NM;return g.jsx(c,{className:"tlui-main-toolbar__group","data-testid":`${i.sourceId}-group.${t}`,children:r})}case"toolbar-overflow":return g.jsx(g1,{className:"tlui-main-toolbar__group","data-testid":`${i.sourceId}-group.${t}`,children:r});default:return r}}const bE=I.createContext(null);function CCe({context:t,children:e}){const n=I.useContext(bE),r=qn(),i=Hy("dialogs",[]),o=I.useMemo(()=>({dialogs:i,addDialog(s){const a=s.id??Qt();return i.update(l=>[...l.filter(c=>c.id!==s.id),{...s,id:a}]),r("open-menu",{source:"dialog",id:a}),ho.addOpenMenu(a,t),a},removeDialog(s){const a=i.get().find(l=>l.id===s);return a&&(a.onClose?.(),r("close-menu",{source:"dialog",id:s}),ho.deleteOpenMenu(s,t),i.update(l=>l.filter(c=>c!==a))),s},clearDialogs(){const s=i.get();s.length!==0&&(s.forEach(a=>{a.onClose?.(),r("close-menu",{source:"dialog",id:a.id}),ho.deleteOpenMenu(a.id,t)}),i.set([]))}}),[r,i,t]);return n?g.jsx(g.Fragment,{children:e}):g.jsx(bE.Provider,{value:o,children:e})}function vv(){const t=I.useContext(bE);if(!t)throw new Error("useDialogs must be used within a DialogsProvider");return t}const wE=I.createContext(null);function DY({children:t}){const e=Hy("toasts",[]),n=I.useContext(wE),r=I.useMemo(()=>({toasts:e,addToast(i){const o=i.id??Qt();return e.update(s=>[...s.filter(a=>a.id!==i.id),{...i,id:o}]),o},removeToast(i){return e.update(o=>o.filter(s=>s.id!==i)),i},clearToasts(){e.set([])}}),[e]);return n?g.jsx(g.Fragment,{children:t}):g.jsx(m_e,{children:g.jsx(wE.Provider,{value:r,children:t})})}function Nl(){const t=I.useContext(wE);if(!t)throw new Error("useToasts must be used within a ToastsProvider");return t}function M3(t){return new Promise(e=>{const{allowMultiple:n=!0,mimeTypes:r=[]}=t||{},i=document.createElement("input");i.type="file",i.accept=r?.join(","),i.multiple=n;async function o(s){const a=s.target.files;if(!a||a.length===0)return;const l=Array.from(a);i.value="",e(l),i.removeEventListener("change",o),i.remove()}i.addEventListener("change",o),i?.click()})}var PP={exports:{}},O3;function PCe(){return O3||(O3=1,(function(t){var e=(function(){var n=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={};function s(l,c){if(!o[l]){o[l]={};for(var d=0;d<l.length;d++)o[l][l.charAt(d)]=d}return o[l][c]}var a={compressToBase64:function(l){if(l==null)return"";var c=a._compress(l,6,function(d){return r.charAt(d)});switch(c.length%4){default:case 0:return c;case 1:return c+"===";case 2:return c+"==";case 3:return c+"="}},decompressFromBase64:function(l){return l==null?"":l==""?null:a._decompress(l.length,32,function(c){return s(r,l.charAt(c))})},compressToUTF16:function(l){return l==null?"":a._compress(l,15,function(c){return n(c+32)})+" "},decompressFromUTF16:function(l){return l==null?"":l==""?null:a._decompress(l.length,16384,function(c){return l.charCodeAt(c)-32})},compressToUint8Array:function(l){for(var c=a.compress(l),d=new Uint8Array(c.length*2),u=0,p=c.length;u<p;u++){var f=c.charCodeAt(u);d[u*2]=f>>>8,d[u*2+1]=f%256}return d},decompressFromUint8Array:function(l){if(l==null)return a.decompress(l);for(var c=new Array(l.length/2),d=0,u=c.length;d<u;d++)c[d]=l[d*2]*256+l[d*2+1];var p=[];return c.forEach(function(f){p.push(n(f))}),a.decompress(p.join(""))},compressToEncodedURIComponent:function(l){return l==null?"":a._compress(l,6,function(c){return i.charAt(c)})},decompressFromEncodedURIComponent:function(l){return l==null?"":l==""?null:(l=l.replace(/ /g,"+"),a._decompress(l.length,32,function(c){return s(i,l.charAt(c))}))},compress:function(l){return a._compress(l,16,function(c){return n(c)})},_compress:function(l,c,d){if(l==null)return"";var u,p,f={},y={},v="",x="",b="",w=2,_=3,C=2,A=[],E=0,O=0,D;for(D=0;D<l.length;D+=1)if(v=l.charAt(D),Object.prototype.hasOwnProperty.call(f,v)||(f[v]=_++,y[v]=!0),x=b+v,Object.prototype.hasOwnProperty.call(f,x))b=x;else{if(Object.prototype.hasOwnProperty.call(y,b)){if(b.charCodeAt(0)<256){for(u=0;u<C;u++)E=E<<1,O==c-1?(O=0,A.push(d(E)),E=0):O++;for(p=b.charCodeAt(0),u=0;u<8;u++)E=E<<1|p&1,O==c-1?(O=0,A.push(d(E)),E=0):O++,p=p>>1}else{for(p=1,u=0;u<C;u++)E=E<<1|p,O==c-1?(O=0,A.push(d(E)),E=0):O++,p=0;for(p=b.charCodeAt(0),u=0;u<16;u++)E=E<<1|p&1,O==c-1?(O=0,A.push(d(E)),E=0):O++,p=p>>1}w--,w==0&&(w=Math.pow(2,C),C++),delete y[b]}else for(p=f[b],u=0;u<C;u++)E=E<<1|p&1,O==c-1?(O=0,A.push(d(E)),E=0):O++,p=p>>1;w--,w==0&&(w=Math.pow(2,C),C++),f[x]=_++,b=String(v)}if(b!==""){if(Object.prototype.hasOwnProperty.call(y,b)){if(b.charCodeAt(0)<256){for(u=0;u<C;u++)E=E<<1,O==c-1?(O=0,A.push(d(E)),E=0):O++;for(p=b.charCodeAt(0),u=0;u<8;u++)E=E<<1|p&1,O==c-1?(O=0,A.push(d(E)),E=0):O++,p=p>>1}else{for(p=1,u=0;u<C;u++)E=E<<1|p,O==c-1?(O=0,A.push(d(E)),E=0):O++,p=0;for(p=b.charCodeAt(0),u=0;u<16;u++)E=E<<1|p&1,O==c-1?(O=0,A.push(d(E)),E=0):O++,p=p>>1}w--,w==0&&(w=Math.pow(2,C),C++),delete y[b]}else for(p=f[b],u=0;u<C;u++)E=E<<1|p&1,O==c-1?(O=0,A.push(d(E)),E=0):O++,p=p>>1;w--,w==0&&(w=Math.pow(2,C),C++)}for(p=2,u=0;u<C;u++)E=E<<1|p&1,O==c-1?(O=0,A.push(d(E)),E=0):O++,p=p>>1;for(;;)if(E=E<<1,O==c-1){A.push(d(E));break}else O++;return A.join("")},decompress:function(l){return l==null?"":l==""?null:a._decompress(l.length,32768,function(c){return l.charCodeAt(c)})},_decompress:function(l,c,d){var u=[],p=4,f=4,y=3,v="",x=[],b,w,_,C,A,E,O,D={val:d(0),position:c,index:1};for(b=0;b<3;b+=1)u[b]=b;for(_=0,A=Math.pow(2,2),E=1;E!=A;)C=D.val&D.position,D.position>>=1,D.position==0&&(D.position=c,D.val=d(D.index++)),_|=(C>0?1:0)*E,E<<=1;switch(_){case 0:for(_=0,A=Math.pow(2,8),E=1;E!=A;)C=D.val&D.position,D.position>>=1,D.position==0&&(D.position=c,D.val=d(D.index++)),_|=(C>0?1:0)*E,E<<=1;O=n(_);break;case 1:for(_=0,A=Math.pow(2,16),E=1;E!=A;)C=D.val&D.position,D.position>>=1,D.position==0&&(D.position=c,D.val=d(D.index++)),_|=(C>0?1:0)*E,E<<=1;O=n(_);break;case 2:return""}for(u[3]=O,w=O,x.push(O);;){if(D.index>l)return"";for(_=0,A=Math.pow(2,y),E=1;E!=A;)C=D.val&D.position,D.position>>=1,D.position==0&&(D.position=c,D.val=d(D.index++)),_|=(C>0?1:0)*E,E<<=1;switch(O=_){case 0:for(_=0,A=Math.pow(2,8),E=1;E!=A;)C=D.val&D.position,D.position>>=1,D.position==0&&(D.position=c,D.val=d(D.index++)),_|=(C>0?1:0)*E,E<<=1;u[f++]=n(_),O=f-1,p--;break;case 1:for(_=0,A=Math.pow(2,16),E=1;E!=A;)C=D.val&D.position,D.position>>=1,D.position==0&&(D.position=c,D.val=d(D.index++)),_|=(C>0?1:0)*E,E<<=1;u[f++]=n(_),O=f-1,p--;break;case 2:return x.join("")}if(p==0&&(p=Math.pow(2,y),y++),u[O])v=u[O];else if(O===f)v=w+w.charAt(0);else return null;x.push(v),u[f++]=w+v.charAt(0),p--,w=v,p==0&&(p=Math.pow(2,y),y++)}}};return a})();t!=null?t.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(PP)),PP.exports}var TCe=PCe();const kE=ua(TCe),LM="web image/vnd.tldraw+png",ECe={png:LM},ACe={[LM]:"image/png"};function MCe(t){return wr(ECe,t)??null}function OCe(t){return wr(ACe,t)??t}function DCe(t){return typeof ClipboardItem<"u"&&"supports"in ClipboardItem&&ClipboardItem.supports(t)}function jCe(t){const e=Object.entries(t);for(const[n,r]of e)r.catch(i=>console.error(i));return navigator.clipboard.write([new ClipboardItem(t)]).catch(n=>(console.error(n),Promise.all(e.map(async([r,i])=>[r,await i])).then(r=>{const i=a5(r);return navigator.clipboard.write([new ClipboardItem(i)])})))}async function RCe(t,e,n,r){const i=e.map(o=>o instanceof File?o:new File([o],"tldrawFile",{type:o.type}));t.markHistoryStoppingPoint("paste"),await t.putExternalContent({type:"files",files:i,point:n,sources:r})}async function IE(t,e,n,r){return t.markHistoryStoppingPoint("paste"),await t.putExternalContent({type:"url",point:n,url:e,sources:r})}const $Ce=[LM,"image/png","image/jpeg","image/webp","image/svg+xml"];function TP(t){const e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=t.trim(),e.body.textContent||e.body.innerText||""}const NCe=t=>{try{const e=new URL(t);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}},LCe=t=>{const e=t.split(/[\n\s]/);for(const n of e)try{const r=new URL(n);if(!(r.protocol==="http:"||r.protocol==="https:"))return}catch{return}return tW(e)},zCe=t=>/^<svg/.test(t),FCe=["input","select","textarea"];function EP(t){const{activeElement:e}=document;return t.menus.hasAnyOpenMenus()||e&&(e.isContentEditable||FCe.indexOf(e.tagName.toLowerCase())>-1)}const rS=(t,e,n,r)=>{const i=LCe(e);if(i)for(const o of i)IE(t,o,n);else NCe(e)?IE(t,e,n):zCe(e)?(t.markHistoryStoppingPoint("paste"),t.putExternalContent({type:"svg-text",text:e,point:n,sources:r})):(t.markHistoryStoppingPoint("paste"),t.putExternalContent({type:"text",text:e,point:n,sources:r}))},BCe=async(t,e,n)=>{if(t.getEditingShapeId()!==null)return;if(!e)throw Error("No clipboard data");const r=[];for(const i of Object.values(e.items))switch(i.kind){case"file":{r.push({type:"file",source:new Promise(o=>o(i.getAsFile()))});break}case"string":{i.type==="text/html"?r.push({type:"html",source:new Promise(o=>i.getAsString(o))}):i.type==="text/plain"?r.push({type:"text",source:new Promise(o=>i.getAsString(o))}):r.push({type:i.type,source:new Promise(o=>i.getAsString(o))});break}}RY(t,r,n)},jY=async({editor:t,clipboardItems:e,point:n,fallbackFiles:r})=>{const i=[];for(const o of e){for(const s of $Ce)if(o.types.includes(s)){const a=o.getType(s).then(l=>Si.rewriteMimeType(l,OCe(s)));i.push({type:"blob",source:a});break}o.types.includes("text/html")&&i.push({type:"html",source:(async()=>{const s=await o.getType("text/html");return await Si.blobToText(s)})()}),o.types.includes("text/uri-list")&&i.push({type:"url",source:(async()=>{const s=await o.getType("text/uri-list");return await Si.blobToText(s)})()}),o.types.includes("text/plain")&&i.push({type:"text",source:(async()=>{const s=await o.getType("text/plain");return await Si.blobToText(s)})()})}return r?.length&&i.length===1&&i[0].type==="text"?(i.pop(),i.push(...r.map(o=>({type:"file",source:Promise.resolve(o)})))):r?.length&&i.length===0&&i.push(...r.map(o=>({type:"file",source:Promise.resolve(o)}))),await RY(t,i,n)};async function RY(t,e,n){const r=e.filter(o=>(o.type==="file"||o.type==="blob")&&o.source!==null);if(r.length){if(r.length>t.options.maxFilesAtOnce)throw Error("Too many files");const o=ut(await Promise.all(r.map(s=>s.source)));return await RCe(t,o,n)}const i=await Promise.all(e.filter(o=>o.type!=="file").map(o=>new Promise(s=>{const a=o;if(a.type==="file"){s({type:"error",data:null,reason:"unexpected file"});return}a.source.then(l=>{const c=l.match(/<div data-tldraw[^>]*>(.*)<\/div>/)?.[1];if(c)try{let d;try{d=JSON.parse(c)}catch{const u=kE.decompressFromBase64(c);if(u===null){s({type:"error",data:null,reason:"found tldraw data comment but could not parse"});return}d=JSON.parse(u)}if(d.type!=="application/tldraw"){s({type:"error",data:d,reason:`found tldraw data comment but JSON was of a different type: ${d.type}`});return}if(d.version===3)try{const u=JSON.parse(kE.decompressFromBase64(d.data.otherCompressed)||"{}"),p={assets:d.data.assets||[],...u};s({type:"tldraw",data:p});return}catch(u){s({type:"error",data:d,reason:`failed to decompress version 2 clipboard data: ${u}`});return}if(d.version===2)s({type:"tldraw",data:d.data});else{if(typeof d.data=="string"){s({type:"error",data:d,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}s({type:"tldraw",data:d.data});return}}catch{s({type:"error",data:c,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(a.type==="html"){s({type:"text",data:l,subtype:"html"});return}if(a.type==="url"){s({type:"text",data:l,subtype:"url"});return}try{const d=JSON.parse(l);if(d.type==="excalidraw/clipboard"){s({type:"excalidraw",data:d});return}else{s({type:"text",data:l,subtype:"json"});return}}catch{s({type:"text",data:l,subtype:"text"});return}}s({type:"error",data:l,reason:"unhandled case"})})})));for(const o of i)if(o.type==="tldraw"){t.markHistoryStoppingPoint("paste"),t.putExternalContent({type:"tldraw",content:o.data,point:n});return}for(const o of i)if(o.type==="excalidraw"){t.markHistoryStoppingPoint("paste"),t.putExternalContent({type:"excalidraw",content:o.data,point:n});return}for(const o of i){if(o.type==="text"&&o.subtype==="html"){const a=new DOMParser().parseFromString(o.data,"text/html").querySelector("body");if(a&&Array.from(a.children).filter(c=>c.nodeType===1).length===1&&a.firstElementChild&&a.firstElementChild.tagName==="A"&&a.firstElementChild.hasAttribute("href")&&a.firstElementChild.getAttribute("href")!==""){const c=a.firstElementChild.getAttribute("href");rS(t,c,n,i);return}if(!i.some(c=>c.type==="text"&&c.subtype!=="html")&&o.data.trim()&&(TP(o.data)??"")){rS(t,TP(o.data),n,i);return}if(i.some(c=>c.type==="text"&&c.subtype!=="html")){const c=TP(o.data)??"";if(c){t.markHistoryStoppingPoint("paste"),t.putExternalContent({type:"text",text:c,html:o.data,point:n,sources:i});return}}}if(o.type==="text"&&o.subtype==="text"&&o.data.startsWith("<iframe ")){const a=new DOMParser().parseFromString(o.data,"text/html").querySelector("body");if(a&&Array.from(a.children).filter(c=>c.nodeType===1).length===1&&a.firstElementChild&&a.firstElementChild.tagName==="IFRAME"&&a.firstElementChild.hasAttribute("src")&&a.firstElementChild.getAttribute("src")!==""){const c=a.firstElementChild.getAttribute("src");rS(t,c,n,i);return}}}for(const o of i)if(o.type==="text"&&o.subtype==="url"){IE(t,o.data,n,i);return}for(const o of i)if(o.type==="text"&&o.subtype==="text"&&o.data.trim()){rS(t,o.data,n,i);return}}const Ub=async t=>{const e=await t.resolveAssetsInContent(t.getContentFromCurrentPage(t.getSelectedShapeIds()));if(!e){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const{assets:n,...r}=e,i={type:"application/tldraw",kind:"content",version:3,data:{assets:n||[],otherCompressed:kE.compressToBase64(JSON.stringify(r))}},o=JSON.stringify(i);if(!(typeof navigator>"u")){const s=e.shapes.map(a=>t.getShapeUtil(a).getText(a)).filter(pse);if(navigator.clipboard?.write){const a=new Blob([`<div data-tldraw>${o}</div>`],{type:"text/html"});let l=s.join(" ");l===""&&(l=" "),navigator.clipboard.write([new ClipboardItem({"text/html":a,"text/plain":new Blob([l],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<div data-tldraw>${o}</div>`)}};function UCe(){const t=hr(),e=qn(),n=I.useCallback(async function(s){Ge(t,"editor is required for copy"),t.getSelectedShapeIds().length!==0&&(await Ub(t),e("copy",{source:s}))},[t,e]),r=I.useCallback(async function(s){t&&t.getSelectedShapeIds().length!==0&&(await Ub(t),t.deleteShapes(t.getSelectedShapeIds()),e("cut",{source:s}))},[t,e]),i=I.useCallback(async function(s,a,l){t&&t.getEditingShapeId()===null&&(Array.isArray(s)&&s[0]instanceof ClipboardItem?(jY({editor:t,clipboardItems:s,point:l}),e("paste",{source:"menu"})):navigator.clipboard.read().then(c=>{i(c,a,l)}))},[t,e]);return{copy:n,cut:r,paste:i}}function HCe(){const t=ne(),e=qn(),n=J("editor.isFocused",()=>t.getInstanceState().isFocused,[t]);I.useEffect(()=>{if(!n)return;const r=async l=>{t.getSelectedShapeIds().length===0||t.getEditingShapeId()!==null||EP(t)||(dt(l),await Ub(t),e("copy",{source:"kbd"}))};async function i(l){t.getSelectedShapeIds().length===0||t.getEditingShapeId()!==null||EP(t)||(dt(l),await Ub(t),t.deleteShapes(t.getSelectedShapeIds()),e("cut",{source:"kbd"}))}let o=!1;const s=l=>{l.button===1&&(o=!0,t.timers.requestAnimationFrame(()=>{o=!1}))},a=l=>{if(o){t.markEventAsHandled(l);return}if(t.getEditingShapeId()!==null||EP(t))return;let c,d=!1;t.inputs.shiftKey&&(d=!0),t.user.getIsPasteAtCursorMode()&&(d=!d),d&&(c=t.inputs.currentPagePoint);const u=()=>{l.clipboardData&&BCe(t,l.clipboardData,c)};if(navigator.clipboard?.read){const p=Array.from(l.clipboardData?.files||[]);navigator.clipboard.read().then(f=>{Array.isArray(f)&&f[0]instanceof ClipboardItem&&jY({editor:t,clipboardItems:f,point:c,fallbackFiles:p})},()=>{u()})}else u();dt(l),e("paste",{source:"kbd"})};return document.addEventListener("copy",r),document.addEventListener("cut",i),document.addEventListener("paste",a),document.addEventListener("pointerup",s),()=>{document.removeEventListener("copy",r),document.removeEventListener("cut",i),document.removeEventListener("paste",a),document.removeEventListener("pointerup",s)}},[t,e,n])}const D3={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",svg:"text/plain"};function WCe(t,e,n={}){const r=e?.length?e:[...t.getCurrentPageShapeIds()],i=n.format??"png";return{blobPromise:t.toImage(r,n).then(o=>Si.rewriteMimeType(o.blob,D3[i])),mimeType:D3[i]}}function VCe(t,e,n){if(!navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(navigator.clipboard.write){const{blobPromise:r,mimeType:i}=WCe(t,e,n),o={[i]:r},s=MCe(n.format);return s&&DCe(s)&&(o[s]=r.then(a=>Si.rewriteMimeType(a,s))),jCe(o)}switch(n.format){case"svg":return KCe(async()=>{const r=await t.getSvgString(e,n);if(!r)throw new Error("Failed to copy");return r.svg});case"png":throw new Error("Copy not supported");default:Wt(n.format)}}async function KCe(t){await navigator.clipboard?.writeText?.(await t())}function qCe(){const t=hr(),{addToast:e}=Nl(),n=Ve();return I.useCallback((r,i="svg")=>{Ge(t,"useCopyAs: editor is required"),VCe(t,r,{format:i}).catch(()=>{e({id:"copy-fail",severity:"warning",title:n("toast.error.copy-fail.title"),description:n("toast.error.copy-fail.desc")})})},[t,e,n])}async function GCe(t,e,n){let r=n.name;if(!r&&(r=`shapes at ${j3()}`,e.length===1)){const s=t.getShape(e[0]);t.isShapeOfType(s,"frame")?r=s.props.name||"frame":r=`${Qw(s.id)} at ${j3()}`}r+=`.${n.format}`;const{blob:i}=await t.toImage(e,n),o=new File([i],r,{type:i.type});YCe(o)}function j3(){const t=new Date,e=String(t.getFullYear()).slice(2),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0"),i=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0"),s=String(t.getSeconds()).padStart(2,"0");return`${e}-${n}-${r} ${i}.${o}.${s}`}function YCe(t){const e=document.createElement("a"),n=URL.createObjectURL(t);e.href=n,e.download=t.name,e.click(),URL.revokeObjectURL(n)}function XCe(){const t=hr(),{addToast:e}=Nl(),n=Ve();return I.useCallback((r,i={})=>{Ge(t,"useExportAs: editor is required");const{format:o="png",name:s,scale:a=1}=i;GCe(t,r,{format:o,name:s,scale:a}).catch(l=>{console.error(l.message),e({id:"export-fail",title:n("toast.error.export-fail.title"),description:n("toast.error.export-fail.desc"),severity:"error"})})},[t,e,n])}function ZCe(){const t=hr(),e=I.useRef(null),n=I.useRef(null);return I.useCallback(async function(){Ge(t,"usePrint: editor is required");const i=document.createElement("div"),o=document.createElement("style"),s=(b,w)=>{b&&(b.innerHTML=""),w&&document.head.contains(w)&&document.head.removeChild(w),b&&document.body.contains(b)&&document.body.removeChild(b)};s(e.current,n.current),e.current=i,n.current=o;const a=`tl-print-surface-${Qt()}`;i.className=a,o.innerHTML=`
			.${a} {
				display: none;
			}

			.${a} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${a} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${a}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${a}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${a}__item__header {
					display: none;
				}

				.${a}__item__footer {
					display: none;
					text-align: right;
				}

				.${a}__item__footer__hide {
					display: none;
				}

				
			}

		`;const l=()=>{document.head.appendChild(o),document.body.appendChild(i)},c=()=>{t.once("tick",()=>{s(i,o)})};window.addEventListener("beforeprint",l),window.addEventListener("afterprint",c);function d(b,w,_){try{i.innerHTML+=`<div class="${a}__item">
        <div class="${a}__item__header">
          ${b.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${a}__item__main">
          ${_}
        </div>
        <div class="${a}__item__footer ${a}__item__footer__${w?"":"hide"}">
          ${w??""}
        </div>
      </div>`}catch(C){console.error(C)}}function u(){Jt.isChromeForIos?(l(),window.print()):Jt.isSafari?(l(),document.execCommand("print",!1)):window.print()}const p=t.getSelectedShapeIds(),f=t.getCurrentPageId(),y=t.getPages(),x={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(t.getSelectedShapeIds().length>0){const b=await t.getSvgString(p,x);if(b){const w=y.find(_=>_.id===f);d(`tldraw — ${w?.name}`,null,b.svg),u()}}else{const b=t.getCurrentPage(),w=await t.getSvgString(t.getSortedChildIdsForParent(b.id),x);w&&(d(`tldraw — ${b.name}`,null,w.svg),u())}window.removeEventListener("beforeprint",l),window.removeEventListener("afterprint",c)},[t])}const $Y=I.createContext([]);function zM(){const t=hr(),{addToast:e,removeToast:n,clearToasts:r}=Nl(),{addDialog:i,clearDialogs:o,removeDialog:s}=vv(),a=Ve(),l=ZCe(),{cut:c,copy:d,paste:u}=UCe(),p=qCe(),f=XCe(),y=$M(),x=Ci()<nr.TABLET_SM,b=gu(I.useContext($Y)),w=I.useCallback(async()=>{if(!t)return;const E=await M3({allowMultiple:!0,mimeTypes:b});E.length&&(t.markHistoryStoppingPoint("insert media"),t.putExternalContent({type:"files",files:E,point:t.getViewportPageBounds().center}))},[t,b]),_=I.useCallback(async E=>{if(!t)return;const O=await M3({allowMultiple:!1,mimeTypes:b?.filter(L=>E?L.startsWith("image/"):L.startsWith("video/"))});if(!O.length)return;const D=t.getOnlySelectedShape();if(!D||E&&D.type!=="image"||!E&&D.type!=="video")return;t.markHistoryStoppingPoint("replace media");const B=O[0];t.replaceExternalContent({type:"file-replace",file:B,shapeId:D.id,isImage:E})},[t,b]),C=I.useCallback(()=>_(!0),[_]),A=I.useCallback(()=>_(!1),[_]);return I.useMemo(()=>({addToast:e,removeToast:n,clearToasts:r,addDialog:i,removeDialog:s,clearDialogs:o,msg:a,isMobile:x,insertMedia:w,replaceImage:C,replaceVideo:A,printSelectionOrPages:l,cut:c,copy:d,paste:u,copyAs:p,exportAs:f,getEmbedDefinition:y}),[e,n,r,i,s,o,a,x,w,C,A,l,c,d,u,p,f,y])}function JCe(t,e){const n={};for(const r of t)if(r.translations)for(const[i,o]of go(r.translations)){let s=n[i];s||(s=n[i]={}),Object.assign(s,o)}return{actions:(r,i,o)=>{for(const s of t)s.actions&&(i=s.actions(r,i,o));return i},tools:(r,i,o)=>{for(const s of t)s.tools&&(i=s.tools(r,i,{...e,...o}));return i},translations:n}}function NY(t){return I.useMemo(()=>t,t)}function LY(t){const e=NY(t==null?[]:Array.isArray(t)?t:[t]);return I.useMemo(()=>{const n={};for(const r of e)if(r.translations)for(const[i,o]of go(r.translations)){let s=n[i];s||(s=n[i]={}),Object.assign(s,o)}return n},[e])}function QCe(t){const e=zM(),n=NY(t==null?[]:Array.isArray(t)?t:[t]);return I.useMemo(()=>JCe(n,e),[n,e])}const zY=I.createContext(null);function ePe({overrides:t,children:e}){const n=hr(),r=qn(),i=R0(),o=Ve(),s=zM(),a=I.useCallback((c,d,u)=>{i.announce({msg:o(d.label)}),r("select-tool",{source:c,id:u??d.id})},[i,o,r]),l=I.useMemo(()=>{if(!n)return{};const c=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(u){if(n.isIn("select")){const p=n.root.getCurrent();p.exit({},p.id),p.enter({},p.id)}n.setCurrentTool("select"),a(u,this)}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(u){n.setCurrentTool("hand"),a(u,this)}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(u){n.setCurrentTool("eraser"),a(u,this)}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(u){n.setCurrentTool("draw"),a(u,this)}},...[...vl.values].map(u=>({id:u,label:`tool.${u}`,meta:{geo:u},kbd:u==="rectangle"?"r":u==="ellipse"?"o":void 0,icon:"geo-"+u,onSelect(p){n.run(()=>{n.setStyleForNextShapes(vl,u),n.setCurrentTool("geo"),a(p,this,`geo-${u}`)})},onDragStart(p,f){kp(n,f,{createShape:y=>n.createShape({id:y,type:"geo",props:{w:200,h:200,geo:u}})}),r("drag-tool",{source:p,id:"geo"})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(u){n.setCurrentTool("arrow"),a(u,this)},onDragStart(u,p){kp(n,p,{createShape:f=>n.createShape({id:f,type:"arrow",props:{start:{x:0,y:200},end:{x:200,y:0}}})}),r("drag-tool",{source:u,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(u){n.setCurrentTool("line"),a(u,this)},onDragStart(u,p){kp(n,p,{createShape:f=>{const[y,v]=Gd(null,null,2);n.createShape({id:f,type:"line",props:{points:{[y]:{id:y,index:y,x:0,y:200},[v]:{id:v,index:v,x:200,y:0}}}})}}),r("drag-tool",{source:u,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(u){n.setCurrentTool("frame"),a(u,this)},onDragStart(u,p){kp(n,p,{createShape:f=>n.createShape({id:f,type:"frame"})}),r("drag-tool",{source:u,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(u){n.setCurrentTool("text"),a(u,this)},onDragStart(u,p){kp(n,p,{createShape:f=>n.createShape({id:f,type:"text",props:{richText:dn("Text")}}),onDragEnd:f=>{n.setEditingShape(f),n.emit("select-all-text",{shapeId:f})}}),r("drag-tool",{source:u,id:"text"})}},{id:"asset",label:"tool.media",icon:"tool-media",kbd:"cmd+u,ctrl+u",onSelect(u){s.insertMedia(),a(u,this,"media")}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(u){n.setCurrentTool("note"),a(u,this)},onDragStart(u,p){kp(n,p,{createShape:f=>n.createShape({id:f,type:"note"}),onDragEnd:f=>{n.setEditingShape(f),n.emit("select-all-text",{shapeId:f})}}),r("drag-tool",{source:u,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(u){n.setCurrentTool("laser"),a(u,this)}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(u){s.addDialog({component:IY}),a(u,this)}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"shift+d",onSelect(u){n.setCurrentTool("highlight"),a(u,this)}}];c.forEach(u=>u.onSelect=u.onSelect.bind(u));const d=Object.fromEntries(c.map(u=>[u.id,u]));return t?t(n,d,s):d},[t,n,s,a,r]);return g.jsx(zY.Provider,{value:l,children:e})}function FM(){const t=I.useContext(zY);if(!t)throw new Error("useTools must be used within a ToolProvider");return t}function kp(t,e,n){const{x:r,y:i}=t.inputs.currentPagePoint,o=t.markHistoryStoppingPoint("drag shape tool");t.setCurrentTool("select.translating");const s=sn();n.createShape(s);const a=Gr(t.getShape(s),"Shape not found"),{w:l,h:c}=t.getShapePageBounds(s);t.updateShape({id:s,type:a.type,x:r-l/2,y:i-c/2}),t.select(s),t.setCurrentTool("select.translating",{...e,target:"shape",shape:t.getShape(s),isCreating:!0,creatingMarkId:o,onCreate(){t.setCurrentTool("select.idle"),t.select(s),n.onDragEnd?.(s)}}),t.getCurrentTool().setCurrentToolIdMask(a.type)}function Bo({toolId:t="",...e}){const r=FM()[t];return r?g.jsx($t,{...r,...e}):null}function tPe(){const t=u1();return g.jsxs(g.Fragment,{children:[g.jsxs(bt,{label:"shortcuts-dialog.tools",id:"tools",children:[g.jsx(me,{actionId:"toggle-tool-lock"}),g.jsx(me,{actionId:"insert-media"}),g.jsx(Bo,{toolId:"select"}),g.jsx(Bo,{toolId:"draw"}),g.jsx(Bo,{toolId:"eraser"}),g.jsx(Bo,{toolId:"hand"}),g.jsx(Bo,{toolId:"rectangle"}),g.jsx(Bo,{toolId:"ellipse"}),g.jsx(Bo,{toolId:"arrow"}),g.jsx(Bo,{toolId:"line"}),g.jsx(Bo,{toolId:"text"}),g.jsx(Bo,{toolId:"frame"}),g.jsx(Bo,{toolId:"note"}),g.jsx(Bo,{toolId:"laser"}),g.jsx($t,{id:"pointer-down",label:"tool.pointer-down",kbd:",",onSelect:()=>{}})]}),g.jsxs(bt,{label:"shortcuts-dialog.preferences",id:"preferences",children:[g.jsx(me,{actionId:"toggle-dark-mode"}),g.jsx(me,{actionId:"toggle-focus-mode"}),g.jsx(me,{actionId:"toggle-grid"})]}),g.jsxs(bt,{label:"shortcuts-dialog.edit",id:"edit",children:[g.jsx(me,{actionId:"undo"}),g.jsx(me,{actionId:"redo"}),g.jsx(me,{actionId:"cut"}),g.jsx(me,{actionId:"copy"}),g.jsx(me,{actionId:"paste"}),g.jsx(me,{actionId:"select-all"}),g.jsx(me,{actionId:"delete"}),g.jsx(me,{actionId:"duplicate"})]}),g.jsxs(bt,{label:"shortcuts-dialog.view",id:"view",children:[g.jsx(me,{actionId:"zoom-in"}),g.jsx(me,{actionId:"zoom-out"}),g.jsx(me,{actionId:"zoom-to-100"}),g.jsx(me,{actionId:"zoom-to-fit"}),g.jsx(me,{actionId:"zoom-to-selection"})]}),g.jsxs(bt,{label:"shortcuts-dialog.transform",id:"transform",children:[g.jsx(me,{actionId:"bring-to-front"}),g.jsx(me,{actionId:"bring-forward"}),g.jsx(me,{actionId:"send-backward"}),g.jsx(me,{actionId:"send-to-back"}),g.jsx(me,{actionId:"group"}),g.jsx(me,{actionId:"ungroup"}),g.jsx(me,{actionId:"flip-horizontal"}),g.jsx(me,{actionId:"flip-vertical"}),g.jsx(me,{actionId:"align-top"}),g.jsx(me,{actionId:"align-center-vertical"}),g.jsx(me,{actionId:"align-bottom"}),g.jsx(me,{actionId:"align-left"}),g.jsx(me,{actionId:"align-center-horizontal"}),g.jsx(me,{actionId:"align-right"})]}),g.jsxs(bt,{label:"shortcuts-dialog.text-formatting",id:"text",children:[g.jsx($t,{id:"text-bold",label:"tool.rich-text-bold",kbd:"cmd+b",onSelect:()=>{}}),g.jsx($t,{id:"text-italic",label:"tool.rich-text-italic",kbd:"cmd+i",onSelect:()=>{}}),g.jsx($t,{id:"text-code",label:"tool.rich-text-code",kbd:"cmd+e",onSelect:()=>{}}),g.jsx($t,{id:"text-highlight",label:"tool.rich-text-highlight",kbd:"cmd+shift+h",onSelect:()=>{}}),g.jsx($t,{id:"text-strikethrough",label:"tool.rich-text-strikethrough",kbd:"cmd+shift+s",onSelect:()=>{}}),g.jsx($t,{id:"text-link",label:"tool.rich-text-link",kbd:"cmd+shift+k",onSelect:()=>{}}),g.jsx($t,{id:"text-header",label:"tool.rich-text-header",kbd:"cmd+alt+[[1-6]]",onSelect:()=>{}}),g.jsx($t,{id:"text-orderedList",label:"tool.rich-text-orderedList",kbd:"cmd+shift+7",onSelect:()=>{}}),g.jsx($t,{id:"text-bulletedlist",label:"tool.rich-text-bulletList",kbd:"cmd+shift+8",onSelect:()=>{}})]}),g.jsxs(bt,{label:"shortcuts-dialog.a11y",id:"a11y",children:[g.jsx($t,{id:"a11y-select-next-shape",label:"a11y.select-shape",kbd:"[[Tab]]",onSelect:()=>{}}),g.jsx($t,{id:"a11y-select-next-shape-direction",label:"a11y.select-shape-direction",kbd:"cmd+[[↑→↓←]]",onSelect:()=>{}}),g.jsx($t,{id:"a11y-select-next-shape-container",label:"a11y.enter-leave-container",kbd:"cmd+shift+[[↑↓]]",onSelect:()=>{}}),g.jsx($t,{id:"a11y-pan-camera",label:"a11y.pan-camera",kbd:"[[Space]]+[[↑→↓←]]",onSelect:()=>{}}),g.jsx($t,{id:"adjust-shape-styles",label:"a11y.adjust-shape-styles",kbd:"cmd+[[Enter]]",onSelect:()=>{}}),g.jsx($t,{id:"open-context-menu",label:"a11y.open-context-menu",kbd:"cmd+shift+[[Enter]]",onSelect:()=>{}}),g.jsx($t,{id:"a11y-move-shape",label:"a11y.move-shape",kbd:"[[↑→↓←]]",onSelect:()=>{}}),g.jsx($t,{id:"a11y-move-shape-faster",label:"a11y.move-shape-faster",kbd:"shift+[[↑→↓←]]",onSelect:()=>{}}),g.jsx($t,{id:"a11y-rotate-shape-cw",label:"a11y.rotate-shape-cw",kbd:"shift+﹥",onSelect:()=>{}}),g.jsx($t,{id:"a11y-rotate-shape-cw-fine",label:"a11y.rotate-shape-cw-fine",kbd:"shift+alt+﹥",onSelect:()=>{}}),g.jsx($t,{id:"a11y-rotate-shape-ccw",label:"a11y.rotate-shape-ccw",kbd:"shift+﹤",onSelect:()=>{}}),g.jsx($t,{id:"a11y-rotate-shape-ccw-fine",label:"a11y.rotate-shape-ccw-fine",kbd:"shift+alt+﹤",onSelect:()=>{}}),g.jsx(me,{actionId:"enlarge-shapes"}),g.jsx(me,{actionId:"shrink-shapes"}),g.jsx(me,{actionId:"a11y-repeat-shape-announce"}),g.jsx($t,{id:"a11y-open-keyboard-shortcuts",label:"a11y.open-keyboard-shortcuts",kbd:"cmd+alt+/",onSelect:()=>{}})]}),t&&g.jsx(bt,{label:"shortcuts-dialog.collaboration",id:"collaboration",children:g.jsx(me,{actionId:"open-cursor-chat"})})]})}const FY=I.memo(function({children:e}){const n=Ve(),r=Ci(),i=e??g.jsx(tPe,{});return g.jsxs(g.Fragment,{children:[g.jsxs(s1,{className:"tlui-shortcuts-dialog__header",children:[g.jsx(a1,{children:n("shortcuts-dialog.title")}),g.jsx(l1,{})]}),g.jsx(Sy,{className:Ye("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":r<=nr.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":r<=nr.TABLET}),children:g.jsx(qi,{type:"keyboard-shortcuts",sourceId:"kbd",children:i})}),g.jsx("div",{className:"tlui-dialog__scrim"})]})});async function nPe(t,e,n){const r=ut(e.map(a=>{const l=t.getShape(a);if(!(!l||t.getShapeUtil(l.type).toSvg===void 0))return l}));if(r.length===0)return;if(r.length===1){const a=r[0];if(!a||t.isShapeOfType(a,"image"))return}const i=[];if(n!==void 0){const a=r.map(l=>({shape:l,bounds:t.getShapeMaskedPageBounds(l).clone().expandBy(n)}));for(let l=0;l<a.length;l++){const c=a[l];if(l===0){i[0]={shapes:[c.shape],bounds:c.bounds};continue}let d=!1;for(const u of i)if(u.bounds.includes(c.bounds)){u.shapes.push(c.shape),u.bounds.expand(c.bounds),d=!0;break}d||i.push({shapes:[c.shape],bounds:c.bounds})}}else{const a=pe.Common(r.map(l=>t.getShapeMaskedPageBounds(l)));i.push({shapes:r,bounds:a})}const o=t.options.flattenImageBoundsPadding;for(const a of i){n!==void 0&&a.bounds.expandBy(-n);const l=await t.getSvgString(a.shapes,{padding:o,background:!1});if(!l?.svg)continue;const c=await t.getAssetForExternalContent({type:"file",file:new File([l.svg],"asset.svg",{type:"image/svg+xml"})});c&&(a.asset=c)}const s=[];return ws(()=>{for(const a of i){const{asset:l,bounds:c,shapes:d}=a;if(!l)continue;const u=t.findCommonAncestor(d)??t.getCurrentPageId();if(!u)continue;let p="a1";for(const b of d)if(b.parentId===u){b.index>p&&(p=b.index);break}let f,y,v;if(co(u)){const b=t.getShape(u);if(!b)continue;const w=t.getPointInShapeSpace(b,{x:c.x,y:c.y});v=t.getShapePageTransform(u).rotation(),w.sub(new T(o,o).rot(-v)),f=w.x,y=w.y}else f=c.x-o,y=c.y-o,v=0;t.deleteShapes(d),t.createAssets([{...l,id:l.id}]);const x=sn();t.createShape({id:x,type:"image",index:p,parentId:u,x:f,y,rotation:-v,props:{assetId:l.id,w:c.w+o*2,h:c.h+o*2}}),s.push(x)}}),s}function dh({id:t,children:e,onOpenChange:n,open:r,className:i}){const[o,s]=_c(t,n);return g.jsx(bM,{onOpenChange:s,open:r||o,children:g.jsx("div",{className:Ye("tlui-popover",i),children:e})})}function hh({children:t}){return g.jsx(wM,{asChild:!0,dir:"ltr",children:t})}function ph({side:t,children:e,align:n="center",sideOffset:r=8,alignOffset:i=0,disableEscapeKeyDown:o=!1,autoFocusFirstButton:s=!0}){const a=Cr(),l=rt.useRef(null),c=rt.useCallback(()=>{if(!s)return;const p=[...l.current?.querySelectorAll("button:not([disabled])")??[]].filter(f=>f.offsetWidth||f.offsetHeight)[0];p&&p.focus()},[s]);return g.jsx(kM,{container:a,children:g.jsx(IM,{className:"tlui-popover__content",side:t,sideOffset:r,align:n,alignOffset:i,dir:"ltr",ref:l,onOpenAutoFocus:c,onEscapeKeyDown:d=>o&&d.preventDefault(),children:e})})}function Hb(t,e,n){const{arrowheadStart:r,arrowheadEnd:i}=e.props,o=Up(t,e,n),s=o.start.clone(),a=o.end.clone(),l=T.Med(s,a);if(T.Equals(s,a))return{bindings:n,type:"straight",start:{handle:s,point:s,arrowhead:e.props.arrowheadStart},end:{handle:a,point:a,arrowhead:e.props.arrowheadEnd},middle:l,isValid:!1,length:0};const c=T.Sub(a,s).uni(),d=Vb(t,e,"start"),u=Vb(t,e,"end"),p=t.getShapePageTransform(e);R3(a,o.start,p,u),R3(s,o.end,p,d);let f=0,y=0,v=0,x=0,b=Hp*e.props.scale;const w=d&&u&&d.shape===u.shape,_=d&&u?BM(t,d.shape.id,u.shape.id):"safe";_==="safe"&&d&&u&&!w&&!d.isExact&&!u.isExact&&(u.didIntersect&&!d.didIntersect?d.isClosed&&s.setTo(a.clone().add(c.clone().mul(Hp*e.props.scale))):u.didIntersect||u.isClosed&&a.setTo(s.clone().sub(c.clone().mul(Hp*e.props.scale))));const C=T.Sub(a,s),A=T.Len(C)?C.uni():T.From(C),E=!T.Equals(A,c);w||(_!=="start-contains-end"&&d&&r!=="none"&&!d.isExact&&(v=xs[e.props.size]/2+("size"in d.shape.props?xs[d.shape.props.size]/2:0),f=(wy+v)*e.props.scale,b+=v*e.props.scale),_!=="end-contains-start"&&u&&i!=="none"&&!u.isExact&&(x=xs[e.props.size]/2+("size"in u.shape.props?xs[u.shape.props.size]/2:0),y=(wy+x)*e.props.scale,b+=x*e.props.scale));const O=s.clone().add(A.clone().mul(f*(E?-1:1))),D=a.clone().sub(A.clone().mul(y*(E?-1:1)));T.DistMin(O,D,b)&&(f!==0&&y!==0?(f*=-1.5,y*=-1.5):f!==0?f*=-1:y!==0&&(y*=-1)),s.add(A.clone().mul(f*(E?-1:1))),a.sub(A.clone().mul(y*(E?-1:1))),E?(d&&u&&a.setTo(T.Add(s,A.clone().mul(-Hp*e.props.scale))),l.setTo(T.Med(o.start,o.end))):l.setTo(T.Med(s,a));const B=T.Dist(s,a);return{bindings:n,type:"straight",start:{handle:o.start,point:s,arrowhead:e.props.arrowheadStart},end:{handle:o.end,point:a,arrowhead:e.props.arrowheadEnd},middle:l,isValid:B>0,length:B}}function R3(t,e,n,r){if(r===void 0||r.isExact)return;const i=xe.applyToPoint(n,e),o=xe.applyToPoint(n,t),s=xe.applyToPoint(xe.Inverse(r.transform),i),a=xe.applyToPoint(xe.Inverse(r.transform),o),l=Array.from(r.geometry.intersectLineSegment(s,a,{includeLabels:!1,includeInternal:!1}));let c;if(l.length&&(c=l.sort((p,f)=>T.Dist2(p,s)-T.Dist2(f,s))[0]??(r.isClosed?void 0:a)),c===void 0&&(c=r.geometry.nearestPoint(a,{includeLabels:!1,includeInternal:!1}),!T.DistMin(c,a,1)))return;const d=xe.applyToPoint(r.transform,c),u=xe.applyToPoint(xe.Inverse(n),d);t.setTo(u),r.didIntersect=!0}function rPe(t,e,n){const{arrowheadEnd:r,arrowheadStart:i}=e.props,o=e.props.bend;if(Math.abs(o)>Math.abs(e.props.bend*(CPe*e.props.scale)))return Hb(t,e,n);const s=Up(t,e,n),a=T.Med(s.start,s.end),l=T.Sub(s.end,s.start),c=T.Len(l)?l.uni():T.From(l),d=T.Add(a,c.per().mul(-o)),u=Vb(t,e,"start"),p=Vb(t,e,"end"),f=s.start.clone(),y=s.end.clone(),v=d.clone();if(T.Equals(f,y))return{bindings:n,type:"straight",start:{handle:f,point:f,arrowhead:e.props.arrowheadStart},end:{handle:y,point:y,arrowhead:e.props.arrowheadEnd},middle:v,isValid:!1,length:0};const x=e.props.bend<0,b=x?Y2:Lce,w=$3(f,y,v),_=T.Angle(w.center,f),C=T.Angle(w.center,y),A=b(_,C);if(w.length===0||w.size===0||!Hz(w.length)||!Hz(w.size))return Hb(t,e,n);const E=f.clone(),O=y.clone(),D=v.clone(),B=t.getShapePageTransform(e);let L=0,j=0,F=Hp*e.props.scale;if(u&&!u.isExact){const N=xe.applyToPoint(B,E),H=xe.applyToPoint(B,w.center),ie=xe.applyToPoint(B,O),U=xe.Inverse(u.transform),ke=xe.applyToPoint(U,N),ge=xe.applyToPoint(U,H),Te=xe.applyToPoint(U,ie),{isClosed:ye}=u;let Se,Re=Array.from(u.geometry.intersectCircle(ge,w.radius,{includeLabels:!1,includeInternal:!1}));if(Re.length){const $e=ge.angle(ke),Ft=ge.angle(Te),rn=b($e,Ft);Re=Re.filter(Kt=>b($e,ge.angle(Kt))<=rn);const Dt=rn*.25;Re.sort(ye?(Kt,Gt)=>Math.abs(b($e,ge.angle(Kt))-Dt)<Math.abs(b($e,ge.angle(Gt))-Dt)?-1:1:(Kt,Gt)=>b($e,ge.angle(Kt))<b($e,ge.angle(Gt))?-1:1),Se=Re[0]}if(!Se)if(ye){const $e=u.geometry.nearestPoint(ke,{includeInternal:!1,includeLabels:!1});T.DistMin($e,ke,1)&&(Se=$e)}else Se=ke;if(Se&&(E.setTo(t.getPointInShapeSpace(e,xe.applyToPoint(u.transform,Se))),u.didIntersect=!0,i!=="none")){const $e=xs[e.props.size]/2+("size"in u.shape.props?xs[u.shape.props.size]/2:0);L=(wy+$e)*e.props.scale,F+=$e*e.props.scale}}if(p&&!p.isExact){const N=xe.applyToPoint(B,E),H=xe.applyToPoint(B,O),ie=xe.applyToPoint(B,w.center),U=xe.Inverse(p.transform),ke=xe.applyToPoint(U,N),ge=xe.applyToPoint(U,ie),Te=xe.applyToPoint(U,H),ye=p.isClosed;let Se,Re=Array.from(p.geometry.intersectCircle(ge,w.radius,{includeLabels:!1,includeInternal:!1}));if(Re.length){const $e=ge.angle(ke),Ft=ge.angle(Te),rn=b($e,Ft),Dt=rn*.75;Re=Re.filter(Kt=>b($e,ge.angle(Kt))<=rn),Re.sort(ye?(Kt,Gt)=>Math.abs(b($e,ge.angle(Kt))-Dt)<Math.abs(b($e,ge.angle(Gt))-Dt)?-1:1:(Kt,Gt)=>b($e,ge.angle(Kt))<b($e,ge.angle(Gt))?-1:1),Se=Re[0]}if(!Se)if(ye){const $e=p.geometry.nearestPoint(Te,{includeInternal:!1,includeLabels:!1});T.DistMin($e,Te,1)&&(Se=$e)}else Se=Te;if(Se&&(O.setTo(t.getPointInShapeSpace(e,xe.applyToPoint(p.transform,Se))),p.didIntersect=!0,r!=="none")){const $e=xs[e.props.size]/2+("size"in p.shape.props?xs[p.shape.props.size]/2:0);j=(wy+$e)*e.props.scale,F+=$e*e.props.scale}}let z=T.Angle(w.center,E),$=T.Angle(w.center,O),V=b(z,$),Y=V*w.radius;const re=E.clone(),q=O.clone();if(L!==0&&re.setTo(w.center).add(T.FromAngle(z+V*(L/Y*(x?1:-1))).mul(w.radius)),j!==0&&q.setTo(w.center).add(T.FromAngle($+V*(j/Y*(x?-1:1))).mul(w.radius)),T.DistMin(re,q,F)){L!==0&&j!==0?(L*=-1.5,j*=-1.5):L!==0?L*=-2:j!==0&&(j*=-2);const N=.1-b(_,z)*w.radius,H=.1-b($,C)*w.radius;L=Math.max(L,N),j=Math.max(j,H)}if(L!==0&&E.setTo(w.center).add(T.FromAngle(z+V*(L/Y*(x?1:-1))).mul(w.radius)),j!==0&&O.setTo(w.center).add(T.FromAngle($+V*(j/Y*(x?-1:1))).mul(w.radius)),u&&p&&!u.isExact&&!p.isExact){z=T.Angle(w.center,E),$=T.Angle(w.center,O),V=b(z,$),Y=V*w.radius;const N=BM(t,u.shape.id,p.shape.id);N==="double-bound"&&Y<30?(E.setTo(f),O.setTo(y),D.setTo(v)):N==="safe"&&(u&&!u.didIntersect&&E.setTo(f),(p&&!p.didIntersect||b(_,z)>b(_,$))&&O.setTo(w.center).add(T.FromAngle(z+V*(Math.min(.9,Hp*e.props.scale/Y)*(x?1:-1))).mul(w.radius)))}iPe(w.center,w.radius,E,O,D,A,x),E.equals(O)&&(E.setTo(D.clone().addXY(1,1)),O.setTo(D.clone().subXY(1,1))),f.setTo(E),y.setTo(O),v.setTo(D);const X=$3(f,y,v);return{bindings:n,type:"arc",start:{point:f,handle:s.start,arrowhead:e.props.arrowheadStart},end:{point:y,handle:s.end,arrowhead:e.props.arrowheadEnd},middle:v,handleArc:w,bodyArc:X,isValid:X.length!==0&&isFinite(X.center.x)&&isFinite(X.center.y)}}function $3(t,e,n){const r=ZU(t,e,n)??T.Med(t,e),i=T.Dist(r,t),o=+T.Clockwise(t,n,e),s=((t.y-e.y)**2+(t.x-e.x)**2)**.5,a=((e.y-n.y)**2+(e.x-n.x)**2)**.5,l=((n.y-t.y)**2+(n.x-t.x)**2)**.5,c=Math.acos((a*a+l*l-s*s)/(2*a*l))*2,d=+(nn>c),u=(Sn-c)*(o?1:-1),p=u*i;return{center:r,radius:i,size:u,length:p,largeArcFlag:d,sweepFlag:o}}function iPe(t,e,n,r,i,o,s){const a=T.Angle(t,n),l=T.Angle(t,r);let c=Y2(a,l);if(s||(c=Sn-c),i.setTo(t).add(T.FromAngle(a+c*(.5*(s?1:-1))).mul(e)),c>o){i.rotWith(t,nn);const d=r.clone();r.setTo(n),n.setTo(d)}}const N3=["right","bottom","left","top"],oPe={top:{x:0,y:-1},right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0}},sPe={left:"x",right:"x",top:"y",bottom:"y"},Ip={top:"bottom",right:"left",bottom:"top",left:"right"},by={x:{v:(t,e)=>new T(t,e),loEdge:"left",hiEdge:"right",crossMid:"midY",gap:"gapX",midRange:"midXRange",self:"x",cross:"y",size:"width"},y:{v:(t,e)=>new T(e,t),loEdge:"top",hiEdge:"bottom",crossMid:"midX",gap:"gapY",midRange:"midYRange",self:"y",cross:"x",size:"height"}};function aPe(t,e){const n={min:t.min-e,max:t.max+e};return n.min>n.max?null:n}function lPe(t,e){return Ge(t.min<=t.max&&e.min<=e.max),t.min<=e.min&&e.max<=t.max?[{min:t.min,max:e.min},{min:e.max,max:t.max}]:e.max<=t.min||e.min>=t.max?[t]:e.min<=t.min&&t.max<=e.max?[]:Wb(t.min,e)?[{min:e.max,max:t.max}]:Wb(t.max,e)?[{min:t.min,max:e.min}]:[]}function AP(t,e){return{min:Math.min(t,e),max:Math.max(t,e)}}function Wb(t,e){return t>=e.min&&t<=e.max}function L3(t){return t.max-t.min}function iS(t){if(!t)return;const e=t.cross.min;t.cross.min=-t.cross.max,t.cross.max=-e,t.crossTarget=-t.crossTarget}function oS(t){t&&(t.value=-t.value,t.expanded=t.expanded===null?null:-t.expanded)}const Mr={Identity:{x:1,y:1,transpose:!1},Rotate90:{x:-1,y:1,transpose:!0},Rotate180:{x:-1,y:-1,transpose:!1},Rotate270:{x:1,y:-1,transpose:!0},FlipY:{x:1,y:-1,transpose:!1}};function cPe(t){return t.transpose?{x:t.y,y:t.x,transpose:!0}:t}function uPe(t,e){const n={...t};return e.transpose&&(ku(n,"x","y"),n.transpose=!n.transpose),e.x===-1&&(n.x=-n.x),e.y===-1&&(n.y=-n.y),n}function ku(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function z3(t,e){e.x=t.x*e.x,e.y=t.y*e.y,t.transpose&&ku(e,"x","y")}function _p(t,e){t.x===-1&&(e.x=-(e.x+e.width)),t.y===-1&&(e.y=-(e.y+e.height)),t.transpose&&(ku(e,"x","y"),ku(e,"width","height"))}function F3(t,e){t.x===-1&&(ku(e,"left","right"),iS(e.top),iS(e.bottom),oS(e.left),oS(e.right)),t.y===-1&&(ku(e,"top","bottom"),iS(e.left),iS(e.right),oS(e.top),oS(e.bottom)),t.transpose&&(ku(e,"left","top"),ku(e,"right","bottom"))}class dPe{options;A;B;common;gapX;gapY;midX;midY;bias;constructor(e){this.options=e.options,this.A=e.A,this.B=e.B,this.common=e.common,this.midX=e.midX,this.midY=e.midY,this.gapX=e.gapX,this.gapY=e.gapY,this.bias=new T(1,1)}transform=Mr.Identity;inverse=Mr.Identity;apply(e){if(this.transform=uPe(e,this.transform),this.inverse=cPe(this.transform),_p(e,this.A.original),_p(e,this.B.original),_p(e,this.common.original),_p(e,this.A.expanded),_p(e,this.B.expanded),_p(e,this.common.expanded),F3(e,this.A.edges),F3(e,this.B.edges),z3(e,this.bias),e.x===-1&&(this.gapX=-this.gapX,this.midX=this.midX===null?null:-this.midX),e.y===-1&&(this.gapY=-this.gapY,this.midY=this.midY===null?null:-this.midY),e.transpose){let n=this.midX;this.midX=this.midY,this.midY=n,n=this.gapX,this.gapX=this.gapY,this.gapY=n}}reset(){this.apply(this.inverse)}vec(e,n){const r=new T(e,n);return z3(this.inverse,r),r}}const Cp=.01;class Vo{constructor(e,n){this.info=e,this.name=n}points=[];add(e,n){return this.points.push(this.info.vec(e,n)),this}_midpointHandle=null;midpointHandle(e){Ge(this._midpointHandle===null,"midX/midY called multiple times");const n=T.Lrp(this.points[this.points.length-2],this.points[this.points.length-1],.5);return this._midpointHandle={axis:this.info.transform.transpose?e==="x"?"y":"x":e,point:n,segmentStart:this.points[this.points.length-2].clone(),segmentEnd:this.points[this.points.length-1].clone()},this}build(){const e=[];for(let n=0;n<this.points.length;n++){const r=this.points[n],i=e[e.length-1],o=e[e.length-2];if(!i||!o)e.push(r);else{const s=Math.abs(r.x-i.x),a=Math.abs(r.y-i.y),l=Math.abs(r.x-o.x),c=Math.abs(r.y-o.y);s<Cp&&a<Cp||(s<Cp&&l<Cp?i.y=r.y:a<Cp&&c<Cp?i.x=r.x:e.push(r))}}return{name:this.name,points:e,distance:hPe(e),aEdgePicking:"manual",bEdgePicking:"manual",skipPointsWhenDrawing:new Set,midpointHandle:this._midpointHandle}}}function hPe(t){let e=0;for(let n=0;n<t.length-1;n++){const r=t[n],i=t[n+1];e+=Math.abs(i.x-r.x)+Math.abs(i.y-r.y)}return e}function sS(t){const e=t.A.edges.right,n=t.B.edges.left;if(!e||!n)return null;if(e.crossTarget>n.crossTarget&&t.apply(Mr.FlipY),t.gapX>0&&t.midX!==null)return new Vo(t,"to left 1").add(e.value,e.crossTarget).add(t.midX,e.crossTarget).add(t.midX,n.crossTarget).midpointHandle("x").add(n.value,n.crossTarget).build();if(e.expanded===null||n.expanded===null)return null;if(t.midY!==null)return new Vo(t,"to left 2").add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,t.midY).add(n.expanded,t.midY).midpointHandle("y").add(n.expanded,n.crossTarget).add(n.value,n.crossTarget).build();const r=Math.abs(e.value-t.common.expanded.right)+Math.abs(e.crossTarget-t.common.expanded.bottom)+Math.abs(t.common.expanded.right-n.expanded)+Math.abs(t.common.expanded.bottom-n.crossTarget)+t.options.expandElbowLegLength+6,i=t.options.expandElbowLegLength+Math.abs(e.crossTarget-t.common.expanded.top)+Math.abs(e.expanded-t.common.expanded.left)+Math.abs(t.common.expanded.top-n.crossTarget)+Math.abs(t.common.expanded.left-n.value)+6+t.bias.y,o=t.gapX<0&&t.midX!==null?t.options.expandElbowLegLength+Math.abs(e.crossTarget-t.A.expanded.bottom)+t.common.expanded.width+Math.abs(t.A.expanded.bottom-t.B.expanded.top)+Math.abs(t.B.expanded.top-n.crossTarget)+t.options.expandElbowLegLength+8:1/0;return r<i&&r<o?new Vo(t,"to left 3").add(e.value,e.crossTarget).add(t.common.expanded.right,e.crossTarget).add(t.common.expanded.right,t.common.expanded.bottom).add(n.expanded,t.common.expanded.bottom).add(n.expanded,n.crossTarget).add(n.value,n.crossTarget).build():i<o?new Vo(t,"to left 4").add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,t.common.expanded.top).add(t.common.expanded.left,t.common.expanded.top).add(t.common.expanded.left,n.crossTarget).add(n.value,n.crossTarget).build():t.midX!==null?new Vo(t,"to left 5").add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,t.A.expanded.bottom).add(t.midX,t.A.expanded.bottom).add(t.midX,t.B.expanded.top).midpointHandle("y").add(n.expanded,t.B.expanded.top).add(n.expanded,n.crossTarget).add(n.value,n.crossTarget).build():null}function mm(t){const e=t.A.edges.right,n=t.B.edges.top;if(!e||!n)return null;if(e.crossTarget<(n.expanded??n.value)&&n.crossTarget>(e.expanded??e.value)||t.A.isPoint&&t.B.expanded.containsPoint(t.A.original.center))return new Vo(t,"to top 1").add(e.value,e.crossTarget).add(n.crossTarget,e.crossTarget).add(n.crossTarget,n.value).build();if(t.gapX>0&&t.midX!==null&&n.expanded!==null)return new Vo(t,"to top 2").add(e.value,e.crossTarget).add(t.midX,e.crossTarget).add(t.midX,n.expanded).midpointHandle("x").add(n.crossTarget,n.expanded).add(n.crossTarget,n.value).build();if(t.gapY>0&&e.expanded!==null&&n.crossTarget<e.expanded&&t.midY!==null)return new Vo(t,"to top 3").add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,t.midY).add(n.crossTarget,t.midY).midpointHandle("y").add(n.crossTarget,n.value).build();const r=Math.abs(e.value-t.common.expanded.right)+Math.abs(e.crossTarget-t.common.expanded.top)+Math.abs(n.crossTarget-t.common.expanded.right)+Math.abs(n.value-t.common.expanded.top),i=e.expanded!==null&&t.midY!==null&&n.expanded!==null?Math.abs(e.value-e.expanded)+Math.abs(t.B.expanded.left-e.expanded)+Math.abs(t.B.expanded.left-n.crossTarget)+Math.abs(e.crossTarget-t.B.expanded.top)+Math.abs(n.value-n.expanded):1/0,o=e.expanded!==null&&t.midX!==null&&n.expanded!==null?Math.abs(e.value-t.common.expanded.right)+Math.abs(e.crossTarget-t.A.expanded.bottom)+Math.abs(e.expanded-n.crossTarget)+Math.abs(t.A.expanded.bottom-n.expanded)+Math.abs(n.expanded-n.value):1/0;return r<i&&r<o?new Vo(t,"to top 4").add(e.value,e.crossTarget).add(t.common.expanded.right,e.crossTarget).add(t.common.expanded.right,t.common.expanded.top).add(n.crossTarget,t.common.expanded.top).add(n.crossTarget,n.value).build():n.expanded!==null&&e.expanded!==null&&t.midY!==null&&i<o?new Vo(t,"to top 5").add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,t.midY).add(t.B.expanded.left,t.midY).midpointHandle("y").add(t.B.expanded.left,n.expanded).add(n.crossTarget,n.expanded).add(n.crossTarget,n.value).build():n.expanded!==null&&e.expanded!==null&&t.midX!==null?new Vo(t,"to top 6").add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,t.A.expanded.bottom).add(t.midX,t.A.expanded.bottom).add(t.midX,n.expanded).midpointHandle("x").add(n.crossTarget,n.expanded).add(n.crossTarget,n.value).build():null}function aS(t){return t.apply(Mr.FlipY),mm(t)}function lS(t){const e=t.A.edges.right,n=t.B.edges.right;if(!e||!n)return null;if((t.gapX<=0||e.crossTarget>t.B.expanded.bottom||e.crossTarget<t.B.expanded.top)&&(n.value>t.A.original.left||n.crossTarget>t.A.expanded.bottom||n.crossTarget<t.A.expanded.top))return new Vo(t,"to right 1").add(e.value,e.crossTarget).add(t.common.expanded.right,e.crossTarget).add(t.common.expanded.right,n.crossTarget).add(n.value,n.crossTarget).build();if(t.midX===null)return null;if(n.expanded!==null&&t.gapX>=0){const r=Math.abs(n.crossTarget-t.B.expanded.bottom)+Math.abs(e.crossTarget-t.B.expanded.bottom),i=Math.abs(n.crossTarget-t.B.expanded.top)+Math.abs(e.crossTarget-t.B.expanded.top),o=r<i?"bottom":"top";return new Vo(t,`to right 2 via ${o}`).add(e.value,e.crossTarget).add(t.midX,e.crossTarget).add(t.midX,t.B.expanded[o]).midpointHandle("x").add(n.expanded,t.B.expanded[o]).add(n.expanded,n.crossTarget).add(n.value,n.crossTarget).build()}if(e.expanded!==null&&t.gapX<=0){const r=Math.abs(n.crossTarget-t.A.expanded.bottom)+Math.abs(e.crossTarget-t.A.expanded.bottom),i=Math.abs(n.crossTarget-t.A.expanded.top)+Math.abs(e.crossTarget-t.A.expanded.top),o=r<i?"bottom":"top";return new Vo(t,`to right 3 via ${o}`).add(e.value,e.crossTarget).add(e.expanded,e.crossTarget).add(e.expanded,t.A.expanded[o]).add(t.midX,t.A.expanded[o]).add(t.midX,n.crossTarget).midpointHandle("x").add(n.value,n.crossTarget).build()}return null}const pPe={top:{top:[Mr.Rotate270,lS],left:[Mr.Rotate270,mm],bottom:[Mr.Rotate270,sS],right:[Mr.Rotate270,aS]},right:{top:[Mr.Identity,mm],right:[Mr.Identity,lS],bottom:[Mr.Identity,aS],left:[Mr.Identity,sS]},bottom:{top:[Mr.Rotate90,sS],left:[Mr.Rotate90,aS],bottom:[Mr.Rotate90,lS],right:[Mr.Rotate90,mm]},left:{top:[Mr.Rotate180,aS],left:[Mr.Rotate180,lS],bottom:[Mr.Rotate180,mm],right:[Mr.Rotate180,sS]}};function Dr(t,e,n){const[r,i]=pPe[e][n];t.apply(r);const o=i(t);return t.reset(),o}function fPe(t,e){let n=null;if(Math.abs(t.gapX)+1>Math.abs(t.gapY)&&t.midX!==null)t.gapX>0?n=Dr(t,"right","left"):n=Dr(t,"left","right");else{const s=t.A.edges.right,a=t.A.edges.left,l=t.B.edges.top,c=t.B.edges.bottom;t.A.isPoint&&t.B.isPoint?t.gapY>0?n=Dr(t,"bottom","top"):n=Dr(t,"top","bottom"):s&&l&&(s.expanded??s.value)<=l.crossTarget&&s.crossTarget<=(l.expanded??l.value)?n=Dr(t,"right","top"):s&&c&&(s.expanded??s.value)<=c.crossTarget&&s.crossTarget>=(c.expanded??c.value)?n=Dr(t,"right","bottom"):a&&l&&(a.expanded??a.value)>=l.crossTarget&&a.crossTarget<=(l.expanded??l.value)?n=Dr(t,"left","top"):a&&c&&(a.expanded??a.value)>=c.crossTarget&&a.crossTarget>=(c.expanded??c.value)?n=Dr(t,"left","bottom"):t.gapY>0&&t.midY!==null?n=Dr(t,"bottom","top"):t.gapY<0&&t.midY!==null&&(n=Dr(t,"top","bottom"))}if(n)return n.aEdgePicking=e,n.bEdgePicking=e,n;const r=N3.filter(s=>t.A.edges[s]),i=N3.filter(s=>t.B.edges[s]),o=r.flatMap(s=>i.map(a=>[s,a,e,e]));return Bp(t,o)}function gPe(t,e){let n=null;const r=t.A.edges.right,i=t.A.edges.left,o=t.B.edges.top,s=t.B.edges.bottom;switch(e){case"right":t.gapX>0&&t.gapX>Math.abs(t.gapY)&&t.midX!==null?n=Dr(t,"right","left"):r&&o&&(r.expanded??r.value)<=o.crossTarget&&r.crossTarget<=(o.expanded??o.value)?n=Dr(t,"right","top"):r&&s&&(r.expanded??r.value)<=s.crossTarget&&r.crossTarget>=(s.expanded??s.value)&&(n=Dr(t,"right","bottom"));break;case"left":t.gapX<0&&Math.abs(t.gapX)>Math.abs(t.gapY)&&t.midX!==null?n=Dr(t,"left","right"):i&&o&&(i.expanded??i.value)>=o.crossTarget&&i.crossTarget<=(o.expanded??o.value)?n=Dr(t,"left","top"):i&&s&&(i.expanded??i.value)>=s.crossTarget&&i.crossTarget>=(s.expanded??s.value)&&(n=Dr(t,"left","bottom"));break;case"top":case"bottom":break;default:Wt(e)}if(n)return n.aEdgePicking="manual",n.bEdgePicking="auto",n;switch(e){case"top":return Bp(t,[["top","bottom","manual","auto"],["top","right","manual","auto"],["top","left","manual","auto"],["top","top","manual","auto"]]);case"bottom":return Bp(t,[["bottom","top","manual","auto"],["bottom","right","manual","auto"],["bottom","left","manual","auto"],["bottom","bottom","manual","auto"]]);case"left":return Bp(t,[["left","right","manual","auto"],["left","bottom","manual","auto"],["left","left","manual","auto"],["left","top","manual","auto"]]);case"right":return Bp(t,[["right","left","manual","auto"],["right","bottom","manual","auto"],["right","right","manual","auto"],["right","top","manual","auto"]])}}function mPe(t,e,n){const r=Dr(t,e,n);return r||(t.A.isPoint&&t.B.isPoint?Bp(t,[[Ip[e],Ip[n],"manual","manual"],[e,Ip[n],"manual","auto"],[Ip[e],n,"auto","manual"]]):t.A.isPoint?Dr(t,Ip[e],n):t.B.isPoint?Dr(t,e,Ip[n]):null)}function Bp(t,e){let n=null,r=1/0,i=1/0,o=0;for(const[s,a,l,c]of e){o+=1;const d=Dr(t,s,a);d&&(d.aEdgePicking=l,d.bEdgePicking=c,d.points.length<r?(r=d.points.length,i=d.distance,n=d):d.points.length===r&&d.distance+o<i&&(i=d.distance,n=d))}return n}function BY(t,e,n){const r=t.getShapeUtil(e.type).options,i={elbowMidpoint:e.props.elbowMidPoint,expandElbowLegLength:r.expandElbowLegLength[e.props.size]*e.props.scale,minElbowLegLength:r.minElbowLegLength[e.props.size]*e.props.scale};let o=B3(t,e,n.start,e.props.start),s=B3(t,e,n.end,e.props.end);o=V3(o,s,i),s=V3(s,o,i);const a=!!(!o.side&&s.side);let{aTerminal:l,bTerminal:c}=a?{aTerminal:s,bTerminal:o}:{aTerminal:o,bTerminal:s},d={top:$i(l,c,"top",i),right:$i(l,c,"right",i),bottom:$i(l,c,"bottom",i),left:$i(l,c,"left",i)},u={top:$i(c,l,"top",i),right:$i(c,l,"right",i),bottom:$i(c,l,"bottom",i),left:$i(c,l,"left",i)};const p=U3(d,l.side),f=U3(u,c.side);let y=!1;(!p||!f)&&(y=!0,p||(c=ym(c)),f||(l=ym(l)),c.bounds.containsPoint(l.target,i.expandElbowLegLength)&&(c=ym(c)),l.bounds.containsPoint(c.target,i.expandElbowLegLength)&&(l=ym(l))),y&&(d={top:$i(l,c,"top",i),right:$i(l,c,"right",i),bottom:$i(l,c,"bottom",i),left:$i(l,c,"left",i)},u={top:$i(c,l,"top",i),right:$i(c,l,"right",i),bottom:$i(c,l,"bottom",i),left:$i(c,l,"left",i)});const v=l.isPoint?l.bounds:l.bounds.clone().expandBy(i.expandElbowLegLength),x=c.isPoint?c.bounds:c.bounds.clone().expandBy(i.expandElbowLegLength),b={original:pe.Common([l.bounds,c.bounds]),expanded:pe.Common([v,x])};let w=c.bounds.minX-l.bounds.maxX;w<0&&(w=l.bounds.minX-c.bounds.maxX,w<0&&(w=0),w=-w);let _=c.bounds.minY-l.bounds.maxY;_<0&&(_=l.bounds.minY-c.bounds.maxY,_<0&&(_=0),_=-_);const C=l.minEndSegmentLength*3,A=c.minEndSegmentLength*3,E=(l.isPoint?C:i.minElbowLegLength)+(c.isPoint?A:i.minElbowLegLength);let O=null;w>E?O={a:l.isPoint?l.bounds.maxX+C:v.maxX,b:c.isPoint?c.bounds.minX-A:x.minX}:w<-E&&(O={a:l.isPoint?l.bounds.minX-C:v.minX,b:c.isPoint?c.bounds.maxX+A:x.maxX});let D=null;_>E?D={a:l.isPoint?l.bounds.maxY+C:v.maxY,b:c.isPoint?c.bounds.minY-A:x.minY}:_<-E&&(D={a:l.isPoint?l.bounds.minY-C:v.minY,b:c.isPoint?c.bounds.maxY+A:x.maxY});const B=a?1-i.elbowMidpoint:i.elbowMidpoint,L=O?St(O.a,O.b,B):null,j=D?St(D.a,D.b,B):null,F={options:i,swapOrder:a,A:{isPoint:l.isPoint,target:l.target,isExact:l.isExact,arrowheadOffset:l.arrowheadOffset,minEndSegmentLength:l.minEndSegmentLength,original:l.bounds,expanded:v,edges:d,geometry:l.geometry},B:{isPoint:c.isPoint,target:c.target,isExact:c.isExact,arrowheadOffset:c.arrowheadOffset,minEndSegmentLength:c.minEndSegmentLength,original:c.bounds,expanded:x,edges:u,geometry:c.geometry},common:b,gapX:w,gapY:_,midX:L,midY:j},z=new dPe(F),$=H3(l,c,F.A.edges),V=H3(c,l,F.B.edges);let Y;return $&&V?Y=mPe(z,$,V):$&&!V&&(Y=gPe(z,$)),Y||(Y=fPe(z,$||V?"fallback":"auto")),Y&&(W3("first",F.A,F.B,Y),W3("last",F.B,F.A,Y),bPe(Y,l,c),a&&Y.points.reverse()),{...F,route:Y,midXRange:O?a?{lo:O.b,hi:O.a}:{lo:O.a,hi:O.b}:null,midYRange:D?a?{lo:D.b,hi:D.a}:{lo:D.a,hi:D.b}:null}}function yPe(t,e){const n=t.swapOrder?t.B.target:t.A.target,r=t.swapOrder?t.A.target:t.B.target,i=T.ManhattanDist(e.points[0],e.points[1]),o=T.ManhattanDist(e.points[e.points.length-2],e.points[e.points.length-1]),s=T.ManhattanDist(n,e.points[1]),a=T.ManhattanDist(e.points[e.points.length-2],r),l=i-s,c=o-a,d=[n,...e.points,r];return{name:e.name,distance:e.distance+l+c,points:d.filter(u=>!e.skipPointsWhenDrawing.has(u)),aEdgePicking:e.aEdgePicking,bEdgePicking:e.bEdgePicking,skipPointsWhenDrawing:e.skipPointsWhenDrawing,midpointHandle:e.midpointHandle}}function vPe(t){return Ir(t.x,.5)&&Ir(t.y,.5)?null:Math.abs(t.x-.5)>Math.abs(t.y-.5)-1e-4?t.x<.5?"left":"right":t.y<.5?"top":"bottom"}function B3(t,e,n,r){const i=xs[e.props.size]*e.props.scale/2,o=i*e.props.scale*3;if(n){const s=t.getShape(n.toId),a=xPe(t,e,n.toId,n.props);if(a&&s){let l=0;const c=n.props.terminal==="start"?"arrowheadStart":"arrowheadEnd";if(e.props[c]!=="none"){const p="scale"in s.props?s.props.scale:1,f="size"in s.props?(xs[s.props.size]??0)*p/2:0;l=i+f+wy*e.props.scale}let d=null;const u=a.target;return n.props.isPrecise&&(d=vPe(T.RotWith(n.props.normalizedAnchor,{x:.5,y:.5},a.shapeToArrowTransform.rotation()))),{targetShapeId:n.toId,isPoint:!1,isExact:n.props.isExact,bounds:a.bounds,geometry:a.geometry,target:u,arrowheadOffset:l,minEndSegmentLength:o,side:d,snap:n.props.snap}}}return{targetShapeId:null,bounds:pe.FromCenter(r,{x:0,y:0}),geometry:null,isExact:!1,isPoint:!0,target:T.From(r),arrowheadOffset:0,minEndSegmentLength:o,side:null,snap:"none"}}function xPe(t,e,n,r){const i=r.terminal==="start"?e.props.arrowheadStart!=="none":e.props.arrowheadEnd!=="none",o=t.getShapeGeometry(n,i?void 0:{context:"@tldraw/arrow-without-arrowhead"});if(!o)return null;const s=t.getShapePageTransform(e.id),a=t.getShapePageTransform(n),l=s.clone().invert().multiply(a),c=o.transform(l),d={x:.5,y:.5},u=r.isPrecise?r.normalizedAnchor:d,p={x:St(o.bounds.minX,o.bounds.maxX,u.x),y:St(o.bounds.minY,o.bounds.maxY,u.y)},f={x:St(o.bounds.minX,o.bounds.maxX,d.x),y:St(o.bounds.minY,o.bounds.maxY,d.y)},y=xe.applyToPoint(l,p),v=xe.applyToPoint(l,f);return{bounds:c.bounds,geometry:c,target:y,center:v,shapeToArrowTransform:l}}const SPe={top:{expand:-1,main:"minY",opposite:"maxY",crossMid:"midX",crossMin:"minX",crossMax:"maxX",bRangeExpand:"max",crossAxis:"x"},bottom:{expand:1,main:"maxY",opposite:"minY",crossMid:"midX",crossMin:"minX",crossMax:"maxX",bRangeExpand:"min",crossAxis:"x"},left:{expand:-1,main:"minX",opposite:"maxX",crossMid:"midY",crossMin:"minY",crossMax:"maxY",bRangeExpand:"max",crossAxis:"y"},right:{expand:1,main:"maxX",opposite:"minX",crossMid:"midY",crossMin:"minY",crossMax:"maxY",bRangeExpand:"min",crossAxis:"y"}};function $i(t,e,n,r){const i=SPe[n],o=t.targetShapeId===e.targetShapeId&&t.targetShapeId!==null&&(t.snap==="edge"||t.snap==="edge-point")&&(e.snap==="edge"||e.snap==="edge-point"),s=t.bounds[i.main],a=t.isPoint?null:s+i.expand*r.expandElbowLegLength,l=AP(t.bounds[i.crossMin],t.bounds[i.crossMax]);let c=l;if(!c)return null;Ge(l);const d=AP(e.bounds[i.main],e.bounds[i.opposite]);e.isPoint||(d[i.bRangeExpand]-=r.minElbowLegLength*2*i.expand);const u=aPe(AP(e.bounds[i.crossMin],e.bounds[i.crossMax]),r.expandElbowLegLength);Ge(d&&u);let p=!1;if(Wb(s,d)&&!t.isPoint&&!e.isPoint&&!o){const y=lPe(c,u);switch(y.length){case 0:return null;case 1:p=y[0]!==c,c=y[0];break;case 2:p=!0,c=L3(y[0])>L3(y[1])?y[0]:y[1];break;default:Wt(y)}}if(!Wb(t.target[i.crossAxis],c))return null;const f=t.target[i.crossAxis];return{value:s,expanded:a,cross:c,crossTarget:f,isPartial:p}}function U3(t,e){return e===null?!!(t.bottom||t.left||t.right||t.top):e==="x"?!!t.left||!!t.right:e==="y"?!!t.top||!!t.bottom:!!t[e]}function H3(t,e,n){switch(t.side){case null:return null;case"x":return t.bounds.center.x>e.bounds.center.x&&n?.left?"left":n?.right?"right":null;case"y":return t.bounds.center.y>e.bounds.center.y&&n?.top?"top":n?.bottom?"bottom":null;default:return t.side}}function ym(t){if(t.isPoint)return t;let e=null,n=0;return(t.snap==="edge"||t.snap==="edge-point")&&(n=t.arrowheadOffset,(t.side==="x"||t.side==="left"||t.side==="right")&&(e="x"),(t.side==="y"||t.side==="top"||t.side==="bottom")&&(e="y")),{targetShapeId:t.targetShapeId,side:e,bounds:new pe(t.target.x,t.target.y,0,0),geometry:t.geometry,target:t.target,arrowheadOffset:n,minEndSegmentLength:t.minEndSegmentLength,isExact:t.isExact,isPoint:!0,snap:t.snap}}function W3(t,e,n,r){if(!e.geometry)return;const i=t==="first"?r.points[0]:r.points[r.points.length-1],o=t==="first"?r.points[1]:r.points[r.points.length-2],s=e.geometry.isClosed?o:e.target,a=T.ManhattanDist(i,s);let l=null,c=1/0;if(e.isExact)l=e.target;else if(e.geometry){const d=e.geometry.intersectLineSegment(o,e.target,{includeLabels:!1,includeInternal:!1});e.geometry.hitTestPoint(e.target,Math.max(1,e.arrowheadOffset),!0,bl.EXCLUDE_NON_STANDARD)&&d.push(e.target);for(const u of d){const p=T.ManhattanDist(s,u);p<c&&(c=p,l=u)}}if(l){let d=e.arrowheadOffset;const u=T.ManhattanDist(o,l),p=e.arrowheadOffset*2;if(u<p){const x=p-e.arrowheadOffset;d=u-x}d<e.minEndSegmentLength&&(e.geometry.bounds.containsPoint(n.target)?d=Math.max(0,d):d=-e.arrowheadOffset);let f=l,y=!1;if(!e.isExact&&d!==0){const x=T.Nudge(l,o,d);f=x,d<0&&!e.geometry.hitTestPoint(x,0,!0,bl.EXCLUDE_NON_STANDARD)?f=l:(d<0&&(y=!0),f=x)}const v=T.ManhattanDist(o,f);if(r.distance+=v-a,i.x=f.x,i.y=f.y,y){const x=T.Lrp(o,i,.5);r.skipPointsWhenDrawing.add(x),r.points.splice(t==="first"?1:r.points.length-1,0,x)}}}function bPe(t,e,n){if(t){if(t.points.length>=3){const r=t.points[0],i=t.points[1];if(T.ManhattanDist(r,i)<e.minEndSegmentLength&&(t.points.splice(1,1),t.points.length>=3)){const s=Ir(r.x,i.x)?"y":"x";t.points[1][s]=r[s]}}if(t.points.length>=3){const r=t.points[t.points.length-1],i=t.points[t.points.length-2];if(T.ManhattanDist(r,i)<n.minEndSegmentLength&&(t.points.splice(t.points.length-2,1),t.points.length>=3)){const s=Ir(r.x,i.x)?"y":"x";t.points[t.points.length-2][s]=r[s]}}}}function V3(t,e,n){if(!t.geometry||t.geometry.isClosed)return t;const r=t.geometry.uninterpolateAlongEdge(t.target,bl.EXCLUDE_NON_STANDARD),i=t.geometry.interpolateAlongEdge(r-.01/t.geometry.length),s=t.geometry.interpolateAlongEdge(r+.01/t.geometry.length).sub(i).per().uni(),a=Math.abs(s.x)>Math.abs(s.y)?by.x:by.y;if(t.geometry.bounds.containsPoint(e.target,n.expandElbowLegLength))return t.side=a.self,ym(t);const l=a.v(t.target[a.self]-t.bounds[a.size]*2,t.target[a.cross]),c=a.v(t.target[a.self]+t.bounds[a.size]*2,t.target[a.cross]);let d=null,u=0,p=null,f=0,y=a.self;for(const v of t.geometry.intersectLineSegment(l,c,bl.EXCLUDE_NON_STANDARD))Math.abs(v[a.self]-t.target[a.self])<1||(v[a.self]<t.target[a.self]?T.ManhattanDist(v,t.target)>u&&(u=T.ManhattanDist(v,t.target),d=v):T.ManhattanDist(v,t.target)>f&&(f=T.ManhattanDist(v,t.target),p=v));return d&&p?u>f?y=a.hiEdge:y=a.loEdge:d&&!p?y=a.hiEdge:!d&&p&&(y=a.loEdge),t.side=y,t}const wPe=8;function kPe(t){return t.props.kind!=="arc"?!1:Math.abs(t.props.bend)<wPe*t.props.scale}function Vb(t,e,n){const r=t.getBindingsFromShape(e,"arrow").find(l=>l.props.terminal===n);if(!r)return;const i=t.getShape(r.toId);if(!i)return;const o=t.getShapePageTransform(i),s=n==="start"?e.props.arrowheadStart!=="none":e.props.arrowheadEnd!=="none",a=t.getShapeGeometry(i,s?void 0:{context:"@tldraw/arrow-without-arrowhead"});return{shape:i,transform:o,isClosed:a.isClosed,isExact:r.props.isExact,didIntersect:!1,geometry:a}}function K3(t,e,n,r){const i=t.getShape(n.toId);if(i){const{point:o,size:s}=t.getShapeGeometry(i).bounds,a=T.Add(o,T.MulV(n.props.isPrecise||r?n.props.normalizedAnchor:{x:.5,y:.5},s)),l=xe.applyToPoint(t.getShapePageTransform(i),a);return xe.applyToPoint(xe.Inverse(e),l)}else return new T(0,0)}const IPe=Gw("arrow bindings",(t,e)=>{const n=t.getBindingsFromShape(e.id,"arrow");return{start:n.find(r=>r.props.terminal==="start"),end:n.find(r=>r.props.terminal==="end")}},{areRecordsEqual:(t,e)=>t.id===e.id,areResultsEqual:(t,e)=>t.start===e.start&&t.end===e.end});function Zr(t,e){return IPe.get(t,e.id)}const _Pe=Gw("arrow info",(t,e)=>{const n=Zr(t,e);if(e.props.kind==="elbow"){const r=BY(t,e,n);if(!r?.route)return Hb(t,e,n);const i=r.swapOrder?r.B:r.A,o=r.swapOrder?r.A:r.B;return{type:"elbow",bindings:n,start:{handle:i.target,point:r.route.points[0],arrowhead:e.props.arrowheadStart},end:{handle:o.target,point:r.route.points[r.route.points.length-1],arrowhead:e.props.arrowheadEnd},elbow:r,route:r.route,isValid:!0}}return kPe(e)?Hb(t,e,n):rPe(t,e,n)},{areRecordsEqual:(t,e)=>t.props===e.props,areResultsEqual:ese});function ea(t,e){const n=typeof e=="string"?e:e.id;return _Pe.get(t,n)}function Up(t,e,n){const r=t.getShapePageTransform(e),i=BM(t,n.start?.toId,n.end?.toId),o=n.start?K3(t,r,n.start,i==="double-bound"||i==="start-contains-end"):T.From(e.props.start),s=n.end?K3(t,r,n.end,i==="double-bound"||i==="end-contains-start"):T.From(e.props.end);return{start:o,end:s}}function Wg(t,e,n,r){const i=typeof e=="string"?e:e.id,o=typeof n=="string"?n:n.id,s=t.getBindingsFromShape(i,"arrow").filter(l=>l.props.terminal===r.terminal);s.length>1&&t.deleteBindings(s.slice(1));const a=s[0];a?t.updateBinding({...a,toId:o,props:r}):t.createBinding({type:"arrow",fromId:i,toId:o,props:r})}function vm(t,e,n){const r=t.getBindingsFromShape(e,"arrow").filter(i=>i.props.terminal===n);t.deleteBindings(r)}const Hp=10,wy=10,CPe=10,xs={s:2,m:3.5,l:5,xl:10};function BM(t,e,n){if(!e||!n)return"safe";if(e===n)return"double-bound";const r=t.getShapePageBounds(e),i=t.getShapePageBounds(n);if(r&&i){if(r.contains(i))return"start-contains-end";if(i.contains(r))return"end-contains-start"}return"safe"}function PPe(t){return t.getSelectedShapeIds().map(r=>t.getShape(r)).filter(r=>{if(!r)return!1;if(t.isShapeOfType(r,"arrow")){const i=Zr(t,r);if(i.start||i.end)return!1}return!0})}const UY=()=>{const t=ne();return J("threeStackableItems",()=>PPe(t).length>2,[t])},Cc=()=>{const t=ne();return J("isInSelectState",()=>t.isIn("select"),[t])},HY=()=>{const t=ne();return J("allow group",()=>{const e=t.getSelectedShapes();if(e.length<2)return!1;for(const n of e)if(t.isShapeOfType(n,"arrow")){const r=Zr(t,n);if(r.start&&!e.some(i=>i.id===r.start.toId)||r.end&&!e.some(i=>i.id===r.end.toId))return!1}return!0},[t])},WY=()=>{const t=ne();return J("allowUngroup",()=>t.getSelectedShapeIds().some(e=>t.getShape(e)?.type==="group"),[t])},TPe=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read;function VY(t,e){const n=ne();return J("selectedShapes",()=>n.getSelectedShapes().length>=t,[n,t,e])}function Po(t,e){const n=ne();return J("selectedShapes",()=>{const r=n.getSelectedShapes().filter(i=>!n.isShapeOrAncestorLocked(i)).length;return t===void 0?r:r>=t},[n])}function EPe(){const t=ne();return J("showAutoSizeToggle",()=>{const e=t.getSelectedShapes();return e.length===1&&t.isShapeOfType(e[0],"text")&&e[0].props.autoSize===!1},[t])}function KY(){const t=ne();return J("hasLinkShapeSelected",()=>{const e=t.getOnlySelectedShape();return!!(e&&e.type!=="embed"&&"url"in e.props&&!e.isLocked)},[t])}function APe(){const t=ne();return J("onlyFlippableShape",()=>{const e=t.getOnlySelectedShape();return e&&(t.isShapeOfType(e,"group")||t.isShapeOfType(e,"image")||t.isShapeOfType(e,"arrow")||t.isShapeOfType(e,"line")||t.isShapeOfType(e,"draw"))},[t])}function qY(){const t=ne();return J("useCanRedo",()=>t.getCanRedo(),[t])}function GY(){const t=ne();return J("useCanUndo",()=>t.getCanUndo(),[t])}function MPe(){return g.jsxs(g.Fragment,{children:[g.jsx(OPe,{}),g.jsx(DPe,{}),g.jsx(jPe,{}),g.jsx(RPe,{}),g.jsx($Pe,{}),g.jsx(zPe,{}),g.jsx(FPe,{}),g.jsx(BPe,{})]})}function OPe(){const t=Po(2),e=Cc(),n=t&&e;return g.jsxs(g.Fragment,{children:[g.jsx(me,{actionId:"align-left",disabled:!n}),g.jsx(me,{actionId:"align-center-horizontal",disabled:!n}),g.jsx(me,{actionId:"align-right",disabled:!n}),g.jsx(me,{actionId:"stretch-horizontal",disabled:!n}),g.jsx(me,{actionId:"align-top",disabled:!n}),g.jsx(me,{actionId:"align-center-vertical",disabled:!n}),g.jsx(me,{actionId:"align-bottom",disabled:!n}),g.jsx(me,{actionId:"stretch-vertical",disabled:!n})]})}function DPe(){const t=Po(3),e=Cc(),n=t&&e;return g.jsxs(g.Fragment,{children:[g.jsx(me,{actionId:"distribute-horizontal",disabled:!n}),g.jsx(me,{actionId:"distribute-vertical",disabled:!n})]})}function jPe(){const t=UY(),e=Cc(),n=t&&e;return g.jsxs(g.Fragment,{children:[g.jsx(me,{actionId:"stack-horizontal",disabled:!n}),g.jsx(me,{actionId:"stack-vertical",disabled:!n})]})}function RPe(){const t=Po(1),e=Cc(),n=t&&e;return g.jsxs(g.Fragment,{children:[g.jsx(me,{actionId:"send-to-back",disabled:!n}),g.jsx(me,{actionId:"send-backward",disabled:!n}),g.jsx(me,{actionId:"bring-forward",disabled:!n}),g.jsx(me,{actionId:"bring-to-front",disabled:!n})]})}function $Pe(){return Ci()<nr.TABLET_SM?g.jsx(NPe,{}):g.jsx(LPe,{})}function NPe(){const t=ne(),e=J("zoom is 1",()=>t.getZoomLevel()===1,[t]);return g.jsx(me,{actionId:"zoom-to-100",disabled:e})}function LPe(){const t=Po(1),e=Cc(),n=t&&e;return g.jsx(me,{actionId:"rotate-ccw",disabled:!n})}function zPe(){const t=Po(1),e=Cc(),n=t&&e;return g.jsx(me,{actionId:"rotate-cw",disabled:!n})}function FPe(){const t=KY(),e=Cc(),n=t&&e;return g.jsx(me,{actionId:"edit-link",disabled:!n})}function BPe(){const t=HY(),e=WY();return t?g.jsx(q3,{}):e?g.jsx(UPe,{}):g.jsx(q3,{})}function q3(){const t=Po(2),e=Cc(),n=t&&e;return g.jsx(me,{actionId:"group",disabled:!n})}function UPe(){return g.jsx(me,{actionId:"ungroup"})}const HPe=I.memo(function({children:e}){const n=Ve(),r=Ci(),i=Os(),{orientation:o}=yv(),s=I.useRef(null);Rl(s);const a=ne(),l=J("should display quick actions when in readonly",()=>a.isInAny("hand","zoom"),[a]),c=e??g.jsx(MPe,{});if(!(i&&!l))return g.jsxs(dh,{id:"actions-menu",children:[g.jsx(hh,{children:g.jsx(vn,{type:"icon","data-testid":"actions-menu.button",title:n("actions-menu.title"),children:g.jsx(it,{icon:o==="horizontal"?"dots-vertical":"dots-horizontal",small:!0})})}),g.jsx(ph,{side:o==="horizontal"?r>=nr.TABLET?"bottom":"top":"right",sideOffset:6,children:g.jsx(ko,{ref:s,label:n("actions-menu.title"),className:"tlui-actions-menu","data-testid":"actions-menu.content",orientation:"grid",children:g.jsx(qi,{type:"icons",sourceId:"actions-menu",children:c})})})]})});function WPe(){const t=ne(),e=u1(),n=J("isSelectToolActive",()=>t.getCurrentToolId()==="select",[t]),r=J("isSinglePageMode",()=>t.options.maxPages<=1,[t]);return n?g.jsxs(g.Fragment,{children:[e&&g.jsx(MAe,{}),g.jsxs(bt,{id:"modify",children:[g.jsx(pAe,{}),g.jsx(fAe,{}),g.jsx(yAe,{}),!r&&g.jsx(vAe,{})]}),g.jsx(UX,{}),g.jsx(HX,{}),g.jsx(bt,{id:"select-all",children:g.jsx(WX,{})})]}):null}const VPe=I.memo(function({children:e,disabled:n=!1}){const r=ne(),i=Ve(),{Canvas:o}=gn(),s=I.useCallback(p=>{p.key==="Escape"&&(p.stopPropagation(),r.getContainer().focus())},[r]);I.useEffect(()=>()=>{document.body.removeEventListener("keydown",s,{capture:!0})},[s]);const a=I.useCallback(p=>{if(p){if(document.body.addEventListener("keydown",s,{capture:!0}),r.getInstanceState().isCoarsePointer){const f=r.getSelectedShapes(),{inputs:{currentPagePoint:y}}=r,v=r.getShapesAtPoint(y);if(!r.getSelectedShapes().length||!v.some(x=>f.includes(x))){const x=v.filter(b=>r.isShapeOrAncestorLocked(b));x.length&&r.select(...x.map(b=>b.id))}}}else{const f=r.getOnlySelectedShape();f&&r.isShapeOrAncestorLocked(f)&&r.setSelectedShapes([]),r.timers.requestAnimationFrame(()=>{document.body.removeEventListener("keydown",s,{capture:!0})})}},[r,s]),l=Cr(),[c,d]=_c("context menu",a),u=e??g.jsx(WPe,{});return g.jsxs(Uke,{dir:"ltr",onOpenChange:d,modal:!1,children:[g.jsx(Hke,{onContextMenu:void 0,dir:"ltr",disabled:n,children:o?g.jsx(o,{}):null}),c&&g.jsx(Wke,{container:l,children:g.jsx(Vke,{className:"tlui-menu tlui-scrollable","data-testid":"context-menu","aria-label":i("context-menu.title"),alignOffset:-4,collisionPadding:4,onContextMenu:dt,children:g.jsx(qi,{type:"context-menu",sourceId:"context-menu",children:u})})})]})}),KPe=2e3,qPe=5e3,GPe=_r(function(){const e=ne(),{isChatting:n,chatMessage:r}=e.getInstanceState(),i=I.useRef(-1),[o,s]=I.useState("");return I.useEffect(()=>{if(!n&&r||n){const l=n?qPe:KPe;i.current=e.timers.setTimeout(()=>{e.updateInstanceState({chatMessage:"",isChatting:!1}),s(""),e.focus()},l)}return()=>{clearTimeout(i.current)}},[e,r,n]),n?g.jsx(XPe,{value:o,setValue:s,chatMessage:r}):r.trim()?g.jsx(YPe,{chatMessage:r}):null});function YY(t){const e=ne();I.useLayoutEffect(()=>{if(!t.current)return;const{x:r,y:i}=e.inputs.currentScreenPoint;t.current?.style.setProperty("transform",`translate(${r}px, ${i}px)`);function o(s){const{minX:a,minY:l}=e.getViewportScreenBounds();t.current?.style.setProperty("transform",`translate(${s.clientX-a}px, ${s.clientY-l}px)`)}return window.addEventListener("pointermove",o),()=>{window.removeEventListener("pointermove",o)}},[t,e])}const YPe=({chatMessage:t})=>{const e=ne(),n=I.useRef(null);return YY(n),g.jsx("div",{ref:n,className:"tl-cursor-chat tl-cursor-chat__bubble",style:{backgroundColor:e.user.getColor()},children:t})},XPe=_r(function({chatMessage:e,value:n,setValue:r}){const i=ne(),o=Ve(),s=I.useRef(null),a=e||o("cursor-chat.type-to-chat");YY(s),I.useLayoutEffect(()=>{const p=s.current;if(!p)return;const f=i.textMeasure.measureText(n||a,{fontFamily:"var(--font-body)",fontSize:12,fontWeight:"500",fontStyle:"normal",maxWidth:null,lineHeight:1,padding:"6px"});p.style.setProperty("width",f.w+"px")},[i,n,a]),I.useLayoutEffect(()=>{const p=i.timers.requestAnimationFrame(()=>{s.current?.focus()});return()=>{cancelAnimationFrame(p)}},[i]);const l=I.useCallback(()=>{i.updateInstanceState({isChatting:!1}),i.focus()},[i]),c=I.useCallback(p=>{const{value:f}=p.target;r(f.slice(0,64)),i.updateInstanceState({chatMessage:f})},[i,r]),d=I.useCallback(p=>{const f=s.current;if(!f)return;const{value:y}=f;switch(p.key){case"Enter":{if(dt(p),p.stopPropagation(),!y){l();return}r("");break}case"Escape":{dt(p),p.stopPropagation(),l();break}}},[l,r]),u=I.useCallback(p=>{p.stopPropagation()},[]);return g.jsx("input",{ref:s,className:"tl-cursor-chat",style:{backgroundColor:i.user.getColor()},onBlur:l,onChange:c,onKeyDown:d,onPaste:u,value:n,placeholder:a,spellCheck:!1})});function _E({checked:t}){const e=Ve();return g.jsx(Ml,{"data-checked":!!t,label:e(t?"ui.checked":"ui.unchecked"),icon:t?"check":"none",className:"tlui-button__icon",small:!0})}function xv({id:t,kbd:e,label:n,lang:r,readonlyOk:i,onSelect:o,toggle:s=!1,disabled:a=!1,checked:l=!1}){const{type:c,sourceId:d}=c1(),u=Os(),p=Ve();if(u&&!i)return null;const f=_y(n,c),y=f?p(f):void 0;switch(c){case"menu":return g.jsxs(cG,{dir:"ltr",lang:r,className:"tlui-button tlui-button__menu tlui-button__checkbox",title:y,onSelect:v=>{o?.(d),dt(v)},disabled:a,checked:l,children:[g.jsx(Ml,{small:!0,label:p(l?"ui.checked":"ui.unchecked"),icon:s?l?"toggle-on":"toggle-off":l?"check":"none"}),y&&g.jsx("span",{className:"tlui-button__label",draggable:!1,children:y}),e&&g.jsx(Nm,{children:e})]});case"context-menu":return g.jsxs(qke,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",lang:r,title:y,onSelect:v=>{o(d),dt(v)},disabled:a,checked:l,children:[g.jsx(Ml,{small:!0,label:p(l?"ui.checked":"ui.unchecked"),icon:s?l?"toggle-on":"toggle-off":l?"check":"none"}),y&&g.jsx("span",{className:"tlui-button__label",draggable:!1,children:y}),e&&g.jsx(Nm,{children:e})]},t);default:return null}}function eo({id:t,disabled:e=!1,label:n,size:r="small",children:i}){const{type:o,sourceId:s}=c1(),a=Cr(),l=Ve(),c=n?typeof n=="string"?n:n[o]??n.default:void 0,d=c?l(c):void 0;switch(o){case"menu":return g.jsxs(pCe,{id:`${s}-sub.${t}`,children:[g.jsx(fCe,{id:`${s}-sub.${t}-button`,disabled:e,label:d,title:d}),g.jsx(gCe,{id:`${s}-sub.${t}-content`,size:r,children:i})]});case"context-menu":return e?null:g.jsxs(ZPe,{id:`${s}-sub.${t}`,children:[g.jsx(Yq,{dir:"ltr",disabled:e,asChild:!0,children:g.jsxs(It,{"data-testid":`${s}-sub.${t}-button`,type:"menu",className:"tlui-menu__submenu__trigger",children:[g.jsx(dr,{children:d}),g.jsx(it,{icon:"chevron-right",small:!0})]})}),g.jsx(mM,{container:a,children:g.jsx(Xq,{"data-testid":`${s}-sub.${t}-content`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":r,children:i})})]});default:return i}}function ZPe({id:t,children:e}){const[n,r]=_c(t);return g.jsx(Gq,{open:n,onOpenChange:r,children:e})}function JPe(){const t=ne(),{addToast:e}=Nl(),{addDialog:n}=vv(),[r,i]=rt.useState(!1);return g.jsxs(g.Fragment,{children:[g.jsxs(bt,{id:"items",children:[g.jsx($t,{id:"hard-reset",onSelect:r8,label:"Hard reset"}),g.jsx($t,{id:"add-toast",onSelect:()=>{e({id:Qt(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),e({id:Qt(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:Qt(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:Qt(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),g.jsx($t,{id:"show-dialog",label:"Show dialog",onSelect:()=>{n({component:({onClose:o})=>g.jsx(tTe,{displayDontShowAgain:!0,onCancel:()=>o(),onContinue:()=>o()}),onClose:()=>{}})}}),g.jsx($t,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>nTe(t,100)}),g.jsx($t,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{const o=t.getSelectedShapes(),s=o.length===0?t.getRenderingShapes():o;window.alert(`Shapes ${s.length}, DOM nodes:${document.querySelector(".tl-shapes").querySelectorAll("*")?.length}`)}}),(()=>{if(r)throw Error("oh no!");return null})(),g.jsx($t,{id:"throw-error",onSelect:()=>i(!0),label:"Throw error"})]}),g.jsxs(bt,{id:"flags",children:[g.jsx(QPe,{}),g.jsx(eTe,{})]})]})}function QPe(){const t=Object.values(Vn);return t.length?g.jsx(eo,{id:"debug flags",label:"Debug Flags",children:g.jsx(bt,{id:"debug flags",children:t.map(e=>g.jsx(XY,{flag:e},e.name))})}):null}function eTe(){const t=Object.values(Kce);return t.length?g.jsx(eo,{id:"feature flags",label:"Feature Flags",children:g.jsx(bt,{id:"feature flags",children:t.map(e=>g.jsx(XY,{flag:e},e.name))})}):null}function tTe({title:t="title",body:e="hello hello hello",cancel:n="Cancel",confirm:r="Continue",displayDontShowAgain:i=!1,maxWidth:o="350",onCancel:s,onContinue:a}){const[l,c]=rt.useState(!1);return g.jsxs(g.Fragment,{children:[g.jsxs(s1,{children:[g.jsx(a1,{children:t}),g.jsx(l1,{})]}),g.jsx(Sy,{style:{maxWidth:o},children:e}),g.jsxs(jM,{className:"tlui-dialog__footer__actions",children:[i&&g.jsxs(It,{type:"normal",onClick:()=>c(!l),style:{marginRight:"auto"},children:[g.jsx(_E,{checked:l}),g.jsx(dr,{children:"Don’t show again"})]}),g.jsx(It,{type:"normal",onClick:s,children:g.jsx(dr,{children:n})}),g.jsx(It,{type:"primary",onClick:async()=>a(),children:g.jsx(dr,{children:r})})]})]})}const XY=_r(function({flag:e,onChange:n}){const r=e.get();return g.jsx(xv,{id:e.name,title:e.name,label:e.name.replace(/([a-z0-9])([A-Z])/g,i=>`${i[0]} ${i[1].toLowerCase()}`).replace(/^[a-z]/,i=>i.toUpperCase()),checked:r,onSelect:()=>{e.set(!r),n?.(!r)}})});let G3=0;function nTe(t,e){const n=t.options.adjacentShapeMargin,r=Array(e),i=Math.floor(Math.sqrt(e));for(let o=0;o<e;o++)G3++,r[o]={id:sn("box"+G3),type:"geo",x:o%i*(100+n),y:Math.floor(o/i)*(100+n)};t.run(()=>{t.createShapes(r).setSelectedShapes(r.map(o=>o.id))})}function rTe({children:t}){const e=t??g.jsx(JPe,{});return g.jsxs(d1,{id:"debug",children:[g.jsx(h1,{children:g.jsx(It,{type:"icon",title:"Debug menu",children:g.jsx(it,{icon:"dots-horizontal"})})}),g.jsx(p1,{side:"top",align:"end",alignOffset:0,children:g.jsx(qi,{type:"menu",sourceId:"debug-panel",children:e})})]})}const iTe=I.memo(function(){const{DebugMenu:e}=zl(),n=I.useRef(null);return Rl(n),g.jsxs("footer",{ref:n,className:"tlui-debug-panel",children:[g.jsx(sTe,{}),g.jsx(aTe,{}),e&&g.jsx(e,{})]})});function oTe(t=!0){const[e,n]=I.useState(0),r=ne();I.useEffect(()=>{if(!t)return;const i=()=>n(o=>o+1);return r.on("tick",i),()=>{r.off("tick",i)}},[r,t])}const sTe=_r(function(){oTe();const e=ne(),n=e.getPath(),r=e.getHoveredShape(),i=e.getOnlySelectedShape(),o=n==="select.idle"||!n.includes("select.")?r:i,s=o&&n.includes("select.")?` / ${o.type||""}${"geo"in o.props?" / "+o.props.geo:""} / [${T.ToInt(e.getPointInShapeSpace(o,e.inputs.currentPagePoint))}]`:"",a=n.startsWith("select.")&&!n.includes(".idle")?` / [${T.ToInt(e.inputs.originPagePoint)}] → [${T.ToInt(e.inputs.currentPagePoint)}] = ${T.Dist(e.inputs.originPagePoint,e.inputs.currentPagePoint).toFixed(0)}`:"";return g.jsx("div",{className:"tlui-debug-panel__current-state",children:`${n}${s}${a}`})});function aTe(){const t=ne(),e=J("show_fps",()=>Vn.showFps.get(),[Vn]),n=I.useRef(null);return I.useEffect(()=>{if(!e)return;const r=250;let i=0,o=-1,s=performance.now(),a=0,l=0,c=!1;function d(){if(l++,a=performance.now()-s,a>r){const u=Math.round(l*(r/a)*(1e3/r));u>i&&(i=u);const p=i*.75;(u<p&&!c||u>=p&&c)&&(c=!c),n.current.innerHTML=`FPS ${u.toString()}`,n.current.className="tlui-debug-panel__fps"+(c?" tlui-debug-panel__fps__slow":""),a-=r,l=0,s=performance.now()}o=t.timers.requestAnimationFrame(d)}return d(),()=>{cancelAnimationFrame(o)}},[e,t]),e?g.jsx("div",{ref:n}):null}function lTe(){const t=ne(),e=J("follow",()=>t.getInstanceState().followingUserId,[t]);return e?g.jsx(cTe,{userId:e}):null}function cTe({userId:t}){const e=g0(t);return e?g.jsx("div",{className:"tlui-following-indicator",style:{borderColor:e.color}}):null}const uTe=I.memo(function(){const e=Ci(),n=Ve(),r=I.useRef(null);Rl(r);const{MainMenu:i,QuickActions:o,ActionsMenu:s,PageMenu:a}=zl(),l=ne(),c=J("isSinglePageMode",()=>l.options.maxPages<=1,[l]),d=l.options.actionShortcutsLocation==="menu"?!0:l.options.actionShortcutsLocation==="toolbar"?!1:e>=nr.TABLET;return!i&&!a&&!d?null:g.jsx("nav",{ref:r,className:"tlui-menu-zone",children:g.jsxs(Eh,{children:[i&&g.jsx(i,{}),a&&!c&&g.jsx(a,{}),d?g.jsxs(ko,{orientation:"horizontal",label:n("actions-menu.title"),children:[o&&g.jsx(o,{}),s&&g.jsx(s,{})]}):null]})})}),dTe=({id:t,component:e,onClose:n,preventBackgroundClose:r})=>{const{removeDialog:i}=vv(),o=I.useRef(!1),s=Cr(),a=I.useCallback(l=>{if(!l){if(n)try{n()}catch(c){console.warn(c)}i(t)}},[t,n,i]);return g.jsx(f0e,{onOpenChange:a,defaultOpen:!0,children:g.jsx(g0e,{container:s,children:g.jsx(m0e,{dir:"ltr",className:"tlui-dialog__overlay",onClick:l=>{o.current||!r&&l.target===l.currentTarget&&a(!1)},children:g.jsx(y0e,{dir:"ltr",className:"tlui-dialog__content","aria-describedby":void 0,onMouseDown:()=>o.current=!0,onMouseUp:()=>o.current=!1,onInteractOutside:l=>{o.current=!1,r&&l.preventDefault()},children:g.jsx(e,{onClose:()=>{o.current=!1,a(!1)}})})})})})},hTe=I.memo(function(){const{dialogs:e}=vv();return J("dialogs",()=>e.get(),[e]).map(r=>g.jsx(dTe,{...r},r.id))});function pTe(){const t=ne(),e=Fl(),[n,r]=I.useState(!1),i=I.useRef(!1);return Yd("toggle showback to content",()=>{const o=i.current,s=t.getCurrentPageShapeIds();let a=!1;s.size&&(a=s.size===t.getCulledShapes().size),o!==a&&(r(a),i.current=a)},[t]),n?g.jsx(me,{actionId:"back-to-content",onSelect:()=>{e["back-to-content"].onSelect("helper-buttons"),r(!1)}}):null}function fTe(){const t=ne();return J("is pen mode",()=>t.getInstanceState().isPenMode,[t])?g.jsx(me,{actionId:"exit-pen-mode"}):null}function gTe(){const t=ne(),e=Fl();return J("is following user",()=>!!t.getInstanceState().followingUserId,[t])?g.jsx($t,{...e["stop-following"]}):null}function ZY(){return g.jsxs(g.Fragment,{children:[g.jsx(fTe,{}),g.jsx(pTe,{}),g.jsx(gTe,{})]})}function JY({children:t}){const e=t??g.jsx(ZY,{});return g.jsx("div",{className:"tlui-helper-buttons",children:g.jsx(qi,{type:"helper-buttons",sourceId:"helper-buttons",children:e})})}const mTe=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function yTe(){const t=ne(),e=qn(),n=J("colorScheme",()=>t.user.getUserPreferences().colorScheme??(t.user.getIsDarkMode()?"dark":"light"),[t]);return g.jsx(eo,{id:"help menu color-scheme",label:"menu.theme",children:g.jsx(bt,{id:"theme",children:mTe.map(({colorScheme:r,label:i})=>g.jsx(xv,{id:`color-scheme-${r}`,label:i,checked:r===n,readonlyOk:!0,onSelect:()=>{t.user.updateUserPreferences({colorScheme:r}),e("color-scheme",{source:"menu",value:r})}},r))})})}function QY(){const t=hr(),e=qn(),n=J("locale",()=>t?.user.getLocale(),[t]);return t?g.jsx(eo,{id:"help menu language",label:"menu.language",children:g.jsx(bt,{id:"languages",className:"tlui-language-menu",children:ty.map(({locale:r,label:i})=>g.jsx(xv,{id:`language-${r}`,lang:r,title:r,label:i,checked:r===n,readonlyOk:!0,onSelect:()=>{t.user.updateUserPreferences({locale:r}),e("change-language",{source:"menu",locale:r})}},r))})}):null}function vTe(){return g.jsxs(g.Fragment,{children:[g.jsx(QY,{}),g.jsx(eX,{})]})}function eX(){const{KeyboardShortcutsDialog:t}=zl(),{addDialog:e}=vv(),n=I.useCallback(()=>{t&&e({component:t})},[e,t]);return t?g.jsx($t,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:n}):null}const xTe=["auto","trackpad","mouse"];function STe(){const t=ne(),e=qn(),n=J("inputMode",()=>t.user.getUserPreferences().inputMode,[t]),r=J("wheelBehavior",()=>t.getCameraOptions().wheelBehavior,[t]),i=s=>s==="auto"?n===null:n===s,o=(s,a)=>s==="auto"?`action.toggle-auto-${a}`:s==="trackpad"?"action.toggle-trackpad":"action.toggle-mouse";return g.jsx(eo,{id:"help menu input-mode",label:"menu.input-mode",children:g.jsx(bt,{id:"peripheral-mode",children:xTe.map(s=>g.jsx(xv,{id:`peripheral-mode-${s}`,label:o(s,r),checked:i(s),readonlyOk:!0,onSelect:()=>{switch(e("input-mode",{source:"menu",value:s}),s){case"auto":t.user.updateUserPreferences({inputMode:null});break;case"trackpad":t.user.updateUserPreferences({inputMode:"trackpad"});break;case"mouse":t.user.updateUserPreferences({inputMode:"mouse"});break}}},s))})})}function bTe(){return g.jsxs(g.Fragment,{children:[g.jsxs(bt,{id:"basic",children:[g.jsx(kTe,{}),g.jsx(PTe,{}),g.jsx(wTe,{}),g.jsx(TTe,{})]}),g.jsx(ETe,{})]})}function wTe(){return g.jsxs(eo,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[g.jsxs(bt,{id:"export-all-as-group",children:[g.jsx(me,{actionId:"export-all-as-svg"}),g.jsx(me,{actionId:"export-all-as-png"})]}),g.jsx(bt,{id:"export-all-as-bg",children:g.jsx(GM,{})})]})}function kTe(){return g.jsxs(eo,{id:"edit",label:"menu.edit",children:[g.jsx(CTe,{}),g.jsx(UX,{}),g.jsx(HX,{}),g.jsx(ITe,{}),g.jsx(_Te,{}),g.jsx(bt,{id:"select-all",children:g.jsx(WX,{})})]})}function ITe(){return g.jsxs(bt,{id:"misc",children:[g.jsx(jX,{}),g.jsx(RX,{}),g.jsx(OX,{}),g.jsx(MX,{}),g.jsx($X,{}),g.jsx(NX,{}),g.jsx(KX,{}),g.jsx(VX,{}),g.jsx(DX,{})]})}function _Te(){return g.jsxs(bt,{id:"lock",children:[g.jsx(LX,{}),g.jsx(aAe,{})]})}function CTe(){const t=GY(),e=qY();return g.jsxs(bt,{id:"undo-redo",children:[g.jsx(me,{actionId:"undo",disabled:!t}),g.jsx(me,{actionId:"redo",disabled:!e})]})}function PTe(){return g.jsx(eo,{id:"view",label:"menu.view",children:g.jsxs(bt,{id:"view-actions",children:[g.jsx(me,{actionId:"zoom-in"}),g.jsx(me,{actionId:"zoom-out"}),g.jsx(zX,{}),g.jsx(FX,{}),g.jsx(BX,{})]})})}function TTe(){return g.jsxs(g.Fragment,{children:[g.jsx(me,{actionId:"insert-embed"}),g.jsx(me,{actionId:"insert-media"})]})}function ETe(){return g.jsxs(bt,{id:"preferences",children:[g.jsxs(eo,{id:"preferences",label:"menu.preferences",children:[g.jsxs(bt,{id:"preferences-actions",children:[g.jsx(xAe,{}),g.jsx(SAe,{}),g.jsx(bAe,{}),g.jsx(wAe,{}),g.jsx(kAe,{}),g.jsx(IAe,{}),g.jsx(EAe,{}),g.jsx(AAe,{}),g.jsx(TAe,{})]}),g.jsxs(bt,{id:"user-interface-submenus",children:[g.jsx(STe,{}),g.jsx(yTe,{}),g.jsx(OAe,{})]})]}),g.jsx(QY,{}),g.jsx(eX,{})]})}const ATe=I.memo(function({children:e}){const n=Cr(),[r,i]=_c("main menu"),o=Ve(),s=e??g.jsx(bTe,{});return g.jsxs(yM,{dir:"ltr",open:r,onOpenChange:i,modal:!1,children:[g.jsx(vM,{asChild:!0,dir:"ltr",children:g.jsx(It,{type:"icon","data-testid":"main-menu.button",title:o("menu.title"),children:g.jsx(it,{icon:"menu",small:!0})})}),g.jsx(Q0,{container:n,children:g.jsx(xM,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:g.jsx(qi,{type:"menu",sourceId:"main-menu",children:s})})})]})}),MP={};function Vg(t){if(MP[t])return MP[t];const n=document.createElement("canvas").getContext("2d");n.fillStyle=t,n.fillRect(0,0,1,1);const[r,i,o,s]=n.getImageData(0,0,1,1).data,a=new Float32Array([r/255,i/255,o/255,s/255]);return MP[t]=a,a}const qS=10,tX=24*qS+12+48;function Op(t,{center:e,radius:n,numArcSegments:r=20,startAngle:i=0,endAngle:o=Sn,offset:s=0}){const a=(o-i)/r;let l=s;for(let c=i;c<o;c+=a)t[l++]=e.x,t[l++]=e.y,t[l++]=e.x+Math.cos(c)*n,t[l++]=e.y+Math.sin(c)*n,t[l++]=e.x+Math.cos(c+a)*n,t[l++]=e.y+Math.sin(c+a)*n;return t}function Dp(t,e,n,r,i,o){t[e++]=n,t[e++]=r,t[e++]=n,t[e++]=r+o,t[e++]=n+i,t[e++]=r,t[e++]=n+i,t[e++]=r,t[e++]=n,t[e++]=r+o,t[e++]=n+i,t[e++]=r+o}function MTe(t,e,n){const r=qS;n=Math.min(n,Math.min(e.w,e.h)/2);const i=pe.ExpandBy(e,-n);if(i.w<=0||i.h<=0)return Op(t,{center:e.center,radius:n,numArcSegments:qS*4}),qS*4*6;let o=0;return Dp(t,o,i.minX,i.minY,i.w,i.h),o+=12,Dp(t,o,i.minX,e.minY,i.w,n),o+=12,Dp(t,o,i.maxX,i.minY,n,i.h),o+=12,Dp(t,o,i.minX,i.maxY,i.w,n),o+=12,Dp(t,o,e.minX,i.minY,n,i.h),o+=12,Op(t,{numArcSegments:r,offset:o,center:i.point,radius:n,startAngle:nn,endAngle:nn*1.5}),o+=r*6,Op(t,{numArcSegments:r,offset:o,center:T.Add(i.point,new T(i.w,0)),radius:n,startAngle:nn*1.5,endAngle:Sn}),o+=r*6,Op(t,{numArcSegments:r,offset:o,center:T.Add(i.point,i.size),radius:n,startAngle:0,endAngle:br}),o+=r*6,Op(t,{numArcSegments:r,offset:o,center:T.Add(i.point,new T(0,i.h)),radius:n,startAngle:br,endAngle:nn}),tX}function OTe(t){if(!t)throw new Error("Canvas element not found");const e=t.getContext("webgl2",{premultipliedAlpha:!1});if(!e)throw new Error("Failed to get webgl2 context");const n=`#version 300 es
  precision mediump float;
  
  in vec2 shapeVertexPosition;

	uniform vec4 canvasPageBounds;

	// taken (with thanks) from
	// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html
  void main() {
		// convert the position from pixels to 0.0 to 1.0
		vec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;
	
		// convert from 0->1 to 0->2
		vec2 zeroToTwo = zeroToOne * 2.0;
	
		// convert from 0->2 to -1->+1 (clipspace)
		vec2 clipSpace = zeroToTwo - 1.0;
	
		gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
  }`,r=e.createShader(e.VERTEX_SHADER);if(!r)throw new Error("Failed to create vertex shader");if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("Failed to compile vertex shader");const i=`#version 300 es
  precision mediump float;
  
	uniform vec4 fillColor;
  out vec4 outputColor;

  void main() {
	outputColor = fillColor;
  }`,o=e.createShader(e.FRAGMENT_SHADER);if(!o)throw new Error("Failed to create fragment shader");if(e.shaderSource(o,i),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS))throw new Error("Failed to compile fragment shader");const s=e.createProgram();if(!s)throw new Error("Failed to create program");if(e.attachShader(s,r),e.attachShader(s,o),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS))throw new Error("Failed to link program");e.useProgram(s);const a=e.getAttribLocation(s,"shapeVertexPosition");if(a<0)throw new Error("Failed to get shapeVertexPosition attribute location");e.enableVertexAttribArray(a);const l=e.getUniformLocation(s,"canvasPageBounds"),c=e.getUniformLocation(s,"fillColor");if(!e.createBuffer())throw new Error("Failed to create buffer");if(!e.createBuffer())throw new Error("Failed to create buffer");return{context:e,selectedShapes:cS(e,1024),unselectedShapes:cS(e,4096),viewport:cS(e,tX),collaborators:cS(e,1024),prepareTriangles(p,f){e.bindBuffer(e.ARRAY_BUFFER,p.buffer),e.bufferData(e.ARRAY_BUFFER,p.vertices,e.STATIC_DRAW,0,f),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0)},drawTrianglesTransparently(p){e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLES,0,p/2),e.disable(e.BLEND)},drawTriangles(p){e.drawArrays(e.TRIANGLES,0,p/2)},setFillColor(p){e.uniform4fv(c,p)},setCanvasPageBounds(p){e.uniform4fv(l,p)}}}function cS(t,e){const n=t.createBuffer();if(!n)throw new Error("Failed to create buffer");return{buffer:n,vertices:new Float32Array(e)}}function Y3(t,e,n){let r=t.vertices.length;for(;r<e+n.length;)r*=2;if(r!=t.vertices.length){const i=new Float32Array(r);i.set(t.vertices),t.vertices=i}t.vertices.set(n,e)}var DTe=Object.create,nX=Object.defineProperty,jTe=Object.getOwnPropertyDescriptor,RTe=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),rX=t=>{throw TypeError(t)},iX=(t,e,n)=>e in t?nX(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,$Te=t=>[,,,DTe(null)],oX=["class","method","getter","setter","accessor","field","value","get","set"],sX=t=>t!==void 0&&typeof t!="function"?rX("Function expected"):t,NTe=(t,e,n,r,i)=>({kind:oX[t],name:e,metadata:r,addInitializer:o=>n._?rX("Already initialized"):i.push(sX(o||null))}),LTe=(t,e)=>iX(e,RTe("metadata"),t[3]),zTe=(t,e,n,r)=>{for(var i=0,o=t[e>>1],s=o&&o.length;i<s;i++)o[i].call(n);return r},Ll=(t,e,n,r,i,o)=>{for(var s,a,l,c,d=e&7,u=!1,p=!1,f=2,y=oX[d+5],v=t[f]||(t[f]=[]),x=(i=i.prototype,jTe(i,n)),b=r.length-1;b>=0;b--)l=NTe(d,n,a={},t[3],v),l.static=u,l.private=p,c=l.access={has:w=>n in w},c.get=w=>w[n],s=(0,r[b])(x[y],l),a._=1,sX(s)&&(x[y]=s);return x&&nX(i,n,x),i},tc=(t,e,n)=>iX(t,typeof e!="symbol"?e+"":e,n),aX,lX,cX,uX,dX,hX,pX,fX,gX,mX,Ds;mX=[qo],gX=[fe],fX=[fe],pX=[fe],hX=[fe],dX=[fe],uX=[fe],cX=[fe],lX=[fe],aX=[qo];class fa{constructor(e,n,r){this.editor=e,this.elem=n,this.container=r,zTe(Ds,5,this),tc(this,"disposables",[]),tc(this,"gl"),tc(this,"shapeGeometryCache"),tc(this,"colors"),tc(this,"id",Qt()),tc(this,"canvasBoundingClientRect",qt("canvasBoundingClientRect",new pe)),tc(this,"originPagePoint",new T),tc(this,"originPageCenter",new T),tc(this,"isInViewport",!1),this.gl=OTe(n),this.shapeGeometryCache=e.store.createComputedCache("webgl-geometry",i=>{const o=e.getShapeMaskedPageBounds(i.id);if(!o)return null;const s=new Float32Array(12);return Dp(s,0,o.x,o.y,o.w,o.h),s}),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),mo("minimap render",this.render))}close(){return this.disposables.forEach(e=>e())}_getColors(){const e=getComputedStyle(this.editor.getContainer());return{shapeFill:Vg(e.getPropertyValue("--tl-color-text-3").trim()),selectFill:Vg(e.getPropertyValue("--tl-color-selected").trim()),viewportFill:Vg(e.getPropertyValue("--tl-color-muted-1").trim()),background:Vg(e.getPropertyValue("--tl-color-low").trim())}}updateColors(){this.colors=this._getColors()}getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){const e=this.editor.getViewportPageBounds(),n=this.editor.getCurrentPageBounds();return n?pe.Expand(n,e):e}getContentScreenBounds(){const e=this.getContentPageBounds(),n=this.editor.pageToScreen(e.point),r=this.editor.pageToScreen(new T(e.maxX,e.maxY));return new pe(n.x,n.y,r.x-n.x,r.y-n.y)}_getCanvasBoundingRect(){const{x:e,y:n,width:r,height:i}=this.elem.getBoundingClientRect();return new pe(e,n,r,i)}getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){const e=new ResizeObserver(()=>{const n=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(n)});return e.observe(this.elem),e.observe(this.container),()=>e.disconnect()}getCanvasSize(){const e=this.canvasBoundingClientRect.get(),n=this.getDpr();return new T(e.width*n,e.height*n)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}getCanvasPageBounds(){const e=this.getCanvasScreenBounds(),n=this.getContentPageBounds(),r=e.width/e.height;let i=n.width,o=i/r;o<n.height&&(o=n.height,i=o*r);const s=new pe(0,0,i,o);return s.center=n.center,s}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){const{x:e,y:n,w:r,h:i}=this.getCanvasPageBounds();return new Float32Array([e,n,r,i])}getMinimapPagePoint(e,n){const r=this.getCanvasPageBounds(),i=this.getCanvasScreenBounds();let o=e-i.x,s=n-i.y;return o*=r.width/i.width,s*=r.height/i.height,o+=r.minX,s+=r.minY,new T(o,s,1)}minimapScreenPointToPagePoint(e,n,r=!1,i=!1){const{editor:o}=this,s=o.getViewportPageBounds();let{x:a,y:l}=this.getMinimapPagePoint(e,n);if(i){const c=this.editor.getCurrentPageBounds()??new pe,d=c.minX-s.width/2,u=c.maxX+s.width/2,p=c.minY-s.height/2,f=c.maxY+s.height/2,y=Math.max(0,d+s.width-a),v=Math.max(0,-(u-s.width-a)),x=Math.max(0,p+s.height-l),b=Math.max(0,-(f-s.height-l));a+=(y-v)/2,l+=(x-b)/2,a=pt(a,d,u),l=pt(l,p,f)}if(r){const{originPagePoint:c}=this,d=Math.abs(a-c.x),u=Math.abs(l-c.y);d>u?l=c.y:a=c.x}return new T(a,l)}render(){const e=this.gl.context,n=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=n.x,this.elem.height=n.y,e.viewport(0,0,n.x,n.y),e.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),e.clear(e.COLOR_BUFFER_BIT);const r=new Set(this.editor.getSelectedShapeIds()),i=this.colors;let o=0,s=0;const a=this.editor.getCurrentPageShapeIdsSorted();for(let l=0,c=a.length;l<c;l++){const d=a[l],u=this.shapeGeometryCache.get(d);if(!u)continue;const p=u.length,f=this.editor.getShape(d);f&&this.editor.getShapeUtil(f.type).hideInMinimap?.(f)||(r.has(d)?(Y3(this.gl.selectedShapes,o,u),o+=p):(Y3(this.gl.unselectedShapes,s,u),s+=p))}this.drawShapes(this.gl.unselectedShapes,s,i.shapeFill),this.drawShapes(this.gl.selectedShapes,o,i.selectFill),this.drawViewport(),this.drawCollaborators()}drawShapes(e,n,r){this.gl.prepareTriangles(e,n),this.gl.setFillColor(r),this.gl.drawTriangles(n)}drawViewport(){const e=this.editor.getViewportPageBounds(),n=MTe(this.gl.viewport.vertices,e,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,n),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(n),Jt.isSafari&&(this.gl.drawTrianglesTransparently(n),this.gl.drawTrianglesTransparently(n),this.gl.drawTrianglesTransparently(n))}drawCollaborators(){const e=this.editor.getCollaboratorsOnCurrentPage();if(!e.length)return;const n=20,r=n*6,i=r*e.length;this.gl.collaborators.vertices.length<i&&(this.gl.collaborators.vertices=new Float32Array(i));const o=this.gl.collaborators.vertices;let s=0;const a=this.getZoom();for(const{cursor:l}of e)l&&(Op(o,{center:T.From(l),radius:3*a,offset:s,numArcSegments:n}),s+=r);this.gl.prepareTriangles(this.gl.collaborators,i),s=0;for(const{color:l}of e)this.gl.setFillColor(Vg(l)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,s/2,r/2),s+=r}}Ds=$Te();Ll(Ds,1,"close",mX,fa);Ll(Ds,1,"getDpr",gX,fa);Ll(Ds,1,"getContentPageBounds",fX,fa);Ll(Ds,1,"getContentScreenBounds",pX,fa);Ll(Ds,1,"getCanvasSize",hX,fa);Ll(Ds,1,"getCanvasClientPosition",dX,fa);Ll(Ds,1,"getCanvasPageBounds",uX,fa);Ll(Ds,1,"getZoom",cX,fa);Ll(Ds,1,"getCanvasPageBoundsArray",lX,fa);Ll(Ds,1,"render",aX,fa);LTe(Ds,fa);function FTe(){const t=ne(),e=Cr(),n=Ve(),r=I.useRef(null),i=I.useRef(!1),o=I.useRef();I.useEffect(()=>{try{const u=new fa(t,r.current,e);return o.current=u,o.current.close}catch(u){t.annotateError(u,{origin:"minimap",willCrashApp:!1}),t.timers.setTimeout(()=>{throw u})}},[t,e]);const s=I.useCallback(u=>{if(!t.getCurrentPageShapeIds().size||!o.current)return;const p=o.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!1),f=o.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!0);o.current.originPagePoint.setTo(f),o.current.originPageCenter.setTo(t.getViewportPageBounds().center),t.centerOnPoint(p,{animation:{duration:t.options.animationMediumMs}})},[t]),a=I.useCallback(u=>{if(!o.current)return;const p=u.currentTarget;if(qy(p,u),!t.getCurrentPageShapeIds().size)return;i.current=!0,o.current.isInViewport=!1;const f=o.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!1),y=t.getViewportPageBounds(),v=o.current.getContentPageBounds();if(new pe(v.x-y.width/2,v.y-y.height/2,v.width+y.width,v.height+y.height).containsPoint(f)&&!y.containsPoint(f)){o.current.isInViewport=y.containsPoint(f);const w=T.Sub(y.center,y.point),_=T.Add(f,w);o.current.originPagePoint.setTo(_),o.current.originPageCenter.setTo(f),t.centerOnPoint(f,{animation:{duration:t.options.animationMediumMs}})}else{const w=o.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!0);o.current.isInViewport=y.containsPoint(w),o.current.originPagePoint.setTo(w),o.current.originPageCenter.setTo(y.center)}function b(w){p&&Gy(p,w),i.current=!1,document.body.removeEventListener("pointerup",b)}document.body.addEventListener("pointerup",b)},[t]),l=I.useCallback(u=>{if(!o.current)return;const p=o.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,u.shiftKey,!0);if(i.current){if(o.current.isInViewport){const x=o.current.originPagePoint.clone().sub(o.current.originPageCenter);t.centerOnPoint(T.Sub(p,x));return}t.centerOnPoint(p)}const f=o.current.getMinimapPagePoint(u.clientX,u.clientY),y=t.pageToScreen(f),v={type:"pointer",target:"canvas",name:"pointer_move",...Hi(t,u),point:y,isPen:t.getInstanceState().isPenMode};t.dispatch(v)},[t]),c=I.useCallback(u=>{const p=Q7(u);t.dispatch({type:"wheel",name:"wheel",delta:p,point:new T(u.clientX,u.clientY),shiftKey:u.shiftKey,altKey:u.altKey,ctrlKey:u.metaKey||u.ctrlKey,metaKey:u.metaKey,accelKey:Rn(u)})},[t]),d=p0();return I.useEffect(()=>{t.timers.setTimeout(()=>{o.current?.updateColors(),o.current?.render()})},[d,t]),g.jsx("div",{className:"tlui-minimap",children:g.jsx("canvas",{role:"img","aria-label":n("navigation-zone.minimap"),"data-testid":"minimap.canvas",ref:r,className:"tlui-minimap__canvas",onDoubleClick:s,onPointerMove:l,onPointerDown:a,onWheelCapture:c})})}function BTe(t,e){const[n,r]=rt.useState(e);rt.useLayoutEffect(()=>{const o=h2(t);if(o)try{r(JSON.parse(o))}catch{console.error(`Could not restore value ${t} from local storage.`)}},[t]);const i=rt.useCallback(o=>{r(s=>{const a=typeof o=="function"?o(s):o;return p2(t,JSON.stringify(a)),a})},[t]);return[n,i]}const UTe=I.memo(function(){const e=Fl(),n=Ve(),r=Ci(),i=I.useRef(null);Rl(i);const[o,s]=BTe("minimap",!0),a=I.useCallback(()=>{s(d=>!d)},[s]),{ZoomMenu:l,Minimap:c}=zl();return r<nr.MOBILE?null:g.jsxs("div",{ref:i,className:"tlui-navigation-panel",children:[g.jsx(ko,{orientation:"horizontal",label:n("navigation-zone.title"),children:l&&r<nr.TABLET?g.jsx(l,{}):g.jsxs(g.Fragment,{children:[!o&&g.jsx(vn,{type:"icon","data-testid":"minimap.zoom-out",title:`${n(_y(e["zoom-out"].label))} ${Bb(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone"),children:g.jsx(it,{small:!0,icon:"minus"})}),l&&g.jsx(l,{},"zoom-menu"),!o&&g.jsx(vn,{type:"icon","data-testid":"minimap.zoom-in",title:`${n(_y(e["zoom-in"].label))} ${Bb(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone"),children:g.jsx(it,{small:!0,icon:"plus"})}),c&&g.jsx(vn,{type:"icon","data-testid":"minimap.toggle-button",title:n("navigation-zone.toggle-minimap"),onClick:a,children:g.jsx(it,{small:!0,icon:o?"chevron-right":"chevron-left"})})]})}),c&&r>=nr.TABLET&&!o&&g.jsx(c,{})]})}),HTe=function({name:e,id:n,isCurrentPage:r,onCancel:i,onComplete:o}){const s=ne(),a=qn(),l=I.useRef(null),c=I.useRef(null),d=I.useCallback(()=>{c.current=s.markHistoryStoppingPoint("rename page")},[s]),u=I.useCallback(f=>{s.renamePage(n,f||"New Page"),a("rename-page",{source:"page-menu"})},[s,n,a]),p=I.useCallback(()=>{c.current&&s.bailToMark(c.current),i()},[s,i]);return g.jsx(Hf,{className:"tlui-page-menu__item__input",ref:f=>l.current=f,defaultValue:e,onValueChange:u,onComplete:o,onCancel:p,onFocus:d,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:r,autoSelect:!0})},CE=(t,e,n,r,i)=>{let o;const s=t.getPages(),a=n>r?s[r-1]:s[r],l=n>r?s[r]:s[r+1];a&&!l?o=na(a.index):!a&&l?o=ase(s[0].index):o=rf(a.index,l.index),o!==s[n].index&&(t.markHistoryStoppingPoint("moving page"),t.updatePage({id:e,index:o}),i("move-page",{source:"page-menu"}))},X3=_r(function({index:e,listSize:n,item:r,onRename:i}){const o=ne(),s=Ve(),a=o.getPages(),l=qn(),c=I.useCallback(()=>{o.markHistoryStoppingPoint("creating page");const f=yo.createId();o.duplicatePage(r.id,f),l("duplicate-page",{source:"page-menu"})},[o,r,l]),d=I.useCallback(()=>{CE(o,r.id,e,e-1,l)},[o,r,e,l]),u=I.useCallback(()=>{CE(o,r.id,e,e+1,l)},[o,r,e,l]),p=I.useCallback(()=>{o.markHistoryStoppingPoint("deleting page"),o.deletePage(r.id),l("delete-page",{source:"page-menu"})},[o,r,l]);return g.jsxs(d1,{id:`page item submenu ${e}`,children:[g.jsx(h1,{children:g.jsx(It,{type:"icon",title:s("page-menu.submenu.title"),children:g.jsx(it,{icon:"dots-vertical",small:!0})})}),g.jsx(p1,{alignOffset:0,side:"right",sideOffset:-4,children:g.jsxs(qi,{type:"menu",sourceId:"page-menu",children:[g.jsxs(bt,{id:"modify",children:[i&&g.jsx($t,{id:"rename",label:"page-menu.submenu.rename",onSelect:i}),g.jsx($t,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:c,disabled:a.length>=o.options.maxPages}),e>0&&g.jsx($t,{id:"move-up",onSelect:d,label:"page-menu.submenu.move-up"}),e<n-1&&g.jsx($t,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:u})]}),n>1&&g.jsx(bt,{id:"delete",children:g.jsx($t,{id:"delete",onSelect:p,label:"page-menu.submenu.delete"})})]})})]})}),WTe=I.memo(function(){const e=ne(),n=qn(),r=Ve(),i=Ci(),o=I.useCallback(()=>b(!1),[]),[s,a]=_c("page-menu",o),l=36,c=I.useRef(null),d=J("pages",()=>e.getPages(),[e]),u=J("currentPage",()=>e.getCurrentPage(),[e]),p=J("currentPageId",()=>e.getCurrentPageId(),[e]),f=Os(),y=J("maxPageCountReached",()=>e.getPages().length>=e.options.maxPages,[e]),v=J("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),[x,b]=I.useState(!1);I.useEffect(function(){function $(){x||document.activeElement===document.body&&e.menus.clearOpenMenus()}return document.addEventListener("keydown",$,{passive:!0}),()=>{document.removeEventListener("keydown",$)}},[e,x]);const w=I.useCallback(()=>{f||b(z=>!z)},[f]),_=I.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[C,A]=I.useState(Object.fromEntries(d.map((z,$)=>[z.id,{y:$*l,offsetY:0,isSelected:!1}])));I.useLayoutEffect(()=>{A(Object.fromEntries(d.map((z,$)=>[z.id,{y:$*l,offsetY:0,isSelected:!1}])))},[l,d]),I.useEffect(()=>{s&&e.timers.requestAnimationFrame(()=>{const z=document.querySelector(`[data-pageid="${p}"]`);if(z){z.querySelector("button")?.focus();const $=c.current;if(!$)return;const V=z.offsetTop,Y=$.scrollTop;V<Y&&$.scrollTo({top:V});const re=V+l,q=$.scrollTop+$.offsetHeight;re>q&&$.scrollTo({top:re-$.offsetHeight})}})},[l,p,s,e]);const E=I.useCallback(z=>{const{clientY:$,currentTarget:V}=z,{dataset:{id:Y,index:re}}=V;if(!Y||!re)return;const q=_.current;qy(z.currentTarget,z),q.status="pointing",q.pointing={id:Y,index:+re};const N=C[Y].y;q.startY=$,q.startIndex=Math.max(0,Math.min(Math.round(N/l),d.length-1))},[l,d.length,C]),O=I.useCallback(z=>{const $=_.current;if($.status==="pointing"){const{clientY:V}=z,Y=V-$.startY;Math.abs(Y)>5&&($.status="dragging")}if($.status==="dragging"){const{clientY:V}=z,Y=V-$.startY,re=C[$.pointing.id],{startIndex:q,pointing:X}=$,N=re.y+Y,H=Math.max(0,Math.min(Math.round(N/l),d.length-1)),ie={...C};if(ie[X.id]={y:re.y,offsetY:Y,isSelected:!0},H!==$.dragIndex){$.dragIndex=H;for(let U=0;U<d.length;U++){const ke=d[U];if(ke.id===$.pointing.id)continue;let{y:ge}=ie[ke.id];H===q?ge=U*l:H<q?H<=U&&U<q?ge=(U+1)*l:ge=U*l:H>q&&(H>=U&&U>q?ge=(U-1)*l:ge=U*l),ge!==ie[ke.id].y&&(ie[ke.id]={y:ge,offsetY:0,isSelected:!0})}}A(ie)}},[l,d,C]),D=I.useCallback(z=>{const $=_.current;if($.status==="dragging"){const{id:V,index:Y}=$.pointing;CE(e,V,Y,$.dragIndex,n)}Gy(z.currentTarget,z),$.status="idle"},[e,n]),B=I.useCallback(z=>{const $=_.current;z.key==="Escape"&&($.status==="dragging"&&A(Object.fromEntries(d.map((V,Y)=>[V.id,{y:Y*l,offsetY:0,isSelected:!1}]))),$.status="idle")},[l,d]),L=I.useCallback(()=>{f||(e.run(()=>{e.markHistoryStoppingPoint("creating page");const z=yo.createId();e.createPage({name:r("page-menu.new-page-initial-name"),id:z}),e.setCurrentPage(z),b(!0),e.timers.requestAnimationFrame(()=>{const $=document.querySelector(`[data-pageid="${z}"]`);$&&$.querySelector("button")?.focus()})}),n("new-page",{source:"page-menu"}))},[e,r,f,n]),j=I.useCallback(z=>{e.setCurrentPage(z),n("change-page",{source:"page-menu"})},[e,n]),F=I.useCallback((z,$)=>{e.renamePage(z,$),n("rename-page",{source:"page-menu"})},[e,n]);return g.jsxs(dh,{id:"pages",onOpenChange:a,open:s,children:[g.jsx(hh,{"data-testid":"main.page-menu",children:g.jsxs(It,{type:"menu",title:u.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[g.jsx("div",{className:"tlui-page-menu__name",children:u.name}),g.jsx(it,{icon:"chevron-down",small:!0})]})}),g.jsx(ph,{side:"bottom",align:"start",sideOffset:0,disableEscapeKeyDown:x,children:g.jsxs("div",{className:"tlui-page-menu__wrapper",children:[g.jsxs("div",{className:"tlui-page-menu__header",children:[g.jsx("div",{className:"tlui-page-menu__header__title",children:r("page-menu.title")}),!f&&g.jsxs(Eh,{children:[g.jsx(It,{type:"icon","data-testid":"page-menu.edit",title:r(x?"page-menu.edit-done":"page-menu.edit-start"),onClick:w,children:g.jsx(it,{icon:x?"check":"edit"})}),g.jsx(It,{type:"icon","data-testid":"page-menu.create",title:r(y?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:y,onClick:L,children:g.jsx(it,{icon:"plus"})})]})]}),g.jsx("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:l*d.length+4},ref:c,children:d.map((z,$)=>{const V=C[z.id]??{offsetY:0};return x?g.jsxs("div",{"data-testid":"page-menu.item","data-pageid":z.id,className:"tlui-page_menu__item__sortable",style:{zIndex:z.id===u.id?888:$,transform:`translate(0px, ${V.y+V.offsetY}px)`},children:[g.jsx(It,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:E,onPointerUp:D,onPointerMove:O,onKeyDown:B,"data-id":z.id,"data-index":$,children:g.jsx(it,{icon:"drag-handle-dots"})}),i<nr.TABLET_SM&&v?g.jsxs(It,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const Y=window.prompt("Rename page",z.name);Y&&Y!==z.name&&F(z.id,Y)},onDoubleClick:w,children:[g.jsx(_E,{checked:z.id===u.id}),g.jsx(dr,{children:z.name})]}):g.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:l},children:g.jsx(HTe,{id:z.id,name:z.name,isCurrentPage:z.id===u.id,onComplete:()=>{b(!1)},onCancel:()=>{b(!1)}})}),!f&&g.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":x,children:g.jsx(X3,{index:$,item:z,listSize:d.length})})]},z.id+"_editing"):g.jsxs("div",{"data-pageid":z.id,"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[g.jsxs(It,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>j(z.id),onDoubleClick:w,title:r("page-menu.go-to-page"),onKeyDown:Y=>{Y.key==="Enter"&&z.id===u.id&&(w(),e.markEventAsHandled(Y))},children:[g.jsx(_E,{checked:z.id===u.id}),g.jsx(dr,{children:z.name})]}),!f&&g.jsx("div",{className:"tlui-page_menu__item__submenu",children:g.jsx(X3,{index:$,item:z,listSize:d.length,onRename:()=>{if(Jt.isIos){const Y=window.prompt("Rename page",z.name);Y&&Y!==z.name&&F(z.id,Y)}else b(!0),p!==z.id&&j(z.id)}})})]},z.id)})})]})})]})});function VTe(){const t=ne(),e=Os(),n=J("should display quick actions",()=>t.isInAny("select","hand","zoom"),[t]);if(!(e&&!n))return g.jsxs(g.Fragment,{children:[g.jsx(qTe,{}),g.jsx(KTe,{})]})}function KTe(){const t=Po(1),e=Cc(),n=t&&e;return g.jsxs(g.Fragment,{children:[g.jsx(me,{actionId:"delete",disabled:!n}),g.jsx(me,{actionId:"duplicate",disabled:!n})]})}function qTe(){const t=GY(),e=qY();return g.jsxs(g.Fragment,{children:[g.jsx(me,{actionId:"undo",disabled:!t}),g.jsx(me,{actionId:"redo",disabled:!e})]})}const GTe=I.memo(function({children:e}){const n=e??g.jsx(VTe,{});return g.jsx(qi,{type:"small-icons",sourceId:"quick-actions",children:n})});function YTe({userId:t}){const e=g0(t);return e?g.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:e.color},children:e.userName?.[0]??""},t):null}const XTe=_r(function({userId:e}){const n=ne(),r=Ve(),i=qn(),o=g0(e),s=I.useCallback(()=>{n.getInstanceState().followingUserId===e?(n.stopFollowingUser(),i("stop-following",{source:"people-menu"})):(n.startFollowingUser(e),i("start-following",{source:"people-menu"}))},[n,e,i]),a=o?.followingUserId===n.user.getId(),l=n.getInstanceState().followingUserId===e;return o?g.jsxs(Eh,{className:"tlui-people-menu__item","data-follow":l||a,children:[g.jsxs(It,{type:"menu",className:"tlui-people-menu__item__button",onClick:()=>n.zoomToUser(e),onDoubleClick:s,children:[g.jsx(Ml,{label:r("people-menu.avatar-color"),icon:"color",color:o.color}),g.jsx("div",{className:"tlui-people-menu__name",children:o.userName?.trim()||r("people-menu.anonymous-user")})]}),g.jsx(It,{type:"icon",className:"tlui-people-menu__item__follow",title:r(a?"people-menu.leading":l?"people-menu.following":"people-menu.follow"),onClick:s,disabled:a,children:g.jsx(it,{icon:a?"leading":l?"following":"follow"})})]}):null});function ZTe({count:t}){return g.jsx("div",{className:"tlui-people-menu__avatar tlui-people-menu__more",children:Math.abs(t)})}const JTe=_r(function(){const e=ne(),n=Cr(),r=Ve(),i=qn(),o=I.useRef(!1),[s,a]=I.useState(!1),l=I.useCallback(v=>{a(v)},[]),c=e.user.getColor(),d=I.useCallback(v=>{e.user.updateUserPreferences({color:v}),i("set-color",{source:"people-menu"})},[e,i]),{handleButtonClick:u,handleButtonPointerDown:p,handleButtonPointerEnter:f,handleButtonPointerUp:y}=rt.useMemo(()=>{const v=()=>{o.current=!1,window.removeEventListener("pointerup",v)};return{handleButtonClick:C=>{const{id:A}=C.currentTarget.dataset;A&&c!==A&&d(A)},handleButtonPointerDown:C=>{const{id:A}=C.currentTarget.dataset;A&&(d(A),o.current=!0,window.addEventListener("pointerup",v))},handleButtonPointerEnter:C=>{if(!o.current)return;const{id:A}=C.currentTarget.dataset;A&&d(A)},handleButtonPointerUp:C=>{const{id:A}=C.currentTarget.dataset;A&&d(A)}}},[c,d]);return g.jsxs(bM,{onOpenChange:l,open:s,children:[g.jsx(wM,{dir:"ltr",asChild:!0,children:g.jsx(It,{type:"icon",className:"tlui-people-menu__user__color",style:{color:e.user.getColor()},title:r("people-menu.change-color"),children:g.jsx(it,{icon:"color"})})}),g.jsx(kM,{container:n,children:g.jsx(IM,{dir:"ltr",className:"tlui-menu tlui-people-menu__user__color-picker",align:"start",side:"left",sideOffset:8,children:g.jsx(g1,{children:kT.map(v=>g.jsx(It,{type:"icon","data-id":v,"data-testid":v,"aria-label":v,isActive:c===v,title:v,style:{color:v},onPointerEnter:f,onPointerDown:p,onPointerUp:y,onClick:u,children:g.jsx(it,{icon:"color"})},v))})})})]})});function QTe(){const t=ne(),e=qn(),n=J("userName",()=>t.user.getName(),[]),r=Ve(),i=I.useRef(n),o=I.useRef(n),[s,a]=I.useState(!1),l=I.useCallback(()=>{a(p=>!p)},[]),c=I.useCallback(p=>{o.current=p,t.user.updateUserPreferences({name:p})},[t]),d=I.useCallback(()=>{i.current!==o.current&&(e("change-user-name",{source:"people-menu"}),i.current=o.current)},[e]),u=I.useCallback(()=>{a(!1),t.user.updateUserPreferences({name:i.current}),t.menus.clearOpenMenus()},[t]);return g.jsxs("div",{className:"tlui-people-menu__user",children:[g.jsx(JTe,{}),s?g.jsx(Hf,{className:"tlui-people-menu__user__input",defaultValue:n,onValueChange:c,onComplete:l,onCancel:u,onBlur:d,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:!0,autoSelect:!0}):g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"tlui-people-menu__user__name",onDoubleClick:()=>{s||a(!0)},children:n||r("people-menu.anonymous-user")}),n?null:g.jsx("div",{className:"tlui-people-menu__user__label",children:r("people-menu.user")})]}),g.jsx(It,{type:"icon",className:"tlui-people-menu__user__edit","data-testid":"people-menu.change-name",title:r("people-menu.change-name"),onClick:l,children:g.jsx(it,{icon:s?"check":"edit"})})]})}function eEe({children:t}){const e=Ve(),n=Cr(),r=ne(),i=nW(),o=J("user",()=>r.user.getColor(),[r]),s=J("user",()=>r.user.getName(),[r]),[a,l]=_c("people menu"),d=Ci()<=nr.MOBILE_XS?1:5;return i.length?g.jsxs(bM,{onOpenChange:l,open:a,children:[g.jsx(wM,{dir:"ltr",asChild:!0,children:g.jsx("button",{className:"tlui-people-menu__avatars-button",title:e("people-menu.title"),children:g.jsxs("div",{className:"tlui-people-menu__avatars",children:[i.slice(-d).map(u=>g.jsx(YTe,{userId:u},u)),i.length>0&&g.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:o},children:s?.[0]??""}),i.length>d&&g.jsx(ZTe,{count:i.length-d})]})})}),g.jsx(kM,{container:n,children:g.jsx(IM,{dir:"ltr",className:"tlui-menu",side:"bottom",sideOffset:2,collisionPadding:4,children:g.jsxs("div",{className:"tlui-people-menu__wrapper",children:[g.jsx("div",{className:"tlui-people-menu__section",children:g.jsx(QTe,{})}),i.length>0&&g.jsx("div",{className:"tlui-people-menu__section",children:i.map(u=>g.jsx(XTe,{userId:u},u+"_presence"))}),t]})})})]}):null}function tEe(){return g.jsx("div",{className:"tlui-share-zone",draggable:!1,children:g.jsx(eEe,{})})}const nEe=Object.freeze([vo,eh,th,Wa]);function yX(t=nEe){const e=ne();return J("getRelevantStyles",()=>{const n=new TT(e.getSharedStyles()),r=!!e.root.getCurrent()?.shapeType,i=e.isIn("select")&&e.getSelectedShapeIds().length>0;if(n.size===0&&e.isIn("select")&&e.getSelectedShapeIds().length===0)for(const o of t)n.applyValue(o,e.getStyleForNextShape(o));return r||i||n.size>0?n:null},[e])}const Ts={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],textAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],horizontalAlign:[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],arrowKind:[{value:"arc",icon:"arrow-arc"},{value:"elbow",icon:"arrow-elbow"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},vX=rt.forwardRef(function({onHistoryMark:e,title:n,min:r,steps:i,value:o,label:s,onValueChange:a,["data-testid"]:l,ariaValueModifier:c=1},d){const u=Ve(),[p,f]=I.useState(""),[y,v]=I.useState(-1);I.useEffect(()=>{v(0)},[]);const x=I.useCallback(_=>{a(_[0])},[a]),b=I.useCallback(()=>{Js.hideAllTooltips(),e?.("click slider")},[e]);I.useEffect(()=>{const _=yb.setTimeout("set title and label",()=>{f(n+" — "+u(s))},0);return()=>clearTimeout(_)},[s,u,n]);const w=I.useCallback(_=>{_.key==="Tab"&&_.stopPropagation()},[]);return g.jsx("div",{className:"tlui-slider__container",children:g.jsx(m1,{content:p,children:g.jsxs(YIe,{"data-testid":l,className:"tlui-slider",dir:"ltr",min:r??0,max:i,step:1,value:o!==null?[o]:void 0,onPointerDown:b,onValueChange:x,onKeyDownCapture:w,onKeyUpCapture:w,children:[g.jsx(XIe,{className:"tlui-slider__track",dir:"ltr",children:o!==null&&g.jsx(ZIe,{className:"tlui-slider__range",dir:"ltr"})}),o!==null&&g.jsx(JIe,{"aria-valuemin":(r??0)*c,"aria-valuenow":o*c,"aria-valuemax":i*c,"aria-label":p,className:"tlui-slider__thumb",dir:"ltr",ref:d,tabIndex:y})]})})})});function ga(){return Ku({isDarkMode:p0()})}const xX=I.createContext(null);function rEe({children:t,styles:e}){const n=ne(),r=qn(),i=I.useCallback(a=>n.markHistoryStoppingPoint(a),[n]),o=J("enhancedA11yMode",()=>n.user.getEnhancedA11yMode(),[n]),s=I.useCallback(function(a,l){n.run(()=>{n.isIn("select")&&n.setStyleForSelectedShapes(a,l),n.setStyleForNextShapes(a,l),n.updateInstanceState({isChangingStyle:!0})}),r("set-style",{source:"style-panel",id:a.id,value:l})},[n,r]);return g.jsx(xX.Provider,{value:{styles:e,enhancedA11yMode:o,onHistoryMark:i,onValueChange:s},children:t})}function to(){const t=I.useContext(xX);if(!t)throw new Error("useStylePanelContext must be used within a StylePanelContextProvider");return t}function y1({children:t}){return g.jsx("h3",{className:"tlui-style-panel__subheading",children:t})}function iEe(t){const{enhancedA11yMode:e}=to();return g.jsxs(g.Fragment,{children:[e&&g.jsx(y1,{children:t.title}),g.jsx(ko,{label:t.title,children:g.jsx(UM,{...t})})]})}function oEe(t){const e=to(),{uiType:n,items:r,title:i,style:o,value:s,onValueChange:a=e.onValueChange,onHistoryMark:l=e.onHistoryMark}=t,c=ga(),d=ne(),u=Ve(),p=Ci(),f=I.useRef(!1),y=I.useRef(null),{handleButtonClick:v,handleButtonPointerDown:x,handleButtonPointerEnter:b,handleButtonPointerUp:w}=I.useMemo(()=>{const C=()=>{f.current=!1,window.removeEventListener("pointerup",C);const B=y.current;B&&(["TEXTAREA","INPUT"].includes(B.nodeName)||B.isContentEditable)?B.focus():p>=nr.TABLET_SM&&d.getContainer().focus(),y.current=null};return{handleButtonClick:B=>{const{id:L}=B.currentTarget.dataset;s.type==="shared"&&s.value===L||(l?.("point picker item"),a(o,L))},handleButtonPointerDown:B=>{const{id:L}=B.currentTarget.dataset;l?.("point picker item"),a(o,L),f.current=!0,y.current=document.activeElement,window.addEventListener("pointerup",C)},handleButtonPointerEnter:B=>{if(!f.current)return;const{id:L}=B.currentTarget.dataset;a(o,L)},handleButtonPointerUp:B=>{const{id:L}=B.currentTarget.dataset;s.type==="shared"&&s.value===L||a(o,L)}}},[d,p,s,l,a,o]),_=r.length>4?g1:Eh;return g.jsx(kCe,{"data-testid":`style.${n}`,type:"single",value:s.type==="shared"?s.value:null,asChild:!0,children:g.jsx(_,{children:r.map(C=>{const A=s.type==="shared"&&s.value===C.value,E=i+" — "+u(`${n}-style.${C.value}`);return g.jsx(ICe,{type:"icon","data-id":C.value,"data-testid":`style.${n}.${C.value}`,"aria-label":E+(A?` (${u("style-panel.selected")})`:""),tooltip:g.jsxs(g.Fragment,{children:[g.jsx("div",{children:E}),A?g.jsxs("div",{children:["(",u("style-panel.selected"),")"]}):null]}),value:C.value,"data-state":s.type==="shared"&&s.value===C.value?"on":"off","data-isactive":A,title:E,style:o===vo?{color:Ht(c,C.value,"solid")}:void 0,onPointerEnter:b,onPointerDown:x,onPointerUp:w,onClick:v,children:g.jsx(it,{icon:C.icon})},C.value)})})})}const Sv=I.memo(iEe),UM=I.memo(oEe);function sEe(t){const e=Ve();return g.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[g.jsx("div",{title:e(t.label),className:"tlui-style-panel__double-select-picker-label",children:e(t.label)}),g.jsx(ko,{orientation:"horizontal",label:e(t.label),children:g.jsx(cEe,{...t})})]})}function aEe(t){const e=to(),{uiTypeA:n,uiTypeB:r,labelA:i,labelB:o,itemsA:s,itemsB:a,styleA:l,styleB:c,valueA:d,valueB:u,onValueChange:p=e.onValueChange}=t,f=ne(),y=Ve(),[v,x]=I.useState(!1),[b,w]=I.useState(!1),_=I.useMemo(()=>s.find(O=>d.type==="shared"&&d.value===O.value)?.icon??"mixed",[s,d]),C=I.useMemo(()=>a.find(O=>u.type==="shared"&&u.value===O.value)?.icon??"mixed",[a,u]);if(d===void 0&&u===void 0)return null;const A=`style panel ${n} A`,E=`style panel ${r} B`;return g.jsxs(g.Fragment,{children:[g.jsxs(dh,{id:A,open:v,onOpenChange:x,children:[g.jsx(hh,{children:g.jsx(vn,{type:"icon","data-testid":`style.${n}`,title:y(i)+" — "+(d===null||d.type==="mixed"?y("style-panel.mixed"):y(`${n}-style.${d.value}`)),children:g.jsx(it,{icon:_,small:!0,invertIcon:!0})})}),g.jsx(ph,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:g.jsx(ko,{orientation:"grid",label:y(i),children:g.jsx(qi,{type:"icons",sourceId:"style-panel",children:s.map(O=>g.jsx(vn,{"data-testid":`style.${n}.${O.value}`,type:"icon",onClick:()=>{p(l,O.value),ho.deleteOpenMenu(A,f.contextId),x(!1)},title:`${y(i)} — ${y(`${n}-style.${O.value}`)}`,children:g.jsx(it,{icon:O.icon,invertIcon:!0})},O.value))})})})]}),g.jsxs(dh,{id:E,open:b,onOpenChange:w,children:[g.jsx(hh,{children:g.jsx(vn,{type:"icon","data-testid":`style.${r}`,title:y(o)+" — "+(u===null||u.type==="mixed"?y("style-panel.mixed"):y(`${r}-style.${u.value}`)),children:g.jsx(it,{icon:C,small:!0})})}),g.jsx(ph,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:g.jsx(ko,{orientation:"grid",label:y(o),children:g.jsx(qi,{type:"icons",sourceId:"style-panel",children:a.map(O=>g.jsx(vn,{type:"icon",title:`${y(o)} — ${y(`${r}-style.${O.value}`)}`,"data-testid":`style.${r}.${O.value}`,onClick:()=>{p(c,O.value),ho.deleteOpenMenu(E,f.contextId),w(!1)},children:g.jsx(it,{icon:O.icon})},O.value))})})})]})]})}const lEe=I.memo(sEe),cEe=I.memo(aEe);function uEe(t){const e=Ve(),n=t.label?e(t.label):e(`style-panel.${t.stylePanelType}`);return g.jsx(ko,{label:n,children:g.jsx(SX,{...t})})}function dEe(t){const e=to(),{id:n,label:r,uiType:i,stylePanelType:o,style:s,items:a,type:l,value:c,onValueChange:d=e.onValueChange}=t,u=Ve(),p=ne(),[f,y]=I.useState(!1),v=I.useMemo(()=>a.find(C=>c.type==="shared"&&C.value===c.value)?.icon,[a,c]),x=u(`style-panel.${o}`),b=c.type==="mixed"?u("style-panel.mixed"):x+" — "+u(`${i}-style.${c.value}`),w=r?u(r):"",_=`style panel ${n}`;return g.jsxs(dh,{id:_,open:f,onOpenChange:y,className:"tlui-style-panel__dropdown-picker",children:[g.jsx(hh,{children:g.jsxs(vn,{type:l,"data-testid":`style.${i}`,"data-direction":"left",title:b,children:[w&&g.jsx(dr,{children:w}),g.jsx(it,{icon:v??"mixed"})]})}),g.jsx(ph,{side:"left",align:"center",children:g.jsx(ko,{orientation:a.length>4?"grid":"horizontal",label:w,children:g.jsx(qi,{type:"icons",sourceId:"style-panel",children:a.map(C=>g.jsx(vn,{type:"icon","data-testid":`style.${i}.${C.value}`,title:x+" — "+u(`${i}-style.${C.value}`),isActive:v===C.icon,onClick:()=>{e.onHistoryMark("select style dropdown item"),d(s,C.value),ho.deleteOpenMenu(_,p.contextId),y(!1)},children:g.jsx(it,{icon:C.icon})},C.value))})})})]})}const HM=I.memo(uEe),SX=I.memo(dEe);function hEe(){return g.jsxs(g.Fragment,{children:[g.jsxs(uS,{children:[g.jsx(pEe,{}),g.jsx(fEe,{})]}),g.jsxs(uS,{children:[g.jsx(gEe,{}),g.jsx(mEe,{}),g.jsx(yEe,{})]}),g.jsxs(uS,{children:[g.jsx(vEe,{}),g.jsx(xEe,{}),g.jsx(SEe,{})]}),g.jsxs(uS,{children:[g.jsx(bEe,{}),g.jsx(wEe,{}),g.jsx(kEe,{}),g.jsx(IEe,{})]})]})}function uS({children:t}){return g.jsx("div",{className:"tlui-style-panel__section",children:t})}function pEe(){const{styles:t}=to(),e=Ve(),n=t.get(vo);return n===void 0?null:g.jsx(Sv,{title:e("style-panel.color"),uiType:"color",style:vo,items:Ts.color,value:n})}const Kg=[.1,.25,.5,.75,1];function fEe(){const t=ne(),{onHistoryMark:e,enhancedA11yMode:n}=to(),r=J("opacity",()=>t.getSharedOpacity(),[t]),i=qn(),o=Ve(),s=rt.useCallback(l=>{const c=Kg[l];t.run(()=>{t.isIn("select")&&t.setOpacityForSelectedShapes(c),t.setOpacityForNextShapes(c),t.updateInstanceState({isChangingStyle:!0})}),i("set-style",{source:"style-panel",id:"opacity",value:l})},[t,i]);if(r===void 0)return null;const a=r.type==="mixed"?-1:Kg.indexOf(t5(Kg,l=>Math.abs(l-r.value)));return g.jsxs(g.Fragment,{children:[n&&g.jsx(y1,{children:o("style-panel.opacity")}),g.jsx(vX,{"data-testid":"style.opacity",value:a>=0?a:Kg.length-1,label:r.type==="mixed"?"style-panel.mixed":`opacity-style.${r.value}`,onValueChange:s,steps:Kg.length-1,title:o("style-panel.opacity"),onHistoryMark:e,ariaValueModifier:25})]})}function gEe(){const{styles:t}=to(),e=Ve(),n=t.get(th);return n===void 0?null:g.jsx(Sv,{title:e("style-panel.fill"),uiType:"fill",style:th,items:Ts.fill,value:n})}function mEe(){const{styles:t}=to(),e=Ve(),n=t.get(eh);return n===void 0?null:g.jsx(Sv,{title:e("style-panel.dash"),uiType:"dash",style:eh,items:Ts.dash,value:n})}function yEe(){const t=ne(),{styles:e,onValueChange:n}=to(),r=Ve(),i=e.get(Wa);return i===void 0?null:g.jsx(Sv,{title:r("style-panel.size"),uiType:"size",style:Wa,items:Ts.size,value:i,onValueChange:(o,s)=>{n(o,s);const a=t.getSelectedShapeIds();a.length>0&&un(t,a)}})}function vEe(){const{styles:t}=to(),e=Ve(),n=t.get(Ou);return n===void 0?null:g.jsx(Sv,{title:e("style-panel.font"),uiType:"font",style:Ou,items:Ts.font,value:n})}function xEe(){const{styles:t,enhancedA11yMode:e}=to(),n=Ve(),r=t.get(bT);if(r===void 0)return null;const i=n("style-panel.align");return g.jsxs(g.Fragment,{children:[e&&g.jsx(y1,{children:i}),g.jsxs(ko,{orientation:"horizontal",label:i,children:[g.jsx(UM,{title:i,uiType:"align",style:bT,items:Ts.textAlign,value:r}),g.jsx(vn,{type:"icon",title:n("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:g.jsx(it,{icon:"vertical-align-middle"})})]})]})}function SEe(){const{styles:t,enhancedA11yMode:e}=to(),n=Ve(),r=t.get(ub),i=t.get(db);if(r===void 0)return null;const o=n("style-panel.label-align");return g.jsxs(g.Fragment,{children:[e&&g.jsx(y1,{children:o}),g.jsxs(ko,{orientation:"horizontal",label:o,children:[g.jsx(UM,{title:o,uiType:"align",style:ub,items:Ts.horizontalAlign,value:r}),i===void 0?g.jsx(vn,{type:"icon",title:n("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:g.jsx(it,{icon:"vertical-align-middle"})}):g.jsx(SX,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",stylePanelType:"vertical-align",style:db,items:Ts.verticalAlign,value:i})]})]})}function bEe(){const{styles:t}=to(),e=t.get(vl);return e===void 0?null:g.jsx(HM,{label:"style-panel.geo",type:"menu",id:"geo",uiType:"geo",stylePanelType:"geo",style:vl,items:Ts.geo,value:e})}function wEe(){const{styles:t}=to(),e=t.get(lb);return e===void 0?null:g.jsx(HM,{id:"arrow-kind",type:"menu",label:"style-panel.arrow-kind",uiType:"arrow-kind",stylePanelType:"arrow-kind",style:lb,items:Ts.arrowKind,value:e})}function kEe(){const{styles:t}=to(),e=t.get(vT),n=t.get(yT);return e===void 0||n===void 0?null:g.jsx(lEe,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:yT,itemsA:Ts.arrowheadStart,valueA:n,uiTypeB:"arrowheadEnd",styleB:vT,itemsB:Ts.arrowheadEnd,valueB:e,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}function IEe(){const{styles:t}=to(),e=t.get(ST);return e===void 0?null:g.jsx(HM,{type:"menu",id:"spline",uiType:"spline",stylePanelType:"spline",label:"style-panel.spline",style:ST,items:Ts.spline,value:e})}const _Ee=I.memo(function({isMobile:e,styles:n,children:r}){const i=ne(),o=J("enhancedA11yMode",()=>i.user.getEnhancedA11yMode(),[i]),s=I.useRef(null);Rl(s);const a=I.useCallback(()=>{e||i.updateInstanceState({isChangingStyle:!1})},[i,e]),l=yX();return n===void 0&&(n=l),I.useEffect(()=>{function c(u){u.key==="Escape"&&s.current?.contains(document.activeElement)&&(u.stopPropagation(),i.getContainer().focus())}const d=s.current;return d?.addEventListener("keydown",c,{capture:!0}),()=>{d?.removeEventListener("keydown",c,{capture:!0})}},[i]),n&&g.jsx("div",{ref:s,"data-testid":"style.panel",className:Ye("tlui-style-panel",{"tlui-style-panel__wrapper":!e}),"data-ismobile":e,"data-enhanced-a11y-mode":o,onPointerLeave:a,children:g.jsx(rEe,{styles:n,children:r??g.jsx(hEe,{})})})}),CEe=4e3,PEe={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function TEe({toast:t}){const{removeToast:e}=Nl(),n=Ve(),r=a=>{a||e(t.id)},i=t.actions&&t.actions.length>0,o=t.icon||t.severity&&PEe[t.severity],s=t.iconLabel||(t.severity?n(`toast.${t.severity}`):"");return g.jsxs(y_e,{onOpenChange:r,className:"tlui-toast__container",duration:t.keepOpen?1/0:CEe,"data-severity":t.severity,children:[o&&g.jsx("div",{className:"tlui-toast__icon",children:g.jsx(Ml,{label:s,icon:o})}),g.jsxs("div",{className:"tlui-toast__main","data-title":!!t.title,"data-description":!!t.description,"data-actions":!!t.actions,children:[g.jsxs("div",{className:"tlui-toast__content",children:[t.title&&g.jsx(v_e,{className:"tlui-toast__title",children:t.title}),t.description&&g.jsx(x_e,{className:"tlui-toast__description",children:t.description})]}),t.actions&&g.jsxs("div",{className:"tlui-toast__actions",children:[t.actions.map((a,l)=>g.jsx(S_e,{altText:a.label,asChild:!0,onClick:a.onClick,children:g.jsx(It,{type:a.type,children:g.jsx(dr,{children:a.label})})},l)),g.jsx(I3,{asChild:!0,children:g.jsx(It,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:g.jsx(dr,{children:t.closeLabel??n("toast.close")})})})]})]}),!i&&g.jsx(I3,{asChild:!0,children:g.jsx(It,{type:"normal",className:"tlui-toast__close",children:g.jsx(dr,{children:t.closeLabel??n("toast.close")})})})]})}const EEe=I.memo(function(){const{toasts:e}=Nl(),n=J("toasts",()=>e.get(),[]);return g.jsxs(g.Fragment,{children:[n.map(r=>g.jsx(TEe,{toast:r},r.id)),g.jsx(zG,{className:"tlui-toast__viewport"})]})}),AEe=150,MEe=16,OEe=16,Z3=16**2,DEe=8,eu=16,WM=({children:t,className:e,isMousingDown:n,getSelectionBounds:r,changeOnlyWhenYChanges:i=!1,label:o})=>{const s=ne(),a=I.useRef(null);Rl(a),fme(a);const{isVisible:l,isInteractive:c,hide:d,show:u,position:p,move:f}=$Ee(i),y=I.useRef(!1),[v,x]=I.useState(!1),b=Hy("content size update counter",0);I.useEffect(()=>{Ge(a.current);const _=new ResizeObserver(()=>{b.update(C=>C+1)});return _.observe(a.current),()=>_.disconnect()},[b]),I.useEffect(()=>{let _=b.get();return mo("toolbar position",function(){const A=a.current;if(!A)return;const E=b.get();s.getCamera(),b.get();const O=jEe(s,A,r);if(!O)y.current&&(y.current=!1,x(!1));else{if(s.getCameraState()==="moving")a.current.style.setProperty("transform",`translate(${O.x}px, ${O.y}px)`);else{const B=_!==E;f(O.x,O.y,B)}y.current||(y.current=!0,x(!0))}_=E})},[s,r,b,f]);const w=J("camera state",()=>s.getCameraState(),[s]);return I.useEffect(()=>{if(n||!v){d();return}u()},[v,w,n,u,d]),I.useLayoutEffect(()=>{const _=a.current;_&&(_.dataset.visible=`${l}`)},[l,p]),I.useLayoutEffect(()=>{const _=a.current;_&&_.style.setProperty("transform",`translate(${p.x}px, ${p.y}px)`)},[p]),I.useLayoutEffect(()=>{const _=a.current;_&&(_.dataset.interactive=`${c}`)},[c]),g.jsx("div",{ref:a,"data-interactive":!1,"data-visible":!1,"data-testid":"contextual-toolbar",className:Ye("tlui-contextual-toolbar",e),onPointerDown:s.markEventAsHandled,children:g.jsx(ko,{orientation:"horizontal",className:"tlui-menu",label:o,tooltipSide:"top",children:t})})};function bX(t){return new pe(t.x,t.y,t.width,t.height)}function jEe(t,e,n){const r=n()?.clone();if(!r)return;const i=t.getViewportScreenBounds();if(r.x-=i.x,r.y-=i.y,r.midY<eu||r.midY>i.h-eu||r.midX<eu||r.midX>i.w-eu)return;const o=bX(e.getBoundingClientRect());if(!o.width||!o.height)return;const{scrollLeft:s,scrollTop:a}=t.getContainer();let l=r.midX-o.w/2,c=r.y-o.h-DEe;return l=pt(l,eu,i.w-o.w-eu),c=pt(c,eu,i.h-o.h-eu),l+=s,c+=a,l=Math.round(l),c=Math.round(c),{x:l,y:c}}function REe(t,e,n){return n?T.Sub(e,t).y**2>=Z3:T.Len2(T.Sub(e,t))>=Z3}function $Ee(t){const e=ne(),n=I.useRef({name:"hidden"}),[r,i]=I.useState(!1),[o,s]=I.useState(!1),[a,l]=I.useState({x:-1e3,y:-1e3}),c=I.useRef(new T(-1e3,-1e3)),d=I.useRef(new T(-1e3,-1e3)),u=I.useRef(-1),p=I.useRef(-1),f=I.useCallback((x,b,w=!1)=>{if(d.current.x=x,d.current.y=b,n.current.name==="hidden"||n.current.name==="showing")return;clearTimeout(p.current);const _=()=>{if(n.current.name==="shown"&&REe(d.current,c.current,t)){const{x:C,y:A}=d.current;c.current=new T(C,A),w?_h.flushSync(()=>l({x:C,y:A})):l({x:C,y:A})}};w?_():p.current=e.timers.setTimeout(_,AEe)},[e,t]),y=I.useCallback((x=!1)=>{switch(n.current.name){case"showing":{clearTimeout(u.current),n.current={name:"hidden"};break}case"shown":{n.current={name:"hiding"},i(!1),x?(n.current={name:"hidden"},s(!1)):u.current=e.timers.setTimeout(()=>{n.current={name:"hidden"},s(!1)},MEe);break}}},[e]),v=I.useCallback(()=>{switch(n.current.name){case"hidden":{n.current={name:"showing"},u.current=e.timers.setTimeout(()=>{const{x,y:b}=d.current;c.current=new T(x,b),l({x,y:b}),n.current={name:"shown"},s(!0),i(!0)},OEe);break}case"hiding":{clearTimeout(u.current),n.current={name:"shown"},i(!0),f(d.current.x,d.current.y);break}}},[e,f]);return{isVisible:o,isInteractive:r,show:v,hide:y,move:f,position:a}}function wX({shapeId:t,onClose:e,source:n}){const r=ne(),[i,o]=I.useState(()=>{const y=r.getShape(t);if(!y)return"";if(!("altText"in y.props))throw Error("Shape does not have altText property");return y.props.altText||""}),s=Ve(),a=I.useRef(null),l=qn(),c=r.getIsReadonly(),d=y=>o(y),u=()=>{l("set-alt-text",{source:n});const y=r.getShape(t);y&&(r.updateShapes([{id:y.id,type:y.type,props:{altText:i}}]),e())},p=()=>u(),f=I.useCallback(()=>e(),[e]);return I.useEffect(()=>{a.current?.select();function y(v){v.key==="Escape"&&(v.stopPropagation(),f())}return document.addEventListener("keydown",y,{capture:!0}),()=>{document.removeEventListener("keydown",y,{capture:!0})}},[f]),g.jsxs(g.Fragment,{children:[g.jsx(Hf,{ref:a,className:"tlui-media__toolbar-alt-text-input","data-testid":"media-toolbar.alt-text-input",value:i,placeholder:s("tool.media-alt-text-desc"),"aria-label":s("tool.media-alt-text-desc"),onValueChange:d,onComplete:u,onCancel:f,disabled:c}),!c&&g.jsx(It,{title:s("tool.media-alt-text-confirm"),"data-testid":"tool.media-alt-text-confirm",type:"icon",onPointerDown:dt,onClick:p,children:g.jsx(it,{small:!0,icon:"check"})})]})}const J3=8;function Na(){return{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}}const NEe=["original","square","circle","landscape","portrait","wide"],PE={original:0,square:1,circle:1,landscape:4/3,portrait:3/4,wide:16/9};function qa(t,e){if(!e)return{w:t.w,h:t.h};const n=t.w/(e.bottomRight.x-e.topLeft.x),r=t.h/(e.bottomRight.y-e.topLeft.y);return{w:n,h:r}}function v1(t){return{width:t.bottomRight.x-t.topLeft.x,height:t.bottomRight.y-t.topLeft.y}}function VM(t){const{width:e,height:n}=v1(t);return{x:t.topLeft.x+e/2,y:t.topLeft.y+n/2}}function KM(t,e,n,r,i){const o=Math.max(0,Math.min(1-n,t-n/2)),s=Math.max(0,Math.min(1-r,e-r/2));return{topLeft:{x:o,y:s},bottomRight:{x:o+n,y:s+r},isCircle:i}}function LEe(t,e,n={}){const{handle:r,change:i,crop:o,aspectRatioLocked:s}=e,{w:a,h:l}=e.uncroppedSize,{minWidth:c=J3,minHeight:d=J3}=n;if(a<c||l<d||i.x===0&&i.y===0)return;const u=new pe(o.topLeft.x*a,o.topLeft.y*l,(o.bottomRight.x-o.topLeft.x)*a,(o.bottomRight.y-o.topLeft.y)*l),p=u.aspectRatio,f=u.clone();if(r==="top_left"||r==="bottom_left"||r==="left")f.x=pt(f.x+i.x,0,u.maxX-c),f.w=u.maxX-f.x;else if(r==="top_right"||r==="bottom_right"||r==="right"){const x=pt(f.maxX+i.x,u.x+c,a);f.w=x-f.x}if(r==="top_left"||r==="top_right"||r==="top")f.y=pt(f.y+i.y,0,u.maxY-d),f.h=u.maxY-f.y;else if(r==="bottom_left"||r==="bottom_right"||r==="bottom"){const x=pt(f.maxY+i.y,u.y+d,l);f.h=x-f.y}if(s)switch(f.aspectRatio>p?f.h=f.w/p:f.w=f.h*p,r){case"top_left":{f.x=u.maxX-f.w,f.y=u.maxY-f.h,f.x<=0&&(f.x=0,f.w=u.maxX-f.x,f.h=f.w/p,f.y=u.maxY-f.h),f.y<=0&&(f.y=0,f.h=u.maxY-f.y,f.w=f.h*p,f.x=u.maxX-f.w);break}case"top_right":{f.x=u.x,f.y=u.maxY-f.h,f.maxX>=a&&(f.w=a-u.x,f.h=f.w/p,f.y=u.maxY-f.h),f.y<=0&&(f.y=0,f.h=u.maxY-f.y,f.w=f.h*p);break}case"bottom_left":{f.x=u.maxX-f.w,f.y=u.y,f.x<=0&&(f.x=0,f.w=u.maxX-f.x,f.h=f.w/p),f.maxY>=l&&(f.h=l-u.y,f.w=f.h*p,f.x=u.maxX-f.w);break}case"bottom_right":{f.x=u.x,f.y=u.y,f.maxX>=a&&(f.w=a-u.x,f.h=f.w/p),f.maxY>=l&&(f.h=l-u.y,f.w=f.h*p);break}case"top":{if(f.h=u.maxY-f.y,f.w=f.h*p,f.x-=(f.w-u.w)/2,f.x<=0){const b=u.midX;f.w=b*2,f.h=f.w/p,f.x=0}if(f.maxX>=a){const b=a-u.midX;f.w=b*2,f.h=f.w/p,f.x=a-f.w}f.y=u.maxY-f.h;break}case"right":{if(f.w=f.maxX-u.x,f.h=f.w/p,f.y-=(f.h-u.h)/2,f.y<=0){const b=u.midY;f.h=b*2,f.w=f.h*p,f.y=0}if(f.maxY>=l){const b=l-u.midY;f.h=b*2,f.w=f.h*p,f.y=l-f.h}break}case"bottom":{if(f.h=f.maxY-u.y,f.w=f.h*p,f.x-=(f.w-u.w)/2,f.x<=0){const b=u.midX;f.w=b*2,f.h=f.w/p,f.x=0}if(f.maxX>=a){const b=a-u.midX;f.w=b*2,f.h=f.w/p,f.x=a-f.w}break}case"left":{if(f.w=u.maxX-f.x,f.h=f.w/p,f.y-=(f.h-u.h)/2,f.y<=0){const b=u.midY;f.h=b*2,f.w=f.h*p,f.y=0}if(f.maxY>=l){const b=l-u.midY;f.h=b*2,f.w=f.h*p,f.y=l-f.h}f.x=u.maxX-f.w;break}}const y={topLeft:{x:f.x/a,y:f.y/l},bottomRight:{x:f.maxX/a,y:f.maxY/l},isCircle:o.isCircle};if(y.topLeft.x===o.topLeft.x&&y.topLeft.y===o.topLeft.y&&y.bottomRight.x===o.bottomRight.x&&y.bottomRight.y===o.bottomRight.y)return;const v=new T(f.x-o.topLeft.x*a,f.y-o.topLeft.y*l).rot(t.rotation).add(t);return{id:t.id,type:t.type,x:v.x,y:v.y,props:{w:f.w,h:f.h,crop:y}}}function zEe(t,e,n,r=!0,i=!1){const{w:o,h:s}=qa(t.props,t.props.crop??Na()),a=t.props.crop||Na(),l=t.x+t.props.w/2,c=t.y+t.props.h/2;let d,u;if(r){const{x:v,y:x}=VM(a);d=v,u=x}else d=.5,u=.5;const p=KM(d,u,e,n,i),f=e*o,y=n*s;return{crop:p,w:f,h:y,x:l-f/2,y:c-y/2}}const Uo=3;function FEe(t,e,n){const r=e.props.crop||Na(),{width:i,height:o}=v1(r),s=i/o,a=n?1/(1-n):Uo,l=1+t*(a-1);let c,d;s>1?(c=Math.min(1,1/l),d=c/s):(d=Math.min(1,1/l),c=d*s);const u=zEe(e,c,d,!0,r.isCircle),p=Math.min(Uo,i/c);u.w*=p,u.h*=p;const f=e.x+e.props.w/2,y=e.y+e.props.h/2;return u.x=f-u.w/2,u.y=y-u.h/2,u}function BEe(t,e,n){const r=Na(),i=t.props.crop||r,o=t.props.w,s=t.props.h,a=e/n;let l=r,c=o,d=s;if(Bu(t.props.crop,r))c=o,d=o*n/e;else{const{w:x,h:b}=qa(t.props,t.props.crop||Na()),{width:w,height:_}=v1(i),C=w/_,A=x/b;let E,O;const D=VM(i);E=w;const B=a/A/C;O=E*B;const L=Uo/(Uo-1);if(B>L){const j=1/Uo;if(1/O<1/E){const F=O/j;O=O/F,E=E/F}else{const F=E/j;E=E/F,O=O/F}}E=Math.max(0,Math.min(1,E)),O=Math.max(0,Math.min(1,O)),l=KM(D.x,D.y,E,O,i.isCircle)}const p=t.x+o/2,f=t.y+s/2,y=p-c/2,v=f-d/2;return{crop:l,w:c,h:d,x:y,y:v}}function UEe(t,e){if(t==="original"){const{w:j,h:F}=qa(e.props,e.props.crop??Na()),z=e.x+e.props.w/2,$=e.y+e.props.h/2;return{crop:Na(),w:j,h:F,x:z-j/2,y:$-F/2}}const n=PE[t],r=t==="circle",{w:i,h:o}=qa(e.props,e.props.crop||Na()),s=i/o,a=e.props.crop||Na(),{width:l,height:c}=v1(a),d=VM(a),u=Math.min(1/l,1/c);let p,f;if(s===0||!Number.isFinite(s)||n===0)p=1,f=1;else{const j=l*i,F=c*o,z=Math.max(j,F),$=j>=F;let V,Y;$?(V=z,Y=V/n):(Y=z,V=Y*n),p=V/i,f=Y/o,p>1&&(p=1,f=s/n),f>1&&(f=1,p=n/s),p=Math.max(0,Math.min(1,p)),f=Math.max(0,Math.min(1,f))}const y=Math.min(1/p,1/f);p*=y/u,f*=y/u,p=Math.max(0,Math.min(1,p)),f=Math.max(0,Math.min(1,f));const v=KM(d.x,d.y,p,f,r),x=v.bottomRight.x-v.topLeft.x,b=v.bottomRight.y-v.topLeft.y,w=x*i,_=b*o;let C=1;l>0?C=e.props.w/(l*i):c>0&&(C=e.props.h/(c*o));const A=w*C,E=_*C,O=e.x+e.props.w/2,D=e.y+e.props.h/2,B=O-A/2,L=D-E/2;return{crop:v,w:A,h:E,x:B,y:L}}const HEe=_r(function({imageShapeId:e,isManipulating:n,onEditAltTextStart:r,onManipulatingStart:i,onManipulatingEnd:o}){const s=ne(),a=qn(),l=Ve(),c="image-toolbar",d=I.useRef(null),u=s.getIsReadonly(),p=J("crop",()=>s.getShape(e).props.crop,[s,e]),f=p?Math.min(1-(p.bottomRight.x-p.topLeft.x),1-(p.bottomRight.y-p.topLeft.y)):0,[y,v]=I.useState(p?Math.max(f,1-1/Uo):Uo),x=Fl();I.useEffect(()=>{v(p?Math.max(f,1-1/Uo):Uo)},[p,f,y]);const b=I.useCallback(j=>s.markHistoryStoppingPoint(j),[s]),w=I.useCallback((j,F)=>{const z=Uo/(Uo-1);return Math.pow(j/F,z)*F},[]),_=p&&y?Ha(w(f,y),[0,y],[0,100],!0):0,C=I.useCallback(j=>{s.setCurrentTool("select.crop.idle");const F=j/100,z=1-1/Uo,$=Math.min(z,y??z),V=Uo/(Uo-1),Y=Math.pow(F,1/V)*$,re=Y>=1?1:Y/(2*(1-Y)),q=s.getShape(e);if(!q)return;const X=FEe(re,q,y);s.updateShape({id:q.id,type:q.type,x:X.x,y:X.y,props:{w:X.w,h:X.h,crop:X.crop}}),a("set-style",{source:"image-toolbar",id:"zoom",value:j})},[s,a,e,y]),A=I.useCallback(()=>x["image-replace"].onSelect("image-toolbar"),[x]),E=I.useCallback(()=>x["download-original"].onSelect("image-toolbar"),[x]),O=j=>{const F=s.getShape(e);F&&s.run(()=>{s.setCurrentTool("select.crop.idle");const z=UEe(j,F);s.markHistoryStoppingPoint("aspect ratio"),s.updateShape({id:e,type:"image",x:z.x,y:z.y,props:{crop:z.crop,w:z.w,h:z.h}}),un(s,[e])})},D=J("altText",()=>s.getShape(e).props.altText,[s,e]),B=J("shapeAspectRatio",()=>{const j=s.getShape(e);return j.props.w/j.props.h},[s,e]),L=!p||Bu(p,Na());return I.useEffect(()=>{n&&s.timers.setTimeout(()=>d.current?.focus(),0)},[s,n]),I.useEffect(()=>{function j(z){n&&(z.key==="Escape"?(s.cancel(),o()):z.key==="Enter"&&(s.complete(),o()))}const F=d.current;return F&&F.addEventListener("keydown",j),()=>{F&&F.removeEventListener("keydown",j)}},[s,n,o]),n?g.jsxs(g.Fragment,{children:[g.jsx(vX,{ref:d,value:_,label:"tool.image-zoom",onValueChange:C,onHistoryMark:b,min:0,steps:100,"data-testid":"tool.image-zoom",title:l("tool.image-zoom")}),g.jsxs(d1,{id:"image-toolbar-aspect-ratio",children:[g.jsx(h1,{children:g.jsx(vn,{title:l("tool.aspect-ratio"),type:"icon","data-testid":"tool.image-aspect-ratio",children:g.jsx(it,{icon:"corners"})})}),g.jsx(p1,{side:"top",align:"center",children:NEe.map(j=>{let F=!1;return L?j==="original"&&(F=!0):j==="circle"?F=!!p.isCircle:j==="square"?F=!p?.isCircle&&Ir(B,PE[j],.1):j==="original"?F=!1:F=!L&&Ir(B,PE[j],.01),g.jsx(vCe,{onSelect:()=>O(j),checked:F,title:l(`tool.aspect-ratio.${j}`),children:g.jsx(dr,{children:l(`tool.aspect-ratio.${j}`)})},j)})})]}),g.jsx(vn,{type:"icon",onClick:o,"data-testid":"tool.image-crop-confirm",style:{borderLeft:"1px solid var(--tl-color-divider)",marginLeft:"2px"},title:l("tool.image-crop-confirm"),children:g.jsx(it,{small:!0,icon:"check"})})]}):g.jsxs(g.Fragment,{children:[!u&&g.jsx(vn,{type:"icon","data-testid":"tool.image-replace",onClick:A,title:l("tool.replace-media"),children:g.jsx(it,{small:!0,icon:"tool-media"})}),!u&&g.jsx(vn,{type:"icon",title:l("tool.image-crop"),onClick:i,"data-testid":"tool.image-crop",children:g.jsx(it,{small:!0,icon:"crop"})}),g.jsx(vn,{type:"icon",title:l("action.download-original"),onClick:E,"data-testid":"tool.image-download",children:g.jsx(it,{small:!0,icon:"download"})}),(D||!u)&&g.jsx(vn,{type:"icon",title:l("tool.media-alt-text"),"data-testid":"tool.image-alt-text",onClick:()=>{a("alt-text-start",{source:c}),r()},children:g.jsx(it,{small:!0,icon:"alt"})})]})});function WEe({children:t}){const e=ne(),n=J("imageShape",()=>{const o=e.getOnlySelectedShape();return!o||o.type!=="image"?null:o.id},[e]),r=J("showToolbar",()=>e.isInAny("select.idle","select.pointing_shape","select.crop"),[e]),i=J("locked",()=>n?e.getShape(n)?.isLocked:!1,[e,n]);return!n||!r||i?null:g.jsx(VEe,{imageShapeId:n,children:t},n)}function VEe({children:t,imageShapeId:e}){const n=ne(),r=Ve(),i=J("editor path",()=>n.isInAny("select.crop.cropping","select.crop.pointing_crop_handle","select.crop.translating_crop"),[n]),o=J("camera",()=>n.getCamera(),[n]),s=J("editor path",()=>n.isIn("select.crop."),[n]),a=I.useRef(),l=I.useCallback(()=>{n.setCroppingShape(null),n.setCurrentTool("select.idle")},[n]),[c,d]=I.useState(!1),u=I.useCallback(()=>d(!0),[]),p=I.useCallback(()=>n.setCurrentTool("select.crop.idle"),[n]),f=I.useCallback(()=>d(!1),[]);I.useEffect(()=>{a.current=void 0},[o]);const y=I.useCallback(()=>{if(s&&a.current)return a.current;const v=n.getSelectionScreenBounds();if(!v)return;const x=new pe(v.x,v.y,v.width,0);return a.current=x,x},[n,s]);return i?(a.current=void 0,null):g.jsx(WM,{className:"tlui-image__toolbar",getSelectionBounds:y,label:r("tool.image-toolbar-title"),children:t||(c?g.jsx(wX,{shapeId:e,onClose:f,source:"image-toolbar"}):g.jsx(HEe,{imageShapeId:e,isManipulating:s,onEditAltTextStart:u,onManipulatingStart:p,onManipulatingEnd:l}))})}function KEe({textEditor:t,onEditLinkStart:e}){const n=qn(),r=Ve(),i="rich-text-menu",[o,s]=I.useState(0);return I.useEffect(function(){function c(){s(d=>d+1)}t.on("update",c),t.on("selectionUpdate",c)},[t]),I.useEffect(()=>{function l(c){e&&Rn(c)&&c.shiftKey&&c.key==="k"&&(c.preventDefault(),e())}return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},[e]),I.useMemo(()=>{function l(c,d){n("rich-text",{operation:c,source:i}),t.chain().focus()[d]().run()}return[{name:"bold",onSelect(){l("bold","toggleBold")}},{name:"italic",onSelect(){l("bold","toggleItalic")}},{name:"code",onSelect(){l("bold","toggleCode")}},e?{name:"link",onSelect(){e()}}:void 0,{name:"bulletList",onSelect(){l("bulletList","toggleBulletList")}},{name:"highlight",onSelect(){l("bulletList","toggleHighlight")}}].filter(Boolean)},[t,n,e]).map(({name:l,attrs:c,onSelect:d})=>{const u=t.isActive(l,c);return g.jsx(vn,{title:r(`tool.rich-text-${l}`),"data-testid":`rich-text.${l}`,type:"icon",isActive:u,onPointerDown:dt,onClick:d,role:"option","aria-pressed":u,children:g.jsx(it,{small:!0,icon:l})},l)})}function qEe({textEditor:t,value:e,onClose:n}){const r=ne(),[i,o]=I.useState(e),s=Ve(),a=I.useRef(null),l=qn(),c="rich-text-menu",d=i.startsWith("http")?i:`https://${i}`,u=x=>o(x),p=x=>{l("rich-text",{operation:"link-edit",source:c}),!x.startsWith("http://")&&!x.startsWith("https://")&&(x=`https://${x}`),t.commands.setLink({href:x}),r.getInstanceState().isCoarsePointer?t.commands.blur():t.commands.focus(),n()},f=()=>{l("rich-text",{operation:"link-visit",source:c}),window.open(d,"_blank","noopener, noreferrer"),n()},y=()=>{l("rich-text",{operation:"link-remove",source:c}),t.chain().unsetLink().focus().run(),n()},v=()=>n();return I.useEffect(()=>{a.current?.focus()},[i]),I.useEffect(()=>{o(e)},[e]),g.jsxs(g.Fragment,{children:[g.jsx(Hf,{ref:a,"data-testid":"rich-text.link-input",className:"tlui-rich-text__toolbar-link-input",value:i,onValueChange:u,onComplete:p,onCancel:v,placeholder:"example.com","aria-label":"example.com"}),g.jsx(It,{className:"tlui-rich-text__toolbar-link-visit",title:s("tool.rich-text-link-visit"),type:"icon",onPointerDown:dt,onClick:f,disabled:!i,children:g.jsx(it,{small:!0,icon:"external-link"})}),g.jsx(It,{className:"tlui-rich-text__toolbar-link-remove",title:s("tool.rich-text-link-remove"),"data-testid":"rich-text.link-remove",type:"icon",onPointerDown:dt,onClick:y,children:g.jsx(it,{small:!0,icon:"trash"})})]})}const GEe=_r(function({children:e}){const n=ne(),r=J("textEditor",()=>n.getRichTextEditor(),[n]);return n.getInstanceState().isCoarsePointer||!r?null:g.jsx(YEe,{textEditor:r,children:e})});function YEe({textEditor:t,children:e}){const{isEditingLink:n,onEditLinkStart:r,onEditLinkClose:i}=XEe(t),[o,s]=I.useState(null),a=I.useRef(),l=ZEe(t),c=Ve(),d=I.useCallback(()=>{if(n)return a.current;const u=window.getSelection();if(!o||!u||u.rangeCount===0||u.isCollapsed)return;const p=[];for(let y=0;y<u.rangeCount;y++){const v=u.getRangeAt(y);p.push(bX(v.getBoundingClientRect()))}const f=pe.Common(p);return a.current=f,f},[o,n]);return I.useEffect(()=>{const u=({editor:p})=>s(p.state.selection);return t.on("selectionUpdate",u),u({editor:t}),()=>{t.off("selectionUpdate",u)}},[t]),g.jsx(WM,{className:"tlui-rich-text__toolbar",getSelectionBounds:d,isMousingDown:l,changeOnlyWhenYChanges:!0,label:c("tool.rich-text-toolbar-title"),children:e||(n?g.jsx(qEe,{textEditor:t,value:t.isActive("link")?t.getAttributes("link").href:"",onClose:i}):g.jsx(KEe,{textEditor:t,onEditLinkStart:r}))})}function XEe(t){const[e,n]=I.useState(!1);I.useEffect(()=>{if(!t){n(!1);return}const s=()=>{const a=t.isActive("link");n(a)};return t.view.dom.addEventListener("click",s),()=>{t.view.dom.removeEventListener("click",s)}},[t,e]),I.useEffect(()=>{if(t&&t.isActive("link"))try{const{from:s,to:a}=M0(t.state.doc.resolve(t.state.selection.from),t.schema.marks.link);t.state.selection.empty&&t.commands.setTextSelection({from:s,to:a})}catch{}},[t,e]);const r=I.useCallback(()=>{n(!0)},[]),i=I.useCallback(()=>{n(!1)},[]),o=I.useCallback(()=>{if(n(!1),!t)return;const s=t.state.selection.from;t.commands.setTextSelection({from:s,to:s})},[t]);return{isEditingLink:e,onEditLinkStart:r,onEditLinkClose:o,onEditLinkCancel:i}}function ZEe(t){const[e,n]=I.useState(!1);return I.useEffect(()=>{if(!t)return;const r=Lw(({isPointing:l})=>{n(l)},16),i=()=>r({isPointing:!0}),o=()=>r({isPointing:!1}),s=["touchstart","pointerdown","mousedown"],a=["touchend","pointerup","mouseup"];return s.forEach(l=>{t.view.dom.addEventListener(l,i)}),a.forEach(l=>{document.body.addEventListener(l,o)}),()=>{s.forEach(l=>{t.view.dom.removeEventListener(l,i)}),a.forEach(l=>{document.body.removeEventListener(l,o)})}},[t]),e}function JEe(){const t=ne(),e=Ve(),{orientation:n}=yv(),i=yX()?.get(vo),o=Ku({isDarkMode:t.user.getIsDarkMode()}),s=i?.type==="shared"?Ht(o,i.value,"solid"):Ht(o,"black","solid"),a=J("disable style panel",()=>t.isInAny("hand","zoom","eraser","laser"),[t]),l=I.useCallback(d=>{d||t.updateInstanceState({isChangingStyle:!1})},[t]),{StylePanel:c}=zl();return c?g.jsxs(dh,{id:"mobile style menu",onOpenChange:l,children:[g.jsx(hh,{children:g.jsx(It,{type:"tool","data-testid":"mobile-styles.button",style:{color:a?"var(--tl-color-muted-1)":s},title:e("style-panel.title"),disabled:a,children:g.jsx(it,{icon:a?"blob":i?.type==="mixed"?"mixed":"blob"})})}),g.jsx(ph,{side:n==="horizontal"?"top":"right",align:"end",children:c&&g.jsx(c,{isMobile:!0})})]}):null}function QEe(){return g.jsxs(g.Fragment,{children:[g.jsx(t2e,{}),g.jsx(n2e,{}),g.jsx(r2e,{}),g.jsx(i2e,{}),g.jsx(o2e,{}),g.jsx(s2e,{}),g.jsx(a2e,{}),g.jsx(l2e,{}),g.jsx(c2e,{}),g.jsx(u2e,{}),g.jsx(h2e,{}),g.jsx(d2e,{}),g.jsx(g2e,{}),g.jsx(v2e,{}),g.jsx(p2e,{}),g.jsx(y2e,{}),g.jsx(m2e,{}),g.jsx(f2e,{}),g.jsx(x2e,{}),g.jsx(S2e,{}),g.jsx(b2e,{}),g.jsx(w2e,{}),g.jsx(k2e,{}),g.jsx(I2e,{}),g.jsx(_2e,{}),g.jsx(C2e,{}),g.jsx(T2e,{}),g.jsx(P2e,{})]})}function e2e(t){const e=ne(),n=t?.meta?.geo;return J("is tool selected",()=>{if(!t)return!1;const r=e.getCurrentToolId();return r==="geo"?n===e.getSharedStyles().getAsKnownValue(vl):r===t.id},[e,t?.id,n])}function bn({tool:t}){const e=FM(),n=e2e(e[t]);return g.jsx(Bo,{toolId:t,isSelected:n})}function t2e(){return g.jsx(bn,{tool:"select"})}function n2e(){return g.jsx(bn,{tool:"hand"})}function r2e(){return g.jsx(bn,{tool:"draw"})}function i2e(){return g.jsx(bn,{tool:"eraser"})}function o2e(){return g.jsx(bn,{tool:"arrow"})}function s2e(){return g.jsx(bn,{tool:"text"})}function a2e(){return g.jsx(bn,{tool:"note"})}function l2e(){return g.jsx(Bo,{toolId:"asset"})}function c2e(){return g.jsx(bn,{tool:"rectangle"})}function u2e(){return g.jsx(bn,{tool:"ellipse"})}function d2e(){return g.jsx(bn,{tool:"diamond"})}function h2e(){return g.jsx(bn,{tool:"triangle"})}function p2e(){return g.jsx(bn,{tool:"rhombus"})}function f2e(){return g.jsx(bn,{tool:"heart"})}function g2e(){return g.jsx(bn,{tool:"hexagon"})}function m2e(){return g.jsx(bn,{tool:"cloud"})}function y2e(){return g.jsx(bn,{tool:"star"})}function v2e(){return g.jsx(bn,{tool:"oval"})}function x2e(){return g.jsx(bn,{tool:"x-box"})}function S2e(){return g.jsx(bn,{tool:"check-box"})}function b2e(){return g.jsx(bn,{tool:"arrow-left"})}function w2e(){return g.jsx(bn,{tool:"arrow-up"})}function k2e(){return g.jsx(bn,{tool:"arrow-down"})}function I2e(){return g.jsx(bn,{tool:"arrow-right"})}function _2e(){return g.jsx(bn,{tool:"line"})}function C2e(){return g.jsx(bn,{tool:"highlight"})}function P2e(){return g.jsx(bn,{tool:"frame"})}function T2e(){return g.jsx(bn,{tool:"laser"})}const OP=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function DP(t,e,n,r){t.addEventListener?t.addEventListener(e,n,r):t.attachEvent&&t.attachEvent("on".concat(e),n)}function qg(t,e,n,r){t.removeEventListener?t.removeEventListener(e,n,r):t.detachEvent&&t.detachEvent("on".concat(e),n)}function kX(t,e){const n=e.slice(0,e.length-1);for(let r=0;r<n.length;r++)n[r]=t[n[r].toLowerCase()];return n}function IX(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let n=e.lastIndexOf("");for(;n>=0;)e[n-1]+=",",e.splice(n,1),n=e.lastIndexOf("");return e}function E2e(t,e){const n=t.length>=e.length?t:e,r=t.length>=e.length?e:t;let i=!0;for(let o=0;o<n.length;o++)r.indexOf(n[o])===-1&&(i=!1);return i}const ky={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":OP?173:189,"=":OP?61:187,";":OP?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},Ba={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,meta:91,command:91},xm={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},fi={16:!1,18:!1,17:!1,91:!1},tr={};for(let t=1;t<20;t++)ky["f".concat(t)]=111+t;let Wn=[],Lm=null,_X="all";const lc=new Map,Wf=t=>ky[t.toLowerCase()]||Ba[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),A2e=t=>Object.keys(ky).find(e=>ky[e]===t),M2e=t=>Object.keys(Ba).find(e=>Ba[e]===t);function CX(t){_X=t||"all"}function Iy(){return _X||"all"}function O2e(){return Wn.slice(0)}function D2e(){return Wn.map(t=>A2e(t)||M2e(t)||String.fromCharCode(t))}function j2e(){const t=[];return Object.keys(tr).forEach(e=>{tr[e].forEach(n=>{let{key:r,scope:i,mods:o,shortcut:s}=n;t.push({scope:i,shortcut:s,mods:o,keys:r.split("+").map(a=>Wf(a))})})}),t}function R2e(t){const e=t.target||t.srcElement,{tagName:n}=e;let r=!0;const i=n==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(i||n==="TEXTAREA"||n==="SELECT")&&!e.readOnly)&&(r=!1),r}function $2e(t){return typeof t=="string"&&(t=Wf(t)),Wn.indexOf(t)!==-1}function N2e(t,e){let n,r;t||(t=Iy());for(const i in tr)if(Object.prototype.hasOwnProperty.call(tr,i))for(n=tr[i],r=0;r<n.length;)n[r].scope===t?n.splice(r,1).forEach(s=>{let{element:a}=s;return qM(a)}):r++;Iy()===t&&CX(e||"all")}function L2e(t){let e=t.keyCode||t.which||t.charCode;t.key&&t.key.toLowerCase()==="capslock"&&(e=Wf(t.key));const n=Wn.indexOf(e);if(n>=0&&Wn.splice(n,1),t.key&&t.key.toLowerCase()==="meta"&&Wn.splice(0,Wn.length),(e===93||e===224)&&(e=91),e in fi){fi[e]=!1;for(const r in Ba)Ba[r]===e&&(oa[r]=!1)}}function PX(t){if(typeof t>"u")Object.keys(tr).forEach(i=>{Array.isArray(tr[i])&&tr[i].forEach(o=>dS(o)),delete tr[i]}),qM(null);else if(Array.isArray(t))t.forEach(i=>{i.key&&dS(i)});else if(typeof t=="object")t.key&&dS(t);else if(typeof t=="string"){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];let[i,o]=n;typeof i=="function"&&(o=i,i=""),dS({key:t,scope:i,method:o,splitKey:"+"})}}const dS=t=>{let{key:e,scope:n,method:r,splitKey:i="+"}=t;IX(e).forEach(s=>{const a=s.split(i),l=a.length,c=a[l-1],d=c==="*"?"*":Wf(c);if(!tr[d])return;n||(n=Iy());const u=l>1?kX(Ba,a):[],p=[];tr[d]=tr[d].filter(f=>{const v=(r?f.method===r:!0)&&f.scope===n&&E2e(f.mods,u);return v&&p.push(f.element),!v}),p.forEach(f=>qM(f))})};function Q3(t,e,n,r){if(e.element!==r)return;let i;if(e.scope===n||e.scope==="all"){i=e.mods.length>0;for(const o in fi)Object.prototype.hasOwnProperty.call(fi,o)&&(!fi[o]&&e.mods.indexOf(+o)>-1||fi[o]&&e.mods.indexOf(+o)===-1)&&(i=!1);(e.mods.length===0&&!fi[16]&&!fi[18]&&!fi[17]&&!fi[91]||i||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(Wn),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function e6(t,e){const n=tr["*"];let r=t.keyCode||t.which||t.charCode;if(t.key&&t.key.toLowerCase()==="capslock"||!oa.filter.call(this,t))return;if((r===93||r===224)&&(r=91),Wn.indexOf(r)===-1&&r!==229&&Wn.push(r),["metaKey","ctrlKey","altKey","shiftKey"].forEach(a=>{const l=xm[a];t[a]&&Wn.indexOf(l)===-1?Wn.push(l):!t[a]&&Wn.indexOf(l)>-1?Wn.splice(Wn.indexOf(l),1):a==="metaKey"&&t[a]&&(Wn=Wn.filter(c=>c in xm||c===r))}),r in fi){fi[r]=!0;for(const a in Ba)if(Object.prototype.hasOwnProperty.call(Ba,a)){const l=xm[Ba[a]];oa[a]=t[l]}if(!n)return}for(const a in fi)Object.prototype.hasOwnProperty.call(fi,a)&&(fi[a]=t[xm[a]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(Wn.indexOf(17)===-1&&Wn.push(17),Wn.indexOf(18)===-1&&Wn.push(18),fi[17]=!0,fi[18]=!0);const i=Iy();if(n)for(let a=0;a<n.length;a++)n[a].scope===i&&(t.type==="keydown"&&n[a].keydown||t.type==="keyup"&&n[a].keyup)&&Q3(t,n[a],i,e);if(!(r in tr))return;const o=tr[r],s=o.length;for(let a=0;a<s;a++)if((t.type==="keydown"&&o[a].keydown||t.type==="keyup"&&o[a].keyup)&&o[a].key){const l=o[a],{splitKey:c}=l,d=l.key.split(c),u=[];for(let p=0;p<d.length;p++)u.push(Wf(d[p]));u.sort().join("")===Wn.sort().join("")&&Q3(t,l,i,e)}}function oa(t,e,n){Wn=[];const r=IX(t);let i=[],o="all",s=document,a=0,l=!1,c=!0,d="+",u=!1,p=!1;for(n===void 0&&typeof e=="function"&&(n=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(o=e.scope),e.element&&(s=e.element),e.keyup&&(l=e.keyup),e.keydown!==void 0&&(c=e.keydown),e.capture!==void 0&&(u=e.capture),typeof e.splitKey=="string"&&(d=e.splitKey),e.single===!0&&(p=!0)),typeof e=="string"&&(o=e),p&&PX(t,o);a<r.length;a++)t=r[a].split(d),i=[],t.length>1&&(i=kX(Ba,t)),t=t[t.length-1],t=t==="*"?"*":Wf(t),t in tr||(tr[t]=[]),tr[t].push({keyup:l,keydown:c,scope:o,mods:i,shortcut:r[a],method:n,key:r[a],splitKey:d,element:s});if(typeof s<"u"&&window){if(!lc.has(s)){const f=function(){let v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return e6(v,s)},y=function(){let v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;e6(v,s),L2e(v)};lc.set(s,{keydownListener:f,keyupListenr:y,capture:u}),DP(s,"keydown",f,u),DP(s,"keyup",y,u)}if(!Lm){const f=()=>{Wn=[]};Lm={listener:f,capture:u},DP(window,"focus",f,u)}}}function z2e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(tr).forEach(n=>{tr[n].filter(i=>i.scope===e&&i.shortcut===t).forEach(i=>{i&&i.method&&i.method()})})}function qM(t){const e=Object.values(tr).flat();if(e.findIndex(r=>{let{element:i}=r;return i===t})<0){const{keydownListener:r,keyupListenr:i,capture:o}=lc.get(t)||{};r&&i&&(qg(t,"keyup",i,o),qg(t,"keydown",r,o),lc.delete(t))}if((e.length<=0||lc.size<=0)&&(Object.keys(lc).forEach(i=>{const{keydownListener:o,keyupListenr:s,capture:a}=lc.get(i)||{};o&&s&&(qg(i,"keyup",s,a),qg(i,"keydown",o,a),lc.delete(i))}),lc.clear(),Object.keys(tr).forEach(i=>delete tr[i]),Lm)){const{listener:i,capture:o}=Lm;qg(window,"focus",i,o),Lm=null}}const jP={getPressedKeyString:D2e,setScope:CX,getScope:Iy,deleteScope:N2e,getPressedKeyCodes:O2e,getAllKeyCodes:j2e,isPressed:$2e,filter:R2e,trigger:z2e,unbind:PX,keyMap:ky,modifier:Ba,modifierMap:xm};for(const t in jP)Object.prototype.hasOwnProperty.call(jP,t)&&(oa[t]=jP[t]);if(typeof window<"u"){const t=window.hotkeys;oa.noConflict=e=>(e&&window.hotkeys===oa&&(window.hotkeys=t),oa),window.hotkeys=oa}const t6=["copy","cut","paste","asset"];function F2e(){const t=ne(),e=Os(),n=Fl(),r=FM(),i=J("is focused",()=>t.getInstanceState().isFocused,[t]);I.useEffect(()=>{if(!i)return;const o=new Array,s=t.getContainer(),a=(c,d)=>{oa(c,{element:s.ownerDocument.body},d),o.push(()=>{oa.unbind(c,d)})},l=(c,d)=>{oa(c,{element:s.ownerDocument.body,keyup:!0,keydown:!1},d),o.push(()=>{oa.unbind(c,d)})};for(const c of Object.values(n))c.kbd&&(e&&!c.readonlyOk||t6.includes(c.id)||a(n6(c.kbd),d=>{Sm(t)&&!c.isRequiredA11yAction||(dt(d),c.onSelect("kbd"))}));for(const c of Object.values(r))!c.kbd||!c.readonlyOk&&t.getIsReadonly()||t6.includes(c.id)||a(n6(c.kbd),d=>{Sm(t)||(dt(d),c.onSelect("kbd"))});return a(",",c=>{if(Sm(t)||t.inputs.keys.has("Comma"))return;dt(c),t.focus(),t.inputs.keys.add("Comma");const{x:d,y:u,z:p}=t.inputs.currentPagePoint,f=t.pageToScreen({x:d,y:u}),y={type:"pointer",name:"pointer_down",point:{x:f.x,y:f.y,z:p},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,metaKey:c.metaKey,accelKey:Rn(c),pointerId:0,button:0,isPen:t.getInstanceState().isPenMode,target:"canvas"};t.dispatch(y)}),l(",",c=>{if(Sm(t)||!t.inputs.keys.has("Comma"))return;t.inputs.keys.delete("Comma");const{x:d,y:u,z:p}=t.inputs.currentScreenPoint,f={type:"pointer",name:"pointer_up",point:{x:d,y:u,z:p},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,metaKey:c.metaKey,accelKey:Rn(c),pointerId:0,button:0,isPen:t.getInstanceState().isPenMode,target:"canvas"};t.dispatch(f)}),()=>{o.forEach(c=>c())}},[n,r,e,t,i])}function Sm(t){return t.menus.hasAnyOpenMenus()||t.getEditingShapeId()!==null||t.getCrashingError()||!t.user.getAreKeyboardShortcutsEnabled()}function n6(t){return B2e(t).map(e=>{let n="";const r=e.includes("!"),i=e.includes("?"),o=e.includes("$"),s=e.replace(/[!?$]/g,"");return r&&i&&o?n=`cmd+shift+alt+${s},ctrl+shift+alt+${s}`:r&&o?n=`cmd+shift+${s},ctrl+shift+${s}`:i&&o?n=`cmd+alt+${s},ctrl+alt+${s}`:i&&r?n=`shift+alt+${s}`:r?n=`shift+${s}`:i?n=`alt+${s}`:o?n=`cmd+${s},ctrl+${s}`:n=s,n}).join(",")}function B2e(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let n=e.lastIndexOf("");for(;n>=0;)e[n-1]+=",",e.splice(n,1),n=e.lastIndexOf("");return e}const U2e=I.createContext(!1),H2e={1:0,2:1,3:2,4:3,5:4,6:5,7:6,8:7,9:8,0:9};function W2e({children:t,orientation:e,sizingParentClassName:n,minItems:r,minSizePx:i,maxItems:o,maxSizePx:s}){const a=ne(),l=Ih(),c=Ci(),d=Ve(),u=I.useRef([]),[p,f]=I.useState(!1),y=I.useRef(null),[v,x]=I.useState(null),[b,w]=I.useState(null),[_,C]=I.useState(!1),A=pl(()=>{if(!y.current)return;const D=e==="horizontal"?"offsetWidth":"offsetHeight",B=j(y.current.children),L=v?j(v.children):null;function j(H){const ie=[];for(const U of H)U.classList.contains("tlui-main-toolbar__group")?ie.push({type:"group",items:j(U.children),element:U}):U.hasAttribute("data-radix-popper-content-wrapper")||ie.push({type:"item",element:U});return ie}const z=r6(y.current,n)[D],$=Math.floor(Ha(z,[i,s],[r,o],!0));let V=0,Y=null,re=!1;const q=[];function X(H,ie){ie&&Ge(H.length===ie.length);let U=!1,ke=!1;for(let ge=0;ge<H.length;ge++){const Te=H[ge],ye=ie?.[ge];if(Te.type==="item"){const Se=Te.element.getAttribute("data-value")===b;let Re;b?Re=V<$||Se:Re=V<=$;const $e=V>=$;U||=Re,ke||=$e,hS(Te.element,"data-toolbar-visible",Re?"true":"false"),ye&&(Ge(ye.type==="item"),hS(ye.element,"data-toolbar-visible",$e?"true":"false")),$e&&Te.element.getAttribute("aria-pressed")==="true"&&(Y=Te.element.getAttribute("data-value")),Re&&Te.element.tagName==="BUTTON"&&q.push(Te.element),!$e&&Se&&(re=!0),V++}else{let Se,Re;ye?(Ge(ye.type==="group"),Re=ye,Se=X(Te.items,Re.items)):Se=X(Te.items,null),U||=Se.didShowAnyInMain,ke||=Se.didShowAnyInOverflow,hS(Te.element,"data-toolbar-visible",Se.didShowAnyInMain?"true":"false"),Re&&hS(Re.element,"data-toolbar-visible",Se.didShowAnyInOverflow?"true":"false")}}return{didShowAnyInMain:U,didShowAnyInOverflow:ke}}const{didShowAnyInOverflow:N}=X(B,L);C(N),Y?w(Y):re&&w(null),u.current=q});I.useLayoutEffect(()=>{A()}),I.useLayoutEffect(()=>{if(!y.current)return;const D=new MutationObserver(A);D.observe(y.current,{childList:!0,subtree:!0,attributes:!0,characterData:!0});const B=r6(y.current,n),L=new ResizeObserver(A);return L.observe(B),()=>{D.disconnect(),L.disconnect()}},[A,n]),I.useEffect(()=>{if(!a.options.enableToolbarKeyboardShortcuts)return;function D(B){if(Sm(a)||QU(!0)||B.ctrlKey||B.metaKey||B.altKey||B.shiftKey)return;const L=H2e[B.key];typeof L=="number"&&(dt(B),u.current[L]?.click())}return document.addEventListener("keydown",D),()=>{document.removeEventListener("keydown",D)}},[a]);const E="toolbar overflow",O=e==="horizontal"?Eh:NM;return g.jsx(g.Fragment,{children:g.jsxs(ko,{orientation:e,className:Ye("tlui-main-toolbar__tools",{"tlui-main-toolbar__tools__mobile":c<nr.TABLET_SM}),label:d("tool-panel.title"),children:[g.jsx(O,{id:`${l}_main`,ref:y,children:g.jsx(qi,{type:"toolbar",sourceId:"toolbar",children:t})}),_&&g.jsx(U2e.Provider,{value:!0,children:g.jsxs(dh,{id:E,open:p,onOpenChange:f,children:[g.jsx(hh,{children:g.jsx(vn,{title:d("tool-panel.more"),type:"tool",className:"tlui-main-toolbar__overflow","data-testid":"tools.more-button",children:g.jsx(it,{icon:e==="horizontal"?"chevron-up":"chevron-right"})})}),g.jsx(ph,{side:e==="horizontal"?"top":"right",align:e==="horizontal"?"center":"end",children:g.jsx(ko,{orientation:"grid",className:"tlui-main-toolbar__overflow-content",ref:x,"data-testid":"tools.more-content",label:d("tool-panel.more"),id:`${l}_more`,onClick:()=>{ho.deleteOpenMenu(E,a.contextId),f(!1)},children:g.jsx(qi,{type:"toolbar-overflow",sourceId:"toolbar",children:t})})})]})})]})})}function r6(t,e){let n=t;for(;n;){if(n.classList.contains(e))return n;n=n.parentElement}throw new Error("Could not find parent with class name "+e)}function hS(t,e,n){t.getAttribute(e)!==n&&t.setAttribute(e,n)}function V2e({activeToolId:t}){const e=ne(),n=Ci(),r=Ve(),i=Fl(),o=J("is tool locked",()=>e.getInstanceState().isToolLocked,[e]),s=J("current tool",()=>e.getCurrentTool(),[e]);if(!t||!s.isLockable)return null;const a=i["toggle-tool-lock"],l=a?.kbd?`${r("action.toggle-tool-lock")} ${Bb(a.kbd)}`:r("action.toggle-tool-lock");return g.jsx(m1,{content:l,children:g.jsx(It,{type:"normal","data-testid":"tool-lock",className:Ye("tlui-main-toolbar__lock-button",{"tlui-main-toolbar__lock-button__mobile":n<nr.TABLET_SM}),onClick:()=>e.updateInstanceState({isToolLocked:!o}),children:g.jsx(it,{icon:o?"lock":"unlock",small:!0})})})}const K2e=I.memo(function({children:e,orientation:n="horizontal",minItems:r=4,minSizePx:i=310,maxItems:o=8,maxSizePx:s=470}){const a=ne(),l=Ve(),c=Ci(),d=Os(),u=J("current tool id",()=>a.getCurrentToolId(),[a]),p=I.useRef(null);Rl(p);const{ActionsMenu:f,QuickActions:y}=zl(),v=a.options.actionShortcutsLocation==="menu"?!1:a.options.actionShortcutsLocation==="toolbar"?!0:c<nr.TABLET;return g.jsx(f1,{orientation:n,tooltipSide:n==="horizontal"?"top":"right",children:g.jsx("div",{ref:p,className:Ye("tlui-main-toolbar",`tlui-main-toolbar--${n}`),children:g.jsxs("div",{className:"tlui-main-toolbar__inner",children:[g.jsxs("div",{className:"tlui-main-toolbar__left",children:[!d&&g.jsxs("div",{className:"tlui-main-toolbar__extras",children:[v&&g.jsxs(ko,{orientation:n,className:"tlui-main-toolbar__extras__controls",label:l("actions-menu.title"),children:[y&&g.jsx(y,{}),f&&g.jsx(f,{})]}),g.jsx(V2e,{activeToolId:u})]}),g.jsx(W2e,{orientation:n,sizingParentClassName:"tlui-main-toolbar",minItems:r,maxItems:o,minSizePx:i,maxSizePx:s,children:e??g.jsx(QEe,{})})]}),c<nr.TABLET_SM&&!d&&g.jsx("div",{className:"tlui-main-toolbar__tools tlui-main-toolbar__mobile-style-panel",children:g.jsx(JEe,{})})]})})})}),q2e=_r(function({videoShapeId:e,onEditAltTextStart:n}){const r=ne(),i=qn(),o=Ve(),s="video-toolbar",a=r.getIsReadonly(),l=Fl(),c=I.useCallback(()=>l["video-replace"].onSelect("video-toolbar"),[l]),d=I.useCallback(()=>l["download-original"].onSelect("video-toolbar"),[l]),u=J("altText",()=>r.getShape(e).props.altText,[r,e]);return g.jsxs(g.Fragment,{children:[!a&&g.jsx(It,{type:"icon",title:o("tool.replace-media"),onClick:c,"data-testid":"tool.video-replace",children:g.jsx(it,{small:!0,icon:"tool-media"})}),g.jsx(It,{type:"icon",title:o("action.download-original"),onClick:d,"data-testid":"tool.video-download",children:g.jsx(it,{small:!0,icon:"download"})}),(u||!a)&&g.jsx(vn,{type:"icon",isActive:!!u,title:o("tool.media-alt-text"),"data-testid":"tool.video-alt-text",onClick:()=>{i("alt-text-start",{source:s}),n()},children:g.jsx(it,{small:!0,icon:"alt"})})]})}),G2e=_r(function({children:e}){const n=ne(),r=J("videoShape",()=>{const s=n.getOnlySelectedShape();return!s||s.type!=="video"?null:s.id},[n]),i=n.isInAny("select.idle","select.pointing_shape"),o=J("locked",()=>r?n.getShape(r)?.isLocked:!1,[n,r]);return!r||!i||o?null:g.jsx(Y2e,{videoShapeId:r,children:e},r)});function Y2e({children:t,videoShapeId:e}){const n=ne(),r=Ve(),[i,o]=I.useState(!1),s=I.useCallback(()=>o(!0),[]),a=I.useCallback(()=>o(!1),[]),l=I.useCallback(()=>{const c=n.getSelectionScreenBounds();if(c)return new pe(c.x,c.y,c.width,0)},[n]);return g.jsx(WM,{className:"tlui-video__toolbar",getSelectionBounds:l,label:r("tool.video-toolbar-title"),children:t||(i?g.jsx(wX,{shapeId:e,onClose:a,source:"video-toolbar"}):g.jsx(q2e,{videoShapeId:e,onEditAltTextStart:s}))})}function X2e(){const t=Ve();return g.jsxs("div",{className:Ye("tlui-offline-indicator"),children:[t("status.offline"),g.jsx(Ml,{label:t("status.offline"),icon:"status-offline",small:!0})]})}function Z2e({maxWidth:t=420,ignoreRightWidth:e=0,stylePanelWidth:n=148,marginBetweenZones:r=12,squeezeAmount:i=52,children:o}){const s=I.useRef(null),a=Ci(),l=I.useCallback(()=>{const c=s.current;if(!c)return;const d=c.parentElement.parentElement,u=d.querySelector(".tlui-layout__top__left"),p=d.querySelector(".tlui-layout__top__right"),f=d.offsetWidth,y=u.offsetWidth,v=p.offsetWidth,x=c.offsetWidth-e;let b=(f-x)/2;f%2!==0&&(b-=.5);const w=y+r,_=c.offsetLeft,C=Math.min(f-v-y-2*r,t),A=Math.max(b,w)-_;p.offsetWidth>n&&a<=6?c.style.setProperty("max-width",C-i+"px"):c.style.setProperty("max-width",C+"px"),c.style.setProperty("transform",`translate(${A}px, 0px)`)},[a,e,r,t,i,n]);return I.useLayoutEffect(()=>{const c=s.current;if(!c)return;const d=c.parentElement.parentElement,u=d.querySelector(".tlui-layout__top__left"),p=d.querySelector(".tlui-layout__top__right"),f=new ResizeObserver(l);return f.observe(u),f.observe(p),f.observe(d),f.observe(c),l(),()=>{f.disconnect()}},[l]),I.useLayoutEffect(()=>{l()}),g.jsx("div",{ref:s,className:"tlui-top-panel__container",children:o})}function J2e(){const t=uCe()==="offline";return g.jsx(Z2e,{children:t&&g.jsx(X2e,{})})}function Q2e(){return g.jsxs(g.Fragment,{children:[g.jsx(me,{actionId:"zoom-in",noClose:!0}),g.jsx(me,{actionId:"zoom-out",noClose:!0}),g.jsx(zX,{}),g.jsx(FX,{}),g.jsx(BX,{})]})}const eAe=I.memo(function({children:e}){const n=Cr(),[r,i]=_c("zoom menu"),o=e??g.jsx(Q2e,{});return g.jsxs(yM,{dir:"ltr",open:r,onOpenChange:i,modal:!1,children:[g.jsx(tAe,{}),g.jsx(Q0,{container:n,children:g.jsx(xM,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:g.jsx(qi,{type:"menu",sourceId:"zoom-menu",children:o})})})]})}),tAe=()=>{const t=ne(),e=Ci(),n=J("zoom",()=>t.getZoomLevel(),[t]),r=Ve(),i=I.useCallback(()=>{t.resetZoom(t.getViewportScreenCenter(),{animation:{duration:t.options.animationMediumMs}})},[t]),o=`${Math.floor(n*100)}%`;return g.jsx(vn,{asChild:!0,type:"icon","aria-label":`${r("navigation-zone.zoom")} — ${o}`,title:`${r("navigation-zone.zoom")} — ${o}`,"data-testid":"minimap.zoom-menu-button",className:"tlui-zoom-menu__button",onDoubleClick:i,children:g.jsx(vM,{dir:"ltr",children:e<nr.MOBILE?null:g.jsx("span",{style:{flexGrow:0,textAlign:"center"},children:o})})})},TX=I.createContext(null);function nAe({overrides:t={},children:e}){const n=Of(t),r=u1();return g.jsx(TX.Provider,{value:I.useMemo(()=>({ContextMenu:VPe,ActionsMenu:HPe,HelpMenu:null,ZoomMenu:eAe,MainMenu:ATe,Minimap:FTe,StylePanel:_Ee,PageMenu:WTe,NavigationPanel:UTe,Toolbar:K2e,RichTextToolbar:GEe,ImageToolbar:WEe,VideoToolbar:G2e,KeyboardShortcutsDialog:FY,QuickActions:GTe,HelperButtons:JY,DebugPanel:iTe,DebugMenu:rTe,MenuPanel:uTe,SharePanel:r?tEe:null,CursorChatBubble:r?GPe:null,TopPanel:r?J2e:null,Dialogs:hTe,Toasts:EEe,A11y:Mbe,FollowingIndicator:lTe,...n}),[n,r]),children:e})}function zl(){const t=I.useContext(TX);if(!t)throw new Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return t}const EX=I.createContext(null);function AX(t,e){return(e.isShapeOfType(t,"image")||e.isShapeOfType(t,"video"))&&!!t.props.assetId}function rAe(t){return Object.fromEntries(t.map(e=>[e.id,e]))}function pS(t,e){if(t.getSelectedShapes().length===0)return t.getDocumentSettings().name||e}function iAe({overrides:t,children:e}){const n=hr(),r=u1(),i=zM(),o=zl(),s=qn(),a=R0(),l=Ve(),c=i.msg("document.default-name"),d=I.useMemo(()=>{const u=n;if(!u)return{};function p(){return u.isIn("select")||(u.complete(),u.setCurrentTool("select")),!1}function f(){return u.isIn("select")&&u.getSelectedShapeIds().length>0}function y(b){if(!f()||p())return;u.markHistoryStoppingPoint("resize shapes");const w=u.getSelectedShapeIds();w.length!==0&&u.run(()=>{w.map(C=>u.getShape(C)).filter(Boolean).forEach(C=>{u.resizeShape(C.id,new T(b,b),{scaleOrigin:u.getSelectionPageBounds()?.center})})})}const v=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(b){f()&&(p()||(s("edit-link",{source:b}),u.markHistoryStoppingPoint("edit-link"),i.addDialog({component:tCe})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"cmd+i,ctrl+i",onSelect(b){s("insert-embed",{source:b}),i.addDialog({component:IY})}},{id:"open-kbd-shortcuts",label:"action.open-kbd-shortcuts",kbd:"cmd+alt+/,ctrl+alt+/",onSelect(b){s("open-kbd-shortcuts",{source:b}),i.addDialog({component:o.KeyboardShortcutsDialog??FY})}},{id:"insert-media",label:"action.insert-media",kbd:"cmd+u,ctrl+u",onSelect(b){s("insert-media",{source:b}),i.insertMedia()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"cmd+z,ctrl+z",onSelect(b){s("undo",{source:b}),u.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"cmd+shift+z,ctrl+shift+z",onSelect(b){s("redo",{source:b}),u.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(b){let w=u.getSelectedShapeIds();w.length===0&&(w=Array.from(u.getCurrentPageShapeIds().values())),w.length!==0&&(s("export-as",{format:"svg",source:b}),i.exportAs(w,{format:"svg",name:pS(u,c)}))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(b){let w=u.getSelectedShapeIds();w.length===0&&(w=Array.from(u.getCurrentPageShapeIds().values())),w.length!==0&&(s("export-as",{format:"png",source:b}),i.exportAs(w,{format:"png",name:pS(u,c)}))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(b){let w=u.getSelectedShapeIds();w.length===0&&(w=Array.from(u.getCurrentPageShapeIds().values())),w.length!==0&&(s("export-all-as",{format:"svg",source:b}),i.exportAs(Array.from(u.getCurrentPageShapeIds()),{format:"svg",name:pS(u,c)}))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(b){const w=Array.from(u.getCurrentPageShapeIds().values());w.length!==0&&(s("export-all-as",{format:"png",source:b}),i.exportAs(w,{format:"png",name:pS(u,c)}))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"cmd+shift+c,ctrl+shift+c",readonlyOk:!0,onSelect(b){let w=u.getSelectedShapeIds();w.length===0&&(w=Array.from(u.getCurrentPageShapeIds().values())),w.length!==0&&(s("copy-as",{format:"svg",source:b}),i.copyAs(w,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(b){let w=u.getSelectedShapeIds();w.length===0&&(w=Array.from(u.getCurrentPageShapeIds().values())),w.length!==0&&(s("copy-as",{format:"png",source:b}),i.copyAs(w,"png"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(b){f()&&(p()||(s("toggle-auto-size",{source:b}),u.markHistoryStoppingPoint("toggling auto size"),u.run(()=>{const w=u.getSelectedShapes().filter(_=>u.isShapeOfType(_,"text")&&_.props.autoSize===!1);u.updateShapes(w.map(_=>({id:_.id,type:_.type,props:{..._.props,w:8,autoSize:!0}}))),un(u,w.map(_=>_.id))})))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(b){s("open-embed-link",{source:b});const w=u.getSelectedShapeIds(),_="No embed shapes selected";if(w.length!==1){console.error(_);return}const C=u.getShape(w[0]);if(!C||!u.isShapeOfType(C,"embed")){console.error(_);return}_be(C.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(b){if(u.root.getCurrent()?.id!=="zoom"&&(s("zoom-tool",{source:b}),!(u.inputs.shiftKey||u.inputs.ctrlKey))){const w=u.root.getCurrent();w&&w.getCurrent()?.id==="idle"&&u.setCurrentTool("zoom",{onInteractionEnd:w.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(b){f()&&(p()||u.run(()=>{s("convert-to-bookmark",{source:b});const w=u.getSelectedShapes(),_=[],C=[];for(const A of w){if(!A||!u.isShapeOfType(A,"embed")||!A.props.url)continue;const E=new T(A.x,A.y);E.rot(-A.rotation),E.add(new T(A.props.w/2-300/2,A.props.h/2-320/2)),E.rot(A.rotation);const O={id:sn(),type:"bookmark",rotation:A.rotation,x:E.x,y:E.y,opacity:1,props:{url:A.props.url}};_.push(O),C.push(A.id)}u.markHistoryStoppingPoint("convert shapes to bookmark"),u.deleteShapes(C),u.createShapes(_)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(b){f()&&(p()||(s("convert-to-embed",{source:b}),u.run(()=>{const w=u.getSelectedShapeIds(),_=ut(w.map(E=>u.getShape(E))),C=[],A=[];for(const E of _){if(!u.isShapeOfType(E,"bookmark"))continue;const{url:O}=E.props,D=i.getEmbedDefinition(O);if(!D||!D.definition)continue;const{width:B,height:L}=D.definition,j=new T(E.x,E.y);j.rot(-E.rotation),j.add(new T(E.props.w/2-B/2,E.props.h/2-L/2)),j.rot(E.rotation);const F={id:sn(),type:"embed",x:j.x,y:j.y,rotation:E.rotation,props:{url:O,w:B,h:L}};C.push(F),A.push(E.id)}u.markHistoryStoppingPoint("convert shapes to embed"),u.deleteShapes(A),u.createShapes(C)})))}},{id:"duplicate",kbd:"cmd+d,ctrl+d",label:"action.duplicate",icon:"duplicate",onSelect(b){if(!f()||p())return;s("duplicate-shapes",{source:b});const w=u.getInstanceState();let _,C;if(w.duplicateProps)_=w.duplicateProps.shapeIds,C=w.duplicateProps.offset;else{_=u.getSelectedShapeIds();const A=pe.Common(ut(_.map(E=>u.getShapePageBounds(E))));C=u.getCameraOptions().isLocked?{x:u.options.adjacentShapeMargin,y:u.options.adjacentShapeMargin}:{x:A.width+u.options.adjacentShapeMargin,y:0}}u.markHistoryStoppingPoint("duplicate shapes"),u.duplicateShapes(_,C),w.duplicateProps&&u.updateInstanceState({duplicateProps:{...w.duplicateProps,shapeIds:u.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"cmd+shift+g,ctrl+shift+g",icon:"ungroup",onSelect(b){f()&&(p()||(s("ungroup-shapes",{source:b}),u.markHistoryStoppingPoint("ungroup"),u.ungroupShapes(u.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"cmd+g,ctrl+g",icon:"group",onSelect(b){if(!f()||p())return;s("group-shapes",{source:b});const w=u.getOnlySelectedShape();w&&u.isShapeOfType(w,"group")?(u.markHistoryStoppingPoint("ungroup"),u.ungroupShapes(u.getSelectedShapeIds())):(u.markHistoryStoppingPoint("group"),u.groupShapes(u.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"cmd+shift+f,ctrl+shift+f",onSelect(b){if(!f())return;s("remove-frame",{source:b});const w=u.getSelectedShapes();w.length>0&&w.every(_=>u.isShapeOfType(_,"frame"))&&(u.markHistoryStoppingPoint("remove-frame"),jbe(u,w.map(_=>_.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(b){if(!f())return;s("fit-frame-to-content",{source:b});const w=u.getOnlySelectedShape();w&&u.isShapeOfType(w,"frame")&&(u.markHistoryStoppingPoint("fit-frame-to-content"),JV(u,w.id))}},{id:"align-left",label:"action.align-left",kbd:"alt+A",icon:"align-left",onSelect(b){f()&&(p()||(s("align-shapes",{operation:"left",source:b}),u.markHistoryStoppingPoint("align left"),u.run(()=>{const w=u.getSelectedShapeIds();u.alignShapes(w,"left"),un(u,w)})))}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"alt+H",icon:"align-center-horizontal",onSelect(b){f()&&(p()||(s("align-shapes",{operation:"center-horizontal",source:b}),u.markHistoryStoppingPoint("align center horizontal"),u.run(()=>{const w=u.getSelectedShapeIds();u.alignShapes(w,"center-horizontal"),un(u,w)})))}},{id:"align-right",label:"action.align-right",kbd:"alt+D",icon:"align-right",onSelect(b){f()&&(p()||(s("align-shapes",{operation:"right",source:b}),u.markHistoryStoppingPoint("align right"),u.run(()=>{const w=u.getSelectedShapeIds();u.alignShapes(w,"right"),un(u,w)})))}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"alt+V",icon:"align-center-vertical",onSelect(b){f()&&(p()||(s("align-shapes",{operation:"center-vertical",source:b}),u.markHistoryStoppingPoint("align center vertical"),u.run(()=>{const w=u.getSelectedShapeIds();u.alignShapes(w,"center-vertical"),un(u,w)})))}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"alt+W",onSelect(b){f()&&(p()||(s("align-shapes",{operation:"top",source:b}),u.markHistoryStoppingPoint("align top"),u.run(()=>{const w=u.getSelectedShapeIds();u.alignShapes(w,"top"),un(u,w)})))}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"alt+S",onSelect(b){f()&&(p()||(s("align-shapes",{operation:"bottom",source:b}),u.markHistoryStoppingPoint("align bottom"),u.run(()=>{const w=u.getSelectedShapeIds();u.alignShapes(w,"bottom"),un(u,w)})))}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"alt+shift+h",onSelect(b){f()&&(p()||(s("distribute-shapes",{operation:"horizontal",source:b}),u.markHistoryStoppingPoint("distribute horizontal"),u.run(()=>{const w=u.getSelectedShapeIds();u.distributeShapes(w,"horizontal"),un(u,w)})))}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"alt+shift+V",onSelect(b){f()&&(p()||(s("distribute-shapes",{operation:"vertical",source:b}),u.markHistoryStoppingPoint("distribute vertical"),u.run(()=>{const w=u.getSelectedShapeIds();u.distributeShapes(w,"vertical"),un(u,w)})))}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(b){f()&&(p()||(s("stretch-shapes",{operation:"horizontal",source:b}),u.markHistoryStoppingPoint("stretch horizontal"),u.run(()=>{const w=u.getSelectedShapeIds();u.stretchShapes(w,"horizontal"),un(u,w)})))}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(b){f()&&(p()||(s("stretch-shapes",{operation:"vertical",source:b}),u.markHistoryStoppingPoint("stretch vertical"),u.run(()=>{const w=u.getSelectedShapeIds();u.stretchShapes(w,"vertical"),un(u,w)})))}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"shift+h",onSelect(b){f()&&(p()||(s("flip-shapes",{operation:"horizontal",source:b}),u.markHistoryStoppingPoint("flip horizontal"),u.run(()=>{const w=u.getSelectedShapeIds();u.flipShapes(w,"horizontal"),un(u,w)})))}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"shift+v",onSelect(b){f()&&(p()||(s("flip-shapes",{operation:"vertical",source:b}),u.markHistoryStoppingPoint("flip vertical"),u.run(()=>{const w=u.getSelectedShapeIds();u.flipShapes(w,"vertical"),un(u,w)})))}},{id:"pack",label:"action.pack",icon:"pack",onSelect(b){f()&&(p()||(s("pack-shapes",{source:b}),u.markHistoryStoppingPoint("pack"),u.run(()=>{const w=u.getSelectedShapeIds();u.packShapes(w,u.options.adjacentShapeMargin),un(u,w)})))}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(b){f()&&(p()||(s("stack-shapes",{operation:"vertical",source:b}),u.markHistoryStoppingPoint("stack-vertical"),u.run(()=>{const w=u.getSelectedShapeIds();u.stackShapes(w,"vertical",u.options.adjacentShapeMargin),un(u,w)})))}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(b){f()&&(p()||(s("stack-shapes",{operation:"horizontal",source:b}),u.markHistoryStoppingPoint("stack-horizontal"),u.run(()=>{const w=u.getSelectedShapeIds();u.stackShapes(w,"horizontal",u.options.adjacentShapeMargin),un(u,w)})))}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(b){f()&&(p()||(s("reorder-shapes",{operation:"toFront",source:b}),u.markHistoryStoppingPoint("bring to front"),u.bringToFront(u.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"alt+]",onSelect(b){f()&&(p()||(s("reorder-shapes",{operation:"forward",source:b}),u.markHistoryStoppingPoint("bring forward"),u.bringForward(u.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"alt+[",onSelect(b){f()&&(p()||(s("reorder-shapes",{operation:"backward",source:b}),u.markHistoryStoppingPoint("send backward"),u.sendBackward(u.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(b){f()&&(p()||(s("reorder-shapes",{operation:"toBack",source:b}),u.markHistoryStoppingPoint("send to back"),u.sendToBack(u.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"cmd+x,ctrl+x",onSelect(b){f()&&(p()||(u.markHistoryStoppingPoint("cut"),i.cut(b)))}},{id:"copy",label:"action.copy",kbd:"cmd+c,ctrl+c",readonlyOk:!0,onSelect(b){f()&&(p()||i.copy(b))}},{id:"paste",label:"action.paste",kbd:"cmd+v,ctrl+v",onSelect(b){navigator.clipboard?.read().then(w=>{i.paste(w,b,b==="context-menu"?u.inputs.currentPagePoint:void 0)}).catch(()=>{i.addToast({title:i.msg("action.paste-error-title"),description:i.msg("action.paste-error-description"),severity:"error"})})}},{id:"select-all",label:"action.select-all",kbd:"cmd+a,ctrl+a",readonlyOk:!0,onSelect(b){u.run(()=>{p()||(s("select-all-shapes",{source:b}),u.markHistoryStoppingPoint("select all kbd"),u.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(b){f()&&(p()||(s("select-none-shapes",{source:b}),u.markHistoryStoppingPoint("select none"),u.selectNone()))}},{id:"delete",label:"action.delete",kbd:"⌫,del",icon:"trash",onSelect(b){f()&&(p()||(s("delete-shapes",{source:b}),u.markHistoryStoppingPoint("delete"),u.deleteShapes(u.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",kbd:"shift+.,shift+alt+.",onSelect(b){if(!f()||p())return;const w=u.inputs.altKey;s("rotate-cw",{source:b,fine:w}),u.markHistoryStoppingPoint("rotate-cw"),u.run(()=>{const _=br/(w?96:6),C=u.getSelectionRotation()%_,A=Ir(C,0)||Ir(C,_),E=u.getSelectedShapeIds();u.rotateShapesBy(E,_-(A?0:C)),un(u,E)})}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",kbd:"shift+,,shift+alt+,",onSelect(b){if(!f()||p())return;const w=u.inputs.altKey;s("rotate-ccw",{source:b,fine:w}),u.markHistoryStoppingPoint("rotate-ccw"),u.run(()=>{const _=br/(w?96:6),C=u.getSelectionRotation()%_,A=Ir(C,0),E=u.getSelectedShapeIds();u.rotateShapesBy(E,A?-_:-C),un(u,E)})}},{id:"zoom-in",label:"action.zoom-in",kbd:"cmd+=,ctrl+=,=",readonlyOk:!0,onSelect(b){s("zoom-in",{source:b,towardsCursor:!1}),u.zoomIn(void 0,{animation:{duration:u.options.animationMediumMs}})}},{id:"zoom-in-on-cursor",label:"action.zoom-in",kbd:"shift+cmd+=,shift+ctrl+=,shift+=",readonlyOk:!0,onSelect(b){s("zoom-in",{source:b,towardsCursor:!0}),u.zoomIn(u.inputs.currentScreenPoint,{animation:{duration:u.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"cmd+-,ctrl+-,-",readonlyOk:!0,onSelect(b){s("zoom-out",{source:b,towardsCursor:!1}),u.zoomOut(void 0,{animation:{duration:u.options.animationMediumMs}})}},{id:"zoom-out-on-cursor",label:"action.zoom-out",kbd:"shift+cmd+-,shift+ctrl+-,shift+-",readonlyOk:!0,onSelect(b){s("zoom-out",{source:b,towardsCursor:!0}),u.zoomOut(u.inputs.currentScreenPoint,{animation:{duration:u.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"shift+0",readonlyOk:!0,onSelect(b){s("reset-zoom",{source:b}),u.resetZoom(void 0,{animation:{duration:u.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"shift+1",readonlyOk:!0,onSelect(b){s("zoom-to-fit",{source:b}),u.zoomToFit({animation:{duration:u.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"shift+2",readonlyOk:!0,onSelect(b){f()&&(p()||(s("zoom-to-selection",{source:b}),u.zoomToSelection({animation:{duration:u.options.animationMediumMs}})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(b){s("toggle-snap-mode",{source:b}),u.user.updateUserPreferences({isSnapMode:!u.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"cmd+/,ctrl+/",readonlyOk:!0,onSelect(b){const w=u.user.getIsDarkMode()?"light":"dark";s("color-scheme",{source:b,value:w}),u.user.updateUserPreferences({colorScheme:w})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(b){s("toggle-wrap-mode",{source:b}),u.user.updateUserPreferences({isWrapMode:!u.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(b){s("toggle-dynamic-size-mode",{source:b}),u.user.updateUserPreferences({isDynamicSizeMode:!u.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-paste-at-cursor",label:{default:"action.toggle-paste-at-cursor",menu:"action.toggle-paste-at-cursor.menu"},readonlyOk:!1,onSelect(b){s("toggle-paste-at-cursor",{source:b}),u.user.updateUserPreferences({isPasteAtCursorMode:!u.user.getIsPasteAtCursorMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(b){s("toggle-reduce-motion",{source:b}),u.user.updateUserPreferences({animationSpeed:u.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-keyboard-shortcuts",label:{default:"action.toggle-keyboard-shortcuts",menu:"action.toggle-keyboard-shortcuts.menu"},readonlyOk:!0,onSelect(b){s("toggle-keyboard-shortcuts",{source:b}),u.user.updateUserPreferences({areKeyboardShortcutsEnabled:!u.user.getAreKeyboardShortcutsEnabled()})},checkbox:!0},{id:"enhanced-a11y-mode",label:{default:"action.enhanced-a11y-mode",menu:"action.enhanced-a11y-mode.menu"},readonlyOk:!0,onSelect(b){s("enhanced-a11y-mode",{source:b}),u.user.updateUserPreferences({enhancedA11yMode:!u.user.getEnhancedA11yMode()})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(b){s("toggle-edge-scrolling",{source:b}),u.user.updateUserPreferences({edgeScrollSpeed:u.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(b){s("toggle-transparent",{source:b}),u.updateInstanceState({exportBackground:!u.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(b){s("toggle-tool-lock",{source:b}),u.updateInstanceState({isToolLocked:!u.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(b){s("unlock-all",{source:b});const w=[];for(const _ of u.getCurrentPageShapes())_.isLocked&&w.push({id:_.id,type:_.type,isLocked:!1});w.length>0&&u.updateShapes(w)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"cmd+.,ctrl+.",checkbox:!0,onSelect(b){u.timers.requestAnimationFrame(()=>{u.run(()=>{s("toggle-focus-mode",{source:b}),i.clearDialogs(),i.clearToasts(),u.updateInstanceState({isFocusMode:!u.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"cmd+',ctrl+'",onSelect(b){s("toggle-grid-mode",{source:b}),u.updateInstanceState({isGridMode:!u.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(b){s("toggle-debug-mode",{source:b}),u.updateInstanceState({isDebugMode:!u.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"cmd+p,ctrl+p",readonlyOk:!0,onSelect(b){s("print",{source:b}),i.printSelectionOrPages()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(b){s("exit-pen-mode",{source:b}),u.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(b){s("stop-following",{source:b}),u.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(b){s("zoom-to-content",{source:b});const w=u.getSelectionPageBounds()??u.getCurrentPageBounds();w&&u.zoomToBounds(w,{targetZoom:Math.min(1,u.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"shift+l",onSelect(b){u.markHistoryStoppingPoint("locking"),s("toggle-lock",{source:b}),u.toggleLock(u.getSelectedShapeIds())}},{id:"move-to-new-page",label:"context.pages.new-page",onSelect(b){const w=yo.createId(),_=u.getSelectedShapeIds();u.run(()=>{u.markHistoryStoppingPoint("move_shapes_to_page"),u.createPage({name:i.msg("page-menu.new-page-initial-name"),id:w}),u.moveShapesToPage(_,w)}),s("move-to-new-page",{source:b})}},{id:"select-white-color",label:"color-style.white",kbd:"alt+t",onSelect(b){const w=vo;u.run(()=>{u.markHistoryStoppingPoint("change-color"),u.isIn("select")&&u.setStyleForSelectedShapes(w,"white"),u.setStyleForNextShapes(w,"white")}),s("set-style",{source:b,id:w.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"alt+f",onSelect(b){const w=th;u.run(()=>{u.markHistoryStoppingPoint("change-fill"),u.isIn("select")&&u.setStyleForSelectedShapes(w,"fill"),u.setStyleForNextShapes(w,"fill")}),s("set-style",{source:b,id:w.id,value:"fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"shift+f",onSelect:async b=>{const w=u.getSelectedShapeIds();if(w.length===0)return;u.markHistoryStoppingPoint("flattening to image"),s("flatten-to-image",{source:b});const _=await nPe(u,w,u.options.flattenImageBoundsExpand);_?.length&&u.setSelectedShapes(_)}},{id:"select-geo-tool",kbd:"g",onSelect:async b=>{s("select-tool",{source:b,id:"geo-previous"}),u.setCurrentTool("geo")}},{id:"change-page-prev",kbd:"alt+left,alt+up",readonlyOk:!0,onSelect:async b=>{const w=u.getPages(),_=w.findIndex(C=>C.id===u.getCurrentPageId());_<1||(s("change-page",{source:b,direction:"prev"}),u.setCurrentPage(w[_-1].id))}},{id:"change-page-next",kbd:"alt+right,alt+down",readonlyOk:!0,onSelect:async b=>{const w=u.getPages(),_=w.findIndex(C=>C.id===u.getCurrentPageId());if(_===-1||_>=w.length-1){if(u.getCurrentPageShapes().length<=0||u.getIsReadonly())return;s("new-page",{source:b}),u.run(()=>{u.markHistoryStoppingPoint("creating page");const C=yo.createId();u.createPage({name:i.msg("page-menu.new-page-initial-name"),id:C}),u.setCurrentPage(C)});return}u.setCurrentPage(w[_+1].id),s("change-page",{source:b,direction:"next"})}},{id:"adjust-shape-styles",label:"a11y.adjust-shape-styles",kbd:"cmd+Enter,ctrl+Enter",isRequiredA11yAction:!0,onSelect:async b=>{if(!f())return;const w=u.getOnlySelectedShape();if(w&&(u.isShapeOfType(w,"image")||u.isShapeOfType(w,"video"))){u.getContainer().querySelector(".tlui-contextual-toolbar button:first-child")?.focus();return}u.getContainer().querySelector(".tlui-style-panel button")?.focus(),s("adjust-shape-styles",{source:b})}},{id:"a11y-open-context-menu",kbd:"cmd+shift+Enter,ctrl+shift+Enter",isRequiredA11yAction:!0,readonlyOk:!0,onSelect:async b=>{if(!f())return;const w=u.getSelectionPageBounds();if(!w)return;const _=w.x+w.width/2,C=w.y+w.height/2,A=u.pageToScreen(new T(_,C));u.getContainer().querySelector(".tl-canvas")?.dispatchEvent(new PointerEvent("contextmenu",{clientX:A.x,clientY:A.y,bubbles:!0})),s("open-context-menu",{source:b})}},{id:"enlarge-shapes",label:"a11y.enlarge-shape",kbd:"cmd+alt+shift+=,ctrl+alt+shift+=",onSelect:async b=>{y(1.1),s("enlarge-shapes",{source:b})}},{id:"shrink-shapes",label:"a11y.shrink-shape",kbd:"cmd+alt+shift+-,ctrl+alt+shift+-",onSelect:async b=>{y(1/1.1),s("shrink-shapes",{source:b})}},{id:"a11y-repeat-shape-announce",kbd:"alt+r",label:"a11y.repeat-shape",isRequiredA11yAction:!0,readonlyOk:!0,onSelect:async b=>{const w=u.getSelectedShapeIds();if(!w.length)return;const _=XV({editor:u,selectedShapeIds:w,msg:l});_&&(a.announce({msg:""}),u.timers.requestAnimationFrame(()=>{a.announce({msg:_})}),s("a11y-repeat-shape-announce",{source:b}))}},{id:"image-replace",label:"tool.replace-media",icon:"arrow-cycle",readonlyOk:!1,onSelect:async b=>{s("image-replace",{source:b}),i.replaceImage()}},{id:"video-replace",label:"tool.replace-media",icon:"arrow-cycle",readonlyOk:!1,onSelect:async b=>{s("video-replace",{source:b}),i.replaceVideo()}},{id:"download-original",label:"action.download-original",readonlyOk:!0,onSelect:async b=>{const w=u.getSelectedShapes();if(w.length===0)return;const _=w.filter(C=>AX(C,u));if(_.length!==0){for(const C of _){const A=u.getAsset(C.props.assetId);if(!A||!A.props.src)continue;const E=await u.resolveAssetUrl(A.id,{shouldResolveToOriginal:!0});if(!E)return;const O=document.createElement("a");O.href=E,(A.type==="video"||A.type==="image")&&!A.props.src.startsWith("asset:")?O.download=A.props.name:O.download="download",document.body.appendChild(O),O.click(),document.body.removeChild(O)}s("download-original",{source:b})}}}];r&&v.push({id:"open-cursor-chat",label:"action.open-cursor-chat",readonlyOk:!0,kbd:"/",onSelect(b){s("open-cursor-chat",{source:b}),!u.getInstanceState().isCoarsePointer&&u.timers.requestAnimationFrame(()=>{u.updateInstanceState({isChatting:!0})})}});const x=rAe(v);return t?t(u,x,i):x},[i,n,s,t,c,r,l,a,o]);return g.jsx(EX.Provider,{value:d,children:e})}function Fl(){const t=I.useContext(EX);if(!t)throw new Error("useTools must be used within a ToolProvider");return t}function _y(t,e){return t?typeof t=="string"?t:e?t[e]??t.default:void 0:void 0}function js({actionId:t="",...e}){const r=Fl()[t];return r?g.jsx(xv,{...r,...e}):null}function MX(){return EPe()?g.jsx(me,{actionId:"toggle-auto-size"}):null}function OX(){return KY()?g.jsx(me,{actionId:"edit-link"}):null}function oAe(){return Po(1)?g.jsx(me,{actionId:"duplicate"}):null}function DX(){const t=ne();return J("should display flatten option",()=>{if(t.getSelectedShapeIds().length===0)return!1;const r=t.getOnlySelectedShape();return!(r&&t.isShapeOfType(r,"image"))},[t])?g.jsx(me,{actionId:"flatten-to-image"}):null}function sAe(){const t=ne();return J("should display download original option",()=>{const n=t.getSelectedShapes();return n.length===0?!1:n.some(r=>AX(r,t))},[t])?g.jsx(me,{actionId:"download-original"}):null}function jX(){return HY()?g.jsx(me,{actionId:"group"}):null}function RX(){return WY()?g.jsx(me,{actionId:"ungroup"}):null}function $X(){const t=ne();return J("allow unframe",()=>{const n=t.getSelectedShapes();return n.length===0?!1:n.every(r=>t.isShapeOfType(r,"frame"))},[t])?g.jsx(me,{actionId:"remove-frame"}):null}function NX(){const t=ne();return J("allow fit frame to content",()=>{const n=t.getOnlySelectedShape();return n?t.isShapeOfType(n,"frame")&&t.getSortedChildIdsForParent(n).length>0:!1},[t])?g.jsx(me,{actionId:"fit-frame-to-content"}):null}function LX(){const t=ne();return J("selected shapes",()=>t.getSelectedShapes().length>0,[t])?g.jsx(me,{actionId:"toggle-lock"}):null}function GM(){const t=ne(),e=J("isTransparentBg",()=>!t.getInstanceState().exportBackground,[t]);return g.jsx(js,{actionId:"toggle-transparent",checked:e,toggle:!0})}function aAe(){const t=ne(),e=J("any shapes",()=>t.getCurrentPageShapeIds().size>0,[t]);return g.jsx(me,{actionId:"unlock-all",disabled:!e})}function zX(){const t=ne(),e=J("zoomed to 100",()=>t.getZoomLevel()===1,[t]);return g.jsx(me,{actionId:"zoom-to-100",noClose:!0,disabled:e})}function FX(){const t=ne(),e=J("has shapes",()=>t.getCurrentPageShapeIds().size>0,[t]);return g.jsx(me,{actionId:"zoom-to-fit",disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function BX(){const t=ne(),e=J("has shapes",()=>t.getSelectedShapeIds().length>0,[t]);return g.jsx(me,{actionId:"zoom-to-selection",disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function UX(){return g.jsxs(bt,{id:"clipboard",children:[g.jsx(cAe,{}),g.jsx(uAe,{}),g.jsx(dAe,{}),g.jsx(oAe,{}),g.jsx(hAe,{})]})}function lAe(){const t=ne(),e=J("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[t]);return g.jsxs(eo,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!e,children:[g.jsxs(bt,{id:"copy-as-group",children:[g.jsx(me,{actionId:"copy-as-svg"}),!!window.navigator.clipboard?.write&&g.jsx(me,{actionId:"copy-as-png"})]}),g.jsx(bt,{id:"copy-as-bg",children:g.jsx(GM,{})})]})}function cAe(){const t=Po(1);return g.jsx(me,{actionId:"cut",disabled:!t})}function uAe(){const t=VY(1);return g.jsx(me,{actionId:"copy",disabled:!t})}function dAe(){const t=TPe;return g.jsx(me,{actionId:"paste",disabled:!t})}function HX(){const t=ne();return J("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[t])?g.jsxs(bt,{id:"conversions",children:[g.jsx(lAe,{}),g.jsxs(eo,{id:"export-as",label:"context-menu.export-as",size:"small",children:[g.jsxs(bt,{id:"export-as-group",children:[g.jsx(me,{actionId:"export-as-svg"}),g.jsx(me,{actionId:"export-as-png"})]}),g.jsx(bt,{id:"export-as-bg",children:g.jsx(GM,{})})]}),g.jsx(sAe,{})]}):null}function WX(){const t=ne(),e=J("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[t]);return g.jsx(me,{actionId:"select-all",disabled:!e})}function hAe(){const t=Po(1);return g.jsx(me,{actionId:"delete",disabled:!t})}function pAe(){const t=Os();return!VY(1)||t?null:g.jsxs(eo,{id:"edit",label:"context-menu.edit",size:"small",children:[g.jsx(jX,{}),g.jsx(RX,{}),g.jsx(DX,{}),g.jsx(OX,{}),g.jsx(NX,{}),g.jsx($X,{}),g.jsx(KX,{}),g.jsx(VX,{}),g.jsx(MX,{}),g.jsx(LX,{})]})}function fAe(){const t=Po(2),e=APe();return Os()||!(t||e)?null:g.jsxs(eo,{id:"arrange",label:"context-menu.arrange",size:"small",children:[t&&g.jsxs(bt,{id:"align",children:[g.jsx(me,{actionId:"align-left"}),g.jsx(me,{actionId:"align-center-horizontal"}),g.jsx(me,{actionId:"align-right"}),g.jsx(me,{actionId:"align-top"}),g.jsx(me,{actionId:"align-center-vertical"}),g.jsx(me,{actionId:"align-bottom"})]}),g.jsx(gAe,{}),t&&g.jsxs(bt,{id:"stretch",children:[g.jsx(me,{actionId:"stretch-horizontal"}),g.jsx(me,{actionId:"stretch-vertical"})]}),(t||e)&&g.jsxs(bt,{id:"flip",children:[g.jsx(me,{actionId:"flip-horizontal"}),g.jsx(me,{actionId:"flip-vertical"})]}),g.jsx(mAe,{})]})}function gAe(){return Po(3)?g.jsxs(bt,{id:"distribute",children:[g.jsx(me,{actionId:"distribute-horizontal"}),g.jsx(me,{actionId:"distribute-vertical"})]}):null}function mAe(){const t=Po(2),e=UY();return t?g.jsxs(bt,{id:"order",children:[g.jsx(me,{actionId:"pack"}),e&&g.jsx(me,{actionId:"stack-horizontal"}),e&&g.jsx(me,{actionId:"stack-vertical"})]}):null}function yAe(){const t=Os(),e=Po(1);return t||!e?null:g.jsx(eo,{id:"reorder",label:"context-menu.reorder",size:"small",children:g.jsxs(bt,{id:"reorder",children:[g.jsx(me,{actionId:"bring-to-front"}),g.jsx(me,{actionId:"bring-forward"}),g.jsx(me,{actionId:"send-backward"}),g.jsx(me,{actionId:"send-to-back"})]})})}function vAe(){const t=ne(),e=J("pages",()=>t.getPages(),[t]),n=J("current page id",()=>t.getCurrentPageId(),[t]),{addToast:r}=Nl(),i=qn(),o=Os();return!Po(1)||o?null:g.jsxs(eo,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[g.jsx(bt,{id:"pages",children:e.map(a=>g.jsx($t,{id:a.id,disabled:n===a.id,label:a.name.length>30?`${a.name.slice(0,30)}…`:a.name,onSelect:()=>{t.markHistoryStoppingPoint("move_shapes_to_page"),t.moveShapesToPage(t.getSelectedShapeIds(),a.id);const l=t.getPage(a.id);l&&r({title:"Changed Page",description:`Moved to ${l.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{t.markHistoryStoppingPoint("change-page"),t.setCurrentPage(n)}}]}),i("move-to-page",{source:"context-menu"})}},a.id))}),g.jsx(bt,{id:"new-page",children:g.jsx(me,{actionId:"move-to-new-page"})})]})}function VX(){const t=ne();return J("oneEmbedSelected",()=>{const n=t.getOnlySelectedShape();return n?!!(t.isShapeOfType(n,"embed")&&n.props.url&&!t.isShapeOrAncestorLocked(n)):!1},[t])?g.jsx(me,{actionId:"convert-to-bookmark"}):null}function KX(){const t=ne(),e=$M();return J("oneEmbeddableBookmarkSelected",()=>{const r=t.getOnlySelectedShape();return r?!!(t.isShapeOfType(r,"bookmark")&&r.props.url&&e(r.props.url)&&!t.isShapeOrAncestorLocked(r)):!1},[t])?g.jsx(me,{actionId:"convert-to-embed"}):null}function xAe(){const t=ne(),e=J("isSnapMode",()=>t.user.getIsSnapMode(),[t]);return g.jsx(js,{actionId:"toggle-snap-mode",checked:e})}function SAe(){const t=ne(),e=J("isToolLock",()=>t.getInstanceState().isToolLocked,[t]);return g.jsx(js,{actionId:"toggle-tool-lock",checked:e})}function bAe(){const t=ne(),e=J("isGridMode",()=>t.getInstanceState().isGridMode,[t]);return g.jsx(js,{actionId:"toggle-grid",checked:e})}function wAe(){const t=ne(),e=J("isWrapMode",()=>t.user.getIsWrapMode(),[t]);return g.jsx(js,{actionId:"toggle-wrap-mode",checked:e})}function kAe(){const t=ne(),e=J("isFocusMode",()=>t.getInstanceState().isFocusMode,[t]);return g.jsx(js,{actionId:"toggle-focus-mode",checked:e})}function IAe(){const t=ne(),e=J("edgeScrollSpeed",()=>t.user.getEdgeScrollSpeed(),[t]);return g.jsx(js,{actionId:"toggle-edge-scrolling",checked:e===1})}function _Ae(){const t=ne(),e=J("animationSpeed",()=>t.user.getAnimationSpeed(),[t]);return g.jsx(js,{actionId:"toggle-reduce-motion",checked:e===0})}function CAe(){const t=ne(),e=J("keyboardShortcuts",()=>t.user.getAreKeyboardShortcutsEnabled(),[t]);return g.jsx(js,{actionId:"toggle-keyboard-shortcuts",checked:e})}function PAe(){const t=ne(),e=J("enhancedA11yMode",()=>t.user.getEnhancedA11yMode(),[t]);return g.jsx(js,{actionId:"enhanced-a11y-mode",checked:e})}function TAe(){const t=ne(),e=J("isDebugMode",()=>t.getInstanceState().isDebugMode,[t]);return g.jsx(js,{actionId:"toggle-debug-mode",checked:e})}function EAe(){const t=ne(),e=J("dynamic resize",()=>t.user.getIsDynamicResizeMode(),[t]);return g.jsx(js,{actionId:"toggle-dynamic-size-mode",checked:e})}function AAe(){const t=ne(),e=J("paste at cursor",()=>t.user.getIsPasteAtCursorMode(),[t]);return g.jsx(js,{actionId:"toggle-paste-at-cursor",checked:e})}function MAe(){const t=ne();return J("show cursor chat",()=>t.getCurrentToolId()==="select"&&!t.getInstanceState().isCoarsePointer,[t])?g.jsx(me,{actionId:"open-cursor-chat"}):null}function OAe(){return g.jsx(eo,{id:"help menu accessibility",label:"menu.accessibility",children:g.jsxs(bt,{id:"accessibility",children:[g.jsx(_Ae,{}),g.jsx(CAe,{}),g.jsx(PAe,{})]})})}class DAe extends cme{static type="arrow";static props=SU;static migrations=bU;getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5},snap:"none"}}onAfterCreate({binding:e}){const n=this.editor.getShape(e.fromId);n&&RP(this.editor,n)}onAfterChange({bindingAfter:e}){const n=this.editor.getShape(e.fromId);n&&RP(this.editor,n)}onAfterChangeFromShape({shapeAfter:e}){RP(this.editor,e)}onAfterChangeToShape({binding:e,shapeBefore:n,shapeAfter:r,reason:i}){i!=="ancestry"&&n.parentId===r.parentId&&n.index===r.index||qX(this.editor,e.fromId)}onBeforeIsolateFromShape({binding:e}){const n=this.editor.getShape(e.fromId);n&&Kb({editor:this.editor,arrow:n,terminal:e.props.terminal})}}function qX(t,e){const n=t.getShape(e);if(!n)return;const r=Zr(t,n),{start:i,end:o}=r,s=i?t.getShape(i.toId):void 0,a=o?t.getShape(o.toId):void 0,l=t.getAncestorPageId(n);if(!l)return;let c;if(s&&a)c=t.findCommonAncestor([s,a])??l;else if(s||a){const x=(s||a)?.parentId;x&&x===n.parentId?c=n.parentId:c=l}else return;c&&c!==n.parentId&&t.reparentShapes([e],c);const d=t.getShape(e);if(!d)throw Error("no reparented arrow");const u=t.getShapeNearestSibling(d,s),p=t.getShapeNearestSibling(d,a);let f;if(u&&p)f=u.index>p.index?u:p;else if(u&&!p)f=u;else if(p&&!u)f=p;else return;let y;const v=t.getSortedChildIdsForParent(f.parentId).map(x=>t.getShape(x)).filter(x=>x.index>f.index);if(v.length){const x=v.find(b=>b.type!=="arrow");if(d.index>f.index&&(!x||d.index<x.index))return;y=rf(f.index,v[0].index)}else y=na(f.index);y!==d.index&&t.updateShapes([{id:e,type:"arrow",index:y}])}function RP(t,e){const n=Zr(t,e);for(const r of["start","end"]){const i=n[r];if(!i)continue;const o=t.getShape(i.toId),s=t.getAncestorPageId(e)===t.getAncestorPageId(o);(!o||!s)&&Kb({editor:t,arrow:e,terminal:r,unbind:!0})}qX(t,e.id)}function Kb({editor:t,arrow:e,terminal:n,unbind:r=!1,useHandle:i=!1}){const o=ea(t,e);if(!o)throw new Error("expected arrow info");const s=i?o.start.handle:o.start.point,a=i?o.end.handle:o.end.point,l=n==="start"?s:a,c={id:e.id,type:"arrow",props:{[n]:{x:l.x,y:l.y},bend:e.props.bend}};if(o.type==="arc"){const d=n==="start"?s:o.start.handle,u=n==="end"?a:o.end.handle,p=T.Med(d,u),f=T.Sub(d,u).per().uni().mul(o.handleArc.radius*2*Math.sign(e.props.bend)),y=Xy(o.handleArc.center,T.Add(p,f),o.handleArc.center,o.handleArc.radius);Ge(y?.length===1);const v=T.Dist(p,y[0])*Math.sign(e.props.bend);Ir(v,c.props.bend)||(c.props.bend=v)}t.updateShape(c),r&&vm(t,e,n)}function jAe({size:t,width:e,height:n,hideAlternateHandles:r}){const i=ee(t/3),o=i/2,s=Ve();return g.jsxs("svg",{className:"tl-overlays__item","aria-hidden":"true",children:[g.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${ee(0-o)},${ee(t)} 
						${ee(0-o)},${ee(0-o)} 
						${ee(t)},${ee(0-o)}`,strokeWidth:i,"data-testid":"selection.crop.top_left",role:"button","aria-label":s("handle.crop.top-left")}),g.jsx("line",{className:Ye("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:ee(e/2-t),y1:ee(0-o),x2:ee(e/2+t),y2:ee(0-o),strokeWidth:i,"data-testid":"selection.crop.top",role:"button","aria-label":s("handle.crop.top")}),g.jsx("polyline",{className:Ye("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${ee(e-t)},${ee(0-o)} 
						${ee(e+o)},${ee(0-o)} 
						${ee(e+o)},${ee(t)}`,strokeWidth:i,"data-testid":"selection.crop.top_right",role:"button","aria-label":s("handle.crop.top-right")}),g.jsx("line",{className:Ye("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:ee(e+o),y1:ee(n/2-t),x2:ee(e+o),y2:ee(n/2+t),strokeWidth:i,"data-testid":"selection.crop.right",role:"button","aria-label":s("handle.crop.right")}),g.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${ee(e+o)},${ee(n-t)} 
						${ee(e+o)},${ee(n+o)}
						${ee(e-t)},${ee(n+o)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_right",role:"button","aria-label":s("handle.crop.bottom-right")}),g.jsx("line",{className:Ye("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:ee(e/2-t),y1:ee(n+o),x2:ee(e/2+t),y2:ee(n+o),strokeWidth:i,"data-testid":"selection.crop.bottom",role:"button","aria-label":s("handle.crop.bottom")}),g.jsx("polyline",{className:Ye("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${ee(0+t)},${ee(n+o)} 
						${ee(0-o)},${ee(n+o)}
						${ee(0-o)},${ee(n-t)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_left",role:"button","aria-label":s("handle.crop.bottom-left")}),g.jsx("line",{className:Ye("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:ee(0-o),y1:ee(n/2-t),x2:ee(0-o),y2:ee(n/2+t),strokeWidth:i,"data-testid":"selection.crop.left",role:"button","aria-label":s("handle.crop.left")})]})}function RAe({children:t}){const e=ne();return J("shouldDisplayHandles",()=>{if(e.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(e.isInAny("select.editing_shape")){const r=e.getOnlySelectedShape();return r&&e.isShapeOfType(r,"note")}return!1},[e])?g.jsx("svg",{className:"tl-user-handles tl-overlays__item","aria-hidden":"true",children:t}):null}const $Ae=new ki;function zm(t){return $Ae.get(t,()=>qt("arrowTarget",null))}function NAe(t){return zm(t).get()}function YM(t){zm(t).set(null)}function x1({editor:t,pointInPageSpace:e,arrow:n,isPrecise:r,currentBinding:i,oppositeBinding:o}){const s=t.getShapeUtil("arrow");if(s.options.shouldIgnoreTargets(t))return zm(t).set(null),null;const a=n?n.props.kind:t.getStyleForNextShape(lb),l=t.getShapeAtPoint(e,{hitInside:!0,hitFrameInside:!0,margin:a==="elbow"?8:[8,0],filter:V=>!V.isLocked&&t.canBindShapes({fromShape:n??LAe,toShape:V,binding:"arrow"})});if(!l)return zm(t).set(null),null;const c=t.getShapeGeometry(l),d=pe.ZeroFix(c.bounds),u=c.center,p=t.getShapePageTransform(l),f=t.getPointInShapeSpace(l,e),y=Math.max(c.bounds.width,c.bounds.height),v=Uu(oPe,(V,Y)=>{const re=by[sPe[V]],q=T.Mul(Y,y).add(u);let X=!1,N=re.v(d[V],d[re.crossMid]),H=0;const ie=c.intersectLineSegment(u,q,bl.EXCLUDE_NON_STANDARD);for(const ke of ie){const ge=T.Dist2(ke,u);ge>H&&(H=ge,N=ke,X=c.isClosed)}return{point:p.applyToPoint(N),isEnabled:X,far:p.applyToPoint(q)}}),x=t.getZoomLevel(),b=s.options.minElbowHandleDistance/x,w=p.applyToPoint(u);for(const V of Tm(v)){const Y=v[V];T.DistMin(Y.point,w,b)&&(Y.isEnabled=!1)}let _=r;_||(!i||i&&l.id!==i.toId)&&(_=t.inputs.pointerVelocity.len()<.5),r||(c.isClosed||(_=!0),o&&l.id===o.toId&&o.props.isPrecise&&(_=!0));const C=s.options.shouldBeExact(t,_);C&&(_=!0);const A=!C&&_&&c.isClosed,E=!C&&(_&&a==="elbow"||!c.isClosed),O=!C&&_&&a==="elbow"&&c.isClosed,D=_&&(c.isClosed||C),B=!C&&_&&a==="elbow"&&c.isClosed;let L="none",j=e;if(D||(L="center",j=w),E){const V=D?fS(t,d,s.options.elbowArrowEdgeSnapDistance):1/0,Y=c.nearestPoint(f,{includeLabels:!1,includeInternal:!1}),re=p.applyToPoint(Y);T.Dist(re,e)<V&&(L="edge",j=re)}if(B){const V=fS(t,d,s.options.elbowArrowAxisSnapDistance),Y=T.DistanceToLineSegment(v.left.far,v.right.far,e),re=T.DistanceToLineSegment(v.top.far,v.bottom.far,e),q=Y<re&&Y<V?"x":re<V?"y":null;if(q){const X=by[q],N=T.Dist2(v[X.loEdge].far,e),H=T.Dist2(v[X.hiEdge].far,e),ie=N<H?X.loEdge:X.hiEdge;v[ie].isEnabled&&(L="edge-point",j=v[ie].point)}}if(O){const V=fS(t,d,s.options.elbowArrowPointSnapDistance);let Y=null,re=1/0;for(const[q,X]of go(v)){if(!X.isEnabled)continue;const N=T.Dist(X.point,e);N<V&&N<re&&(re=N,Y=q)}Y&&(L="edge-point",j=v[Y].point)}if(A){const V=fS(t,d,a==="elbow"?s.options.elbowArrowCenterSnapDistance:s.options.arcArrowCenterSnapDistance);T.Dist(f,d.center)<V&&(L="center",j=w)}const F=t.getPointInShapeSpace(l,j),z={x:Jm(d.minX,d.maxX,F.x),y:Jm(d.minY,d.maxY,F.y)},$={target:l,arrowKind:a,handlesInPageSpace:v,centerInPageSpace:w,anchorInPageSpace:j,isExact:C,isPrecise:_,snap:L,normalizedAnchor:z};return zm(t).set($),$}const LAe={type:"arrow"};function fS(t,e,n){return pt(Math.min(e.width,e.height)*.15,4,n)/t.getZoomLevel()}function zAe(){const t=ne();return J("should show arrow hints",()=>{if(t.isInAny("arrow.idle","arrow.pointing"))return!0;if(t.isIn("select.pointing_handle")){const n=t.getStateDescendant("select.pointing_handle");if(n.info.shape.type==="arrow"&&(n.info.handle.id==="start"||n.info.handle.id==="end"))return!0}if(t.isIn("select.dragging_handle")){const n=t.getStateDescendant("select.dragging_handle");if(n.info.shape.type==="arrow"&&(n.info.handle.id==="start"||n.info.handle.id==="end"))return!0}return!1},[t])?g.jsx(FAe,{}):null}function FAe(){const t=ne(),{ShapeIndicator:e}=gn(),n=J("arrow target info",()=>NAe(t),[t]);if(!n)return null;const{handlesInPageSpace:r,snap:i,anchorInPageSpace:o,arrowKind:s,isExact:a,isPrecise:l}=n,c=!a&&s==="elbow";return g.jsxs(g.Fragment,{children:[e&&g.jsx(e,{shapeId:n.target.id}),c&&g.jsxs("svg",{className:"tl-overlays__item","aria-hidden":"true",children:[g.jsx("circle",{cx:o.x,cy:o.y,className:`tl-arrow-hint-snap tl-arrow-hint-snap__${l?i??"none":"none"}`}),Object.entries(r).map(([d,u])=>u.isEnabled?g.jsx("circle",{cx:u.point.x,cy:u.point.y,className:"tl-arrow-hint-handle"},d):null)]})]})}const{PI:BAe}=Math,Qp=BAe+1e-4;function GX(t,e={}){const{size:n=16,smoothing:r=.5}=e;if(t.length===0||n<=0)return{left:[],right:[]};const i=t[0],o=t[t.length-1],s=o.runningLength,a=Math.pow(n*r,2),l=[],c=[];let d=t[0].vector,u=t[0].point,p=u,f=u,y=p,v=!1,x;for(let b=0;b<t.length;b++){x=t[b];const{point:w,vector:_}=t[b],C=x.vector.dpr(d),A=(b<t.length-1?t[b+1]:t[b]).vector,E=b<t.length-1?A.dpr(x.vector):1,O=C<0&&!v,D=E!==null&&E<.2;if(O||D){if(E>-.62&&s-x.runningLength>x.radius){const L=d.clone().mul(x.radius);d.clone().cpr(A)<0?(f=T.Add(w,L),y=T.Sub(w,L)):(f=T.Sub(w,L),y=T.Add(w,L)),l.push(f),c.push(y)}else{const L=d.clone().mul(x.radius).per(),j=T.Sub(x.input,L);for(let F=1/13,z=0;z<1;z+=F)f=T.RotWith(j,x.input,Qp*z),l.push(f),y=T.RotWith(j,x.input,Qp+Qp*-z),c.push(y)}u=f,p=y,D&&(v=!0);continue}if(v=!1,x===i||x===o){const L=T.Per(_).mul(x.radius);l.push(T.Sub(w,L)),c.push(T.Add(w,L));continue}const B=T.Lrp(A,_,E).per().mul(x.radius);f=T.Sub(w,B),(b<=1||T.Dist2(u,f)>a)&&(l.push(f),u=f),y=T.Add(w,B),(b<=1||T.Dist2(p,y)>a)&&(c.push(y),p=y),d=_}return{left:l,right:c}}function YX(t,e={}){const{size:n=16,start:r={},end:i={},last:o=!1}=e,{cap:s=!0}=r,{cap:a=!0}=i;if(t.length===0||n<=0)return[];const l=t[0],c=t[t.length-1],d=c.runningLength,u=r.taper===!1?0:r.taper===!0?Math.max(n,d):r.taper,p=i.taper===!1?0:i.taper===!0?Math.max(n,d):i.taper,{left:f,right:y}=GX(t,e),v=l.point,x=t.length>1?t[t.length-1].point:T.AddXY(l.point,1,1);if(t.length===1&&(!(u||p)||o)){const C=T.Add(v,T.Sub(v,x).uni().per().mul(-l.radius)),A=[];for(let E=1/13,O=E;O<=1;O+=E)A.push(T.RotWith(C,v,Qp*2*O));return A}const b=[];if(!(u||p&&t.length===1))if(s)for(let C=1/8,A=C;A<=1;A+=C){const E=T.RotWith(y[0],v,Qp*A);b.push(E)}else{const C=T.Sub(f[0],y[0]),A=T.Mul(C,.5),E=T.Mul(C,.51);b.push(T.Sub(v,A),T.Sub(v,E),T.Add(v,E),T.Add(v,A))}const w=[],_=c.vector.clone().per().neg();if(p||u&&t.length===1)w.push(x);else if(a){const C=T.Add(x,T.Mul(_,c.radius));for(let A=1/29,E=A;E<1;E+=A)w.push(T.RotWith(C,x,Qp*3*E))}else w.push(T.Add(x,T.Mul(_,c.radius)),T.Add(x,T.Mul(_,c.radius*.99)),T.Sub(x,T.Mul(_,c.radius*.99)),T.Sub(x,T.Mul(_,c.radius)));return f.concat(w,y.reverse(),b)}const UAe=.025,HAe=.01;function Nu(t,e={}){const{streamline:n=.5,size:r=16,simulatePressure:i=!1}=e;if(t.length===0)return[];const o=.15+(1-n)*.85;let s=t.map(T.From),a=0;if(!i){let x=s[0];for(;x&&!(x.z>=UAe);)s.shift(),x=s[0]}if(!i){let x=s[s.length-1];for(;x&&!(x.z>=HAe);)s.pop(),x=s[s.length-1]}if(s.length===0)return[{point:T.From(t[0]),input:T.From(t[0]),pressure:i?.5:.15,vector:new T(1,1),distance:0,runningLength:0,radius:1}];let l=s[1];for(;l&&!(T.Dist2(l,s[0])>(r/3)**2);)s[0].z=Math.max(s[0].z,l.z),s.splice(1,1),l=s[1];const c=s.pop();for(l=s[s.length-1];l&&!(T.Dist2(l,c)>(r/3)**2);)s.pop(),l=s[s.length-1],a++;s.push(c);const d=e.last||!e.simulatePressure||s.length>1&&T.Dist2(s[s.length-1],s[s.length-2])<r**2||a>0;if(s.length===2&&e.simulatePressure){const x=s[1];s=s.slice(0,-1);for(let b=1;b<5;b++){const w=T.Lrp(s[0],x,b/4);w.z=(s[0].z+(x.z-s[0].z))*b/4,s.push(w)}}const u=[{point:s[0],input:s[0],pressure:i?.5:s[0].z,vector:new T(1,1),distance:0,runningLength:0,radius:1}];let p=0,f=u[0],y,v;d&&n>0&&s.push(s[s.length-1].clone());for(let x=1,b=s.length;x<b;x++)y=!o||e.last&&x===b-1?s[x].clone():s[x].clone().lrp(f.point,1-o),!f.point.equals(y)&&(v=T.Dist(y,f.point),p+=v,!(x<4&&p<r)&&(f={input:s[x],point:y,pressure:i?.5:s[x].z,vector:T.Sub(f.point,y).uni(),distance:v,runningLength:p,radius:1},u.push(f)));if(u[1]?.vector&&(u[0].vector=u[1].vector.clone()),p<1){const x=Math.max(.5,...u.map(b=>b.pressure));u.forEach(b=>b.pressure=x)}return u}const{min:tu}=Math,$P=.275;function XM(t,e){const{size:n=16,thinning:r=.5,simulatePressure:i=!0,easing:o=x=>x,start:s={},end:a={}}=e,{easing:l=Ui.easeOutQuad}=s,{easing:c=Ui.easeOutCubic}=a,d=t[t.length-1].runningLength;let u,p=t[0].pressure,f;if(!i&&d<n){const x=t.reduce((b,w)=>Math.max(b,w.pressure),.5);return t.forEach(b=>{b.pressure=x,b.radius=n*o(.5-r*(.5-b.pressure))}),t}else{let x;for(let b=0,w=t.length;b<w&&(f=t[b],!(f.runningLength>n*5));b++){const _=tu(1,f.distance/n);if(i){const C=tu(1,1-_);x=tu(1,p+(C-p)*(_*$P))}else x=tu(1,p+(f.pressure-p)*.5);p=p+(x-p)*.5}for(let b=0;b<t.length;b++){if(f=t[b],r){let{pressure:w}=f;const _=tu(1,f.distance/n);if(i){const C=tu(1,1-_);w=tu(1,p+(C-p)*(_*$P))}else w=tu(1,p+(w-p)*(_*$P));f.radius=n*o(.5-r*(.5-w)),p=w}else f.radius=n/2;u===void 0&&(u=f.radius)}}const y=s.taper===!1?0:s.taper===!0?Math.max(n,d):s.taper,v=a.taper===!1?0:a.taper===!0?Math.max(n,d):a.taper;if(y||v)for(let x=0;x<t.length;x++){f=t[x];const{runningLength:b}=f,w=b<y?l(b/y):1,_=d-b<v?c((d-b)/v):1;f.radius=Math.max(.01,f.radius*Math.min(w,_))}return t}function WAe(t,e={}){return YX(XM(Nu(t,e),e),e)}function i6({scribble:t,zoom:e,color:n,opacity:r,className:i}){if(!t.points.length)return null;const o=WAe(t.points,{size:t.size/e,start:{taper:t.taper,easing:Ui.linear},last:t.state==="stopping",simulatePressure:!1,streamline:.32});let s;if(o.length<4){const a=t.size/e/2,{x:l,y:c}=t.points[t.points.length-1];s=`M ${l-a},${c} a ${a},${a} 0 1,0 ${a*2},0 a ${a},${a} 0 1,0 ${-a*2},0`}else s=F7(o);return g.jsx("svg",{className:i&&Ye("tl-overlays__item",i),children:g.jsx("path",{className:"tl-scribble",d:s,fill:n??`var(--tl-color-${t.color})`,opacity:r??t.opacity})})}const VAe=_r(function({bounds:e,rotation:n}){const r=ne(),i=Ve(),o=I.useRef(null),s=Os(),a=ll("top"),l=ll("right"),c=ll("bottom"),d=ll("left"),u=ll("top_left"),p=ll("top_right"),f=ll("bottom_right"),y=ll("bottom_left"),v=r.getInstanceState().cursor.type==="default",x=r.getInstanceState().isCoarsePointer,b=r.getOnlySelectedShape(),w=b&&r.isShapeOrAncestorLocked(b),_=b?r.getShapeUtil(b).expandSelectionOutlinePx(b):0,C=_ instanceof pe?e.clone().expand(_).zeroFix():e.clone().expandBy(_).zeroFix();if(Ky(o,e?.x,e?.y,1,r.getSelectionRotation(),{x:C.x-e.x,y:C.y-e.y}),b&&r.isShapeHidden(b))return null;const A=r.getZoomLevel(),E=r.getInstanceState().isChangingStyle,O=C.width,D=C.height,B=8/A,L=O<B*2,j=D<B*2,F=O<B*4,z=D<B*4,$=O<B*5,V=D<B*5,Y=x?1.75:1,re=6/A*Y,q=(F?re/2:re)*(Y*.75),X=(z?re/2:re)*(Y*.75),N=(b?!r.getShapeUtil(b).hideSelectionBoundsFg(b):!0)&&!E;let H=N&&r.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||N&&r.isIn("select.resizing")&&b&&r.isShapeOfType(b,"text");b&&H&&Jt.isFirefox&&r.isShapeOfType(b,"embed")&&(H=!1);const ie=r.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!E&&!s,U=r.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!E&&!s,ke=!x&&!(L||j)&&(U||ie)&&(b?!r.getShapeUtil(b).hideRotateHandle(b):!0)&&!w,ge=x&&(!F||!z)&&(U||ie)&&(b?!r.getShapeUtil(b).hideRotateHandle(b):!0)&&!w,Te=U&&(b?r.getShapeUtil(b).canResize(b)&&!r.getShapeUtil(b).hideResizeHandles(b):!0)&&!ie&&!w,ye=L||j,Se=L&&j,Re=$||V,$e=Te||ie,Ft=!ke,rn=!U||!ge,Dt=!U||!$e,Kt=!U||!$e||ye,Gt=!U||!$e||ye,Gn=!U||!$e||Se&&!ie;let Ln=!0,Pr=!0;if(ie)Ln=Re,Pr=Re;else if(Te){Ln=ye||Se||x;const gr=x&&b&&b.type==="text";Pr=Ln&&!gr}const Tr=Math.min(24/A,D-X*3),fr=U&&x&&b&&r.isShapeOfType(b,"text")&&Tr*A>=4;return g.jsx("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground","aria-hidden":"true",children:g.jsxs("g",{ref:o,children:[H&&g.jsx("rect",{className:"tl-selection__fg__outline",width:ee(O),height:ee(D)}),g.jsx(gS,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:re,corner:"top_left_rotate",cursor:v?ps("nwse-rotate",n):void 0,isHidden:Ft}),g.jsx(gS,{"data-testid":"selection.rotate.top-right",cx:O+re*3,cy:0,targetSize:re,corner:"top_right_rotate",cursor:v?ps("nesw-rotate",n):void 0,isHidden:Ft}),g.jsx(gS,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:D+re*3,targetSize:re,corner:"bottom_left_rotate",cursor:v?ps("swne-rotate",n):void 0,isHidden:Ft}),g.jsx(gS,{"data-testid":"selection.rotate.bottom-right",cx:O+re*3,cy:D+re*3,targetSize:re,corner:"bottom_right_rotate",cursor:v?ps("senw-rotate",n):void 0,isHidden:Ft}),g.jsx(qAe,{"data-testid":"selection.rotate.mobile",cx:F?-re*1.5:O/2,cy:F?D/2:-re*1.5,size:B,isHidden:rn}),g.jsx(nu,{hide:Ln,dataTestId:"selection.resize.top",ariaLabel:i("handle.resize-top"),x:0,y:ee(0-(z?X*2:X)),width:ee(O),height:ee(Math.max(1,X*2)),cursor:v?ps("ns-resize",n):void 0,events:a}),g.jsx(nu,{hide:Pr,dataTestId:"selection.resize.right",ariaLabel:i("handle.resize-right"),x:ee(O-(F?0:q)),y:0,height:ee(D),width:ee(Math.max(1,q*2)),cursor:v?ps("ew-resize",n):void 0,events:l}),g.jsx(nu,{hide:Ln,dataTestId:"selection.resize.bottom",ariaLabel:i("handle.resize-bottom"),x:0,y:ee(D-(z?0:X)),width:ee(O),height:ee(Math.max(1,X*2)),cursor:v?ps("ns-resize",n):void 0,events:c}),g.jsx(nu,{hide:Pr,dataTestId:"selection.resize.left",ariaLabel:i("handle.resize-left"),x:ee(0-(F?q*2:q)),y:0,height:ee(D),width:ee(Math.max(1,q*2)),cursor:v?ps("ew-resize",n):void 0,events:d}),g.jsx(nu,{hide:Dt,dataTestId:"selection.target.top-left",ariaLabel:i("handle.resize-top-left"),x:ee(0-(F?q*2:q*1.5)),y:ee(0-(z?X*2:X*1.5)),width:ee(q*3),height:ee(X*3),cursor:v?ps("nwse-resize",n):void 0,events:u}),g.jsx(nu,{hide:Kt,dataTestId:"selection.target.top-right",ariaLabel:i("handle.resize-top-right"),x:ee(O-(F?0:q*1.5)),y:ee(0-(z?X*2:X*1.5)),width:ee(q*3),height:ee(X*3),cursor:v?ps("nesw-resize",n):void 0,events:p}),g.jsx(nu,{hide:Gn,dataTestId:"selection.target.bottom-right",ariaLabel:i("handle.resize-bottom-right"),x:ee(O-(F?q:q*1.5)),y:ee(D-(z?X:X*1.5)),width:ee(q*3),height:ee(X*3),cursor:v?ps("nwse-resize",n):void 0,events:f}),g.jsx(nu,{hide:Gt,dataTestId:"selection.target.bottom-left",ariaLabel:i("handle.resize-bottom-left"),x:ee(0-(F?q*3:q*1.5)),y:ee(D-(z?0:X*1.5)),width:ee(q*3),height:ee(X*3),cursor:v?ps("nesw-resize",n):void 0,events:y}),Te&&g.jsxs(g.Fragment,{children:[g.jsx("rect",{"data-testid":"selection.resize.top-left",className:Ye("tl-corner-handle",{"tl-hidden":Dt}),x:ee(0-B/2),y:ee(0-B/2),width:ee(B),height:ee(B)}),g.jsx("rect",{"data-testid":"selection.resize.top-right",className:Ye("tl-corner-handle",{"tl-hidden":Kt}),x:ee(O-B/2),y:ee(0-B/2),width:ee(B),height:ee(B)}),g.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:Ye("tl-corner-handle",{"tl-hidden":Gn}),x:ee(O-B/2),y:ee(D-B/2),width:ee(B),height:ee(B)}),g.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:Ye("tl-corner-handle",{"tl-hidden":Gt}),x:ee(0-B/2),y:ee(D-B/2),width:ee(B),height:ee(B)})]}),fr&&g.jsxs(g.Fragment,{children:[g.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle",x:ee(0-B/4),y:ee(D/2-Tr/2),rx:B/4,width:ee(B/2),height:ee(Tr)}),g.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle",rx:B/4,x:ee(O-B/4),y:ee(D/2-Tr/2),width:ee(B/2),height:ee(Tr)})]}),ie&&g.jsx(jAe,{size:B,width:O,height:D,hideAlternateHandles:Re})]})})}),nu=function({hide:e,dataTestId:n,ariaLabel:r,x:i,y:o,width:s,height:a,cursor:l,events:c}){return g.jsx("rect",{className:Ye("tl-resize-handle","tl-transparent",{"tl-hidden":e}),"data-testid":n,role:"button","aria-label":r,pointerEvents:"all",x:i,y:o,width:s,height:a,cursor:l,...c})},gS=function({cx:e,cy:n,targetSize:r,corner:i,cursor:o,isHidden:s,"data-testid":a}){const l=ll(i),d=Ve()(`handle.rotate.${i}`);return g.jsx("rect",{className:Ye("tl-transparent","tl-rotate-corner",{"tl-hidden":s}),"data-testid":a,role:"button","aria-label":d,pointerEvents:"all",x:ee(e-r*3),y:ee(n-r*3),width:ee(Math.max(1,r*3)),height:ee(Math.max(1,r*3)),cursor:o,...l})},KAe=Math.sqrt(Math.PI),qAe=function({cx:e,cy:n,size:r,isHidden:i,"data-testid":o}){const s=ll("mobile_rotate"),a=ne(),l=J("zoom level",()=>a.getZoomLevel(),[a]),c=Math.max(14*(1/l),20/Math.max(1,l)),d=Ve();return g.jsxs("g",{role:"button","aria-label":d("handle.rotate.mobile_rotate"),children:[g.jsx("circle",{"data-testid":o,pointerEvents:"all",className:Ye("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":i}),cx:e,cy:n,r:c,...s}),g.jsx("circle",{className:Ye("tl-mobile-rotate__fg",{"tl-hidden":i}),cx:e,cy:n,r:r/KAe})]})};function GAe(){const t=ne(),e=J("is in a valid select state",()=>t.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle"),[t]);return g.jsx(B7,{hideAll:!e})}const ZM=[DAe],Vi={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},Br={s:2,m:3.5,l:5,xl:10},Sc={s:18,m:24,l:36,xl:44},Eu={s:18,m:22,l:26,xl:32},YAe={s:18,m:20,l:24,xl:28},bc={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"},XAe=20,TE=4.25,po=16;function ZAe(t,e){const n=t.w/e.w,r=t.h/e.h;return n<=1&&r<=1?t:n>r?{w:t.w/n,h:t.h/n}:{w:t.w/r,h:t.h/r}}async function JAe(t,e,n){const{elements:r,files:i}=e,o={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:t.store.schema.serialize()},s=new Map,a=new Map,l=t.getCurrentPageId(),c=new Map,d=[],u=new Set;r.forEach(b=>{if(c.set(b.id,sn()),b.boundElements!==null)for(const w of b.boundElements)w.type==="text"&&u.add(w.id)});let p=d2;for(const b of r){if(u.has(b.id))continue;const w=c.get(b.id),_={id:w,typeName:"shape",parentId:l,index:p,x:b.x,y:b.y,rotation:0,isLocked:b.locked,opacity:QAe(b.opacity),meta:{}};switch(b.angle!==0&&a.set(w,b.angle),b.groupIds&&b.groupIds.length>0?s.has(b.groupIds[0])?s.get(b.groupIds[0])?.push(w):s.set(b.groupIds[0],[w]):d.push(w),b.type){case"rectangle":case"ellipse":case"diamond":{let C="",A="middle";if(b.boundElements!==null){for(const O of b.boundElements)if(O.type==="text"){const D=r.find(B=>B.id===O.id);D&&(C=D.text,A=sMe[D.textAlign])}}const E=b.backgroundColor==="transparent"?b.strokeColor:b.backgroundColor;o.shapes.push({..._,type:"geo",props:{geo:b.type,url:b.link??"",w:b.width,h:b.height,size:mS[b.strokeWidth]??"draw",color:Gg[E]??"black",richText:dn(C),align:A,dash:yS(b),fill:cMe(b)}});break}case"freedraw":{o.shapes.push({..._,type:"draw",props:{dash:yS(b),size:mS[b.strokeWidth],color:Gg[b.strokeColor]??"black",segments:[{type:"free",points:b.points.map(([C,A,E=.5])=>({x:C,y:A,z:E}))}]}});break}case"line":{if(b.points.slice().length<2)break;const A=Qm(b.points.length);o.shapes.push({..._,type:"line",props:{dash:yS(b),size:mS[b.strokeWidth],color:Gg[b.strokeColor]??"black",spline:b.roundness?"cubic":"line",points:{...Object.fromEntries(b.points.map(([E,O],D)=>{const B=A[D];return[B,{id:B,index:B,x:E,y:O}]}))}}});break}case"arrow":{let C="";if(b.boundElements!==null){for(const B of b.boundElements)if(B.type==="text"){const L=r.find(j=>j.id===B.id);L&&(C=L.text)}}const A=b.points[0],E=b.points[b.points.length-1],O=c.get(b.startBinding?.elementId),D=c.get(b.endBinding?.elementId);o.shapes.push({..._,type:"arrow",props:{richText:dn(C),kind:b.elbowed?"elbow":"arc",bend:lMe(b,A,E),dash:yS(b),size:mS[b.strokeWidth]??"m",color:Gg[b.strokeColor]??"black",start:{x:A[0],y:A[1]},end:{x:E[0],y:E[1]},arrowheadEnd:o6[b.endArrowhead]??"none",arrowheadStart:o6[b.startArrowhead]??"none"}}),O&&o.bindings.push({id:Bd(),typeName:"binding",type:"arrow",fromId:w,toId:O,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),D&&o.bindings.push({id:Bd(),typeName:"binding",type:"arrow",fromId:w,toId:D,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{const{size:C,scale:A}=tMe(b.fontSize);o.shapes.push({..._,type:"text",props:{size:C,scale:A,font:nMe[b.fontFamily]??"draw",color:Gg[b.strokeColor]??"black",richText:dn(b.text),textAlign:aMe[b.textAlign]}});break}case"image":{const C=i[b.fileId];if(!C)break;const A=qu.createId();o.assets.push({id:A,typeName:"asset",type:"image",props:{w:b.width,h:b.height,fileSize:C.size,name:b.id??"Untitled",isAnimated:!1,mimeType:C.mimeType,src:C.dataURL},meta:{}}),o.shapes.push({..._,type:"image",props:{w:b.width,h:b.height,assetId:A}})}}p=na(p)}const f=n??(t.inputs.shiftKey?t.inputs.currentPagePoint:void 0);t.putContentOntoCurrentPage(o,{point:f,select:!1,preserveIds:!0});for(const b of s.values())if(b.length>1){t.groupShapes(b);const w=t.getShape(b[0]);w?.parentId&&co(w.parentId)&&d.push(w.parentId)}for(const[b,w]of a)t.select(b),t.rotateShapesBy([b],w);const y=ut(d.map(b=>t.getShape(b))),v=pe.Common(y.map(b=>t.getShapePageBounds(b))),x=t.getViewportPageBounds().center;t.updateShapes(y.map(b=>{const w={x:(b.x??0)-(v.x+v.w/2),y:(b.y??0)-(v.y+v.h/2)};return{id:b.id,type:b.type,x:x.x+w.x,y:x.y+w.y}})),t.setSelectedShapes(d)}const QAe=t=>{const e=t/100;return e<.2?.1:e<.4?.25:e<.6?.5:e<.8?.75:1},mS={1:"s",2:"m",3:"l",4:"xl"},eMe={16:"s",20:"m",28:"l",36:"xl"};function tMe(t){const e=eMe[t];return e?{size:e,scale:1}:t<16?{size:"s",scale:t/16}:t>36?{size:"xl",scale:t/36}:{size:"m",scale:1}}const nMe={1:"draw",2:"sans",3:"mono"},rMe={gray:["#f8f9fa","#e9ecef","#ced4da","#868e96","#343a40"],red:["#fff5f5","#ffc9c9","#ff8787","#fa5252","#e03131"],pink:["#fff0f6","#fcc2d7","#f783ac","#e64980","#c2255c"],grape:["#f8f0fc","#eebefa","#da77f2","#be4bdb","#9c36b5"],violet:["#f3f0ff","#d0bfff","#9775fa","#7950f2","#6741d9"],indigo:["#edf2ff","#bac8ff","#748ffc","#4c6ef5","#3b5bdb"],blue:["#e7f5ff","#a5d8ff","#4dabf7","#228be6","#1971c2"],cyan:["#e3fafc","#99e9f2","#3bc9db","#15aabf","#0c8599"],teal:["#e6fcf5","#96f2d7","#38d9a9","#12b886","#099268"],green:["#ebfbee","#b2f2bb","#69db7c","#40c057","#2f9e44"],lime:["#f4fce3","#d8f5a2","#a9e34b","#82c91e","#66a80f"],yellow:["#fff9db","#ffec99","#ffd43b","#fab005","#f08c00"],orange:["#fff4e6","#ffd8a8","#ffa94d","#fd7e14","#e8590c"]};function al(t,e,n){const r=[0,1,2,3,4].map(i=>rMe[t][i]);return Object.fromEntries(r.map((i,o)=>[i,o<3?e:n]))}const Gg={...al("gray","grey","black"),...al("red","light-red","red"),...al("pink","light-red","red"),...al("grape","light-violet","violet"),...al("blue","light-blue","blue"),...al("cyan","light-blue","blue"),...al("teal","light-green","green"),...al("green","light-green","green"),...al("yellow","yellow","orange"),...al("orange","yellow","orange"),"#ffffff":"white","#000000":"black"},iMe={solid:"draw",dashed:"dashed",dotted:"dotted"},oMe={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},sMe={left:"start",center:"middle",right:"end"},aMe={left:"start",center:"middle",right:"end"},o6={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function lMe(t,e,n){let r=0;if(t.points.length>2){const i=new T(e[0],e[1]),o=new T(n[0],n[1]),s=new T(t.points[1][0],t.points[1][1]),a=T.Sub(o,i),l=T.Per(a),c=T.Med(o,i),d=T.Sub(c,l),u=T.Add(c,l),p=T.NearestPointOnLineSegment(d,u,s,!1);r=T.Dist(p,c),T.Clockwise(p,o,c)&&(r*=-1)}return r}const yS=t=>{let e=iMe[t.strokeStyle]??"draw";return e==="draw"&&t.roughness===0&&(e="solid"),e},cMe=t=>t.backgroundColor==="transparent"?"none":oMe[t.fillStyle]??"solid",uMe=/(^|[^`])`([^`]+)`(?!`)/,dMe=/(^|[^`])`([^`]+)`(?!`)/g,XX=El.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",ri(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[ah({find:uMe,type:this.type})]},addPasteRules(){return[ju({find:dMe,type:this.type})]}}),hMe=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,pMe=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,ZX=El.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:t}){return["mark",ri(this.options.HTMLAttributes,t),0]},addCommands(){return{setHighlight:t=>({commands:e})=>e.setMark(this.name,t),toggleHighlight:t=>({commands:e})=>e.toggleMark(this.name,t),unsetHighlight:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[ah({find:hMe,type:this.type})]},addPasteRules(){return[ju({find:pMe,type:this.type})]}}),fMe="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mögensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",gMe="ελ1υ2бг1ел3дети4ею2католик6ом3мкд2он1сква6онлайн5рг3рус2ф2сайт3рб3укр3қаз3հայ3ישראל5קום3ابوظبي5رامكو5لاردن4بحرين5جزائر5سعودية6عليان5مغرب5مارات5یران5بارت2زار4يتك3ھارت5تونس4سودان3رية5شبكة4عراق2ب2مان4فلسطين6قطر3كاثوليك6وم3مصر2ليسيا5وريتانيا7قع4همراه5پاکستان7ڀارت4कॉम3नेट3भारत0म्3ोत5संगठन5বাংলা5ভারত2ৰত4ਭਾਰਤ4ભારત4ଭାରତ4இந்தியா6லங்கை6சிங்கப்பூர்11భారత్5ಭಾರತ4ഭാരതം5ලංකා4คอม3ไทย3ລາວ3გე2みんな3アマゾン4クラウド4グーグル4コム2ストア3セール3ファッション6ポイント4世界2中信1国1國1文网3亚马逊3企业2佛山2信息2健康2八卦2公司1益2台湾1灣2商城1店1标2嘉里0大酒店5在线2大拿2天主教3娱乐2家電2广东2微博2慈善2我爱你3手机2招聘2政务1府2新加坡2闻2时尚2書籍2机构2淡马锡3游戏2澳門2点看2移动2组织机构4网址1店1站1络2联通2谷歌2购物2通販2集团2電訊盈科4飞利浦3食品2餐厅2香格里拉3港2닷넷1컴2삼성2한국2",EE="numeric",AE="ascii",ME="alpha",Fm="asciinumeric",bm="alphanumeric",OE="domain",JX="emoji",mMe="scheme",yMe="slashscheme",NP="whitespace";function vMe(t,e){return t in e||(e[t]=[]),e[t]}function $d(t,e,n){e[EE]&&(e[Fm]=!0,e[bm]=!0),e[AE]&&(e[Fm]=!0,e[ME]=!0),e[Fm]&&(e[bm]=!0),e[ME]&&(e[bm]=!0),e[bm]&&(e[OE]=!0),e[JX]&&(e[OE]=!0);for(const r in e){const i=vMe(r,n);i.indexOf(t)<0&&i.push(t)}}function xMe(t,e){const n={};for(const r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}function Ko(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}Ko.groups={};Ko.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let r=0;r<e.jr.length;r++){const i=e.jr[r][0],o=e.jr[r][1];if(o&&i.test(t))return o}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,r){for(let i=0;i<t.length;i++)this.tt(t[i],e,n,r)},tr(t,e,n,r){r=r||Ko.groups;let i;return e&&e.j?i=e:(i=new Ko(e),n&&r&&$d(e,n,r)),this.jr.push([t,i]),i},ts(t,e,n,r){let i=this;const o=t.length;if(!o)return i;for(let s=0;s<o-1;s++)i=i.tt(t[s]);return i.tt(t[o-1],e,n,r)},tt(t,e,n,r){r=r||Ko.groups;const i=this;if(e&&e.j)return i.j[t]=e,e;const o=e;let s,a=i.go(t);if(a?(s=new Ko,Object.assign(s.j,a.j),s.jr.push.apply(s.jr,a.jr),s.jd=a.jd,s.t=a.t):s=new Ko,o){if(r)if(s.t&&typeof s.t=="string"){const l=Object.assign(xMe(s.t,r),n);$d(o,l,r)}else n&&$d(o,n,r);s.t=o}return i.j[t]=s,s}};const At=(t,e,n,r,i)=>t.ta(e,n,r,i),sr=(t,e,n,r,i)=>t.tr(e,n,r,i),s6=(t,e,n,r,i)=>t.ts(e,n,r,i),Ae=(t,e,n,r,i)=>t.tt(e,n,r,i),sc="WORD",DE="UWORD",QX="ASCIINUMERICAL",eZ="ALPHANUMERICAL",Cy="LOCALHOST",jE="TLD",RE="UTLD",GS="SCHEME",jp="SLASH_SCHEME",JM="NUM",$E="WS",QM="NL",Bm="OPENBRACE",Um="CLOSEBRACE",qb="OPENBRACKET",Gb="CLOSEBRACKET",Yb="OPENPAREN",Xb="CLOSEPAREN",Zb="OPENANGLEBRACKET",Jb="CLOSEANGLEBRACKET",Qb="FULLWIDTHLEFTPAREN",ew="FULLWIDTHRIGHTPAREN",tw="LEFTCORNERBRACKET",nw="RIGHTCORNERBRACKET",rw="LEFTWHITECORNERBRACKET",iw="RIGHTWHITECORNERBRACKET",ow="FULLWIDTHLESSTHAN",sw="FULLWIDTHGREATERTHAN",aw="AMPERSAND",lw="APOSTROPHE",cw="ASTERISK",pu="AT",uw="BACKSLASH",dw="BACKTICK",hw="CARET",yu="COLON",eO="COMMA",pw="DOLLAR",cl="DOT",fw="EQUALS",tO="EXCLAMATION",Ys="HYPHEN",Hm="PERCENT",gw="PIPE",mw="PLUS",yw="POUND",Wm="QUERY",nO="QUOTE",tZ="FULLWIDTHMIDDLEDOT",rO="SEMI",ul="SLASH",Vm="TILDE",vw="UNDERSCORE",nZ="EMOJI",xw="SYM";var rZ=Object.freeze({__proto__:null,ALPHANUMERICAL:eZ,AMPERSAND:aw,APOSTROPHE:lw,ASCIINUMERICAL:QX,ASTERISK:cw,AT:pu,BACKSLASH:uw,BACKTICK:dw,CARET:hw,CLOSEANGLEBRACKET:Jb,CLOSEBRACE:Um,CLOSEBRACKET:Gb,CLOSEPAREN:Xb,COLON:yu,COMMA:eO,DOLLAR:pw,DOT:cl,EMOJI:nZ,EQUALS:fw,EXCLAMATION:tO,FULLWIDTHGREATERTHAN:sw,FULLWIDTHLEFTPAREN:Qb,FULLWIDTHLESSTHAN:ow,FULLWIDTHMIDDLEDOT:tZ,FULLWIDTHRIGHTPAREN:ew,HYPHEN:Ys,LEFTCORNERBRACKET:tw,LEFTWHITECORNERBRACKET:rw,LOCALHOST:Cy,NL:QM,NUM:JM,OPENANGLEBRACKET:Zb,OPENBRACE:Bm,OPENBRACKET:qb,OPENPAREN:Yb,PERCENT:Hm,PIPE:gw,PLUS:mw,POUND:yw,QUERY:Wm,QUOTE:nO,RIGHTCORNERBRACKET:nw,RIGHTWHITECORNERBRACKET:iw,SCHEME:GS,SEMI:rO,SLASH:ul,SLASH_SCHEME:jp,SYM:xw,TILDE:Vm,TLD:jE,UNDERSCORE:vw,UTLD:RE,UWORD:DE,WORD:sc,WS:$E});const nc=/[a-z]/,Yg=new RegExp("\\p{L}","u"),LP=new RegExp("\\p{Emoji}","u"),rc=/\d/,zP=/\s/,a6="\r",FP=`
`,SMe="️",bMe="‍",BP="￼";let vS=null,xS=null;function wMe(t=[]){const e={};Ko.groups=e;const n=new Ko;vS==null&&(vS=l6(fMe)),xS==null&&(xS=l6(gMe)),Ae(n,"'",lw),Ae(n,"{",Bm),Ae(n,"}",Um),Ae(n,"[",qb),Ae(n,"]",Gb),Ae(n,"(",Yb),Ae(n,")",Xb),Ae(n,"<",Zb),Ae(n,">",Jb),Ae(n,"（",Qb),Ae(n,"）",ew),Ae(n,"「",tw),Ae(n,"」",nw),Ae(n,"『",rw),Ae(n,"』",iw),Ae(n,"＜",ow),Ae(n,"＞",sw),Ae(n,"&",aw),Ae(n,"*",cw),Ae(n,"@",pu),Ae(n,"`",dw),Ae(n,"^",hw),Ae(n,":",yu),Ae(n,",",eO),Ae(n,"$",pw),Ae(n,".",cl),Ae(n,"=",fw),Ae(n,"!",tO),Ae(n,"-",Ys),Ae(n,"%",Hm),Ae(n,"|",gw),Ae(n,"+",mw),Ae(n,"#",yw),Ae(n,"?",Wm),Ae(n,'"',nO),Ae(n,"/",ul),Ae(n,";",rO),Ae(n,"~",Vm),Ae(n,"_",vw),Ae(n,"\\",uw),Ae(n,"・",tZ);const r=sr(n,rc,JM,{[EE]:!0});sr(r,rc,r);const i=sr(r,nc,QX,{[Fm]:!0}),o=sr(r,Yg,eZ,{[bm]:!0}),s=sr(n,nc,sc,{[AE]:!0});sr(s,rc,i),sr(s,nc,s),sr(i,rc,i),sr(i,nc,i);const a=sr(n,Yg,DE,{[ME]:!0});sr(a,nc),sr(a,rc,o),sr(a,Yg,a),sr(o,rc,o),sr(o,nc),sr(o,Yg,o);const l=Ae(n,FP,QM,{[NP]:!0}),c=Ae(n,a6,$E,{[NP]:!0}),d=sr(n,zP,$E,{[NP]:!0});Ae(n,BP,d),Ae(c,FP,l),Ae(c,BP,d),sr(c,zP,d),Ae(d,a6),Ae(d,FP),sr(d,zP,d),Ae(d,BP,d);const u=sr(n,LP,nZ,{[JX]:!0});Ae(u,"#"),sr(u,LP,u),Ae(u,SMe,u);const p=Ae(u,bMe);Ae(p,"#"),sr(p,LP,u);const f=[[nc,s],[rc,i]],y=[[nc,null],[Yg,a],[rc,o]];for(let v=0;v<vS.length;v++)ru(n,vS[v],jE,sc,f);for(let v=0;v<xS.length;v++)ru(n,xS[v],RE,DE,y);$d(jE,{tld:!0,ascii:!0},e),$d(RE,{utld:!0,alpha:!0},e),ru(n,"file",GS,sc,f),ru(n,"mailto",GS,sc,f),ru(n,"http",jp,sc,f),ru(n,"https",jp,sc,f),ru(n,"ftp",jp,sc,f),ru(n,"ftps",jp,sc,f),$d(GS,{scheme:!0,ascii:!0},e),$d(jp,{slashscheme:!0,ascii:!0},e),t=t.sort((v,x)=>v[0]>x[0]?1:-1);for(let v=0;v<t.length;v++){const x=t[v][0],w=t[v][1]?{[mMe]:!0}:{[yMe]:!0};x.indexOf("-")>=0?w[OE]=!0:nc.test(x)?rc.test(x)?w[Fm]=!0:w[AE]=!0:w[EE]=!0,s6(n,x,x,w)}return s6(n,"localhost",Cy,{ascii:!0}),n.jd=new Ko(xw),{start:n,tokens:Object.assign({groups:e},rZ)}}function iZ(t,e){const n=kMe(e.replace(/[A-Z]/g,a=>a.toLowerCase())),r=n.length,i=[];let o=0,s=0;for(;s<r;){let a=t,l=null,c=0,d=null,u=-1,p=-1;for(;s<r&&(l=a.go(n[s]));)a=l,a.accepts()?(u=0,p=0,d=a):u>=0&&(u+=n[s].length,p++),c+=n[s].length,o+=n[s].length,s++;o-=u,s-=p,c-=u,i.push({t:d.t,v:e.slice(o-c,o),s:o-c,e:o})}return i}function kMe(t){const e=[],n=t.length;let r=0;for(;r<n;){let i=t.charCodeAt(r),o,s=i<55296||i>56319||r+1===n||(o=t.charCodeAt(r+1))<56320||o>57343?t[r]:t.slice(r,r+2);e.push(s),r+=s.length}return e}function ru(t,e,n,r,i){let o;const s=e.length;for(let a=0;a<s-1;a++){const l=e[a];t.j[l]?o=t.j[l]:(o=new Ko(r),o.jr=i.slice(),t.j[l]=o),t=o}return o=new Ko(n),o.jr=i.slice(),t.j[e[s-1]]=o,o}function l6(t){const e=[],n=[];let r=0,i="0123456789";for(;r<t.length;){let o=0;for(;i.indexOf(t[r+o])>=0;)o++;if(o>0){e.push(n.join(""));for(let s=parseInt(t.substring(r,r+o),10);s>0;s--)n.pop();r+=o}else n.push(t[r]),r++}return e}const Py={defaultProtocol:"http",events:null,format:c6,formatHref:c6,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function iO(t,e=null){let n=Object.assign({},Py);t&&(n=Object.assign(n,t instanceof iO?t.o:t));const r=n.ignoreTags,i=[];for(let o=0;o<r.length;o++)i.push(r[o].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=i}iO.prototype={o:Py,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const r=e!=null;let i=this.o[t];return i&&(typeof i=="object"?(i=n.t in i?i[n.t]:Py[t],typeof i=="function"&&r&&(i=i(e,n))):typeof i=="function"&&r&&(i=i(e,n.t,n)),i)},getObj(t,e,n){let r=this.o[t];return typeof r=="function"&&e!=null&&(r=r(e,n.t,n)),r},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function c6(t){return t}function oZ(t,e){this.t="token",this.v=t,this.tk=e}oZ.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"…":r},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=Py.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),i=t.get("tagName",n,e),o=this.toFormattedString(t),s={},a=t.get("className",n,e),l=t.get("target",n,e),c=t.get("rel",n,e),d=t.getObj("attributes",n,e),u=t.getObj("events",n,e);return s.href=r,a&&(s.class=a),l&&(s.target=l),c&&(s.rel=c),d&&Object.assign(s,d),{tagName:i,attributes:s,content:o,eventListeners:u}}};function S1(t,e){class n extends oZ{constructor(i,o){super(i,o),this.t=t}}for(const r in e)n.prototype[r]=e[r];return n.t=t,n}const u6=S1("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),d6=S1("text"),IMe=S1("nl"),SS=S1("url",{isLink:!0,toHref(t=Py.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==Cy&&t[1].t===yu}}),Gs=t=>new Ko(t);function _Me({groups:t}){const e=t.domain.concat([aw,cw,pu,uw,dw,hw,pw,fw,Ys,JM,Hm,gw,mw,yw,ul,xw,Vm,vw]),n=[lw,yu,eO,cl,tO,Hm,Wm,nO,rO,Zb,Jb,Bm,Um,Gb,qb,Yb,Xb,Qb,ew,tw,nw,rw,iw,ow,sw],r=[aw,lw,cw,uw,dw,hw,pw,fw,Ys,Bm,Um,Hm,gw,mw,yw,Wm,ul,xw,Vm,vw],i=Gs(),o=Ae(i,Vm);At(o,r,o),At(o,t.domain,o);const s=Gs(),a=Gs(),l=Gs();At(i,t.domain,s),At(i,t.scheme,a),At(i,t.slashscheme,l),At(s,r,o),At(s,t.domain,s);const c=Ae(s,pu);Ae(o,pu,c),Ae(a,pu,c),Ae(l,pu,c);const d=Ae(o,cl);At(d,r,o),At(d,t.domain,o);const u=Gs();At(c,t.domain,u),At(u,t.domain,u);const p=Ae(u,cl);At(p,t.domain,u);const f=Gs(u6);At(p,t.tld,f),At(p,t.utld,f),Ae(c,Cy,f);const y=Ae(u,Ys);Ae(y,Ys,y),At(y,t.domain,u),At(f,t.domain,u),Ae(f,cl,p),Ae(f,Ys,y);const v=Ae(f,yu);At(v,t.numeric,u6);const x=Ae(s,Ys),b=Ae(s,cl);Ae(x,Ys,x),At(x,t.domain,s),At(b,r,o),At(b,t.domain,s);const w=Gs(SS);At(b,t.tld,w),At(b,t.utld,w),At(w,t.domain,s),At(w,r,o),Ae(w,cl,b),Ae(w,Ys,x),Ae(w,pu,c);const _=Ae(w,yu),C=Gs(SS);At(_,t.numeric,C);const A=Gs(SS),E=Gs();At(A,e,A),At(A,n,E),At(E,e,A),At(E,n,E),Ae(w,ul,A),Ae(C,ul,A);const O=Ae(a,yu),D=Ae(l,yu),B=Ae(D,ul),L=Ae(B,ul);At(a,t.domain,s),Ae(a,cl,b),Ae(a,Ys,x),At(l,t.domain,s),Ae(l,cl,b),Ae(l,Ys,x),At(O,t.domain,A),Ae(O,ul,A),Ae(O,Wm,A),At(L,t.domain,A),At(L,e,A),Ae(L,ul,A);const j=[[Bm,Um],[qb,Gb],[Yb,Xb],[Zb,Jb],[Qb,ew],[tw,nw],[rw,iw],[ow,sw]];for(let F=0;F<j.length;F++){const[z,$]=j[F],V=Ae(A,z);Ae(E,z,V),Ae(V,$,A);const Y=Gs(SS);At(V,e,Y);const re=Gs();At(V,n),At(Y,e,Y),At(Y,n,re),At(re,e,Y),At(re,n,re),Ae(Y,$,A),Ae(re,$,A)}return Ae(i,Cy,w),Ae(i,QM,IMe),{start:i,tokens:rZ}}function CMe(t,e,n){let r=n.length,i=0,o=[],s=[];for(;i<r;){let a=t,l=null,c=null,d=0,u=null,p=-1;for(;i<r&&!(l=a.go(n[i].t));)s.push(n[i++]);for(;i<r&&(c=l||a.go(n[i].t));)l=null,a=c,a.accepts()?(p=0,u=a):p>=0&&p++,i++,d++;if(p<0)i-=d,i<r&&(s.push(n[i]),i++);else{s.length>0&&(o.push(UP(d6,e,s)),s=[]),i-=p,d-=p;const f=u.t,y=n.slice(i-d,i);o.push(UP(f,e,y))}}return s.length>0&&o.push(UP(d6,e,s)),o}function UP(t,e,n){const r=n[0].s,i=n[n.length-1].e,o=e.slice(r,i);return new t(o,n)}const PMe=typeof console<"u"&&console&&console.warn||(()=>{}),TMe="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",jn={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function EMe(){return Ko.groups={},jn.scanner=null,jn.parser=null,jn.tokenQueue=[],jn.pluginQueue=[],jn.customSchemes=[],jn.initialized=!1,jn}function h6(t,e=!1){if(jn.initialized&&PMe(`linkifyjs: already initialized - will not register custom scheme "${t}" ${TMe}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);jn.customSchemes.push([t,e])}function AMe(){jn.scanner=wMe(jn.customSchemes);for(let t=0;t<jn.tokenQueue.length;t++)jn.tokenQueue[t][1]({scanner:jn.scanner});jn.parser=_Me(jn.scanner.tokens);for(let t=0;t<jn.pluginQueue.length;t++)jn.pluginQueue[t][1]({scanner:jn.scanner,parser:jn.parser});return jn.initialized=!0,jn}function oO(t){return jn.initialized||AMe(),CMe(jn.parser.start,t,iZ(jn.scanner.start,t))}oO.scan=iZ;function sZ(t,e=null,n=null){if(e&&typeof e=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const r=new iO(n),i=oO(t),o=[];for(let s=0;s<i.length;s++){const a=i[s];a.isLink&&(!e||a.t===e)&&r.check(a)&&o.push(a.toFormattedObject(r))}return o}const sO="[\0-   ᠎ -\u2029 　]",MMe=new RegExp(sO),OMe=new RegExp(`${sO}$`),DMe=new RegExp(sO,"g");function jMe(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function RMe(t){return new _i({key:new As("autolink"),appendTransaction:(e,n,r)=>{const i=e.some(c=>c.docChanged)&&!n.doc.eq(r.doc),o=e.some(c=>c.getMeta("preventAutolink"));if(!i||o)return;const{tr:s}=r,a=ASe(n.doc,[...e]);if(FSe(a).forEach(({newRange:c})=>{const d=OSe(r.doc,c,f=>f.isTextblock);let u,p;if(d.length>1)u=d[0],p=r.doc.textBetween(u.pos,u.pos+u.node.nodeSize,void 0," ");else if(d.length){const f=r.doc.textBetween(c.from,c.to," "," ");if(!OMe.test(f))return;u=d[0],p=r.doc.textBetween(u.pos,c.to,void 0," ")}if(u&&p){const f=p.split(MMe).filter(Boolean);if(f.length<=0)return!1;const y=f[f.length-1],v=u.pos+p.lastIndexOf(y);if(!y)return!1;const x=oO(y).map(b=>b.toObject(t.defaultProtocol));if(!jMe(x))return!1;x.filter(b=>b.isLink).map(b=>({...b,from:v+b.start+1,to:v+b.end+1})).filter(b=>r.schema.marks.code?!r.doc.rangeHasMark(b.from,b.to,r.schema.marks.code):!0).filter(b=>t.validate(b.value)).filter(b=>t.shouldAutoLink(b.value)).forEach(b=>{FA(b.from,b.to,r.doc).some(w=>w.mark.type===t.type)||s.addMark(b.from,b.to,t.type.create({href:b.href}))})}}),!!s.steps.length)return s}})}function $Me(t){return new _i({key:new As("handleClickLink"),props:{handleClick:(e,n,r)=>{var i,o;if(r.button!==0||!e.editable)return!1;let s=r.target;const a=[];for(;s.nodeName!=="DIV";)a.push(s),s=s.parentNode;if(!a.find(p=>p.nodeName==="A"))return!1;const l=HV(e.state,t.type.name),c=r.target,d=(i=c?.href)!==null&&i!==void 0?i:l.href,u=(o=c?.target)!==null&&o!==void 0?o:l.target;return c&&d?(window.open(d,u),!0):!1}}})}function NMe(t){return new _i({key:new As("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{state:i}=e,{selection:o}=i,{empty:s}=o;if(s)return!1;let a="";r.content.forEach(c=>{a+=c.textContent});const l=sZ(a,{defaultProtocol:t.defaultProtocol}).find(c=>c.isLink&&c.value===a);return!a||!l?!1:t.editor.commands.setMark(t.type,{href:l.href})}}})}function _d(t,e){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(r=>{const i=typeof r=="string"?r:r.scheme;i&&n.push(i)}),!t||t.replace(DMe,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}const LMe=El.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){h6(t);return}h6(t.scheme,t.optionalSlashes)})},onDestroy(){EMe()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!_d(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>!!t}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:n=>!!_d(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!_d(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",ri(this.options.HTMLAttributes,t),0]:["a",ri(this.options.HTMLAttributes,{...t,href:""}),0]},addCommands(){return{setLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!_d(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!_d(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run():!1},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[ju({find:t=>{const e=[];if(t){const{protocols:n,defaultProtocol:r}=this.options,i=sZ(t).filter(o=>o.isLink&&this.options.isAllowedUri(o.value,{defaultValidate:s=>!!_d(s,n),protocols:n,defaultProtocol:r}));i.length&&i.forEach(o=>e.push({text:o.value,data:{href:o.href},index:o.start}))}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)===null||e===void 0?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:n}=this.options;return this.options.autolink&&t.push(RMe({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:r=>this.options.isAllowedUri(r,{defaultValidate:i=>!!_d(i,e),protocols:e,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),this.options.openOnClick===!0&&t.push($Me({type:this.type})),this.options.linkOnPaste&&t.push(NMe({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),t}}),zMe=/^\s*>\s$/,FMe=Ya.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",ri(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[fy({find:zMe,type:this.type})]}}),BMe=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,UMe=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,HMe=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,WMe=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,VMe=El.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",ri(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[ah({find:BMe,type:this.type}),ah({find:HMe,type:this.type})]},addPasteRules(){return[ju({find:UMe,type:this.type}),ju({find:WMe,type:this.type})]}}),KMe="listItem",p6="textStyle",f6=/^\s*([-+*])\s$/,qMe=Ya.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",ri(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(KMe,this.editor.getAttributes(p6)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=fy({find:f6,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=fy({find:f6,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(p6),editor:this.editor})),[t]}}),GMe=/^```([a-z]+)?[\s\n]$/,YMe=/^~~~([a-z]+)?[\s\n]$/,XMe=Ya.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options,o=[...((e=t.firstElementChild)===null||e===void 0?void 0:e.classList)||[]].filter(s=>s.startsWith(n)).map(s=>s.replace(n,""))[0];return o||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",ri(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:i}=n;if(!i||r.parent.type!==this.type)return!1;const o=r.parentOffset===r.parent.nodeSize-2,s=r.parent.textContent.endsWith(`

`);return!o||!s?!1:t.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:i,empty:o}=n;if(!o||i.parent.type!==this.type||!(i.parentOffset===i.parent.nodeSize-2))return!1;const a=i.after();return a===void 0?!1:r.nodeAt(a)?t.commands.command(({tr:c})=>(c.setSelection(Mt.near(r.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[tE({find:GMe,type:this.type,getAttributes:t=>({language:t[1]})}),tE({find:YMe,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new _i({key:new As("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),i=r?JSON.parse(r):void 0,o=i?.mode;if(!n||!o)return!1;const{tr:s,schema:a}=t.state,l=a.text(n.replace(/\r\n?/g,`
`));return s.replaceSelectionWith(this.type.create({language:o},l)),s.selection.$from.parent.type!==this.type&&s.setSelection(wt.near(s.doc.resolve(Math.max(0,s.selection.from-2)))),s.setMeta("paste",!0),t.dispatch(s),!0}}})]}}),ZMe=Ya.create({name:"doc",topNode:!0,content:"block+"});function JMe(t={}){return new _i({view(e){return new QMe(e,t)}})}class QMe{constructor(e,n){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(i=>{let o=s=>{this[i](s)};return e.dom.addEventListener(i,o),{name:i,handler:o}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r,i=this.editorView.dom,o=i.getBoundingClientRect(),s=o.width/i.offsetWidth,a=o.height/i.offsetHeight;if(n){let u=e.nodeBefore,p=e.nodeAfter;if(u||p){let f=this.editorView.nodeDOM(this.cursorPos-(u?u.nodeSize:0));if(f){let y=f.getBoundingClientRect(),v=u?y.bottom:y.top;u&&p&&(v=(v+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let x=this.width/2*a;r={left:y.left,right:y.right,top:v-x,bottom:v+x}}}}if(!r){let u=this.editorView.coordsAtPos(this.cursorPos),p=this.width/2*s;r={left:u.left-p,right:u.left+p,top:u.top,bottom:u.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let c,d;if(!l||l==document.body&&getComputedStyle(l).position=="static")c=-pageXOffset,d=-pageYOffset;else{let u=l.getBoundingClientRect(),p=u.width/l.offsetWidth,f=u.height/l.offsetHeight;c=u.left-l.scrollLeft*p,d=u.top-l.scrollTop*f}this.element.style.left=(r.left-c)/s+"px",this.element.style.top=(r.top-d)/a+"px",this.element.style.width=(r.right-r.left)/s+"px",this.element.style.height=(r.bottom-r.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),i=r&&r.type.spec.disableDropCursor,o=typeof i=="function"?i(this.editorView,n,e):i;if(n&&!o){let s=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=MW(this.editorView.state.doc,s,this.editorView.dragging.slice);a!=null&&(s=a)}this.setCursor(s),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const eOe=wi.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[JMe(this.options)]}});class cr extends Mt{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return cr.valid(r)?new cr(r):Mt.near(r)}content(){return He.empty}eq(e){return e instanceof cr&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new cr(e.resolve(n.pos))}getBookmark(){return new aO(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!tOe(e)||!nOe(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let i=n.contentMatchAt(e.index()).defaultType;return i&&i.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&cr.valid(e))return e;let i=e.pos,o=null;for(let s=e.depth;;s--){let a=e.node(s);if(n>0?e.indexAfter(s)<a.childCount:e.index(s)>0){o=a.child(n>0?e.indexAfter(s):e.index(s)-1);break}else if(s==0)return null;i+=n;let l=e.doc.resolve(i);if(cr.valid(l))return l}for(;;){let s=n>0?o.firstChild:o.lastChild;if(!s){if(o.isAtom&&!o.isText&&!ot.isSelectable(o)){e=e.doc.resolve(i+o.nodeSize*n),r=!1;continue e}break}o=s,i+=n;let a=e.doc.resolve(i);if(cr.valid(a))return a}return null}}}cr.prototype.visible=!1;cr.findFrom=cr.findGapCursorFrom;Mt.jsonID("gapcursor",cr);class aO{constructor(e){this.pos=e}map(e){return new aO(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return cr.valid(n)?new cr(n):Mt.near(n)}}function aZ(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function tOe(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n-1);;i=i.lastChild){if(i.childCount==0&&!i.inlineContent||aZ(i.type))return!0;if(i.inlineContent)return!1}}return!0}function nOe(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let i=r.child(n);;i=i.firstChild){if(i.childCount==0&&!i.inlineContent||aZ(i.type))return!0;if(i.inlineContent)return!1}}return!0}function rOe(){return new _i({props:{decorations:aOe,createSelectionBetween(t,e,n){return e.pos==n.pos&&cr.valid(n)?new cr(n):null},handleClick:oOe,handleKeyDown:iOe,handleDOMEvents:{beforeinput:sOe}}})}const iOe=xV({ArrowLeft:bS("horiz",-1),ArrowRight:bS("horiz",1),ArrowUp:bS("vert",-1),ArrowDown:bS("vert",1)});function bS(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,i,o){let s=r.selection,a=e>0?s.$to:s.$from,l=s.empty;if(s instanceof wt){if(!o.endOfTextblock(n)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let c=cr.findGapCursorFrom(a,e,l);return c?(i&&i(r.tr.setSelection(new cr(c))),!0):!1}}function oOe(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!cr.valid(r))return!1;let i=t.posAtCoords({left:n.clientX,top:n.clientY});return i&&i.inside>-1&&ot.isSelectable(t.state.doc.nodeAt(i.inside))?!1:(t.dispatch(t.state.tr.setSelection(new cr(r))),!0)}function sOe(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof cr))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let i=Pe.empty;for(let s=r.length-1;s>=0;s--)i=Pe.from(r[s].createAndFill(null,i));let o=t.state.tr.replace(n.pos,n.pos,new He(i,0,0));return o.setSelection(wt.near(o.doc.resolve(n.pos+1))),t.dispatch(o),!1}function aOe(t){if(!(t.selection instanceof cr))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",Fr.create(t.doc,[ia.widget(t.selection.head,e,{key:"gapcursor"})])}const lOe=wi.create({name:"gapCursor",addProseMirrorPlugins(){return[rOe()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=Nt(Ze(t,"allowGapCursor",n)))!==null&&e!==void 0?e:null}}}),cOe=Ya.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",ri(this.options.HTMLAttributes,t)]},renderText(){return`
`},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:i,storedMarks:o}=n;if(i.$from.parent.type.spec.isolating)return!1;const{keepMarks:s}=this.options,{splittableMarks:a}=r.extensionManager,l=o||i.$to.parentOffset&&i.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:d})=>{if(d&&l&&s){const u=l.filter(p=>a.includes(p.type.name));c.ensureMarks(u)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),uOe=Ya.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,ri(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>tE({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}});var Sw=200,ti=function(){};ti.prototype.append=function(e){return e.length?(e=ti.from(e),!this.length&&e||e.length<Sw&&this.leafAppend(e)||this.length<Sw&&e.leafPrepend(this)||this.appendInner(e)):this};ti.prototype.prepend=function(e){return e.length?ti.from(e).append(this):this};ti.prototype.appendInner=function(e){return new dOe(this,e)};ti.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?ti.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};ti.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};ti.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};ti.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var i=[];return this.forEach(function(o,s){return i.push(e(o,s))},n,r),i};ti.from=function(e){return e instanceof ti?e:e&&e.length?new lZ(e):ti.empty};var lZ=(function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(i,o){return i==0&&o==this.length?this:new e(this.values.slice(i,o))},e.prototype.getInner=function(i){return this.values[i]},e.prototype.forEachInner=function(i,o,s,a){for(var l=o;l<s;l++)if(i(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(i,o,s,a){for(var l=o-1;l>=s;l--)if(i(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(i){if(this.length+i.length<=Sw)return new e(this.values.concat(i.flatten()))},e.prototype.leafPrepend=function(i){if(this.length+i.length<=Sw)return new e(i.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e})(ti);ti.empty=new lZ([]);var dOe=(function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,i,o,s){var a=this.left.length;if(i<a&&this.left.forEachInner(r,i,Math.min(o,a),s)===!1||o>a&&this.right.forEachInner(r,Math.max(i-a,0),Math.min(this.length,o)-a,s+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,i,o,s){var a=this.left.length;if(i>a&&this.right.forEachInvertedInner(r,i-a,Math.max(o,a)-a,s+a)===!1||o<a&&this.left.forEachInvertedInner(r,Math.min(i,a),o,s)===!1)return!1},e.prototype.sliceInner=function(r,i){if(r==0&&i==this.length)return this;var o=this.left.length;return i<=o?this.left.slice(r,i):r>=o?this.right.slice(r-o,i-o):this.left.slice(r,o).append(this.right.slice(0,i-o))},e.prototype.leafAppend=function(r){var i=this.right.leafAppend(r);if(i)return new e(this.left,i)},e.prototype.leafPrepend=function(r){var i=this.left.leafPrepend(r);if(i)return new e(i,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e})(ti);const hOe=500;class ja{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let i,o;n&&(i=this.remapping(r,this.items.length),o=i.maps.length);let s=e.tr,a,l,c=[],d=[];return this.items.forEach((u,p)=>{if(!u.step){i||(i=this.remapping(r,p+1),o=i.maps.length),o--,d.push(u);return}if(i){d.push(new dl(u.map));let f=u.step.map(i.slice(o)),y;f&&s.maybeStep(f).doc&&(y=s.mapping.maps[s.mapping.maps.length-1],c.push(new dl(y,void 0,void 0,c.length+d.length))),o--,y&&i.appendMap(y,o)}else s.maybeStep(u.step);if(u.selection)return a=i?u.selection.map(i.slice(o)):u.selection,l=new ja(this.items.slice(0,r).append(d.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:s,selection:a}}addTransform(e,n,r,i){let o=[],s=this.eventCount,a=this.items,l=!i&&a.length?a.get(a.length-1):null;for(let d=0;d<e.steps.length;d++){let u=e.steps[d].invert(e.docs[d]),p=new dl(e.mapping.maps[d],u,n),f;(f=l&&l.merge(p))&&(p=f,d?o.pop():a=a.slice(0,a.length-1)),o.push(p),n&&(s++,n=void 0),i||(l=p)}let c=s-r.depth;return c>fOe&&(a=pOe(a,c),s-=c),new ja(a.append(o),s)}remapping(e,n){let r=new ay;return this.items.forEach((i,o)=>{let s=i.mirrorOffset!=null&&o-i.mirrorOffset>=e?r.maps.length-i.mirrorOffset:void 0;r.appendMap(i.map,s)},e,n),r}addMaps(e){return this.eventCount==0?this:new ja(this.items.append(e.map(n=>new dl(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],i=Math.max(0,this.items.length-n),o=e.mapping,s=e.steps.length,a=this.eventCount;this.items.forEach(p=>{p.selection&&a--},i);let l=n;this.items.forEach(p=>{let f=o.getMirror(--l);if(f==null)return;s=Math.min(s,f);let y=o.maps[f];if(p.step){let v=e.steps[f].invert(e.docs[f]),x=p.selection&&p.selection.map(o.slice(l+1,f));x&&a++,r.push(new dl(y,v,x))}else r.push(new dl(y))},i);let c=[];for(let p=n;p<s;p++)c.push(new dl(o.maps[p]));let d=this.items.slice(0,i).append(c).append(r),u=new ja(d,a);return u.emptyItemCount()>hOe&&(u=u.compress(this.items.length-r.length)),u}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,i=[],o=0;return this.items.forEach((s,a)=>{if(a>=e)i.push(s),s.selection&&o++;else if(s.step){let l=s.step.map(n.slice(r)),c=l&&l.getMap();if(r--,c&&n.appendMap(c,r),l){let d=s.selection&&s.selection.map(n.slice(r));d&&o++;let u=new dl(c.invert(),l,d),p,f=i.length-1;(p=i.length&&i[f].merge(u))?i[f]=p:i.push(u)}}else s.map&&r--},this.items.length,0),new ja(ti.from(i.reverse()),o)}}ja.empty=new ja(ti.empty,0);function pOe(t,e){let n;return t.forEach((r,i)=>{if(r.selection&&e--==0)return n=i,!1}),t.slice(n)}class dl{constructor(e,n,r,i){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=i}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new dl(n.getMap().invert(),n,this.selection)}}}class fu{constructor(e,n,r,i,o){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=i,this.prevComposition=o}}const fOe=20;function gOe(t,e,n,r){let i=n.getMeta(Kd),o;if(i)return i.historyState;n.getMeta(vOe)&&(t=new fu(t.done,t.undone,null,0,-1));let s=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(s&&s.getMeta(Kd))return s.getMeta(Kd).redo?new fu(t.done.addTransform(n,void 0,r,YS(e)),t.undone,g6(n.mapping.maps),t.prevTime,t.prevComposition):new fu(t.done,t.undone.addTransform(n,void 0,r,YS(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(s&&s.getMeta("addToHistory")===!1)){let a=n.getMeta("composition"),l=t.prevTime==0||!s&&t.prevComposition!=a&&(t.prevTime<(n.time||0)-r.newGroupDelay||!mOe(n,t.prevRanges)),c=s?HP(t.prevRanges,n.mapping):g6(n.mapping.maps);return new fu(t.done.addTransform(n,l?e.selection.getBookmark():void 0,r,YS(e)),ja.empty,c,n.time,a??t.prevComposition)}else return(o=n.getMeta("rebased"))?new fu(t.done.rebased(n,o),t.undone.rebased(n,o),HP(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new fu(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),HP(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function mOe(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,i)=>{for(let o=0;o<e.length;o+=2)r<=e[o+1]&&i>=e[o]&&(n=!0)}),n}function g6(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((r,i,o,s)=>e.push(o,s));return e}function HP(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let i=e.map(t[r],1),o=e.map(t[r+1],-1);i<=o&&n.push(i,o)}return n}function yOe(t,e,n){let r=YS(e),i=Kd.get(e).spec.config,o=(n?t.undone:t.done).popEvent(e,r);if(!o)return null;let s=o.selection.resolve(o.transform.doc),a=(n?t.done:t.undone).addTransform(o.transform,e.selection.getBookmark(),i,r),l=new fu(n?a:o.remaining,n?o.remaining:a,null,0,-1);return o.transform.setSelection(s).setMeta(Kd,{redo:n,historyState:l})}let WP=!1,m6=null;function YS(t){let e=t.plugins;if(m6!=e){WP=!1,m6=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){WP=!0;break}}return WP}const Kd=new As("history"),vOe=new As("closeHistory");function xOe(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new _i({key:Kd,state:{init(){return new fu(ja.empty,ja.empty,null,0,-1)},apply(e,n,r){return gOe(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,i=r=="historyUndo"?uZ:r=="historyRedo"?dZ:null;return i?(n.preventDefault(),i(e.state,e.dispatch)):!1}}}})}function cZ(t,e){return(n,r)=>{let i=Kd.getState(n);if(!i||(t?i.undone:i.done).eventCount==0)return!1;if(r){let o=yOe(i,n,t);o&&r(e?o.scrollIntoView():o)}return!0}}const uZ=cZ(!1,!0),dZ=cZ(!0,!0),SOe=wi.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>uZ(t,e),redo:()=>({state:t,dispatch:e})=>dZ(t,e)}},addProseMirrorPlugins(){return[xOe(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),bOe=Ya.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",ri(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!bbe(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$from:r,$to:i}=n,o=t();return r.parentOffset===0?o.insertContentAt({from:Math.max(r.pos-1,0),to:i.pos},{type:this.name}):USe(n)?o.insertContentAt(i.pos,{type:this.name}):o.insertContent({type:this.name}),o.command(({tr:s,dispatch:a})=>{var l;if(a){const{$to:c}=s.selection,d=c.end();if(c.nodeAfter)c.nodeAfter.isTextblock?s.setSelection(wt.create(s.doc,c.pos+1)):c.nodeAfter.isBlock?s.setSelection(ot.create(s.doc,c.pos)):s.setSelection(wt.create(s.doc,c.pos));else{const u=(l=c.parent.type.contentMatch.defaultType)===null||l===void 0?void 0:l.create();u&&(s.insert(d,u),s.setSelection(wt.create(s.doc,d+1)))}s.scrollIntoView()}return!0}).run()}}},addInputRules(){return[Sbe({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),wOe=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,kOe=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,IOe=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,_Oe=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,COe=El.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",ri(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[ah({find:wOe,type:this.type}),ah({find:IOe,type:this.type})]},addPasteRules(){return[ju({find:kOe,type:this.type}),ju({find:_Oe,type:this.type})]}}),POe=Ya.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",ri(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),TOe="listItem",y6="textStyle",v6=/^(\d+)\.\s$/,EOe=Ya.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",ri(this.options.HTMLAttributes,n),0]:["ol",ri(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(TOe,this.editor.getAttributes(y6)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=fy({find:v6,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=fy({find:v6,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(y6)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),AOe=Ya.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",ri(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),MOe=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,OOe=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,DOe=El.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",ri(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[ah({find:MOe,type:this.type})]},addPasteRules(){return[ju({find:OOe,type:this.type})]}}),jOe=Ya.create({name:"text",group:"inline"}),ROe=wi.create({name:"starterKit",addExtensions(){const t=[];return this.options.bold!==!1&&t.push(VMe.configure(this.options.bold)),this.options.blockquote!==!1&&t.push(FMe.configure(this.options.blockquote)),this.options.bulletList!==!1&&t.push(qMe.configure(this.options.bulletList)),this.options.code!==!1&&t.push(XX.configure(this.options.code)),this.options.codeBlock!==!1&&t.push(XMe.configure(this.options.codeBlock)),this.options.document!==!1&&t.push(ZMe.configure(this.options.document)),this.options.dropcursor!==!1&&t.push(eOe.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&t.push(lOe.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&t.push(cOe.configure(this.options.hardBreak)),this.options.heading!==!1&&t.push(uOe.configure(this.options.heading)),this.options.history!==!1&&t.push(SOe.configure(this.options.history)),this.options.horizontalRule!==!1&&t.push(bOe.configure(this.options.horizontalRule)),this.options.italic!==!1&&t.push(COe.configure(this.options.italic)),this.options.listItem!==!1&&t.push(POe.configure(this.options.listItem)),this.options.orderedList!==!1&&t.push(EOe.configure(this.options.orderedList)),this.options.paragraph!==!1&&t.push(AOe.configure(this.options.paragraph)),this.options.strike!==!1&&t.push(DOe.configure(this.options.strike)),this.options.text!==!1&&t.push(jOe.configure(this.options.text)),t}}),hZ={tldraw_draw:{normal:{normal:{family:"tldraw_draw",src:{url:"tldraw_draw",format:"woff2"},weight:"normal"},bold:{family:"tldraw_draw",src:{url:"tldraw_draw_bold",format:"woff2"},weight:"bold"}},italic:{normal:{family:"tldraw_draw",src:{url:"tldraw_draw_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_draw",src:{url:"tldraw_draw_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_sans:{normal:{normal:{family:"tldraw_sans",src:{url:"tldraw_sans",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_sans",src:{url:"tldraw_sans_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_sans",src:{url:"tldraw_sans_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_sans",src:{url:"tldraw_sans_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_serif:{normal:{normal:{family:"tldraw_serif",src:{url:"tldraw_serif",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_serif",src:{url:"tldraw_serif_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_serif",src:{url:"tldraw_serif_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_serif",src:{url:"tldraw_serif_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}},tldraw_mono:{normal:{normal:{family:"tldraw_mono",src:{url:"tldraw_mono",format:"woff2"},weight:"normal",style:"normal"},bold:{family:"tldraw_mono",src:{url:"tldraw_mono_bold",format:"woff2"},weight:"bold",style:"normal"}},italic:{normal:{family:"tldraw_mono",src:{url:"tldraw_mono_italic",format:"woff2"},weight:"normal",style:"italic"},bold:{family:"tldraw_mono",src:{url:"tldraw_mono_italic_bold",format:"woff2"},weight:"bold",style:"italic"}}}},$Oe=ar(hZ).flatMap(t=>ar(t).flatMap(e=>Object.values(e))),NOe=wi.create({name:"textDirection",addGlobalAttributes(){return[{types:["heading","paragraph"],attributes:{dir:{default:"auto",parseHTML:t=>{const e=t.getAttribute("dir");return e&&["ltr","rtl","auto"].includes(e)?e:"auto"},renderHTML:t=>({dir:t.dir})}}}]}}),LOe=wi.create({name:"keyboardShiftEnterHandler",addKeyboardShortcuts(){return{"Shift-Enter":({editor:t})=>t.commands.enter()}}});XX.config.excludes=void 0;ZX.config.priority=1100;const Vf=[ROe.configure({blockquote:!1,codeBlock:!1,horizontalRule:!1}),LMe.configure({openOnClick:!1,autolink:!0}),ZX,LOe,NOe],zOe=new ki;function lO(t,e){return zOe.get(e,()=>{const n=t.getTextOptions().tipTapConfig?.extensions??Vf;return jSe(e,n).replaceAll('<p dir="auto"></p>',"<p><br /></p>")??""})}function Ty(t,e){return`<div class="tl-rich-text">${lO(t,e)}</div>`}const FOe=new ki;function lr(t){return t.content.length===1&&!t.content[0].content}function Lu(t,e){return lr(e)?"":FOe.get(e,()=>{const n=t.getTextOptions().tipTapConfig?.extensions??Vf;return $Se(e,n,{blockSeparator:`
`})})}function BOe(t,e){const n=t.getTextOptions().tipTapConfig?.extensions??Vf;return RSe(e,n)}function cO(t,e,n){for(const s of t.marks)s.type.name==="bold"&&e.weight!=="bold"&&(e={...e,weight:"bold"}),s.type.name==="italic"&&e.style!=="italic"&&(e={...e,style:"italic"}),s.type.name==="code"&&e.family!=="tldraw_mono"&&(e={...e,family:"tldraw_mono"});const r=wr(hZ,e.family);if(!r)return e;const i=wr(r,e.style);if(!i)return e;const o=wr(i,e.weight);return o&&n(o),e}const UOe="  ";class Ey{static fixNewLines=/\r?\n|\r/g;static normalizeText(e){return e.replace(Ey.fixNewLines,`
`)}static normalizeTextForDom(e){return e.replace(Ey.fixNewLines,`
`).split(`
`).map(n=>n||" ").join(`
`)}}const HOe=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function pZ(t){return HOe.test(t)}function WOe(t){return t.replace(/\t/g,UOe)}function VOe(t){const e=t.split(`
`);for(;e[0]&&e[0].trim().length===0;)e.shift();let n=1/0;for(const r of e)if(r.trim().length>0){const i=r.length-r.trimStart().length;n=Math.min(n,i)}return e.map(r=>r.slice(n)).join(`
`)}const fZ={"&amp;":"&","&quot;":'"',"&apos;":"'","&#27;":"'","&#34;":'"',"&#38;":"&","&#39;":"'","&#8211;":"–","&#8212;":"—","&#8216;":"‘","&#8217;":"’","&#8220;":"“","&#8221;":"”","&#8230;":"…"},KOe=new RegExp(Object.keys(fZ).join("|"),"g");function gZ(t){return t.replace(KOe,e=>fZ[e])}function qOe(t){return t.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function GOe(t){return qOe(VOe(WOe(t)))}const YOe=5e3,XOe=10*1024*1024;function ZOe(t,e){t.registerExternalAssetHandler("file",async n=>JOe(t,n,e)),t.registerExternalAssetHandler("url",async n=>eDe(t,n,e)),t.registerExternalContentHandler("svg-text",async n=>tDe(t,n)),t.registerExternalContentHandler("embed",n=>nDe(t,n)),t.registerExternalContentHandler("files",async n=>rDe(t,n,e)),t.registerExternalContentHandler("file-replace",async n=>QOe(t,n,e)),t.registerExternalContentHandler("text",async n=>iDe(t,n)),t.registerExternalContentHandler("url",async n=>oDe(t,n,e)),t.registerExternalContentHandler("tldraw",async n=>sDe(t,n)),t.registerExternalContentHandler("excalidraw",async n=>aDe(t,n))}async function JOe(t,{file:e,assetId:n},r){uO(e,r)||Ge(!1,"File checks failed");const o=await xZ(e,r,n),s=await t.uploadAsset(o,e);return o.props.src=s.src,s.meta&&(o.meta={...o.meta,...s.meta}),qu.create(o)}async function QOe(t,{file:e,shapeId:n,isImage:r},i){uO(e,i)||Ge(!1,"File checks failed");const s=t.getShape(n);s||Ge(!1,"Shape not found");const a=r5(await e.arrayBuffer()),l=qu.createId(a);t.createTemporaryAssetPreview(l,e);const c=await mZ(e,l,r,!r);if(t.createAssets([c]),s.type==="image"){const u=s,p=u.props.crop;let f=c.props.w,y=c.props.h,v=u.x,x=u.y,b=p;if(p){const w=BEe(u,c.props.w,c.props.h);b=w.crop,f=w.w,y=w.h,v=w.x,x=w.y}t.updateShapes([{id:u.id,type:u.type,props:{assetId:l,crop:b,w:f,h:y},x:v,y:x}])}else s.type==="video"&&t.updateShapes([{id:s.id,type:s.type,props:{assetId:l,w:c.props.w,h:c.props.h}}]);const d=await t.getAssetForExternalContent({type:"file",file:e,assetId:l});return t.updateAssets([{...d,id:l}]),d}async function eDe(t,{url:e},{toasts:n,msg:r}){let i;try{const s=await(await gc(e,{method:"GET",mode:"no-cors"})).text(),a=new DOMParser().parseFromString(s,"text/html");i={image:a.head.querySelector('meta[property="og:image"]')?.getAttribute("content")??"",favicon:a.head.querySelector('link[rel="apple-touch-icon"]')?.getAttribute("href")??a.head.querySelector('link[rel="icon"]')?.getAttribute("href")??"",title:a.head.querySelector('meta[property="og:title"]')?.getAttribute("content")??e,description:a.head.querySelector('meta[property="og:description"]')?.getAttribute("content")??""},i.image.startsWith("http")||(i.image=new URL(i.image,e).href),i.favicon.startsWith("http")||(i.favicon=new URL(i.favicon,e).href)}catch(o){console.error(o),n.addToast({title:r("assets.url.failed"),severity:"error"}),i={image:"",favicon:"",title:"",description:""}}return{id:qu.createId(u2(e)),typeName:"asset",type:"bookmark",props:{src:e,description:i.description,image:i.image,favicon:i.favicon,title:i.title},meta:{}}}async function tDe(t,{point:e,text:n}){const r=e??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),i=new DOMParser().parseFromString(n,"image/svg+xml").querySelector("svg");if(!i)throw new Error("No <svg/> element present");let o=parseFloat(i.getAttribute("width")||"0"),s=parseFloat(i.getAttribute("height")||"0");if(!(o&&s)){document.body.appendChild(i);const l=i.getBoundingClientRect();document.body.removeChild(i),o=l.width,s=l.height}const a=await t.getAssetForExternalContent({type:"file",file:new File([n],"asset.svg",{type:"image/svg+xml"})});if(!a)throw Error("Could not create an asset");yZ(t,[a],r)}function nDe(t,{point:e,url:n,embed:r}){const i=e??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),{width:o,height:s}=r,a=sn(),l=Ps(new T(i.x-(o||450)/2,i.y-(s||450)/2),t),c={id:a,type:"embed",x:l.x,y:l.y,props:{w:o,h:s,url:n}};t.canCreateShape(c)&&t.createShape(c).select(a)}async function rDe(t,{point:e,files:n},r){const{acceptedImageMimeTypes:i=Pf,toasts:o,msg:s}=r;if(n.length>t.options.maxFilesAtOnce){o.addToast({title:s("assets.files.amount-too-many"),severity:"error"});return}const a=e??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),l=new T(a.x,a.y),c=[],d=[];for(const u of n){if(!uO(u,r))continue;const f=await xZ(u,r);i.includes(u.type)&&t.createTemporaryAssetPreview(f.id,u),c.push(f),d.push({asset:f,file:u})}Promise.allSettled(d.map(async u=>{try{const p=await t.getAssetForExternalContent({type:"file",file:u.file});if(!p)throw Error("Could not create an asset");t.updateAssets([{...p,id:u.asset.id}])}catch(p){o.addToast({title:s("assets.files.upload-failed"),severity:"error"}),console.error(p),t.deleteAssets([u.asset.id]);return}})),yZ(t,c,l)}async function iDe(t,{point:e,text:n,html:r}){const i=e??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),o=t.getShapeUtil("text").getDefaultProps(),s=GOe(n),a=r?BOe(t,r):dn(s);let l,c,d,u="middle";const p=r??s.replace(/\n/g,"<br>"),f=r?a.content.length>1:s.split(`
`).length>1,y=pZ(s);f&&(u=f?y?"end":"start":"middle");const v=t.textMeasure.measureHtml(p,{...Vi,fontFamily:bc[o.font],fontSize:Sc[o.size],maxWidth:null}),x=Math.min(f?t.getViewportPageBounds().width*.9:920,Math.max(200,t.getViewportPageBounds().width*.9));if(v.w>x){const _=t.textMeasure.measureHtml(p,{...Vi,fontFamily:bc[o.font],fontSize:Sc[o.size],maxWidth:x});l=_.w,c=_.h,d=!1,u=y?"end":"start"}else l=Math.max(v.w,10),c=Math.max(v.h,10),d=!0;i.y-c/2<t.getViewportPageBounds().minY+40&&(i.y=t.getViewportPageBounds().minY+40+c/2);const b=Ps(new T(i.x-l/2,i.y-c/2),t),w=sn();t.createShapes([{id:w,type:"text",x:b.x,y:b.y,props:{richText:a,textAlign:u,autoSize:d,w:l}}])}async function oDe(t,{point:e,url:n},{toasts:r,msg:i}){const s=t.getShapeUtil("embed")?.getEmbedDefinition(n);if(s&&s.definition.embedOnPaste!==!1)return t.putExternalContent({type:"embed",url:s.url,point:e,embed:s.definition});const a=e??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),l=qu.createId(u2(n)),c=lDe(t,n,a);let d=t.getAsset(l),u=!1;if(!d){u=!0;try{const p=await t.getAssetForExternalContent({type:"url",url:n});if(!p)throw Error("Could not create an asset");d=p}catch{r.addToast({title:i("assets.url.failed"),severity:"error"});return}}t.run(()=>{u&&t.createAssets([d]),t.updateShapes([{id:c.id,type:c.type,props:{assetId:d.id}}])})}async function sDe(t,{point:e,content:n}){t.run(()=>{const r=t.getSelectionPageBounds();t.markHistoryStoppingPoint("paste");for(const o of n.shapes)n.rootShapeIds.includes(o.id)&&(o.isLocked=!1);t.putContentOntoCurrentPage(n,{point:e,select:!0});const i=t.getSelectionPageBounds();r&&i&&r?.collides(i)&&(t.updateInstanceState({isChangingStyle:!0}),t.timers.setTimeout(()=>{t.updateInstanceState({isChangingStyle:!1})},150))})}async function aDe(t,{point:e,content:n}){t.run(()=>{JAe(t,n,e)})}async function mZ(t,e,n,r,i){let o=t.type;t.type==="video/quicktime"&&(o="video/mp4");const s=n?await vs.getImageSize(t):await vs.getVideoSize(t),a=await vs.isAnimated(t)||r,l={id:e,type:n?"image":"video",typeName:"asset",props:{name:t.name,src:"",w:s.w,h:s.h,fileSize:t.size,mimeType:o,isAnimated:a},meta:{}};if(i&&isFinite(i)){const c={w:l.props.w,h:l.props.h},d=ZAe(c,{w:i,h:i});c!==d&&vs.isStaticImageType(t.type)&&(l.props.w=d.w,l.props.h=d.h)}return l}async function yZ(t,e,n){if(!e.length)return[];const r=T.From(n),i=[];for(let o=0;o<e.length;o++){const s=e[o];switch(s.type){case"image":{i.push({id:sn(),type:"image",x:r.x,y:r.y,opacity:1,props:{assetId:s.id,w:s.props.w,h:s.props.h}}),r.x+=s.props.w;break}case"video":i.push({id:sn(),type:"video",x:r.x,y:r.y,opacity:1,props:{assetId:s.id,w:s.props.w,h:s.props.h}}),r.x+=s.props.w}}return t.run(()=>{const o=e.filter(s=>!t.getAsset(s.id));t.store.atomic(()=>{t.canCreateShapes(i)&&(o.length&&t.createAssets(o),t.createShapes(i).select(...i.map(s=>s.id)),vZ(t,n))})}),i.map(o=>o.id)}function vZ(t,e){const n=t.getViewportPageBounds();let r=t.getSelectionPageBounds();if(r){const i=r.center.sub(e);t.updateShapes(t.getSelectedShapes().map(o=>{const s=t.getShapeParentTransform(o).decompose().rotation,a=T.Rot(i,-s);return{id:o.id,type:o.type,x:o.x-a.x,y:o.y-a.y}}))}if(r=t.getSelectionPageBounds(),r&&t.getInstanceState().isGridMode){const i=t.getDocumentSettings().gridSize,o=new T(r.minX,r.minY),s=o.clone().snapToGrid(i),a=T.Sub(o,s);t.updateShapes(t.getSelectedShapes().map(l=>{const c={x:l.x-a.x,y:l.y-a.y};return{id:l.id,type:l.type,x:c.x,y:c.y}}))}r=t.getSelectionPageBounds(),r&&!n.contains(r)&&t.zoomToSelection({animation:{duration:t.options.animationMediumMs}})}function lDe(t,e,n){const r={id:sn(),type:"bookmark",x:n.x-150,y:n.y-160,opacity:1,props:{assetId:null,url:e}};return t.run(()=>{t.createShape(r),t.getShape(r.id)&&(t.select(r.id),vZ(t,n))}),t.getShape(r.id)}function uO(t,e){const{acceptedImageMimeTypes:n=Pf,acceptedVideoMimeTypes:r=zw,maxAssetSize:i=XOe,toasts:o,msg:s}=e,a=n.includes(t.type),l=r.includes(t.type);if(!a&&!l)return o.addToast({title:s("assets.files.type-not-allowed"),severity:"error"}),!1;if(t.size>i){const c=d=>{if(d===0)return"0 bytes";const u=["bytes","KB","MB","GB","TB","PB"],p=1024,f=Math.floor(Math.log(d)/Math.log(p)),y=d/Math.pow(p,f);return`${y%1===0?y.toString():y.toFixed(1)} ${u[f]}`};return o.addToast({title:s("assets.files.size-too-big"),description:s("assets.files.maximum-size").replace("{size}",c(i)),severity:"error"}),!1}return t.type?!0:(o.addToast({title:s("assets.files.upload-failed"),severity:"error"}),console.error("No mime type"),!1)}async function xZ(t,e,n){const{acceptedImageMimeTypes:r=Pf,acceptedVideoMimeTypes:i=zw,maxImageDimension:o=YOe}=e,s=r.includes(t.type),a=i.includes(t.type),l=r5(await t.arrayBuffer());return n??=qu.createId(l),await mZ(t,n,s,a,o)}let cDe=class extends We{static id="idle";isPrecise=!1;isPreciseTimerId=null;preciseTargetId=null;onPointerMove(){this.update()}onPointerDown(e){this.parent.transition("pointing",{...e,isPrecise:this.isPrecise})}onEnter(){this.editor.setCursor({type:"cross",rotation:0}),this.update()}onCancel(){this.editor.setCurrentTool("select")}onExit(){YM(this.editor),this.isPreciseTimerId!==null&&clearTimeout(this.isPreciseTimerId)}onKeyDown(){this.update()}onKeyUp(e){if(this.update(),e.key==="Enter"){if(this.editor.getIsReadonly())return null;const n=this.editor.getOnlySelectedShape();n&&this.editor.getShapeUtil(n).canEdit(n)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(n.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:n}))}}update(){const e=this.editor.getShapeUtil("arrow"),n=x1({editor:this.editor,pointInPageSpace:this.editor.inputs.currentPagePoint,arrow:void 0,isPrecise:this.isPrecise,currentBinding:void 0,oppositeBinding:void 0});n&&n.target.id!==this.preciseTargetId?(this.isPreciseTimerId!==null&&clearTimeout(this.isPreciseTimerId),this.preciseTargetId=n.target.id,this.isPreciseTimerId=this.editor.timers.setTimeout(()=>{this.isPrecise=!0,this.update()},e.options.hoverPreciseTimeout)):!n&&this.preciseTargetId&&(this.isPrecise=!1,this.preciseTargetId=null,this.isPreciseTimerId!==null&&clearTimeout(this.isPreciseTimerId))}},uDe=class extends We{static id="pointing";shape;isPrecise=!1;isPreciseTimerId=null;markId="";onEnter(e){if(this.markId="",this.isPrecise=!!e.isPrecise,!x1({editor:this.editor,pointInPageSpace:this.editor.inputs.currentPagePoint,arrow:void 0,isPrecise:this.isPrecise,currentBinding:void 0,oppositeBinding:void 0})&&(this.createArrowShape(),!this.shape)){this.cancel();return}this.startPreciseTimeout()}onExit(){this.shape=void 0,YM(this.editor),this.clearPreciseTimeout()}onPointerMove(){if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape){this.cancel();return}this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,creatingMarkId:this.markId||void 0,onInteractionEnd:"arrow"})}}onPointerUp(){this.cancel()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.parent.transition("idle")}createArrowShape(){const{originPagePoint:e}=this.editor.inputs,n=sn();this.markId=this.editor.markHistoryStoppingPoint(`creating_arrow:${n}`);const r=Ps(e,this.editor);this.editor.createShape({id:n,type:"arrow",x:r.x,y:r.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const i=this.editor.getShape(n);if(!i)return;const o=this.editor.getShapeHandles(i);if(!o)throw Error("expected handles for arrow");const s=this.editor.getShapeUtil("arrow"),a=this.shape,l=o.find(d=>d.id==="start"),c=s.onHandleDrag?.(i,{handle:{...l,x:0,y:0},isPrecise:!0,isCreatingShape:!0,initial:a});c&&this.editor.updateShapes([c]),this.shape=this.editor.getShape(n),this.editor.select(n)}updateArrowShapeEndHandle(){const e=this.shape;if(!e)throw Error("expected shape");const n=this.editor.getShapeHandles(e);if(!n)throw Error("expected handles for arrow");{const r=this.editor.getShapeUtil("arrow"),i=this.shape,o=n.find(a=>a.id==="start"),s=r.onHandleDrag?.(e,{handle:{...o,x:0,y:0},isPrecise:this.isPrecise,isCreatingShape:!0,initial:i});s&&this.editor.updateShapes([s])}{const r=this.editor.getShapeUtil("arrow"),i=this.shape,o=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint),s=n.find(l=>l.id==="end"),a=r.onHandleDrag?.(this.editor.getShape(e),{handle:{...s,x:o.x,y:o.y},isPrecise:this.isPrecise,isCreatingShape:!0,initial:i});a&&this.editor.updateShapes([a])}this.shape=this.editor.getShape(e.id)}startPreciseTimeout(){const e=this.editor.getShapeUtil("arrow");this.isPreciseTimerId=this.editor.timers.setTimeout(()=>{this.getIsActive()&&(this.isPrecise=!0)},e.options.pointingPreciseTimeout)}clearPreciseTimeout(){this.isPreciseTimerId!==null&&clearTimeout(this.isPreciseTimerId)}};class dDe extends We{static id="arrow";static initial="idle";static children(){return[cDe,uDe]}shapeType="arrow"}class SZ extends We{static id="drawing";info={};initialShape;shapeType=this.parent.id==="highlight"?"highlight":"draw";util=this.editor.getShapeUtil(this.shapeType);isPen=!1;isPenOrStylus=!1;segmentMode="free";didJustShiftClickToExtendPreviousShapeLine=!1;pagePointWhereCurrentSegmentChanged={};pagePointWhereNextSegmentChanged=null;lastRecordedPoint={};mergeNextPoint=!1;currentLineLength=0;markId=null;onEnter(e){this.markId=null,this.info=e,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.startShape()}onPointerMove(){const{inputs:e}=this.editor;if(this.isPen&&!e.isPen&&this.markId){this.editor.bailToMark(this.markId),this.startShape();return}this.isPenOrStylus?T.Dist(e.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=e.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape()}onKeyDown(e){if(e.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()}onKeyUp(e){if(e.key==="Shift")switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateDrawingShape()}onExit(){this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()}canClose(){return this.shapeType!=="highlight"}getIsClosed(e,n,r){if(!this.canClose())return!1;const i=Br[n],o=e[0].points[0],s=e[e.length-1],a=s.points[s.points.length-1];return o!==a&&this.currentLineLength>i*4*r&&T.DistMin(o,a,i*2*r)}startShape(){const{inputs:{originPagePoint:e,isPen:n}}=this.editor;this.markId=this.editor.markHistoryStoppingPoint("draw start");const{z:r=.5}=this.info.point;this.isPen=n,this.isPenOrStylus=n||r>0&&r<.5||r>.5&&r<1;const i=this.isPenOrStylus?r*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=e.clone(),this.initialShape){const a=this.editor.getShape(this.initialShape.id);if(a&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const l=gi(a.props.segments);if(!l)throw Error("Expected a previous segment!");const c=gi(l.points);if(!c)throw Error("Expected a previous point!");const{x:d,y:u}=this.editor.getPointInShapeSpace(a,e).toFixed(),p={type:this.segmentMode,points:[{x:c.x,y:c.y,z:+i.toFixed(2)},{x:d,y:u,z:+i.toFixed(2)}]},f=xe.applyToPoint(this.editor.getShapePageTransform(a.id),c);this.pagePointWhereCurrentSegmentChanged=f,this.pagePointWhereNextSegmentChanged=null;const y=[...a.props.segments,p];this.currentLineLength<Br[a.props.size]*4&&(this.currentLineLength=this.getLineLength(y));const v={id:a.id,type:this.shapeType,props:{segments:y}};this.canClose()&&(v.props.isClosed=this.getIsClosed(y,a.props.size,a.props.scale)),this.editor.updateShapes([v]);return}}this.pagePointWhereCurrentSegmentChanged=e.clone();const o=sn();if(this.editor.createShape({id:o,type:this.shapeType,x:e.x,y:e.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+i.toFixed(2)}]}]}}),!this.editor.getShape(o)){this.cancel();return}this.currentLineLength=0,this.initialShape=this.editor.getShape(o)}updateDrawingShape(){const{initialShape:e}=this,{inputs:n}=this.editor;if(!e)return;const{id:r,props:{size:i,scale:o}}=e,s=this.editor.getShape(r);if(!s)return;const{segments:a}=s.props,{x:l,y:c,z:d}=this.editor.getPointInShapeSpace(s,n.currentPagePoint).toFixed(),u=this.isPenOrStylus?+(n.currentPagePoint.z*1.25).toFixed(2):.5,p={x:l,y:c,z:u};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:f}=this;if(f===null)throw Error("We should have a point where the segment changed");if(T.Dist2(f,n.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const v=gi(a);if(!v)throw Error("Expected a previous segment!");const x=gi(v.points);if(!x)throw Error("Expected a previous last point!");let b;const w=this.editor.getPointInShapeSpace(s,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(v.type==="straight"){this.currentLineLength+=T.Dist(x,w),b={type:"straight",points:[{...x},w]};const C=this.editor.getShapePageTransform(s);this.pagePointWhereCurrentSegmentChanged=xe.applyToPoint(C,x)}else b={type:"straight",points:[w,p]};const _={id:r,type:this.shapeType,props:{segments:[...a,b]}};this.canClose()&&(_.props.isClosed=this.getIsClosed(a,i,o)),this.editor.updateShapes([_])}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:f}=this;if(f===null)throw Error("We should have a point where the segment changed");if(T.Dist2(f,n.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const v=a.slice(),x=v[v.length-1],b=gi(x.points);if(!b)throw Error("No previous point!");const w={type:"free",points:[...T.PointsBetween(b,p,6).map(A=>({x:Da(A.x),y:Da(A.y),z:Da(A.z)}))]},_=[...v,w];this.currentLineLength<Br[s.props.size]*4&&(this.currentLineLength=this.getLineLength(_));const C={id:r,type:this.shapeType,props:{segments:_}};this.canClose()&&(C.props.isClosed=this.getIsClosed(_,i,o)),this.editor.updateShapes([C])}break}case"straight":{const f=a.slice(),y=f[f.length-1],{pagePointWhereCurrentSegmentChanged:v}=this,{ctrlKey:x,currentPagePoint:b}=this.editor.inputs;if(!v)throw Error("We should have a point where the segment changed");let w,_=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(_=!x,this.didJustShiftClickToExtendPreviousShapeLine=!1):_=!x;let C=this.editor.getPointInShapeSpace(s,b).toFixed().toJson(),A=!1,E;if((this.editor.user.getIsSnapMode()?!x:x)&&f.length>2){let B,L=8/this.editor.getZoomLevel();for(let j=0,F=a.length-2;j<F;j++){const z=a[j];if(!z)break;if(z.type==="free")continue;const $=z.points[0],V=gi(z.points);if(!($&&V))continue;const Y=T.NearestPointOnLineSegment($,V,C);if(T.DistMin(Y,C,L)){B=Y.toFixed().toJson(),L=T.Dist(Y,C),E=z;break}}B&&(A=!0,C=B)}if(A&&E){const B=this.editor.getShapePageTransform(s),L=E.points[0],j=gi(E.points);if(!j)throw Error("Expected a last point!");const F=xe.applyToPoint(B,L),z=xe.applyToPoint(B,j),$=xe.applyToPoint(B,C);this.editor.snaps.setIndicators([{id:Qt(),type:"points",points:[F,$,z]}])}else{if(this.editor.snaps.clearIndicators(),_){const B=T.Angle(v,b),j=pb(B,24)-B;w=T.RotWith(b,v,j)}else w=b;C=this.editor.getPointInShapeSpace(s,w).toFixed().toJson()}this.currentLineLength+=T.Dist(y.points[0],C),f[f.length-1]={...y,type:"straight",points:[y.points[0],C]};const D={id:r,type:this.shapeType,props:{segments:f}};this.canClose()&&(D.props.isClosed=this.getIsClosed(a,i,o)),this.editor.updateShapes([D]);break}case"free":{const f=a.slice(),y=f[f.length-1],v=[...y.points];if(v.length&&this.mergeNextPoint){const{z:b}=v[v.length-1];v[v.length-1]={x:p.x,y:p.y,z:b?Math.max(b,p.z):p.z}}else this.currentLineLength+=T.Dist(v[v.length-1],p),v.push(p);f[f.length-1]={...y,points:v},this.currentLineLength<Br[s.props.size]*4&&(this.currentLineLength=this.getLineLength(f));const x={id:r,type:this.shapeType,props:{segments:f}};if(this.canClose()&&(x.props.isClosed=this.getIsClosed(f,i,o)),this.editor.updateShapes([x]),v.length>this.util.options.maxPointsPerShape){this.editor.updateShapes([{id:r,type:this.shapeType,props:{isComplete:!0}}]);const b=sn(),w=this.editor.getShape(r).props;if(!this.editor.canCreateShapes([b]))return this.cancel();this.editor.createShape({id:b,type:this.shapeType,x:Da(n.currentPagePoint.x),y:Da(n.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:w.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(d*1.25).toFixed():.5}]}]}});const _=this.editor.getShape(b);if(!_)return this.cancel();this.initialShape=fn(_),this.mergeNextPoint=!1,this.lastRecordedPoint=n.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(e){let n=0;for(const r of e)for(let i=0;i<r.points.length-1;i++){const o=r.points[i],s=r.points[i+1];n+=T.Dist2(s,o)}return Math.sqrt(n)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())}complete(){const{initialShape:e}=this;e&&(this.editor.updateShapes([{id:e.id,type:e.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}let bZ=class extends We{static id="idle";onPointerDown(e){this.parent.transition("drawing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}};class hDe extends We{static id="draw";static initial="idle";static isLockable=!1;static useCoalescedEvents=!0;static children(){return[bZ,SZ]}shapeType="draw";onExit(){const e=this.children.drawing;e.initialShape=void 0}}class pDe extends hme{static id="frame";static initial="idle";shapeType="frame";onCreate(e){if(!e)return;const n=this.editor.getShapePageBounds(e),r=[],i=this.editor.getShapeAncestors(e).map(o=>o.id);this.editor.getSortedChildIdsForParent(e.parentId).map(o=>{const s=this.editor.getShape(o);if(!s||s.id===e.id||s.isLocked)return;const a=this.editor.getShapePageBounds(s);a&&n.contains(a)&&fDe(s,i,e)&&r.push(s.id)}),this.editor.reparentShapes(r,e.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")}}function fDe(t,e,n){return e.includes(t.id)?!1:t.parentId===n.parentId}let gDe=class extends We{static id="idle";onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onKeyUp(e){if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const n=this.editor.getOnlySelectedShape();n&&this.editor.getShapeUtil(n).canEdit(n)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(n.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:n}))}}onCancel(){this.editor.setCurrentTool("select")}},mDe=class extends We{static id="pointing";onPointerUp(){this.complete()}onPointerMove(e){if(this.editor.inputs.isDragging){const{originPagePoint:n}=this.editor.inputs,r=sn(),i=this.editor.markHistoryStoppingPoint(`creating_geo:${r}`),o=Ps(n,this.editor);if(this.editor.createShapes([{id:r,type:"geo",x:o.x,y:o.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(vl),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(r),!this.editor.getShape(r)){this.cancel();return}this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:i,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint:e}=this.editor.inputs,n=sn();this.editor.markHistoryStoppingPoint(`creating_geo:${n}`);const r=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,i=this.editor.getStyleForNextShape(vl),o=i==="star"?{w:200,h:190}:i==="cloud"?{w:300,h:180}:{w:200,h:200};this.editor.createShapes([{id:n,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(vl),scale:r,...o}}]);const s=this.editor.getShape(n);if(!s){this.cancel();return}const{w:a,h:l}=s.props,c=new T(a/2,l/2).mul(r),d=this.editor.getShapeParentTransform(s);d&&c.rot(-d.rotation());const u=Ps(new T(s.x-c.x,s.y-c.y),this.editor);this.editor.select(n),this.editor.updateShape({id:s.id,type:"geo",x:u.x,y:u.y,props:{geo:this.editor.getStyleForNextShape(vl),w:a*r,h:l*r}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}};class yDe extends We{static id="geo";static initial="idle";static children(){return[gDe,mDe]}shapeType="geo"}class vDe extends We{static id="highlight";static initial="idle";static useCoalescedEvents=!0;static children(){return[bZ,SZ]}static isLockable=!1;shapeType="highlight";onExit(){const e=this.children.drawing;e.initialShape=void 0}}let xDe=class extends We{static id="idle";shapeId="";onEnter(e){this.shapeId=e.shapeId,this.editor.setCursor({type:"cross",rotation:0})}onPointerDown(){this.parent.transition("pointing",{shapeId:this.shapeId})}onCancel(){this.editor.setCurrentTool("select")}};const x6=2;let SDe=class extends We{static id="pointing";shape={};markId;onEnter(e){const{inputs:n}=this.editor,{currentPagePoint:r}=n;this.markId=void 0;const i=e.shapeId&&this.editor.getShape(e.shapeId);if(i&&n.shiftKey){this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${i.id}`),this.shape=i;const o=this.editor.getShapeHandles(this.shape);if(!o)return;const s=o.filter(f=>f.type==="vertex").sort(Yr),a=s[s.length-1],l=s[s.length-2],c=xe.applyToPoint(this.editor.getShapeParentTransform(this.shape),new T(this.shape.x,this.shape.y)),d=T.Sub(r,c).addXY(.1,.1),u=Ps(d,this.editor),p=fn(this.shape.props.points);if(T.DistMin(a,l,x6)||T.DistMin(u,a,x6))p[a.id]={id:a.id,index:a.index,x:u.x,y:u.y};else{const f=na(a.index);p[f]={id:f,index:f,x:u.x,y:u.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:p}}])}else{const o=sn();this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${o}`);const s=Ps(r,this.editor);if(this.editor.createShapes([{id:o,type:"line",x:s.x,y:s.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),!this.editor.getShape(o)){this.cancel();return}this.editor.select(o),this.shape=this.editor.getShape(o)}}onPointerMove(){if(this.shape&&this.editor.inputs.isDragging){const e=this.editor.getShapeHandles(this.shape);if(!e)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const n=gi(e);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,creatingMarkId:this.markId,handle:{...n,x:n.x-.1,y:n.y-.1},onInteractionEnd:"line"})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}};class bDe extends We{static id="line";static initial="idle";static children(){return[xDe,SDe]}shapeType="line"}let wDe=class extends We{static id="idle";onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}};const kDe=0,pn=200,b1=new T(pn/2,pn/2),wZ=10,IDe=t=>[[["a1"],new T(pn*.5,pn*-.5-t.options.adjacentShapeMargin)],[["a2"],new T(pn*1.5+t.options.adjacentShapeMargin,pn*.5)],[["a3"],new T(pn*.5,pn*1.5+t.options.adjacentShapeMargin)],[["a4"],new T(pn*-.5-t.options.adjacentShapeMargin,pn*.5)]];function _De(t,e){if(e===1)return IDe(t);const n=pn*e,r=t.options.adjacentShapeMargin*e;return[[["a1"],new T(n*.5,n*-.5-r)],[["a2"],new T(n*1.5+r,n*.5)],[["a3"],new T(n*.5,n*1.5+r)],[["a4"],new T(n*-.5-r,n*.5)]]}function kZ(t,e,n,r,i,o){return Object.fromEntries(_De(t,o).map(([s,a],l)=>{const c=a.clone();return l===0&&i?c.y-=i:l===2&&r&&(c.y+=r),[s,c.rot(n).add(e)]}))}function IZ(t,e,n,r){const i=new Set(t.getSelectedShapeIds()),o=(pn+t.options.adjacentShapeMargin+r)**2,s=new Map,a=[];for(const d of t.getCurrentPageShapes()){if(!t.isShapeOfType(d,"note")||n!==d.props.scale||i.has(d.id))continue;const u=t.getShapePageTransform(d.id);e===u.rotation()&&(s.set(d,t.getShapePageBounds(d).center),a.push(...Object.values(kZ(t,u.point(),e,d.props.growY,r,n))))}const l=a.length;let c;for(const[d,u]of s)for(let p=0;p<l;p++)c=a[p],c&&(T.Dist2(u,c)>o||t.isPointInShape(d,c)&&(a[p]=void 0));return ut(a)}function _Z(t,e,n,r,i=!1){let o;const s=t.getCurrentPageShapesSorted(),a=(pn+t.options.adjacentShapeMargin**2)**e.props.scale;for(let l=s.length-1;l>=0;l--){const c=s[l];if(c.type==="note"&&c.id!==e.id){const d=t.getShapePageBounds(c);if(d&&T.Dist2(d.center,n)<a&&t.isPointInShape(c,n)){o=c;break}}}if(t.complete(),!o||i){t.markHistoryStoppingPoint("creating note shape");const l=sn();t.createShape({id:l,type:"note",x:n.x,y:n.y,rotation:r,opacity:e.opacity,props:{...e.props,richText:dn(""),growY:0,fontSizeAdjustment:0,url:""}});const c=t.getShape(l);if(!c)return;const d=t.getPointInParentSpace(c,T.Sub(n,T.Rot(b1.clone().mul(c.props.scale),r)));t.updateShape({id:l,type:"note",x:d.x,y:d.y}),o=t.getShape(l)}return t.zoomToSelectionIfOffscreen(16,{animation:{duration:t.options.animationMediumMs},inset:0}),o}let CDe=class extends We{static id="pointing";dragged=!1;info={};markId="";shape={};onEnter(){const{editor:e}=this,n=sn();this.markId=e.markHistoryStoppingPoint(`creating_note:${n}`);const r=this.editor.inputs.originPagePoint.clone(),i=PDe(this.editor,r,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);i&&r.sub(i);const o=TDe(this.editor,n,r);o?this.shape=o:this.cancel()}onPointerMove(e){this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.translating",{...e,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,creatingMarkId:this.markId,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}onPointerUp(){this.complete()}onInterrupt(){this.cancel()}onComplete(){this.complete()}onCancel(){this.cancel()}complete(){this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape}))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}};function PDe(t,e,n){let r=wZ/t.getZoomLevel(),i;for(const o of IZ(t,0,n,0)){const s=T.Sub(e,o),a=s.len();a<r&&(r=a,i=s)}return i}function TDe(t,e,n){t.createShape({id:e,type:"note",x:n.x,y:n.y,props:{scale:t.user.getIsDynamicResizeMode()?1/t.getZoomLevel():1}});const r=t.getShape(e);if(!r)return;t.select(e);const i=t.getShapeGeometry(r).bounds,o=Ps(new T(r.x-i.width/2,r.y-i.height/2),t);return t.updateShapes([{id:e,type:"note",x:o.x,y:o.y}]),t.getShape(e)}class EDe extends We{static id="note";static initial="idle";static children(){return[wDe,CDe]}shapeType="note"}function ADe(t){const e=t.getShapeAtPoint(t.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:t.options.hitTestMargin/t.getZoomLevel(),renderingOnly:!0});if(!e)return t.setHoveredShape(null);let n;const r=t.getOutermostSelectableShape(e);return r===e||r.id===t.getFocusedGroupId()||t.getSelectedShapeIds().includes(r.id)?n=e:n=r,t.setHoveredShape(n.id)}const uc=e5(ADe,32);let MDe=class extends We{static id="idle";onPointerMove(e){switch(e.target){case"shape":case"canvas":uc(this.editor)}}onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onExit(){uc.cancel()}onKeyDown(e){if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const n=this.editor.getOnlySelectedShape();n&&this.editor.getShapeUtil(n).canEdit(n)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(n.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:n}))}}onCancel(){this.editor.setCurrentTool("select")}},ODe=class extends We{static id="pointing";shape;markId="";enterTime=0;onEnter(){this.enterTime=Date.now()}onExit(){this.editor.setHintingShapes([])}onPointerMove(e){if(Date.now()-this.enterTime<150)return;const{editor:n}=this,{isPointing:r}=n.inputs;if(!r)return;const{originPagePoint:i,currentPagePoint:o}=n.inputs,s=Math.abs(i.x-o.x),l=Math.sqrt(n.getInstanceState().isCoarsePointer?n.options.coarseDragDistanceSquared:n.options.dragDistanceSquared)*6/n.getZoomLevel();if(s>l){const c=sn();this.markId=n.markHistoryStoppingPoint(`creating_text:${c}`);const d=this.createTextShape(c,i,!1,s);if(!d){this.cancel();return}this.shape=n.getShape(d),n.select(c);const u=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1;n.setCurrentTool("select.resizing",{...e,target:"selection",handle:"right",isCreating:!0,creatingMarkId:this.markId,creationCursorOffset:{x:s*u,y:1},onInteractionEnd:"text",onCreate:()=>{n.setEditingShape(d.id)}})}}onPointerUp(){this.complete()}onComplete(){this.cancel()}onCancel(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.editor.markHistoryStoppingPoint("creating text shape");const e=sn(),{originPagePoint:n}=this.editor.inputs;this.createTextShape(e,n,!0,20)&&(this.editor.select(e),this.editor.setEditingShape(e))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(e,n,r,i){this.editor.createShape({id:e,type:"text",x:n.x,y:n.y,props:{richText:dn(""),autoSize:r,w:i,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const o=this.editor.getShape(e);if(!o){this.cancel();return}const s=this.editor.getShapePageBounds(o),a=new T;if(r)switch(o.props.textAlign){case"start":{a.x=0;break}case"middle":{a.x=-s.width/2;break}case"end":{a.x=-s.width;break}}else a.x=0;if(a.y=-s.height/2,co(o.parentId)){const d=this.editor.getShapeParentTransform(o);a.rot(-d.rotation())}const l=o.x+a.x,c=o.y+a.y;if(this.editor.getInstanceState().isGridMode){const d=new T(l,c),u=Ps(d,this.editor),p=T.Sub(d,u);this.editor.updateShape({...o,x:l-p.x,y:c-p.y})}else this.editor.updateShape({...o,x:l,y:c});return o}};class DDe extends We{static id="text";static initial="idle";static children(){return[MDe,ODe]}shapeType="text"}const jDe=[DDe,hDe,yDe,EDe,bDe,pDe,dDe,vDe],RDe=rt.forwardRef(function({shapeId:e,isEditing:n,richText:r,handleFocus:i,handleChange:o,handleBlur:s,handleKeyDown:a,handleDoubleClick:l,hasCustomTabBehavior:c,handlePaste:d},u){const p=ne(),f=Ih("tip-tap-editor"),y=p.getTextOptions().tipTapConfig,v=I.useRef(r),x=I.useRef(null),b=I.useRef(null);I.useLayoutEffect(()=>{x.current?v.current!==r&&x.current.commands.setContent(r):v.current=r},[r]);const w=I.useRef({selectAll:!1,caretPosition:null});I.useLayoutEffect(()=>{function B(j){j.shapeId===p.getEditingShapeId()&&(w.current.selectAll=!0)}function L(j){j.shapeId===p.getEditingShapeId()&&(w.current.caretPosition=j.point)}return p.on("select-all-text",B),p.on("place-caret",L),()=>{p.off("select-all-text",B),p.off("place-caret",L)}},[p,n]);const _=pl(o),C=pl(a),A=pl(i),E=pl(s),O=pl(l),D=pl(d);return I.useLayoutEffect(()=>{if(!n||!y||!b.current)return;const{editorProps:B,...L}=y,j=new xbe({element:b.current,autofocus:!0,editable:n,onUpdate:z=>{const $=z.editor.state.doc.toJSON();v.current=$,_({richText:$})},onFocus:A,onBlur:E,onCreate:z=>{if(p.getEditingShapeId()!==e)return;const $=z.editor;p.setRichTextEditor($);const{selectAll:V,caretPosition:Y}=w.current;if(V)$.chain().focus().selectAll().run();else if(Y){const re=$.view.posAtCoords({left:Y.x,top:Y.y})?.pos;re?$.chain().focus().setTextSelection(re).run():$.chain().focus().selectAll().run()}},editorProps:{handleKeyDown:(z,$)=>{!c&&$.key==="Tab"&&$De(p,z,$),C($)},handlePaste:(z,$)=>{if(D($),$.defaultPrevented)return!0},handleDoubleClick:(z,$,V)=>O(V),...B},coreExtensionOptions:{clipboardTextSerializer:{blockSeparator:`
`}},...L,content:v.current}),F=p.timers.setTimeout(()=>{w.current.caretPosition||w.current.selectAll?j.commands.focus():j.commands.focus("end"),w.current.selectAll=!1,w.current.caretPosition=null},100);return x.current=j,()=>{x.current=null,clearTimeout(F),j.destroy()}},[n,y,A,E,O,_,D,C,p,e,c]),!n||!y?null:g.jsx("div",{id:f,ref:u,tabIndex:-1,"data-testid":"rich-text-area",className:"tl-rich-text tl-text tl-text-input",onContextMenu:n?B=>B.stopPropagation():void 0,onPointerDownCapture:B=>B.stopPropagation(),onTouchEnd:B=>B.stopPropagation(),onDragStart:dt,children:g.jsx("div",{className:"tl-rich-text",ref:b})})});function $De(t,e,n){n.preventDefault();const r=t.getRichTextEditor();if(r?.isActive("bulletList")||r?.isActive("orderedList"))return;const{state:i,dispatch:o}=e,{$from:s,$to:a}=i.selection,l=n.shiftKey;let c=i.tr,d=a.end();for(;d>=s.start();){const p=i.doc.resolve(d).blockRange();if(!p)break;const f=p.start,y=p.end,v=i.doc.textBetween(f,y,`
`);let x=!1;i.doc.nodesBetween(f,y,b=>{if(b.type.name==="bulletList"||b.type.name==="orderedList")return x=!0,!1}),x||(l?v.startsWith("	")&&(c=c.delete(f+1,f+2)):c=c.insertText("	",f+1)),d=f-1}const u=i.selection.map(c.doc,c.mapping);c.setSelection(u),c.docChanged&&o(c)}function CZ(t){return t==="start-legacy"||t==="middle-legacy"||t==="end-legacy"}function NDe(t,e,n){const r=PZ(t),i=r.isEditing,o=ne(),s=I.useRef(null),a=(n||"").trim().length===0;I.useEffect(()=>{function d(u){u.shapeId===t&&s.current?.select?.()}return o.on("select-all-text",d),()=>{o.off("select-all-text",d)}},[o,t,i]),I.useEffect(()=>{i&&(document.activeElement!==s.current&&s.current?.focus(),o.getInstanceState().isCoarsePointer&&s.current?.select(),Jt.isSafari&&(s.current?.blur(),s.current?.focus()))},[o,i]);const l=I.useCallback(d=>{if(o.getEditingShapeId()===t)switch(d.key){case"Enter":{(d.ctrlKey||d.metaKey)&&o.complete();break}}},[o,t]),c=I.useCallback(({plaintext:d})=>{if(o.getEditingShapeId()!==t)return;const u=Ey.normalizeText(d||"");o.updateShape({id:t,type:e,props:{text:u}})},[o,t,e]);return{rInput:s,handleKeyDown:l,handleChange:c,isEmpty:a,...r}}function dO(t,e){return J("isReadyForEditing",()=>{const n=t.getEditingShapeId();return n!==null&&(n===e||t.getHoveredShapeId()===e)},[t,e])}function PZ(t){const e=ne(),n=J("isEditing",()=>e.getEditingShapeId()===t,[e]),r=dO(e,t),i=I.useCallback(s=>{e.dispatch({...Hi(e,s),type:"pointer",name:"pointer_down",target:"shape",shape:e.getShape(t)}),s.stopPropagation()},[e,t]),o=I.useCallback(s=>{if(e.getEditingShapeId()===t&&s.clipboardData){const a=s.clipboardData.getData("text/html");a&&a.includes("<div data-tldraw")&&dt(s)}},[e,t]);return{handleFocus:Xm,handleBlur:Xm,handleInputPointerDown:i,handleDoubleClick:e.markEventAsHandled,handlePaste:o,isEditing:n,isReadyForEditing:r}}function LDe(t,e,n){const r=PZ(t),i=r.isEditing,o=ne(),s=I.useRef(null),a=n&&lr(n);I.useEffect(()=>{if(!i)return;const d=s.current?.querySelector("[contenteditable]");d&&document.activeElement!==s.current&&d.focus()},[o,i]);const l=I.useCallback(d=>{o.getEditingShapeId()===t&&d.key==="Enter"&&Rn(d)&&o.complete()},[o,t]),c=I.useCallback(({richText:d})=>{o.getEditingShapeId()===t&&o.updateShape({id:t,type:e,props:{richText:d}})},[o,t,e]);return{rInput:s,handleKeyDown:l,handleChange:c,isEmpty:a,...r}}const w1=rt.memo(function({shapeId:e,type:n,richText:r,labelColor:i,font:o,fontSize:s,lineHeight:a,align:l,verticalAlign:c,wrap:d,isSelected:u,padding:p=0,onKeyDown:f,classNamePrefix:y,style:v,textWidth:x,textHeight:b,hasCustomTabBehavior:w}){const _=ne(),C=rt.useRef(!1),{rInput:A,isEmpty:E,isEditing:O,isReadyForEditing:D,...B}=LDe(e,n,r),L=I.useMemo(()=>{if(r)return lO(_,r)},[_,r]),j=J("isSelectToolActive",()=>_.getCurrentToolId()==="select",[_]);E2("isDragging",()=>{_.getInstanceState(),C.current=_.inputs.isDragging},[_]);const F=CZ(l),z=V=>{if(V.target instanceof HTMLElement&&(V.target.tagName==="A"||V.target.closest("a"))){if(dt(V),!j)return;const Y=V.target.closest("a")?.getAttribute("href")??"",re=q=>{q.name!=="pointer_up"||!Y||(C.current||window.open(Y,"_blank","noopener, noreferrer"),_.off("event",re))};_.on("event",re)}};if(!O&&E)return null;const $=y||"tl-text";return g.jsx("div",{className:`${$}-label tl-text-wrapper tl-rich-text-wrapper`,"aria-hidden":!O,"data-font":o,"data-align":l,"data-hastext":!E,"data-isediting":O,"data-textwrap":!!d,"data-isselected":u,style:{justifyContent:l==="middle"||F?"center":l,alignItems:c==="middle"?"center":c,padding:p,...v},children:g.jsxs("div",{className:`${$}-label__inner tl-text-content__wrapper`,style:{fontSize:s,lineHeight:a.toString(),minHeight:Math.floor(s*a)+"px",minWidth:Math.ceil(x||0),color:i,width:x?Math.ceil(x):void 0,height:b?Math.ceil(b):void 0},children:[g.jsx("div",{className:`${$} tl-text tl-text-content`,dir:"auto",children:r&&g.jsx("div",{className:"tl-rich-text","data-is-select-tool-active":j,dangerouslySetInnerHTML:{__html:L||""},onPointerDown:z,"data-is-ready-for-editing":D})}),(D||u)&&g.jsx(RDe,{ref:A,richText:r,isEditing:O,shapeId:e,...B,hasCustomTabBehavior:w,handleKeyDown:f??B.handleKeyDown})]})})});function k1({bounds:t,richText:e,fontSize:n,font:r,align:i,verticalAlign:o,wrap:s,labelColor:a,padding:l,showTextOutline:c=!0}){const d=ne(),u=lO(d,e),p=i==="middle"?"center":i==="start"?"start":"end",f=i==="middle"?"center":i==="start"?"flex-start":"flex-end",y=o==="middle"?"center":o==="start"?"flex-start":"flex-end",v={display:"flex",fontFamily:jle[r],height:"100%",justifyContent:f,alignItems:y,padding:`${l}px`},x={fontSize:`${n}px`,wrap:s?"wrap":"nowrap",color:a,lineHeight:Vi.lineHeight,textAlign:p,width:"100%",wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"pre-wrap",textShadow:c?"var(--tl-text-outline)":"none"};return g.jsx("foreignObject",{x:t.minX,y:t.minY,width:t.w,height:t.h,className:"tl-export-embed-styles tl-rich-text tl-rich-text-svg",children:g.jsx("div",{style:v,children:g.jsx("div",{dangerouslySetInnerHTML:{__html:u},style:x})})})}function hO(t){return{key:`${Ou.id}:${t}`,async getElement(){return t!=="pattern"?null:g.jsx(zDe,{})}}}function zDe(){const t=fO(),e=Ih(),n=ga(),r=8/12;return g.jsxs(g.Fragment,{children:[g.jsxs("mask",{id:e,children:[g.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),g.jsxs("g",{strokeLinecap:"round",stroke:"black",children:[g.jsx("line",{x1:r*1,y1:r*3,x2:r*3,y2:r*1}),g.jsx("line",{x1:r*5,y1:r*7,x2:r*7,y2:r*5}),g.jsx("line",{x1:r*9,y1:r*11,x2:r*11,y2:r*9})]})]}),g.jsx("pattern",{id:t(1,n.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:g.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:n.solid,mask:`url(#${e})`})})]})}function pO(){return{key:`${Ou.id}:pattern`,component:HDe}}const wm=8,S6=(t,e,n)=>new Promise((r,i)=>{const o=wm*e*t,s=document.createElement("canvas");s.width=o,s.height=o;const a=s.getContext("2d");if(!a)return;a.fillStyle=n?tn.darkMode.solid:tn.lightMode.solid,a.fillRect(0,0,o,o),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*e*t;const l=8/12,c=d=>d*e*t;a.beginPath(),a.moveTo(c(l*1),c(l*3)),a.lineTo(c(l*3),c(l*1)),a.moveTo(c(l*5),c(l*7)),a.lineTo(c(l*7),c(l*5)),a.moveTo(c(l*9),c(l*11)),a.lineTo(c(l*11),c(l*9)),a.stroke(),s.toBlob(d=>{!d||Vn.throwToBlob.get()?i():r(d)})}),b6=(t,e)=>{const n=document.createElement("canvas");n.width=t[0],n.height=t[1];const r=n.getContext("2d");return r?(e(r),n.toDataURL()):""};let VP=null;function FDe(){return VP||(VP={white:b6([1,1],t=>{t.fillStyle="#f8f9fa",t.fillRect(0,0,1,1)}),black:b6([1,1],t=>{t.fillStyle="#212529",t.fillRect(0,0,1,1)})}),VP}function TZ(t){return Math.ceil(Math.log2(Math.max(1,t)))}function fO(){const t=za("hash_pattern");return I.useCallback((e,n)=>{const r=TZ(e);return J2(t,`${n}_${r}`)},[t])}function EZ(t){const e=[],r=TZ(t);for(let i=0;i<=r;i++)e.push(Math.pow(2,i));return e}function BDe(t){const e=FDe();return EZ(t).flatMap(n=>[{zoom:n,url:e.white,theme:"light"},{zoom:n,url:e.black,theme:"dark"}])}function UDe(){const t=ne(),e=J("devicePixelRatio",()=>t.getInstanceState().devicePixelRatio,[t]),n=J("maxZoom",()=>Math.ceil(gi(t.getCameraOptions().zoomSteps)),[t]),[r,i]=I.useState(!1),[o,s]=I.useState(()=>BDe(n)),a=fO();return I.useEffect(()=>{const c=Promise.all(EZ(n).flatMap(u=>[S6(e,u,!1).then(p=>({zoom:u,theme:"light",url:URL.createObjectURL(p)})),S6(e,u,!0).then(p=>({zoom:u,theme:"dark",url:URL.createObjectURL(p)}))]));let d=!1;return c.then(u=>{d||(s(u),i(!0))}),()=>{d=!0,i(!1),c.then(u=>{for(const{url:p}of u)URL.revokeObjectURL(p)})}},[e,n]),{defs:g.jsx(g.Fragment,{children:o.map(c=>{const d=a(c.zoom,c.theme);return g.jsx("pattern",{id:d,width:wm,height:wm,patternUnits:"userSpaceOnUse",children:g.jsx("image",{href:c.url,width:wm,height:wm})},d)})}),isReady:r}}function HDe(){const t=ne(),e=I.useRef(null),{defs:n,isReady:r}=UDe();return I.useEffect(()=>{if(r&&Jt.isSafari){const i=AZ(e.current);i&&t.timers.requestAnimationFrame(()=>{i.style.display="none",t.timers.requestAnimationFrame(()=>{i.style.display=""})})}},[t,r]),g.jsx("g",{ref:e,"data-testid":r?"ready-pattern-fill-defs":void 0,children:n})}function AZ(t){return t.classList.contains("tl-html-layer")?t:t.parentElement?AZ(t.parentElement):null}const Ay=rt.memo(function({theme:e,d:n,color:r,fill:i,scale:o}){switch(i){case"none":return null;case"solid":return g.jsx("path",{fill:Ht(e,r,"semi"),d:n});case"semi":return g.jsx("path",{fill:e.solid,d:n});case"fill":return g.jsx("path",{fill:Ht(e,r,"fill"),d:n});case"pattern":return g.jsx(WDe,{theme:e,color:r,fill:i,d:n,scale:o})}});function WDe({d:t,color:e,theme:n}){const r=ne(),i=Jy(),o=J("zoomLevel",()=>r.getZoomLevel(),[r]),s=fO(),a=r.getZoomLevel()<=.18;return g.jsxs(g.Fragment,{children:[g.jsx("path",{fill:Ht(n,e,"pattern"),d:t}),g.jsx("path",{fill:i?`url(#${s(1,n.id)})`:a?Ht(n,e,"semi"):`url(#${s(o,n.id)})`,d:t})]})}function MZ(t,e,n){switch(e.type){case"straight":return new Zt().moveTo(e.start.point.x,e.start.point.y,{offset:0,roundness:0}).lineTo(e.end.point.x,e.end.point.y,{offset:0,roundness:0}).toSvg(n);case"arc":return new Zt().moveTo(e.start.point.x,e.start.point.y,{offset:0,roundness:0}).circularArcTo(e.bodyArc.radius,!!e.bodyArc.largeArcFlag,!!e.bodyArc.sweepFlag,e.end.point.x,e.end.point.y,{offset:0,roundness:0}).toSvg(n);case"elbow":{const r=new Zt;r.moveTo(e.start.point.x,e.start.point.y,{offset:0});for(let i=1;i<e.route.points.length;i++){const o=e.route.points[i];e.route.skipPointsWhenDrawing.has(o)||r.lineTo(o.x,o.y,{offset:i===e.route.points.length-1?0:void 0})}return r.toSvg(n)}default:Wt(e,"type")}}function VDe(t,e){switch(t.type){case"straight":return new Zt().moveTo(t.start.handle.x,t.start.handle.y).lineTo(t.end.handle.x,t.end.handle.y).toSvg(e);case"arc":return new Zt().moveTo(t.start.handle.x,t.start.handle.y).circularArcTo(t.handleArc.radius,!!t.handleArc.largeArcFlag,!!t.handleArc.sweepFlag,t.end.handle.x,t.end.handle.y).toSvg(e);case"elbow":{const n=yPe(t.elbow,t.route);return Zt.lineThroughPoints(n.points).toSvg(e)}default:Wt(t,"type")}}function vf(t,e){const n=ea(t,e);switch(n.type){case"straight":return new cf({start:T.From(n.start.point),end:T.From(n.end.point)});case"arc":return new iW({center:T.Cast(n.handleArc.center),start:T.Cast(n.start.point),end:T.Cast(n.end.point),sweepFlag:n.bodyArc.sweepFlag,largeArcFlag:n.bodyArc.largeArcFlag});case"elbow":return new Zy({points:n.route.points});default:Wt(n,"type")}}const KDe=Gw("arrow label size",(t,e)=>{t.fonts.trackFontsForShape(e);let n=0,r=0;const i=vf(t,e),o=lr(e.props.richText),s=Ty(t,o?dn("i"):e.props.richText),a=i.bounds,l=NE(e),{w:c,h:d}=t.textMeasure.measureHtml(s,{...Vi,fontFamily:bc[e.props.font],fontSize:l,maxWidth:null});n=c,r=d;let u=!1;const p=ea(t,e),f=DZ(e),y=p.type==="elbow"?Math.max(p.elbow.A.arrowheadOffset+f,32)+Math.max(p.elbow.B.arrowheadOffset+f,32):64;if(a.width>a.height?(n=Math.max(Math.min(c,y),Math.min(a.width-y,c)),u=!0):n>16*l&&(n=16*l,u=!0),u){const{w:v,h:x}=t.textMeasure.measureHtml(s,{...Vi,fontFamily:bc[e.props.font],fontSize:l,maxWidth:n});n=v,r=x}return new T(n,r).addScalar(TE*2*e.props.scale)},{areRecordsEqual:(t,e)=>{if(t.props===e.props)return!0;const n=Qoe(t.props,e.props);return n.length===1&&n[0]==="labelPosition"}});function OZ(t,e){return KDe.get(t,e.id)??new T(0,0)}function DZ(t){const e=Br[t.props.size];return(XAe+(e-Br.s)*2+(e===Br.xl?20:0))*t.props.scale}function qDe(t,e,n){const r=vf(t,e),i=[],o=[new Zo({children:[r],debugColor:"lime"})],s=OZ(t,e),a=DZ(e),l=a/r.length;let c,d;if(n.type==="elbow")i.push(n.start.point,n.end.point),c=pe.FromCenter(n.start.point,s).expandBy(a),d=pe.FromCenter(n.end.point,s).expandBy(a);else{const b=r.interpolateAlongEdge(l),w=r.interpolateAlongEdge(1-l);i.push(b,w),c=pe.FromCenter(b,s),d=pe.FromCenter(w,s)}const u=r.intersectPolygon(c.corners),p=r.intersectPolygon(d.corners),f=w6(n.start.point,u),y=w6(n.end.point,p);let v=f?r.uninterpolateAlongEdge(f):.5,x=y?r.uninterpolateAlongEdge(y):.5;v>x&&(v=.5,x=.5);for(const b of[...u,...p,...i])o.push(new Sb({x:b.x-3,y:b.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));return o.push(new ry({points:c.corners,debugColor:"lime",isFilled:!1,ignore:!0}),new ry({points:d.corners,debugColor:"lime",isFilled:!1,ignore:!0})),{start:v,end:x,dbg:o}}function XS(t,e){if(!(t.getEditingShapeId()===e.id)&&lr(e.props.richText)){const p=vf(t,e).interpolateAlongEdge(.5);return{box:pe.FromCenter(p,new T(0,0)),debugGeom:[]}}const r=[],i=ea(t,e),o={hasStartBinding:!!i.bindings.start,hasEndBinding:!!i.bindings.end,hasStartArrowhead:i.start.arrowhead!=="none",hasEndArrowhead:i.end.arrowhead!=="none"},s=qDe(t,e,i);s.dbg&&r.push(...s.dbg);const a=GDe(e,s,o),c=vf(t,e).interpolateAlongEdge(a),d=OZ(t,e);return{box:pe.FromCenter(c,d),debugGeom:r}}function GDe(t,e,n){const{hasEndArrowhead:r,hasEndBinding:i,hasStartBinding:o,hasStartArrowhead:s}=n;return pt(t.props.labelPosition,s||o?e.start:0,r||i?e.end:1)}function w6(t,e){let n=null,r=-1/0;for(const i of e){const o=T.Dist2(t,i);o>r&&(n=i,r=o)}return n}function NE(t){return YAe[t.props.size]*t.props.scale}function jZ(t,e){const n=ea(t,e);switch(n.type){case"straight":case"arc":return .5;case"elbow":{const r=n.route.midpointHandle,i=vf(t,e);return r&&i?i.uninterpolateAlongEdge(r.point):.5}default:Wt(n,"type")}}function RZ(t,e){if(!t.isShapeOfType(e,"arrow"))return!1;const n=t.getPointInShapeSpace(e,t.inputs.currentPagePoint),r=t.getShapeGeometry(e).children[1];return r&&fo(n,r.vertices)}function YDe(t,e,n){const r=e==="end"?t.end.point:t.start.point;let i;switch(t.type){case"straight":{const o=e==="end"?t.start.point:t.end.point,s=T.Dist(o,r),a=pt(s/5,n,n*3);i=T.Nudge(r,o,a);break}case"arc":{const o=Math.abs(t.bodyArc.length),s=pt(o/5,n,n*3),a=Cue(r,s,t.handleArc.center,t.handleArc.radius);i=e==="end"?t.handleArc.sweepFlag?a[0]:a[1]:t.handleArc.sweepFlag?a[1]:a[0];break}case"elbow":{const o=e==="end"?t.route.points[t.route.points.length-2]:t.route.points[1],s=T.ManhattanDist(o,r),a=pt(s/2,n,n*3);i=o?T.Nudge(r,o,a):r;break}default:Wt(t,"type")}return T.IsNaN(i)&&(i=r),{point:r,int:i}}function XDe({point:t,int:e}){const n=T.RotWith(e,t,nn/6),r=T.RotWith(e,t,-nn/6);return`M ${n.x} ${n.y} L ${t.x} ${t.y} L ${r.x} ${r.y}`}function ZDe({point:t,int:e}){const n=T.RotWith(e,t,nn/6),r=T.RotWith(e,t,-nn/6);return`M ${n.x} ${n.y} L ${r.x} ${r.y} L ${t.x} ${t.y} Z`}function JDe({point:t,int:e}){const n=T.Sub(e,t).div(2),r=T.Add(t,T.Rot(n,br)),i=T.Sub(t,T.Rot(n,br));return`M ${r.x} ${r.y} L ${e.x} ${e.y} L ${i.x} ${i.y} Z`}function QDe({point:t,int:e}){const n=T.Lrp(t,e,.45),r=T.Dist(n,t);return`M ${n.x-r},${n.y}
  a ${r},${r} 0 1,0 ${r*2},0
  a ${r},${r} 0 1,0 -${r*2},0 `}function eje({point:t,int:e}){const n=T.Lrp(t,e,.75),r=T.RotWith(n,t,nn/4),i=T.RotWith(n,t,-nn/4),o=T.Lrp(r,i,.5);return o.add(T.Sub(o,t)),`M ${o.x} ${o.y} L ${i.x} ${i.y} ${t.x} ${t.y} L ${r.x} ${r.y} Z`}function tje({int:t,point:e}){const n=T.Lrp(e,t,.85),r=T.Sub(n,e).div(2),i=T.Add(e,T.Rot(r,br)),o=T.Sub(e,T.Rot(r,br)),s=T.Add(n,T.Rot(r,br)),a=T.Sub(n,T.Rot(r,br));return`M ${i.x} ${i.y} L ${s.x} ${s.y} L ${a.x} ${a.y} L ${o.x} ${o.y} Z`}function nje({int:t,point:e}){const n=T.Sub(t,e).div(2),r=T.Add(e,T.Rot(n,br)),i=T.Sub(e,T.Rot(n,br));return`M ${r.x} ${r.y} L ${i.x} ${i.y}`}function bw(t,e,n){const r=e==="end"?t.end.arrowhead:t.start.arrowhead;if(r==="none")return;const i=YDe(t,e,n);if(i){switch(r){case"bar":return nje(i);case"square":return tje(i);case"diamond":return eje(i);case"dot":return QDe(i);case"inverted":return JDe(i);case"arrow":return XDe(i);case"triangle":return ZDe(i)}return""}}function rje({arrow:t}){const e=ne(),n=J("elbow arrow grid",()=>{try{return BY(e,e.getShape(t.id),Zr(e,t))}catch(s){console.error(s);return}},[e,t.id]);if(!n)return null;const r=pe.Common([n.A.original,n.B.original]).expandBy(50),i=n.route?.name??"",o=n.route?.midpointHandle;return g.jsxs(g.Fragment,{children:[n.midX!==null&&g.jsx(Nd,{a:{x:n.midX,y:r.minY},b:{x:n.midX,y:r.maxY},stroke:"red"}),n.midY!==null&&g.jsx(Nd,{a:{x:r.minX,y:n.midY},b:{x:r.maxX,y:n.midY},stroke:"blue"}),o?.axis==="x"&&n.midXRange&&g.jsx(Nd,{a:{x:n.midXRange.lo,y:o.point.y},b:{x:n.midXRange.hi,y:o.point.y},stroke:"red",strokeDasharray:"0 2"}),o?.axis==="y"&&n.midYRange&&g.jsx(Nd,{a:{x:o.point.x,y:n.midYRange.lo},b:{x:o.point.x,y:n.midYRange.hi},stroke:"blue",strokeDasharray:"0 2"}),g.jsx(Pp,{box:n.A.original,stroke:"orange"}),g.jsx(Pp,{box:n.A.expanded,stroke:"orange",strokeWidth:.5}),g.jsx(Pp,{box:n.A.original.clone().expandBy(n.options.minElbowLegLength),stroke:"orange",strokeWidth:.5}),g.jsx(Pp,{box:n.B.original,stroke:"lightskyblue"}),g.jsx(Pp,{box:n.B.expanded,stroke:"lightskyblue",strokeWidth:.5}),g.jsx(Pp,{box:n.B.original.clone().expandBy(n.options.minElbowLegLength),stroke:"lightskyblue",strokeWidth:.5}),g.jsx(iu,{edge:n.A.edges.top,axis:"x",stroke:"orange"}),g.jsx(iu,{edge:n.B.edges.top,axis:"x",stroke:"lightskyblue"}),g.jsx(iu,{edge:n.A.edges.right,axis:"y",stroke:"orange"}),g.jsx(iu,{edge:n.B.edges.right,axis:"y",stroke:"lightskyblue"}),g.jsx(iu,{edge:n.A.edges.bottom,axis:"x",stroke:"orange"}),g.jsx(iu,{edge:n.B.edges.bottom,axis:"x",stroke:"lightskyblue"}),g.jsx(iu,{edge:n.A.edges.left,axis:"y",stroke:"orange"}),g.jsx(iu,{edge:n.B.edges.left,axis:"y",stroke:"lightskyblue"}),n.route&&g.jsx(ije,{route:n.route.points,strokeWidth:10}),g.jsx("text",{x:r.minX+5,y:r.minY-3,fontSize:10,fill:"black",stroke:"var(--tl-color-background)",strokeWidth:2,paintOrder:"stroke",children:i}),g.jsxs("text",{x:n.A.expanded.x,y:n.A.expanded.y,fontSize:10,fill:"black",stroke:"var(--tl-color-background)",strokeWidth:2,paintOrder:"stroke",children:["A",n.route&&`, ${n.route.aEdgePicking}`,n.A.isPoint&&", point"]}),g.jsxs("text",{x:n.B.expanded.x,y:n.B.expanded.y,fontSize:10,fill:"black",stroke:"var(--tl-color-background)",strokeWidth:2,paintOrder:"stroke",children:["B",n.route&&`, ${n.route.bEdgePicking}`,n.B.isPoint&&", point"]})]})}function Nd({a:t,b:e,...n}){return g.jsx("line",{fill:"none",strokeWidth:1,strokeDasharray:"4,4",stroke:"green",x1:t.x,y1:t.y,x2:e.x,y2:e.y,...n})}function ije({route:t,...e}){return g.jsx("polyline",{fill:"none",stroke:"darkorchid",strokeWidth:3,opacity:.5,points:t.map(n=>`${n.x},${n.y}`).join(" "),...e})}function iu({edge:t,axis:e,...n}){if(!t||t.expanded===null)return null;const r=i=>e==="x"?{x:i.y,y:i.x}:i;return g.jsxs("g",{children:[g.jsx(Nd,{a:r({x:t.expanded,y:t.cross.min}),b:r({x:t.expanded,y:t.cross.max}),strokeDasharray:"0",strokeWidth:1.5,...n}),g.jsx(Nd,{a:r({x:t.expanded-4,y:t.cross.min}),b:r({x:t.expanded+4,y:t.cross.min}),strokeDasharray:"0",strokeWidth:1.5,...n}),g.jsx(Nd,{a:r({x:t.expanded-4,y:t.cross.max}),b:r({x:t.expanded+4,y:t.cross.max}),strokeDasharray:"0",strokeWidth:1.5,...n})]})}function Pp({box:t,...e}){return g.jsx("rect",{x:t.minX,y:t.minY,width:t.width,height:t.height,strokeDasharray:"4,4",strokeWidth:1,fill:"none",...e})}const oje=new ki;function sje(t){return oje.get(t,e=>{const n=fe("current selected arrow shape",()=>{const i=e.getOnlySelectedShape();return!i||!e.isShapeOfType(i,"arrow")?null:i.id}),r=e.store.query.ids("shape",()=>{const i=n.get();return i?{type:{eq:"arrow"},id:{neq:i}}:{type:{eq:"arrow"}}});return fe("elbow arrow snap lines",()=>{const i=new Map,o=e.getCurrentPageShapeIds(),s=e.getViewportPageBounds();for(const a of r.get()){if(!o.has(a))continue;const l=e.getShape(a);if(l?.type!=="arrow")continue;const c=e.getShapePageBounds(a);if(!c||!s.includes(c))continue;const d=Zr(e,l),u=e.getShapePageTransform(a);if(!u)continue;const p=e.getShapeGeometry(a),f=u.applyToPoints(p.vertices);for(let y=1;y<f.length;y++){const v=f[y-1],x=f[y];let b=T.Angle(v,x);b<0&&(b+=Math.PI);let w=i.get(b);w||(w=new Set,i.set(b,w));const _=km(v,b);w.add({perpDistance:_,startBoundShapeId:d.start?.toId,endBoundShapeId:d.end?.toId})}}return i})}).get()}function km(t,e){const n=T.FromAngle(e).per();return T.Dpr(t,n)}class aje extends Yu{static type="arrow";static props=vU;static migrations=xU;options={expandElbowLegLength:{s:28,m:36,l:44,xl:66},minElbowLegLength:{s:Br.s*3,m:Br.m*3,l:Br.l*3,xl:Br.xl*3},minElbowHandleDistance:16,arcArrowCenterSnapDistance:16,elbowArrowCenterSnapDistance:24,elbowArrowEdgeSnapDistance:20,elbowArrowPointSnapDistance:24,elbowArrowAxisSnapDistance:16,labelCenterSnapDistance:10,elbowMidpointSnapDistance:10,elbowMinSegmentLengthToShowMidpointHandle:20,hoverPreciseTimeout:600,pointingPreciseTimeout:320,shouldBeExact:e=>e.inputs.altKey,shouldIgnoreTargets:e=>e.inputs.ctrlKey};canEdit(){return!0}canBind({toShapeType:e}){return e!=="arrow"}canSnap(){return!1}hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsBg(){return!0}hideSelectionBoundsFg(){return!0}hideInMinimap(){return!0}canBeLaidOut(e,n){if(n.type==="flip"){const r=Zr(this.editor,e),{start:i,end:o}=r,{shapes:s=[]}=n;if(i&&!s.find(a=>a.id===i.toId)||o&&!s.find(a=>a.id===o.toId))return!1}return!0}getFontFaces(e){return lr(e.props.richText)?ur:j0(this.editor,e.props.richText,{family:`tldraw_${e.props.font}`,weight:"normal",style:"normal"})}getDefaultProps(){return{kind:"arc",elbowMidPoint:.5,dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",richText:dn(""),labelPosition:.5,font:"draw",scale:1}}getGeometry(e){const n=this.editor.getEditingShapeId()===e.id,r=ea(this.editor,e),i=[],o=r.type==="straight"?new cf({start:T.From(r.start.point),end:T.From(r.end.point)}):r.type==="arc"?new iW({center:T.Cast(r.handleArc.center),start:T.Cast(r.start.point),end:T.Cast(r.end.point),sweepFlag:r.bodyArc.sweepFlag,largeArcFlag:r.bodyArc.largeArcFlag}):new Zy({points:r.route.points});let s;if(n||!lr(e.props.richText)){const a=XS(this.editor,e);Vn.debugGeometry.get()&&i.push(...a.debugGeom),s=new Cl({x:a.box.x,y:a.box.y,width:a.box.w,height:a.box.h,isFilled:!0,isLabel:!0})}return new Zo({children:[...s?[o,s]:[o],...i]})}getHandles(e){const n=ea(this.editor,e),r=[{id:"start",type:"vertex",index:"a1",x:n.start.handle.x,y:n.start.handle.y},{id:"end",type:"vertex",index:"a3",x:n.end.handle.x,y:n.end.handle.y}];if(e.props.kind==="arc"&&(n.type==="straight"||n.type==="arc")&&r.push({id:"middle",type:"virtual",index:"a2",x:n.middle.x,y:n.middle.y}),e.props.kind==="elbow"&&n.type==="elbow"&&n.route.midpointHandle){const i=this.editor.getShapePageTransform(e.id),o=i.applyToPoint(n.route.midpointHandle.segmentStart),s=i.applyToPoint(n.route.midpointHandle.segmentEnd);T.Dist(o,s)*this.editor.getZoomLevel()>this.options.elbowMinSegmentLengthToShowMidpointHandle&&r.push({id:"middle",type:"vertex",index:"a2",x:n.route.midpointHandle.point.x,y:n.route.midpointHandle.point.y})}return r}getText(e){return Lu(this.editor,e.props.richText)}onHandleDrag(e,n){const r=n.handle.id;switch(r){case"middle":switch(e.props.kind){case"arc":return this.onArcMidpointHandleDrag(e,n);case"elbow":return this.onElbowMidpointHandleDrag(e,n);default:Wt(e.props.kind)}case"start":case"end":return this.onTerminalHandleDrag(e,n,r);default:Wt(r)}}onArcMidpointHandleDrag(e,{handle:n}){const r=Zr(this.editor,e),{start:i,end:o}=Up(this.editor,e,r),s=T.Sub(o,i),a=T.Per(s),l=T.Med(o,i),c=T.Sub(l,a),d=T.Add(l,a),u=T.NearestPointOnLineSegment(c,d,n,!1);let p=T.Dist(u,l);return T.Clockwise(u,o,l)&&(p*=-1),{id:e.id,type:e.type,props:{bend:p}}}onElbowMidpointHandleDrag(e,{handle:n}){const r=ea(this.editor,e);if(r?.type!=="elbow")return;const i=this.editor.getShapePageTransform(e.id),o=i.applyToPoint(n),s=r.route.midpointHandle?.axis;if(!s)return;const a=by[s],l=r.elbow[a.midRange];if(!l)return;let c=T.Angle(i.applyToPoint(a.v(0,0)),i.applyToPoint(a.v(0,1)));c<0&&(c+=Math.PI);const d=km(o,c),u=km(i.applyToPoint(a.v(l.lo,0)),c),p=km(i.applyToPoint(a.v(l.hi,0)),c),f=this.options.elbowMidpointSnapDistance/this.editor.getZoomLevel(),y=km(i.applyToPoint(a.v(St(l.lo,l.hi,.5),0)),c);let v=y,x=Math.abs(y-d);for(const[w,_]of sje(this.editor)){const{isParallel:C,isFlippedParallel:A}=uje(c,w);if(C||A)for(const E of _){const O=E.startBoundShapeId&&(E.startBoundShapeId===r.bindings.start?.toId||E.startBoundShapeId===r.bindings.end?.toId),D=E.endBoundShapeId&&(E.endBoundShapeId===r.bindings.start?.toId||E.endBoundShapeId===r.bindings.end?.toId);if(!O&&!D)continue;const B=A?-E.perpDistance:E.perpDistance,L=Math.abs(B-d);L<x&&(v=B,x=L)}}x>f&&(v=d);const b=pt(Jm(u,p,v),0,1);return{id:e.id,type:e.type,props:{elbowMidPoint:b}}}onTerminalHandleDrag(e,{handle:n,isPrecise:r},i){const o=Zr(this.editor,e),s={id:e.id,type:"arrow",props:{}},a=o[i],c=o[i==="start"?"end":"start"],d=x1({editor:this.editor,pointInPageSpace:this.editor.getShapePageTransform(e.id).applyToPoint(n),arrow:e,isPrecise:r,currentBinding:a,oppositeBinding:c});if(!d){vm(this.editor,e,i);const f=Ps(new T(n.x,n.y),this.editor);return s.props[i]={x:f.x,y:f.y},s}const u={terminal:i,normalizedAnchor:d.normalizedAnchor,isPrecise:d.isPrecise,isExact:d.isExact,snap:d.snap};Wg(this.editor,e,d.target.id,u);const p=Zr(this.editor,e);return p.start&&p.end&&p.start.toId===p.end.toId&&T.Equals(p.start.props.normalizedAnchor,p.end.props.normalizedAnchor)&&Wg(this.editor,e,p.end.toId,{...p.end.props,normalizedAnchor:{x:p.end.props.normalizedAnchor.x+.05,y:p.end.props.normalizedAnchor.y}}),s}onTranslateStart(e){const n=Zr(this.editor,e);if(e.props.kind==="elbow"&&this.editor.getOnlySelectedShapeId()===e.id){const s=ea(this.editor,e);if(!s)return;const a={id:e.id,type:"arrow",props:{}};return n.start&&(a.props.start={x:s.start.point.x,y:s.start.point.y},vm(this.editor,e,"start")),n.end&&(a.props.end={x:s.end.point.x,y:s.end.point.y},vm(this.editor,e,"end")),a}const r=Up(this.editor,e,n),i=this.editor.getShapePageTransform(e.id),o=this.editor.getSelectedShapeIds();if(!(n.start&&(o.includes(n.start.toId)||this.editor.isAncestorSelected(n.start.toId))||n.end&&(o.includes(n.end.toId)||this.editor.isAncestorSelected(n.end.toId)))){I6.set(e,{pagePosition:i.applyToPoint(e),terminalBindings:Uu(r,(s,a)=>{const l=n[s];return l?{binding:l,shapePosition:a,pagePosition:i.applyToPoint(a)}:null})}),n.start&&(Kb({editor:this.editor,arrow:e,terminal:"start",useHandle:!0}),e=this.editor.getShape(e.id)),n.end&&Kb({editor:this.editor,arrow:e,terminal:"end",useHandle:!0});for(const s of["start","end"]){const a=n[s];a&&this.editor.updateBinding({...a,props:{...a.props,isPrecise:!0}})}}}onTranslate(e,n){const r=I6.get(e);if(!r)return;const i=this.editor.getShapePageTransform(n.id),o=T.Sub(i.applyToPoint(n),r.pagePosition);for(const s of Object.values(r.terminalBindings)){if(!s)continue;const a=T.Add(s.pagePosition,T.Mul(o,.5)),l=this.editor.getShapeAtPoint(a,{hitInside:!0,hitFrameInside:!0,margin:0,filter:c=>!c.isLocked&&this.editor.canBindShapes({fromShape:n,toShape:c,binding:"arrow"})});if(l?.id===s.binding.toId){const c=pe.ZeroFix(this.editor.getShapeGeometry(l).bounds),d=this.editor.getPointInShapeSpace(l,a),u={x:(d.x-c.minX)/c.width,y:(d.y-c.minY)/c.height};Wg(this.editor,n,l.id,{...s.binding.props,normalizedAnchor:u,isPrecise:!0})}else vm(this.editor,n,s.binding.props.terminal)}}_resizeInitialBindings=new ki;onResize(e,n){const{scaleX:r,scaleY:i}=n,o=this._resizeInitialBindings.get(e,()=>Zr(this.editor,e)),s=Up(this.editor,e,o),{start:a,end:l}=fn(e.props);let{bend:c}=e.props;o.start||(a.x=s.start.x*r,a.y=s.start.y*i),o.end||(l.x=s.end.x*r,l.y=s.end.y*i);const d=Math.abs(r),u=Math.abs(i),p=o?.start?T.From(o.start.props.normalizedAnchor):null,f=o?.end?T.From(o.end.props.normalizedAnchor):null;return r<0&&i>=0?(c!==0&&(c*=-1,c*=Math.max(d,u)),p&&(p.x=1-p.x),f&&(f.x=1-f.x)):r>=0&&i<0?(c!==0&&(c*=-1,c*=Math.max(d,u)),p&&(p.y=1-p.y),f&&(f.y=1-f.y)):r>=0&&i>=0?c!==0&&(c*=Math.max(d,u)):r<0&&i<0&&(c!==0&&(c*=Math.max(d,u)),p&&(p.x=1-p.x,p.y=1-p.y),f&&(f.x=1-f.x,f.y=1-f.y)),o.start&&p&&Wg(this.editor,e,o.start.toId,{...o.start.props,normalizedAnchor:p.toJson()}),o.end&&f&&Wg(this.editor,e,o.end.toId,{...o.end.props,normalizedAnchor:f.toJson()}),{props:{start:a,end:l,bend:c}}}onDoubleClickHandle(e,n){switch(n.id){case"start":return{id:e.id,type:e.type,props:{...e.props,arrowheadStart:e.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:e.id,type:e.type,props:{...e.props,arrowheadEnd:e.props.arrowheadEnd==="none"?"arrow":"none"}}}}component(e){const n=ga(),r=this.editor.getOnlySelectedShape(),i=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getIsReadonly();if(!ea(this.editor,e)?.isValid)return null;const s=XS(this.editor,e),a=e.id===this.editor.getOnlySelectedShapeId(),c=this.editor.getEditingShapeId()===e.id||!lr(e.props.richText);return g.jsxs(g.Fragment,{children:[g.jsxs(_l,{style:{minWidth:50,minHeight:50},children:[g.jsx(k6,{shape:e,shouldDisplayHandles:i&&r?.id===e.id}),e.props.kind==="elbow"&&Vn.debugElbowArrows.get()&&g.jsx(rje,{arrow:e})]}),c&&g.jsx(w1,{shapeId:e.id,type:"arrow",font:e.props.font,fontSize:NE(e),lineHeight:Vi.lineHeight,align:"middle",verticalAlign:"middle",labelColor:Ht(n,e.props.labelColor,"solid"),richText:e.props.richText,textWidth:s.box.w-TE*2*e.props.scale,isSelected:a,padding:0,style:{transform:`translate(${s.box.center.x}px, ${s.box.center.y}px)`}})]})}indicator(e){const n=iv(e.id),r=za(e.id+"_clip"),i=ea(this.editor,e);if(!i)return null;const{start:o,end:s}=Up(this.editor,e,i?.bindings),a=this.editor.getShapeGeometry(e),l=a.bounds,c=lr(e.props.richText),d=n||!c?a.children[1]:null;if(T.Equals(o,s))return null;const u=Br[e.props.size]*e.props.scale,p=i.start.arrowhead&&bw(i,"start",u),f=i.end.arrowhead&&bw(i,"end",u),y=p&&i.start.arrowhead!=="arrow"||f&&i.end.arrowhead!=="arrow"||!!d,v=d?d.getBounds():new pe(0,0,0,0);if(n&&d)return g.jsx("rect",{x:ee(v.x),y:ee(v.y),width:v.w,height:v.h,rx:3.5*e.props.scale,ry:3.5*e.props.scale});const x=!(i.start.arrowhead==="none"||i.start.arrowhead==="arrow"),b=!(i.end.arrowhead==="none"||i.end.arrowhead==="arrow");return g.jsxs("g",{children:[y&&g.jsx("defs",{children:g.jsx($Z,{radius:3.5*e.props.scale,hasText:!c,bounds:l,labelBounds:v,as:x&&p?p:"",ae:b&&f?f:""})}),g.jsxs("g",{style:{clipPath:y?`url(#${r})`:void 0,WebkitClipPath:y?`url(#${r})`:void 0},children:[y&&g.jsx("rect",{x:l.minX-100,y:l.minY-100,width:l.width+200,height:l.height+200,opacity:0}),MZ(e,i,e.props.dash==="draw"?{style:"draw",randomSeed:e.id,strokeWidth:1,passes:1,offset:0,roundness:u*2,props:{strokeWidth:void 0}}:{style:"solid",strokeWidth:1,props:{strokeWidth:void 0}})]}),p&&g.jsx("path",{d:p}),f&&g.jsx("path",{d:f}),d&&g.jsx("rect",{x:ee(v.x),y:ee(v.y),width:v.w,height:v.h,rx:3.5,ry:3.5})]})}onEditStart(e){if(lr(e.props.richText)){const n=jZ(this.editor,e);this.editor.updateShape({id:e.id,type:e.type,props:{labelPosition:n}})}}toSvg(e,n){n.addExportDef(hO(e.props.fill));const r=Ku(n),i=1/e.props.scale;return g.jsxs("g",{transform:`scale(${i})`,children:[g.jsx(k6,{shape:e,shouldDisplayHandles:!1}),g.jsx(k1,{fontSize:NE(e),font:e.props.font,align:"middle",verticalAlign:"middle",labelColor:Ht(r,e.props.labelColor,"solid"),richText:e.props.richText,bounds:XS(this.editor,e).box.clone().expandBy(-TE*e.props.scale),padding:0,showTextOutline:!0})]})}getCanvasSvgDefs(){return[pO(),{key:"arrow:dot",component:lje},{key:"arrow:cross",component:cje}]}getInterpolatedProps(e,n,r){return{...r>.5?n.props:e.props,scale:St(e.props.scale,n.props.scale,r),start:{x:St(e.props.start.x,n.props.start.x,r),y:St(e.props.start.y,n.props.start.y,r)},end:{x:St(e.props.end.x,n.props.end.x,r),y:St(e.props.end.y,n.props.end.y,r)},bend:St(e.props.bend,n.props.bend,r),labelPosition:St(e.props.labelPosition,n.props.labelPosition,r)}}}const k6=_r(function({shape:e,shouldDisplayHandles:n}){const r=ne(),i=ga(),o=ea(r,e),s=J("force solid",()=>r.getZoomLevel()<.2,[r]),a=za(e.id+"_clip"),l=za("arrowhead-dot"),c=za("arrowhead-cross"),d=iv(e.id),u=r.getShapeGeometry(e);if(!u)return null;const p=pe.ZeroFix(u.bounds),f=Zr(r,e),y=lr(e.props.richText);if(!o?.isValid)return null;const v=Br[e.props.size]*e.props.scale,x=o.start.arrowhead&&bw(o,"start",v),b=o.end.arrowhead&&bw(o,"end",v);let w=null;n&&(f.start||f.end)&&(w=VDe(o,{style:"dashed",start:"skip",end:"skip",lengthRatio:2.5,strokeWidth:2/r.getZoomLevel(),props:{className:"tl-arrow-hint",markerStart:f.start?f.start.props.isExact?"":f.start.props.isPrecise?`url(#${c})`:`url(#${l})`:"",markerEnd:f.end?f.end.props.isExact?"":f.end.props.isPrecise?`url(#${c})`:`url(#${l})`:"",opacity:.16}}));const _=XS(r,e),C=!(o.start.arrowhead==="none"||o.start.arrowhead==="arrow"),A=!(o.end.arrowhead==="none"||o.end.arrowhead==="arrow");return g.jsxs(g.Fragment,{children:[g.jsx("defs",{children:g.jsx("clipPath",{id:a,children:g.jsx($Z,{radius:3.5*e.props.scale,hasText:d||!y,bounds:p,labelBounds:_.box,as:C&&x?x:"",ae:A&&b?b:""})})}),g.jsxs("g",{fill:"none",stroke:Ht(i,e.props.color,"solid"),strokeWidth:v,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[w,g.jsxs("g",{style:{clipPath:`url(#${a})`,WebkitClipPath:`url(#${a})`},children:[g.jsx("rect",{x:ee(p.minX-100),y:ee(p.minY-100),width:ee(p.width+200),height:ee(p.height+200),opacity:0}),MZ(e,o,{style:e.props.dash,strokeWidth:v,forceSolid:s,randomSeed:e.id})]}),x&&C&&e.props.fill!=="none"&&g.jsx(Ay,{theme:i,d:x,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),b&&A&&e.props.fill!=="none"&&g.jsx(Ay,{theme:i,d:b,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),x&&g.jsx("path",{d:x}),b&&g.jsx("path",{d:b})]})]})});function $Z({radius:t,hasText:e,bounds:n,labelBounds:r,as:i,ae:o}){const s=I.useMemo(()=>{const a=new Zt;return a.moveTo(n.left-100,n.top-100).lineTo(n.right+100,n.top-100).lineTo(n.right+100,n.bottom+100).lineTo(n.left-100,n.bottom+100).close(),e&&a.moveTo(r.left,r.top+t).lineTo(r.left,r.bottom-t).circularArcTo(t,!1,!1,r.left+t,r.bottom).lineTo(r.right-t,r.bottom).circularArcTo(t,!1,!1,r.right,r.bottom-t).lineTo(r.right,r.top+t).circularArcTo(t,!1,!1,r.right-t,r.top).lineTo(r.left+t,r.top).circularArcTo(t,!1,!1,r.left,r.top+t).close(),a.toD()},[t,e,n.bottom,n.left,n.right,n.top,r.bottom,r.left,r.right,r.top]);return g.jsx("path",{d:`${s}${i}${o}`})}const I6=new WeakMap;function lje(){const t=za("arrowhead-dot");return g.jsx("marker",{id:t,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:g.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function cje(){const t=za("arrowhead-cross");return g.jsxs("marker",{id:t,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[g.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),g.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}function uje(t,e,n=1e-4){const r=Math.abs(t-e),i=r<n,o=Math.abs(r-Math.PI)<n,s=Math.abs(r-Sn)<n;return{isParallel:i||s,isFlippedParallel:o}}const _6="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function xf({url:t}){const e=ne(),n=J("zoomLevel",()=>e.getZoomLevel()<.32,[e]),r=I.useCallback(i=>{e.inputs.shiftKey||e.markEventAsHandled(i)},[e]);return g.jsx("a",{className:Ye("tl-hyperlink-button",{"tl-hyperlink-button__hidden":n}),href:t,target:"_blank",rel:"noopener noreferrer",onPointerDown:r,onPointerUp:r,title:t,draggable:!1,children:g.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${_6}") center 100% / 100% no-repeat`,WebkitMask:`url("${_6}") center 100% / 100% no-repeat`}})})}const C6="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",dje=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function ww(t){return dje.map(n=>{const{offsetX:r,offsetY:i,blur:o,spread:s,color:a}=n,l=new T(r,i),{x:c,y:d}=l.rot(-t);return`${c}px ${d}px ${o}px ${s}px ${a}`}).join(", ")}const hje=300,NZ=320,pje=46,fje=101;class gje extends Rf{static type="bookmark";static props=_U;static migrations=CU;canResize(){return!1}hideSelectionBoundsFg(){return!0}getText(e){return e.props.url}getAriaDescriptor(e){const n=e.props.assetId?this.editor.getAsset(e.props.assetId):null;if(n?.props.title)return gZ(n.props.title)+(n.props.description?", "+n.props.description:"")}getDefaultProps(){return{url:"",w:hje,h:NZ,assetId:null}}component(e){return g.jsx(mje,{shape:e})}indicator(e){return g.jsx("rect",{width:ee(e.props.w),height:ee(e.props.h),rx:"6",ry:"6"})}onBeforeCreate(e){return P6(this.editor,e)}onBeforeUpdate(e,n){if(e.props.url!==n.props.url)if(Cs.isValid(n.props.url))vje(this.editor,n);else return{...n,props:{...n.props,url:e.props.url}};if(e.props.assetId!==n.props.assetId)return P6(this.editor,n)}getInterpolatedProps(e,n,r){return{...r>.5?n.props:e.props,w:St(e.props.w,n.props.w,r),h:St(e.props.h,n.props.h,r)}}}function mje({shape:t}){const e=ne(),n=t.props.assetId?e.getAsset(t.props.assetId):null,r=!!Jy()&&Jt.isSafari,i=e.getShapePageTransform(t).rotation(),o=yje(t),[s,a]=I.useState(!0),l=()=>a(!1),c=I.useCallback(d=>{e.inputs.shiftKey||e.markEventAsHandled(d)},[e]);return g.jsx(_u,{children:g.jsxs("div",{className:Ye("tl-bookmark__container",r&&"tl-bookmark__container--safariExport"),style:{boxShadow:r?void 0:ww(i),maxHeight:t.props.h},children:[(!n||n.props.image)&&g.jsxs("div",{className:"tl-bookmark__image_container",children:[n?g.jsx("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:n?.props.image,alt:n?.props.title||""}):g.jsx("div",{className:"tl-bookmark__placeholder"}),n?.props.image&&g.jsx(xf,{url:t.props.url})]}),g.jsxs("div",{className:"tl-bookmark__copy_container",children:[n?.props.title?g.jsx("a",{className:"tl-bookmark__link",href:t.props.url||"",target:"_blank",rel:"noopener noreferrer",draggable:!1,onPointerDown:c,onPointerUp:c,children:g.jsx("h2",{className:"tl-bookmark__heading",children:gZ(n.props.title)})}):null,n?.props.description&&n?.props.image?g.jsx("p",{className:"tl-bookmark__description",children:n.props.description}):null,g.jsxs("a",{className:"tl-bookmark__link",href:t.props.url||"",target:"_blank",rel:"noopener noreferrer",draggable:!1,onPointerDown:c,onPointerUp:c,children:[s&&n?.props.favicon?g.jsx("img",{className:"tl-bookmark__favicon",src:n?.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",onError:l,alt:`favicon of ${o}`}):g.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${C6}") center 100% / 100% no-repeat`,WebkitMask:`url("${C6}") center 100% / 100% no-repeat`}}),g.jsx("span",{children:o})]})]})]})})}function P6(t,e){const n=e.props.assetId?t.getAsset(e.props.assetId):null;let r=NZ;return n&&(n.props.image||(n.props.title?r=fje:r=pje)),{...e,props:{...e.props,h:r}}}const yje=t=>{try{return new URL(t.props.url).hostname.replace(/^www\./,"")}catch{return t.props.url}};function vje(t,e){const{url:n}=e.props,r=qu.createId(u2(n));t.getAsset(r)?e.props.assetId!==r&&t.updateShapes([{id:e.id,type:e.type,props:{assetId:r}}]):(t.updateShapes([{id:e.id,type:e.type,props:{assetId:null}}]),xje(t,e))}const xje=Lw(async(t,e)=>{if(t.isDisposed)return;const{url:n}=e.props,r=await t.getAssetForExternalContent({type:"url",url:n});r&&t.run(()=>{t.createAssets([r]),t.updateShapes([{id:e.id,type:e.type,props:{assetId:r.id}}])})},500);function My(t,e=!1){const n=t.length;if(n<2)return"";let r=t[0].point,i=t[1].point;if(n===2)return`M${mi(r)}L${mi(i)}`;let o="";for(let s=2,a=n-1;s<a;s++)r=t[s].point,i=t[s+1].point,o+=Wo(r,i);return e?`M${Wo(t[0].point,t[1].point)}Q${mi(t[1].point)}${Wo(t[1].point,t[2].point)}T${o}${Wo(t[n-1].point,t[0].point)}${Wo(t[0].point,t[1].point)}Z`:`M${mi(t[0].point)}Q${mi(t[1].point)}${Wo(t[1].point,t[2].point)}${t.length>3?"T":""}${o}L${mi(t[n-1].point)}`}function Sje(t,e={}){const{start:n={},end:r={}}=e,{cap:i=!0}=n,{cap:o=!0}=r;Ge(!n.taper&&!r.taper,"cap taper not supported here"),Ge(!n.easing&&!r.easing,"cap easing not supported here"),Ge(i&&o,"cap must be true");const s=Nu(t,e);XM(s,e);const a=bje(s);let l="";for(const c of a)l+=kje(c,e);return l}function bje(t){if(t.length<=2)return[t];const e=[];let n=[t[0]],r=T.Sub(t[1].point,t[0].point).uni(),i,o,s,a,l;for(let c=1,d=t.length;c<d-1;c++){if(s=t[c-1],a=t[c],l=t[c+1],i=T.Sub(l.point,a.point).uni(),o=T.Dpr(r,i),r=i,o<-.8){const u={...a,point:a.input};n.push(u),e.push(KP(n)),n=[u];continue}if(n.push(a),!(o>.7)&&(T.Dist2(s.point,a.point)+T.Dist2(a.point,l.point))/((s.radius+a.radius+l.radius)/3)**2<1.5){n.push(a),e.push(KP(n)),n=[a];continue}}return n.push(t[t.length-1]),e.push(KP(n)),e}function KP(t){const e=t[0];let n;for(;t.length>2&&(n=t[1],T.Dist2(e.point,n.point)<((e.radius+n.radius)/2*.5)**2);)t.splice(1,1);const r=t[t.length-1];let i;for(;t.length>2&&(i=t[t.length-2],T.Dist2(r.point,i.point)<((r.radius+i.radius)/2*.5)**2);)t.splice(t.length-2,1);return t.length>1&&(t[0]={...t[0],vector:T.Sub(t[0].point,t[1].point).uni()},t[t.length-1]={...t[t.length-1],vector:T.Sub(t[t.length-2].point,t[t.length-1].point).uni()}),t}function wje(t,e,n){return"M "+t+" "+e+" m -"+n+", 0 a "+n+","+n+" 0 1,1 "+n*2+",0 a "+n+","+n+" 0 1,1 -"+n*2+",0"}function kje(t,e={}){if(t.length===0)return"";if(t.length===1)return wje(t[0].point.x,t[0].point.y,t[0].radius);const{left:n,right:r}=GX(t,e);r.reverse();let i=`M${mi(n[0])}T`;for(let o=1;o<n.length;o++)i+=Wo(n[o-1],n[o]);{const o=t[t.length-1],s=o.radius,a=o.vector.clone().per().neg(),l=T.Add(o.point,T.Mul(a,s)),c=T.Add(o.point,T.Mul(a,-s));i+=`${mi(l)}A${ee(s)},${ee(s)} 0 0 1 ${mi(c)}T`}for(let o=1;o<r.length;o++)i+=Wo(r[o-1],r[o]);{const o=t[0],s=o.radius,a=o.vector.clone().per(),l=T.Add(o.point,T.Mul(a,s)),c=T.Add(o.point,T.Mul(a,-s));i+=`${mi(l)}A${ee(s)},${ee(s)} 0 0 1 ${mi(c)}Z`}return i}const LZ=(t,e,n)=>{const r=[],i=[];t.forEach(c=>r.push(...c.points)),e.forEach(c=>i.push(...c.points));const o=Math.max(r.length,i.length),s=[],a=[];for(let c=0;c<o;c++)s.push(r[c]||r[r.length-1]),a.push(i[c]||i[i.length-1]);return[{type:"free",points:s.map((c,d)=>{let u=.5;return a[d].z!==void 0&&c.z!==void 0&&(u=St(c.z,a[d].z,n)),{x:St(c.x,a[d].x,n),y:St(c.y,a[d].y,n),z:u}})}]},Ije=t=>t*.65+$ce(t*nn/2)*.35,_je=t=>({size:t,thinning:.5,streamline:Ha(t,[9,16],[.64,.74],!0),smoothing:.62,easing:Ui.easeOutSine,simulatePressure:!0}),Cje=t=>({size:1+t*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:Ije}),T6=t=>({size:t,thinning:0,streamline:Ha(t,[9,16],[.64,.74],!0),smoothing:.62,simulatePressure:!1,easing:Ui.linear}),Pje=t=>({size:t,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:Ui.linear});function gO({strokeWidth:t,showAsComplete:e}){return{size:1+t,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:Ui.easeOutSine,last:e}}function LE(t,e,n,r){const i=t.isComplete||n;return r?t.isPen?{...Pje(e),last:i}:{...T6(e),last:i}:t.dash==="draw"?t.isPen?{...Cje(e),last:i}:{..._je(e),last:i}:{...T6(e),last:i}}function Sf(t){const e=[];for(const n of t)if(n.type==="free"||n.points.length<2)e.push(...n.points.map(T.Cast));else{const r=Math.max(4,Math.floor(T.Dist(n.points[0],n.points[1])/16));e.push(...T.PointsBetween(n.points[0],n.points[1],r))}return e}function Tje(t,e,n){return{draw:"none",solid:"none",dotted:`${n} ${e*2}`,dashed:`${e*2} ${e*2}`}[t.props.dash]}class Eje extends Yu{static type="draw";static props=TU;static migrations=EU;options={maxPointsPerShape:600};hideResizeHandles(e){return qP(e)}hideRotateHandle(e){return qP(e)}hideSelectionBoundsFg(e){return qP(e)}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(e){const n=Sf(e.props.segments),r=(Br[e.props.size]+1)*e.props.scale;if(e.props.segments.length===1){const o=pe.FromPoints(n);if(o.width<r*2&&o.height<r*2)return new Sb({x:-r,y:-r,radius:r,isFilled:!0})}const i=Nu(n,LE(e.props,r,e.props.isPen,!0)).map(o=>o.point);return e.props.isClosed&&i.length>2?new ry({points:i,isFilled:e.props.fill!=="none"}):i.length===1?new Sb({x:-r,y:-r,radius:r,isFilled:!0}):new Zy({points:i})}component(e){return g.jsx(_l,{children:g.jsx(E6,{shape:e})})}indicator(e){const n=Sf(e.props.segments);let r=(Br[e.props.size]+1)*e.props.scale;!J("force solid",()=>{const c=this.editor.getZoomLevel();return c<.5&&c<1.5/r},[this.editor,r])&&!e.props.isPen&&e.props.dash==="draw"&&n.length===1&&(r+=xh(e.id)()*(r/6));const o=e.props.isComplete||gi(e.props.segments)?.type==="straight",s=LE(e.props,r,o,!0),a=Nu(n,s),l=a.length>1?My(a,e.props.isClosed):zZ(n[0],r);return g.jsx("path",{d:l})}toSvg(e,n){n.addExportDef(hO(e.props.fill));const r=1/e.props.scale;return g.jsx("g",{transform:`scale(${r})`,children:g.jsx(E6,{shape:e,zoomOverride:1})})}getCanvasSvgDefs(){return[pO()]}onResize(e,n){const{scaleX:r,scaleY:i}=n,o=[];for(const s of e.props.segments)o.push({...s,points:s.points.map(({x:a,y:l,z:c})=>({x:Da(r*a),y:Da(i*l),z:c}))});return{props:{segments:o}}}expandSelectionOutlinePx(e){const n=e.props.dash==="draw"?1.6:1;return Br[e.props.size]*n/2*e.props.scale}getInterpolatedProps(e,n,r){return{...r>.5?n.props:e.props,segments:LZ(e.props.segments,n.props.segments,r),scale:St(e.props.scale,n.props.scale,r)}}}function zZ(t,e){const n=(e+1)*.5;return`M ${t.x} ${t.y} m -${n}, 0 a ${n},${n} 0 1,0 ${n*2},0 a ${n},${n} 0 1,0 -${n*2},0`}function qP(t){return t.props.segments.length===1&&t.props.segments[0].points.length<2}function E6({shape:t,zoomOverride:e}){const n=ga(),r=ne(),i=Sf(t.props.segments),o=t.props.isComplete||gi(t.props.segments)?.type==="straight";let s=(Br[t.props.size]+1)*t.props.scale;const a=J("force solid",()=>{const f=e??r.getZoomLevel();return f<.5&&f<1.5/s},[r,s,e]),l=J("dot adjustment",()=>(e??r.getZoomLevel())<.2?0:.1,[r,e]);!a&&!t.props.isPen&&t.props.dash==="draw"&&i.length===1&&(s+=xh(t.id)()*(s/6));const c=LE(t.props,s,o,a);if(!a&&t.props.dash==="draw")return g.jsxs(g.Fragment,{children:[t.props.isClosed&&t.props.fill&&i.length>1?g.jsx(Ay,{d:My(Nu(i,c),t.props.isClosed),theme:n,color:t.props.color,fill:t.props.isClosed?t.props.fill:"none",scale:t.props.scale}):null,g.jsx("path",{d:Sje(i,c),strokeLinecap:"round",fill:Ht(n,t.props.color,"solid")})]});const d=Nu(i,c),u=d.length<2,p=u?zZ(i[0],0):My(d,t.props.isClosed);return g.jsxs(g.Fragment,{children:[g.jsx(Ay,{d:p,theme:n,color:t.props.color,fill:u||t.props.isClosed?t.props.fill:"none",scale:t.props.scale}),g.jsx("path",{d:p,strokeLinecap:"round",fill:u?Ht(n,t.props.color,"solid"):"none",stroke:Ht(n,t.props.color,"solid"),strokeWidth:s,strokeDasharray:u?"none":Tje(t,s,l),strokeDashoffset:"0"})]})}function Aje(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function Mje(t,e){const n=ht(e);if(!n)return;const r=n.host.replace("www.","");for(const i of t)if(FZ(i.hostnames,r)){const o=i.fromEmbedUrl(e);if(o)return{definition:i,url:o,embedUrl:e}}}const Oje=t=>t.split("*").map(e=>Aje(e)).join(".+"),FZ=(t,e)=>!!t.find(n=>{const r=new RegExp(Oje(n));return e.match(r)});function Dje(t,e){const n=ht(e);if(!n)return;const r=n.host.replace("www.","");for(const i of t)if(FZ(i.hostnames,r)){const o=i.toEmbedUrl(e);if(o)return{definition:i,embedUrl:o,url:e}}}function jje(t,e){try{return Dje(t,e)??Mje(t,e)}catch{return}}const Rje=t=>Object.entries(t).filter(([e,n])=>n).map(([e])=>e).join(" ");class ef extends Rf{static type="embed";static props=AU;static migrations=MU;static embedDefinitions=RM;static setEmbedDefinitions(e){ef.embedDefinitions=e}getEmbedDefinitions(){return ef.embedDefinitions}getEmbedDefinition(e){return jje(ef.embedDefinitions,e)}getText(e){return e.props.url}getAriaDescriptor(e){return this.getEmbedDefinition(e.props.url)?.definition.title}hideSelectionBoundsFg(e){return!this.canResize(e)}canEdit(){return!0}canResize(e){return!!this.getEmbedDefinition(e.props.url)?.definition?.doesResize}canEditInReadonly(){return!0}getDefaultProps(){return{w:300,h:300,url:""}}isAspectRatioLocked(e){return this.getEmbedDefinition(e.props.url)?.definition.isAspectRatioLocked??!1}onResize(e,n){const r=this.isAspectRatioLocked(e),i=this.getEmbedDefinition(e.props.url);let o=i?.definition.minWidth??200,s=i?.definition.minHeight??200;if(r){const a=e.props.w/e.props.h;a>1?o*=a:s/=a}return m0(e,n,{minWidth:o,minHeight:s})}component(e){const n=Jy(),{w:r,h:i,url:o}=e.props,s=iv(e.id),a=this.getEmbedDefinition(o),l=J("is hovering",()=>{const{editingShapeId:f,hoveredShapeId:y}=this.editor.getCurrentPageState();if(f&&y!==f){const v=this.editor.getShape(f);if(v&&this.editor.isShapeOfType(v,"embed"))return!0}return!1},[]),c=this.editor.getShapePageTransform(e).rotation();if(n)return g.jsx(_u,{className:"tl-embed-container",id:e.id,children:g.jsx("div",{className:"tl-embed",style:{border:0,boxShadow:ww(c),borderRadius:a?.definition.overrideOutlineRadius??8,background:a?.definition.backgroundColor??"var(--tl-color-background)",width:r,height:i}})});const d=s||l;if(typeof window<"u"&&(window!==window.top||window.self!==window.parent)&&a?.definition.type==="tldraw")return null;if(a?.definition.type==="github_gist"){const f=a.url.split("/").pop();if(!f)throw Error("No gist id!");return g.jsx(_u,{className:"tl-embed-container",id:e.id,children:g.jsx($je,{id:f,width:ee(r),height:ee(i),isInteractive:d,pageRotation:c})})}const p=Rje({...iCe,...a?.definition.overridePermissions??{}});return g.jsx(_u,{className:"tl-embed-container",id:e.id,children:a?.definition?g.jsx("iframe",{className:"tl-embed",sandbox:p,src:a.embedUrl,width:ee(r),height:ee(i),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",tabIndex:s?0:-1,style:{border:0,pointerEvents:d?"auto":"none",zIndex:d?"":"-1",boxShadow:ww(c),borderRadius:a?.definition.overrideOutlineRadius??8,background:a?.definition.backgroundColor}}):null})}indicator(e){const n=this.getEmbedDefinition(e.props.url);return g.jsx("rect",{width:ee(e.props.w),height:ee(e.props.h),rx:n?.definition.overrideOutlineRadius??8,ry:n?.definition.overrideOutlineRadius??8})}getInterpolatedProps(e,n,r){return{...r>.5?n.props:e.props,w:St(e.props.w,n.props.w,r),h:St(e.props.h,n.props.h,r)}}}function $je({id:t,isInteractive:e,width:n,height:r,style:i,pageRotation:o}){if(!t.match(/^[0-9a-f]+$/))throw Error("No gist id!");return g.jsx("iframe",{className:"tl-embed",draggable:!1,width:ee(n),height:ee(r),frameBorder:"0",scrolling:"no",referrerPolicy:"no-referrer-when-downgrade",tabIndex:e?0:-1,style:{...i,pointerEvents:e?"all":"none",zIndex:e?"":"-1",boxShadow:ww(o)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${t}.js`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}function Nje(t){return t.replace(/\s/g," ")}function Lje(t,e,n){const{padding:r=0}=n;if(e.length===0)return null;const i=pe.From(e[0].box);for(const{box:c}of e)i.union(c);const o=r+(n.offsetX??0),s=(n.offsetY??0)+n.fontSize/2+(n.verticalTextAlign==="start"?r:n.verticalTextAlign==="end"?n.height-r-i.height:(Math.ceil(n.height)-i.height)/2);let a=null;const l=[];for(const{text:c,box:d}of e)a!==null&&d.y>a&&l.push(g.jsx("tspan",{alignmentBaseline:"mathematical",x:o,y:d.y+s,children:`
`},l.length)),l.push(g.jsx("tspan",{alignmentBaseline:"mathematical",x:d.x+o,y:d.y+s,unicodeBidi:"plaintext",children:Nje(c)},l.length)),a=d.y;return g.jsx("text",{fontSize:n.fontSize,fontFamily:n.fontFamily,fontStyle:n.fontStyle,fontWeight:n.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:n.stroke,strokeWidth:n.strokeWidth,fill:n.fill,children:l})}function zE(t,e){const i=((hb(t.getShapePageTransform(e.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4;return Math.floor(i)}const A6=new WeakMap;function M6(t,e,n){let r=A6.get(e.props);if(!r){const i=mO(e.props.name,"Frame")+"​",o=t.textMeasure.measureTextSpans(i,n),s=o[0],a=gi(o);r=a.box.w+a.box.x-s.box.x,A6.set(e.props,r)}return new pe(0,-n.height,r,n.height)}function O6(t,e){return{fontSize:12,fontFamily:e?"Arial":"Inter, sans-serif",textAlign:"start",width:t,height:24,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle",offsetY:-34,offsetX:0}}function BZ(t,e,n){const r=n?"":"px",i=n?"":"deg";let o;switch(e){case 0:o="";break;case 3:o=`translate(${ee(t.props.w)}${r}, 0${r}) rotate(90${i})`;break;case 2:o=`translate(${ee(t.props.w)}${r}, ${ee(t.props.h)}${r}) rotate(180${i})`;break;case 1:o=`translate(0${r}, ${ee(t.props.h)}${r}) rotate(270${i})`;break;default:throw Error("labelSide out of bounds")}return o}const zje=I.forwardRef(({id:t,name:e,isEditing:n},r)=>{const i=ne(),o=I.useCallback(c=>{n&&i.markEventAsHandled(c)},[i,n]),s=I.useCallback(c=>{c.key==="Enter"&&!c.nativeEvent.isComposing&&(i.markEventAsHandled(c),c.currentTarget.blur(),i.setEditingShape(null))},[i]),a=I.useCallback(c=>{const d=i.getShape(t);if(!d)return;const u=d.props.name,p=c.currentTarget.value.trim();u!==p&&i.updateShapes([{id:t,type:"frame",props:{name:p}}])},[t,i]),l=I.useCallback(c=>{const d=i.getShape(t);if(!d)return;const u=d.props.name,p=c.currentTarget.value;u!==p&&i.updateShapes([{id:t,type:"frame",props:{name:p}}])},[t,i]);return g.jsxs("div",{className:`tl-frame-label ${n?"tl-frame-label__editing":""}`,children:[g.jsx("input",{className:"tl-frame-name-input",ref:r,disabled:!n,readOnly:!n,style:{display:n?void 0:"none"},value:e,autoFocus:!0,onKeyDown:s,onBlur:a,onChange:l,onPointerDown:o,draggable:!1}),mO(e,"Frame")+"​"]})}),Fje=I.memo(function({id:e,name:n,width:r,height:i,fill:o,stroke:s,color:a,offsetX:l,showColors:c}){const d=ne(),{side:u,translation:p}=J("shape rotation",()=>{const v=d.getShape(e);if(!v)return{side:0,translation:"translate(0, 0)"};const x=zE(d,v);return{side:x,translation:BZ(v,x,!1)}},[d,l,e]),f=I.useRef(null),y=iv(e);return I.useEffect(()=>{const v=f.current;v&&y&&(v.focus(),v.select())},[f,y]),g.jsx("div",{className:"tl-frame-heading",style:{overflow:y?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(u===0||u===2?r:i)}px + ${c?"0px":"var(--tl-frame-offset-width)"})`,bottom:"100%",transform:`${p} scale(var(--tl-scale)) translateX(${l}px)`},children:g.jsx("div",{className:"tl-frame-heading-hit-area",style:{color:a,backgroundColor:o,boxShadow:`inset 0px 0px 0px 1px ${s}`},children:g.jsx(zje,{ref:f,id:e,name:n,isEditing:y})})})}),Bje=12,Uje=32,Hje=-7,Wje=4;function mO(t,e){return t.match(/^\s*$/)?e:t}class Vje extends Rf{static type="frame";static props=OU;static migrations=DU;options={showColors:!1};static configure(e){const n=super.configure.call(this,e);return e.showColors&&(n.props={...n.props,color:vo}),n}canEdit(){return!0}canResize(){return!0}canResizeChildren(){return!1}isExportBoundsContainer(){return!0}getDefaultProps(){return{w:320,h:180,name:"",color:"black"}}getAriaDescriptor(e){return e.props.name}getGeometry(e){const{editor:n}=this,r=n.getZoomLevel(),i=zE(n,e),o=i%2===1,s=o?e.props.h:e.props.w,a=O6(s,!1),l=M6(n,e,a),c=this.options.showColors,d=Bje/r,u=Uje/r,p=s+(c?1:d),f=l.w/r,y=l.h/r,v=pt(f+d,u,p),x=(c?-1:Hje)/r,b=Wje/r,w=o?y:v,_=o?v:y;let C,A;switch(i){case 0:{C=x,A=-(y+b);break}case 1:{C=-(y+b),A=e.props.h-(x+v);break}case 2:{C=e.props.w-(x+v),A=e.props.h+b;break}case 3:{C=e.props.w+b,A=x;break}}return new Zo({children:[new Cl({width:e.props.w,height:e.props.h,isFilled:!1}),new Cl({x:C,y:A,width:w,height:_,isFilled:!0,isLabel:!0,excludeFromShapeBounds:!0})]})}getText(e){return e.props.name}component(e){const n=ga(),r=J("is creating this shape",()=>{const u=this.editor.getStateDescendant("select.resizing");if(!u||!u.getIsActive())return!1;const p=u?.info;return p?p.isCreating&&this.editor.getOnlySelectedShapeId()===e.id:!1},[e.id]),i=this.options.showColors,o=i?e.props.color:"black",s=Ht(n,o,"frameFill"),a=Ht(n,o,"frameStroke"),l=i?Ht(n,o,"frameHeadingStroke"):n.background,c=i?Ht(n,o,"frameHeadingFill"):n.background,d=Ht(n,o,"frameText");return g.jsxs(g.Fragment,{children:[g.jsx(_l,{children:g.jsx("rect",{className:Ye("tl-frame__body",{"tl-frame__creating":r}),fill:s,stroke:a,style:{width:`calc(${e.props.w}px + 1px / var(--tl-zoom))`,height:`calc(${e.props.h}px + 1px / var(--tl-zoom))`,transform:"translate(calc(-0.5px / var(--tl-zoom)), calc(-0.5px / var(--tl-zoom)))"}})}),r?null:g.jsx(Fje,{id:e.id,name:e.props.name,fill:c,stroke:l,color:d,width:e.props.w,height:e.props.h,offsetX:i?-1:-7,showColors:this.options.showColors})]})}toSvg(e,n){const r=Ku({isDarkMode:n.isDarkMode}),i=zE(this.editor,e),s=i%2===1?e.props.h:e.props.w,a=BZ(e,i,!0),l=O6(s-12,!0),c=mO(e.props.name,"Frame")+"​",d=M6(this.editor,e,l),u=this.editor.textMeasure.measureTextSpans(c,l),p=Lje(this.editor,u,l),f=this.options.showColors,y=f?e.props.color:"black",v=Ht(r,y,"frameFill"),x=Ht(r,y,"frameStroke"),b=f?Ht(r,y,"frameHeadingStroke"):r.background,w=f?Ht(r,y,"frameHeadingFill"):r.background,_=Ht(r,y,"frameText");return g.jsxs(g.Fragment,{children:[g.jsx("rect",{width:e.props.w,height:e.props.h,fill:v,stroke:x,strokeWidth:1,x:0,rx:0,ry:0}),g.jsxs("g",{fill:_,transform:a,children:[g.jsx("rect",{x:d.x-(f?0:6),y:d.y-6,width:Math.min(s,d.width+12),height:d.height,fill:w,stroke:b,rx:4,ry:4}),g.jsx("g",{transform:`translate(${f?8:0}, 4)`,children:p})]})]})}indicator(e){return g.jsx("rect",{width:ee(e.props.w),height:ee(e.props.h),className:"tl-frame-indicator"})}providesBackgroundForChildren(){return!0}getClipPath(e){return this.editor.getShapeGeometry(e.id).vertices}canReceiveNewChildrenOfType(e){return!e.isLocked}onResize(e,n){return m0(e,n)}getInterpolatedProps(e,n,r){return{...r>.5?n.props:e.props,w:St(e.props.w,n.props.w,r),h:St(e.props.h,n.props.h,r)}}onDoubleClickEdge(e,n){if(n.target!=="selection")return;const{handle:r}=n;if(!r)return;const i=r==="left"||r==="right",o=r==="top"||r==="bottom",s=this.editor.getSortedChildIdsForParent(e.id),a=ut(s.map(p=>this.editor.getShape(p)));if(!a.length)return;const{dx:l,dy:c,w:d,h:u}=ZV(a,this.editor,{padding:10});return this.editor.run(()=>{const p=s.map(f=>{const y=this.editor.getShape(f);return{id:y.id,type:y.type,x:i?y.x+l:y.x,y:o?y.y+c:y.y}});this.editor.updateShapes(p)}),{id:e.id,type:e.type,props:{w:i?d:e.props.w,h:o?u:e.props.h}}}onDoubleClickCorner(e){return JV(this.editor,e.id,{padding:10}),{id:e.id,type:e.type}}onDragShapesIn(e,n,{initialParentIds:r,initialIndices:i}){const{editor:o}=this;if(n.every(l=>l.parentId===e.id))return;let s=!1;const a=n.filter(l=>e.id===r.get(l.id));if(a.length>0){const l=ut(o.getSortedChildIdsForParent(e).map(c=>o.getShape(c)));a.every(c=>!l.find(d=>d.index===c.index))&&(s=!0)}if(!n.some(l=>o.hasAncestor(e,l.id))&&(o.reparentShapes(n,e.id),s))for(const l of a)o.updateShape({id:l.id,type:l.type,index:i.get(l.id)})}onDragShapesOut(e,n,r){const{editor:i}=this;r.nextDraggingOverShapeId||i.reparentShapes(n.filter(o=>o.parentId===e.id&&this.canReceiveNewChildrenOfType(o)),i.getCurrentPageId())}}const Kje=new ki;function FE(t){return Kje.get(t,qje)}function qje(t){const e=Math.max(1,t.props.w),n=Math.max(1,t.props.h+t.props.growY),r=e/2,i=n/2,o=xs[t.props.size]*t.props.scale,s=t.props.fill!=="none";switch(t.props.geo){case"arrow-down":{const a=e*.16,l=Math.min(e,n)*.38;return new Zt().moveTo(a,0,{geometry:{isFilled:s}}).lineTo(e-a,0).lineTo(e-a,n-l).lineTo(e,n-l).lineTo(e/2,n).lineTo(0,n-l).lineTo(a,n-l).close()}case"arrow-left":{const a=Math.min(e,n)*.38,l=n*.16;return new Zt().moveTo(a,0,{geometry:{isFilled:s}}).lineTo(a,l).lineTo(e,l).lineTo(e,n-l).lineTo(a,n-l).lineTo(a,n).lineTo(0,n/2).close()}case"arrow-right":{const a=Math.min(e,n)*.38,l=n*.16;return new Zt().moveTo(0,l,{geometry:{isFilled:s}}).lineTo(e-a,l).lineTo(e-a,0).lineTo(e,n/2).lineTo(e-a,n).lineTo(e-a,n-l).lineTo(0,n-l).close()}case"arrow-up":{const a=e*.16,l=Math.min(e,n)*.38;return new Zt().moveTo(e/2,0,{geometry:{isFilled:s}}).lineTo(e,l).lineTo(e-a,l).lineTo(e-a,n).lineTo(a,n).lineTo(a,l).lineTo(0,l).close()}case"check-box":{const a=Math.min(e,n)*.82,l=(e-a)/2,c=(n-a)/2;return new Zt().moveTo(0,0,{geometry:{isFilled:s}}).lineTo(e,0).lineTo(e,n).lineTo(0,n).close().moveTo(pt(l+a*.25,0,e),pt(c+a*.52,0,n),{geometry:{isInternal:!0,isFilled:!1},offset:0}).lineTo(pt(l+a*.45,0,e),pt(c+a*.82,0,n)).lineTo(pt(l+a*.82,0,e),pt(c+a*.22,0,n),{offset:0})}case"diamond":return new Zt().moveTo(r,0,{geometry:{isFilled:s}}).lineTo(e,i).lineTo(r,n).lineTo(0,i).close();case"ellipse":return new Zt().moveTo(0,i,{geometry:{isFilled:s}}).arcTo(r,i,!1,!0,0,e,i).arcTo(r,i,!1,!0,0,0,i).close();case"heart":{const a=e/4,l=n/4;return new Zt().moveTo(r,n,{geometry:{isFilled:s}}).cubicBezierTo(0,l*1.2,a*1.5,l*3,0,l*2.5).cubicBezierTo(r,l*.9,0,-l*.32,a*1.85,-l*.32).cubicBezierTo(e,l*1.2,a*2.15,-l*.32,e,-l*.32).cubicBezierTo(r,n,e,l*2.5,a*2.5,l*3).close()}case"hexagon":return Zt.lineThroughPoints(DC(e,n,6),{geometry:{isFilled:s}}).close();case"octagon":return Zt.lineThroughPoints(DC(e,n,8),{geometry:{isFilled:s}}).close();case"oval":return Yje(e,n,s);case"pentagon":return Zt.lineThroughPoints(DC(e,n,5),{geometry:{isFilled:s}}).close();case"rectangle":return new Zt().moveTo(0,0,{geometry:{isFilled:s}}).lineTo(e,0).lineTo(e,n).lineTo(0,n).close();case"rhombus":{const a=Math.min(e*.38,n*.38);return new Zt().moveTo(a,0,{geometry:{isFilled:s}}).lineTo(e,0).lineTo(e-a,n).lineTo(0,n).close()}case"rhombus-2":{const a=Math.min(e*.38,n*.38);return new Zt().moveTo(0,0,{geometry:{isFilled:s}}).lineTo(e-a,0).lineTo(e,n).lineTo(a,n).close()}case"star":return Xje(e,n,s);case"trapezoid":{const a=Math.min(e*.38,n*.38);return new Zt().moveTo(a,0,{geometry:{isFilled:s}}).lineTo(e-a,0).lineTo(e,n).lineTo(0,n).close()}case"triangle":return new Zt().moveTo(r,0,{geometry:{isFilled:s}}).lineTo(e,n).lineTo(0,n).close();case"x-box":return Gje(e,n,o,t.props.dash,s);case"cloud":return eRe(e,n,t.id,t.props.size,t.props.scale,s);default:Wt(t.props.geo)}}function Gje(t,e,n,r,i){const o=t/2,s=e/2,a=new Zt().moveTo(0,0,{geometry:{isFilled:i}}).lineTo(t,0).lineTo(t,e).lineTo(0,e).close();if(r==="dashed"||r==="dotted")return a.moveTo(0,0,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(o,s).moveTo(t,e,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(o,s).moveTo(0,e,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(o,s).moveTo(t,0,{geometry:{isInternal:!0,isFilled:!1},dashStart:"skip",dashEnd:"outset"}).lineTo(o,s);const l=r==="draw"?.62:0;return a.moveTo(pt(n*l,0,t),pt(n*l,0,e),{geometry:{isInternal:!0,isFilled:!1}}).lineTo(pt(t-n*l,0,t),pt(e-n*l,0,e)).moveTo(pt(t-n*l,0,t),pt(n*l,0,e)).lineTo(pt(n*l,0,t),pt(e-n*l,0,e)),a}function Yje(t,e,n){if(e>t){const i=t/2;return new Zt().moveTo(0,i,{geometry:{isFilled:n}}).arcTo(i,i,!1,!0,0,t,i).lineTo(t,e-i).arcTo(i,i,!1,!0,0,0,e-i).close()}const r=e/2;return new Zt().moveTo(r,e,{geometry:{isFilled:n}}).arcTo(r,r,!1,!0,0,r,0).lineTo(t-r,0).arcTo(r,r,!1,!0,0,t-r,e).close()}function Xje(t,e,n){const i=Sn/5/2,o=Math.floor(5/4)*2,s=10-o,a=0,l=Math.floor(5/2)*2,c=Math.cos(-br+o*i)*t/2,d=Math.cos(-br+s*i)*t/2,u=Math.sin(-br+a*i)*e/2,p=Math.sin(-br+l*i)*e/2,f=t-Math.abs(c-d),y=e-Math.abs(p-u),v=t/2+d-(t/2-c),x=e/2+u-(e/2-p),b=1,w=(t-v)/2,_=(e-x)/2,C=(t+f)/2,A=(e+y)/2,E=C*b/2,O=A*b/2;return Zt.lineThroughPoints(Array.from(Array(10),(D,B)=>{const L=-br+B*i;return new T(w+(B%2?E:C)*Math.cos(L),_+(B%2?O:A)*Math.sin(L))}),{geometry:{isFilled:n}}).close()}function D6(t,e){return t>e?(nn*(e/2)+(t-e))*2:(nn*(t/2)+(e-t))*2}function Zje(t,e,n){const r=Math.min(t,e)/2,i=Math.max(t,e)-r*2,s=(Math.PI*(r*2)+2*i)/n,a=t>e?[{type:"straight",start:new T(r,0),delta:new T(1,0)},{type:"arc",center:new T(t-r,r),startAngle:-nn/2},{type:"straight",start:new T(t-r,e),delta:new T(-1,0)},{type:"arc",center:new T(r,r),startAngle:nn/2}]:[{type:"straight",start:new T(t,r),delta:new T(0,1)},{type:"arc",center:new T(r,e-r),startAngle:0},{type:"straight",start:new T(0,e-r),delta:new T(0,-1)},{type:"arc",center:new T(r,r),startAngle:nn}];let l=0;const c=[];for(let d=0;d<n;d++){const u=a[0];u.type==="straight"?c.push(T.Add(u.start,T.Mul(u.delta,l))):c.push(X2(u.center,r,u.startAngle+l/r)),l+=s;let p=u.type==="straight"?i:nn*r;for(;l>p;)l-=p,a.push(a.shift()),p=a[0].type==="straight"?i:nn*r}return c}const Jje={s:50,m:70,l:100,xl:130},Qje=.2;function eRe(t,e,n,r,i,o){const s=new Zt,a=xh(n),l=D6(t,e),c=Math.max(Math.ceil(l/Jje[r]),6,Math.ceil(l/Math.min(t,e))),d=l/c*Qje,u=Math.max(t-d*2,1),p=Math.max(e-d*2,1),y=D6(u,p)/c,v=(t-u)/2,x=(e-p)/2,b=Zje(u,p,c).map(A=>A.addXY(v,x)),w=t<20?0:d*.3,_=e<20?0:d*.3,C=b.slice(0);for(let A=0;A<Math.floor(c/2);A++)C[A]=T.AddXY(C[A],a()*w*i,a()*_*i),C[c-A-1]=T.AddXY(C[c-A-1],a()*w*i,a()*_*i);for(let A=0;A<C.length;A++){const E=A===C.length-1?0:A+1,O=C[A],D=C[E],B=b[A],L=b[E],j=T.Dist(B,L),F=y-j,$=T.Dist(O,D)/j,V=(Math.max(v,x)+F)*$,Y=T.Lrp(B,L,.5).add(T.Sub(L,B).uni().per().mul(V));Y.x<0?Y.x=0:Y.x>t&&(Y.x=t),Y.y<0?Y.y=0:Y.y>e&&(Y.y=e);const re=ZU(O,D,Y),q=T.Dist(re||T.Average([O,D]),O);A===0&&s.moveTo(O.x,O.y,{geometry:{isFilled:o}}),s.circularArcTo(q,!1,!0,D.x,D.y)}return s.close()}function j6({shape:t,shouldScale:e,forceSolid:n}){const r=e?t.props.scale:1,i=ga(),{props:o}=t,{color:s,fill:a,dash:l,size:c}=o,d=Br[c]*r,u=FE(t),p=l==="draw"&&!n?u.toDrawD({strokeWidth:d,randomSeed:t.id,passes:1,offset:0,onlyFilled:!0}):u.toD({onlyFilled:!0});return g.jsxs(g.Fragment,{children:[g.jsx(Ay,{theme:i,d:p,color:s,fill:a,scale:r}),u.toSvg({style:l,strokeWidth:d,forceSolid:n,randomSeed:t.id,props:{fill:"none",stroke:Ht(i,s,"solid")}})]})}const R6=51;class tRe extends Rf{static type="geo";static props=jU;static migrations=RU;canEdit(){return!0}getDefaultProps(){return{w:100,h:100,geo:"rectangle",dash:"draw",growY:0,url:"",scale:1,color:"black",labelColor:"black",fill:"none",size:"m",font:"draw",align:"middle",verticalAlign:"middle",richText:dn("")}}getGeometry(e){const n=Math.max(1,e.props.w),r=Math.max(1,e.props.h+e.props.growY),i=FE(e),o=wS(this.editor,e),s=n/e.props.scale,a=r/e.props.scale,l=Math.min(100,s/2),c=Math.min(Eu[e.props.size]*Vi.lineHeight+po*2,a/2),d=Math.min(s,Math.max(o.w,Math.min(l,Math.max(1,s-8)))),u=Math.min(a,Math.max(o.h,Math.min(c,Math.max(1,a-8))));return new Zo({children:[i.toGeometry(),new Cl({x:e.props.align==="start"?0:e.props.align==="end"?(s-d)*e.props.scale:(s-d)/2*e.props.scale,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?(a-u)*e.props.scale:(a-u)/2*e.props.scale,width:d*e.props.scale,height:u*e.props.scale,isFilled:!0,isLabel:!0,excludeFromShapeBounds:!0,isEmptyLabel:lr(e.props.richText)})]})}getHandleSnapGeometry(e){const n=this.getGeometry(e),r=n.children[0];switch(e.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:r,points:[...r.vertices,n.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:r,points:[n.bounds.center]};default:Wt(e.props.geo)}}getText(e){return Lu(this.editor,e.props.richText)}getFontFaces(e){return lr(e.props.richText)?ur:j0(this.editor,e.props.richText,{family:`tldraw_${e.props.font}`,weight:"normal",style:"normal"})}component(e){const{id:n,type:r,props:i}=e,{fill:o,font:s,align:a,verticalAlign:l,size:c,richText:d}=i,u=ga(),{editor:p}=this,f=J("isGeoOnlySelected",()=>e.id===p.getOnlySelectedShapeId(),[p]),y=dO(p,e.id),v=lr(e.props.richText),x=y||!v,b=J("force solid",()=>p.getZoomLevel()<.2,[p]);return g.jsxs(g.Fragment,{children:[g.jsx(_l,{children:g.jsx(j6,{shape:e,shouldScale:!0,forceSolid:b})}),x&&g.jsx(_u,{style:{overflow:"hidden",width:e.props.w,height:e.props.h+i.growY},children:g.jsx(w1,{shapeId:n,type:r,font:s,fontSize:Eu[c]*e.props.scale,lineHeight:Vi.lineHeight,padding:po*e.props.scale,fill:o,align:a,verticalAlign:l,richText:d,isSelected:f,labelColor:Ht(u,i.labelColor,"solid"),wrap:!0})}),e.props.url&&g.jsx(xf,{url:e.props.url})]})}indicator(e){const n=J("isZoomedOut",()=>this.editor.getZoomLevel()<.25,[this.editor]),{size:r,dash:i,scale:o}=e.props,s=Br[r];return FE(e).toSvg({style:i==="draw"?"draw":"solid",strokeWidth:1,passes:1,randomSeed:e.id,offset:0,roundness:s*2*o,props:{strokeWidth:void 0},forceSolid:n})}toSvg(e,n){const r=e.props.scale,i={...e,props:{...e.props,w:e.props.w/r,h:(e.props.h+e.props.growY)/r,growY:0}},o=i.props;n.addExportDef(hO(o.fill));let s;if(!lr(o.richText)){const a=Ku(n),l=new pe(0,0,o.w,(e.props.h+e.props.growY)/r);s=g.jsx(k1,{fontSize:Eu[o.size],font:o.font,align:o.align,verticalAlign:o.verticalAlign,richText:o.richText,labelColor:Ht(a,o.labelColor,"solid"),bounds:l,padding:po})}return g.jsxs(g.Fragment,{children:[g.jsx(j6,{shouldScale:!1,shape:i,forceSolid:!1}),s]})}getCanvasSvgDefs(){return[pO()]}onResize(e,{handle:n,newPoint:r,scaleX:i,scaleY:o,initialShape:s}){const a=s.props.w/s.props.scale,l=s.props.h/s.props.scale,c=s.props.growY/s.props.scale;let d=a*i,u=(l+c)*o,p=0,f=0;const y=R6;if(!lr(e.props.richText)){let C=Math.max(Math.abs(d),y),A=Math.max(Math.abs(u),y);C<y&&A===y&&(C=y),C===y&&A<y&&(A=y);const E=wS(this.editor,{...e,props:{...e.props,w:C*e.props.scale,h:A*e.props.scale}}),O=Math.max(Math.abs(d),E.w)*Math.sign(d),D=Math.max(Math.abs(u),E.h)*Math.sign(u);p=Math.abs(O)-Math.abs(d),f=Math.abs(D)-Math.abs(u),d=O,u=D}const v=d*e.props.scale,x=u*e.props.scale,b=new T(0,0);i<0&&(b.x+=v),(n==="left"||n==="top_left"||n==="bottom_left")&&(b.x+=i<0?p:-p),o<0&&(b.y+=x),(n==="top"||n==="top_left"||n==="top_right")&&(b.y+=o<0?f:-f);const{x:w,y:_}=b.rot(e.rotation).add(r);return{x:w,y:_,props:{w:Math.max(Math.abs(v),1),h:Math.max(Math.abs(x),1),growY:0}}}onBeforeCreate(e){if(lr(e.props.richText))return e.props.growY?{...e,props:{...e.props,growY:0}}:void 0;const n=e.props.h/e.props.scale,r=wS(this.editor,e).h;let i=null;if(r>n?i=r-n:e.props.growY&&(i=0),i!==null)return{...e,props:{...e.props,growY:i*e.props.scale}}}onBeforeUpdate(e,n){if(Bu(e.props.richText,n.props.richText)&&e.props.font===n.props.font&&e.props.size===n.props.size)return;const r=lr(e.props.richText),i=lr(n.props.richText);if(!r&&i)return{...n,props:{...n.props,growY:0}};const o=e.props.w/e.props.scale,s=e.props.h/e.props.scale,a=e.props.growY/e.props.scale,l=wS(this.editor,n);if(r&&!i&&Lu(this.editor,n.props.richText)){let d=Math.max(o,l.w),u=Math.max(s,l.h);const p=R6;return o<p&&s<p&&(d=Math.max(d,p),u=Math.max(u,p),d=Math.max(d,u),u=Math.max(d,u)),{...n,props:{...n.props,w:d*n.props.scale,h:u*n.props.scale,growY:0}}}let c=null;if(l.h>s?c=l.h-s:a&&(c=0),c!==null){const d=n.props.w/n.props.scale;return{...n,props:{...n.props,growY:c*n.props.scale,w:Math.max(d,l.w)*n.props.scale}}}if(l.w>o)return{...n,props:{...n.props,w:l.w*n.props.scale}}}onDoubleClick(e){if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return{...e,props:{geo:"check-box"}};case"check-box":return{...e,props:{geo:"rectangle"}}}}getInterpolatedProps(e,n,r){return{...r>.5?n.props:e.props,w:St(e.props.w,n.props.w,r),h:St(e.props.h,n.props.h,r),scale:St(e.props.scale,n.props.scale,r)}}}const nRe={s:12,m:14,l:16,xl:20},rRe={s:2,m:3.5,l:5,xl:10};function wS(t,e){const{richText:n,font:r,size:i,w:o}=e.props;if(!n||lr(n))return{w:0,h:0};const s=nRe[i],a=Ty(t,n),l=t.textMeasure.measureHtml(a,{...Vi,fontFamily:bc[r],fontSize:Eu[i],minWidth:s,maxWidth:Math.max(0,Math.ceil(s+rRe[i]),Math.ceil(o/e.props.scale-po*2))});return{w:l.w+po*2,h:l.h+po*2}}function iRe(){const[t,e]=I.useState(!1);return I.useEffect(()=>{const r=CSS.supports("color","color(display-p3 1 1 1)"),i=matchMedia("(color-gamut: p3)");e(r&&i.matches);const o=()=>e(r&&i.matches);return i.addEventListener("change",o),()=>i.removeEventListener("change",o)},[]),J(Vn.forceSrgb)||!t?"srgb":"p3"}class oRe extends Yu{static type="highlight";static props=LU;static migrations=zU;options={maxPointsPerShape:600,underlayOpacity:.82,overlayOpacity:.35};hideResizeHandles(e){return kS(e)}hideRotateHandle(e){return kS(e)}hideSelectionBoundsFg(e){return kS(e)}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(e){const n=Ed(e);if(kS(e))return new Sb({x:-n/2,y:-n/2,radius:n/2,isFilled:!0});const{strokePoints:r,sw:i}=$6(e,n,!0),o=gO({strokeWidth:i,showAsComplete:!0});return XM(r,o),new ry({points:YX(r,o),isFilled:!0})}component(e){const n=GP(this.editor,e),r=Ed(e);return g.jsx(_l,{children:g.jsx(IS,{shape:e,forceSolid:n,strokeWidth:r,opacity:this.options.overlayOpacity})})}backgroundComponent(e){const n=GP(this.editor,e),r=Ed(e);return g.jsx(_l,{children:g.jsx(IS,{shape:e,forceSolid:n,strokeWidth:r,opacity:this.options.underlayOpacity})})}indicator(e){const n=GP(this.editor,e),r=Ed(e),{strokePoints:i,sw:o}=$6(e,r,n),s=Sf(e.props.segments);let a;return i.length<2?a=aRe(s[0],o):a=My(i,!1),g.jsx("path",{d:a})}toSvg(e){const n=Ed(e),r=n<1.5,i=1/e.props.scale;return g.jsx("g",{transform:`scale(${i})`,children:g.jsx(IS,{forceSolid:r,strokeWidth:n,shape:e,opacity:this.options.overlayOpacity})})}toBackgroundSvg(e){const n=Ed(e),r=n<1.5,i=1/e.props.scale;return g.jsx("g",{transform:`scale(${i})`,children:g.jsx(IS,{forceSolid:r,strokeWidth:n,shape:e,opacity:this.options.underlayOpacity})})}onResize(e,n){const{scaleX:r,scaleY:i}=n,o=[];for(const s of e.props.segments)o.push({...s,points:s.points.map(({x:a,y:l,z:c})=>({x:r*a,y:i*l,z:c}))});return{props:{segments:o}}}getInterpolatedProps(e,n,r){return{...r>.5?n.props:e.props,...n.props,segments:LZ(e.props.segments,n.props.segments,r),scale:St(e.props.scale,n.props.scale,r)}}}function sRe(t){return`M ${t.x} ${t.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function aRe(t,e){const n=e/2;return`M ${t.x} ${t.y} m -${n}, 0 a ${n},${n} 0 1,0 ${n*2},0 a ${n},${n} 0 1,0 -${n*2},0`}function $6(t,e,n){const r=Sf(t.props.segments),i=t.props.isComplete||gi(t.props.segments)?.type==="straight";let o=e;!n&&!t.props.isPen&&r.length===1&&(o+=xh(t.id)()*(e/6));const s=gO({strokeWidth:o,showAsComplete:i});return{strokePoints:Nu(r,s),sw:o}}function Ed(t){return Sc[t.props.size]*1.12*t.props.scale}function kS(t){return t.props.segments.length===1&&t.props.segments[0].points.length<2}function IS({strokeWidth:t,forceSolid:e,shape:n,opacity:r}){const i=ga(),o=Sf(n.props.segments);let s=t;!e&&!n.props.isPen&&o.length===1&&(s+=xh(n.id)()*(s/6));const a=gO({strokeWidth:s,showAsComplete:n.props.isComplete||gi(n.props.segments)?.type==="straight"}),l=Nu(o,a),c=l.length>1?My(l,!1):sRe(n.props.segments[0].points[0]),d=iRe(),u=Ht(i,n.props.color,d==="p3"?"highlightP3":"highlightSrgb");return g.jsx("path",{d:c,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:u,strokeWidth:s,opacity:r})}function GP(t,e){return J("forceSolid",()=>{const n=Ed(e),r=t.getZoomLevel();return n/r<1.5},[t])}function UZ(){return g.jsxs("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[g.jsx("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),g.jsx("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),g.jsx("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function HZ({shapeId:t,assetId:e,width:n}){const r=ne(),i=Jy(),o=ude(),[s,a]=I.useState(()=>({asset:e?r.getAsset(e)??null:null,url:null})),l=I.useRef(!1),c=I.useRef(null);return I.useEffect(()=>{if(!e)return;let d=!1,u;const p=mo("update state",()=>{if(!i&&t&&r.getCulledShapes().has(t))return;const f=r.getAsset(e);if(!f){a(x=>({...x,asset:null,url:null}));return}if(!f.props.src){const x=r.getTemporaryAssetPreview(f.id);if(x){c.current!==x&&(c.current=x,a(b=>({...b,isPlaceholder:!0,url:x})),o());return}}const y=i?i.scale*(n/f.props.w):r.getZoomLevel()*(n/f.props.w);function v(x,b){d||c.current!==b&&(l.current=!0,c.current=b,a({asset:x,url:b}),o())}if(l.current){let x=0;const b=()=>{x++,x>500/16&&(N6(r,e,y,i,w=>v(f,w)),u?.())};u?.(),r.on("tick",b),u=()=>r.off("tick",b)}else N6(r,e,y,i,x=>v(f,x))});return()=>{p(),u?.(),d=!0}},[r,e,i,o,t,n]),s}function N6(t,e,n,r,i){t.resolveAssetUrl(e,{screenScale:n,shouldResolveToOriginal:r?r.pixelRatio===null:!1,dpr:r?.pixelRatio??void 0}).then(o=>{i(o)})}async function lRe(t){const n=await(await gc(t)).blob();return Si.blobToDataUrl(n)}const cRe=new ki;class uRe extends Rf{static type="image";static props=FU;static migrations=BU;isAspectRatioLocked(){return!0}canCrop(){return!0}isExportBoundsContainer(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null,flipX:!1,flipY:!1,altText:""}}getGeometry(e){return e.props.crop?.isCircle?new vme({width:e.props.w,height:e.props.h,isFilled:!0}):new Cl({width:e.props.w,height:e.props.h,isFilled:!0})}getAriaDescriptor(e){return e.props.altText}onResize(e,n){let r=m0(e,n);const{flipX:i,flipY:o}=n.initialShape.props,{scaleX:s,scaleY:a,mode:l}=n;if(r={...r,props:{...r.props,flipX:s<0!==i,flipY:a<0!==o}},!e.props.crop)return r;const c=l==="scale_shape"&&s===-1||l==="resize_bounds"&&i!==r.props.flipX,d=l==="scale_shape"&&a===-1||l==="resize_bounds"&&o!==r.props.flipY,{topLeft:u,bottomRight:p}=e.props.crop;return r.props.crop={topLeft:{x:c?1-p.x:u.x,y:d?1-p.y:u.y},bottomRight:{x:c?1-u.x:p.x,y:d?1-u.y:p.y},isCircle:e.props.crop.isCircle},r}component(e){return g.jsx(dRe,{shape:e})}indicator(e){return this.editor.getCroppingShapeId()===e.id?null:e.props.crop?.isCircle?g.jsx("ellipse",{cx:ee(e.props.w/2),cy:ee(e.props.h/2),rx:ee(e.props.w/2),ry:ee(e.props.h/2)}):g.jsx("rect",{width:ee(e.props.w),height:ee(e.props.h)})}async toSvg(e,n){const r=e.props;if(!r.assetId)return null;const i=this.editor.getAsset(r.assetId);if(!i)return null;const{w:o}=qa(e.props,r.crop),s=await cRe.get(i,async()=>{let a=await n.resolveAssetUrl(i.id,o);if(!a)return null;if((a.startsWith("blob:")||a.startsWith("http")||a.startsWith("/")||a.startsWith("./"))&&(a=await lRe(a)||""),WZ(this.editor,i.id)){const{promise:l}=KZ(a);a=await l}return a});return s?g.jsx(hRe,{shape:e,src:s}):null}onDoubleClickEdge(e){const n=e.props;if(!n||this.editor.getCroppingShapeId()!==e.id)return;const r=fn(n.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},{w:i,h:o}=qa(e.props,r),s=new T(r.topLeft.x*i,r.topLeft.y*o).rot(e.rotation),a={id:e.id,type:e.type,x:e.x-s.x,y:e.y-s.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:i,h:o}};this.editor.updateShapes([a])}getInterpolatedProps(e,n,r){function i(o,s){if(o.props.crop===null&&s.props.crop===null)return null;const a=o.props.crop?.topLeft||{x:0,y:0},l=o.props.crop?.bottomRight||{x:1,y:1},c=s.props.crop?.topLeft||{x:0,y:0},d=s.props.crop?.bottomRight||{x:1,y:1};return{topLeft:{x:St(a.x,c.x,r),y:St(a.y,c.y,r)},bottomRight:{x:St(l.x,d.x,r),y:St(l.y,d.y,r)}}}return{...r>.5?n.props:e.props,w:St(e.props.w,n.props.w,r),h:St(e.props.h,n.props.h,r),crop:i(e,n)}}}const dRe=I.memo(function({shape:e}){const n=ne(),{w:r}=qa(e.props,e.props.crop),{asset:i,url:o}=HZ({shapeId:e.id,assetId:e.props.assetId,width:r}),s=WV(),[a,l]=I.useState(""),[c,d]=I.useState(null),u=i&&WZ(n,i.id);I.useEffect(()=>{if(o&&u){const{promise:w,cancel:_}=KZ(o);return w.then(C=>{l(C),d(o)}),()=>{_()}}},[n,u,s,o]);const p=J("show crop preview",()=>e.id===n.getOnlySelectedShapeId()&&n.getCroppingShapeId()===e.id&&n.isIn("select.crop"),[n,e.id]),f=s&&(i?.props.mimeType?.includes("video")||u),y=VZ(e),v=o===c?null:o,x=f?a:c;if(!o&&!i?.props.src)return g.jsxs(_u,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h,color:"var(--tl-color-text-3)",backgroundColor:"var(--tl-color-low)",border:"1px solid var(--tl-color-low-border)"},children:[g.jsx("div",{className:Ye("tl-image-container",i&&"tl-image-container-loading"),style:y,children:i?null:g.jsx(UZ,{})}),"url"in e.props&&e.props.url&&g.jsx(xf,{url:e.props.url})]});const b=u?"anonymous":void 0;return g.jsxs(g.Fragment,{children:[p&&x&&g.jsx("div",{style:y,children:g.jsx("img",{className:"tl-image",style:{...Km(e),opacity:.1},crossOrigin:b,src:x,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,alt:""})}),g.jsxs(_u,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h,borderRadius:e.props.crop?.isCircle?"50%":void 0},children:[g.jsxs("div",{className:Ye("tl-image-container"),style:y,children:[x&&g.jsx("img",{className:"tl-image",style:Km(e),crossOrigin:b,src:x,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,alt:""},x),v&&g.jsx("img",{className:"tl-image",style:Km(e),crossOrigin:b,src:v,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,alt:e.props.altText,onLoad:()=>d(v)},v)]}),e.props.url&&g.jsx(xf,{url:e.props.url})]})]})});function WZ(t,e){const n=e?t.getAsset(e):void 0;return n?"mimeType"in n.props&&vs.isAnimatedImageType(n?.props.mimeType)||"isAnimated"in n.props&&n.props.isAnimated:!1}function VZ(t){const e=t.props.crop,n=e?.topLeft;if(!n)return{width:t.props.w,height:t.props.h};const{w:r,h:i}=qa(t.props,e),o=-n.x*r,s=-n.y*i;return{transform:`translate(${o}px, ${s}px)`,width:r,height:i}}function Km(t,e){const{flipX:n,flipY:r,crop:i}=t.props;if(!n&&!r)return;let o,s;if(i){const{w:c,h:d}=qa(t.props,i),u=i.bottomRight.x-i.topLeft.x,p=i.bottomRight.y-i.topLeft.y;o=Ha(i.topLeft.x,[0,1-u],[0,c-t.props.w]),s=Ha(i.topLeft.y,[0,1-p],[0,d-t.props.h])}const a=`scale(${n?-1:1}, ${r?-1:1})`;return{transform:`${e?`translate(${(n?e.width:0)-(o||0)}px,
		             ${(r?e.height:0)-(s||0)}px)`:""} ${a}`,transformOrigin:e?"0 0":"center center"}}function hRe({shape:t,src:e}){const n=Ih(),r=VZ(t),i=t.props.crop;if(r.transform&&i){const{transform:o,width:s,height:a}=r,l=(i.bottomRight.x-i.topLeft.x)*s,c=(i.bottomRight.y-i.topLeft.y)*a,d=[new T(0,0),new T(l,0),new T(l,c),new T(0,c)],u=Km(t,{width:s,height:a});return g.jsxs(g.Fragment,{children:[g.jsx("defs",{children:g.jsx("clipPath",{id:n,children:i.isCircle?g.jsx("ellipse",{cx:l/2,cy:c/2,rx:l/2,ry:c/2}):g.jsx("polygon",{points:d.map(p=>`${p.x},${p.y}`).join(" ")})})}),g.jsx("g",{clipPath:`url(#${n})`,children:g.jsx("image",{href:e,width:s,height:a,"aria-label":t.props.altText,style:u?{...u}:{transform:o}})})]})}else return g.jsx("image",{href:e,width:t.props.w,height:t.props.h,"aria-label":t.props.altText,style:Km(t,{width:t.props.w,height:t.props.h})})}function KZ(t){let e=!1;return{promise:new Promise(r=>{const i=Zm();i.onload=()=>{if(e)return;const o=document.createElement("canvas");o.width=i.width,o.height=i.height;const s=o.getContext("2d");s&&(s.drawImage(i,0,0),r(o.toDataURL()))},i.crossOrigin="anonymous",i.src=t}),cancel:()=>e=!0}}const pRe=new ki;class fRe extends Yu{static type="line";static props=UU;static migrations=HU;hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsFg(){return!0}hideSelectionBoundsBg(){return!0}hideInMinimap(){return!0}getDefaultProps(){const[e,n]=Qm(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[e]:{id:e,index:e,x:0,y:0},[n]:{id:n,index:n,x:.1,y:.1}},scale:1}}getGeometry(e){const n=BE(e).toGeometry();return Ge(n instanceof rE),n}getHandles(e){return pRe.get(e.props,()=>{const n=this.getGeometry(e),r=Im(e),i=r.map(o=>({...o,id:o.index,type:"vertex",canSnap:!0}));for(let o=0;o<r.length-1;o++){const s=rf(r[o].index,r[o+1].index),l=n.getSegments()[o].interpolateAlongEdge(.5);i.push({id:s,type:"create",index:s,x:l.x,y:l.y,canSnap:!0})}return i.sort(Yr)})}onResize(e,n){const{scaleX:r,scaleY:i}=n;return{props:{points:Uu(e.props.points,(o,{id:s,index:a,x:l,y:c})=>({id:s,index:a,x:l*r,y:c*i}))}}}onBeforeCreate(e){const{props:{points:n}}=e,r=Object.keys(n);if(r.length<2)return;const i=n[r[0]];if(r.every(s=>{const a=n[s];return a.x===i.x&&a.y===i.y})){const s=r[r.length-1];return n[s]={...n[s],x:n[s].x+.1,y:n[s].y+.1},e}}onHandleDrag(e,{handle:n}){const r=Ps(new T(n.x,n.y),this.editor);return{...e,props:{...e.props,points:{...e.props.points,[n.id]:{id:n.id,index:n.index,x:r.x,y:r.y}}}}}onHandleDragStart(e,{handle:n}){if(n.type==="create")return{...e,props:{...e.props,points:{...e.props.points,[n.index]:{id:n.index,index:n.index,x:n.x,y:n.y}}}}}component(e){return g.jsx(_l,{style:{minWidth:50,minHeight:50},children:g.jsx(L6,{shape:e})})}indicator(e){const n=xs[e.props.size]*e.props.scale,r=BE(e),{dash:i}=e.props;return r.toSvg({style:i==="draw"?"draw":"solid",strokeWidth:1,passes:1,randomSeed:e.id,offset:0,roundness:n*2,props:{strokeWidth:void 0}})}toSvg(e){return g.jsx(L6,{shouldScale:!0,shape:e})}getHandleSnapGeometry(e){const n=Im(e);return{points:n,getSelfSnapPoints:r=>{const i=this.getHandles(e).filter(o=>o.type==="vertex").findIndex(o=>o.id===r.id);return n.filter((o,s)=>Math.abs(s-i)>1).map(T.From)},getSelfSnapOutline:r=>{const i=this.getHandles(e).filter(s=>s.type==="vertex").findIndex(s=>s.id===r.id),o=this.getGeometry(e).getSegments().filter((s,a)=>a!==i-1&&a!==i);return o.length?new Zo({children:o}):null}}}getInterpolatedProps(e,n,r){const i=Im(e),o=Im(n),s=[],a=[];let l=d2;if(i.length>o.length)for(let c=0;c<i.length;c++)s[c]={...i[c]},o[c]===void 0?a[c]={...o[o.length-1],id:l}:a[c]={...o[c],id:l},l=na(l);else if(o.length>i.length)for(let c=0;c<o.length;c++)a[c]={...o[c]},i[c]===void 0?s[c]={...i[i.length-1],id:l}:s[c]={...i[c],id:l},l=na(l);else for(let c=0;c<o.length;c++)s[c]=i[c],a[c]=o[c];return{...r>.5?n.props:e.props,points:Object.fromEntries(s.map((c,d)=>{const u=a[d];return[c.id,{...c,x:St(c.x,u.x,r),y:St(c.y,u.y,r)}]})),scale:St(e.props.scale,n.props.scale,r)}}}function Im(t){return Object.values(t.props.points).sort(Yr)}const gRe=new ki;function BE(t){return gRe.get(t,()=>{const e=Im(t).map(T.From);switch(t.props.spline){case"cubic":return Zt.cubicSplineThroughPoints(e,{endOffsets:0});case"line":return Zt.lineThroughPoints(e,{endOffsets:0})}})}function L6({shape:t,shouldScale:e=!1,forceSolid:n=!1}){const r=ga(),i=BE(t),{dash:o,color:s,size:a}=t.props,l=1/t.props.scale,c=e?l:1,d=xs[a]*t.props.scale;return i.toSvg({style:o,strokeWidth:d,forceSolid:n,randomSeed:t.id,props:{transform:`scale(${c})`,stroke:Ht(r,s,"solid"),fill:"none"}})}function kw(t,e,n=!1){t.select(e),t.setEditingShape(e),t.setCurrentTool("select.editing_shape",{target:"shape",shape:e}),n&&t.emit("select-all-text",{shapeId:e.id})}class mRe extends Yu{static type="note";static props=WU;static migrations=VU;options={resizeMode:"none"};canEdit(){return!0}hideResizeHandles(){const{resizeMode:e}=this.options;switch(e){case"none":return!0;case"scale":return!1;default:throw Wt(e)}}isAspectRatioLocked(){return this.options.resizeMode==="scale"}hideSelectionBoundsFg(){return!1}getDefaultProps(){return{color:"black",richText:dn(""),size:"m",font:"draw",align:"middle",verticalAlign:"middle",labelColor:"black",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(e){const{labelHeight:n,labelWidth:r}=qZ(this.editor,e),{scale:i}=e.props,o=n*i,s=r*i,a=pn*i,l=_S(e);return new Zo({children:[new Cl({width:a,height:l,isFilled:!0}),new Cl({x:e.props.align==="start"?0:e.props.align==="end"?a-s:(a-s)/2,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?l-o:(l-o)/2,width:s,height:o,isFilled:!0,isLabel:!0,excludeFromShapeBounds:!0})]})}getHandles(e){const{scale:n}=e.props;if(this.editor.getInstanceState().isCoarsePointer)return[];const i=this.editor.getZoomLevel();if(i*n<.25)return[];const o=_S(e),s=pn*n,a=kDe/i*n;return i*n<.5?[{id:"bottom",index:"a3",type:"clone",x:s/2,y:o+a}]:[{id:"top",index:"a1",type:"clone",x:s/2,y:-a},{id:"right",index:"a2",type:"clone",x:s+a,y:o/2},{id:"bottom",index:"a3",type:"clone",x:s/2,y:o+a},{id:"left",index:"a4",type:"clone",x:-a,y:o/2}]}onResize(e,n){const{resizeMode:r}=this.options;switch(r){case"none":return;case"scale":return rW(e,n);default:throw Wt(r)}}getText(e){return Lu(this.editor,e.props.richText)}getFontFaces(e){return lr(e.props.richText)?ur:j0(this.editor,e.props.richText,{family:`tldraw_${e.props.font}`,weight:"normal",style:"normal"})}component(e){const{id:n,type:r,props:{labelColor:i,scale:o,color:s,font:a,size:l,align:c,richText:d,verticalAlign:u,fontSizeAdjustment:p}}=e,f=xRe(n),y=ga(),v=pn*o,x=_S(e),b=J("shape rotation",()=>this.editor.getShapePageTransform(n)?.rotation()??0,[this.editor]),w=J("zoom",()=>this.editor.getZoomLevel()<.35/o,[o,this.editor]),_=J("dark mode",()=>this.editor.user.getIsDarkMode(),[this.editor]),C=e.id===this.editor.getOnlySelectedShapeId(),A=dO(this.editor,e.id),E=lr(d);return g.jsxs(g.Fragment,{children:[g.jsx("div",{id:n,className:"tl-note__container",style:{width:v,height:x,backgroundColor:Ht(y,s,"noteFill"),borderBottom:w?_?`${2*o}px solid rgb(20, 20, 20)`:`${2*o}px solid rgb(144, 144, 144)`:"none",boxShadow:w?"none":SRe(e.id,b,o)},children:(C||A||!E)&&g.jsx(w1,{shapeId:n,type:r,font:a,fontSize:(p||Eu[l])*o,lineHeight:Vi.lineHeight,align:c,verticalAlign:u,richText:d,isSelected:C,labelColor:i==="black"?Ht(y,s,"noteText"):Ht(y,i,"fill"),wrap:!0,padding:po*o,hasCustomTabBehavior:!0,onKeyDown:f})}),"url"in e.props&&e.props.url&&g.jsx(xf,{url:e.props.url})]})}indicator(e){const{scale:n}=e.props;return g.jsx("rect",{rx:n,width:ee(pn*n),height:ee(_S(e))})}toSvg(e,n){const r=Ku({isDarkMode:n.isDarkMode}),i=bRe(e),o=g.jsx(k1,{fontSize:e.props.fontSizeAdjustment||Eu[e.props.size],font:e.props.font,align:e.props.align,verticalAlign:e.props.verticalAlign,richText:e.props.richText,labelColor:Ht(r,e.props.color,"noteText"),bounds:i,padding:po,showTextOutline:!1});return g.jsxs(g.Fragment,{children:[g.jsx("rect",{x:5,y:5,rx:1,width:pn-10,height:i.h,fill:"rgba(0,0,0,.1)"}),g.jsx("rect",{rx:1,width:pn,height:i.h,fill:Ht(r,e.props.color,"noteFill")}),o]})}onBeforeCreate(e){return z6(this.editor,e)}onBeforeUpdate(e,n){if(!(Bu(e.props.richText,n.props.richText)&&e.props.font===n.props.font&&e.props.size===n.props.size))return z6(this.editor,n)}getInterpolatedProps(e,n,r){return{...r>.5?n.props:e.props,scale:St(e.props.scale,n.props.scale,r)}}}function z6(t,e){const{labelHeight:n,fontSizeAdjustment:r}=qZ(t,e),i=Math.max(0,n-pn);if(i!==e.props.growY||r!==e.props.fontSizeAdjustment)return{...e,props:{...e.props,growY:i,fontSizeAdjustment:r}}}function yRe(t,e){const{richText:n}=e.props;if(lr(n))return{labelHeight:Eu[e.props.size]*Vi.lineHeight+po*2,labelWidth:100,fontSizeAdjustment:0};const r=Eu[e.props.size];let i=0,o=0,s=pn,a=pn;const l=1;do{i=Math.min(r,r-o);const c=Ty(t,n),d=t.textMeasure.measureHtml(c,{...Vi,fontFamily:bc[e.props.font],fontSize:i,maxWidth:pn-po*2-l,disableOverflowWrapBreaking:!0,measureScrollWidth:!0});if(s=d.h+po*2,a=d.w+po*2,i<=14){const u=Ty(t,n),p=t.textMeasure.measureHtml(u,{...Vi,fontFamily:bc[e.props.font],fontSize:i,maxWidth:pn-po*2-l});s=p.h+po*2,a=p.w+po*2;break}if(d.scrollWidth.toFixed(0)===d.w.toFixed(0))break}while(o++<50);return{labelHeight:s,labelWidth:a,fontSizeAdjustment:i}}const vRe=new ki;function qZ(t,e){return vRe.get(e,()=>yRe(t,e))}function xRe(t){const e=ne(),n=GV();return I.useCallback(r=>{const i=e.getShape(t);if(!i)return;const o=r.key==="Tab",s=(r.metaKey||r.ctrlKey)&&r.key==="Enter";if(o||s){r.preventDefault();const a=e.getShapePageTransform(t),l=a.rotation(),c=!!(n.dir==="rtl"||pZ(Lu(e,i.props.richText))),d=(pn+e.options.adjacentShapeMargin+(s&&!r.shiftKey?i.props.growY:0))*i.props.scale,u=new T(o?r.shiftKey!=c?-1:1:0,s?r.shiftKey?-1:1:0).mul(d).add(b1.clone().mul(i.props.scale)).rot(l).add(a.point()),p=_Z(e,i,u,l);p&&kw(e,p,!0)}},[t,e,n.dir])}function _S(t){return(pn+t.props.growY)*t.props.scale}function SRe(t,e,n){const r=xh(t),i=Math.abs(r())+.5,o=Math.cos(e),s=5*n,a=4*n,l=6*n,c=7*n;return`0px ${s-i}px ${s}px -${s}px rgba(15, 23, 31, .6),
	0px ${(a+i*c)*Math.max(0,o)}px ${l+i*c}px -${a+i*l}px rgba(15, 23, 31, ${(.3+i*.1).toFixed(2)}), 
	0px ${48*n}px ${10*n}px -${10*n}px inset rgba(15, 23, 44, ${((.022+r()*.005)*((1+o)/2)).toFixed(2)})`}function bRe(t){return new pe(0,0,pn,pn+t.props.growY)}const wRe=Gw("text size",(t,e)=>(t.fonts.trackFontsForShape(e),GZ(t,e.props)),{areRecordsEqual:(t,e)=>t.props===e.props});class kRe extends Yu{static type="text";static props=KU;static migrations=qU;options={extraArrowHorizontalPadding:10};getDefaultProps(){return{color:"black",size:"m",w:8,font:"draw",textAlign:"start",autoSize:!0,scale:1,richText:dn("")}}getMinDimensions(e){return wRe.get(this.editor,e.id)}getGeometry(e,n){const{scale:r}=e.props,{width:i,height:o}=this.getMinDimensions(e),s=n?.context??"none";return new Cl({x:(s==="@tldraw/arrow-without-arrowhead"?-this.options.extraArrowHorizontalPadding:0)*r,width:(i+(s==="@tldraw/arrow-without-arrowhead"?this.options.extraArrowHorizontalPadding*2:0))*r,height:o*r,isFilled:!0,isLabel:!0})}getFontFaces(e){return j0(this.editor,e.props.richText,{family:`tldraw_${e.props.font}`,weight:"normal",style:"normal"})}getText(e){return Lu(this.editor,e.props.richText)}canEdit(){return!0}isAspectRatioLocked(){return!0}component(e){const{id:n,props:{font:r,size:i,richText:o,color:s,scale:a,textAlign:l}}=e,{width:c,height:d}=this.getMinDimensions(e),u=e.id===this.editor.getOnlySelectedShapeId(),p=ga(),f=IRe(n);return g.jsx(w1,{shapeId:n,classNamePrefix:"tl-text-shape",type:"text",font:r,fontSize:Sc[i],lineHeight:Vi.lineHeight,align:l,verticalAlign:"middle",richText:o,labelColor:Ht(p,s,"solid"),isSelected:u,textWidth:c,textHeight:d,style:{transform:`scale(${a})`,transformOrigin:"top left"},wrap:!0,onKeyDown:f})}indicator(e){const n=this.editor.getShapeGeometry(e).bounds,r=ne();return e.props.autoSize&&r.getEditingShapeId()===e.id?null:g.jsx("rect",{width:ee(n.width),height:ee(n.height)})}toSvg(e,n){const r=this.editor.getShapeGeometry(e).bounds,i=r.width/(e.props.scale??1),o=r.height/(e.props.scale??1),s=Ku(n),a=new pe(0,0,i,o);return g.jsx(k1,{fontSize:Sc[e.props.size],font:e.props.font,align:e.props.textAlign,verticalAlign:"middle",richText:e.props.richText,labelColor:Ht(s,e.props.color,"solid"),bounds:a,padding:0})}onResize(e,n){const{newPoint:r,initialBounds:i,initialShape:o,scaleX:s,handle:a}=n;if(n.mode==="scale_shape"||a!=="right"&&a!=="left")return{id:e.id,type:e.type,...rW(e,n)};{const l=Math.max(1,Math.abs(i.width*s)),{x:c,y:d}=s<0?T.Sub(r,T.FromAngle(e.rotation).mul(l)):r;return{id:e.id,type:e.type,x:c,y:d,props:{w:l/o.props.scale,autoSize:!1}}}}onEditEnd(e){Lu(this.editor,e.props.richText).trimEnd().length===0&&this.editor.deleteShapes([e.id])}onBeforeUpdate(e,n){if(!n.props.autoSize)return;const r=e.props.size!==n.props.size||e.props.textAlign!==n.props.textAlign||e.props.font!==n.props.font||e.props.scale!==1&&n.props.scale===1,i=!Bu(e.props.richText,n.props.richText);if(!r&&!i)return;const o=this.getMinDimensions(e),s=GZ(this.editor,n.props),a=o.width*e.props.scale,l=o.height*e.props.scale,c=s.width*n.props.scale,d=s.height*n.props.scale;let u;switch(n.props.textAlign){case"middle":{u=new T((c-a)/2,i?0:(d-l)/2);break}case"end":{u=new T(c-a,i?0:(d-l)/2);break}default:{if(i)break;u=new T(0,(d-l)/2);break}}if(u){u.rot(n.rotation);const{x:p,y:f}=n;return{...n,x:p-u.x,y:f-u.y,props:{...n.props,w:c}}}else return{...n,props:{...n.props,w:c}}}}function GZ(t,e){const{font:n,richText:r,size:i,w:o}=e,s=16,a=Sc[i],l=e.autoSize?null:Math.max(s,Math.floor(o)),c=Ty(t,r),d=t.textMeasure.measureHtml(c,{...Vi,fontFamily:bc[n],fontSize:a,maxWidth:l});return{width:l??Math.max(s,d.w+1),height:Math.max(a,d.h)}}function IRe(t){const e=ne();return I.useCallback(n=>{if(e.getEditingShapeId()===t)switch(n.key){case"Enter":{(n.ctrlKey||n.metaKey)&&e.complete();break}}},[e,t])}const _Re=new ki;class CRe extends Rf{static type="video";static props=GU;static migrations=YU;options={autoplay:!0};canEdit(){return!0}isAspectRatioLocked(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,autoplay:this.options.autoplay,url:"",altText:"",time:0,playing:!0}}getAriaDescriptor(e){return e.props.altText}component(e){return g.jsx(PRe,{shape:e})}indicator(e){return g.jsx("rect",{width:ee(e.props.w),height:ee(e.props.h)})}async toSvg(e,n){const r=e.props;if(!r.assetId)return null;const i=this.editor.getAsset(r.assetId);if(!i)return null;const o=await _Re.get(i,async()=>{const s=await n.resolveAssetUrl(i.id,r.w);if(!s)return null;const a=await vs.loadVideo(s);return await vs.getVideoFrameAsDataUrl(a,0)});return o?g.jsx("image",{href:o,width:r.w,height:r.h,"aria-label":e.props.altText}):null}}const PRe=I.memo(function({shape:e}){const n=ne(),r=n.getShapeGeometry(e).bounds.w*n.getZoomLevel()>=110,i=iv(e.id),o=WV(),{Spinner:s}=gn(),{asset:a,url:l}=HZ({shapeId:e.id,assetId:e.props.assetId,width:e.props.w}),c=I.useRef(null),[d,u]=I.useState(!1),p=I.useCallback(v=>{v.currentTarget&&u(!0)},[]),[f,y]=I.useState(!1);return I.useEffect(()=>{const v=()=>y(document.fullscreenElement===c.current);return document.addEventListener("fullscreenchange",v),()=>document.removeEventListener("fullscreenchange",v)}),I.useEffect(()=>{const v=c.current;v&&i&&document.activeElement!==v&&v.focus()},[i,d]),g.jsxs(g.Fragment,{children:[g.jsx(_u,{id:e.id,style:{color:"var(--tl-color-text-3)",backgroundColor:a?"transparent":"var(--tl-color-low)",border:a?"none":"1px solid var(--tl-color-low-border)"},children:g.jsx("div",{className:"tl-counter-scaled",children:g.jsx("div",{className:"tl-video-container",children:a?s&&!a.props.src?g.jsx(s,{}):l?g.jsxs(g.Fragment,{children:[g.jsx("video",{ref:c,style:i?{pointerEvents:"all"}:d?void 0:{display:"none"},className:Ye("tl-video",`tl-video-shape-${e.id.split(":")[1]}`,{"tl-video-is-fullscreen":f}),width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:e.props.autoplay&&!o,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:i&&r,onLoadedData:p,hidden:!d,"aria-label":e.props.altText,children:g.jsx("source",{src:l})},l),!d&&s&&g.jsx(s,{})]}):null:g.jsx(UZ,{})})})}),"url"in e.props&&e.props.url&&g.jsx(xf,{url:e.props.url})]})}),yO=[kRe,gje,Eje,tRe,mRe,fRe,Vje,aje,oRe,ef,uRe,CRe];function TRe(t){return t.sideEffects.register({instance_page_state:{afterChange:(e,n)=>{if(e.croppingShapeId!==n.croppingShapeId){const r=t.isIn("select.crop");!e.croppingShapeId&&n.croppingShapeId?r||t.setCurrentTool("select.crop.idle"):e.croppingShapeId&&!n.croppingShapeId&&r&&t.setCurrentTool("select.idle")}if(e.editingShapeId!==n.editingShapeId)if(!e.editingShapeId&&n.editingShapeId){if(!t.isIn("select.editing_shape")){const r=t.getEditingShape();r&&r.type==="text"&&t.isInAny("text.pointing","select.resizing")&&t.getInstanceState().isToolLocked?t.setCurrentTool("select.editing_shape",{isCreatingTextWhileToolLocked:!0}):t.setCurrentTool("select.editing_shape")}}else e.editingShapeId&&!n.editingShapeId&&t.isIn("select.editing_shape")&&t.setCurrentTool("select.idle")}}})}class ERe extends We{static id="erasing";info={};scribbleId="id";markId="";excludedShapeIds=new Set;_isHoldingAccelKey=!1;_firstErasingShapeId=null;_erasingShapeIds=[];onEnter(e){this._isHoldingAccelKey=Rn(this.editor.inputs),this._firstErasingShapeId=this.editor.getErasingShapeIds()[0],this._erasingShapeIds=this.editor.getErasingShapeIds(),this.markId=this.editor.markHistoryStoppingPoint("erase scribble begin"),this.info=e;const{originPagePoint:n}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(i=>{if(this.editor.isShapeOrAncestorLocked(i))return!0;if(this.editor.isShapeOfType(i,"group")||this.editor.isShapeOfType(i,"frame")){const o=this.editor.getPointInShapeSpace(i,n);return this.editor.getShapeGeometry(i).bounds.containsPoint(o)}return!1}).map(i=>i.id));const r=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=r.id,this.update()}pushPointToScribble(){const{x:e,y:n}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,n)}onExit(){this.editor.setErasingShapes([]),this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onKeyUp(){this._isHoldingAccelKey=Rn(this.editor.inputs),this.update()}onKeyDown(){this._isHoldingAccelKey=Rn(this.editor.inputs),this.update()}update(){const{editor:e,excludedShapeIds:n}=this,r=e.getErasingShapeIds(),i=e.getZoomLevel(),o=e.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:s,previousPagePoint:a}}=e;this.pushPointToScribble();const l=new Set(r),c=this.editor.options.hitTestMargin/i;for(const d of o){if(e.isShapeOfType(d,"group"))continue;const u=e.getShapeMask(d.id);if(u&&!fo(s,u))continue;const p=e.getShapeGeometry(d),f=e.getShapePageTransform(d);if(!p||!f)continue;const y=f.clone().invert(),v=y.applyToPoint(a),x=y.applyToPoint(s),{bounds:b}=p;b.minX-c>Math.max(v.x,x.x)||b.minY-c>Math.max(v.y,x.y)||b.maxX+c<Math.min(v.x,x.x)||b.maxY+c<Math.min(v.y,x.y)||(p.hitTestLineSegment(v,x,c)&&l.add(e.getOutermostSelectableShape(d).id),this._erasingShapeIds=[...l])}if(this._isHoldingAccelKey&&this._firstErasingShapeId){const d=this._firstErasingShapeId;d&&this.editor.getShape(d)&&e.setErasingShapes([d]);return}this.editor.setErasingShapes(this._erasingShapeIds.filter(d=>!n.has(d)))}complete(){const{editor:e}=this;e.deleteShapes(e.getCurrentPageState().erasingShapeIds),this.parent.transition("idle"),this._erasingShapeIds=[],this._firstErasingShapeId=null}cancel(){const{editor:e}=this;e.bailToMark(this.markId),this.parent.transition("idle",this.info)}}let ARe=class extends We{static id="idle";onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}},MRe=class extends We{static id="pointing";_isHoldingAccelKey=!1;onEnter(){this._isHoldingAccelKey=Rn(this.editor.inputs);const e=this.editor.getZoomLevel(),n=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:r}}=this.editor,i=new Set,o=i.size;for(let s=n.length,a=s-1;a>=0;a--){const l=n[a];if(!(this.editor.isShapeOrAncestorLocked(l)||this.editor.isShapeOfType(l,"group"))&&this.editor.isPointInShape(l,r,{hitInside:!1,margin:this.editor.options.hitTestMargin/e})){const c=this.editor.getOutermostSelectableShape(l);if(this.editor.isShapeOfType(c,"frame")&&i.size>o||(i.add(c.id),this._isHoldingAccelKey))break}}this.editor.setErasingShapes([...i])}onKeyUp(){this._isHoldingAccelKey=Rn(this.editor.inputs)}onKeyDown(){this._isHoldingAccelKey=Rn(this.editor.inputs)}onLongPress(e){this.startErasing(e)}onExit(e,n){n!=="erasing"&&this.editor.setErasingShapes([])}onPointerMove(e){this._isHoldingAccelKey||this.editor.inputs.isDragging&&this.startErasing(e)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}startErasing(e){this.parent.transition("erasing",e)}complete(){const e=this.editor.getErasingShapeIds();e.length&&(this.editor.markHistoryStoppingPoint("erase end"),this.editor.deleteShapes(e)),this.parent.transition("idle")}cancel(){this.parent.transition("idle")}};class ORe extends We{static id="eraser";static initial="idle";static isLockable=!1;static children(){return[ARe,MRe,ERe]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}class DRe extends We{static id="dragging";initialCamera=new T;onEnter(){this.initialCamera=T.From(this.editor.getCamera()),this.update()}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.parent.transition("idle")}onComplete(){this.complete()}update(){const{initialCamera:e,editor:n}=this,{currentScreenPoint:r,originScreenPoint:i}=n.inputs,o=T.Sub(r,i).div(n.getZoomLevel());o.len2()!==0&&n.setCamera(e.clone().add(o))}complete(){const{editor:e}=this,{pointerVelocity:n}=e.inputs,r=Math.min(n.len(),2);r>.1&&this.editor.slideCamera({speed:r,direction:n}),this.parent.transition("idle")}}let jRe=class extends We{static id="idle";onEnter(){this.editor.setCursor({type:"grab",rotation:0})}onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}},RRe=class extends We{static id="pointing";onEnter(){this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})}onLongPress(){this.startDragging()}onPointerMove(){this.editor.inputs.isDragging&&this.startDragging()}startDragging(){this.parent.transition("dragging")}onPointerUp(){this.complete()}onCancel(){this.complete()}onComplete(){this.complete()}onInterrupt(){this.complete()}complete(){this.parent.transition("idle")}};class $Re extends We{static id="hand";static initial="idle";static isLockable=!1;static children(){return[jRe,RRe,DRe]}onDoubleClick(e){if(e.phase==="settle"){const{currentScreenPoint:n}=this.editor.inputs;this.editor.zoomIn(n,{animation:{duration:220,easing:Ui.easeOutQuint}})}}onTripleClick(e){if(e.phase==="settle"){const{currentScreenPoint:n}=this.editor.inputs;this.editor.zoomOut(n,{animation:{duration:320,easing:Ui.easeOutQuint}})}}onQuadrupleClick(e){if(e.phase==="settle"){const n=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:r}}=this.editor;n===1?this.editor.zoomToFit({animation:{duration:400,easing:Ui.easeOutQuint}}):this.editor.resetZoom(r,{animation:{duration:320,easing:Ui.easeOutQuint}})}}}let NRe=class extends We{static id="idle";onCancel(){this.editor.setCurrentTool("select")}onPointerDown(e){this.parent.transition("lasering",e)}};class LRe extends We{static id="lasering";scribbleId="id";onEnter(){const e=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:this.editor.options.laserDelayMs,shrink:.05,taper:!0});this.scribbleId=e.id,this.pushPointToScribble()}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.pushPointToScribble()}onPointerUp(){this.complete()}pushPointToScribble(){const{x:e,y:n}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,n)}onCancel(){this.cancel()}onComplete(){this.complete()}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}class zRe extends We{static id="laser";static initial="idle";static children(){return[NRe,LRe]}static isLockable=!1;onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}class FRe extends We{static id="brushing";info={};initialSelectedShapeIds=[];excludedShapeIds=new Set;isWrapMode=!1;viewportDidChange=!1;cleanupViewportChangeReactor(){}onEnter(e){const{editor:n}=this,{altKey:r}=n.inputs;this.isWrapMode=n.user.getIsWrapMode(),this.viewportDidChange=!1;let i=!0;if(this.cleanupViewportChangeReactor=mo("viewport change while brushing",()=>{n.getViewportPageBounds(),!i&&!this.viewportDidChange&&(this.viewportDidChange=!0)}),r){this.parent.transition("scribble_brushing",e);return}this.excludedShapeIds=new Set(n.getCurrentPageShapes().filter(o=>n.isShapeOfType(o,"group")||n.isShapeOrAncestorLocked(o)).map(o=>o.id)),this.info=e,this.initialSelectedShapeIds=n.getSelectedShapeIds().slice(),this.hitTestShapes(),i=!1}onExit(){this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null}),this.cleanupViewportChangeReactor()}onTick({elapsed:e}){const{editor:n}=this;n.edgeScrollManager.updateEdgeScrolling(e)}onPointerMove(){this.hitTestShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(e){this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",e)}onKeyDown(e){this.editor.inputs.altKey?this.parent.transition("scribble_brushing",e):this.hitTestShapes()}onKeyUp(){this.hitTestShapes()}complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){const{editor:e,excludedShapeIds:n,isWrapMode:r}=this,{inputs:{originPagePoint:i,currentPagePoint:o,shiftKey:s,ctrlKey:a}}=e,l=new Set(s?this.initialSelectedShapeIds:[]),c=r?!a:a,d=pe.FromPoints([i,o]),{corners:u}=d;let p,f,y,v,x,b;const _=e.getViewportPageBounds().contains(d)&&!this.viewportDidChange?e.getCurrentPageRenderingShapesSorted():e.getCurrentPageShapesSorted(),C=e.getCurrentPageId();e:for(let O=0,D=_.length;O<D;O++){if(y=_[O],n.has(y.id)||l.has(y.id)||(v=e.getShapePageBounds(y),!v))continue e;if(d.contains(v)){this.handleHit(y,o,C,l,u);continue e}if(c||e.isShapeOfType(y,"frame"))continue e;if(d.collides(v)){if(x=e.getShapePageTransform(y),!x)continue e;b=x.clone().invert().applyToPoints(u);const B=e.getShapeGeometry(y);t:for(let L=0;L<4;L++)if(p=b[L],f=b[(L+1)%4],B.hitTestLineSegment(p,f,0)){this.handleHit(y,o,C,l,u);break t}}}const A=e.getInstanceState().brush;(!A||!d.equals(A))&&e.updateInstanceState({brush:{...d.toJson()}});const E=e.getSelectedShapeIds();(E.length!==l.size||E.some(O=>!l.has(O)))&&e.setSelectedShapes(Array.from(l))}onInterrupt(){this.editor.updateInstanceState({brush:null})}handleHit(e,n,r,i,o){if(e.parentId===r){i.add(e.id);return}const s=this.editor.getOutermostSelectableShape(e),a=this.editor.getShapeMask(s.id);a&&!w8(a,o)&&!fo(n,a)||i.add(s.id)}}const bf={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class BRe extends We{static id="pointing_resize_handle";info={};updateCursor(){const e=this.editor.getSelectedShapes(),n=bf[this.info.handle];this.editor.setCursor({type:n,rotation:e.length===1?this.editor.getSelectionRotation():0})}onEnter(e){this.info=e,this.updateCursor()}onPointerMove(){this.editor.inputs.isDragging&&this.startResizing()}onLongPress(){this.startResizing()}startResizing(){this.editor.getIsReadonly()||this.parent.transition("resizing",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}class YZ extends We{static id="cropping";info={};markId="";snapshot={};onEnter(e){this.info=e,this.markId=this.editor.markHistoryStoppingPoint("cropping"),this.snapshot=this.createSnapshot(),this.updateShapes()}onPointerMove(){this.updateShapes()}onKeyDown(){this.updateShapes()}onKeyUp(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}updateCursor(){if(!this.editor.getSelectedShapes()[0])return;const n=bf[this.info.handle];this.editor.setCursor({type:n,rotation:this.editor.getSelectionRotation()})}updateShapes(){const{shape:e,cursorHandleOffset:n}=this.snapshot;if(!e)return;const r=this.editor.getShapeUtil(e.type);if(!r)return;const{shiftKey:i}=this.editor.inputs,o=this.editor.inputs.currentPagePoint.clone().sub(n),s=this.editor.inputs.originPagePoint.clone().sub(n),a=o.clone().sub(s).rot(-e.rotation),l=e.props.crop??Na(),c=qa(e.props,l),u=(r.onCrop?.bind(r)??LEe)(e,{handle:this.info.handle,change:a,crop:l,uncroppedSize:c,initialShape:this.snapshot.shape,aspectRatioLocked:i});u&&(this.editor.updateShapes([{id:e.id,type:e.type,...u}]),this.updateCursor())}complete(){this.updateShapes(),un(this.editor,[this.snapshot.shape.id]),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){const e=this.editor.getSelectionRotation(),{inputs:{originPagePoint:n}}=this.editor,r=this.editor.getOnlySelectedShape(),i=this.editor.getSelectionRotatedPageBounds(),o=T.RotWith(i.getHandlePoint(this.info.handle),i.point,e),s=T.Sub(n,o);return{shape:r,cursorHandleOffset:s}}}function vO(t,e=!1){const n=t.getZoomLevel(),{inputs:{currentPagePoint:r}}=t;return t.getShapeAtPoint(r,{hitInside:!1,hitLabels:e,margin:t.options.hitTestMargin/n,renderingOnly:!0})??t.getSelectedShapeAtPoint(r)}function XZ(t,e,n){if(!e)throw Error("Needs to translate a cropped shape!");const{crop:r}=e.props;if(!r)return;const i=t.inputs.shiftKey?Math.abs(n.x)<Math.abs(n.y)?"x":"y":null;i==="x"?n.x=0:i==="y"&&(n.y=0),n.rot(-e.rotation);const{w:o,h:s}=qa(e.props,r),a=r.bottomRight.x-r.topLeft.x,l=r.bottomRight.y-r.topLeft.y,c=fn(r),d=1-a,u=1-l;return c.topLeft.x=pt(c.topLeft.x-n.x/o,0,d),c.topLeft.y=pt(c.topLeft.y-n.y/s,0,u),c.bottomRight.x=c.topLeft.x+a,c.bottomRight.y=c.topLeft.y+l,{id:e.id,type:e.type,props:{crop:c}}}let URe=class extends We{static id="idle";onEnter(){this.editor.setCursor({type:"default",rotation:0});const e=this.editor.getOnlySelectedShape();e&&this.editor.setCroppingShape(e.id)}onExit(){this.editor.setCursor({type:"default",rotation:0})}onCancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}onPointerDown(e){if(e.accelKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{const n=vO(this.editor);if(n&&!this.editor.isShapeOfType(n,"group")){this.onPointerDown({...e,shape:n,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":{if(e.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}else this.editor.getShapeUtil(e.shape)?.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop.idle"});break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...e,onInteractionEnd:"select.crop.idle"});break}default:this.cancel()}break}}}onDoubleClick(e){if(this.editor.inputs.shiftKey||e.phase!=="up")return;const n=this.editor.getCroppingShapeId();if(!n)return;const r=this.editor.getShape(n);if(!r)return;const i=this.editor.getShapeUtil(r);if(i){if(e.target==="selection"){i.onDoubleClickEdge?.(r,e);return}this.cancel(),this.editor.root.handleEvent(e)}}onKeyDown(){this.nudgeCroppingImage(!1)}onKeyRepeat(){this.nudgeCroppingImage(!0)}onKeyUp(e){switch(e.key){case"Enter":{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{});break}}}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(e=!1){const{editor:{inputs:{keys:n}}}=this,r=n.has("ShiftLeft"),i=new T(0,0);if(n.has("ArrowLeft")&&(i.x+=1),n.has("ArrowRight")&&(i.x-=1),n.has("ArrowUp")&&(i.y+=1),n.has("ArrowDown")&&(i.y-=1),i.equals(new T(0,0)))return;r&&i.mul(10);const o=this.editor.getShape(this.editor.getCroppingShapeId());if(!o)return;const s=XZ(this.editor,o,i);s&&(e||this.editor.markHistoryStoppingPoint("translate crop"),this.editor.updateShapes([s]))}};class HRe extends We{static id="pointing_crop";onCancel(){this.editor.setCurrentTool("select.crop.idle",{})}onPointerMove(e){this.editor.inputs.isDragging&&this.startDragging(e)}onLongPress(e){this.startDragging(e)}onPointerUp(e){this.editor.setCurrentTool("select.crop.idle",e)}startDragging(e){this.editor.setCurrentTool("select.crop.translating_crop",e)}}class ZZ extends We{static id="pointing_crop_handle";info={};onEnter(e){this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd);const n=this.editor.getSelectedShapes()[0];if(!n)return;const r=bf[this.info.handle];this.editor.setCursor({type:r,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(n.id)}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)}onPointerMove(){this.editor.inputs.isDragging&&this.startCropping()}onLongPress(){this.startCropping()}startCropping(){this.editor.getIsReadonly()||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}onPointerUp(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}}class WRe extends We{static id="translating_crop";info={};markId="";snapshot={};onEnter(e){this.info=e,this.snapshot=this.createSnapshot(),this.markId=this.editor.markHistoryStoppingPoint("translating_crop"),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()}onExit(){this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}onKeyDown(e){switch(e.key){case"Alt":case"Shift":{this.updateShapes();return}}}onKeyUp(e){switch(e.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const e=this.snapshot.shape;if(!e)return;const{originPagePoint:n,currentPagePoint:r}=this.editor.inputs,i=r.clone().sub(n),o=XZ(this.editor,e,i);o&&this.editor.updateShapes([o])}}class VRe extends We{static id="crop";static initial="idle";static children(){return[URe,WRe,HRe,ZZ,YZ]}markId="";onEnter(){this.didExit=!1,this.markId=this.editor.markHistoryStoppingPoint("crop")}didExit=!1;onExit(){this.didExit||(this.didExit=!0,this.editor.squashToMark(this.markId))}onCancel(){this.didExit||(this.didExit=!0,this.editor.bailToMark(this.markId))}}class KRe extends We{static id="dragging_handle";shapeId;initialHandle;initialAdjacentHandle;initialPagePoint;markId;initialPageTransform;initialPageRotation;info;isPrecise=!1;isPreciseId=null;pointingId=null;onEnter(e){const{shape:n,isCreating:r,creatingMarkId:i,handle:o}=e;if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.shapeId=n.id,this.markId="",r)if(i)this.markId=i;else{const u=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);u&&(this.markId=u)}else this.markId=this.editor.markHistoryStoppingPoint("dragging handle");this.initialHandle=fn(o),this.initialPageTransform=this.editor.getShapePageTransform(n),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:r?"cross":"grabbing",rotation:0});const s=this.editor.getShapeHandles(n).sort(Yr),a=s.findIndex(u=>u.id===e.handle.id);this.initialAdjacentHandle=null;for(let u=a+1;u<s.length;u++){const p=s[u];if(p.type==="vertex"&&p.id!=="middle"&&p.id!==e.handle.id){this.initialAdjacentHandle=p;break}}if(!this.initialAdjacentHandle)for(let u=s.length-1;u>=0;u--){const p=s[u];if(p.type==="vertex"&&p.id!=="middle"&&p.id!==e.handle.id){this.initialAdjacentHandle=p;break}}if(this.editor.isShapeOfType(n,"arrow")){const u=Zr(this.editor,n)[e.handle.id];this.isPrecise=!1,u&&(this.isPrecise=u.props.isPrecise,this.isPrecise?this.isPreciseId=u.toId:this.resetExactTimeout())}const l={handle:this.initialHandle,isPrecise:this.isPrecise,isCreatingShape:!!this.info.isCreating,initial:n},d=this.editor.getShapeUtil(n).onHandleDragStart?.(n,l);d&&this.editor.updateShapes([{...d,id:n.id,type:n.type}]),this.update(),this.editor.select(this.shapeId)}exactTimeout=-1;resetExactTimeout(){const n=this.editor.getShapeUtil("arrow").options.pointingPreciseTimeout;this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},n)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.update(),this.complete()}onCancel(){this.cancel()}onExit(){this.parent.setCurrentToolIdMask(void 0),YM(this.editor),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})}complete(){this.editor.snaps.clearIndicators(),un(this.editor,[this.shapeId]);const e=this.editor.getShape(this.shapeId);if(e){const r=this.editor.getShapeUtil(e),i={handle:this.initialHandle,isPrecise:this.isPrecise,isCreatingShape:!!this.info.isCreating,initial:this.info.shape},o=r.onHandleDragEnd?.(e,i);o&&this.editor.updateShapes([{...o,id:e.id,type:e.type}])}const{onInteractionEnd:n}=this.info;if(this.editor.getInstanceState().isToolLocked&&n){this.editor.setCurrentTool(n,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){const e=this.editor.getShape(this.shapeId);if(e){const r=this.editor.getShapeUtil(e),i={handle:this.initialHandle,isPrecise:this.isPrecise,isCreatingShape:!!this.info.isCreating,initial:this.info.shape};r.onHandleDragCancel?.(e,i)}this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();const{onInteractionEnd:n}=this.info;if(n){this.editor.setCurrentTool(n,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){const{editor:e,shapeId:n,initialPagePoint:r}=this,{initialHandle:i,initialPageRotation:o,initialAdjacentHandle:s}=this,a=this.editor.user.getIsSnapMode(),{snaps:l,inputs:{currentPagePoint:c,shiftKey:d,ctrlKey:u,altKey:p,pointerVelocity:f}}=e,y=this.info.shape,v=e.getShape(n);if(!v)return;const x=e.getShapeUtil(v),b=e.isShapeOfType(v,"arrow")?Zr(e,v)[i.id]:void 0;let w=c.clone().sub(r).rot(-o).add(i);if(d&&s&&i.id!=="middle"){const O=T.Angle(s,w),B=pb(O,24)-O;w=T.RotWith(w,s,B)}e.snaps.clearIndicators();let _={...i,x:w.x,y:w.y},C=!1;if(i.canSnap&&i.snapType?mse("canSnap is deprecated. Cannot use both canSnap and snapType together - snapping disabled. Please use only snapType."):C=i.canSnap||i.snapType!==void 0,C&&(a?!u:u)){if(!e.getShapePageTransform(v.id))throw Error("Expected a page transform");const D=l.handles.snapHandle({currentShapeId:n,handle:_});D&&(D.nudge.rot(-e.getShapeParentTransform(v).rotation()),w.add(D.nudge),_={...i,x:w.x,y:w.y})}const A=x.onHandleDrag?.(v,{handle:_,isPrecise:this.isPrecise||p,isCreatingShape:!!this.info.isCreating,initial:y}),E={id:v.id,type:v.type,...A};if(i.type==="vertex"&&this.editor.isShapeOfType(v,"arrow")){const O=Zr(e,v)[i.id];O?b?.toId!==O.toId&&(this.pointingId=O.toId,this.isPrecise=f.len()<.5||p,this.isPreciseId=this.isPrecise?O.toId:null,this.resetExactTimeout()):b&&(this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}A&&e.updateShapes([E])}}function JZ(t){return t.isLabel?[t]:t instanceof Zo?t.children.filter(e=>e.isLabel):[]}class qRe extends We{static id="editing_shape";hitShapeForPointerUp=null;info={};onEnter(e){const n=this.editor.getEditingShape();if(!n)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,this.info=e,e.isCreatingTextWhileToolLocked&&this.parent.setCurrentToolIdMask("text"),uc(this.editor),this.editor.select(n)}onExit(){const{editingShapeId:e}=this.editor.getCurrentPageState();e&&(this.editor.setEditingShape(null),uc.cancel(),this.info.isCreatingTextWhileToolLocked&&(this.parent.setCurrentToolIdMask(void 0),this.editor.setCurrentTool("text",{})))}onPointerMove(e){if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getIsReadonly()||this.hitShapeForPointerUp.isLocked)return;this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",e),this.hitShapeForPointerUp=null;return}switch(e.target){case"shape":case"canvas":{uc(this.editor);return}}}onPointerDown(e){switch(this.hitShapeForPointerUp=null,e.target){case"canvas":{const n=vO(this.editor,!0);if(n){this.onPointerDown({...e,shape:n,target:"shape"});return}break}case"shape":{const{shape:n}=e,r=this.editor.getEditingShape();if(!r)throw Error("Expected an editing shape!");const i=this.editor.getShapeUtil(n).getGeometry(n),o=JZ(i),s=o.length===1?o[0]:void 0,a=this.editor.isShapeOfType(r,"text")&&Lu(this.editor,r.props.richText).trim()==="";if(s&&!a){const l=this.editor.getPointInShapeSpace(n,this.editor.inputs.currentPagePoint);if(s.bounds.containsPoint(l,0)&&s.hitTestPoint(l)){if(n.id===r.id)return;this.hitShapeForPointerUp=n,this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(n.id);return}}else{if(n.id===r.id)this.editor.isShapeOfType(n,"frame")&&(this.editor.setEditingShape(null),this.parent.transition("idle",e));else{this.parent.transition("pointing_shape",e);return}return}break}}this.parent.transition("idle",e),this.editor.root.handleEvent(e)}onPointerUp(e){const n=this.hitShapeForPointerUp;if(!n)return;this.hitShapeForPointerUp=null;const r=this.editor.getShapeUtil(n);if(n.isLocked)return;if(this.editor.getIsReadonly()&&!r.canEditInReadonly(n)){this.parent.transition("pointing_shape",e);return}this.editor.select(n.id);const i=this.editor.getEditingShape(),o=i&&i.id!==n.id;this.editor.setEditingShape(n.id);const s=Jt.isIos||Jt.isAndroid;!s||!o?this.editor.emit("place-caret",{shapeId:n.id,point:e.point}):s&&o&&this.editor.emit("select-all-text",{shapeId:n.id}),uc(this.editor)}onComplete(e){this.editor.getContainer().focus(),this.parent.transition("idle",e)}onCancel(e){this.editor.getContainer().focus(),this.parent.transition("idle",e)}}function F6(t){const e=t.getOnlySelectedShape();return!!(e&&!t.isShapeOrAncestorLocked(e)&&t.getShapeUtil(e).canCrop(e))}function Iw(t,e){const n=t.getSelectedShapeIds(),{currentPagePoint:r}=t.inputs,{shiftKey:i,altKey:o,accelKey:s}=e,a=i||s,l=t.getShapeAtPoint(r,{hitInside:!1,margin:t.options.hitTestMargin/t.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:c=>!c.isLocked});if(l){const c=t.getOutermostSelectableShape(l);if(a&&!o)t.cancelDoubleClick(),n.includes(c.id)?(t.markHistoryStoppingPoint("deselecting shape"),t.deselect(c)):(t.markHistoryStoppingPoint("shift selecting shape"),t.setSelectedShapes([...n,c.id]));else{let d;c===l||c.id===t.getFocusedGroupId()||n.includes(c.id)?d=l:d=c,d&&!n.includes(d.id)&&(t.markHistoryStoppingPoint("selecting shape"),t.select(d.id))}}else{if(a)return;{n.length>0&&(t.markHistoryStoppingPoint("selecting none"),t.selectNone());const c=t.getFocusedGroupId();if(co(c)){const d=t.getShape(c);t.isPointInShape(d,r,{margin:0,hitInside:!0})||t.setFocusedGroup(null)}}}}const GRe=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];let YRe=class extends We{static id="idle";selectedShapesOnKeyDown=[];onEnter(){this.parent.setCurrentToolIdMask(void 0),uc(this.editor),this.selectedShapesOnKeyDown=[],this.editor.setCursor({type:"default",rotation:0})}onExit(){uc.cancel()}onPointerMove(){uc(this.editor)}onPointerDown(e){const n=e.ctrlKey&&F6(this.editor);switch(e.target){case"canvas":{const r=vO(this.editor);if(r&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}const i=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:s}}=this.editor;if((i.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&B6(this.editor,s)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":{const{shape:r}=e;if(this.editor.isShapeOrAncestorLocked(r)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":{if(this.editor.getIsReadonly())break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{if(e.accelKey){this.parent.transition("brushing",e);break}this.parent.transition("pointing_rotate_handle",e);break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{if(n)this.parent.transition("crop.pointing_crop_handle",e);else{if(e.accelKey){this.parent.transition("brushing",e);break}this.parent.transition("pointing_resize_handle",e)}break}default:{const r=this.editor.getHoveredShape();if(r&&!this.editor.getSelectedShapeIds().includes(r.id)&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}this.parent.transition("pointing_selection",e)}}break}}}onDoubleClick(e){if(!(this.editor.inputs.shiftKey||e.phase!=="up")&&!(e.ctrlKey||e.shiftKey))switch(e.target){case"canvas":{const n=this.editor.getHoveredShape(),r=n&&!this.editor.isShapeOfType(n,"group")?n:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),i=this.editor.getFocusedGroupId();if(r){if(this.editor.isShapeOfType(r,"group")){Iw(this.editor,e);return}else{const o=this.editor.getShape(r.parentId);if(o&&this.editor.isShapeOfType(o,"group")&&!(i&&o.id===i)){Iw(this.editor,e);return}}this.onDoubleClick({...e,shape:r,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getIsReadonly())break;const n=this.editor.getOnlySelectedShape();if(n){const r=this.editor.getShapeUtil(n);if(!this.canInteractWithShapeInReadOnly(n))return;if(e.handle==="right"||e.handle==="left"||e.handle==="top"||e.handle==="bottom"){const i=r.onDoubleClickEdge?.(n,e);if(i){this.editor.markHistoryStoppingPoint("double click edge"),this.editor.updateShapes([i]),un(this.editor,[n.id]);return}}if(e.handle==="top_left"||e.handle==="top_right"||e.handle==="bottom_right"||e.handle==="bottom_left"){const i=r.onDoubleClickCorner?.(n,e);if(i){this.editor.markHistoryStoppingPoint("double click corner"),this.editor.updateShapes([i]),un(this.editor,[n.id]);return}}if(r.canCrop(n)&&!this.editor.isShapeOrAncestorLocked(n)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(n)&&this.startEditingShape(n,e,!0)}break}case"shape":{const{shape:n}=e,r=this.editor.getShapeUtil(n);if(n.type!=="video"&&n.type!=="embed"&&this.editor.getIsReadonly())break;if(r.onDoubleClick){const i=r.onDoubleClick?.(n);if(i){this.editor.updateShapes([i]);return}}if(r.canCrop(n)&&!this.editor.isShapeOrAncestorLocked(n)){this.editor.markHistoryStoppingPoint("select and crop"),this.editor.select(e.shape?.id),this.parent.transition("crop",e);return}this.shouldStartEditingShape(n)?this.startEditingShape(n,e,!0):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getIsReadonly())break;const{shape:n,handle:r}=e,o=this.editor.getShapeUtil(n).onDoubleClickHandle?.(n,r);o?this.editor.updateShapes([o]):this.shouldStartEditingShape(n)&&this.startEditingShape(n,e,!0)}}}onRightClick(e){switch(e.target){case"canvas":{const n=this.editor.getHoveredShape(),r=n&&!this.editor.isShapeOfType(n,"group")?n:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!0,renderingOnly:!0});if(r){this.onRightClick({...e,shape:r,target:"shape"});return}const i=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:s}}=this.editor;if((i.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&B6(this.editor,s)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:n}=this.editor.getCurrentPageState(),{shape:r}=e,i=this.editor.getOutermostSelectableShape(r,o=>!n.includes(o.id));!n.includes(i.id)&&!this.editor.findShapeAncestor(i,o=>n.includes(o.id))&&(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([i.id]));break}}}onCancel(){this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.markHistoryStoppingPoint("clearing selection"),this.editor.selectNone())}onKeyDown(e){switch(this.selectedShapesOnKeyDown=this.editor.getSelectedShapes(),e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{if(e.accelKey){e.shiftKey?e.code==="ArrowDown"?this.editor.selectFirstChildShape():e.code==="ArrowUp"&&this.editor.selectParentShape():this.editor.selectAdjacentShape(e.code.replace("Arrow","").toLowerCase());return}this.nudgeSelectedShapes(!1);return}}if(Vn.editOnType.get()&&!GRe.includes(e.key)&&!e.altKey&&!e.ctrlKey){const n=this.editor.getOnlySelectedShape();if(n&&this.editor.isShapeOfType(n,"note")&&this.shouldStartEditingShape(n)){this.startEditingShape(n,{...e,target:"shape",shape:n},!0);return}}}onKeyRepeat(e){switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{if(e.accelKey){this.editor.selectAdjacentShape(e.code.replace("Arrow","").toLowerCase());return}this.nudgeSelectedShapes(!0);break}case"Tab":{this.editor.getSelectedShapes().length&&this.editor.selectAdjacentShape(e.shiftKey?"prev":"next");break}}}onKeyUp(e){switch(e.key){case"Enter":{if(!this.selectedShapesOnKeyDown.length)return;const n=this.editor.getSelectedShapes();if(n.every(i=>this.editor.isShapeOfType(i,"group"))){this.editor.setSelectedShapes(n.flatMap(i=>this.editor.getSortedChildIdsForParent(i.id)));return}const r=this.editor.getOnlySelectedShape();if(r&&this.shouldStartEditingShape(r)){this.startEditingShape(r,{...e,target:"shape",shape:r},!0);return}F6(this.editor)&&this.parent.transition("crop",e);break}case"Tab":{this.editor.getSelectedShapes().length&&this.editor.selectAdjacentShape(e.shiftKey?"prev":"next");break}}}shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!e||this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||!this.canInteractWithShapeInReadOnly(e)?!1:this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,n,r){this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||(this.editor.markHistoryStoppingPoint("editing shape"),kw(this.editor,e,r),this.parent.transition("editing_shape",n))}isOverArrowLabelTest(e){return e?RZ(this.editor,e):!1}handleDoubleClickOnCanvas(e){if(this.editor.getIsReadonly()||!this.editor.options.createTextOnCanvasDoubleClick)return;this.editor.markHistoryStoppingPoint("creating text shape");const n=sn(),{x:r,y:i}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:n,type:"text",x:r,y:i,props:{richText:dn(""),autoSize:!0}}]);const o=this.editor.getShape(n);if(!o)return;const s=this.editor.getShapeUtil(o);this.editor.getIsReadonly()&&!s.canEditInReadonly(o)||(this.editor.setEditingShape(n),this.editor.select(n),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){const{editor:{inputs:{keys:n}}}=this,r=n.has("ShiftLeft"),i=new T(0,0);if(n.has("ArrowLeft")&&(i.x-=1),n.has("ArrowRight")&&(i.x+=1),n.has("ArrowUp")&&(i.y-=1),n.has("ArrowDown")&&(i.y+=1),i.equals(new T(0,0)))return;e||this.editor.markHistoryStoppingPoint("nudge shapes");const{gridSize:o}=this.editor.getDocumentSettings(),s=this.editor.getInstanceState().isGridMode?r?o*JRe:o:r?XRe:ZRe,a=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(a,i.mul(s)),un(this.editor,a)}canInteractWithShapeInReadOnly(e){return!!(!this.editor.getIsReadonly()||this.editor.getShapeUtil(e).canEditInReadonly(e))}};const XRe=10,ZRe=1,JRe=5;function B6(t,e){const n=t.getSelectionRotatedPageBounds();if(!n)return!1;const r=t.getSelectionRotation();return r?fo(e,n.corners.map(i=>T.RotWith(i,n.point,r))):n.containsPoint(e)}class QRe extends We{static id="pointing_arrow_label";shapeId="";markId="";wasAlreadySelected=!1;didDrag=!1;didCtrlOnEnter=!1;info={};updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}onEnter(e){const{shape:n}=e;this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.shapeId=n.id,this.didDrag=!1,this.didCtrlOnEnter=e.accelKey,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===n.id,this.updateCursor();const i=this.editor.getShapeGeometry(n).children[1];if(!i)throw Error(`Expected to find an arrow label geometry for shape: ${n.id}`);const{currentPagePoint:o}=this.editor.inputs,s=this.editor.getPointInShapeSpace(n,o);if(this._labelDragOffset=T.Sub(i.center,s),this.markId=this.editor.markHistoryStoppingPoint("label-drag start"),e.shiftKey||e.accelKey){const l=this.editor.getSelectedShapeIds();this.editor.setSelectedShapes([...l,this.shapeId]);return}this.editor.setSelectedShapes([this.shapeId])}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}_labelDragOffset=new T(0,0);onPointerMove(){const{isDragging:e}=this.editor.inputs;if(!e)return;if(this.didCtrlOnEnter){this.parent.transition("brushing",this.info);return}const n=this.editor.getShape(this.shapeId);if(!n)return;const r=this.editor.getShapeUtil("arrow").options,i=vf(this.editor,n),o=this.editor.getShapePageTransform(n.id),s=this.editor.getPointInShapeSpace(n,this.editor.inputs.currentPagePoint).add(this._labelDragOffset),a=jZ(this.editor,n);let l=i.uninterpolateAlongEdge(s);isNaN(l)&&(l=a);const c=o.applyToPoint(i.interpolateAlongEdge(l)),d=o.applyToPoint(i.interpolateAlongEdge(a));T.DistMin(c,d,r.labelCenterSnapDistance/this.editor.getZoomLevel())&&(l=a),this.didDrag=!0,this.editor.updateShape({id:n.id,type:n.type,props:{labelPosition:l}})}onPointerUp(){const e=this.editor.getShape(this.shapeId);e&&(this.didDrag||!this.wasAlreadySelected?this.complete():this.editor.getIsReadonly()||(this.editor.setEditingShape(e.id),this.editor.setCurrentTool("select.editing_shape")))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}class e$e extends We{static id="pointing_canvas";onEnter(e){e.shiftKey||e.accelKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.markHistoryStoppingPoint("selecting none"),this.editor.selectNone())}onPointerMove(e){this.editor.inputs.isDragging&&this.parent.transition("brushing",e)}onPointerUp(e){Iw(this.editor,e),this.complete()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle")}complete(){this.parent.transition("idle")}}class t$e extends We{static id="pointing_handle";didCtrlOnEnter=!1;info={};onEnter(e){this.info=e,this.didCtrlOnEnter=e.accelKey;const{shape:n}=e;if(this.editor.isShapeOfType(n,"arrow")){const r=Zr(this.editor,n),i=r[e.handle.id],o=r[e.handle.id==="start"?"end":"start"],s=this.editor.getShapePageTransform(n.id);i&&x1({editor:this.editor,pointInPageSpace:s.applyToPoint(e.handle),arrow:n,isPrecise:i.props.isPrecise,currentBinding:i,oppositeBinding:o})}this.editor.setCursor({type:"grabbing",rotation:0})}onExit(){this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})}onPointerUp(){const{shape:e,handle:n}=this.info;if(this.editor.isShapeOfType(e,"note")){const{editor:r}=this,i=U6(r,e,n,!1);if(i){kw(r,i,!0);return}}this.parent.transition("idle",this.info)}onPointerMove(e){const{editor:n}=this;n.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",e):this.startDraggingHandle())}onLongPress(){this.startDraggingHandle()}startDraggingHandle(){const{editor:e}=this;if(e.getIsReadonly())return;const{shape:n,handle:r}=this.info;if(e.isShapeOfType(n,"note")){const i=U6(e,n,r,!0);if(i){const o=e.getPointInParentSpace(i,e.inputs.originPagePoint).sub(T.Rot(b1.clone().mul(n.props.scale),i.rotation));e.updateShape({...i,x:o.x,y:o.y}),e.setHoveredShape(i.id).select(i.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:e.getShape(i),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{kw(e,i,!0)}});return}}this.parent.transition("dragging_handle",this.info)}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}function U6(t,e,n,r){const i=t.getShapePageTransform(e.id),o=i.point(),s=i.rotation(),l=kZ(t,o,s,e.props.growY*e.props.scale,0,e.props.scale)[n.index];if(l)return _Z(t,e,l,s,r)}class n$e extends We{static id="pointing_rotate_handle";info={};updateCursor(){this.editor.setCursor({type:bf[this.info.handle],rotation:this.editor.getSelectionRotation()})}onEnter(e){this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.editor.inputs.isDragging&&this.startRotating()}onLongPress(){this.startRotating()}startRotating(){this.editor.getIsReadonly()||this.parent.transition("rotating",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}class r$e extends We{static id="pointing_selection";info={};onEnter(e){this.info=e}onPointerUp(e){Iw(this.editor,e),this.parent.transition("idle",e)}onPointerMove(e){this.editor.inputs.isDragging&&this.startTranslating(e)}onLongPress(e){this.startTranslating(e)}startTranslating(e){this.editor.getIsReadonly()||this.parent.transition("translating",e)}onDoubleClick(e){const n=this.editor.getHoveredShape(),r=n&&!this.editor.isShapeOfType(n,"group")?n:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(r){this.parent.transition("idle"),this.parent.onDoubleClick?.({...e,target:"shape",shape:this.editor.getShape(r)});return}}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}class i$e extends We{static id="pointing_shape";hitShape={};hitShapeForPointerUp={};isDoubleClick=!1;didCtrlOnEnter=!1;didSelectOnEnter=!1;onEnter(e){const n=this.editor.getSelectedShapeIds(),r=this.editor.getSelectionRotatedPageBounds(),i=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:o}}=this.editor,{shiftKey:s,altKey:a,accelKey:l}=e;this.hitShape=e.shape,this.isDoubleClick=!1,this.didCtrlOnEnter=l;const c=this.editor.getOutermostSelectableShape(e.shape),d=this.editor.findShapeAncestor(c,u=>n.includes(u.id));if(this.didCtrlOnEnter||this.editor.getShapeUtil(e.shape).onClick||c.id===i||n.includes(c.id)||d||n.length>1&&r?.containsPoint(o)){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=c;return}this.didSelectOnEnter=!0,s&&!a?(this.editor.cancelDoubleClick(),n.includes(c.id)||(this.editor.markHistoryStoppingPoint("shift selecting shape"),this.editor.setSelectedShapes([...n,c.id]))):(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([c.id]))}onPointerUp(e){const n=this.editor.getSelectedShapeIds(),r=this.editor.getFocusedGroupId(),i=this.editor.getZoomLevel(),{inputs:{currentPagePoint:o}}=this.editor,s=e.shiftKey||e.accelKey,a=this.editor.getShapeAtPoint(o,{margin:this.editor.options.hitTestMargin/i,hitInside:!0,renderingOnly:!0})??this.hitShape,l=a?this.editor.getOutermostSelectableShape(a):this.hitShapeForPointerUp;if(l){const c=this.editor.getShapeUtil(l);if(c.onClick){const d=c.onClick?.(l);if(d){this.editor.markHistoryStoppingPoint("shape on click"),this.editor.updateShapes([d]),this.parent.transition("idle",e);return}}if(l.id===r){n.length>0?(this.editor.markHistoryStoppingPoint("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",e);return}}if(!this.didSelectOnEnter){const c=this.editor.getOutermostSelectableShape(a,d=>!n.includes(d.id));if(n.includes(c.id))if(s)this.editor.markHistoryStoppingPoint("deselecting on pointer up"),this.editor.deselect(l);else if(n.includes(l.id)){if(n.length===1){const d=this.editor.getShapeUtil(l).getGeometry(l),u=JZ(d),p=u.length===1?u[0]:void 0;if(p){const f=this.editor.getPointInShapeSpace(l,o);if(p.bounds.containsPoint(f,0)&&p.hitTestPoint(f)){this.editor.run(()=>{this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(l.id);const y=this.editor.getShapeUtil(l);this.editor.getIsReadonly()&&!y.canEditInReadonly(l)||(this.editor.setEditingShape(l.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick?this.editor.emit("select-all-text",{shapeId:l.id}):this.editor.emit("place-caret",{shapeId:l.id,point:e.point}))});return}}}this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(l.id)}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(l);else if(s){const d=this.editor.getShapeAncestors(c);this.editor.markHistoryStoppingPoint("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(u=>!d.find(p=>p.id===u)),c.id])}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.setSelectedShapes([c.id])}this.parent.transition("idle",e)}onDoubleClick(){this.isDoubleClick=!0}onPointerMove(e){if(this.editor.inputs.isDragging){if(RZ(this.editor,this.hitShape)){this.parent.transition("pointing_arrow_label",{...e,shape:this.hitShape});return}this.didCtrlOnEnter?this.parent.transition("brushing",e):this.startTranslating(e)}}onLongPress(e){this.startTranslating(e)}startTranslating(e){this.editor.getIsReadonly()||(this.editor.focus(),this.parent.transition("translating",e))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}class o$e extends We{static id="resizing";info={};markId="";didHoldCommand=!1;creationCursorOffset={x:0,y:0};snapshot={};onEnter(e){const{isCreating:n=!1,creatingMarkId:r,creationCursorOffset:i={x:0,y:0}}=e;this.info=e,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.creationCursorOffset=i;try{this.snapshot=this._createSnapshot()}catch(o){console.error(o),this.cancel();return}if(this.markId="",n)if(r)this.markId=r;else{const o=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);o&&(this.markId=o)}else this.markId=this.editor.markHistoryStoppingPoint("starting resizing");n&&this.editor.setCursor({type:"cross",rotation:0}),this.handleResizeStart(),this.updateShapes()}onTick({elapsed:e}){const{editor:n}=this;n.edgeScrollManager.updateEdgeScrolling(e)}onPointerMove(){this.updateShapes()}onKeyDown(){this.updateShapes()}onKeyUp(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}cancel(){const{shapeSnapshots:e}=this.snapshot;e.forEach(({shape:n})=>{const r=this.editor.getShape(n.id);r&&this.editor.getShapeUtil(n).onResizeCancel?.(n,r)}),this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){if(un(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){this.info.onCreate?.(this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:e}=this.snapshot,n=[];e.forEach(({shape:r})=>{const o=this.editor.getShapeUtil(r).onResizeStart?.(r);o&&n.push(o)}),n.length>0&&this.editor.updateShapes(n)}handleResizeEnd(){const{shapeSnapshots:e}=this.snapshot,n=[];e.forEach(({shape:r})=>{const i=this.editor.getShape(r.id),s=this.editor.getShapeUtil(r).onResizeEnd?.(r,i);s&&n.push(s)}),n.length>0&&this.editor.updateShapes(n)}updateShapes(){const{altKey:e,shiftKey:n}=this.editor.inputs,{frames:r,shapeSnapshots:i,selectionBounds:o,cursorHandleOffset:s,selectedShapeIds:a,selectionRotation:l,canShapesDeform:c}=this.snapshot;let d=n||!c;if(i.size===1){const O=[...i.values()][0];this.editor.isShapeOfType(O.shape,"text")&&(d=!(this.info.handle==="left"||this.info.handle==="right"))}const u=Rn(this.editor.inputs),p=this.editor.inputs.currentPagePoint.clone().sub(s).sub(this.creationCursorOffset),f=this.editor.inputs.originPagePoint.clone().sub(s);if(this.editor.getInstanceState().isGridMode&&!u){const{gridSize:O}=this.editor.getDocumentSettings();p.snapToGrid(O)}const y=this.info.handle,v=H6(y,Math.PI);if(this.editor.snaps.clearIndicators(),(this.editor.user.getIsSnapMode()?!u:u)&&l%br===0){const{nudge:O}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:T.Sub(p,f),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:H6(y,l),isAspectRatioLocked:d,isResizingFromCenter:e});p.add(O)}const b=T.RotWith(e?o.center:o.getHandlePoint(v),o.point,l),w=T.Sub(p,b).rot(-l),_=T.Sub(f,b).rot(-l),C=T.DivV(w,_);Number.isFinite(C.x)||(C.x=1),Number.isFinite(C.y)||(C.y=1);const A=y==="top"||y==="bottom",E=y==="left"||y==="right";d?E?C.y=Math.abs(C.x):A?C.x=Math.abs(C.y):Math.abs(C.x)>Math.abs(C.y)?C.y=Math.abs(C.x)*(C.y<0?-1:1):C.x=Math.abs(C.y)*(C.x<0?-1:1):(A&&(C.x=1),E&&(C.y=1)),this.info.isCreating||this.updateCursor({dragHandle:y,isFlippedX:C.x<0,isFlippedY:C.y<0,rotation:l});for(const O of i.keys()){const D=i.get(O);this.editor.resizeShape(O,C,{initialShape:D.shape,initialBounds:D.bounds,initialPageTransform:D.pageTransform,dragHandle:y,mode:a.length===1&&O===a[0]?"resize_bounds":"scale_shape",scaleOrigin:b,isAspectRatioLocked:d,scaleAxisRotation:l,skipStartAndEndCallbacks:!0})}if(u){this.didHoldCommand=!0;for(const{id:O,children:D}of r){if(!D.length)continue;const B=i.get(O).shape,L=this.editor.getShape(O);if(!(B&&L))continue;const j=L.x-B.x,F=L.y-B.y,z=new T(j,F).rot(-B.rotation);if(z.x!==0||z.y!==0)for(const $ of D)this.editor.updateShape({id:$.id,type:$.type,x:$.x-z.x,y:$.y-z.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:O}of r)if(O.length)for(const D of O)this.editor.updateShape({id:D.id,type:D.type,x:D.x,y:D.y})}}updateCursor({dragHandle:e,isFlippedX:n,isFlippedY:r,rotation:i}){const o={...this.editor.getInstanceState().cursor};switch(e){case"top_left":case"bottom_right":{o.type="nwse-resize",n!==r&&(o.type="nesw-resize");break}case"top_right":case"bottom_left":{o.type="nesw-resize",n!==r&&(o.type="nwse-resize");break}}o.rotation=i,this.editor.setCursor(o)}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()}_createSnapshot(){const{editor:e}=this,n=e.getSelectedShapeIds(),r=e.getSelectionRotation(),{inputs:{originPagePoint:i}}=e,o=e.getSelectionRotatedPageBounds();if(!o)throw Error("Resizing but nothing is selected");const s=T.RotWith(o.getHandlePoint(this.info.handle),o.point,r),a=T.Sub(i,s),l=new Map,c=[],d=p=>{const f=e.getShape(p);if(!f)return!1;const y=e.getShapeUtil(f);if(y.canResize(f)){const v=e.getShapePageTransform(f);l.set(f.id,{shape:f,bounds:e.getShapeGeometry(f).bounds,pageTransform:v,pageRotation:xe.Decompose(v).rotation,isAspectRatioLocked:y.isAspectRatioLocked(f)})}if(e.isShapeOfType(f,"frame")&&c.push({id:f.id,children:ut(e.getSortedChildIdsForParent(f).map(v=>e.getShape(v)))}),!y.canResizeChildren(f))return!1};n.forEach(p=>{d(p)!==!1&&e.visitDescendants(p,d)});const u=![...l.values()].some(p=>!XU(p.pageRotation,r)||p.isAspectRatioLocked);return{shapeSnapshots:l,selectionBounds:o,cursorHandleOffset:a,selectionRotation:r,selectedShapeIds:n,canShapesDeform:u,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:c}}}const YP=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function H6(t,e){e=e%Sn;const n=Math.round(e/(nn/4)),r=YP.indexOf(t);return YP[(r+n)%YP.length]}const W6=Math.PI/180;class s$e extends We{static id="rotating";snapshot={};info={};markId="";onEnter(e){this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.markId=this.editor.markHistoryStoppingPoint("rotate start");const n=Z8({editor:this.editor,ids:this.editor.getSelectedShapeIds()});if(!n)return this.parent.transition("idle",this.info);this.snapshot=n;const r=this._getRotationFromPointerPosition({snapToNearestDegree:!1});LS({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:bf[this.info.handle],rotation:r+this.snapshot.initialShapesRotation})}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}update(){const e=this._getRotationFromPointerPosition({snapToNearestDegree:!1});LS({editor:this.editor,delta:e,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:bf[this.info.handle],rotation:e+this.snapshot.initialShapesRotation})}cancel(){const{shapeSnapshots:e}=this.snapshot;e.forEach(({shape:n})=>{const r=this.editor.getShape(n.id);r&&this.editor.getShapeUtil(n).onRotateCancel?.(n,r)}),this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}complete(){LS({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),un(this.editor,this.snapshot.shapeSnapshots.map(e=>e.shape.id)),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}_getRotationFromPointerPosition({snapToNearestDegree:e}){const{inputs:{shiftKey:n,currentPagePoint:r}}=this.editor,{initialCursorAngle:i,initialShapesRotation:o,initialPageCenter:s}=this.snapshot,a=s.angle(r)-i;let l=o+a;if(n)l=pb(l,24);else if(e&&(l=Math.round(l/W6)*W6,this.editor.getInstanceState().isCoarsePointer)){const c=pb(l,4),d=$S(l,c);Math.abs(d)<zce(5)&&(l=c)}return l-o}}class a$e extends We{static id="scribble_brushing";hits=new Set;size=0;scribbleId="id";initialSelectedShapeIds=new Set;newlySelectedShapeIds=new Set;onEnter(){this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const e=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=e.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.updateScribbleSelection(!0)}onPointerUp(){this.complete()}onKeyDown(){this.updateScribbleSelection(!1)}onKeyUp(){this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")}onCancel(){this.cancel()}onComplete(){this.complete()}pushPointToScribble(){const{x:e,y:n}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,n)}updateScribbleSelection(e){const{editor:n}=this,r=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{shiftKey:i,originPagePoint:o,previousPagePoint:s,currentPagePoint:a}}=this.editor,{newlySelectedShapeIds:l,initialSelectedShapeIds:c}=this;e&&this.pushPointToScribble();const d=r;let u,p,f,y;const v=0;for(let w=0,_=d.length;w<_;w++){if(u=d[w],n.isShapeOfType(u,"group")||l.has(u.id)||n.isShapeOrAncestorLocked(u)||(p=n.getShapeGeometry(u),n.isShapeOfType(u,"frame")&&p.bounds.containsPoint(n.getPointInShapeSpace(u,o))))continue;const C=n.getShapePageTransform(u);if(!p||!C)continue;const A=C.clone().invert();f=A.applyToPoint(s),y=A.applyToPoint(a);const{bounds:E}=p;if(!(E.minX-v>Math.max(f.x,y.x)||E.minY-v>Math.max(f.y,y.y)||E.maxX+v<Math.min(f.x,y.x)||E.maxY+v<Math.min(f.y,y.y))&&p.hitTestLineSegment(f,y,v)){const O=this.editor.getOutermostSelectableShape(u),D=this.editor.getShapeMask(O.id);if(D&&b8(s,a,D)!==null&&!fo(a,D))continue;l.add(O.id)}}const x=n.getSelectedShapeIds(),b=new Set(i?[...l,...c]:[...l]);(x.length!==b.size||x.some(w=>!b.has(w)))&&this.editor.setSelectedShapes(Array.from(b))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}var l$e=Object.create,QZ=Object.defineProperty,c$e=Object.getOwnPropertyDescriptor,u$e=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),eJ=t=>{throw TypeError(t)},tJ=(t,e,n)=>e in t?QZ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,d$e=t=>[,,,l$e(null)],nJ=["class","method","getter","setter","accessor","field","value","get","set"],rJ=t=>t!==void 0&&typeof t!="function"?eJ("Function expected"):t,h$e=(t,e,n,r,i)=>({kind:nJ[t],name:e,metadata:r,addInitializer:o=>n._?eJ("Already initialized"):i.push(rJ(o||null))}),p$e=(t,e)=>tJ(e,u$e("metadata"),t[3]),f$e=(t,e,n,r)=>{for(var i=0,o=t[e>>1],s=o&&o.length;i<s;i++)o[i].call(n);return r},g$e=(t,e,n,r,i,o)=>{for(var s,a,l,c,d=e&7,u=!1,p=!1,f=2,y=nJ[d+5],v=t[f]||(t[f]=[]),x=(i=i.prototype,c$e(i,n)),b=r.length-1;b>=0;b--)l=h$e(d,n,a={},t[3],v),l.static=u,l.private=p,c=l.access={has:w=>n in w},c.get=w=>w[n],s=(0,r[b])(x[y],l),a._=1,rJ(s)&&(x[y]=s);return x&&QZ(i,n,x),i},ic=(t,e,n)=>tJ(t,typeof e!="symbol"?e+"":e,n),iJ,I1;const m$e=320,y$e=60;iJ=[qo];class xO{constructor(e){this.editor=e,f$e(I1,5,this),ic(this,"shapesToActuallyMove",[]),ic(this,"draggedOverShapeIds",new Set),ic(this,"initialGroupIds",new Map),ic(this,"initialParentIds",new Map),ic(this,"initialIndices",new Map),ic(this,"initialDraggingOverShape"),ic(this,"prevDraggingOverShape"),ic(this,"prevPagePoint",new T),ic(this,"intervalTimerId",-1),e.disposables.add(this.dispose)}startDraggingShapes(e,n,r){const{editor:i}=this;if(this.intervalTimerId!==-1)return;const o=new Set(e),s=new Set;for(const c of o){const d=i.getShapeParent(c);d&&i.isShapeOfType(d,"group")&&(s.has(d)||s.add(d))}for(const c of s){const d=ut(i.getSortedChildIdsForParent(c).map(u=>i.getShape(u)));o.add(c);for(const u of d)o.delete(u)}this.initialParentIds.clear();for(const c of o){const d=i.getShapeParent(c);d&&this.initialParentIds.set(c.id,d.id),this.initialIndices.set(c.id,c.index);const u=i.findShapeAncestor(c,p=>i.isShapeOfType(p,"group"));u&&this.initialGroupIds.set(c.id,u.id)}const a=i.getCurrentPageShapesSorted();this.shapesToActuallyMove=Array.from(o).filter(c=>!c.isLocked).sort((c,d)=>a.indexOf(c)-a.indexOf(d)),this.initialDraggingOverShape=i.getDraggingOverShape(n,this.shapesToActuallyMove),this.prevDraggingOverShape=this.initialDraggingOverShape,this.updateDraggingShapes(n,r);let l=0;this.intervalTimerId=this.editor.timers.setInterval(()=>{l++,!(l%3&&this.editor.inputs.pointerVelocity.len()>.5)&&this.updateDraggingShapes(i.inputs.currentPagePoint,r)},e.length>10?m$e:y$e)}dropShapes(e){const{editor:n}=this;this.updateDraggingShapes(n.inputs.currentPagePoint);const r=n.getDraggingOverShape(n.inputs.currentPagePoint,e);r&&n.getShapeUtil(r).onDropShapesOver?.(r,e,{initialDraggingOverShapeId:this.initialDraggingOverShape?.id??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices}),this.dispose()}clear(){clearInterval(this.intervalTimerId),this.intervalTimerId=-1,this.initialParentIds.clear(),this.initialIndices.clear(),this.shapesToActuallyMove=[],this.initialDraggingOverShape=void 0,this.prevDraggingOverShape=void 0,this.editor.setHintingShapes([])}dispose(){this.clear()}updateDraggingShapes(e,n){const{editor:r}=this,i=ut(this.shapesToActuallyMove.map(a=>r.getShape(a)));if(!i.length)return;const o=r.getDraggingOverShape(e,this.shapesToActuallyMove),s=!this.prevPagePoint.equals(r.inputs.currentPagePoint);this.prevPagePoint.setTo(r.inputs.currentPagePoint),r.run(()=>{if(this.prevDraggingOverShape?.id===o?.id){s&&o&&co(o.id)&&!r.inputs.previousPagePoint.equals(r.inputs.currentPagePoint)&&r.getShapeUtil(o).onDragShapesOver?.(o,i,{initialDraggingOverShapeId:this.initialDraggingOverShape?.id??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices});return}this.prevDraggingOverShape&&r.getShapeUtil(this.prevDraggingOverShape).onDragShapesOut?.(this.editor.getShape(this.prevDraggingOverShape),i,{nextDraggingOverShapeId:o?.id??null,initialDraggingOverShapeId:this.initialDraggingOverShape?.id??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices}),o?(r.getShapeUtil(o).onDragShapesIn?.(o,i,{initialDraggingOverShapeId:this.initialDraggingOverShape?.id??null,prevDraggingOverShapeId:this.prevDraggingOverShape?.id??null,initialParentIds:this.initialParentIds,initialIndices:this.initialIndices}),r.setHintingShapes([o.id])):this.prevDraggingOverShape&&r.setHintingShapes([]),n?.()}),this.prevDraggingOverShape=o}}I1=d$e();g$e(I1,1,"dispose",iJ,xO);p$e(I1,xO);var v$e=Object.create,oJ=Object.defineProperty,x$e=Object.getOwnPropertyDescriptor,sJ=(t,e)=>(e=Symbol[t])?e:Symbol.for("Symbol."+t),aJ=t=>{throw TypeError(t)},lJ=(t,e,n)=>e in t?oJ(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,S$e=t=>[,,,v$e(t?.[sJ("metadata")]??null)],cJ=["class","method","getter","setter","accessor","field","value","get","set"],uJ=t=>t!==void 0&&typeof t!="function"?aJ("Function expected"):t,b$e=(t,e,n,r,i)=>({kind:cJ[t],name:e,metadata:r,addInitializer:o=>n._?aJ("Already initialized"):i.push(uJ(o||null))}),w$e=(t,e)=>lJ(e,sJ("metadata"),t[3]),k$e=(t,e,n,r)=>{for(var i=0,o=t[e>>1],s=o&&o.length;i<s;i++)o[i].call(n);return r},I$e=(t,e,n,r,i,o)=>{for(var s,a,l,c,d=e&7,u=!1,p=!1,f=2,y=cJ[d+5],v=t[f]||(t[f]=[]),x=(i=i.prototype,x$e(i,n)),b=r.length-1;b>=0;b--)l=b$e(d,n,a={},t[3],v),l.static=u,l.private=p,c=l.access={has:w=>n in w},c.get=w=>w[n],s=(0,r[b])(x[y],l),a._=1,uJ(s)&&(x[y]=s);return x&&oJ(i,n,x),i},uu=(t,e,n)=>lJ(t,typeof e!="symbol"?e+"":e,n),dJ,UE,_1;class C1 extends(UE=We,dJ=[qo],UE){constructor(){super(...arguments),k$e(_1,5,this),uu(this,"info",{}),uu(this,"selectionSnapshot",{}),uu(this,"snapshot",{}),uu(this,"markId",""),uu(this,"isCloning",!1),uu(this,"isCreating",!1),uu(this,"dragAndDropManager",new xO(this.editor))}onCreate(e){}onEnter(e){const{isCreating:n=!1,creatingMarkId:r,onCreate:i=()=>{}}=e;if(!this.editor.getSelectedShapeIds()?.length){this.parent.transition("idle");return}if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.isCreating=n,this.markId="",n)if(r)this.markId=r;else{const o=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);o&&(this.markId=o)}else this.markId=this.editor.markHistoryStoppingPoint("translating");this.onCreate=i,this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=V6(this.editor),!(!this.isCreating&&this.editor.inputs.altKey&&(this.startCloning(),this.isCloning))&&(this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes())}onExit(){this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()}onTick({elapsed:e}){const{editor:n}=this;n.edgeScrollManager.updateEdgeScrolling(e)}onPointerMove(){this.updateShapes()}onKeyDown(){this.editor.inputs.altKey&&!this.isCloning&&(this.startCloning(),this.isCloning)||this.updateShapes()}onKeyUp(){if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}startCloning(){if(this.isCreating)return;const e=Array.from(this.editor.getSelectedShapeIds());this.editor.canCreateShapes(e)&&(this.isCloning=!0,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate cloning"),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=V6(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate"),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),this.handleEnd(),un(this.editor,this.snapshot.movingShapes.map(e=>e.id)),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?this.onCreate?.(this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){const{movingShapes:e}=this.snapshot;e.forEach(n=>{const r=this.editor.getShape(n.id);r&&this.editor.getShapeUtil(n).onTranslateCancel?.(n,r)}),this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:e}=this.snapshot,n=[];e.forEach(r=>{const o=this.editor.getShapeUtil(r).onTranslateStart?.(r);o&&n.push(o)}),n.length>0&&this.editor.updateShapes(n),this.dragAndDropManager.startDraggingShapes(ut(this.snapshot.movingShapes.map(r=>this.editor.getShape(r.id))),this.editor.inputs.originPagePoint,this.updateParentTransforms),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:e}=this.snapshot;if(this.isCloning&&e.length>0){const r=T.Average(e.map(o=>this.editor.getShapePageTransform(o.id).point())),i=T.Sub(r,this.selectionSnapshot.averagePagePoint);T.IsNaN(i)||this.editor.updateInstanceState({duplicateProps:{shapeIds:e.map(o=>o.id),offset:{x:i.x,y:i.y}}})}const n=[];e.forEach(r=>{const i=this.editor.getShape(r.id),s=this.editor.getShapeUtil(r).onTranslateEnd?.(r,i);s&&n.push(s)}),n.length>0&&this.editor.updateShapes(n)}updateShapes(){const{snapshot:e}=this;this.dragAndDropManager.startDraggingShapes(e.movingShapes,this.editor.inputs.originPagePoint,this.updateParentTransforms),_$e({editor:this.editor,snapshot:e});const{movingShapes:n}=e,r=[];n.forEach(i=>{const o=this.editor.getShape(i.id),a=this.editor.getShapeUtil(i).onTranslate?.(i,o);a&&r.push(a)}),r.length>0&&this.editor.updateShapes(r)}updateParentTransforms(){const{editor:e,snapshot:{shapeSnapshots:n}}=this;n.forEach(r=>{const i=e.getShape(r.shape.id);if(!i)return null;const o=hi(i.parentId)?null:xe.Inverse(e.getShapePageTransform(i.parentId));r.parentTransform=o})}}_1=S$e(UE);I$e(_1,1,"updateParentTransforms",dJ,C1);w$e(_1,C1);uu(C1,"id","translating");function V6(t){const e=[],n=[],r=t.getSelectedShapeIds(),i=ut(r.map(u=>{const p=t.getShape(u);if(!p)return null;e.push(p);const f=t.getShapePageTransform(u),y=f.point(),v=f.rotation();n.push(y);const x=yo.isId(p.parentId)?null:xe.Inverse(t.getShapePageTransform(p.parentId));return{shape:p,pagePoint:y,pageRotation:v,parentTransform:x}})),o=t.getOnlySelectedShape();let s=[];if(o)s=t.snaps.shapeBounds.getSnapPoints(o.id);else{const u=t.getSelectionPageBounds();u&&(s=u.cornersAndCenter.map((p,f)=>({id:"selection:"+f,x:p.x,y:p.y})))}let a,l;const{originPagePoint:c}=t.inputs,d=i.filter(u=>t.isShapeOfType(u.shape,"note")&&t.isPointInShape(u.shape,c));if(d.length!==0)if(d.length===1)l=d[0];else{const u=t.getCurrentPageShapesSorted();l=d.map(p=>({snapshot:p,index:u.findIndex(f=>f.id===p.shape.id)})).sort((p,f)=>f.index-p.index)[0]?.snapshot}return l&&(a=IZ(t,l.pageRotation,l.shape.props.scale,l.shape.props.growY??0)),{averagePagePoint:T.Average(n),movingShapes:e,shapeSnapshots:i,initialPageBounds:t.getSelectionPageBounds(),initialSnapPoints:s,noteAdjacentPositions:a,noteSnapshot:l}}function _$e({editor:t,snapshot:e}){const{inputs:n}=t,{noteSnapshot:r,noteAdjacentPositions:i,initialPageBounds:o,initialSnapPoints:s,shapeSnapshots:a,averagePagePoint:l}=e,c=t.getInstanceState().isGridMode,d=t.getDocumentSettings().gridSize,u=T.Sub(n.currentPagePoint,n.originPagePoint),p=t.inputs.shiftKey?Math.abs(u.x)<Math.abs(u.y)?"x":"y":null;p==="x"?u.x=0:p==="y"&&(u.y=0),t.snaps.clearIndicators();const f=t.user.getIsSnapMode()?!n.ctrlKey:n.ctrlKey;let y=!1;if(f&&t.inputs.pointerVelocity.len()<.5){const{nudge:w}=t.snaps.shapeBounds.snapTranslateShapes({dragDelta:u,initialSelectionPageBounds:o,lockedAxis:p,initialSelectionSnapPoints:s});u.add(w)}else if(r&&i){const{scale:w}=r.shape.props,_=r.pagePoint.clone().add(u).add(b1.clone().mul(w).rot(r.pageRotation));let C=wZ/t.getZoomLevel(),A=new T(0,0);for(const E of i){const O=T.Sub(_,E),D=O.len();D<C&&(y=!0,C=D,A=O)}u.sub(A)}const v=T.Add(l,u),x=t.snaps.getIndicators();c&&!n.ctrlKey&&!y&&x.length===0&&v.snapToGrid(d);const b=T.Sub(v,l);t.updateShapes(ut(a.map(({shape:w,pagePoint:_,parentTransform:C})=>{const A=T.Add(_,b),E=C?xe.applyToPoint(C,A):A;return{id:w.id,type:w.type,x:E.x,y:E.y}})))}class C$e extends We{static id="select";static initial="idle";static isLockable=!1;reactor=void 0;static children(){return[VRe,YZ,YRe,e$e,i$e,C1,FRe,a$e,ZZ,r$e,BRe,qRe,o$e,s$e,n$e,QRe,t$e,KRe]}cleanUpDuplicateProps(){const e=this.editor.getSelectedShapeIds(),n=this.editor.getInstanceState();if(!n.duplicateProps)return;const r=new Set(n.duplicateProps.shapeIds);e.length===r.size&&e.every(i=>r.has(i))||this.editor.updateInstanceState({duplicateProps:null})}onEnter(){this.reactor=mo("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(e){console.error(e)}})}onExit(){this.reactor?.(),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)}}class P$e extends We{static id="idle";info={};onEnter(e){this.info=e}onPointerDown(){this.parent.transition("pointing",this.info)}}class T$e extends We{static id="pointing";info={};onEnter(e){this.info=e}onPointerUp(){this.complete()}onPointerMove(){this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)}onCancel(){this.cancel()}complete(){const{currentScreenPoint:e}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(e,{animation:{duration:220}}):this.editor.zoomIn(e,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}class E$e extends We{static id="zoom_brushing";info={};zoomBrush=new pe;onEnter(e){this.info=e,this.update()}onExit(){this.editor.updateInstanceState({zoomBrush:null})}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}update(){const{inputs:{originPagePoint:e,currentPagePoint:n}}=this.editor;this.zoomBrush.setTo(pe.FromPoints([e,n])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:e}=this,n=8/this.editor.getZoomLevel();if(e.width<n&&e.height<n){const r=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(r,{animation:{duration:220}}):this.editor.zoomIn(r,{animation:{duration:220}})}else{const r=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(e,{targetZoom:r,animation:{duration:220}})}this.parent.transition("idle",this.info)}}class A$e extends We{static id="zoom";static initial="idle";static children(){return[P$e,E$e,T$e]}static isLockable=!1;info={};onEnter(e){this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)}onKeyDown(){this.updateCursor()}onKeyUp(e){this.updateCursor(),e.code==="KeyZ"&&this.complete()}onInterrupt(){this.complete()}complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}}const M$e=[ORe,$Re,zRe,A$e,C$e],O$e=rt.forwardRef(function({isEditing:e,text:n,handleFocus:r,handleChange:i,handleKeyDown:o,handlePaste:s,handleBlur:a,handleInputPointerDown:l,handleDoubleClick:c},d){const u=ne(),p=f=>{i({plaintext:f.target.value})};return g.jsx("textarea",{ref:d,className:"tl-text tl-text-input",name:"text",tabIndex:-1,disabled:!e,readOnly:!e,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:n,onFocus:r,onChange:p,onKeyDown:f=>o(f.nativeEvent),onBlur:a,onTouchEnd:u.markEventAsHandled,onContextMenu:e?f=>f.stopPropagation():void 0,onPointerDown:l,onPaste:s,onDoubleClick:c,onDragStart:dt})});rt.memo(function({shapeId:e,type:n,text:r,labelColor:i,font:o,fontSize:s,lineHeight:a,align:l,verticalAlign:c,wrap:d,isSelected:u,padding:p=0,onKeyDown:f,classNamePrefix:y,style:v,textWidth:x,textHeight:b}){const{rInput:w,isEmpty:_,isEditing:C,isReadyForEditing:A,...E}=NDe(e,n,r),O=Ey.normalizeTextForDom(r||""),D=O.length>0,B=CZ(l);if(!C&&!D)return null;const L=y||"tl-text";return g.jsx("div",{className:`${L}-label tl-text-wrapper tl-plain-text-wrapper`,"aria-hidden":!C,"data-font":o,"data-align":l,"data-hastext":!_,"data-isediting":C,"data-is-ready-for-editing":A,"data-textwrap":!!d,"data-isselected":u,style:{justifyContent:l==="middle"||B?"center":l,alignItems:c==="middle"?"center":c,padding:p,...v},children:g.jsxs("div",{className:`${L}-label__inner tl-text-content__wrapper`,style:{fontSize:s,lineHeight:a.toString(),minHeight:Math.floor(s*a)+"px",minWidth:Math.ceil(x||0),color:i,width:x?Math.ceil(x):void 0,height:b?Math.ceil(b):void 0},children:[g.jsx("div",{className:`${L} tl-text tl-text-content`,dir:"auto",children:O.split(`
`).map((j,F)=>g.jsx("div",{dir:"auto",children:j},F))}),(A||u)&&g.jsx(O$e,{ref:w,text:r,isEditing:C,shapeId:e,...E,handleKeyDown:f??E.handleKeyDown})]})})});let _w={fonts:{tldraw_mono:`${Ar()}/fonts/IBMPlexMono-Medium.woff2`,tldraw_mono_italic:`${Ar()}/fonts/IBMPlexMono-MediumItalic.woff2`,tldraw_mono_bold:`${Ar()}/fonts/IBMPlexMono-Bold.woff2`,tldraw_mono_italic_bold:`${Ar()}/fonts/IBMPlexMono-BoldItalic.woff2`,tldraw_serif:`${Ar()}/fonts/IBMPlexSerif-Medium.woff2`,tldraw_serif_italic:`${Ar()}/fonts/IBMPlexSerif-MediumItalic.woff2`,tldraw_serif_bold:`${Ar()}/fonts/IBMPlexSerif-Bold.woff2`,tldraw_serif_italic_bold:`${Ar()}/fonts/IBMPlexSerif-BoldItalic.woff2`,tldraw_sans:`${Ar()}/fonts/IBMPlexSans-Medium.woff2`,tldraw_sans_italic:`${Ar()}/fonts/IBMPlexSans-MediumItalic.woff2`,tldraw_sans_bold:`${Ar()}/fonts/IBMPlexSans-Bold.woff2`,tldraw_sans_italic_bold:`${Ar()}/fonts/IBMPlexSans-BoldItalic.woff2`,tldraw_draw:`${Ar()}/fonts/Shantell_Sans-Informal_Regular.woff2`,tldraw_draw_italic:`${Ar()}/fonts/Shantell_Sans-Informal_Regular_Italic.woff2`,tldraw_draw_bold:`${Ar()}/fonts/Shantell_Sans-Informal_Bold.woff2`,tldraw_draw_italic_bold:`${Ar()}/fonts/Shantell_Sans-Informal_Bold_Italic.woff2`}};function hJ(t){return I.useMemo(()=>t?{fonts:{..._w.fonts,...t?.fonts}}:_w,[t])}const D$e=["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","alt","arrow-arc","arrow-cycle","arrow-elbow","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bold","bookmark","bring-forward","bring-to-front","broken","bulletList","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","code","color","comment","corners","crop","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","download","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","heading","help-circle","highlight","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","italic","leading","link","list","lock","manual","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","stretch-horizontal","stretch-vertical","strike","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","underline","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"];let Xg={..._w,icons:Object.fromEntries(D$e.map(t=>[t,`${Ar()}/icons/icon/0_merged.svg#${t}`])),translations:Object.fromEntries(ty.map(t=>[t.locale,`${Ar()}/translations/${t.locale}.json`])),embedIcons:Object.fromEntries(RM.map(t=>[t.type,`${Ar()}/embed-icons/${t.type}.png`]))};function pJ(t){return I.useMemo(()=>t?{fonts:Object.assign({...Xg.fonts},{...t?.fonts}),icons:Object.assign({...Xg.icons},{...t?.icons}),embedIcons:Object.assign({...Xg.embedIcons},{...t?.embedIcons}),translations:Object.assign({...Xg.translations},{...t?.translations})}:Xg,[t])}const fJ=_r(function({overrides:e,components:n,assetUrls:r,onUiEvent:i,forceMobile:o,mediaMimeTypes:s,children:a}){const l=hr();return g.jsx($Y.Provider,{value:s,children:g.jsx(SCe,{children:g.jsx(KV,{assetUrls:pJ(r),children:g.jsx(YV,{overrides:LY(e),locale:l?.user.getLocale()??Fo.locale,children:g.jsx(hCe,{onEvent:i,children:g.jsx(DY,{children:g.jsx(CCe,{context:"tla",children:g.jsx(Cbe,{children:g.jsx(cCe,{forceMobile:o,children:g.jsx(nAe,{overrides:n,children:g.jsx(j$e,{overrides:e,children:a})})})})})})})})})})})});function j$e({overrides:t,children:e}){const n=QCe(t);return g.jsx(iAe,{overrides:n.actions,children:g.jsx(ePe,{overrides:n.tools,children:e})})}function R$e(){const t=ne(),{addToast:e}=Nl();I.useEffect(()=>{function n({name:r,count:i}){e({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${r} (${i}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return t.addListener("max-shapes",n),()=>{t.removeListener("max-shapes",n)}},[t,e])}const $$e=rt.memo(function({renderDebugMenuItems:e,children:n,hideUi:r,components:i,...o}){return g.jsx(fJ,{...o,components:i,children:g.jsx(N$e,{hideUi:r,renderDebugMenuItems:e,children:n})})}),N$e=rt.memo(function({children:e,hideUi:n,...r}){return g.jsxs(g.Fragment,{children:[e,n?null:g.jsx(L$e,{...r})]})}),L$e=rt.memo(function(){const e=ne(),n=Ve(),r=Ci(),i=Os(),o=J("focus",()=>e.getInstanceState().isFocusMode,[e]),s=J("debug",()=>e.getInstanceState().isDebugMode,[e]),{SharePanel:a,TopPanel:l,MenuPanel:c,StylePanel:d,Toolbar:u,HelpMenu:p,NavigationPanel:f,HelperButtons:y,DebugPanel:v,Toasts:x,Dialogs:b,A11y:w}=zl();F2e(),HCe(),R$e();const _=I.useRef(!1),C=I.useRef(-1),[A,E]=I.useState(!1);E2("update hide toolbar while delayed",()=>{if(!(Jt.isIos||Jt.isAndroid))return;if(e.getEditingShapeId()===null){_.current&&(_.current=!1,clearTimeout(C.current),Jt.isAndroid?C.current=e.timers.setTimeout(()=>{E(!1)},150):E(!1));return}_.current||(_.current=!0,clearTimeout(C.current),E(!0))},[]);const{"toggle-focus-mode":O}=Fl(),{breakpointsAbove:D,breakpointsBelow:B}=I.useMemo(()=>{const L=[],j=[];for(let F=0;F<KS.length;F++)F<=r?L.push(F):j.push(F);return{breakpointsAbove:L,breakpointsBelow:j}},[r]);return g.jsxs("div",{className:Ye("tlui-layout",{"tlui-layout__mobile":r<nr.TABLET_SM}),"data-iseditinganything":A,"data-breakpoint":r,"data-breakpoints-above":D.join(" "),"data-breakpoints-below":B.join(" "),children:[g.jsx(Abe,{}),o?g.jsx("div",{className:"tlui-layout__top",children:g.jsx(It,{type:"icon",className:"tlui-focus-button",title:n("focus-mode.toggle-focus-mode"),onClick:()=>O.onSelect("menu"),children:g.jsx(it,{icon:"dot"})})}):g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"tlui-layout__top",children:[g.jsxs("div",{className:"tlui-layout__top__left",children:[c&&g.jsx(c,{}),y&&g.jsx(y,{})]}),g.jsx("div",{className:"tlui-layout__top__center",children:l&&g.jsx(l,{})}),g.jsxs("div",{className:"tlui-layout__top__right",children:[a&&g.jsx(a,{}),d&&r>=nr.TABLET_SM&&!i&&g.jsx(d,{})]})]}),g.jsxs("div",{className:"tlui-layout__bottom",children:[g.jsxs("div",{className:"tlui-layout__bottom__main",children:[f&&g.jsx(f,{}),u&&g.jsx(u,{}),p&&g.jsx(p,{})]}),s&&v&&g.jsx(v,{}),w&&g.jsx(w,{})]})]}),x&&g.jsx(x,{}),b&&g.jsx(b,{})]})});function K6(){const{RichTextToolbar:t,ImageToolbar:e,VideoToolbar:n,CursorChatBubble:r,FollowingIndicator:i}=zl();return g.jsxs(g.Fragment,{children:[t&&g.jsx(t,{}),e&&g.jsx(e,{}),n&&g.jsx(n,{}),i&&g.jsx(i,{}),r&&g.jsx(r,{})]})}const z$e=()=>{const{Spinner:t}=gn();return g.jsx(L7,{children:t?g.jsx(t,{}):null})},F$e=[...M$e,...jDe];function B$e(t){const{children:e,maxImageDimension:n,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:o,onMount:s,components:a={},shapeUtils:l=[],bindingUtils:c=[],tools:d=[],embeds:u,textOptions:p,...f}=t,y=Of(a),v=a?.InFrontOfTheCanvas,x=I.useMemo(()=>f.hideUi?v??null:v?()=>g.jsxs(g.Fragment,{children:[g.jsx(K6,{}),g.jsx(v,{})]}):K6,[f.hideUi,v]),b=I.useMemo(()=>({Scribble:i6,ShapeIndicators:GAe,CollaboratorScribble:i6,SelectionForeground:VAe,Handles:RAe,Overlays:zAe,Spinner:TY,LoadingScreen:z$e,...y,InFrontOfTheCanvas:x}),[y,x]),w=gu(l),_=I.useMemo(()=>Pm("type",w,yO),[w]),C=gu(c),A=I.useMemo(()=>Pm("type",C,ZM),[C]),E=gu(d),O=I.useMemo(()=>Pm("id",E,F$e),[E]),D=gu(i??Pf),B=gu(o??zw),L=I.useMemo(()=>({addFontsFromNode:cO,...p,tipTapConfig:{extensions:Vf,...p?.tipTapConfig}}),[p]),j=I.useMemo(()=>[...D,...B],[D,B]),F=hJ(f.assetUrls);return _.find($=>$.type==="embed")&&u&&ef.setEmbedDefinitions(u),g.jsx(KV,{assetUrls:pJ(f.assetUrls),children:g.jsx(YV,{overrides:LY(f.overrides),locale:f.user?.userPreferences.get().locale??Fo.locale,children:g.jsx(R7,{initialState:"select",...f,components:b,shapeUtils:_,bindingUtils:A,tools:O,textOptions:L,assetUrls:F,children:g.jsxs($$e,{...f,components:b,mediaMimeTypes:j,children:[g.jsx(U$e,{maxImageDimension:n,maxAssetSize:r,acceptedImageMimeTypes:D,acceptedVideoMimeTypes:B,onMount:s}),e]})})})})}function U$e({maxImageDimension:t,maxAssetSize:e,acceptedImageMimeTypes:n,acceptedVideoMimeTypes:r,onMount:i}){const o=ne(),s=Nl(),a=Ve(),l=qn();z7(()=>{const u=[];return u.push(TRe(o)),o.fonts.requestFonts($Oe),o.once("edit",()=>l("edit",{source:"unknown"})),ZOe(o,{maxImageDimension:t,maxAssetSize:e,acceptedImageMimeTypes:n,acceptedVideoMimeTypes:r,toasts:s,msg:a}),u.push(o.store.props.onMount(o)),u.push(i?.(o)),()=>{u.forEach(p=>p?.())}});const{Canvas:c}=gn(),{ContextMenu:d}=zl();return d?g.jsx(d,{}):c?g.jsx(c,{}):null}const H$e={tipTapConfig:{extensions:Vf},addFontsFromNode:cO};I.memo(function(e){const[n,r]=I.useState(null),[i,o]=I.useState(null),s=gu(e.shapeUtils??[]),a=I.useMemo(()=>Pm("type",s,yO),[s]),l=gu(e.bindingUtils??[]),c=I.useMemo(()=>Pm("type",l,ZM),[l]),d=gme({snapshot:e.snapshot,shapeUtils:a}),{pageId:u,bounds:p,scale:f,pixelRatio:y,background:v,padding:x,darkMode:b,preserveAspectRatio:w,format:_="svg",licenseKey:C,assetUrls:A,textOptions:E=H$e}=e,O=hJ(A);return I.useLayoutEffect(()=>{if(!i||!d)return;let D=!1;const B=document.createElement("div");i.appendChild(B),i.classList.add("tl-container","tl-theme__light");const L=new Ne({store:d,shapeUtils:a,bindingUtils:c,tools:[],getContainer:()=>B,licenseKey:C,fontAssetUrls:O.fonts,textOptions:E});u&&L.setCurrentPage(u);const j=L.getCurrentPageShapeIds();async function F(){await L.fonts.loadRequiredFontsForCurrentPage(L.options.maxFontsToLoadBeforeRender);const z=await L.toImage([...j],{bounds:p,scale:f,background:v,padding:x,darkMode:b,preserveAspectRatio:w,format:_});if(!z||D)return;const $=URL.createObjectURL(z.blob);r($),L.dispose()}return F(),()=>{D=!0}},[_,i,d,a,c,u,p,f,v,x,b,w,C,y,O,E]),I.useEffect(()=>()=>{n&&URL.revokeObjectURL(n)},[n]),g.jsx("div",{ref:o,style:{position:"relative",width:"100%",height:"100%"},children:n&&g.jsx("img",{src:n,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})})});I.memo(function({children:e}){const n=Ve(),r=Ci(),i=I.useRef(null);Rl(i);const o=e??g.jsx(vTe,{});return r<nr.MOBILE?null:g.jsx("div",{ref:i,className:"tlui-help-menu",children:g.jsxs(d1,{id:"help menu",children:[g.jsx(h1,{children:g.jsx(It,{type:"help",title:n("help-menu.title"),"data-testid":"help-menu.button",children:g.jsx(it,{icon:"question-mark",small:!0})})}),g.jsx(p1,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:g.jsx(qi,{type:"menu",sourceId:"help-menu",children:o})})]})})});const W$e=Lt({schemaVersion:Ki(1),storeVersion:RS,recordVersions:ab(_t,Lt({version:RS,subTypeVersions:ab(_t,RS).optional(),subTypeKey:_t.optional()}))}),V$e=Lt({schemaVersion:Ki(2),sequences:ab(_t,RS)});Lt({tldrawFileFormatVersion:vle,schema:xle("schemaVersion",{1:W$e,2:V$e}),records:Jr(Lt({id:_t,typeName:_t}).allowUnknownProperties())});Fu("tldraw","4.1.1","esm");const gJ=Object.freeze({status:"aborted"});function se(t,e,n){function r(a,l){var c;Object.defineProperty(a,"_zod",{value:a._zod??{},enumerable:!1}),(c=a._zod).traits??(c.traits=new Set),a._zod.traits.add(t),e(a,l);for(const d in s.prototype)d in a||Object.defineProperty(a,d,{value:s.prototype[d].bind(a)});a._zod.constr=s,a._zod.def=l}const i=n?.Parent??Object;class o extends i{}Object.defineProperty(o,"name",{value:t});function s(a){var l;const c=n?.Parent?new o:this;r(c,a),(l=c._zod).deferred??(l.deferred=[]);for(const d of c._zod.deferred)d();return c}return Object.defineProperty(s,"init",{value:r}),Object.defineProperty(s,Symbol.hasInstance,{value:a=>n?.Parent&&a instanceof n.Parent?!0:a?._zod?.traits?.has(t)}),Object.defineProperty(s,"name",{value:t}),s}const mJ=Symbol("zod_brand");class qd extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class P1 extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}}const Cw={};function Io(t){return t&&Object.assign(Cw,t),Cw}function K$e(t){return t}function q$e(t){return t}function G$e(t){}function Y$e(t){throw new Error}function X$e(t){}function SO(t){const e=Object.values(t).filter(r=>typeof r=="number");return Object.entries(t).filter(([r,i])=>e.indexOf(+r)===-1).map(([r,i])=>i)}function De(t,e="|"){return t.map(n=>yt(n)).join(e)}function Pw(t,e){return typeof e=="bigint"?e.toString():e}function bv(t){return{get value(){{const e=t();return Object.defineProperty(this,"value",{value:e}),e}}}}function Ah(t){return t==null}function T1(t){const e=t.startsWith("^")?1:0,n=t.endsWith("$")?t.length-1:t.length;return t.slice(e,n)}function yJ(t,e){const n=(t.toString().split(".")[1]||"").length,r=e.toString();let i=(r.split(".")[1]||"").length;if(i===0&&/\d?e-\d?/.test(r)){const l=r.match(/\d?e-(\d?)/);l?.[1]&&(i=Number.parseInt(l[1]))}const o=n>i?n:i,s=Number.parseInt(t.toFixed(o).replace(".","")),a=Number.parseInt(e.toFixed(o).replace(".",""));return s%a/10**o}const q6=Symbol("evaluating");function Bt(t,e,n){let r;Object.defineProperty(t,e,{get(){if(r!==q6)return r===void 0&&(r=q6,r=n()),r},set(i){Object.defineProperty(t,e,{value:i})},configurable:!0})}function Z$e(t){return Object.create(Object.getPrototypeOf(t),Object.getOwnPropertyDescriptors(t))}function nd(t,e,n){Object.defineProperty(t,e,{value:n,writable:!0,enumerable:!0,configurable:!0})}function Pc(...t){const e={};for(const n of t){const r=Object.getOwnPropertyDescriptors(n);Object.assign(e,r)}return Object.defineProperties({},e)}function J$e(t){return Pc(t._zod.def)}function Q$e(t,e){return e?e.reduce((n,r)=>n?.[r],t):t}function eNe(t){const e=Object.keys(t),n=e.map(r=>t[r]);return Promise.all(n).then(r=>{const i={};for(let o=0;o<e.length;o++)i[e[o]]=r[o];return i})}function tNe(t=10){const e="abcdefghijklmnopqrstuvwxyz";let n="";for(let r=0;r<t;r++)n+=e[Math.floor(Math.random()*e.length)];return n}function HE(t){return JSON.stringify(t)}const bO="captureStackTrace"in Error?Error.captureStackTrace:(...t)=>{};function wf(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}const vJ=bv(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const t=Function;return new t(""),!0}catch{return!1}});function fh(t){if(wf(t)===!1)return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(wf(n)===!1||Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")===!1)}function E1(t){return fh(t)?{...t}:Array.isArray(t)?[...t]:t}function nNe(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}const rNe=t=>{const e=typeof t;switch(e){case"undefined":return"undefined";case"string":return"string";case"number":return Number.isNaN(t)?"nan":"number";case"boolean":return"boolean";case"function":return"function";case"bigint":return"bigint";case"symbol":return"symbol";case"object":return Array.isArray(t)?"array":t===null?"null":t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?"promise":typeof Map<"u"&&t instanceof Map?"map":typeof Set<"u"&&t instanceof Set?"set":typeof Date<"u"&&t instanceof Date?"date":typeof File<"u"&&t instanceof File?"file":"object";default:throw new Error(`Unknown data type: ${e}`)}},Tw=new Set(["string","number","symbol"]),xJ=new Set(["string","number","bigint","boolean","symbol","undefined"]);function zu(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function ma(t,e,n){const r=new t._zod.constr(e??t._zod.def);return(!e||n?.parent)&&(r._zod.parent=t),r}function be(t){const e=t;if(!e)return{};if(typeof e=="string")return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");e.error=e.message}return delete e.message,typeof e.error=="string"?{...e,error:()=>e.error}:e}function iNe(t){let e;return new Proxy({},{get(n,r,i){return e??(e=t()),Reflect.get(e,r,i)},set(n,r,i,o){return e??(e=t()),Reflect.set(e,r,i,o)},has(n,r){return e??(e=t()),Reflect.has(e,r)},deleteProperty(n,r){return e??(e=t()),Reflect.deleteProperty(e,r)},ownKeys(n){return e??(e=t()),Reflect.ownKeys(e)},getOwnPropertyDescriptor(n,r){return e??(e=t()),Reflect.getOwnPropertyDescriptor(e,r)},defineProperty(n,r,i){return e??(e=t()),Reflect.defineProperty(e,r,i)}})}function yt(t){return typeof t=="bigint"?t.toString()+"n":typeof t=="string"?`"${t}"`:`${t}`}function SJ(t){return Object.keys(t).filter(e=>t[e]._zod.optin==="optional"&&t[e]._zod.optout==="optional")}const bJ={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]},wJ={int64:[BigInt("-9223372036854775808"),BigInt("9223372036854775807")],uint64:[BigInt(0),BigInt("18446744073709551615")]};function kJ(t,e){const n=t._zod.def,r=Pc(t._zod.def,{get shape(){const i={};for(const o in e){if(!(o in n.shape))throw new Error(`Unrecognized key: "${o}"`);e[o]&&(i[o]=n.shape[o])}return nd(this,"shape",i),i},checks:[]});return ma(t,r)}function IJ(t,e){const n=t._zod.def,r=Pc(t._zod.def,{get shape(){const i={...t._zod.def.shape};for(const o in e){if(!(o in n.shape))throw new Error(`Unrecognized key: "${o}"`);e[o]&&delete i[o]}return nd(this,"shape",i),i},checks:[]});return ma(t,r)}function _J(t,e){if(!fh(e))throw new Error("Invalid input to extend: expected a plain object");const n=t._zod.def.checks;if(n&&n.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const i=Pc(t._zod.def,{get shape(){const o={...t._zod.def.shape,...e};return nd(this,"shape",o),o},checks:[]});return ma(t,i)}function CJ(t,e){if(!fh(e))throw new Error("Invalid input to safeExtend: expected a plain object");const n={...t._zod.def,get shape(){const r={...t._zod.def.shape,...e};return nd(this,"shape",r),r},checks:t._zod.def.checks};return ma(t,n)}function PJ(t,e){const n=Pc(t._zod.def,{get shape(){const r={...t._zod.def.shape,...e._zod.def.shape};return nd(this,"shape",r),r},get catchall(){return e._zod.def.catchall},checks:[]});return ma(t,n)}function TJ(t,e,n){const r=Pc(e._zod.def,{get shape(){const i=e._zod.def.shape,o={...i};if(n)for(const s in n){if(!(s in i))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(o[s]=t?new t({type:"optional",innerType:i[s]}):i[s])}else for(const s in i)o[s]=t?new t({type:"optional",innerType:i[s]}):i[s];return nd(this,"shape",o),o},checks:[]});return ma(e,r)}function EJ(t,e,n){const r=Pc(e._zod.def,{get shape(){const i=e._zod.def.shape,o={...i};if(n)for(const s in n){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);n[s]&&(o[s]=new t({type:"nonoptional",innerType:i[s]}))}else for(const s in i)o[s]=new t({type:"nonoptional",innerType:i[s]});return nd(this,"shape",o),o},checks:[]});return ma(e,r)}function Ld(t,e=0){if(t.aborted===!0)return!0;for(let n=e;n<t.issues.length;n++)if(t.issues[n]?.continue!==!0)return!0;return!1}function La(t,e){return e.map(n=>{var r;return(r=n).path??(r.path=[]),n.path.unshift(t),n})}function _m(t){return typeof t=="string"?t:t?.message}function Ga(t,e,n){const r={...t,path:t.path??[]};if(!t.message){const i=_m(t.inst?._zod.def?.error?.(t))??_m(e?.error?.(t))??_m(n.customError?.(t))??_m(n.localeError?.(t))??"Invalid input";r.message=i}return delete r.inst,delete r.continue,e?.reportInput||delete r.input,r}function A1(t){return t instanceof Set?"set":t instanceof Map?"map":t instanceof File?"file":"unknown"}function M1(t){return Array.isArray(t)?"array":typeof t=="string"?"string":"unknown"}function kf(...t){const[e,n,r]=t;return typeof e=="string"?{message:e,code:"custom",input:n,inst:r}:{...e}}function oNe(t){return Object.entries(t).filter(([e,n])=>Number.isNaN(Number.parseInt(e,10))).map(e=>e[1])}function AJ(t){const e=atob(t),n=new Uint8Array(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n}function MJ(t){let e="";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function sNe(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),n="=".repeat((4-e.length%4)%4);return AJ(e+n)}function aNe(t){return MJ(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function lNe(t){const e=t.replace(/^0x/,"");if(e.length%2!==0)throw new Error("Invalid hex string length");const n=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)n[r/2]=Number.parseInt(e.slice(r,r+2),16);return n}function cNe(t){return Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join("")}class uNe{constructor(...e){}}const OJ=Object.freeze(Object.defineProperty({__proto__:null,BIGINT_FORMAT_RANGES:wJ,Class:uNe,NUMBER_FORMAT_RANGES:bJ,aborted:Ld,allowsEval:vJ,assert:X$e,assertEqual:K$e,assertIs:G$e,assertNever:Y$e,assertNotEqual:q$e,assignProp:nd,base64ToUint8Array:AJ,base64urlToUint8Array:sNe,cached:bv,captureStackTrace:bO,cleanEnum:oNe,cleanRegex:T1,clone:ma,cloneDef:J$e,createTransparentProxy:iNe,defineLazy:Bt,esc:HE,escapeRegex:zu,extend:_J,finalizeIssue:Ga,floatSafeRemainder:yJ,getElementAtPath:Q$e,getEnumValues:SO,getLengthableOrigin:M1,getParsedType:rNe,getSizableOrigin:A1,hexToUint8Array:lNe,isObject:wf,isPlainObject:fh,issue:kf,joinValues:De,jsonStringifyReplacer:Pw,merge:PJ,mergeDefs:Pc,normalizeParams:be,nullish:Ah,numKeys:nNe,objectClone:Z$e,omit:IJ,optionalKeys:SJ,partial:TJ,pick:kJ,prefixIssues:La,primitiveTypes:xJ,promiseAllObject:eNe,propertyKeyTypes:Tw,randomString:tNe,required:EJ,safeExtend:CJ,shallowClone:E1,stringifyPrimitive:yt,uint8ArrayToBase64:MJ,uint8ArrayToBase64url:aNe,uint8ArrayToHex:cNe,unwrapMessage:_m},Symbol.toStringTag,{value:"Module"})),DJ=(t,e)=>{t.name="$ZodError",Object.defineProperty(t,"_zod",{value:t._zod,enumerable:!1}),Object.defineProperty(t,"issues",{value:e,enumerable:!1}),t.message=JSON.stringify(e,Pw,2),Object.defineProperty(t,"toString",{value:()=>t.message,enumerable:!1})},wO=se("$ZodError",DJ),Rs=se("$ZodError",DJ,{Parent:Error});function kO(t,e=n=>n.message){const n={},r=[];for(const i of t.issues)i.path.length>0?(n[i.path[0]]=n[i.path[0]]||[],n[i.path[0]].push(e(i))):r.push(e(i));return{formErrors:r,fieldErrors:n}}function IO(t,e=n=>n.message){const n={_errors:[]},r=i=>{for(const o of i.issues)if(o.code==="invalid_union"&&o.errors.length)o.errors.map(s=>r({issues:s}));else if(o.code==="invalid_key")r({issues:o.issues});else if(o.code==="invalid_element")r({issues:o.issues});else if(o.path.length===0)n._errors.push(e(o));else{let s=n,a=0;for(;a<o.path.length;){const l=o.path[a];a===o.path.length-1?(s[l]=s[l]||{_errors:[]},s[l]._errors.push(e(o))):s[l]=s[l]||{_errors:[]},s=s[l],a++}}};return r(t),n}function jJ(t,e=n=>n.message){const n={errors:[]},r=(i,o=[])=>{var s,a;for(const l of i.issues)if(l.code==="invalid_union"&&l.errors.length)l.errors.map(c=>r({issues:c},l.path));else if(l.code==="invalid_key")r({issues:l.issues},l.path);else if(l.code==="invalid_element")r({issues:l.issues},l.path);else{const c=[...o,...l.path];if(c.length===0){n.errors.push(e(l));continue}let d=n,u=0;for(;u<c.length;){const p=c[u],f=u===c.length-1;typeof p=="string"?(d.properties??(d.properties={}),(s=d.properties)[p]??(s[p]={errors:[]}),d=d.properties[p]):(d.items??(d.items=[]),(a=d.items)[p]??(a[p]={errors:[]}),d=d.items[p]),f&&d.errors.push(e(l)),u++}}};return r(t),n}function RJ(t){const e=[],n=t.map(r=>typeof r=="object"?r.key:r);for(const r of n)typeof r=="number"?e.push(`[${r}]`):typeof r=="symbol"?e.push(`[${JSON.stringify(String(r))}]`):/[^\w$]/.test(r)?e.push(`[${JSON.stringify(r)}]`):(e.length&&e.push("."),e.push(r));return e.join("")}function $J(t){const e=[],n=[...t.issues].sort((r,i)=>(r.path??[]).length-(i.path??[]).length);for(const r of n)e.push(`✖ ${r.message}`),r.path?.length&&e.push(`  → at ${RJ(r.path)}`);return e.join(`
`)}const wv=t=>(e,n,r,i)=>{const o=r?Object.assign(r,{async:!1}):{async:!1},s=e._zod.run({value:n,issues:[]},o);if(s instanceof Promise)throw new qd;if(s.issues.length){const a=new(i?.Err??t)(s.issues.map(l=>Ga(l,o,Io())));throw bO(a,i?.callee),a}return s.value},WE=wv(Rs),kv=t=>async(e,n,r,i)=>{const o=r?Object.assign(r,{async:!0}):{async:!0};let s=e._zod.run({value:n,issues:[]},o);if(s instanceof Promise&&(s=await s),s.issues.length){const a=new(i?.Err??t)(s.issues.map(l=>Ga(l,o,Io())));throw bO(a,i?.callee),a}return s.value},VE=kv(Rs),Iv=t=>(e,n,r)=>{const i=r?{...r,async:!1}:{async:!1},o=e._zod.run({value:n,issues:[]},i);if(o instanceof Promise)throw new qd;return o.issues.length?{success:!1,error:new(t??wO)(o.issues.map(s=>Ga(s,i,Io())))}:{success:!0,data:o.value}},NJ=Iv(Rs),_v=t=>async(e,n,r)=>{const i=r?Object.assign(r,{async:!0}):{async:!0};let o=e._zod.run({value:n,issues:[]},i);return o instanceof Promise&&(o=await o),o.issues.length?{success:!1,error:new t(o.issues.map(s=>Ga(s,i,Io())))}:{success:!0,data:o.value}},LJ=_v(Rs),_O=t=>(e,n,r)=>{const i=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return wv(t)(e,n,i)},dNe=_O(Rs),CO=t=>(e,n,r)=>wv(t)(e,n,r),hNe=CO(Rs),PO=t=>async(e,n,r)=>{const i=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return kv(t)(e,n,i)},pNe=PO(Rs),TO=t=>async(e,n,r)=>kv(t)(e,n,r),fNe=TO(Rs),EO=t=>(e,n,r)=>{const i=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return Iv(t)(e,n,i)},gNe=EO(Rs),AO=t=>(e,n,r)=>Iv(t)(e,n,r),mNe=AO(Rs),MO=t=>async(e,n,r)=>{const i=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return _v(t)(e,n,i)},yNe=MO(Rs),OO=t=>async(e,n,r)=>_v(t)(e,n,r),vNe=OO(Rs),zJ=/^[cC][^\s-]{8,}$/,FJ=/^[0-9a-z]+$/,BJ=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,UJ=/^[0-9a-vA-V]{20}$/,HJ=/^[A-Za-z0-9]{27}$/,WJ=/^[a-zA-Z0-9_-]{21}$/,VJ=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,xNe=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,KJ=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,If=t=>t?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${t}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,SNe=If(4),bNe=If(6),wNe=If(7),qJ=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,kNe=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,INe=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,GJ=/^[^\s@"]{1,64}@[^\s@]{1,255}$/u,_Ne=GJ,CNe=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,PNe="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function YJ(){return new RegExp(PNe,"u")}const XJ=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ZJ=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,JJ=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,QJ=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,eQ=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,DO=/^[A-Za-z0-9_-]*$/,jO=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,tQ=/^([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/,nQ=/^\+(?:[0-9]){6,14}[0-9]$/,rQ="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",iQ=new RegExp(`^${rQ}$`);function oQ(t){const e="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof t.precision=="number"?t.precision===-1?`${e}`:t.precision===0?`${e}:[0-5]\\d`:`${e}:[0-5]\\d\\.\\d{${t.precision}}`:`${e}(?::[0-5]\\d(?:\\.\\d+)?)?`}function sQ(t){return new RegExp(`^${oQ(t)}$`)}function aQ(t){const e=oQ({precision:t.precision}),n=["Z"];t.local&&n.push(""),t.offset&&n.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const r=`${e}(?:${n.join("|")})`;return new RegExp(`^${rQ}T(?:${r})$`)}const lQ=t=>{const e=t?`[\\s\\S]{${t?.minimum??0},${t?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${e}$`)},cQ=/^-?\d+n?$/,uQ=/^-?\d+$/,dQ=/^-?\d+(?:\.\d+)?/,hQ=/^(?:true|false)$/i,pQ=/^null$/i,fQ=/^undefined$/i,gQ=/^[^A-Z]*$/,mQ=/^[^a-z]*$/,yQ=/^[0-9a-fA-F]*$/;function Cv(t,e){return new RegExp(`^[A-Za-z0-9+/]{${t}}${e}$`)}function Pv(t){return new RegExp(`^[A-Za-z0-9_-]{${t}}$`)}const TNe=/^[0-9a-fA-F]{32}$/,ENe=Cv(22,"=="),ANe=Pv(22),MNe=/^[0-9a-fA-F]{40}$/,ONe=Cv(27,"="),DNe=Pv(27),jNe=/^[0-9a-fA-F]{64}$/,RNe=Cv(43,"="),$Ne=Pv(43),NNe=/^[0-9a-fA-F]{96}$/,LNe=Cv(64,""),zNe=Pv(64),FNe=/^[0-9a-fA-F]{128}$/,BNe=Cv(86,"=="),UNe=Pv(86),RO=Object.freeze(Object.defineProperty({__proto__:null,base64:eQ,base64url:DO,bigint:cQ,boolean:hQ,browserEmail:CNe,cidrv4:JJ,cidrv6:QJ,cuid:zJ,cuid2:FJ,date:iQ,datetime:aQ,domain:tQ,duration:VJ,e164:nQ,email:qJ,emoji:YJ,extendedDuration:xNe,guid:KJ,hex:yQ,hostname:jO,html5Email:kNe,idnEmail:_Ne,integer:uQ,ipv4:XJ,ipv6:ZJ,ksuid:HJ,lowercase:gQ,md5_base64:ENe,md5_base64url:ANe,md5_hex:TNe,nanoid:WJ,null:pQ,number:dQ,rfc5322Email:INe,sha1_base64:ONe,sha1_base64url:DNe,sha1_hex:MNe,sha256_base64:RNe,sha256_base64url:$Ne,sha256_hex:jNe,sha384_base64:LNe,sha384_base64url:zNe,sha384_hex:NNe,sha512_base64:BNe,sha512_base64url:UNe,sha512_hex:FNe,string:lQ,time:sQ,ulid:BJ,undefined:fQ,unicodeEmail:GJ,uppercase:mQ,uuid:If,uuid4:SNe,uuid6:bNe,uuid7:wNe,xid:UJ},Symbol.toStringTag,{value:"Module"})),pr=se("$ZodCheck",(t,e)=>{var n;t._zod??(t._zod={}),t._zod.def=e,(n=t._zod).onattach??(n.onattach=[])}),vQ={number:"number",bigint:"bigint",object:"date"},$O=se("$ZodCheckLessThan",(t,e)=>{pr.init(t,e);const n=vQ[typeof e.value];t._zod.onattach.push(r=>{const i=r._zod.bag,o=(e.inclusive?i.maximum:i.exclusiveMaximum)??Number.POSITIVE_INFINITY;e.value<o&&(e.inclusive?i.maximum=e.value:i.exclusiveMaximum=e.value)}),t._zod.check=r=>{(e.inclusive?r.value<=e.value:r.value<e.value)||r.issues.push({origin:n,code:"too_big",maximum:e.value,input:r.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),NO=se("$ZodCheckGreaterThan",(t,e)=>{pr.init(t,e);const n=vQ[typeof e.value];t._zod.onattach.push(r=>{const i=r._zod.bag,o=(e.inclusive?i.minimum:i.exclusiveMinimum)??Number.NEGATIVE_INFINITY;e.value>o&&(e.inclusive?i.minimum=e.value:i.exclusiveMinimum=e.value)}),t._zod.check=r=>{(e.inclusive?r.value>=e.value:r.value>e.value)||r.issues.push({origin:n,code:"too_small",minimum:e.value,input:r.value,inclusive:e.inclusive,inst:t,continue:!e.abort})}}),xQ=se("$ZodCheckMultipleOf",(t,e)=>{pr.init(t,e),t._zod.onattach.push(n=>{var r;(r=n._zod.bag).multipleOf??(r.multipleOf=e.value)}),t._zod.check=n=>{if(typeof n.value!=typeof e.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof n.value=="bigint"?n.value%e.value===BigInt(0):yJ(n.value,e.value)===0)||n.issues.push({origin:typeof n.value,code:"not_multiple_of",divisor:e.value,input:n.value,inst:t,continue:!e.abort})}}),SQ=se("$ZodCheckNumberFormat",(t,e)=>{pr.init(t,e),e.format=e.format||"float64";const n=e.format?.includes("int"),r=n?"int":"number",[i,o]=bJ[e.format];t._zod.onattach.push(s=>{const a=s._zod.bag;a.format=e.format,a.minimum=i,a.maximum=o,n&&(a.pattern=uQ)}),t._zod.check=s=>{const a=s.value;if(n){if(!Number.isInteger(a)){s.issues.push({expected:r,format:e.format,code:"invalid_type",continue:!1,input:a,inst:t});return}if(!Number.isSafeInteger(a)){a>0?s.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:r,continue:!e.abort}):s.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:t,origin:r,continue:!e.abort});return}}a<i&&s.issues.push({origin:"number",input:a,code:"too_small",minimum:i,inclusive:!0,inst:t,continue:!e.abort}),a>o&&s.issues.push({origin:"number",input:a,code:"too_big",maximum:o,inst:t})}}),bQ=se("$ZodCheckBigIntFormat",(t,e)=>{pr.init(t,e);const[n,r]=wJ[e.format];t._zod.onattach.push(i=>{const o=i._zod.bag;o.format=e.format,o.minimum=n,o.maximum=r}),t._zod.check=i=>{const o=i.value;o<n&&i.issues.push({origin:"bigint",input:o,code:"too_small",minimum:n,inclusive:!0,inst:t,continue:!e.abort}),o>r&&i.issues.push({origin:"bigint",input:o,code:"too_big",maximum:r,inst:t})}}),wQ=se("$ZodCheckMaxSize",(t,e)=>{var n;pr.init(t,e),(n=t._zod.def).when??(n.when=r=>{const i=r.value;return!Ah(i)&&i.size!==void 0}),t._zod.onattach.push(r=>{const i=r._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<i&&(r._zod.bag.maximum=e.maximum)}),t._zod.check=r=>{const i=r.value;i.size<=e.maximum||r.issues.push({origin:A1(i),code:"too_big",maximum:e.maximum,inclusive:!0,input:i,inst:t,continue:!e.abort})}}),kQ=se("$ZodCheckMinSize",(t,e)=>{var n;pr.init(t,e),(n=t._zod.def).when??(n.when=r=>{const i=r.value;return!Ah(i)&&i.size!==void 0}),t._zod.onattach.push(r=>{const i=r._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>i&&(r._zod.bag.minimum=e.minimum)}),t._zod.check=r=>{const i=r.value;i.size>=e.minimum||r.issues.push({origin:A1(i),code:"too_small",minimum:e.minimum,inclusive:!0,input:i,inst:t,continue:!e.abort})}}),IQ=se("$ZodCheckSizeEquals",(t,e)=>{var n;pr.init(t,e),(n=t._zod.def).when??(n.when=r=>{const i=r.value;return!Ah(i)&&i.size!==void 0}),t._zod.onattach.push(r=>{const i=r._zod.bag;i.minimum=e.size,i.maximum=e.size,i.size=e.size}),t._zod.check=r=>{const i=r.value,o=i.size;if(o===e.size)return;const s=o>e.size;r.issues.push({origin:A1(i),...s?{code:"too_big",maximum:e.size}:{code:"too_small",minimum:e.size},inclusive:!0,exact:!0,input:r.value,inst:t,continue:!e.abort})}}),_Q=se("$ZodCheckMaxLength",(t,e)=>{var n;pr.init(t,e),(n=t._zod.def).when??(n.when=r=>{const i=r.value;return!Ah(i)&&i.length!==void 0}),t._zod.onattach.push(r=>{const i=r._zod.bag.maximum??Number.POSITIVE_INFINITY;e.maximum<i&&(r._zod.bag.maximum=e.maximum)}),t._zod.check=r=>{const i=r.value;if(i.length<=e.maximum)return;const s=M1(i);r.issues.push({origin:s,code:"too_big",maximum:e.maximum,inclusive:!0,input:i,inst:t,continue:!e.abort})}}),CQ=se("$ZodCheckMinLength",(t,e)=>{var n;pr.init(t,e),(n=t._zod.def).when??(n.when=r=>{const i=r.value;return!Ah(i)&&i.length!==void 0}),t._zod.onattach.push(r=>{const i=r._zod.bag.minimum??Number.NEGATIVE_INFINITY;e.minimum>i&&(r._zod.bag.minimum=e.minimum)}),t._zod.check=r=>{const i=r.value;if(i.length>=e.minimum)return;const s=M1(i);r.issues.push({origin:s,code:"too_small",minimum:e.minimum,inclusive:!0,input:i,inst:t,continue:!e.abort})}}),PQ=se("$ZodCheckLengthEquals",(t,e)=>{var n;pr.init(t,e),(n=t._zod.def).when??(n.when=r=>{const i=r.value;return!Ah(i)&&i.length!==void 0}),t._zod.onattach.push(r=>{const i=r._zod.bag;i.minimum=e.length,i.maximum=e.length,i.length=e.length}),t._zod.check=r=>{const i=r.value,o=i.length;if(o===e.length)return;const s=M1(i),a=o>e.length;r.issues.push({origin:s,...a?{code:"too_big",maximum:e.length}:{code:"too_small",minimum:e.length},inclusive:!0,exact:!0,input:r.value,inst:t,continue:!e.abort})}}),Tv=se("$ZodCheckStringFormat",(t,e)=>{var n,r;pr.init(t,e),t._zod.onattach.push(i=>{const o=i._zod.bag;o.format=e.format,e.pattern&&(o.patterns??(o.patterns=new Set),o.patterns.add(e.pattern))}),e.pattern?(n=t._zod).check??(n.check=i=>{e.pattern.lastIndex=0,!e.pattern.test(i.value)&&i.issues.push({origin:"string",code:"invalid_format",format:e.format,input:i.value,...e.pattern?{pattern:e.pattern.toString()}:{},inst:t,continue:!e.abort})}):(r=t._zod).check??(r.check=()=>{})}),TQ=se("$ZodCheckRegex",(t,e)=>{Tv.init(t,e),t._zod.check=n=>{e.pattern.lastIndex=0,!e.pattern.test(n.value)&&n.issues.push({origin:"string",code:"invalid_format",format:"regex",input:n.value,pattern:e.pattern.toString(),inst:t,continue:!e.abort})}}),EQ=se("$ZodCheckLowerCase",(t,e)=>{e.pattern??(e.pattern=gQ),Tv.init(t,e)}),AQ=se("$ZodCheckUpperCase",(t,e)=>{e.pattern??(e.pattern=mQ),Tv.init(t,e)}),MQ=se("$ZodCheckIncludes",(t,e)=>{pr.init(t,e);const n=zu(e.includes),r=new RegExp(typeof e.position=="number"?`^.{${e.position}}${n}`:n);e.pattern=r,t._zod.onattach.push(i=>{const o=i._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(r)}),t._zod.check=i=>{i.value.includes(e.includes,e.position)||i.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:e.includes,input:i.value,inst:t,continue:!e.abort})}}),OQ=se("$ZodCheckStartsWith",(t,e)=>{pr.init(t,e);const n=new RegExp(`^${zu(e.prefix)}.*`);e.pattern??(e.pattern=n),t._zod.onattach.push(r=>{const i=r._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(n)}),t._zod.check=r=>{r.value.startsWith(e.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:e.prefix,input:r.value,inst:t,continue:!e.abort})}}),DQ=se("$ZodCheckEndsWith",(t,e)=>{pr.init(t,e);const n=new RegExp(`.*${zu(e.suffix)}$`);e.pattern??(e.pattern=n),t._zod.onattach.push(r=>{const i=r._zod.bag;i.patterns??(i.patterns=new Set),i.patterns.add(n)}),t._zod.check=r=>{r.value.endsWith(e.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:e.suffix,input:r.value,inst:t,continue:!e.abort})}});function G6(t,e,n){t.issues.length&&e.issues.push(...La(n,t.issues))}const jQ=se("$ZodCheckProperty",(t,e)=>{pr.init(t,e),t._zod.check=n=>{const r=e.schema._zod.run({value:n.value[e.property],issues:[]},{});if(r instanceof Promise)return r.then(i=>G6(i,n,e.property));G6(r,n,e.property)}}),RQ=se("$ZodCheckMimeType",(t,e)=>{pr.init(t,e);const n=new Set(e.mime);t._zod.onattach.push(r=>{r._zod.bag.mime=e.mime}),t._zod.check=r=>{n.has(r.value.type)||r.issues.push({code:"invalid_value",values:e.mime,input:r.value.type,inst:t,continue:!e.abort})}}),$Q=se("$ZodCheckOverwrite",(t,e)=>{pr.init(t,e),t._zod.check=n=>{n.value=e.tx(n.value)}});class NQ{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if(typeof e=="function"){e(this,{execution:"sync"}),e(this,{execution:"async"});return}const r=e.split(`
`).filter(s=>s),i=Math.min(...r.map(s=>s.length-s.trimStart().length)),o=r.map(s=>s.slice(i)).map(s=>" ".repeat(this.indent*2)+s);for(const s of o)this.content.push(s)}compile(){const e=Function,n=this?.args,i=[...(this?.content??[""]).map(o=>`  ${o}`)];return new e(...n,i.join(`
`))}}const LQ={major:4,minor:1,patch:12},kt=se("$ZodType",(t,e)=>{var n;t??(t={}),t._zod.def=e,t._zod.bag=t._zod.bag||{},t._zod.version=LQ;const r=[...t._zod.def.checks??[]];t._zod.traits.has("$ZodCheck")&&r.unshift(t);for(const i of r)for(const o of i._zod.onattach)o(t);if(r.length===0)(n=t._zod).deferred??(n.deferred=[]),t._zod.deferred?.push(()=>{t._zod.run=t._zod.parse});else{const i=(s,a,l)=>{let c=Ld(s),d;for(const u of a){if(u._zod.def.when){if(!u._zod.def.when(s))continue}else if(c)continue;const p=s.issues.length,f=u._zod.check(s);if(f instanceof Promise&&l?.async===!1)throw new qd;if(d||f instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await f,s.issues.length!==p&&(c||(c=Ld(s,p)))});else{if(s.issues.length===p)continue;c||(c=Ld(s,p))}}return d?d.then(()=>s):s},o=(s,a,l)=>{if(Ld(s))return s.aborted=!0,s;const c=i(a,r,l);if(c instanceof Promise){if(l.async===!1)throw new qd;return c.then(d=>t._zod.parse(d,l))}return t._zod.parse(c,l)};t._zod.run=(s,a)=>{if(a.skipChecks)return t._zod.parse(s,a);if(a.direction==="backward"){const c=t._zod.parse({value:s.value,issues:[]},{...a,skipChecks:!0});return c instanceof Promise?c.then(d=>o(d,s,a)):o(c,s,a)}const l=t._zod.parse(s,a);if(l instanceof Promise){if(a.async===!1)throw new qd;return l.then(c=>i(c,r,a))}return i(l,r,a)}}t["~standard"]={validate:i=>{try{const o=NJ(t,i);return o.success?{value:o.data}:{issues:o.error?.issues}}catch{return LJ(t,i).then(s=>s.success?{value:s.data}:{issues:s.error?.issues})}},vendor:"zod",version:1}}),Ev=se("$ZodString",(t,e)=>{kt.init(t,e),t._zod.pattern=[...t?._zod.bag?.patterns??[]].pop()??lQ(t._zod.bag),t._zod.parse=(n,r)=>{if(e.coerce)try{n.value=String(n.value)}catch{}return typeof n.value=="string"||n.issues.push({expected:"string",code:"invalid_type",input:n.value,inst:t}),n}}),Tn=se("$ZodStringFormat",(t,e)=>{Tv.init(t,e),Ev.init(t,e)}),zQ=se("$ZodGUID",(t,e)=>{e.pattern??(e.pattern=KJ),Tn.init(t,e)}),FQ=se("$ZodUUID",(t,e)=>{if(e.version){const r={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[e.version];if(r===void 0)throw new Error(`Invalid UUID version: "${e.version}"`);e.pattern??(e.pattern=If(r))}else e.pattern??(e.pattern=If());Tn.init(t,e)}),BQ=se("$ZodEmail",(t,e)=>{e.pattern??(e.pattern=qJ),Tn.init(t,e)}),UQ=se("$ZodURL",(t,e)=>{Tn.init(t,e),t._zod.check=n=>{try{const r=n.value.trim(),i=new URL(r);e.hostname&&(e.hostname.lastIndex=0,e.hostname.test(i.hostname)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:jO.source,input:n.value,inst:t,continue:!e.abort})),e.protocol&&(e.protocol.lastIndex=0,e.protocol.test(i.protocol.endsWith(":")?i.protocol.slice(0,-1):i.protocol)||n.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:e.protocol.source,input:n.value,inst:t,continue:!e.abort})),e.normalize?n.value=i.href:n.value=r;return}catch{n.issues.push({code:"invalid_format",format:"url",input:n.value,inst:t,continue:!e.abort})}}}),HQ=se("$ZodEmoji",(t,e)=>{e.pattern??(e.pattern=YJ()),Tn.init(t,e)}),WQ=se("$ZodNanoID",(t,e)=>{e.pattern??(e.pattern=WJ),Tn.init(t,e)}),VQ=se("$ZodCUID",(t,e)=>{e.pattern??(e.pattern=zJ),Tn.init(t,e)}),KQ=se("$ZodCUID2",(t,e)=>{e.pattern??(e.pattern=FJ),Tn.init(t,e)}),qQ=se("$ZodULID",(t,e)=>{e.pattern??(e.pattern=BJ),Tn.init(t,e)}),GQ=se("$ZodXID",(t,e)=>{e.pattern??(e.pattern=UJ),Tn.init(t,e)}),YQ=se("$ZodKSUID",(t,e)=>{e.pattern??(e.pattern=HJ),Tn.init(t,e)}),XQ=se("$ZodISODateTime",(t,e)=>{e.pattern??(e.pattern=aQ(e)),Tn.init(t,e)}),ZQ=se("$ZodISODate",(t,e)=>{e.pattern??(e.pattern=iQ),Tn.init(t,e)}),JQ=se("$ZodISOTime",(t,e)=>{e.pattern??(e.pattern=sQ(e)),Tn.init(t,e)}),QQ=se("$ZodISODuration",(t,e)=>{e.pattern??(e.pattern=VJ),Tn.init(t,e)}),eee=se("$ZodIPv4",(t,e)=>{e.pattern??(e.pattern=XJ),Tn.init(t,e),t._zod.onattach.push(n=>{const r=n._zod.bag;r.format="ipv4"})}),tee=se("$ZodIPv6",(t,e)=>{e.pattern??(e.pattern=ZJ),Tn.init(t,e),t._zod.onattach.push(n=>{const r=n._zod.bag;r.format="ipv6"}),t._zod.check=n=>{try{new URL(`http://[${n.value}]`)}catch{n.issues.push({code:"invalid_format",format:"ipv6",input:n.value,inst:t,continue:!e.abort})}}}),nee=se("$ZodCIDRv4",(t,e)=>{e.pattern??(e.pattern=JJ),Tn.init(t,e)}),ree=se("$ZodCIDRv6",(t,e)=>{e.pattern??(e.pattern=QJ),Tn.init(t,e),t._zod.check=n=>{const r=n.value.split("/");try{if(r.length!==2)throw new Error;const[i,o]=r;if(!o)throw new Error;const s=Number(o);if(`${s}`!==o)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${i}]`)}catch{n.issues.push({code:"invalid_format",format:"cidrv6",input:n.value,inst:t,continue:!e.abort})}}});function LO(t){if(t==="")return!0;if(t.length%4!==0)return!1;try{return atob(t),!0}catch{return!1}}const iee=se("$ZodBase64",(t,e)=>{e.pattern??(e.pattern=eQ),Tn.init(t,e),t._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64"}),t._zod.check=n=>{LO(n.value)||n.issues.push({code:"invalid_format",format:"base64",input:n.value,inst:t,continue:!e.abort})}});function oee(t){if(!DO.test(t))return!1;const e=t.replace(/[-_]/g,r=>r==="-"?"+":"/"),n=e.padEnd(Math.ceil(e.length/4)*4,"=");return LO(n)}const see=se("$ZodBase64URL",(t,e)=>{e.pattern??(e.pattern=DO),Tn.init(t,e),t._zod.onattach.push(n=>{n._zod.bag.contentEncoding="base64url"}),t._zod.check=n=>{oee(n.value)||n.issues.push({code:"invalid_format",format:"base64url",input:n.value,inst:t,continue:!e.abort})}}),aee=se("$ZodE164",(t,e)=>{e.pattern??(e.pattern=nQ),Tn.init(t,e)});function lee(t,e=null){try{const n=t.split(".");if(n.length!==3)return!1;const[r]=n;if(!r)return!1;const i=JSON.parse(atob(r));return!("typ"in i&&i?.typ!=="JWT"||!i.alg||e&&(!("alg"in i)||i.alg!==e))}catch{return!1}}const cee=se("$ZodJWT",(t,e)=>{Tn.init(t,e),t._zod.check=n=>{lee(n.value,e.alg)||n.issues.push({code:"invalid_format",format:"jwt",input:n.value,inst:t,continue:!e.abort})}}),uee=se("$ZodCustomStringFormat",(t,e)=>{Tn.init(t,e),t._zod.check=n=>{e.fn(n.value)||n.issues.push({code:"invalid_format",format:e.format,input:n.value,inst:t,continue:!e.abort})}}),zO=se("$ZodNumber",(t,e)=>{kt.init(t,e),t._zod.pattern=t._zod.bag.pattern??dQ,t._zod.parse=(n,r)=>{if(e.coerce)try{n.value=Number(n.value)}catch{}const i=n.value;if(typeof i=="number"&&!Number.isNaN(i)&&Number.isFinite(i))return n;const o=typeof i=="number"?Number.isNaN(i)?"NaN":Number.isFinite(i)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:i,inst:t,...o?{received:o}:{}}),n}}),dee=se("$ZodNumber",(t,e)=>{SQ.init(t,e),zO.init(t,e)}),FO=se("$ZodBoolean",(t,e)=>{kt.init(t,e),t._zod.pattern=hQ,t._zod.parse=(n,r)=>{if(e.coerce)try{n.value=!!n.value}catch{}const i=n.value;return typeof i=="boolean"||n.issues.push({expected:"boolean",code:"invalid_type",input:i,inst:t}),n}}),BO=se("$ZodBigInt",(t,e)=>{kt.init(t,e),t._zod.pattern=cQ,t._zod.parse=(n,r)=>{if(e.coerce)try{n.value=BigInt(n.value)}catch{}return typeof n.value=="bigint"||n.issues.push({expected:"bigint",code:"invalid_type",input:n.value,inst:t}),n}}),hee=se("$ZodBigInt",(t,e)=>{bQ.init(t,e),BO.init(t,e)}),pee=se("$ZodSymbol",(t,e)=>{kt.init(t,e),t._zod.parse=(n,r)=>{const i=n.value;return typeof i=="symbol"||n.issues.push({expected:"symbol",code:"invalid_type",input:i,inst:t}),n}}),fee=se("$ZodUndefined",(t,e)=>{kt.init(t,e),t._zod.pattern=fQ,t._zod.values=new Set([void 0]),t._zod.optin="optional",t._zod.optout="optional",t._zod.parse=(n,r)=>{const i=n.value;return typeof i>"u"||n.issues.push({expected:"undefined",code:"invalid_type",input:i,inst:t}),n}}),gee=se("$ZodNull",(t,e)=>{kt.init(t,e),t._zod.pattern=pQ,t._zod.values=new Set([null]),t._zod.parse=(n,r)=>{const i=n.value;return i===null||n.issues.push({expected:"null",code:"invalid_type",input:i,inst:t}),n}}),mee=se("$ZodAny",(t,e)=>{kt.init(t,e),t._zod.parse=n=>n}),yee=se("$ZodUnknown",(t,e)=>{kt.init(t,e),t._zod.parse=n=>n}),vee=se("$ZodNever",(t,e)=>{kt.init(t,e),t._zod.parse=(n,r)=>(n.issues.push({expected:"never",code:"invalid_type",input:n.value,inst:t}),n)}),xee=se("$ZodVoid",(t,e)=>{kt.init(t,e),t._zod.parse=(n,r)=>{const i=n.value;return typeof i>"u"||n.issues.push({expected:"void",code:"invalid_type",input:i,inst:t}),n}}),See=se("$ZodDate",(t,e)=>{kt.init(t,e),t._zod.parse=(n,r)=>{if(e.coerce)try{n.value=new Date(n.value)}catch{}const i=n.value,o=i instanceof Date;return o&&!Number.isNaN(i.getTime())||n.issues.push({expected:"date",code:"invalid_type",input:i,...o?{received:"Invalid Date"}:{},inst:t}),n}});function Y6(t,e,n){t.issues.length&&e.issues.push(...La(n,t.issues)),e.value[n]=t.value}const bee=se("$ZodArray",(t,e)=>{kt.init(t,e),t._zod.parse=(n,r)=>{const i=n.value;if(!Array.isArray(i))return n.issues.push({expected:"array",code:"invalid_type",input:i,inst:t}),n;n.value=Array(i.length);const o=[];for(let s=0;s<i.length;s++){const a=i[s],l=e.element._zod.run({value:a,issues:[]},r);l instanceof Promise?o.push(l.then(c=>Y6(c,n,s))):Y6(l,n,s)}return o.length?Promise.all(o).then(()=>n):n}});function Ew(t,e,n,r){t.issues.length&&e.issues.push(...La(n,t.issues)),t.value===void 0?n in r&&(e.value[n]=void 0):e.value[n]=t.value}function wee(t){const e=Object.keys(t.shape);for(const r of e)if(!t.shape?.[r]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${r}": expected a Zod schema`);const n=SJ(t.shape);return{...t,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(n)}}function kee(t,e,n,r,i,o){const s=[],a=i.keySet,l=i.catchall._zod,c=l.def.type;for(const d of Object.keys(e)){if(a.has(d))continue;if(c==="never"){s.push(d);continue}const u=l.run({value:e[d],issues:[]},r);u instanceof Promise?t.push(u.then(p=>Ew(p,n,d,e))):Ew(u,n,d,e)}return s.length&&n.issues.push({code:"unrecognized_keys",keys:s,input:e,inst:o}),t.length?Promise.all(t).then(()=>n):n}const Iee=se("$ZodObject",(t,e)=>{if(kt.init(t,e),!Object.getOwnPropertyDescriptor(e,"shape")?.get){const a=e.shape;Object.defineProperty(e,"shape",{get:()=>{const l={...a};return Object.defineProperty(e,"shape",{value:l}),l}})}const r=bv(()=>wee(e));Bt(t._zod,"propValues",()=>{const a=e.shape,l={};for(const c in a){const d=a[c]._zod;if(d.values){l[c]??(l[c]=new Set);for(const u of d.values)l[c].add(u)}}return l});const i=wf,o=e.catchall;let s;t._zod.parse=(a,l)=>{s??(s=r.value);const c=a.value;if(!i(c))return a.issues.push({expected:"object",code:"invalid_type",input:c,inst:t}),a;a.value={};const d=[],u=s.shape;for(const p of s.keys){const y=u[p]._zod.run({value:c[p],issues:[]},l);y instanceof Promise?d.push(y.then(v=>Ew(v,a,p,c))):Ew(y,a,p,c)}return o?kee(d,c,a,l,r.value,t):d.length?Promise.all(d).then(()=>a):a}}),_ee=se("$ZodObjectJIT",(t,e)=>{Iee.init(t,e);const n=t._zod.parse,r=bv(()=>wee(e)),i=p=>{const f=new NQ(["shape","payload","ctx"]),y=r.value,v=_=>{const C=HE(_);return`shape[${C}]._zod.run({ value: input[${C}], issues: [] }, ctx)`};f.write("const input = payload.value;");const x=Object.create(null);let b=0;for(const _ of y.keys)x[_]=`key_${b++}`;f.write("const newResult = {};");for(const _ of y.keys){const C=x[_],A=HE(_);f.write(`const ${C} = ${v(_)};`),f.write(`
        if (${C}.issues.length) {
          payload.issues = payload.issues.concat(${C}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${A}, ...iss.path] : [${A}]
          })));
        }
        
        
        if (${C}.value === undefined) {
          if (${A} in input) {
            newResult[${A}] = undefined;
          }
        } else {
          newResult[${A}] = ${C}.value;
        }
        
      `)}f.write("payload.value = newResult;"),f.write("return payload;");const w=f.compile();return(_,C)=>w(p,_,C)};let o;const s=wf,a=!Cw.jitless,c=a&&vJ.value,d=e.catchall;let u;t._zod.parse=(p,f)=>{u??(u=r.value);const y=p.value;return s(y)?a&&c&&f?.async===!1&&f.jitless!==!0?(o||(o=i(e.shape)),p=o(p,f),d?kee([],y,p,f,u,t):p):n(p,f):(p.issues.push({expected:"object",code:"invalid_type",input:y,inst:t}),p)}});function X6(t,e,n,r){for(const o of t)if(o.issues.length===0)return e.value=o.value,e;const i=t.filter(o=>!Ld(o));return i.length===1?(e.value=i[0].value,i[0]):(e.issues.push({code:"invalid_union",input:e.value,inst:n,errors:t.map(o=>o.issues.map(s=>Ga(s,r,Io())))}),e)}const UO=se("$ZodUnion",(t,e)=>{kt.init(t,e),Bt(t._zod,"optin",()=>e.options.some(i=>i._zod.optin==="optional")?"optional":void 0),Bt(t._zod,"optout",()=>e.options.some(i=>i._zod.optout==="optional")?"optional":void 0),Bt(t._zod,"values",()=>{if(e.options.every(i=>i._zod.values))return new Set(e.options.flatMap(i=>Array.from(i._zod.values)))}),Bt(t._zod,"pattern",()=>{if(e.options.every(i=>i._zod.pattern)){const i=e.options.map(o=>o._zod.pattern);return new RegExp(`^(${i.map(o=>T1(o.source)).join("|")})$`)}});const n=e.options.length===1,r=e.options[0]._zod.run;t._zod.parse=(i,o)=>{if(n)return r(i,o);let s=!1;const a=[];for(const l of e.options){const c=l._zod.run({value:i.value,issues:[]},o);if(c instanceof Promise)a.push(c),s=!0;else{if(c.issues.length===0)return c;a.push(c)}}return s?Promise.all(a).then(l=>X6(l,i,t,o)):X6(a,i,t,o)}}),Cee=se("$ZodDiscriminatedUnion",(t,e)=>{UO.init(t,e);const n=t._zod.parse;Bt(t._zod,"propValues",()=>{const i={};for(const o of e.options){const s=o._zod.propValues;if(!s||Object.keys(s).length===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(o)}"`);for(const[a,l]of Object.entries(s)){i[a]||(i[a]=new Set);for(const c of l)i[a].add(c)}}return i});const r=bv(()=>{const i=e.options,o=new Map;for(const s of i){const a=s._zod.propValues?.[e.discriminator];if(!a||a.size===0)throw new Error(`Invalid discriminated union option at index "${e.options.indexOf(s)}"`);for(const l of a){if(o.has(l))throw new Error(`Duplicate discriminator value "${String(l)}"`);o.set(l,s)}}return o});t._zod.parse=(i,o)=>{const s=i.value;if(!wf(s))return i.issues.push({code:"invalid_type",expected:"object",input:s,inst:t}),i;const a=r.value.get(s?.[e.discriminator]);return a?a._zod.run(i,o):e.unionFallback?n(i,o):(i.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:e.discriminator,input:s,path:[e.discriminator],inst:t}),i)}}),Pee=se("$ZodIntersection",(t,e)=>{kt.init(t,e),t._zod.parse=(n,r)=>{const i=n.value,o=e.left._zod.run({value:i,issues:[]},r),s=e.right._zod.run({value:i,issues:[]},r);return o instanceof Promise||s instanceof Promise?Promise.all([o,s]).then(([l,c])=>Z6(n,l,c)):Z6(n,o,s)}});function KE(t,e){if(t===e)return{valid:!0,data:t};if(t instanceof Date&&e instanceof Date&&+t==+e)return{valid:!0,data:t};if(fh(t)&&fh(e)){const n=Object.keys(e),r=Object.keys(t).filter(o=>n.indexOf(o)!==-1),i={...t,...e};for(const o of r){const s=KE(t[o],e[o]);if(!s.valid)return{valid:!1,mergeErrorPath:[o,...s.mergeErrorPath]};i[o]=s.data}return{valid:!0,data:i}}if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return{valid:!1,mergeErrorPath:[]};const n=[];for(let r=0;r<t.length;r++){const i=t[r],o=e[r],s=KE(i,o);if(!s.valid)return{valid:!1,mergeErrorPath:[r,...s.mergeErrorPath]};n.push(s.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}function Z6(t,e,n){if(e.issues.length&&t.issues.push(...e.issues),n.issues.length&&t.issues.push(...n.issues),Ld(t))return t;const r=KE(e.value,n.value);if(!r.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(r.mergeErrorPath)}`);return t.value=r.data,t}const HO=se("$ZodTuple",(t,e)=>{kt.init(t,e);const n=e.items,r=n.length-[...n].reverse().findIndex(i=>i._zod.optin!=="optional");t._zod.parse=(i,o)=>{const s=i.value;if(!Array.isArray(s))return i.issues.push({input:s,inst:t,expected:"tuple",code:"invalid_type"}),i;i.value=[];const a=[];if(!e.rest){const c=s.length>n.length,d=s.length<r-1;if(c||d)return i.issues.push({...c?{code:"too_big",maximum:n.length}:{code:"too_small",minimum:n.length},input:s,inst:t,origin:"array"}),i}let l=-1;for(const c of n){if(l++,l>=s.length&&l>=r)continue;const d=c._zod.run({value:s[l],issues:[]},o);d instanceof Promise?a.push(d.then(u=>CS(u,i,l))):CS(d,i,l)}if(e.rest){const c=s.slice(n.length);for(const d of c){l++;const u=e.rest._zod.run({value:d,issues:[]},o);u instanceof Promise?a.push(u.then(p=>CS(p,i,l))):CS(u,i,l)}}return a.length?Promise.all(a).then(()=>i):i}});function CS(t,e,n){t.issues.length&&e.issues.push(...La(n,t.issues)),e.value[n]=t.value}const Tee=se("$ZodRecord",(t,e)=>{kt.init(t,e),t._zod.parse=(n,r)=>{const i=n.value;if(!fh(i))return n.issues.push({expected:"record",code:"invalid_type",input:i,inst:t}),n;const o=[];if(e.keyType._zod.values){const s=e.keyType._zod.values;n.value={};for(const l of s)if(typeof l=="string"||typeof l=="number"||typeof l=="symbol"){const c=e.valueType._zod.run({value:i[l],issues:[]},r);c instanceof Promise?o.push(c.then(d=>{d.issues.length&&n.issues.push(...La(l,d.issues)),n.value[l]=d.value})):(c.issues.length&&n.issues.push(...La(l,c.issues)),n.value[l]=c.value)}let a;for(const l in i)s.has(l)||(a=a??[],a.push(l));a&&a.length>0&&n.issues.push({code:"unrecognized_keys",input:i,inst:t,keys:a})}else{n.value={};for(const s of Reflect.ownKeys(i)){if(s==="__proto__")continue;const a=e.keyType._zod.run({value:s,issues:[]},r);if(a instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(a.issues.length){n.issues.push({code:"invalid_key",origin:"record",issues:a.issues.map(c=>Ga(c,r,Io())),input:s,path:[s],inst:t}),n.value[a.value]=a.value;continue}const l=e.valueType._zod.run({value:i[s],issues:[]},r);l instanceof Promise?o.push(l.then(c=>{c.issues.length&&n.issues.push(...La(s,c.issues)),n.value[a.value]=c.value})):(l.issues.length&&n.issues.push(...La(s,l.issues)),n.value[a.value]=l.value)}}return o.length?Promise.all(o).then(()=>n):n}}),Eee=se("$ZodMap",(t,e)=>{kt.init(t,e),t._zod.parse=(n,r)=>{const i=n.value;if(!(i instanceof Map))return n.issues.push({expected:"map",code:"invalid_type",input:i,inst:t}),n;const o=[];n.value=new Map;for(const[s,a]of i){const l=e.keyType._zod.run({value:s,issues:[]},r),c=e.valueType._zod.run({value:a,issues:[]},r);l instanceof Promise||c instanceof Promise?o.push(Promise.all([l,c]).then(([d,u])=>{J6(d,u,n,s,i,t,r)})):J6(l,c,n,s,i,t,r)}return o.length?Promise.all(o).then(()=>n):n}});function J6(t,e,n,r,i,o,s){t.issues.length&&(Tw.has(typeof r)?n.issues.push(...La(r,t.issues)):n.issues.push({code:"invalid_key",origin:"map",input:i,inst:o,issues:t.issues.map(a=>Ga(a,s,Io()))})),e.issues.length&&(Tw.has(typeof r)?n.issues.push(...La(r,e.issues)):n.issues.push({origin:"map",code:"invalid_element",input:i,inst:o,key:r,issues:e.issues.map(a=>Ga(a,s,Io()))})),n.value.set(t.value,e.value)}const Aee=se("$ZodSet",(t,e)=>{kt.init(t,e),t._zod.parse=(n,r)=>{const i=n.value;if(!(i instanceof Set))return n.issues.push({input:i,inst:t,expected:"set",code:"invalid_type"}),n;const o=[];n.value=new Set;for(const s of i){const a=e.valueType._zod.run({value:s,issues:[]},r);a instanceof Promise?o.push(a.then(l=>Q6(l,n))):Q6(a,n)}return o.length?Promise.all(o).then(()=>n):n}});function Q6(t,e){t.issues.length&&e.issues.push(...t.issues),e.value.add(t.value)}const Mee=se("$ZodEnum",(t,e)=>{kt.init(t,e);const n=SO(e.entries),r=new Set(n);t._zod.values=r,t._zod.pattern=new RegExp(`^(${n.filter(i=>Tw.has(typeof i)).map(i=>typeof i=="string"?zu(i):i.toString()).join("|")})$`),t._zod.parse=(i,o)=>{const s=i.value;return r.has(s)||i.issues.push({code:"invalid_value",values:n,input:s,inst:t}),i}}),Oee=se("$ZodLiteral",(t,e)=>{if(kt.init(t,e),e.values.length===0)throw new Error("Cannot create literal schema with no valid values");t._zod.values=new Set(e.values),t._zod.pattern=new RegExp(`^(${e.values.map(n=>typeof n=="string"?zu(n):n?zu(n.toString()):String(n)).join("|")})$`),t._zod.parse=(n,r)=>{const i=n.value;return t._zod.values.has(i)||n.issues.push({code:"invalid_value",values:e.values,input:i,inst:t}),n}}),Dee=se("$ZodFile",(t,e)=>{kt.init(t,e),t._zod.parse=(n,r)=>{const i=n.value;return i instanceof File||n.issues.push({expected:"file",code:"invalid_type",input:i,inst:t}),n}}),jee=se("$ZodTransform",(t,e)=>{kt.init(t,e),t._zod.parse=(n,r)=>{if(r.direction==="backward")throw new P1(t.constructor.name);const i=e.transform(n.value,n);if(r.async)return(i instanceof Promise?i:Promise.resolve(i)).then(s=>(n.value=s,n));if(i instanceof Promise)throw new qd;return n.value=i,n}});function eB(t,e){return t.issues.length&&e===void 0?{issues:[],value:void 0}:t}const Ree=se("$ZodOptional",(t,e)=>{kt.init(t,e),t._zod.optin="optional",t._zod.optout="optional",Bt(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),Bt(t._zod,"pattern",()=>{const n=e.innerType._zod.pattern;return n?new RegExp(`^(${T1(n.source)})?$`):void 0}),t._zod.parse=(n,r)=>{if(e.innerType._zod.optin==="optional"){const i=e.innerType._zod.run(n,r);return i instanceof Promise?i.then(o=>eB(o,n.value)):eB(i,n.value)}return n.value===void 0?n:e.innerType._zod.run(n,r)}}),$ee=se("$ZodNullable",(t,e)=>{kt.init(t,e),Bt(t._zod,"optin",()=>e.innerType._zod.optin),Bt(t._zod,"optout",()=>e.innerType._zod.optout),Bt(t._zod,"pattern",()=>{const n=e.innerType._zod.pattern;return n?new RegExp(`^(${T1(n.source)}|null)$`):void 0}),Bt(t._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,null]):void 0),t._zod.parse=(n,r)=>n.value===null?n:e.innerType._zod.run(n,r)}),Nee=se("$ZodDefault",(t,e)=>{kt.init(t,e),t._zod.optin="optional",Bt(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(n,r)=>{if(r.direction==="backward")return e.innerType._zod.run(n,r);if(n.value===void 0)return n.value=e.defaultValue,n;const i=e.innerType._zod.run(n,r);return i instanceof Promise?i.then(o=>tB(o,e)):tB(i,e)}});function tB(t,e){return t.value===void 0&&(t.value=e.defaultValue),t}const Lee=se("$ZodPrefault",(t,e)=>{kt.init(t,e),t._zod.optin="optional",Bt(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(n,r)=>(r.direction==="backward"||n.value===void 0&&(n.value=e.defaultValue),e.innerType._zod.run(n,r))}),zee=se("$ZodNonOptional",(t,e)=>{kt.init(t,e),Bt(t._zod,"values",()=>{const n=e.innerType._zod.values;return n?new Set([...n].filter(r=>r!==void 0)):void 0}),t._zod.parse=(n,r)=>{const i=e.innerType._zod.run(n,r);return i instanceof Promise?i.then(o=>nB(o,t)):nB(i,t)}});function nB(t,e){return!t.issues.length&&t.value===void 0&&t.issues.push({code:"invalid_type",expected:"nonoptional",input:t.value,inst:e}),t}const Fee=se("$ZodSuccess",(t,e)=>{kt.init(t,e),t._zod.parse=(n,r)=>{if(r.direction==="backward")throw new P1("ZodSuccess");const i=e.innerType._zod.run(n,r);return i instanceof Promise?i.then(o=>(n.value=o.issues.length===0,n)):(n.value=i.issues.length===0,n)}}),Bee=se("$ZodCatch",(t,e)=>{kt.init(t,e),Bt(t._zod,"optin",()=>e.innerType._zod.optin),Bt(t._zod,"optout",()=>e.innerType._zod.optout),Bt(t._zod,"values",()=>e.innerType._zod.values),t._zod.parse=(n,r)=>{if(r.direction==="backward")return e.innerType._zod.run(n,r);const i=e.innerType._zod.run(n,r);return i instanceof Promise?i.then(o=>(n.value=o.value,o.issues.length&&(n.value=e.catchValue({...n,error:{issues:o.issues.map(s=>Ga(s,r,Io()))},input:n.value}),n.issues=[]),n)):(n.value=i.value,i.issues.length&&(n.value=e.catchValue({...n,error:{issues:i.issues.map(o=>Ga(o,r,Io()))},input:n.value}),n.issues=[]),n)}}),Uee=se("$ZodNaN",(t,e)=>{kt.init(t,e),t._zod.parse=(n,r)=>((typeof n.value!="number"||!Number.isNaN(n.value))&&n.issues.push({input:n.value,inst:t,expected:"nan",code:"invalid_type"}),n)}),Hee=se("$ZodPipe",(t,e)=>{kt.init(t,e),Bt(t._zod,"values",()=>e.in._zod.values),Bt(t._zod,"optin",()=>e.in._zod.optin),Bt(t._zod,"optout",()=>e.out._zod.optout),Bt(t._zod,"propValues",()=>e.in._zod.propValues),t._zod.parse=(n,r)=>{if(r.direction==="backward"){const o=e.out._zod.run(n,r);return o instanceof Promise?o.then(s=>PS(s,e.in,r)):PS(o,e.in,r)}const i=e.in._zod.run(n,r);return i instanceof Promise?i.then(o=>PS(o,e.out,r)):PS(i,e.out,r)}});function PS(t,e,n){return t.issues.length?(t.aborted=!0,t):e._zod.run({value:t.value,issues:t.issues},n)}const WO=se("$ZodCodec",(t,e)=>{kt.init(t,e),Bt(t._zod,"values",()=>e.in._zod.values),Bt(t._zod,"optin",()=>e.in._zod.optin),Bt(t._zod,"optout",()=>e.out._zod.optout),Bt(t._zod,"propValues",()=>e.in._zod.propValues),t._zod.parse=(n,r)=>{if((r.direction||"forward")==="forward"){const o=e.in._zod.run(n,r);return o instanceof Promise?o.then(s=>TS(s,e,r)):TS(o,e,r)}else{const o=e.out._zod.run(n,r);return o instanceof Promise?o.then(s=>TS(s,e,r)):TS(o,e,r)}}});function TS(t,e,n){if(t.issues.length)return t.aborted=!0,t;if((n.direction||"forward")==="forward"){const i=e.transform(t.value,t);return i instanceof Promise?i.then(o=>ES(t,o,e.out,n)):ES(t,i,e.out,n)}else{const i=e.reverseTransform(t.value,t);return i instanceof Promise?i.then(o=>ES(t,o,e.in,n)):ES(t,i,e.in,n)}}function ES(t,e,n,r){return t.issues.length?(t.aborted=!0,t):n._zod.run({value:e,issues:t.issues},r)}const Wee=se("$ZodReadonly",(t,e)=>{kt.init(t,e),Bt(t._zod,"propValues",()=>e.innerType._zod.propValues),Bt(t._zod,"values",()=>e.innerType._zod.values),Bt(t._zod,"optin",()=>e.innerType._zod.optin),Bt(t._zod,"optout",()=>e.innerType._zod.optout),t._zod.parse=(n,r)=>{if(r.direction==="backward")return e.innerType._zod.run(n,r);const i=e.innerType._zod.run(n,r);return i instanceof Promise?i.then(rB):rB(i)}});function rB(t){return t.value=Object.freeze(t.value),t}const Vee=se("$ZodTemplateLiteral",(t,e)=>{kt.init(t,e);const n=[];for(const r of e.parts)if(typeof r=="object"&&r!==null){if(!r._zod.pattern)throw new Error(`Invalid template literal part, no pattern found: ${[...r._zod.traits].shift()}`);const i=r._zod.pattern instanceof RegExp?r._zod.pattern.source:r._zod.pattern;if(!i)throw new Error(`Invalid template literal part: ${r._zod.traits}`);const o=i.startsWith("^")?1:0,s=i.endsWith("$")?i.length-1:i.length;n.push(i.slice(o,s))}else if(r===null||xJ.has(typeof r))n.push(zu(`${r}`));else throw new Error(`Invalid template literal part: ${r}`);t._zod.pattern=new RegExp(`^${n.join("")}$`),t._zod.parse=(r,i)=>typeof r.value!="string"?(r.issues.push({input:r.value,inst:t,expected:"template_literal",code:"invalid_type"}),r):(t._zod.pattern.lastIndex=0,t._zod.pattern.test(r.value)||r.issues.push({input:r.value,inst:t,code:"invalid_format",format:e.format??"template_literal",pattern:t._zod.pattern.source}),r)}),Kee=se("$ZodFunction",(t,e)=>(kt.init(t,e),t._def=e,t._zod.def=e,t.implement=n=>{if(typeof n!="function")throw new Error("implement() must be called with a function");return function(...r){const i=t._def.input?WE(t._def.input,r):r,o=Reflect.apply(n,this,i);return t._def.output?WE(t._def.output,o):o}},t.implementAsync=n=>{if(typeof n!="function")throw new Error("implementAsync() must be called with a function");return async function(...r){const i=t._def.input?await VE(t._def.input,r):r,o=await Reflect.apply(n,this,i);return t._def.output?await VE(t._def.output,o):o}},t._zod.parse=(n,r)=>typeof n.value!="function"?(n.issues.push({code:"invalid_type",expected:"function",input:n.value,inst:t}),n):(t._def.output&&t._def.output._zod.def.type==="promise"?n.value=t.implementAsync(n.value):n.value=t.implement(n.value),n),t.input=(...n)=>{const r=t.constructor;return Array.isArray(n[0])?new r({type:"function",input:new HO({type:"tuple",items:n[0],rest:n[1]}),output:t._def.output}):new r({type:"function",input:n[0],output:t._def.output})},t.output=n=>{const r=t.constructor;return new r({type:"function",input:t._def.input,output:n})},t)),qee=se("$ZodPromise",(t,e)=>{kt.init(t,e),t._zod.parse=(n,r)=>Promise.resolve(n.value).then(i=>e.innerType._zod.run({value:i,issues:[]},r))}),Gee=se("$ZodLazy",(t,e)=>{kt.init(t,e),Bt(t._zod,"innerType",()=>e.getter()),Bt(t._zod,"pattern",()=>t._zod.innerType._zod.pattern),Bt(t._zod,"propValues",()=>t._zod.innerType._zod.propValues),Bt(t._zod,"optin",()=>t._zod.innerType._zod.optin??void 0),Bt(t._zod,"optout",()=>t._zod.innerType._zod.optout??void 0),t._zod.parse=(n,r)=>t._zod.innerType._zod.run(n,r)}),Yee=se("$ZodCustom",(t,e)=>{pr.init(t,e),kt.init(t,e),t._zod.parse=(n,r)=>n,t._zod.check=n=>{const r=n.value,i=e.fn(r);if(i instanceof Promise)return i.then(o=>iB(o,n,r,t));iB(i,n,r,t)}});function iB(t,e,n,r){if(!t){const i={code:"custom",input:n,inst:r,path:[...r._zod.def.path??[]],continue:!r._zod.def.abort};r._zod.def.params&&(i.params=r._zod.def.params),e.issues.push(kf(i))}}const HNe=()=>{const t={string:{unit:"حرف",verb:"أن يحوي"},file:{unit:"بايت",verb:"أن يحوي"},array:{unit:"عنصر",verb:"أن يحوي"},set:{unit:"عنصر",verb:"أن يحوي"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"number";case"object":{if(Array.isArray(i))return"array";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"مدخل",email:"بريد إلكتروني",url:"رابط",emoji:"إيموجي",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"تاريخ ووقت بمعيار ISO",date:"تاريخ بمعيار ISO",time:"وقت بمعيار ISO",duration:"مدة بمعيار ISO",ipv4:"عنوان IPv4",ipv6:"عنوان IPv6",cidrv4:"مدى عناوين بصيغة IPv4",cidrv6:"مدى عناوين بصيغة IPv6",base64:"نَص بترميز base64-encoded",base64url:"نَص بترميز base64url-encoded",json_string:"نَص على هيئة JSON",e164:"رقم هاتف بمعيار E.164",jwt:"JWT",template_literal:"مدخل"};return i=>{switch(i.code){case"invalid_type":return`مدخلات غير مقبولة: يفترض إدخال ${i.expected}، ولكن تم إدخال ${n(i.input)}`;case"invalid_value":return i.values.length===1?`مدخلات غير مقبولة: يفترض إدخال ${yt(i.values[0])}`:`اختيار غير مقبول: يتوقع انتقاء أحد هذه الخيارات: ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?` أكبر من اللازم: يفترض أن تكون ${i.origin??"القيمة"} ${o} ${i.maximum.toString()} ${s.unit??"عنصر"}`:`أكبر من اللازم: يفترض أن تكون ${i.origin??"القيمة"} ${o} ${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`أصغر من اللازم: يفترض لـ ${i.origin} أن يكون ${o} ${i.minimum.toString()} ${s.unit}`:`أصغر من اللازم: يفترض لـ ${i.origin} أن يكون ${o} ${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`نَص غير مقبول: يجب أن يبدأ بـ "${i.prefix}"`:o.format==="ends_with"?`نَص غير مقبول: يجب أن ينتهي بـ "${o.suffix}"`:o.format==="includes"?`نَص غير مقبول: يجب أن يتضمَّن "${o.includes}"`:o.format==="regex"?`نَص غير مقبول: يجب أن يطابق النمط ${o.pattern}`:`${r[o.format]??i.format} غير مقبول`}case"not_multiple_of":return`رقم غير مقبول: يجب أن يكون من مضاعفات ${i.divisor}`;case"unrecognized_keys":return`معرف${i.keys.length>1?"ات":""} غريب${i.keys.length>1?"ة":""}: ${De(i.keys,"، ")}`;case"invalid_key":return`معرف غير مقبول في ${i.origin}`;case"invalid_union":return"مدخل غير مقبول";case"invalid_element":return`مدخل غير مقبول في ${i.origin}`;default:return"مدخل غير مقبول"}}};function WNe(){return{localeError:HNe()}}const VNe=()=>{const t={string:{unit:"simvol",verb:"olmalıdır"},file:{unit:"bayt",verb:"olmalıdır"},array:{unit:"element",verb:"olmalıdır"},set:{unit:"element",verb:"olmalıdır"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"number";case"object":{if(Array.isArray(i))return"array";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return i=>{switch(i.code){case"invalid_type":return`Yanlış dəyər: gözlənilən ${i.expected}, daxil olan ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Yanlış dəyər: gözlənilən ${yt(i.values[0])}`:`Yanlış seçim: aşağıdakılardan biri olmalıdır: ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`Çox böyük: gözlənilən ${i.origin??"dəyər"} ${o}${i.maximum.toString()} ${s.unit??"element"}`:`Çox böyük: gözlənilən ${i.origin??"dəyər"} ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`Çox kiçik: gözlənilən ${i.origin} ${o}${i.minimum.toString()} ${s.unit}`:`Çox kiçik: gözlənilən ${i.origin} ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Yanlış mətn: "${o.prefix}" ilə başlamalıdır`:o.format==="ends_with"?`Yanlış mətn: "${o.suffix}" ilə bitməlidir`:o.format==="includes"?`Yanlış mətn: "${o.includes}" daxil olmalıdır`:o.format==="regex"?`Yanlış mətn: ${o.pattern} şablonuna uyğun olmalıdır`:`Yanlış ${r[o.format]??i.format}`}case"not_multiple_of":return`Yanlış ədəd: ${i.divisor} ilə bölünə bilən olmalıdır`;case"unrecognized_keys":return`Tanınmayan açar${i.keys.length>1?"lar":""}: ${De(i.keys,", ")}`;case"invalid_key":return`${i.origin} daxilində yanlış açar`;case"invalid_union":return"Yanlış dəyər";case"invalid_element":return`${i.origin} daxilində yanlış dəyər`;default:return"Yanlış dəyər"}}};function KNe(){return{localeError:VNe()}}function oB(t,e,n,r){const i=Math.abs(t),o=i%10,s=i%100;return s>=11&&s<=19?r:o===1?e:o>=2&&o<=4?n:r}const qNe=()=>{const t={string:{unit:{one:"сімвал",few:"сімвалы",many:"сімвалаў"},verb:"мець"},array:{unit:{one:"элемент",few:"элементы",many:"элементаў"},verb:"мець"},set:{unit:{one:"элемент",few:"элементы",many:"элементаў"},verb:"мець"},file:{unit:{one:"байт",few:"байты",many:"байтаў"},verb:"мець"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"лік";case"object":{if(Array.isArray(i))return"масіў";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"увод",email:"email адрас",url:"URL",emoji:"эмодзі",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO дата і час",date:"ISO дата",time:"ISO час",duration:"ISO працягласць",ipv4:"IPv4 адрас",ipv6:"IPv6 адрас",cidrv4:"IPv4 дыяпазон",cidrv6:"IPv6 дыяпазон",base64:"радок у фармаце base64",base64url:"радок у фармаце base64url",json_string:"JSON радок",e164:"нумар E.164",jwt:"JWT",template_literal:"увод"};return i=>{switch(i.code){case"invalid_type":return`Няправільны ўвод: чакаўся ${i.expected}, атрымана ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Няправільны ўвод: чакалася ${yt(i.values[0])}`:`Няправільны варыянт: чакаўся адзін з ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);if(s){const a=Number(i.maximum),l=oB(a,s.unit.one,s.unit.few,s.unit.many);return`Занадта вялікі: чакалася, што ${i.origin??"значэнне"} павінна ${s.verb} ${o}${i.maximum.toString()} ${l}`}return`Занадта вялікі: чакалася, што ${i.origin??"значэнне"} павінна быць ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);if(s){const a=Number(i.minimum),l=oB(a,s.unit.one,s.unit.few,s.unit.many);return`Занадта малы: чакалася, што ${i.origin} павінна ${s.verb} ${o}${i.minimum.toString()} ${l}`}return`Занадта малы: чакалася, што ${i.origin} павінна быць ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Няправільны радок: павінен пачынацца з "${o.prefix}"`:o.format==="ends_with"?`Няправільны радок: павінен заканчвацца на "${o.suffix}"`:o.format==="includes"?`Няправільны радок: павінен змяшчаць "${o.includes}"`:o.format==="regex"?`Няправільны радок: павінен адпавядаць шаблону ${o.pattern}`:`Няправільны ${r[o.format]??i.format}`}case"not_multiple_of":return`Няправільны лік: павінен быць кратным ${i.divisor}`;case"unrecognized_keys":return`Нераспазнаны ${i.keys.length>1?"ключы":"ключ"}: ${De(i.keys,", ")}`;case"invalid_key":return`Няправільны ключ у ${i.origin}`;case"invalid_union":return"Няправільны ўвод";case"invalid_element":return`Няправільнае значэнне ў ${i.origin}`;default:return"Няправільны ўвод"}}};function GNe(){return{localeError:qNe()}}const YNe=t=>{const e=typeof t;switch(e){case"number":return Number.isNaN(t)?"NaN":"число";case"object":{if(Array.isArray(t))return"масив";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return e},XNe=()=>{const t={string:{unit:"символа",verb:"да съдържа"},file:{unit:"байта",verb:"да съдържа"},array:{unit:"елемента",verb:"да съдържа"},set:{unit:"елемента",verb:"да съдържа"}};function e(r){return t[r]??null}const n={regex:"вход",email:"имейл адрес",url:"URL",emoji:"емоджи",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO време",date:"ISO дата",time:"ISO време",duration:"ISO продължителност",ipv4:"IPv4 адрес",ipv6:"IPv6 адрес",cidrv4:"IPv4 диапазон",cidrv6:"IPv6 диапазон",base64:"base64-кодиран низ",base64url:"base64url-кодиран низ",json_string:"JSON низ",e164:"E.164 номер",jwt:"JWT",template_literal:"вход"};return r=>{switch(r.code){case"invalid_type":return`Невалиден вход: очакван ${r.expected}, получен ${YNe(r.input)}`;case"invalid_value":return r.values.length===1?`Невалиден вход: очакван ${yt(r.values[0])}`:`Невалидна опция: очаквано едно от ${De(r.values,"|")}`;case"too_big":{const i=r.inclusive?"<=":"<",o=e(r.origin);return o?`Твърде голямо: очаква се ${r.origin??"стойност"} да съдържа ${i}${r.maximum.toString()} ${o.unit??"елемента"}`:`Твърде голямо: очаква се ${r.origin??"стойност"} да бъде ${i}${r.maximum.toString()}`}case"too_small":{const i=r.inclusive?">=":">",o=e(r.origin);return o?`Твърде малко: очаква се ${r.origin} да съдържа ${i}${r.minimum.toString()} ${o.unit}`:`Твърде малко: очаква се ${r.origin} да бъде ${i}${r.minimum.toString()}`}case"invalid_format":{const i=r;if(i.format==="starts_with")return`Невалиден низ: трябва да започва с "${i.prefix}"`;if(i.format==="ends_with")return`Невалиден низ: трябва да завършва с "${i.suffix}"`;if(i.format==="includes")return`Невалиден низ: трябва да включва "${i.includes}"`;if(i.format==="regex")return`Невалиден низ: трябва да съвпада с ${i.pattern}`;let o="Невалиден";return i.format==="emoji"&&(o="Невалидно"),i.format==="datetime"&&(o="Невалидно"),i.format==="date"&&(o="Невалидна"),i.format==="time"&&(o="Невалидно"),i.format==="duration"&&(o="Невалидна"),`${o} ${n[i.format]??r.format}`}case"not_multiple_of":return`Невалидно число: трябва да бъде кратно на ${r.divisor}`;case"unrecognized_keys":return`Неразпознат${r.keys.length>1?"и":""} ключ${r.keys.length>1?"ове":""}: ${De(r.keys,", ")}`;case"invalid_key":return`Невалиден ключ в ${r.origin}`;case"invalid_union":return"Невалиден вход";case"invalid_element":return`Невалидна стойност в ${r.origin}`;default:return"Невалиден вход"}}};function ZNe(){return{localeError:XNe()}}const JNe=()=>{const t={string:{unit:"caràcters",verb:"contenir"},file:{unit:"bytes",verb:"contenir"},array:{unit:"elements",verb:"contenir"},set:{unit:"elements",verb:"contenir"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"number";case"object":{if(Array.isArray(i))return"array";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"entrada",email:"adreça electrònica",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i hora ISO",date:"data ISO",time:"hora ISO",duration:"durada ISO",ipv4:"adreça IPv4",ipv6:"adreça IPv6",cidrv4:"rang IPv4",cidrv6:"rang IPv6",base64:"cadena codificada en base64",base64url:"cadena codificada en base64url",json_string:"cadena JSON",e164:"número E.164",jwt:"JWT",template_literal:"entrada"};return i=>{switch(i.code){case"invalid_type":return`Tipus invàlid: s'esperava ${i.expected}, s'ha rebut ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Valor invàlid: s'esperava ${yt(i.values[0])}`:`Opció invàlida: s'esperava una de ${De(i.values," o ")}`;case"too_big":{const o=i.inclusive?"com a màxim":"menys de",s=e(i.origin);return s?`Massa gran: s'esperava que ${i.origin??"el valor"} contingués ${o} ${i.maximum.toString()} ${s.unit??"elements"}`:`Massa gran: s'esperava que ${i.origin??"el valor"} fos ${o} ${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?"com a mínim":"més de",s=e(i.origin);return s?`Massa petit: s'esperava que ${i.origin} contingués ${o} ${i.minimum.toString()} ${s.unit}`:`Massa petit: s'esperava que ${i.origin} fos ${o} ${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Format invàlid: ha de començar amb "${o.prefix}"`:o.format==="ends_with"?`Format invàlid: ha d'acabar amb "${o.suffix}"`:o.format==="includes"?`Format invàlid: ha d'incloure "${o.includes}"`:o.format==="regex"?`Format invàlid: ha de coincidir amb el patró ${o.pattern}`:`Format invàlid per a ${r[o.format]??i.format}`}case"not_multiple_of":return`Número invàlid: ha de ser múltiple de ${i.divisor}`;case"unrecognized_keys":return`Clau${i.keys.length>1?"s":""} no reconeguda${i.keys.length>1?"s":""}: ${De(i.keys,", ")}`;case"invalid_key":return`Clau invàlida a ${i.origin}`;case"invalid_union":return"Entrada invàlida";case"invalid_element":return`Element invàlid a ${i.origin}`;default:return"Entrada invàlida"}}};function QNe(){return{localeError:JNe()}}const eLe=()=>{const t={string:{unit:"znaků",verb:"mít"},file:{unit:"bajtů",verb:"mít"},array:{unit:"prvků",verb:"mít"},set:{unit:"prvků",verb:"mít"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"číslo";case"string":return"řetězec";case"boolean":return"boolean";case"bigint":return"bigint";case"function":return"funkce";case"symbol":return"symbol";case"undefined":return"undefined";case"object":{if(Array.isArray(i))return"pole";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"regulární výraz",email:"e-mailová adresa",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"datum a čas ve formátu ISO",date:"datum ve formátu ISO",time:"čas ve formátu ISO",duration:"doba trvání ISO",ipv4:"IPv4 adresa",ipv6:"IPv6 adresa",cidrv4:"rozsah IPv4",cidrv6:"rozsah IPv6",base64:"řetězec zakódovaný ve formátu base64",base64url:"řetězec zakódovaný ve formátu base64url",json_string:"řetězec ve formátu JSON",e164:"číslo E.164",jwt:"JWT",template_literal:"vstup"};return i=>{switch(i.code){case"invalid_type":return`Neplatný vstup: očekáváno ${i.expected}, obdrženo ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Neplatný vstup: očekáváno ${yt(i.values[0])}`:`Neplatná možnost: očekávána jedna z hodnot ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`Hodnota je příliš velká: ${i.origin??"hodnota"} musí mít ${o}${i.maximum.toString()} ${s.unit??"prvků"}`:`Hodnota je příliš velká: ${i.origin??"hodnota"} musí být ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`Hodnota je příliš malá: ${i.origin??"hodnota"} musí mít ${o}${i.minimum.toString()} ${s.unit??"prvků"}`:`Hodnota je příliš malá: ${i.origin??"hodnota"} musí být ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Neplatný řetězec: musí začínat na "${o.prefix}"`:o.format==="ends_with"?`Neplatný řetězec: musí končit na "${o.suffix}"`:o.format==="includes"?`Neplatný řetězec: musí obsahovat "${o.includes}"`:o.format==="regex"?`Neplatný řetězec: musí odpovídat vzoru ${o.pattern}`:`Neplatný formát ${r[o.format]??i.format}`}case"not_multiple_of":return`Neplatné číslo: musí být násobkem ${i.divisor}`;case"unrecognized_keys":return`Neznámé klíče: ${De(i.keys,", ")}`;case"invalid_key":return`Neplatný klíč v ${i.origin}`;case"invalid_union":return"Neplatný vstup";case"invalid_element":return`Neplatná hodnota v ${i.origin}`;default:return"Neplatný vstup"}}};function tLe(){return{localeError:eLe()}}const nLe=()=>{const t={string:{unit:"tegn",verb:"havde"},file:{unit:"bytes",verb:"havde"},array:{unit:"elementer",verb:"indeholdt"},set:{unit:"elementer",verb:"indeholdt"}},e={string:"streng",number:"tal",boolean:"boolean",array:"liste",object:"objekt",set:"sæt",file:"fil"};function n(s){return t[s]??null}function r(s){return e[s]??s}const i=s=>{const a=typeof s;switch(a){case"number":return Number.isNaN(s)?"NaN":"tal";case"object":return Array.isArray(s)?"liste":s===null?"null":Object.getPrototypeOf(s)!==Object.prototype&&s.constructor?s.constructor.name:"objekt"}return a},o={regex:"input",email:"e-mailadresse",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dato- og klokkeslæt",date:"ISO-dato",time:"ISO-klokkeslæt",duration:"ISO-varighed",ipv4:"IPv4-område",ipv6:"IPv6-område",cidrv4:"IPv4-spektrum",cidrv6:"IPv6-spektrum",base64:"base64-kodet streng",base64url:"base64url-kodet streng",json_string:"JSON-streng",e164:"E.164-nummer",jwt:"JWT",template_literal:"input"};return s=>{switch(s.code){case"invalid_type":return`Ugyldigt input: forventede ${r(s.expected)}, fik ${r(i(s.input))}`;case"invalid_value":return s.values.length===1?`Ugyldig værdi: forventede ${yt(s.values[0])}`:`Ugyldigt valg: forventede en af følgende ${De(s.values,"|")}`;case"too_big":{const a=s.inclusive?"<=":"<",l=n(s.origin),c=r(s.origin);return l?`For stor: forventede ${c??"value"} ${l.verb} ${a} ${s.maximum.toString()} ${l.unit??"elementer"}`:`For stor: forventede ${c??"value"} havde ${a} ${s.maximum.toString()}`}case"too_small":{const a=s.inclusive?">=":">",l=n(s.origin),c=r(s.origin);return l?`For lille: forventede ${c} ${l.verb} ${a} ${s.minimum.toString()} ${l.unit}`:`For lille: forventede ${c} havde ${a} ${s.minimum.toString()}`}case"invalid_format":{const a=s;return a.format==="starts_with"?`Ugyldig streng: skal starte med "${a.prefix}"`:a.format==="ends_with"?`Ugyldig streng: skal ende med "${a.suffix}"`:a.format==="includes"?`Ugyldig streng: skal indeholde "${a.includes}"`:a.format==="regex"?`Ugyldig streng: skal matche mønsteret ${a.pattern}`:`Ugyldig ${o[a.format]??s.format}`}case"not_multiple_of":return`Ugyldigt tal: skal være deleligt med ${s.divisor}`;case"unrecognized_keys":return`${s.keys.length>1?"Ukendte nøgler":"Ukendt nøgle"}: ${De(s.keys,", ")}`;case"invalid_key":return`Ugyldig nøgle i ${s.origin}`;case"invalid_union":return"Ugyldigt input: matcher ingen af de tilladte typer";case"invalid_element":return`Ugyldig værdi i ${s.origin}`;default:return"Ugyldigt input"}}};function rLe(){return{localeError:nLe()}}const iLe=()=>{const t={string:{unit:"Zeichen",verb:"zu haben"},file:{unit:"Bytes",verb:"zu haben"},array:{unit:"Elemente",verb:"zu haben"},set:{unit:"Elemente",verb:"zu haben"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"Zahl";case"object":{if(Array.isArray(i))return"Array";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"Eingabe",email:"E-Mail-Adresse",url:"URL",emoji:"Emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-Datum und -Uhrzeit",date:"ISO-Datum",time:"ISO-Uhrzeit",duration:"ISO-Dauer",ipv4:"IPv4-Adresse",ipv6:"IPv6-Adresse",cidrv4:"IPv4-Bereich",cidrv6:"IPv6-Bereich",base64:"Base64-codierter String",base64url:"Base64-URL-codierter String",json_string:"JSON-String",e164:"E.164-Nummer",jwt:"JWT",template_literal:"Eingabe"};return i=>{switch(i.code){case"invalid_type":return`Ungültige Eingabe: erwartet ${i.expected}, erhalten ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Ungültige Eingabe: erwartet ${yt(i.values[0])}`:`Ungültige Option: erwartet eine von ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`Zu groß: erwartet, dass ${i.origin??"Wert"} ${o}${i.maximum.toString()} ${s.unit??"Elemente"} hat`:`Zu groß: erwartet, dass ${i.origin??"Wert"} ${o}${i.maximum.toString()} ist`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`Zu klein: erwartet, dass ${i.origin} ${o}${i.minimum.toString()} ${s.unit} hat`:`Zu klein: erwartet, dass ${i.origin} ${o}${i.minimum.toString()} ist`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Ungültiger String: muss mit "${o.prefix}" beginnen`:o.format==="ends_with"?`Ungültiger String: muss mit "${o.suffix}" enden`:o.format==="includes"?`Ungültiger String: muss "${o.includes}" enthalten`:o.format==="regex"?`Ungültiger String: muss dem Muster ${o.pattern} entsprechen`:`Ungültig: ${r[o.format]??i.format}`}case"not_multiple_of":return`Ungültige Zahl: muss ein Vielfaches von ${i.divisor} sein`;case"unrecognized_keys":return`${i.keys.length>1?"Unbekannte Schlüssel":"Unbekannter Schlüssel"}: ${De(i.keys,", ")}`;case"invalid_key":return`Ungültiger Schlüssel in ${i.origin}`;case"invalid_union":return"Ungültige Eingabe";case"invalid_element":return`Ungültiger Wert in ${i.origin}`;default:return"Ungültige Eingabe"}}};function oLe(){return{localeError:iLe()}}const sLe=t=>{const e=typeof t;switch(e){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return e},aLe=()=>{const t={string:{unit:"characters",verb:"to have"},file:{unit:"bytes",verb:"to have"},array:{unit:"items",verb:"to have"},set:{unit:"items",verb:"to have"}};function e(r){return t[r]??null}const n={regex:"input",email:"email address",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datetime",date:"ISO date",time:"ISO time",duration:"ISO duration",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded string",base64url:"base64url-encoded string",json_string:"JSON string",e164:"E.164 number",jwt:"JWT",template_literal:"input"};return r=>{switch(r.code){case"invalid_type":return`Invalid input: expected ${r.expected}, received ${sLe(r.input)}`;case"invalid_value":return r.values.length===1?`Invalid input: expected ${yt(r.values[0])}`:`Invalid option: expected one of ${De(r.values,"|")}`;case"too_big":{const i=r.inclusive?"<=":"<",o=e(r.origin);return o?`Too big: expected ${r.origin??"value"} to have ${i}${r.maximum.toString()} ${o.unit??"elements"}`:`Too big: expected ${r.origin??"value"} to be ${i}${r.maximum.toString()}`}case"too_small":{const i=r.inclusive?">=":">",o=e(r.origin);return o?`Too small: expected ${r.origin} to have ${i}${r.minimum.toString()} ${o.unit}`:`Too small: expected ${r.origin} to be ${i}${r.minimum.toString()}`}case"invalid_format":{const i=r;return i.format==="starts_with"?`Invalid string: must start with "${i.prefix}"`:i.format==="ends_with"?`Invalid string: must end with "${i.suffix}"`:i.format==="includes"?`Invalid string: must include "${i.includes}"`:i.format==="regex"?`Invalid string: must match pattern ${i.pattern}`:`Invalid ${n[i.format]??r.format}`}case"not_multiple_of":return`Invalid number: must be a multiple of ${r.divisor}`;case"unrecognized_keys":return`Unrecognized key${r.keys.length>1?"s":""}: ${De(r.keys,", ")}`;case"invalid_key":return`Invalid key in ${r.origin}`;case"invalid_union":return"Invalid input";case"invalid_element":return`Invalid value in ${r.origin}`;default:return"Invalid input"}}};function Xee(){return{localeError:aLe()}}const lLe=t=>{const e=typeof t;switch(e){case"number":return Number.isNaN(t)?"NaN":"nombro";case"object":{if(Array.isArray(t))return"tabelo";if(t===null)return"senvalora";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return e},cLe=()=>{const t={string:{unit:"karaktrojn",verb:"havi"},file:{unit:"bajtojn",verb:"havi"},array:{unit:"elementojn",verb:"havi"},set:{unit:"elementojn",verb:"havi"}};function e(r){return t[r]??null}const n={regex:"enigo",email:"retadreso",url:"URL",emoji:"emoĝio",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-datotempo",date:"ISO-dato",time:"ISO-tempo",duration:"ISO-daŭro",ipv4:"IPv4-adreso",ipv6:"IPv6-adreso",cidrv4:"IPv4-rango",cidrv6:"IPv6-rango",base64:"64-ume kodita karaktraro",base64url:"URL-64-ume kodita karaktraro",json_string:"JSON-karaktraro",e164:"E.164-nombro",jwt:"JWT",template_literal:"enigo"};return r=>{switch(r.code){case"invalid_type":return`Nevalida enigo: atendiĝis ${r.expected}, riceviĝis ${lLe(r.input)}`;case"invalid_value":return r.values.length===1?`Nevalida enigo: atendiĝis ${yt(r.values[0])}`:`Nevalida opcio: atendiĝis unu el ${De(r.values,"|")}`;case"too_big":{const i=r.inclusive?"<=":"<",o=e(r.origin);return o?`Tro granda: atendiĝis ke ${r.origin??"valoro"} havu ${i}${r.maximum.toString()} ${o.unit??"elementojn"}`:`Tro granda: atendiĝis ke ${r.origin??"valoro"} havu ${i}${r.maximum.toString()}`}case"too_small":{const i=r.inclusive?">=":">",o=e(r.origin);return o?`Tro malgranda: atendiĝis ke ${r.origin} havu ${i}${r.minimum.toString()} ${o.unit}`:`Tro malgranda: atendiĝis ke ${r.origin} estu ${i}${r.minimum.toString()}`}case"invalid_format":{const i=r;return i.format==="starts_with"?`Nevalida karaktraro: devas komenciĝi per "${i.prefix}"`:i.format==="ends_with"?`Nevalida karaktraro: devas finiĝi per "${i.suffix}"`:i.format==="includes"?`Nevalida karaktraro: devas inkluzivi "${i.includes}"`:i.format==="regex"?`Nevalida karaktraro: devas kongrui kun la modelo ${i.pattern}`:`Nevalida ${n[i.format]??r.format}`}case"not_multiple_of":return`Nevalida nombro: devas esti oblo de ${r.divisor}`;case"unrecognized_keys":return`Nekonata${r.keys.length>1?"j":""} ŝlosilo${r.keys.length>1?"j":""}: ${De(r.keys,", ")}`;case"invalid_key":return`Nevalida ŝlosilo en ${r.origin}`;case"invalid_union":return"Nevalida enigo";case"invalid_element":return`Nevalida valoro en ${r.origin}`;default:return"Nevalida enigo"}}};function uLe(){return{localeError:cLe()}}const dLe=()=>{const t={string:{unit:"caracteres",verb:"tener"},file:{unit:"bytes",verb:"tener"},array:{unit:"elementos",verb:"tener"},set:{unit:"elementos",verb:"tener"}},e={string:"texto",number:"número",boolean:"booleano",array:"arreglo",object:"objeto",set:"conjunto",file:"archivo",date:"fecha",bigint:"número grande",symbol:"símbolo",undefined:"indefinido",null:"nulo",function:"función",map:"mapa",record:"registro",tuple:"tupla",enum:"enumeración",union:"unión",literal:"literal",promise:"promesa",void:"vacío",never:"nunca",unknown:"desconocido",any:"cualquiera"};function n(s){return t[s]??null}function r(s){return e[s]??s}const i=s=>{const a=typeof s;switch(a){case"number":return Number.isNaN(s)?"NaN":"number";case"object":return Array.isArray(s)?"array":s===null?"null":Object.getPrototypeOf(s)!==Object.prototype?s.constructor.name:"object"}return a},o={regex:"entrada",email:"dirección de correo electrónico",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"fecha y hora ISO",date:"fecha ISO",time:"hora ISO",duration:"duración ISO",ipv4:"dirección IPv4",ipv6:"dirección IPv6",cidrv4:"rango IPv4",cidrv6:"rango IPv6",base64:"cadena codificada en base64",base64url:"URL codificada en base64",json_string:"cadena JSON",e164:"número E.164",jwt:"JWT",template_literal:"entrada"};return s=>{switch(s.code){case"invalid_type":return`Entrada inválida: se esperaba ${r(s.expected)}, recibido ${r(i(s.input))}`;case"invalid_value":return s.values.length===1?`Entrada inválida: se esperaba ${yt(s.values[0])}`:`Opción inválida: se esperaba una de ${De(s.values,"|")}`;case"too_big":{const a=s.inclusive?"<=":"<",l=n(s.origin),c=r(s.origin);return l?`Demasiado grande: se esperaba que ${c??"valor"} tuviera ${a}${s.maximum.toString()} ${l.unit??"elementos"}`:`Demasiado grande: se esperaba que ${c??"valor"} fuera ${a}${s.maximum.toString()}`}case"too_small":{const a=s.inclusive?">=":">",l=n(s.origin),c=r(s.origin);return l?`Demasiado pequeño: se esperaba que ${c} tuviera ${a}${s.minimum.toString()} ${l.unit}`:`Demasiado pequeño: se esperaba que ${c} fuera ${a}${s.minimum.toString()}`}case"invalid_format":{const a=s;return a.format==="starts_with"?`Cadena inválida: debe comenzar con "${a.prefix}"`:a.format==="ends_with"?`Cadena inválida: debe terminar en "${a.suffix}"`:a.format==="includes"?`Cadena inválida: debe incluir "${a.includes}"`:a.format==="regex"?`Cadena inválida: debe coincidir con el patrón ${a.pattern}`:`Inválido ${o[a.format]??s.format}`}case"not_multiple_of":return`Número inválido: debe ser múltiplo de ${s.divisor}`;case"unrecognized_keys":return`Llave${s.keys.length>1?"s":""} desconocida${s.keys.length>1?"s":""}: ${De(s.keys,", ")}`;case"invalid_key":return`Llave inválida en ${r(s.origin)}`;case"invalid_union":return"Entrada inválida";case"invalid_element":return`Valor inválido en ${r(s.origin)}`;default:return"Entrada inválida"}}};function hLe(){return{localeError:dLe()}}const pLe=()=>{const t={string:{unit:"کاراکتر",verb:"داشته باشد"},file:{unit:"بایت",verb:"داشته باشد"},array:{unit:"آیتم",verb:"داشته باشد"},set:{unit:"آیتم",verb:"داشته باشد"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"عدد";case"object":{if(Array.isArray(i))return"آرایه";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"ورودی",email:"آدرس ایمیل",url:"URL",emoji:"ایموجی",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"تاریخ و زمان ایزو",date:"تاریخ ایزو",time:"زمان ایزو",duration:"مدت زمان ایزو",ipv4:"IPv4 آدرس",ipv6:"IPv6 آدرس",cidrv4:"IPv4 دامنه",cidrv6:"IPv6 دامنه",base64:"base64-encoded رشته",base64url:"base64url-encoded رشته",json_string:"JSON رشته",e164:"E.164 عدد",jwt:"JWT",template_literal:"ورودی"};return i=>{switch(i.code){case"invalid_type":return`ورودی نامعتبر: می‌بایست ${i.expected} می‌بود، ${n(i.input)} دریافت شد`;case"invalid_value":return i.values.length===1?`ورودی نامعتبر: می‌بایست ${yt(i.values[0])} می‌بود`:`گزینه نامعتبر: می‌بایست یکی از ${De(i.values,"|")} می‌بود`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`خیلی بزرگ: ${i.origin??"مقدار"} باید ${o}${i.maximum.toString()} ${s.unit??"عنصر"} باشد`:`خیلی بزرگ: ${i.origin??"مقدار"} باید ${o}${i.maximum.toString()} باشد`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`خیلی کوچک: ${i.origin} باید ${o}${i.minimum.toString()} ${s.unit} باشد`:`خیلی کوچک: ${i.origin} باید ${o}${i.minimum.toString()} باشد`}case"invalid_format":{const o=i;return o.format==="starts_with"?`رشته نامعتبر: باید با "${o.prefix}" شروع شود`:o.format==="ends_with"?`رشته نامعتبر: باید با "${o.suffix}" تمام شود`:o.format==="includes"?`رشته نامعتبر: باید شامل "${o.includes}" باشد`:o.format==="regex"?`رشته نامعتبر: باید با الگوی ${o.pattern} مطابقت داشته باشد`:`${r[o.format]??i.format} نامعتبر`}case"not_multiple_of":return`عدد نامعتبر: باید مضرب ${i.divisor} باشد`;case"unrecognized_keys":return`کلید${i.keys.length>1?"های":""} ناشناس: ${De(i.keys,", ")}`;case"invalid_key":return`کلید ناشناس در ${i.origin}`;case"invalid_union":return"ورودی نامعتبر";case"invalid_element":return`مقدار نامعتبر در ${i.origin}`;default:return"ورودی نامعتبر"}}};function fLe(){return{localeError:pLe()}}const gLe=()=>{const t={string:{unit:"merkkiä",subject:"merkkijonon"},file:{unit:"tavua",subject:"tiedoston"},array:{unit:"alkiota",subject:"listan"},set:{unit:"alkiota",subject:"joukon"},number:{unit:"",subject:"luvun"},bigint:{unit:"",subject:"suuren kokonaisluvun"},int:{unit:"",subject:"kokonaisluvun"},date:{unit:"",subject:"päivämäärän"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"number";case"object":{if(Array.isArray(i))return"array";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"säännöllinen lauseke",email:"sähköpostiosoite",url:"URL-osoite",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-aikaleima",date:"ISO-päivämäärä",time:"ISO-aika",duration:"ISO-kesto",ipv4:"IPv4-osoite",ipv6:"IPv6-osoite",cidrv4:"IPv4-alue",cidrv6:"IPv6-alue",base64:"base64-koodattu merkkijono",base64url:"base64url-koodattu merkkijono",json_string:"JSON-merkkijono",e164:"E.164-luku",jwt:"JWT",template_literal:"templaattimerkkijono"};return i=>{switch(i.code){case"invalid_type":return`Virheellinen tyyppi: odotettiin ${i.expected}, oli ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Virheellinen syöte: täytyy olla ${yt(i.values[0])}`:`Virheellinen valinta: täytyy olla yksi seuraavista: ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`Liian suuri: ${s.subject} täytyy olla ${o}${i.maximum.toString()} ${s.unit}`.trim():`Liian suuri: arvon täytyy olla ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`Liian pieni: ${s.subject} täytyy olla ${o}${i.minimum.toString()} ${s.unit}`.trim():`Liian pieni: arvon täytyy olla ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Virheellinen syöte: täytyy alkaa "${o.prefix}"`:o.format==="ends_with"?`Virheellinen syöte: täytyy loppua "${o.suffix}"`:o.format==="includes"?`Virheellinen syöte: täytyy sisältää "${o.includes}"`:o.format==="regex"?`Virheellinen syöte: täytyy vastata säännöllistä lauseketta ${o.pattern}`:`Virheellinen ${r[o.format]??i.format}`}case"not_multiple_of":return`Virheellinen luku: täytyy olla luvun ${i.divisor} monikerta`;case"unrecognized_keys":return`${i.keys.length>1?"Tuntemattomat avaimet":"Tuntematon avain"}: ${De(i.keys,", ")}`;case"invalid_key":return"Virheellinen avain tietueessa";case"invalid_union":return"Virheellinen unioni";case"invalid_element":return"Virheellinen arvo joukossa";default:return"Virheellinen syöte"}}};function mLe(){return{localeError:gLe()}}const yLe=()=>{const t={string:{unit:"caractères",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"éléments",verb:"avoir"},set:{unit:"éléments",verb:"avoir"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"nombre";case"object":{if(Array.isArray(i))return"tableau";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"entrée",email:"adresse e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date et heure ISO",date:"date ISO",time:"heure ISO",duration:"durée ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"chaîne encodée en base64",base64url:"chaîne encodée en base64url",json_string:"chaîne JSON",e164:"numéro E.164",jwt:"JWT",template_literal:"entrée"};return i=>{switch(i.code){case"invalid_type":return`Entrée invalide : ${i.expected} attendu, ${n(i.input)} reçu`;case"invalid_value":return i.values.length===1?`Entrée invalide : ${yt(i.values[0])} attendu`:`Option invalide : une valeur parmi ${De(i.values,"|")} attendue`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`Trop grand : ${i.origin??"valeur"} doit ${s.verb} ${o}${i.maximum.toString()} ${s.unit??"élément(s)"}`:`Trop grand : ${i.origin??"valeur"} doit être ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`Trop petit : ${i.origin} doit ${s.verb} ${o}${i.minimum.toString()} ${s.unit}`:`Trop petit : ${i.origin} doit être ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Chaîne invalide : doit commencer par "${o.prefix}"`:o.format==="ends_with"?`Chaîne invalide : doit se terminer par "${o.suffix}"`:o.format==="includes"?`Chaîne invalide : doit inclure "${o.includes}"`:o.format==="regex"?`Chaîne invalide : doit correspondre au modèle ${o.pattern}`:`${r[o.format]??i.format} invalide`}case"not_multiple_of":return`Nombre invalide : doit être un multiple de ${i.divisor}`;case"unrecognized_keys":return`Clé${i.keys.length>1?"s":""} non reconnue${i.keys.length>1?"s":""} : ${De(i.keys,", ")}`;case"invalid_key":return`Clé invalide dans ${i.origin}`;case"invalid_union":return"Entrée invalide";case"invalid_element":return`Valeur invalide dans ${i.origin}`;default:return"Entrée invalide"}}};function vLe(){return{localeError:yLe()}}const xLe=()=>{const t={string:{unit:"caractères",verb:"avoir"},file:{unit:"octets",verb:"avoir"},array:{unit:"éléments",verb:"avoir"},set:{unit:"éléments",verb:"avoir"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"number";case"object":{if(Array.isArray(i))return"array";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"entrée",email:"adresse courriel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"date-heure ISO",date:"date ISO",time:"heure ISO",duration:"durée ISO",ipv4:"adresse IPv4",ipv6:"adresse IPv6",cidrv4:"plage IPv4",cidrv6:"plage IPv6",base64:"chaîne encodée en base64",base64url:"chaîne encodée en base64url",json_string:"chaîne JSON",e164:"numéro E.164",jwt:"JWT",template_literal:"entrée"};return i=>{switch(i.code){case"invalid_type":return`Entrée invalide : attendu ${i.expected}, reçu ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Entrée invalide : attendu ${yt(i.values[0])}`:`Option invalide : attendu l'une des valeurs suivantes ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"≤":"<",s=e(i.origin);return s?`Trop grand : attendu que ${i.origin??"la valeur"} ait ${o}${i.maximum.toString()} ${s.unit}`:`Trop grand : attendu que ${i.origin??"la valeur"} soit ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?"≥":">",s=e(i.origin);return s?`Trop petit : attendu que ${i.origin} ait ${o}${i.minimum.toString()} ${s.unit}`:`Trop petit : attendu que ${i.origin} soit ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Chaîne invalide : doit commencer par "${o.prefix}"`:o.format==="ends_with"?`Chaîne invalide : doit se terminer par "${o.suffix}"`:o.format==="includes"?`Chaîne invalide : doit inclure "${o.includes}"`:o.format==="regex"?`Chaîne invalide : doit correspondre au motif ${o.pattern}`:`${r[o.format]??i.format} invalide`}case"not_multiple_of":return`Nombre invalide : doit être un multiple de ${i.divisor}`;case"unrecognized_keys":return`Clé${i.keys.length>1?"s":""} non reconnue${i.keys.length>1?"s":""} : ${De(i.keys,", ")}`;case"invalid_key":return`Clé invalide dans ${i.origin}`;case"invalid_union":return"Entrée invalide";case"invalid_element":return`Valeur invalide dans ${i.origin}`;default:return"Entrée invalide"}}};function SLe(){return{localeError:xLe()}}const bLe=()=>{const t={string:{unit:"אותיות",verb:"לכלול"},file:{unit:"בייטים",verb:"לכלול"},array:{unit:"פריטים",verb:"לכלול"},set:{unit:"פריטים",verb:"לכלול"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"number";case"object":{if(Array.isArray(i))return"array";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"קלט",email:"כתובת אימייל",url:"כתובת רשת",emoji:"אימוג'י",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"תאריך וזמן ISO",date:"תאריך ISO",time:"זמן ISO",duration:"משך זמן ISO",ipv4:"כתובת IPv4",ipv6:"כתובת IPv6",cidrv4:"טווח IPv4",cidrv6:"טווח IPv6",base64:"מחרוזת בבסיס 64",base64url:"מחרוזת בבסיס 64 לכתובות רשת",json_string:"מחרוזת JSON",e164:"מספר E.164",jwt:"JWT",template_literal:"קלט"};return i=>{switch(i.code){case"invalid_type":return`קלט לא תקין: צריך ${i.expected}, התקבל ${n(i.input)}`;case"invalid_value":return i.values.length===1?`קלט לא תקין: צריך ${yt(i.values[0])}`:`קלט לא תקין: צריך אחת מהאפשרויות  ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`גדול מדי: ${i.origin??"value"} צריך להיות ${o}${i.maximum.toString()} ${s.unit??"elements"}`:`גדול מדי: ${i.origin??"value"} צריך להיות ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`קטן מדי: ${i.origin} צריך להיות ${o}${i.minimum.toString()} ${s.unit}`:`קטן מדי: ${i.origin} צריך להיות ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`מחרוזת לא תקינה: חייבת להתחיל ב"${o.prefix}"`:o.format==="ends_with"?`מחרוזת לא תקינה: חייבת להסתיים ב "${o.suffix}"`:o.format==="includes"?`מחרוזת לא תקינה: חייבת לכלול "${o.includes}"`:o.format==="regex"?`מחרוזת לא תקינה: חייבת להתאים לתבנית ${o.pattern}`:`${r[o.format]??i.format} לא תקין`}case"not_multiple_of":return`מספר לא תקין: חייב להיות מכפלה של ${i.divisor}`;case"unrecognized_keys":return`מפתח${i.keys.length>1?"ות":""} לא מזוה${i.keys.length>1?"ים":"ה"}: ${De(i.keys,", ")}`;case"invalid_key":return`מפתח לא תקין ב${i.origin}`;case"invalid_union":return"קלט לא תקין";case"invalid_element":return`ערך לא תקין ב${i.origin}`;default:return"קלט לא תקין"}}};function wLe(){return{localeError:bLe()}}const kLe=()=>{const t={string:{unit:"karakter",verb:"legyen"},file:{unit:"byte",verb:"legyen"},array:{unit:"elem",verb:"legyen"},set:{unit:"elem",verb:"legyen"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"szám";case"object":{if(Array.isArray(i))return"tömb";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"bemenet",email:"email cím",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO időbélyeg",date:"ISO dátum",time:"ISO idő",duration:"ISO időintervallum",ipv4:"IPv4 cím",ipv6:"IPv6 cím",cidrv4:"IPv4 tartomány",cidrv6:"IPv6 tartomány",base64:"base64-kódolt string",base64url:"base64url-kódolt string",json_string:"JSON string",e164:"E.164 szám",jwt:"JWT",template_literal:"bemenet"};return i=>{switch(i.code){case"invalid_type":return`Érvénytelen bemenet: a várt érték ${i.expected}, a kapott érték ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Érvénytelen bemenet: a várt érték ${yt(i.values[0])}`:`Érvénytelen opció: valamelyik érték várt ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`Túl nagy: ${i.origin??"érték"} mérete túl nagy ${o}${i.maximum.toString()} ${s.unit??"elem"}`:`Túl nagy: a bemeneti érték ${i.origin??"érték"} túl nagy: ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`Túl kicsi: a bemeneti érték ${i.origin} mérete túl kicsi ${o}${i.minimum.toString()} ${s.unit}`:`Túl kicsi: a bemeneti érték ${i.origin} túl kicsi ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Érvénytelen string: "${o.prefix}" értékkel kell kezdődnie`:o.format==="ends_with"?`Érvénytelen string: "${o.suffix}" értékkel kell végződnie`:o.format==="includes"?`Érvénytelen string: "${o.includes}" értéket kell tartalmaznia`:o.format==="regex"?`Érvénytelen string: ${o.pattern} mintának kell megfelelnie`:`Érvénytelen ${r[o.format]??i.format}`}case"not_multiple_of":return`Érvénytelen szám: ${i.divisor} többszörösének kell lennie`;case"unrecognized_keys":return`Ismeretlen kulcs${i.keys.length>1?"s":""}: ${De(i.keys,", ")}`;case"invalid_key":return`Érvénytelen kulcs ${i.origin}`;case"invalid_union":return"Érvénytelen bemenet";case"invalid_element":return`Érvénytelen érték: ${i.origin}`;default:return"Érvénytelen bemenet"}}};function ILe(){return{localeError:kLe()}}const _Le=()=>{const t={string:{unit:"karakter",verb:"memiliki"},file:{unit:"byte",verb:"memiliki"},array:{unit:"item",verb:"memiliki"},set:{unit:"item",verb:"memiliki"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"number";case"object":{if(Array.isArray(i))return"array";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"input",email:"alamat email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tanggal dan waktu format ISO",date:"tanggal format ISO",time:"jam format ISO",duration:"durasi format ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"rentang alamat IPv4",cidrv6:"rentang alamat IPv6",base64:"string dengan enkode base64",base64url:"string dengan enkode base64url",json_string:"string JSON",e164:"angka E.164",jwt:"JWT",template_literal:"input"};return i=>{switch(i.code){case"invalid_type":return`Input tidak valid: diharapkan ${i.expected}, diterima ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Input tidak valid: diharapkan ${yt(i.values[0])}`:`Pilihan tidak valid: diharapkan salah satu dari ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`Terlalu besar: diharapkan ${i.origin??"value"} memiliki ${o}${i.maximum.toString()} ${s.unit??"elemen"}`:`Terlalu besar: diharapkan ${i.origin??"value"} menjadi ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`Terlalu kecil: diharapkan ${i.origin} memiliki ${o}${i.minimum.toString()} ${s.unit}`:`Terlalu kecil: diharapkan ${i.origin} menjadi ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`String tidak valid: harus dimulai dengan "${o.prefix}"`:o.format==="ends_with"?`String tidak valid: harus berakhir dengan "${o.suffix}"`:o.format==="includes"?`String tidak valid: harus menyertakan "${o.includes}"`:o.format==="regex"?`String tidak valid: harus sesuai pola ${o.pattern}`:`${r[o.format]??i.format} tidak valid`}case"not_multiple_of":return`Angka tidak valid: harus kelipatan dari ${i.divisor}`;case"unrecognized_keys":return`Kunci tidak dikenali ${i.keys.length>1?"s":""}: ${De(i.keys,", ")}`;case"invalid_key":return`Kunci tidak valid di ${i.origin}`;case"invalid_union":return"Input tidak valid";case"invalid_element":return`Nilai tidak valid di ${i.origin}`;default:return"Input tidak valid"}}};function CLe(){return{localeError:_Le()}}const PLe=t=>{const e=typeof t;switch(e){case"number":return Number.isNaN(t)?"NaN":"númer";case"object":{if(Array.isArray(t))return"fylki";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return e},TLe=()=>{const t={string:{unit:"stafi",verb:"að hafa"},file:{unit:"bæti",verb:"að hafa"},array:{unit:"hluti",verb:"að hafa"},set:{unit:"hluti",verb:"að hafa"}};function e(r){return t[r]??null}const n={regex:"gildi",email:"netfang",url:"vefslóð",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dagsetning og tími",date:"ISO dagsetning",time:"ISO tími",duration:"ISO tímalengd",ipv4:"IPv4 address",ipv6:"IPv6 address",cidrv4:"IPv4 range",cidrv6:"IPv6 range",base64:"base64-encoded strengur",base64url:"base64url-encoded strengur",json_string:"JSON strengur",e164:"E.164 tölugildi",jwt:"JWT",template_literal:"gildi"};return r=>{switch(r.code){case"invalid_type":return`Rangt gildi: Þú slóst inn ${PLe(r.input)} þar sem á að vera ${r.expected}`;case"invalid_value":return r.values.length===1?`Rangt gildi: gert ráð fyrir ${yt(r.values[0])}`:`Ógilt val: má vera eitt af eftirfarandi ${De(r.values,"|")}`;case"too_big":{const i=r.inclusive?"<=":"<",o=e(r.origin);return o?`Of stórt: gert er ráð fyrir að ${r.origin??"gildi"} hafi ${i}${r.maximum.toString()} ${o.unit??"hluti"}`:`Of stórt: gert er ráð fyrir að ${r.origin??"gildi"} sé ${i}${r.maximum.toString()}`}case"too_small":{const i=r.inclusive?">=":">",o=e(r.origin);return o?`Of lítið: gert er ráð fyrir að ${r.origin} hafi ${i}${r.minimum.toString()} ${o.unit}`:`Of lítið: gert er ráð fyrir að ${r.origin} sé ${i}${r.minimum.toString()}`}case"invalid_format":{const i=r;return i.format==="starts_with"?`Ógildur strengur: verður að byrja á "${i.prefix}"`:i.format==="ends_with"?`Ógildur strengur: verður að enda á "${i.suffix}"`:i.format==="includes"?`Ógildur strengur: verður að innihalda "${i.includes}"`:i.format==="regex"?`Ógildur strengur: verður að fylgja mynstri ${i.pattern}`:`Rangt ${n[i.format]??r.format}`}case"not_multiple_of":return`Röng tala: verður að vera margfeldi af ${r.divisor}`;case"unrecognized_keys":return`Óþekkt ${r.keys.length>1?"ir lyklar":"ur lykill"}: ${De(r.keys,", ")}`;case"invalid_key":return`Rangur lykill í ${r.origin}`;case"invalid_union":return"Rangt gildi";case"invalid_element":return`Rangt gildi í ${r.origin}`;default:return"Rangt gildi"}}};function ELe(){return{localeError:TLe()}}const ALe=()=>{const t={string:{unit:"caratteri",verb:"avere"},file:{unit:"byte",verb:"avere"},array:{unit:"elementi",verb:"avere"},set:{unit:"elementi",verb:"avere"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"numero";case"object":{if(Array.isArray(i))return"vettore";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"input",email:"indirizzo email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e ora ISO",date:"data ISO",time:"ora ISO",duration:"durata ISO",ipv4:"indirizzo IPv4",ipv6:"indirizzo IPv6",cidrv4:"intervallo IPv4",cidrv6:"intervallo IPv6",base64:"stringa codificata in base64",base64url:"URL codificata in base64",json_string:"stringa JSON",e164:"numero E.164",jwt:"JWT",template_literal:"input"};return i=>{switch(i.code){case"invalid_type":return`Input non valido: atteso ${i.expected}, ricevuto ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Input non valido: atteso ${yt(i.values[0])}`:`Opzione non valida: atteso uno tra ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`Troppo grande: ${i.origin??"valore"} deve avere ${o}${i.maximum.toString()} ${s.unit??"elementi"}`:`Troppo grande: ${i.origin??"valore"} deve essere ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`Troppo piccolo: ${i.origin} deve avere ${o}${i.minimum.toString()} ${s.unit}`:`Troppo piccolo: ${i.origin} deve essere ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Stringa non valida: deve iniziare con "${o.prefix}"`:o.format==="ends_with"?`Stringa non valida: deve terminare con "${o.suffix}"`:o.format==="includes"?`Stringa non valida: deve includere "${o.includes}"`:o.format==="regex"?`Stringa non valida: deve corrispondere al pattern ${o.pattern}`:`Invalid ${r[o.format]??i.format}`}case"not_multiple_of":return`Numero non valido: deve essere un multiplo di ${i.divisor}`;case"unrecognized_keys":return`Chiav${i.keys.length>1?"i":"e"} non riconosciut${i.keys.length>1?"e":"a"}: ${De(i.keys,", ")}`;case"invalid_key":return`Chiave non valida in ${i.origin}`;case"invalid_union":return"Input non valido";case"invalid_element":return`Valore non valido in ${i.origin}`;default:return"Input non valido"}}};function MLe(){return{localeError:ALe()}}const OLe=()=>{const t={string:{unit:"文字",verb:"である"},file:{unit:"バイト",verb:"である"},array:{unit:"要素",verb:"である"},set:{unit:"要素",verb:"である"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"数値";case"object":{if(Array.isArray(i))return"配列";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"入力値",email:"メールアドレス",url:"URL",emoji:"絵文字",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO日時",date:"ISO日付",time:"ISO時刻",duration:"ISO期間",ipv4:"IPv4アドレス",ipv6:"IPv6アドレス",cidrv4:"IPv4範囲",cidrv6:"IPv6範囲",base64:"base64エンコード文字列",base64url:"base64urlエンコード文字列",json_string:"JSON文字列",e164:"E.164番号",jwt:"JWT",template_literal:"入力値"};return i=>{switch(i.code){case"invalid_type":return`無効な入力: ${i.expected}が期待されましたが、${n(i.input)}が入力されました`;case"invalid_value":return i.values.length===1?`無効な入力: ${yt(i.values[0])}が期待されました`:`無効な選択: ${De(i.values,"、")}のいずれかである必要があります`;case"too_big":{const o=i.inclusive?"以下である":"より小さい",s=e(i.origin);return s?`大きすぎる値: ${i.origin??"値"}は${i.maximum.toString()}${s.unit??"要素"}${o}必要があります`:`大きすぎる値: ${i.origin??"値"}は${i.maximum.toString()}${o}必要があります`}case"too_small":{const o=i.inclusive?"以上である":"より大きい",s=e(i.origin);return s?`小さすぎる値: ${i.origin}は${i.minimum.toString()}${s.unit}${o}必要があります`:`小さすぎる値: ${i.origin}は${i.minimum.toString()}${o}必要があります`}case"invalid_format":{const o=i;return o.format==="starts_with"?`無効な文字列: "${o.prefix}"で始まる必要があります`:o.format==="ends_with"?`無効な文字列: "${o.suffix}"で終わる必要があります`:o.format==="includes"?`無効な文字列: "${o.includes}"を含む必要があります`:o.format==="regex"?`無効な文字列: パターン${o.pattern}に一致する必要があります`:`無効な${r[o.format]??i.format}`}case"not_multiple_of":return`無効な数値: ${i.divisor}の倍数である必要があります`;case"unrecognized_keys":return`認識されていないキー${i.keys.length>1?"群":""}: ${De(i.keys,"、")}`;case"invalid_key":return`${i.origin}内の無効なキー`;case"invalid_union":return"無効な入力";case"invalid_element":return`${i.origin}内の無効な値`;default:return"無効な入力"}}};function DLe(){return{localeError:OLe()}}const jLe=t=>{const e=typeof t;switch(e){case"number":return Number.isNaN(t)?"NaN":"რიცხვი";case"object":{if(Array.isArray(t))return"მასივი";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return{string:"სტრინგი",boolean:"ბულეანი",undefined:"undefined",bigint:"bigint",symbol:"symbol",function:"ფუნქცია"}[e]??e},RLe=()=>{const t={string:{unit:"სიმბოლო",verb:"უნდა შეიცავდეს"},file:{unit:"ბაიტი",verb:"უნდა შეიცავდეს"},array:{unit:"ელემენტი",verb:"უნდა შეიცავდეს"},set:{unit:"ელემენტი",verb:"უნდა შეიცავდეს"}};function e(r){return t[r]??null}const n={regex:"შეყვანა",email:"ელ-ფოსტის მისამართი",url:"URL",emoji:"ემოჯი",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"თარიღი-დრო",date:"თარიღი",time:"დრო",duration:"ხანგრძლივობა",ipv4:"IPv4 მისამართი",ipv6:"IPv6 მისამართი",cidrv4:"IPv4 დიაპაზონი",cidrv6:"IPv6 დიაპაზონი",base64:"base64-კოდირებული სტრინგი",base64url:"base64url-კოდირებული სტრინგი",json_string:"JSON სტრინგი",e164:"E.164 ნომერი",jwt:"JWT",template_literal:"შეყვანა"};return r=>{switch(r.code){case"invalid_type":return`არასწორი შეყვანა: მოსალოდნელი ${r.expected}, მიღებული ${jLe(r.input)}`;case"invalid_value":return r.values.length===1?`არასწორი შეყვანა: მოსალოდნელი ${yt(r.values[0])}`:`არასწორი ვარიანტი: მოსალოდნელია ერთ-ერთი ${De(r.values,"|")}-დან`;case"too_big":{const i=r.inclusive?"<=":"<",o=e(r.origin);return o?`ზედმეტად დიდი: მოსალოდნელი ${r.origin??"მნიშვნელობა"} ${o.verb} ${i}${r.maximum.toString()} ${o.unit}`:`ზედმეტად დიდი: მოსალოდნელი ${r.origin??"მნიშვნელობა"} იყოს ${i}${r.maximum.toString()}`}case"too_small":{const i=r.inclusive?">=":">",o=e(r.origin);return o?`ზედმეტად პატარა: მოსალოდნელი ${r.origin} ${o.verb} ${i}${r.minimum.toString()} ${o.unit}`:`ზედმეტად პატარა: მოსალოდნელი ${r.origin} იყოს ${i}${r.minimum.toString()}`}case"invalid_format":{const i=r;return i.format==="starts_with"?`არასწორი სტრინგი: უნდა იწყებოდეს "${i.prefix}"-ით`:i.format==="ends_with"?`არასწორი სტრინგი: უნდა მთავრდებოდეს "${i.suffix}"-ით`:i.format==="includes"?`არასწორი სტრინგი: უნდა შეიცავდეს "${i.includes}"-ს`:i.format==="regex"?`არასწორი სტრინგი: უნდა შეესაბამებოდეს შაბლონს ${i.pattern}`:`არასწორი ${n[i.format]??r.format}`}case"not_multiple_of":return`არასწორი რიცხვი: უნდა იყოს ${r.divisor}-ის ჯერადი`;case"unrecognized_keys":return`უცნობი გასაღებ${r.keys.length>1?"ები":"ი"}: ${De(r.keys,", ")}`;case"invalid_key":return`არასწორი გასაღები ${r.origin}-ში`;case"invalid_union":return"არასწორი შეყვანა";case"invalid_element":return`არასწორი მნიშვნელობა ${r.origin}-ში`;default:return"არასწორი შეყვანა"}}};function $Le(){return{localeError:RLe()}}const NLe=()=>{const t={string:{unit:"តួអក្សរ",verb:"គួរមាន"},file:{unit:"បៃ",verb:"គួរមាន"},array:{unit:"ធាតុ",verb:"គួរមាន"},set:{unit:"ធាតុ",verb:"គួរមាន"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"មិនមែនជាលេខ (NaN)":"លេខ";case"object":{if(Array.isArray(i))return"អារេ (Array)";if(i===null)return"គ្មានតម្លៃ (null)";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"ទិន្នន័យបញ្ចូល",email:"អាសយដ្ឋានអ៊ីមែល",url:"URL",emoji:"សញ្ញាអារម្មណ៍",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"កាលបរិច្ឆេទ និងម៉ោង ISO",date:"កាលបរិច្ឆេទ ISO",time:"ម៉ោង ISO",duration:"រយៈពេល ISO",ipv4:"អាសយដ្ឋាន IPv4",ipv6:"អាសយដ្ឋាន IPv6",cidrv4:"ដែនអាសយដ្ឋាន IPv4",cidrv6:"ដែនអាសយដ្ឋាន IPv6",base64:"ខ្សែអក្សរអ៊ិកូដ base64",base64url:"ខ្សែអក្សរអ៊ិកូដ base64url",json_string:"ខ្សែអក្សរ JSON",e164:"លេខ E.164",jwt:"JWT",template_literal:"ទិន្នន័យបញ្ចូល"};return i=>{switch(i.code){case"invalid_type":return`ទិន្នន័យបញ្ចូលមិនត្រឹមត្រូវ៖ ត្រូវការ ${i.expected} ប៉ុន្តែទទួលបាន ${n(i.input)}`;case"invalid_value":return i.values.length===1?`ទិន្នន័យបញ្ចូលមិនត្រឹមត្រូវ៖ ត្រូវការ ${yt(i.values[0])}`:`ជម្រើសមិនត្រឹមត្រូវ៖ ត្រូវជាមួយក្នុងចំណោម ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`ធំពេក៖ ត្រូវការ ${i.origin??"តម្លៃ"} ${o} ${i.maximum.toString()} ${s.unit??"ធាតុ"}`:`ធំពេក៖ ត្រូវការ ${i.origin??"តម្លៃ"} ${o} ${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`តូចពេក៖ ត្រូវការ ${i.origin} ${o} ${i.minimum.toString()} ${s.unit}`:`តូចពេក៖ ត្រូវការ ${i.origin} ${o} ${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`ខ្សែអក្សរមិនត្រឹមត្រូវ៖ ត្រូវចាប់ផ្តើមដោយ "${o.prefix}"`:o.format==="ends_with"?`ខ្សែអក្សរមិនត្រឹមត្រូវ៖ ត្រូវបញ្ចប់ដោយ "${o.suffix}"`:o.format==="includes"?`ខ្សែអក្សរមិនត្រឹមត្រូវ៖ ត្រូវមាន "${o.includes}"`:o.format==="regex"?`ខ្សែអក្សរមិនត្រឹមត្រូវ៖ ត្រូវតែផ្គូផ្គងនឹងទម្រង់ដែលបានកំណត់ ${o.pattern}`:`មិនត្រឹមត្រូវ៖ ${r[o.format]??i.format}`}case"not_multiple_of":return`លេខមិនត្រឹមត្រូវ៖ ត្រូវតែជាពហុគុណនៃ ${i.divisor}`;case"unrecognized_keys":return`រកឃើញសោមិនស្គាល់៖ ${De(i.keys,", ")}`;case"invalid_key":return`សោមិនត្រឹមត្រូវនៅក្នុង ${i.origin}`;case"invalid_union":return"ទិន្នន័យមិនត្រឹមត្រូវ";case"invalid_element":return`ទិន្នន័យមិនត្រឹមត្រូវនៅក្នុង ${i.origin}`;default:return"ទិន្នន័យមិនត្រឹមត្រូវ"}}};function Zee(){return{localeError:NLe()}}function LLe(){return Zee()}const zLe=()=>{const t={string:{unit:"문자",verb:"to have"},file:{unit:"바이트",verb:"to have"},array:{unit:"개",verb:"to have"},set:{unit:"개",verb:"to have"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"number";case"object":{if(Array.isArray(i))return"array";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"입력",email:"이메일 주소",url:"URL",emoji:"이모지",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO 날짜시간",date:"ISO 날짜",time:"ISO 시간",duration:"ISO 기간",ipv4:"IPv4 주소",ipv6:"IPv6 주소",cidrv4:"IPv4 범위",cidrv6:"IPv6 범위",base64:"base64 인코딩 문자열",base64url:"base64url 인코딩 문자열",json_string:"JSON 문자열",e164:"E.164 번호",jwt:"JWT",template_literal:"입력"};return i=>{switch(i.code){case"invalid_type":return`잘못된 입력: 예상 타입은 ${i.expected}, 받은 타입은 ${n(i.input)}입니다`;case"invalid_value":return i.values.length===1?`잘못된 입력: 값은 ${yt(i.values[0])} 이어야 합니다`:`잘못된 옵션: ${De(i.values,"또는 ")} 중 하나여야 합니다`;case"too_big":{const o=i.inclusive?"이하":"미만",s=o==="미만"?"이어야 합니다":"여야 합니다",a=e(i.origin),l=a?.unit??"요소";return a?`${i.origin??"값"}이 너무 큽니다: ${i.maximum.toString()}${l} ${o}${s}`:`${i.origin??"값"}이 너무 큽니다: ${i.maximum.toString()} ${o}${s}`}case"too_small":{const o=i.inclusive?"이상":"초과",s=o==="이상"?"이어야 합니다":"여야 합니다",a=e(i.origin),l=a?.unit??"요소";return a?`${i.origin??"값"}이 너무 작습니다: ${i.minimum.toString()}${l} ${o}${s}`:`${i.origin??"값"}이 너무 작습니다: ${i.minimum.toString()} ${o}${s}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`잘못된 문자열: "${o.prefix}"(으)로 시작해야 합니다`:o.format==="ends_with"?`잘못된 문자열: "${o.suffix}"(으)로 끝나야 합니다`:o.format==="includes"?`잘못된 문자열: "${o.includes}"을(를) 포함해야 합니다`:o.format==="regex"?`잘못된 문자열: 정규식 ${o.pattern} 패턴과 일치해야 합니다`:`잘못된 ${r[o.format]??i.format}`}case"not_multiple_of":return`잘못된 숫자: ${i.divisor}의 배수여야 합니다`;case"unrecognized_keys":return`인식할 수 없는 키: ${De(i.keys,", ")}`;case"invalid_key":return`잘못된 키: ${i.origin}`;case"invalid_union":return"잘못된 입력";case"invalid_element":return`잘못된 값: ${i.origin}`;default:return"잘못된 입력"}}};function FLe(){return{localeError:zLe()}}const BLe=t=>Cm(typeof t,t),Cm=(t,e=void 0)=>{switch(t){case"number":return Number.isNaN(e)?"NaN":"skaičius";case"bigint":return"sveikasis skaičius";case"string":return"eilutė";case"boolean":return"loginė reikšmė";case"undefined":case"void":return"neapibrėžta reikšmė";case"function":return"funkcija";case"symbol":return"simbolis";case"object":return e===void 0?"nežinomas objektas":e===null?"nulinė reikšmė":Array.isArray(e)?"masyvas":Object.getPrototypeOf(e)!==Object.prototype&&e.constructor?e.constructor.name:"objektas";case"null":return"nulinė reikšmė"}return t},Zg=t=>t.charAt(0).toUpperCase()+t.slice(1);function sB(t){const e=Math.abs(t),n=e%10,r=e%100;return r>=11&&r<=19||n===0?"many":n===1?"one":"few"}const ULe=()=>{const t={string:{unit:{one:"simbolis",few:"simboliai",many:"simbolių"},verb:{smaller:{inclusive:"turi būti ne ilgesnė kaip",notInclusive:"turi būti trumpesnė kaip"},bigger:{inclusive:"turi būti ne trumpesnė kaip",notInclusive:"turi būti ilgesnė kaip"}}},file:{unit:{one:"baitas",few:"baitai",many:"baitų"},verb:{smaller:{inclusive:"turi būti ne didesnis kaip",notInclusive:"turi būti mažesnis kaip"},bigger:{inclusive:"turi būti ne mažesnis kaip",notInclusive:"turi būti didesnis kaip"}}},array:{unit:{one:"elementą",few:"elementus",many:"elementų"},verb:{smaller:{inclusive:"turi turėti ne daugiau kaip",notInclusive:"turi turėti mažiau kaip"},bigger:{inclusive:"turi turėti ne mažiau kaip",notInclusive:"turi turėti daugiau kaip"}}},set:{unit:{one:"elementą",few:"elementus",many:"elementų"},verb:{smaller:{inclusive:"turi turėti ne daugiau kaip",notInclusive:"turi turėti mažiau kaip"},bigger:{inclusive:"turi turėti ne mažiau kaip",notInclusive:"turi turėti daugiau kaip"}}}};function e(r,i,o,s){const a=t[r]??null;return a===null?a:{unit:a.unit[i],verb:a.verb[s][o?"inclusive":"notInclusive"]}}const n={regex:"įvestis",email:"el. pašto adresas",url:"URL",emoji:"jaustukas",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO data ir laikas",date:"ISO data",time:"ISO laikas",duration:"ISO trukmė",ipv4:"IPv4 adresas",ipv6:"IPv6 adresas",cidrv4:"IPv4 tinklo prefiksas (CIDR)",cidrv6:"IPv6 tinklo prefiksas (CIDR)",base64:"base64 užkoduota eilutė",base64url:"base64url užkoduota eilutė",json_string:"JSON eilutė",e164:"E.164 numeris",jwt:"JWT",template_literal:"įvestis"};return r=>{switch(r.code){case"invalid_type":return`Gautas tipas ${BLe(r.input)}, o tikėtasi - ${Cm(r.expected)}`;case"invalid_value":return r.values.length===1?`Privalo būti ${yt(r.values[0])}`:`Privalo būti vienas iš ${De(r.values,"|")} pasirinkimų`;case"too_big":{const i=Cm(r.origin),o=e(r.origin,sB(Number(r.maximum)),r.inclusive??!1,"smaller");if(o?.verb)return`${Zg(i??r.origin??"reikšmė")} ${o.verb} ${r.maximum.toString()} ${o.unit??"elementų"}`;const s=r.inclusive?"ne didesnis kaip":"mažesnis kaip";return`${Zg(i??r.origin??"reikšmė")} turi būti ${s} ${r.maximum.toString()} ${o?.unit}`}case"too_small":{const i=Cm(r.origin),o=e(r.origin,sB(Number(r.minimum)),r.inclusive??!1,"bigger");if(o?.verb)return`${Zg(i??r.origin??"reikšmė")} ${o.verb} ${r.minimum.toString()} ${o.unit??"elementų"}`;const s=r.inclusive?"ne mažesnis kaip":"didesnis kaip";return`${Zg(i??r.origin??"reikšmė")} turi būti ${s} ${r.minimum.toString()} ${o?.unit}`}case"invalid_format":{const i=r;return i.format==="starts_with"?`Eilutė privalo prasidėti "${i.prefix}"`:i.format==="ends_with"?`Eilutė privalo pasibaigti "${i.suffix}"`:i.format==="includes"?`Eilutė privalo įtraukti "${i.includes}"`:i.format==="regex"?`Eilutė privalo atitikti ${i.pattern}`:`Neteisingas ${n[i.format]??r.format}`}case"not_multiple_of":return`Skaičius privalo būti ${r.divisor} kartotinis.`;case"unrecognized_keys":return`Neatpažint${r.keys.length>1?"i":"as"} rakt${r.keys.length>1?"ai":"as"}: ${De(r.keys,", ")}`;case"invalid_key":return"Rastas klaidingas raktas";case"invalid_union":return"Klaidinga įvestis";case"invalid_element":{const i=Cm(r.origin);return`${Zg(i??r.origin??"reikšmė")} turi klaidingą įvestį`}default:return"Klaidinga įvestis"}}};function HLe(){return{localeError:ULe()}}const WLe=()=>{const t={string:{unit:"знаци",verb:"да имаат"},file:{unit:"бајти",verb:"да имаат"},array:{unit:"ставки",verb:"да имаат"},set:{unit:"ставки",verb:"да имаат"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"број";case"object":{if(Array.isArray(i))return"низа";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"внес",email:"адреса на е-пошта",url:"URL",emoji:"емоџи",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO датум и време",date:"ISO датум",time:"ISO време",duration:"ISO времетраење",ipv4:"IPv4 адреса",ipv6:"IPv6 адреса",cidrv4:"IPv4 опсег",cidrv6:"IPv6 опсег",base64:"base64-енкодирана низа",base64url:"base64url-енкодирана низа",json_string:"JSON низа",e164:"E.164 број",jwt:"JWT",template_literal:"внес"};return i=>{switch(i.code){case"invalid_type":return`Грешен внес: се очекува ${i.expected}, примено ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Invalid input: expected ${yt(i.values[0])}`:`Грешана опција: се очекува една ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`Премногу голем: се очекува ${i.origin??"вредноста"} да има ${o}${i.maximum.toString()} ${s.unit??"елементи"}`:`Премногу голем: се очекува ${i.origin??"вредноста"} да биде ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`Премногу мал: се очекува ${i.origin} да има ${o}${i.minimum.toString()} ${s.unit}`:`Премногу мал: се очекува ${i.origin} да биде ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Неважечка низа: мора да започнува со "${o.prefix}"`:o.format==="ends_with"?`Неважечка низа: мора да завршува со "${o.suffix}"`:o.format==="includes"?`Неважечка низа: мора да вклучува "${o.includes}"`:o.format==="regex"?`Неважечка низа: мора да одгоара на патернот ${o.pattern}`:`Invalid ${r[o.format]??i.format}`}case"not_multiple_of":return`Грешен број: мора да биде делив со ${i.divisor}`;case"unrecognized_keys":return`${i.keys.length>1?"Непрепознаени клучеви":"Непрепознаен клуч"}: ${De(i.keys,", ")}`;case"invalid_key":return`Грешен клуч во ${i.origin}`;case"invalid_union":return"Грешен внес";case"invalid_element":return`Грешна вредност во ${i.origin}`;default:return"Грешен внес"}}};function VLe(){return{localeError:WLe()}}const KLe=()=>{const t={string:{unit:"aksara",verb:"mempunyai"},file:{unit:"bait",verb:"mempunyai"},array:{unit:"elemen",verb:"mempunyai"},set:{unit:"elemen",verb:"mempunyai"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"nombor";case"object":{if(Array.isArray(i))return"array";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"input",email:"alamat e-mel",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"tarikh masa ISO",date:"tarikh ISO",time:"masa ISO",duration:"tempoh ISO",ipv4:"alamat IPv4",ipv6:"alamat IPv6",cidrv4:"julat IPv4",cidrv6:"julat IPv6",base64:"string dikodkan base64",base64url:"string dikodkan base64url",json_string:"string JSON",e164:"nombor E.164",jwt:"JWT",template_literal:"input"};return i=>{switch(i.code){case"invalid_type":return`Input tidak sah: dijangka ${i.expected}, diterima ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Input tidak sah: dijangka ${yt(i.values[0])}`:`Pilihan tidak sah: dijangka salah satu daripada ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`Terlalu besar: dijangka ${i.origin??"nilai"} ${s.verb} ${o}${i.maximum.toString()} ${s.unit??"elemen"}`:`Terlalu besar: dijangka ${i.origin??"nilai"} adalah ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`Terlalu kecil: dijangka ${i.origin} ${s.verb} ${o}${i.minimum.toString()} ${s.unit}`:`Terlalu kecil: dijangka ${i.origin} adalah ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`String tidak sah: mesti bermula dengan "${o.prefix}"`:o.format==="ends_with"?`String tidak sah: mesti berakhir dengan "${o.suffix}"`:o.format==="includes"?`String tidak sah: mesti mengandungi "${o.includes}"`:o.format==="regex"?`String tidak sah: mesti sepadan dengan corak ${o.pattern}`:`${r[o.format]??i.format} tidak sah`}case"not_multiple_of":return`Nombor tidak sah: perlu gandaan ${i.divisor}`;case"unrecognized_keys":return`Kunci tidak dikenali: ${De(i.keys,", ")}`;case"invalid_key":return`Kunci tidak sah dalam ${i.origin}`;case"invalid_union":return"Input tidak sah";case"invalid_element":return`Nilai tidak sah dalam ${i.origin}`;default:return"Input tidak sah"}}};function qLe(){return{localeError:KLe()}}const GLe=()=>{const t={string:{unit:"tekens"},file:{unit:"bytes"},array:{unit:"elementen"},set:{unit:"elementen"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"getal";case"object":{if(Array.isArray(i))return"array";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"invoer",email:"emailadres",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum en tijd",date:"ISO datum",time:"ISO tijd",duration:"ISO duur",ipv4:"IPv4-adres",ipv6:"IPv6-adres",cidrv4:"IPv4-bereik",cidrv6:"IPv6-bereik",base64:"base64-gecodeerde tekst",base64url:"base64 URL-gecodeerde tekst",json_string:"JSON string",e164:"E.164-nummer",jwt:"JWT",template_literal:"invoer"};return i=>{switch(i.code){case"invalid_type":return`Ongeldige invoer: verwacht ${i.expected}, ontving ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Ongeldige invoer: verwacht ${yt(i.values[0])}`:`Ongeldige optie: verwacht één van ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`Te lang: verwacht dat ${i.origin??"waarde"} ${o}${i.maximum.toString()} ${s.unit??"elementen"} bevat`:`Te lang: verwacht dat ${i.origin??"waarde"} ${o}${i.maximum.toString()} is`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`Te kort: verwacht dat ${i.origin} ${o}${i.minimum.toString()} ${s.unit} bevat`:`Te kort: verwacht dat ${i.origin} ${o}${i.minimum.toString()} is`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Ongeldige tekst: moet met "${o.prefix}" beginnen`:o.format==="ends_with"?`Ongeldige tekst: moet op "${o.suffix}" eindigen`:o.format==="includes"?`Ongeldige tekst: moet "${o.includes}" bevatten`:o.format==="regex"?`Ongeldige tekst: moet overeenkomen met patroon ${o.pattern}`:`Ongeldig: ${r[o.format]??i.format}`}case"not_multiple_of":return`Ongeldig getal: moet een veelvoud van ${i.divisor} zijn`;case"unrecognized_keys":return`Onbekende key${i.keys.length>1?"s":""}: ${De(i.keys,", ")}`;case"invalid_key":return`Ongeldige key in ${i.origin}`;case"invalid_union":return"Ongeldige invoer";case"invalid_element":return`Ongeldige waarde in ${i.origin}`;default:return"Ongeldige invoer"}}};function YLe(){return{localeError:GLe()}}const XLe=()=>{const t={string:{unit:"tegn",verb:"å ha"},file:{unit:"bytes",verb:"å ha"},array:{unit:"elementer",verb:"å inneholde"},set:{unit:"elementer",verb:"å inneholde"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"tall";case"object":{if(Array.isArray(i))return"liste";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"input",email:"e-postadresse",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO dato- og klokkeslett",date:"ISO-dato",time:"ISO-klokkeslett",duration:"ISO-varighet",ipv4:"IPv4-område",ipv6:"IPv6-område",cidrv4:"IPv4-spekter",cidrv6:"IPv6-spekter",base64:"base64-enkodet streng",base64url:"base64url-enkodet streng",json_string:"JSON-streng",e164:"E.164-nummer",jwt:"JWT",template_literal:"input"};return i=>{switch(i.code){case"invalid_type":return`Ugyldig input: forventet ${i.expected}, fikk ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Ugyldig verdi: forventet ${yt(i.values[0])}`:`Ugyldig valg: forventet en av ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`For stor(t): forventet ${i.origin??"value"} til å ha ${o}${i.maximum.toString()} ${s.unit??"elementer"}`:`For stor(t): forventet ${i.origin??"value"} til å ha ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`For lite(n): forventet ${i.origin} til å ha ${o}${i.minimum.toString()} ${s.unit}`:`For lite(n): forventet ${i.origin} til å ha ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Ugyldig streng: må starte med "${o.prefix}"`:o.format==="ends_with"?`Ugyldig streng: må ende med "${o.suffix}"`:o.format==="includes"?`Ugyldig streng: må inneholde "${o.includes}"`:o.format==="regex"?`Ugyldig streng: må matche mønsteret ${o.pattern}`:`Ugyldig ${r[o.format]??i.format}`}case"not_multiple_of":return`Ugyldig tall: må være et multiplum av ${i.divisor}`;case"unrecognized_keys":return`${i.keys.length>1?"Ukjente nøkler":"Ukjent nøkkel"}: ${De(i.keys,", ")}`;case"invalid_key":return`Ugyldig nøkkel i ${i.origin}`;case"invalid_union":return"Ugyldig input";case"invalid_element":return`Ugyldig verdi i ${i.origin}`;default:return"Ugyldig input"}}};function ZLe(){return{localeError:XLe()}}const JLe=()=>{const t={string:{unit:"harf",verb:"olmalıdır"},file:{unit:"bayt",verb:"olmalıdır"},array:{unit:"unsur",verb:"olmalıdır"},set:{unit:"unsur",verb:"olmalıdır"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"numara";case"object":{if(Array.isArray(i))return"saf";if(i===null)return"gayb";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"giren",email:"epostagâh",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO hengâmı",date:"ISO tarihi",time:"ISO zamanı",duration:"ISO müddeti",ipv4:"IPv4 nişânı",ipv6:"IPv6 nişânı",cidrv4:"IPv4 menzili",cidrv6:"IPv6 menzili",base64:"base64-şifreli metin",base64url:"base64url-şifreli metin",json_string:"JSON metin",e164:"E.164 sayısı",jwt:"JWT",template_literal:"giren"};return i=>{switch(i.code){case"invalid_type":return`Fâsit giren: umulan ${i.expected}, alınan ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Fâsit giren: umulan ${yt(i.values[0])}`:`Fâsit tercih: mûteberler ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`Fazla büyük: ${i.origin??"value"}, ${o}${i.maximum.toString()} ${s.unit??"elements"} sahip olmalıydı.`:`Fazla büyük: ${i.origin??"value"}, ${o}${i.maximum.toString()} olmalıydı.`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`Fazla küçük: ${i.origin}, ${o}${i.minimum.toString()} ${s.unit} sahip olmalıydı.`:`Fazla küçük: ${i.origin}, ${o}${i.minimum.toString()} olmalıydı.`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Fâsit metin: "${o.prefix}" ile başlamalı.`:o.format==="ends_with"?`Fâsit metin: "${o.suffix}" ile bitmeli.`:o.format==="includes"?`Fâsit metin: "${o.includes}" ihtivâ etmeli.`:o.format==="regex"?`Fâsit metin: ${o.pattern} nakşına uymalı.`:`Fâsit ${r[o.format]??i.format}`}case"not_multiple_of":return`Fâsit sayı: ${i.divisor} katı olmalıydı.`;case"unrecognized_keys":return`Tanınmayan anahtar ${i.keys.length>1?"s":""}: ${De(i.keys,", ")}`;case"invalid_key":return`${i.origin} için tanınmayan anahtar var.`;case"invalid_union":return"Giren tanınamadı.";case"invalid_element":return`${i.origin} için tanınmayan kıymet var.`;default:return"Kıymet tanınamadı."}}};function QLe(){return{localeError:JLe()}}const eze=()=>{const t={string:{unit:"توکي",verb:"ولري"},file:{unit:"بایټس",verb:"ولري"},array:{unit:"توکي",verb:"ولري"},set:{unit:"توکي",verb:"ولري"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"عدد";case"object":{if(Array.isArray(i))return"ارې";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"ورودي",email:"بریښنالیک",url:"یو آر ال",emoji:"ایموجي",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"نیټه او وخت",date:"نېټه",time:"وخت",duration:"موده",ipv4:"د IPv4 پته",ipv6:"د IPv6 پته",cidrv4:"د IPv4 ساحه",cidrv6:"د IPv6 ساحه",base64:"base64-encoded متن",base64url:"base64url-encoded متن",json_string:"JSON متن",e164:"د E.164 شمېره",jwt:"JWT",template_literal:"ورودي"};return i=>{switch(i.code){case"invalid_type":return`ناسم ورودي: باید ${i.expected} وای, مګر ${n(i.input)} ترلاسه شو`;case"invalid_value":return i.values.length===1?`ناسم ورودي: باید ${yt(i.values[0])} وای`:`ناسم انتخاب: باید یو له ${De(i.values,"|")} څخه وای`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`ډیر لوی: ${i.origin??"ارزښت"} باید ${o}${i.maximum.toString()} ${s.unit??"عنصرونه"} ولري`:`ډیر لوی: ${i.origin??"ارزښت"} باید ${o}${i.maximum.toString()} وي`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`ډیر کوچنی: ${i.origin} باید ${o}${i.minimum.toString()} ${s.unit} ولري`:`ډیر کوچنی: ${i.origin} باید ${o}${i.minimum.toString()} وي`}case"invalid_format":{const o=i;return o.format==="starts_with"?`ناسم متن: باید د "${o.prefix}" سره پیل شي`:o.format==="ends_with"?`ناسم متن: باید د "${o.suffix}" سره پای ته ورسيږي`:o.format==="includes"?`ناسم متن: باید "${o.includes}" ولري`:o.format==="regex"?`ناسم متن: باید د ${o.pattern} سره مطابقت ولري`:`${r[o.format]??i.format} ناسم دی`}case"not_multiple_of":return`ناسم عدد: باید د ${i.divisor} مضرب وي`;case"unrecognized_keys":return`ناسم ${i.keys.length>1?"کلیډونه":"کلیډ"}: ${De(i.keys,", ")}`;case"invalid_key":return`ناسم کلیډ په ${i.origin} کې`;case"invalid_union":return"ناسمه ورودي";case"invalid_element":return`ناسم عنصر په ${i.origin} کې`;default:return"ناسمه ورودي"}}};function tze(){return{localeError:eze()}}const nze=()=>{const t={string:{unit:"znaków",verb:"mieć"},file:{unit:"bajtów",verb:"mieć"},array:{unit:"elementów",verb:"mieć"},set:{unit:"elementów",verb:"mieć"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"liczba";case"object":{if(Array.isArray(i))return"tablica";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"wyrażenie",email:"adres email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data i godzina w formacie ISO",date:"data w formacie ISO",time:"godzina w formacie ISO",duration:"czas trwania ISO",ipv4:"adres IPv4",ipv6:"adres IPv6",cidrv4:"zakres IPv4",cidrv6:"zakres IPv6",base64:"ciąg znaków zakodowany w formacie base64",base64url:"ciąg znaków zakodowany w formacie base64url",json_string:"ciąg znaków w formacie JSON",e164:"liczba E.164",jwt:"JWT",template_literal:"wejście"};return i=>{switch(i.code){case"invalid_type":return`Nieprawidłowe dane wejściowe: oczekiwano ${i.expected}, otrzymano ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Nieprawidłowe dane wejściowe: oczekiwano ${yt(i.values[0])}`:`Nieprawidłowa opcja: oczekiwano jednej z wartości ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`Za duża wartość: oczekiwano, że ${i.origin??"wartość"} będzie mieć ${o}${i.maximum.toString()} ${s.unit??"elementów"}`:`Zbyt duż(y/a/e): oczekiwano, że ${i.origin??"wartość"} będzie wynosić ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`Za mała wartość: oczekiwano, że ${i.origin??"wartość"} będzie mieć ${o}${i.minimum.toString()} ${s.unit??"elementów"}`:`Zbyt mał(y/a/e): oczekiwano, że ${i.origin??"wartość"} będzie wynosić ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Nieprawidłowy ciąg znaków: musi zaczynać się od "${o.prefix}"`:o.format==="ends_with"?`Nieprawidłowy ciąg znaków: musi kończyć się na "${o.suffix}"`:o.format==="includes"?`Nieprawidłowy ciąg znaków: musi zawierać "${o.includes}"`:o.format==="regex"?`Nieprawidłowy ciąg znaków: musi odpowiadać wzorcowi ${o.pattern}`:`Nieprawidłow(y/a/e) ${r[o.format]??i.format}`}case"not_multiple_of":return`Nieprawidłowa liczba: musi być wielokrotnością ${i.divisor}`;case"unrecognized_keys":return`Nierozpoznane klucze${i.keys.length>1?"s":""}: ${De(i.keys,", ")}`;case"invalid_key":return`Nieprawidłowy klucz w ${i.origin}`;case"invalid_union":return"Nieprawidłowe dane wejściowe";case"invalid_element":return`Nieprawidłowa wartość w ${i.origin}`;default:return"Nieprawidłowe dane wejściowe"}}};function rze(){return{localeError:nze()}}const ize=()=>{const t={string:{unit:"caracteres",verb:"ter"},file:{unit:"bytes",verb:"ter"},array:{unit:"itens",verb:"ter"},set:{unit:"itens",verb:"ter"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"número";case"object":{if(Array.isArray(i))return"array";if(i===null)return"nulo";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"padrão",email:"endereço de e-mail",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"data e hora ISO",date:"data ISO",time:"hora ISO",duration:"duração ISO",ipv4:"endereço IPv4",ipv6:"endereço IPv6",cidrv4:"faixa de IPv4",cidrv6:"faixa de IPv6",base64:"texto codificado em base64",base64url:"URL codificada em base64",json_string:"texto JSON",e164:"número E.164",jwt:"JWT",template_literal:"entrada"};return i=>{switch(i.code){case"invalid_type":return`Tipo inválido: esperado ${i.expected}, recebido ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Entrada inválida: esperado ${yt(i.values[0])}`:`Opção inválida: esperada uma das ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`Muito grande: esperado que ${i.origin??"valor"} tivesse ${o}${i.maximum.toString()} ${s.unit??"elementos"}`:`Muito grande: esperado que ${i.origin??"valor"} fosse ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`Muito pequeno: esperado que ${i.origin} tivesse ${o}${i.minimum.toString()} ${s.unit}`:`Muito pequeno: esperado que ${i.origin} fosse ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Texto inválido: deve começar com "${o.prefix}"`:o.format==="ends_with"?`Texto inválido: deve terminar com "${o.suffix}"`:o.format==="includes"?`Texto inválido: deve incluir "${o.includes}"`:o.format==="regex"?`Texto inválido: deve corresponder ao padrão ${o.pattern}`:`${r[o.format]??i.format} inválido`}case"not_multiple_of":return`Número inválido: deve ser múltiplo de ${i.divisor}`;case"unrecognized_keys":return`Chave${i.keys.length>1?"s":""} desconhecida${i.keys.length>1?"s":""}: ${De(i.keys,", ")}`;case"invalid_key":return`Chave inválida em ${i.origin}`;case"invalid_union":return"Entrada inválida";case"invalid_element":return`Valor inválido em ${i.origin}`;default:return"Campo inválido"}}};function oze(){return{localeError:ize()}}function aB(t,e,n,r){const i=Math.abs(t),o=i%10,s=i%100;return s>=11&&s<=19?r:o===1?e:o>=2&&o<=4?n:r}const sze=()=>{const t={string:{unit:{one:"символ",few:"символа",many:"символов"},verb:"иметь"},file:{unit:{one:"байт",few:"байта",many:"байт"},verb:"иметь"},array:{unit:{one:"элемент",few:"элемента",many:"элементов"},verb:"иметь"},set:{unit:{one:"элемент",few:"элемента",many:"элементов"},verb:"иметь"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"число";case"object":{if(Array.isArray(i))return"массив";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"ввод",email:"email адрес",url:"URL",emoji:"эмодзи",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO дата и время",date:"ISO дата",time:"ISO время",duration:"ISO длительность",ipv4:"IPv4 адрес",ipv6:"IPv6 адрес",cidrv4:"IPv4 диапазон",cidrv6:"IPv6 диапазон",base64:"строка в формате base64",base64url:"строка в формате base64url",json_string:"JSON строка",e164:"номер E.164",jwt:"JWT",template_literal:"ввод"};return i=>{switch(i.code){case"invalid_type":return`Неверный ввод: ожидалось ${i.expected}, получено ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Неверный ввод: ожидалось ${yt(i.values[0])}`:`Неверный вариант: ожидалось одно из ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);if(s){const a=Number(i.maximum),l=aB(a,s.unit.one,s.unit.few,s.unit.many);return`Слишком большое значение: ожидалось, что ${i.origin??"значение"} будет иметь ${o}${i.maximum.toString()} ${l}`}return`Слишком большое значение: ожидалось, что ${i.origin??"значение"} будет ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);if(s){const a=Number(i.minimum),l=aB(a,s.unit.one,s.unit.few,s.unit.many);return`Слишком маленькое значение: ожидалось, что ${i.origin} будет иметь ${o}${i.minimum.toString()} ${l}`}return`Слишком маленькое значение: ожидалось, что ${i.origin} будет ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Неверная строка: должна начинаться с "${o.prefix}"`:o.format==="ends_with"?`Неверная строка: должна заканчиваться на "${o.suffix}"`:o.format==="includes"?`Неверная строка: должна содержать "${o.includes}"`:o.format==="regex"?`Неверная строка: должна соответствовать шаблону ${o.pattern}`:`Неверный ${r[o.format]??i.format}`}case"not_multiple_of":return`Неверное число: должно быть кратным ${i.divisor}`;case"unrecognized_keys":return`Нераспознанн${i.keys.length>1?"ые":"ый"} ключ${i.keys.length>1?"и":""}: ${De(i.keys,", ")}`;case"invalid_key":return`Неверный ключ в ${i.origin}`;case"invalid_union":return"Неверные входные данные";case"invalid_element":return`Неверное значение в ${i.origin}`;default:return"Неверные входные данные"}}};function aze(){return{localeError:sze()}}const lze=()=>{const t={string:{unit:"znakov",verb:"imeti"},file:{unit:"bajtov",verb:"imeti"},array:{unit:"elementov",verb:"imeti"},set:{unit:"elementov",verb:"imeti"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"število";case"object":{if(Array.isArray(i))return"tabela";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"vnos",email:"e-poštni naslov",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO datum in čas",date:"ISO datum",time:"ISO čas",duration:"ISO trajanje",ipv4:"IPv4 naslov",ipv6:"IPv6 naslov",cidrv4:"obseg IPv4",cidrv6:"obseg IPv6",base64:"base64 kodiran niz",base64url:"base64url kodiran niz",json_string:"JSON niz",e164:"E.164 številka",jwt:"JWT",template_literal:"vnos"};return i=>{switch(i.code){case"invalid_type":return`Neveljaven vnos: pričakovano ${i.expected}, prejeto ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Neveljaven vnos: pričakovano ${yt(i.values[0])}`:`Neveljavna možnost: pričakovano eno izmed ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`Preveliko: pričakovano, da bo ${i.origin??"vrednost"} imelo ${o}${i.maximum.toString()} ${s.unit??"elementov"}`:`Preveliko: pričakovano, da bo ${i.origin??"vrednost"} ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`Premajhno: pričakovano, da bo ${i.origin} imelo ${o}${i.minimum.toString()} ${s.unit}`:`Premajhno: pričakovano, da bo ${i.origin} ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Neveljaven niz: mora se začeti z "${o.prefix}"`:o.format==="ends_with"?`Neveljaven niz: mora se končati z "${o.suffix}"`:o.format==="includes"?`Neveljaven niz: mora vsebovati "${o.includes}"`:o.format==="regex"?`Neveljaven niz: mora ustrezati vzorcu ${o.pattern}`:`Neveljaven ${r[o.format]??i.format}`}case"not_multiple_of":return`Neveljavno število: mora biti večkratnik ${i.divisor}`;case"unrecognized_keys":return`Neprepoznan${i.keys.length>1?"i ključi":" ključ"}: ${De(i.keys,", ")}`;case"invalid_key":return`Neveljaven ključ v ${i.origin}`;case"invalid_union":return"Neveljaven vnos";case"invalid_element":return`Neveljavna vrednost v ${i.origin}`;default:return"Neveljaven vnos"}}};function cze(){return{localeError:lze()}}const uze=()=>{const t={string:{unit:"tecken",verb:"att ha"},file:{unit:"bytes",verb:"att ha"},array:{unit:"objekt",verb:"att innehålla"},set:{unit:"objekt",verb:"att innehålla"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"antal";case"object":{if(Array.isArray(i))return"lista";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"reguljärt uttryck",email:"e-postadress",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO-datum och tid",date:"ISO-datum",time:"ISO-tid",duration:"ISO-varaktighet",ipv4:"IPv4-intervall",ipv6:"IPv6-intervall",cidrv4:"IPv4-spektrum",cidrv6:"IPv6-spektrum",base64:"base64-kodad sträng",base64url:"base64url-kodad sträng",json_string:"JSON-sträng",e164:"E.164-nummer",jwt:"JWT",template_literal:"mall-literal"};return i=>{switch(i.code){case"invalid_type":return`Ogiltig inmatning: förväntat ${i.expected}, fick ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Ogiltig inmatning: förväntat ${yt(i.values[0])}`:`Ogiltigt val: förväntade en av ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`För stor(t): förväntade ${i.origin??"värdet"} att ha ${o}${i.maximum.toString()} ${s.unit??"element"}`:`För stor(t): förväntat ${i.origin??"värdet"} att ha ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`För lite(t): förväntade ${i.origin??"värdet"} att ha ${o}${i.minimum.toString()} ${s.unit}`:`För lite(t): förväntade ${i.origin??"värdet"} att ha ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Ogiltig sträng: måste börja med "${o.prefix}"`:o.format==="ends_with"?`Ogiltig sträng: måste sluta med "${o.suffix}"`:o.format==="includes"?`Ogiltig sträng: måste innehålla "${o.includes}"`:o.format==="regex"?`Ogiltig sträng: måste matcha mönstret "${o.pattern}"`:`Ogiltig(t) ${r[o.format]??i.format}`}case"not_multiple_of":return`Ogiltigt tal: måste vara en multipel av ${i.divisor}`;case"unrecognized_keys":return`${i.keys.length>1?"Okända nycklar":"Okänd nyckel"}: ${De(i.keys,", ")}`;case"invalid_key":return`Ogiltig nyckel i ${i.origin??"värdet"}`;case"invalid_union":return"Ogiltig input";case"invalid_element":return`Ogiltigt värde i ${i.origin??"värdet"}`;default:return"Ogiltig input"}}};function dze(){return{localeError:uze()}}const hze=()=>{const t={string:{unit:"எழுத்துக்கள்",verb:"கொண்டிருக்க வேண்டும்"},file:{unit:"பைட்டுகள்",verb:"கொண்டிருக்க வேண்டும்"},array:{unit:"உறுப்புகள்",verb:"கொண்டிருக்க வேண்டும்"},set:{unit:"உறுப்புகள்",verb:"கொண்டிருக்க வேண்டும்"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"எண் அல்லாதது":"எண்";case"object":{if(Array.isArray(i))return"அணி";if(i===null)return"வெறுமை";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"உள்ளீடு",email:"மின்னஞ்சல் முகவரி",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO தேதி நேரம்",date:"ISO தேதி",time:"ISO நேரம்",duration:"ISO கால அளவு",ipv4:"IPv4 முகவரி",ipv6:"IPv6 முகவரி",cidrv4:"IPv4 வரம்பு",cidrv6:"IPv6 வரம்பு",base64:"base64-encoded சரம்",base64url:"base64url-encoded சரம்",json_string:"JSON சரம்",e164:"E.164 எண்",jwt:"JWT",template_literal:"input"};return i=>{switch(i.code){case"invalid_type":return`தவறான உள்ளீடு: எதிர்பார்க்கப்பட்டது ${i.expected}, பெறப்பட்டது ${n(i.input)}`;case"invalid_value":return i.values.length===1?`தவறான உள்ளீடு: எதிர்பார்க்கப்பட்டது ${yt(i.values[0])}`:`தவறான விருப்பம்: எதிர்பார்க்கப்பட்டது ${De(i.values,"|")} இல் ஒன்று`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`மிக பெரியது: எதிர்பார்க்கப்பட்டது ${i.origin??"மதிப்பு"} ${o}${i.maximum.toString()} ${s.unit??"உறுப்புகள்"} ஆக இருக்க வேண்டும்`:`மிக பெரியது: எதிர்பார்க்கப்பட்டது ${i.origin??"மதிப்பு"} ${o}${i.maximum.toString()} ஆக இருக்க வேண்டும்`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`மிகச் சிறியது: எதிர்பார்க்கப்பட்டது ${i.origin} ${o}${i.minimum.toString()} ${s.unit} ஆக இருக்க வேண்டும்`:`மிகச் சிறியது: எதிர்பார்க்கப்பட்டது ${i.origin} ${o}${i.minimum.toString()} ஆக இருக்க வேண்டும்`}case"invalid_format":{const o=i;return o.format==="starts_with"?`தவறான சரம்: "${o.prefix}" இல் தொடங்க வேண்டும்`:o.format==="ends_with"?`தவறான சரம்: "${o.suffix}" இல் முடிவடைய வேண்டும்`:o.format==="includes"?`தவறான சரம்: "${o.includes}" ஐ உள்ளடக்க வேண்டும்`:o.format==="regex"?`தவறான சரம்: ${o.pattern} முறைபாட்டுடன் பொருந்த வேண்டும்`:`தவறான ${r[o.format]??i.format}`}case"not_multiple_of":return`தவறான எண்: ${i.divisor} இன் பலமாக இருக்க வேண்டும்`;case"unrecognized_keys":return`அடையாளம் தெரியாத விசை${i.keys.length>1?"கள்":""}: ${De(i.keys,", ")}`;case"invalid_key":return`${i.origin} இல் தவறான விசை`;case"invalid_union":return"தவறான உள்ளீடு";case"invalid_element":return`${i.origin} இல் தவறான மதிப்பு`;default:return"தவறான உள்ளீடு"}}};function pze(){return{localeError:hze()}}const fze=()=>{const t={string:{unit:"ตัวอักษร",verb:"ควรมี"},file:{unit:"ไบต์",verb:"ควรมี"},array:{unit:"รายการ",verb:"ควรมี"},set:{unit:"รายการ",verb:"ควรมี"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"ไม่ใช่ตัวเลข (NaN)":"ตัวเลข";case"object":{if(Array.isArray(i))return"อาร์เรย์ (Array)";if(i===null)return"ไม่มีค่า (null)";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"ข้อมูลที่ป้อน",email:"ที่อยู่อีเมล",url:"URL",emoji:"อิโมจิ",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"วันที่เวลาแบบ ISO",date:"วันที่แบบ ISO",time:"เวลาแบบ ISO",duration:"ช่วงเวลาแบบ ISO",ipv4:"ที่อยู่ IPv4",ipv6:"ที่อยู่ IPv6",cidrv4:"ช่วง IP แบบ IPv4",cidrv6:"ช่วง IP แบบ IPv6",base64:"ข้อความแบบ Base64",base64url:"ข้อความแบบ Base64 สำหรับ URL",json_string:"ข้อความแบบ JSON",e164:"เบอร์โทรศัพท์ระหว่างประเทศ (E.164)",jwt:"โทเคน JWT",template_literal:"ข้อมูลที่ป้อน"};return i=>{switch(i.code){case"invalid_type":return`ประเภทข้อมูลไม่ถูกต้อง: ควรเป็น ${i.expected} แต่ได้รับ ${n(i.input)}`;case"invalid_value":return i.values.length===1?`ค่าไม่ถูกต้อง: ควรเป็น ${yt(i.values[0])}`:`ตัวเลือกไม่ถูกต้อง: ควรเป็นหนึ่งใน ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"ไม่เกิน":"น้อยกว่า",s=e(i.origin);return s?`เกินกำหนด: ${i.origin??"ค่า"} ควรมี${o} ${i.maximum.toString()} ${s.unit??"รายการ"}`:`เกินกำหนด: ${i.origin??"ค่า"} ควรมี${o} ${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?"อย่างน้อย":"มากกว่า",s=e(i.origin);return s?`น้อยกว่ากำหนด: ${i.origin} ควรมี${o} ${i.minimum.toString()} ${s.unit}`:`น้อยกว่ากำหนด: ${i.origin} ควรมี${o} ${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`รูปแบบไม่ถูกต้อง: ข้อความต้องขึ้นต้นด้วย "${o.prefix}"`:o.format==="ends_with"?`รูปแบบไม่ถูกต้อง: ข้อความต้องลงท้ายด้วย "${o.suffix}"`:o.format==="includes"?`รูปแบบไม่ถูกต้อง: ข้อความต้องมี "${o.includes}" อยู่ในข้อความ`:o.format==="regex"?`รูปแบบไม่ถูกต้อง: ต้องตรงกับรูปแบบที่กำหนด ${o.pattern}`:`รูปแบบไม่ถูกต้อง: ${r[o.format]??i.format}`}case"not_multiple_of":return`ตัวเลขไม่ถูกต้อง: ต้องเป็นจำนวนที่หารด้วย ${i.divisor} ได้ลงตัว`;case"unrecognized_keys":return`พบคีย์ที่ไม่รู้จัก: ${De(i.keys,", ")}`;case"invalid_key":return`คีย์ไม่ถูกต้องใน ${i.origin}`;case"invalid_union":return"ข้อมูลไม่ถูกต้อง: ไม่ตรงกับรูปแบบยูเนียนที่กำหนดไว้";case"invalid_element":return`ข้อมูลไม่ถูกต้องใน ${i.origin}`;default:return"ข้อมูลไม่ถูกต้อง"}}};function gze(){return{localeError:fze()}}const mze=t=>{const e=typeof t;switch(e){case"number":return Number.isNaN(t)?"NaN":"number";case"object":{if(Array.isArray(t))return"array";if(t===null)return"null";if(Object.getPrototypeOf(t)!==Object.prototype&&t.constructor)return t.constructor.name}}return e},yze=()=>{const t={string:{unit:"karakter",verb:"olmalı"},file:{unit:"bayt",verb:"olmalı"},array:{unit:"öğe",verb:"olmalı"},set:{unit:"öğe",verb:"olmalı"}};function e(r){return t[r]??null}const n={regex:"girdi",email:"e-posta adresi",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO tarih ve saat",date:"ISO tarih",time:"ISO saat",duration:"ISO süre",ipv4:"IPv4 adresi",ipv6:"IPv6 adresi",cidrv4:"IPv4 aralığı",cidrv6:"IPv6 aralığı",base64:"base64 ile şifrelenmiş metin",base64url:"base64url ile şifrelenmiş metin",json_string:"JSON dizesi",e164:"E.164 sayısı",jwt:"JWT",template_literal:"Şablon dizesi"};return r=>{switch(r.code){case"invalid_type":return`Geçersiz değer: beklenen ${r.expected}, alınan ${mze(r.input)}`;case"invalid_value":return r.values.length===1?`Geçersiz değer: beklenen ${yt(r.values[0])}`:`Geçersiz seçenek: aşağıdakilerden biri olmalı: ${De(r.values,"|")}`;case"too_big":{const i=r.inclusive?"<=":"<",o=e(r.origin);return o?`Çok büyük: beklenen ${r.origin??"değer"} ${i}${r.maximum.toString()} ${o.unit??"öğe"}`:`Çok büyük: beklenen ${r.origin??"değer"} ${i}${r.maximum.toString()}`}case"too_small":{const i=r.inclusive?">=":">",o=e(r.origin);return o?`Çok küçük: beklenen ${r.origin} ${i}${r.minimum.toString()} ${o.unit}`:`Çok küçük: beklenen ${r.origin} ${i}${r.minimum.toString()}`}case"invalid_format":{const i=r;return i.format==="starts_with"?`Geçersiz metin: "${i.prefix}" ile başlamalı`:i.format==="ends_with"?`Geçersiz metin: "${i.suffix}" ile bitmeli`:i.format==="includes"?`Geçersiz metin: "${i.includes}" içermeli`:i.format==="regex"?`Geçersiz metin: ${i.pattern} desenine uymalı`:`Geçersiz ${n[i.format]??r.format}`}case"not_multiple_of":return`Geçersiz sayı: ${r.divisor} ile tam bölünebilmeli`;case"unrecognized_keys":return`Tanınmayan anahtar${r.keys.length>1?"lar":""}: ${De(r.keys,", ")}`;case"invalid_key":return`${r.origin} içinde geçersiz anahtar`;case"invalid_union":return"Geçersiz değer";case"invalid_element":return`${r.origin} içinde geçersiz değer`;default:return"Geçersiz değer"}}};function vze(){return{localeError:yze()}}const xze=()=>{const t={string:{unit:"символів",verb:"матиме"},file:{unit:"байтів",verb:"матиме"},array:{unit:"елементів",verb:"матиме"},set:{unit:"елементів",verb:"матиме"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"число";case"object":{if(Array.isArray(i))return"масив";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"вхідні дані",email:"адреса електронної пошти",url:"URL",emoji:"емодзі",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"дата та час ISO",date:"дата ISO",time:"час ISO",duration:"тривалість ISO",ipv4:"адреса IPv4",ipv6:"адреса IPv6",cidrv4:"діапазон IPv4",cidrv6:"діапазон IPv6",base64:"рядок у кодуванні base64",base64url:"рядок у кодуванні base64url",json_string:"рядок JSON",e164:"номер E.164",jwt:"JWT",template_literal:"вхідні дані"};return i=>{switch(i.code){case"invalid_type":return`Неправильні вхідні дані: очікується ${i.expected}, отримано ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Неправильні вхідні дані: очікується ${yt(i.values[0])}`:`Неправильна опція: очікується одне з ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`Занадто велике: очікується, що ${i.origin??"значення"} ${s.verb} ${o}${i.maximum.toString()} ${s.unit??"елементів"}`:`Занадто велике: очікується, що ${i.origin??"значення"} буде ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`Занадто мале: очікується, що ${i.origin} ${s.verb} ${o}${i.minimum.toString()} ${s.unit}`:`Занадто мале: очікується, що ${i.origin} буде ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Неправильний рядок: повинен починатися з "${o.prefix}"`:o.format==="ends_with"?`Неправильний рядок: повинен закінчуватися на "${o.suffix}"`:o.format==="includes"?`Неправильний рядок: повинен містити "${o.includes}"`:o.format==="regex"?`Неправильний рядок: повинен відповідати шаблону ${o.pattern}`:`Неправильний ${r[o.format]??i.format}`}case"not_multiple_of":return`Неправильне число: повинно бути кратним ${i.divisor}`;case"unrecognized_keys":return`Нерозпізнаний ключ${i.keys.length>1?"і":""}: ${De(i.keys,", ")}`;case"invalid_key":return`Неправильний ключ у ${i.origin}`;case"invalid_union":return"Неправильні вхідні дані";case"invalid_element":return`Неправильне значення у ${i.origin}`;default:return"Неправильні вхідні дані"}}};function Jee(){return{localeError:xze()}}function Sze(){return Jee()}const bze=()=>{const t={string:{unit:"حروف",verb:"ہونا"},file:{unit:"بائٹس",verb:"ہونا"},array:{unit:"آئٹمز",verb:"ہونا"},set:{unit:"آئٹمز",verb:"ہونا"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"نمبر";case"object":{if(Array.isArray(i))return"آرے";if(i===null)return"نل";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"ان پٹ",email:"ای میل ایڈریس",url:"یو آر ایل",emoji:"ایموجی",uuid:"یو یو آئی ڈی",uuidv4:"یو یو آئی ڈی وی 4",uuidv6:"یو یو آئی ڈی وی 6",nanoid:"نینو آئی ڈی",guid:"جی یو آئی ڈی",cuid:"سی یو آئی ڈی",cuid2:"سی یو آئی ڈی 2",ulid:"یو ایل آئی ڈی",xid:"ایکس آئی ڈی",ksuid:"کے ایس یو آئی ڈی",datetime:"آئی ایس او ڈیٹ ٹائم",date:"آئی ایس او تاریخ",time:"آئی ایس او وقت",duration:"آئی ایس او مدت",ipv4:"آئی پی وی 4 ایڈریس",ipv6:"آئی پی وی 6 ایڈریس",cidrv4:"آئی پی وی 4 رینج",cidrv6:"آئی پی وی 6 رینج",base64:"بیس 64 ان کوڈڈ سٹرنگ",base64url:"بیس 64 یو آر ایل ان کوڈڈ سٹرنگ",json_string:"جے ایس او این سٹرنگ",e164:"ای 164 نمبر",jwt:"جے ڈبلیو ٹی",template_literal:"ان پٹ"};return i=>{switch(i.code){case"invalid_type":return`غلط ان پٹ: ${i.expected} متوقع تھا، ${n(i.input)} موصول ہوا`;case"invalid_value":return i.values.length===1?`غلط ان پٹ: ${yt(i.values[0])} متوقع تھا`:`غلط آپشن: ${De(i.values,"|")} میں سے ایک متوقع تھا`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`بہت بڑا: ${i.origin??"ویلیو"} کے ${o}${i.maximum.toString()} ${s.unit??"عناصر"} ہونے متوقع تھے`:`بہت بڑا: ${i.origin??"ویلیو"} کا ${o}${i.maximum.toString()} ہونا متوقع تھا`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`بہت چھوٹا: ${i.origin} کے ${o}${i.minimum.toString()} ${s.unit} ہونے متوقع تھے`:`بہت چھوٹا: ${i.origin} کا ${o}${i.minimum.toString()} ہونا متوقع تھا`}case"invalid_format":{const o=i;return o.format==="starts_with"?`غلط سٹرنگ: "${o.prefix}" سے شروع ہونا چاہیے`:o.format==="ends_with"?`غلط سٹرنگ: "${o.suffix}" پر ختم ہونا چاہیے`:o.format==="includes"?`غلط سٹرنگ: "${o.includes}" شامل ہونا چاہیے`:o.format==="regex"?`غلط سٹرنگ: پیٹرن ${o.pattern} سے میچ ہونا چاہیے`:`غلط ${r[o.format]??i.format}`}case"not_multiple_of":return`غلط نمبر: ${i.divisor} کا مضاعف ہونا چاہیے`;case"unrecognized_keys":return`غیر تسلیم شدہ کی${i.keys.length>1?"ز":""}: ${De(i.keys,"، ")}`;case"invalid_key":return`${i.origin} میں غلط کی`;case"invalid_union":return"غلط ان پٹ";case"invalid_element":return`${i.origin} میں غلط ویلیو`;default:return"غلط ان پٹ"}}};function wze(){return{localeError:bze()}}const kze=()=>{const t={string:{unit:"ký tự",verb:"có"},file:{unit:"byte",verb:"có"},array:{unit:"phần tử",verb:"có"},set:{unit:"phần tử",verb:"có"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"số";case"object":{if(Array.isArray(i))return"mảng";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"đầu vào",email:"địa chỉ email",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ngày giờ ISO",date:"ngày ISO",time:"giờ ISO",duration:"khoảng thời gian ISO",ipv4:"địa chỉ IPv4",ipv6:"địa chỉ IPv6",cidrv4:"dải IPv4",cidrv6:"dải IPv6",base64:"chuỗi mã hóa base64",base64url:"chuỗi mã hóa base64url",json_string:"chuỗi JSON",e164:"số E.164",jwt:"JWT",template_literal:"đầu vào"};return i=>{switch(i.code){case"invalid_type":return`Đầu vào không hợp lệ: mong đợi ${i.expected}, nhận được ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Đầu vào không hợp lệ: mong đợi ${yt(i.values[0])}`:`Tùy chọn không hợp lệ: mong đợi một trong các giá trị ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`Quá lớn: mong đợi ${i.origin??"giá trị"} ${s.verb} ${o}${i.maximum.toString()} ${s.unit??"phần tử"}`:`Quá lớn: mong đợi ${i.origin??"giá trị"} ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`Quá nhỏ: mong đợi ${i.origin} ${s.verb} ${o}${i.minimum.toString()} ${s.unit}`:`Quá nhỏ: mong đợi ${i.origin} ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Chuỗi không hợp lệ: phải bắt đầu bằng "${o.prefix}"`:o.format==="ends_with"?`Chuỗi không hợp lệ: phải kết thúc bằng "${o.suffix}"`:o.format==="includes"?`Chuỗi không hợp lệ: phải bao gồm "${o.includes}"`:o.format==="regex"?`Chuỗi không hợp lệ: phải khớp với mẫu ${o.pattern}`:`${r[o.format]??i.format} không hợp lệ`}case"not_multiple_of":return`Số không hợp lệ: phải là bội số của ${i.divisor}`;case"unrecognized_keys":return`Khóa không được nhận dạng: ${De(i.keys,", ")}`;case"invalid_key":return`Khóa không hợp lệ trong ${i.origin}`;case"invalid_union":return"Đầu vào không hợp lệ";case"invalid_element":return`Giá trị không hợp lệ trong ${i.origin}`;default:return"Đầu vào không hợp lệ"}}};function Ize(){return{localeError:kze()}}const _ze=()=>{const t={string:{unit:"字符",verb:"包含"},file:{unit:"字节",verb:"包含"},array:{unit:"项",verb:"包含"},set:{unit:"项",verb:"包含"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"非数字(NaN)":"数字";case"object":{if(Array.isArray(i))return"数组";if(i===null)return"空值(null)";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"输入",email:"电子邮件",url:"URL",emoji:"表情符号",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO日期时间",date:"ISO日期",time:"ISO时间",duration:"ISO时长",ipv4:"IPv4地址",ipv6:"IPv6地址",cidrv4:"IPv4网段",cidrv6:"IPv6网段",base64:"base64编码字符串",base64url:"base64url编码字符串",json_string:"JSON字符串",e164:"E.164号码",jwt:"JWT",template_literal:"输入"};return i=>{switch(i.code){case"invalid_type":return`无效输入：期望 ${i.expected}，实际接收 ${n(i.input)}`;case"invalid_value":return i.values.length===1?`无效输入：期望 ${yt(i.values[0])}`:`无效选项：期望以下之一 ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`数值过大：期望 ${i.origin??"值"} ${o}${i.maximum.toString()} ${s.unit??"个元素"}`:`数值过大：期望 ${i.origin??"值"} ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`数值过小：期望 ${i.origin} ${o}${i.minimum.toString()} ${s.unit}`:`数值过小：期望 ${i.origin} ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`无效字符串：必须以 "${o.prefix}" 开头`:o.format==="ends_with"?`无效字符串：必须以 "${o.suffix}" 结尾`:o.format==="includes"?`无效字符串：必须包含 "${o.includes}"`:o.format==="regex"?`无效字符串：必须满足正则表达式 ${o.pattern}`:`无效${r[o.format]??i.format}`}case"not_multiple_of":return`无效数字：必须是 ${i.divisor} 的倍数`;case"unrecognized_keys":return`出现未知的键(key): ${De(i.keys,", ")}`;case"invalid_key":return`${i.origin} 中的键(key)无效`;case"invalid_union":return"无效输入";case"invalid_element":return`${i.origin} 中包含无效值(value)`;default:return"无效输入"}}};function Cze(){return{localeError:_ze()}}const Pze=()=>{const t={string:{unit:"字元",verb:"擁有"},file:{unit:"位元組",verb:"擁有"},array:{unit:"項目",verb:"擁有"},set:{unit:"項目",verb:"擁有"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"number";case"object":{if(Array.isArray(i))return"array";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"輸入",email:"郵件地址",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"ISO 日期時間",date:"ISO 日期",time:"ISO 時間",duration:"ISO 期間",ipv4:"IPv4 位址",ipv6:"IPv6 位址",cidrv4:"IPv4 範圍",cidrv6:"IPv6 範圍",base64:"base64 編碼字串",base64url:"base64url 編碼字串",json_string:"JSON 字串",e164:"E.164 數值",jwt:"JWT",template_literal:"輸入"};return i=>{switch(i.code){case"invalid_type":return`無效的輸入值：預期為 ${i.expected}，但收到 ${n(i.input)}`;case"invalid_value":return i.values.length===1?`無效的輸入值：預期為 ${yt(i.values[0])}`:`無效的選項：預期為以下其中之一 ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`數值過大：預期 ${i.origin??"值"} 應為 ${o}${i.maximum.toString()} ${s.unit??"個元素"}`:`數值過大：預期 ${i.origin??"值"} 應為 ${o}${i.maximum.toString()}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`數值過小：預期 ${i.origin} 應為 ${o}${i.minimum.toString()} ${s.unit}`:`數值過小：預期 ${i.origin} 應為 ${o}${i.minimum.toString()}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`無效的字串：必須以 "${o.prefix}" 開頭`:o.format==="ends_with"?`無效的字串：必須以 "${o.suffix}" 結尾`:o.format==="includes"?`無效的字串：必須包含 "${o.includes}"`:o.format==="regex"?`無效的字串：必須符合格式 ${o.pattern}`:`無效的 ${r[o.format]??i.format}`}case"not_multiple_of":return`無效的數字：必須為 ${i.divisor} 的倍數`;case"unrecognized_keys":return`無法識別的鍵值${i.keys.length>1?"們":""}：${De(i.keys,"、")}`;case"invalid_key":return`${i.origin} 中有無效的鍵值`;case"invalid_union":return"無效的輸入值";case"invalid_element":return`${i.origin} 中有無效的值`;default:return"無效的輸入值"}}};function Tze(){return{localeError:Pze()}}const Eze=()=>{const t={string:{unit:"àmi",verb:"ní"},file:{unit:"bytes",verb:"ní"},array:{unit:"nkan",verb:"ní"},set:{unit:"nkan",verb:"ní"}};function e(i){return t[i]??null}const n=i=>{const o=typeof i;switch(o){case"number":return Number.isNaN(i)?"NaN":"nọ́mbà";case"object":{if(Array.isArray(i))return"akopọ";if(i===null)return"null";if(Object.getPrototypeOf(i)!==Object.prototype&&i.constructor)return i.constructor.name}}return o},r={regex:"ẹ̀rọ ìbáwọlé",email:"àdírẹ́sì ìmẹ́lì",url:"URL",emoji:"emoji",uuid:"UUID",uuidv4:"UUIDv4",uuidv6:"UUIDv6",nanoid:"nanoid",guid:"GUID",cuid:"cuid",cuid2:"cuid2",ulid:"ULID",xid:"XID",ksuid:"KSUID",datetime:"àkókò ISO",date:"ọjọ́ ISO",time:"àkókò ISO",duration:"àkókò tó pé ISO",ipv4:"àdírẹ́sì IPv4",ipv6:"àdírẹ́sì IPv6",cidrv4:"àgbègbè IPv4",cidrv6:"àgbègbè IPv6",base64:"ọ̀rọ̀ tí a kọ́ ní base64",base64url:"ọ̀rọ̀ base64url",json_string:"ọ̀rọ̀ JSON",e164:"nọ́mbà E.164",jwt:"JWT",template_literal:"ẹ̀rọ ìbáwọlé"};return i=>{switch(i.code){case"invalid_type":return`Ìbáwọlé aṣìṣe: a ní láti fi ${i.expected}, àmọ̀ a rí ${n(i.input)}`;case"invalid_value":return i.values.length===1?`Ìbáwọlé aṣìṣe: a ní láti fi ${yt(i.values[0])}`:`Àṣàyàn aṣìṣe: yan ọ̀kan lára ${De(i.values,"|")}`;case"too_big":{const o=i.inclusive?"<=":"<",s=e(i.origin);return s?`Tó pọ̀ jù: a ní láti jẹ́ pé ${i.origin??"iye"} ${s.verb} ${o}${i.maximum} ${s.unit}`:`Tó pọ̀ jù: a ní láti jẹ́ ${o}${i.maximum}`}case"too_small":{const o=i.inclusive?">=":">",s=e(i.origin);return s?`Kéré ju: a ní láti jẹ́ pé ${i.origin} ${s.verb} ${o}${i.minimum} ${s.unit}`:`Kéré ju: a ní láti jẹ́ ${o}${i.minimum}`}case"invalid_format":{const o=i;return o.format==="starts_with"?`Ọ̀rọ̀ aṣìṣe: gbọ́dọ̀ bẹ̀rẹ̀ pẹ̀lú "${o.prefix}"`:o.format==="ends_with"?`Ọ̀rọ̀ aṣìṣe: gbọ́dọ̀ parí pẹ̀lú "${o.suffix}"`:o.format==="includes"?`Ọ̀rọ̀ aṣìṣe: gbọ́dọ̀ ní "${o.includes}"`:o.format==="regex"?`Ọ̀rọ̀ aṣìṣe: gbọ́dọ̀ bá àpẹẹrẹ mu ${o.pattern}`:`Aṣìṣe: ${r[o.format]??i.format}`}case"not_multiple_of":return`Nọ́mbà aṣìṣe: gbọ́dọ̀ jẹ́ èyà pípín ti ${i.divisor}`;case"unrecognized_keys":return`Bọtìnì àìmọ̀: ${De(i.keys,", ")}`;case"invalid_key":return`Bọtìnì aṣìṣe nínú ${i.origin}`;case"invalid_union":return"Ìbáwọlé aṣìṣe";case"invalid_element":return`Iye aṣìṣe nínú ${i.origin}`;default:return"Ìbáwọlé aṣìṣe"}}};function Aze(){return{localeError:Eze()}}const Qee=Object.freeze(Object.defineProperty({__proto__:null,ar:WNe,az:KNe,be:GNe,bg:ZNe,ca:QNe,cs:tLe,da:rLe,de:oLe,en:Xee,eo:uLe,es:hLe,fa:fLe,fi:mLe,fr:vLe,frCA:SLe,he:wLe,hu:ILe,id:CLe,is:ELe,it:MLe,ja:DLe,ka:$Le,kh:LLe,km:Zee,ko:FLe,lt:HLe,mk:VLe,ms:qLe,nl:YLe,no:ZLe,ota:QLe,pl:rze,ps:tze,pt:oze,ru:aze,sl:cze,sv:dze,ta:pze,th:gze,tr:vze,ua:Sze,uk:Jee,ur:wze,vi:Ize,yo:Aze,zhCN:Cze,zhTW:Tze},Symbol.toStringTag,{value:"Module"})),ete=Symbol("ZodOutput"),tte=Symbol("ZodInput");class VO{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...n){const r=n[0];if(this._map.set(e,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,e)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){const n=this._map.get(e);return n&&typeof n=="object"&&"id"in n&&this._idmap.delete(n.id),this._map.delete(e),this}get(e){const n=e._zod.parent;if(n){const r={...this.get(n)??{}};delete r.id;const i={...r,...this._map.get(e)};return Object.keys(i).length?i:void 0}return this._map.get(e)}has(e){return this._map.has(e)}}function KO(){return new VO}const zd=KO();function nte(t,e){return new t({type:"string",...be(e)})}function rte(t,e){return new t({type:"string",coerce:!0,...be(e)})}function qO(t,e){return new t({type:"string",format:"email",check:"string_format",abort:!1,...be(e)})}function Aw(t,e){return new t({type:"string",format:"guid",check:"string_format",abort:!1,...be(e)})}function GO(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,...be(e)})}function YO(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...be(e)})}function XO(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...be(e)})}function ZO(t,e){return new t({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...be(e)})}function O1(t,e){return new t({type:"string",format:"url",check:"string_format",abort:!1,...be(e)})}function JO(t,e){return new t({type:"string",format:"emoji",check:"string_format",abort:!1,...be(e)})}function QO(t,e){return new t({type:"string",format:"nanoid",check:"string_format",abort:!1,...be(e)})}function eD(t,e){return new t({type:"string",format:"cuid",check:"string_format",abort:!1,...be(e)})}function tD(t,e){return new t({type:"string",format:"cuid2",check:"string_format",abort:!1,...be(e)})}function nD(t,e){return new t({type:"string",format:"ulid",check:"string_format",abort:!1,...be(e)})}function rD(t,e){return new t({type:"string",format:"xid",check:"string_format",abort:!1,...be(e)})}function iD(t,e){return new t({type:"string",format:"ksuid",check:"string_format",abort:!1,...be(e)})}function oD(t,e){return new t({type:"string",format:"ipv4",check:"string_format",abort:!1,...be(e)})}function sD(t,e){return new t({type:"string",format:"ipv6",check:"string_format",abort:!1,...be(e)})}function aD(t,e){return new t({type:"string",format:"cidrv4",check:"string_format",abort:!1,...be(e)})}function lD(t,e){return new t({type:"string",format:"cidrv6",check:"string_format",abort:!1,...be(e)})}function cD(t,e){return new t({type:"string",format:"base64",check:"string_format",abort:!1,...be(e)})}function uD(t,e){return new t({type:"string",format:"base64url",check:"string_format",abort:!1,...be(e)})}function dD(t,e){return new t({type:"string",format:"e164",check:"string_format",abort:!1,...be(e)})}function hD(t,e){return new t({type:"string",format:"jwt",check:"string_format",abort:!1,...be(e)})}const ite={Any:null,Minute:-1,Second:0,Millisecond:3,Microsecond:6};function ote(t,e){return new t({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...be(e)})}function ste(t,e){return new t({type:"string",format:"date",check:"string_format",...be(e)})}function ate(t,e){return new t({type:"string",format:"time",check:"string_format",precision:null,...be(e)})}function lte(t,e){return new t({type:"string",format:"duration",check:"string_format",...be(e)})}function cte(t,e){return new t({type:"number",checks:[],...be(e)})}function ute(t,e){return new t({type:"number",coerce:!0,checks:[],...be(e)})}function dte(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"safeint",...be(e)})}function hte(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"float32",...be(e)})}function pte(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"float64",...be(e)})}function fte(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"int32",...be(e)})}function gte(t,e){return new t({type:"number",check:"number_format",abort:!1,format:"uint32",...be(e)})}function mte(t,e){return new t({type:"boolean",...be(e)})}function yte(t,e){return new t({type:"boolean",coerce:!0,...be(e)})}function vte(t,e){return new t({type:"bigint",...be(e)})}function xte(t,e){return new t({type:"bigint",coerce:!0,...be(e)})}function Ste(t,e){return new t({type:"bigint",check:"bigint_format",abort:!1,format:"int64",...be(e)})}function bte(t,e){return new t({type:"bigint",check:"bigint_format",abort:!1,format:"uint64",...be(e)})}function wte(t,e){return new t({type:"symbol",...be(e)})}function kte(t,e){return new t({type:"undefined",...be(e)})}function Ite(t,e){return new t({type:"null",...be(e)})}function _te(t){return new t({type:"any"})}function Cte(t){return new t({type:"unknown"})}function Pte(t,e){return new t({type:"never",...be(e)})}function Tte(t,e){return new t({type:"void",...be(e)})}function Ete(t,e){return new t({type:"date",...be(e)})}function Ate(t,e){return new t({type:"date",coerce:!0,...be(e)})}function Mte(t,e){return new t({type:"nan",...be(e)})}function gh(t,e){return new $O({check:"less_than",...be(e),value:t,inclusive:!1})}function Ua(t,e){return new $O({check:"less_than",...be(e),value:t,inclusive:!0})}function mh(t,e){return new NO({check:"greater_than",...be(e),value:t,inclusive:!1})}function ys(t,e){return new NO({check:"greater_than",...be(e),value:t,inclusive:!0})}function Ote(t){return mh(0,t)}function Dte(t){return gh(0,t)}function jte(t){return Ua(0,t)}function Rte(t){return ys(0,t)}function Oy(t,e){return new xQ({check:"multiple_of",...be(e),value:t})}function D1(t,e){return new wQ({check:"max_size",...be(e),maximum:t})}function Dy(t,e){return new kQ({check:"min_size",...be(e),minimum:t})}function pD(t,e){return new IQ({check:"size_equals",...be(e),size:t})}function j1(t,e){return new _Q({check:"max_length",...be(e),maximum:t})}function _f(t,e){return new CQ({check:"min_length",...be(e),minimum:t})}function R1(t,e){return new PQ({check:"length_equals",...be(e),length:t})}function fD(t,e){return new TQ({check:"string_format",format:"regex",...be(e),pattern:t})}function gD(t){return new EQ({check:"string_format",format:"lowercase",...be(t)})}function mD(t){return new AQ({check:"string_format",format:"uppercase",...be(t)})}function yD(t,e){return new MQ({check:"string_format",format:"includes",...be(e),includes:t})}function vD(t,e){return new OQ({check:"string_format",format:"starts_with",...be(e),prefix:t})}function xD(t,e){return new DQ({check:"string_format",format:"ends_with",...be(e),suffix:t})}function $te(t,e,n){return new jQ({check:"property",property:t,schema:e,...be(n)})}function SD(t,e){return new RQ({check:"mime_type",mime:t,...be(e)})}function Mh(t){return new $Q({check:"overwrite",tx:t})}function bD(t){return Mh(e=>e.normalize(t))}function wD(){return Mh(t=>t.trim())}function kD(){return Mh(t=>t.toLowerCase())}function ID(){return Mh(t=>t.toUpperCase())}function Nte(t,e,n){return new t({type:"array",element:e,...be(n)})}function Mze(t,e,n){return new t({type:"union",options:e,...be(n)})}function Oze(t,e,n,r){return new t({type:"union",options:n,discriminator:e,...be(r)})}function Dze(t,e,n){return new t({type:"intersection",left:e,right:n})}function jze(t,e,n,r){const i=n instanceof kt,o=i?r:n,s=i?n:null;return new t({type:"tuple",items:e,rest:s,...be(o)})}function Rze(t,e,n,r){return new t({type:"record",keyType:e,valueType:n,...be(r)})}function $ze(t,e,n,r){return new t({type:"map",keyType:e,valueType:n,...be(r)})}function Nze(t,e,n){return new t({type:"set",valueType:e,...be(n)})}function Lze(t,e,n){const r=Array.isArray(e)?Object.fromEntries(e.map(i=>[i,i])):e;return new t({type:"enum",entries:r,...be(n)})}function zze(t,e,n){return new t({type:"enum",entries:e,...be(n)})}function Fze(t,e,n){return new t({type:"literal",values:Array.isArray(e)?e:[e],...be(n)})}function Lte(t,e){return new t({type:"file",...be(e)})}function Bze(t,e){return new t({type:"transform",transform:e})}function Uze(t,e){return new t({type:"optional",innerType:e})}function Hze(t,e){return new t({type:"nullable",innerType:e})}function Wze(t,e,n){return new t({type:"default",innerType:e,get defaultValue(){return typeof n=="function"?n():E1(n)}})}function Vze(t,e,n){return new t({type:"nonoptional",innerType:e,...be(n)})}function Kze(t,e){return new t({type:"success",innerType:e})}function qze(t,e,n){return new t({type:"catch",innerType:e,catchValue:typeof n=="function"?n:()=>n})}function Gze(t,e,n){return new t({type:"pipe",in:e,out:n})}function Yze(t,e){return new t({type:"readonly",innerType:e})}function Xze(t,e,n){return new t({type:"template_literal",parts:e,...be(n)})}function Zze(t,e){return new t({type:"lazy",getter:e})}function Jze(t,e){return new t({type:"promise",innerType:e})}function zte(t,e,n){const r=be(n);return r.abort??(r.abort=!0),new t({type:"custom",check:"custom",fn:e,...r})}function Fte(t,e,n){return new t({type:"custom",check:"custom",fn:e,...be(n)})}function Bte(t){const e=Ute(n=>(n.addIssue=r=>{if(typeof r=="string")n.issues.push(kf(r,n.value,e._zod.def));else{const i=r;i.fatal&&(i.continue=!1),i.code??(i.code="custom"),i.input??(i.input=n.value),i.inst??(i.inst=e),i.continue??(i.continue=!e._zod.def.abort),n.issues.push(kf(i))}},t(n.value,n)));return e}function Ute(t,e){const n=new pr({check:"custom",...be(e)});return n._zod.check=t,n}function Hte(t,e){const n=be(e);let r=n.truthy??["true","1","yes","on","y","enabled"],i=n.falsy??["false","0","no","off","n","disabled"];n.case!=="sensitive"&&(r=r.map(f=>typeof f=="string"?f.toLowerCase():f),i=i.map(f=>typeof f=="string"?f.toLowerCase():f));const o=new Set(r),s=new Set(i),a=t.Codec??WO,l=t.Boolean??FO,c=t.String??Ev,d=new c({type:"string",error:n.error}),u=new l({type:"boolean",error:n.error}),p=new a({type:"pipe",in:d,out:u,transform:((f,y)=>{let v=f;return n.case!=="sensitive"&&(v=v.toLowerCase()),o.has(v)?!0:s.has(v)?!1:(y.issues.push({code:"invalid_value",expected:"stringbool",values:[...o,...s],input:y.value,inst:p,continue:!1}),{})}),reverseTransform:((f,y)=>f===!0?r[0]||"true":i[0]||"false"),error:n.error});return p}function Av(t,e,n,r={}){const i=be(r),o={...be(r),check:"string_format",type:"string",format:e,fn:typeof n=="function"?n:a=>n.test(a),...i};return n instanceof RegExp&&(o.pattern=n),new t(o)}class qE{constructor(e){this.counter=0,this.metadataRegistry=e?.metadata??zd,this.target=e?.target??"draft-2020-12",this.unrepresentable=e?.unrepresentable??"throw",this.override=e?.override??(()=>{}),this.io=e?.io??"output",this.seen=new Map}process(e,n={path:[],schemaPath:[]}){var r;const i=e._zod.def,o={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},s=this.seen.get(e);if(s)return s.count++,n.schemaPath.includes(e)&&(s.cycle=n.path),s.schema;const a={schema:{},count:1,cycle:void 0,path:n.path};this.seen.set(e,a);const l=e._zod.toJSONSchema?.();if(l)a.schema=l;else{const u={...n,schemaPath:[...n.schemaPath,e],path:n.path},p=e._zod.parent;if(p)a.ref=p,this.process(p,u),this.seen.get(p).isParent=!0;else{const f=a.schema;switch(i.type){case"string":{const y=f;y.type="string";const{minimum:v,maximum:x,format:b,patterns:w,contentEncoding:_}=e._zod.bag;if(typeof v=="number"&&(y.minLength=v),typeof x=="number"&&(y.maxLength=x),b&&(y.format=o[b]??b,y.format===""&&delete y.format),_&&(y.contentEncoding=_),w&&w.size>0){const C=[...w];C.length===1?y.pattern=C[0].source:C.length>1&&(a.schema.allOf=[...C.map(A=>({...this.target==="draft-7"||this.target==="draft-4"||this.target==="openapi-3.0"?{type:"string"}:{},pattern:A.source}))])}break}case"number":{const y=f,{minimum:v,maximum:x,format:b,multipleOf:w,exclusiveMaximum:_,exclusiveMinimum:C}=e._zod.bag;typeof b=="string"&&b.includes("int")?y.type="integer":y.type="number",typeof C=="number"&&(this.target==="draft-4"||this.target==="openapi-3.0"?(y.minimum=C,y.exclusiveMinimum=!0):y.exclusiveMinimum=C),typeof v=="number"&&(y.minimum=v,typeof C=="number"&&this.target!=="draft-4"&&(C>=v?delete y.minimum:delete y.exclusiveMinimum)),typeof _=="number"&&(this.target==="draft-4"||this.target==="openapi-3.0"?(y.maximum=_,y.exclusiveMaximum=!0):y.exclusiveMaximum=_),typeof x=="number"&&(y.maximum=x,typeof _=="number"&&this.target!=="draft-4"&&(_<=x?delete y.maximum:delete y.exclusiveMaximum)),typeof w=="number"&&(y.multipleOf=w);break}case"boolean":{const y=f;y.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{this.target==="openapi-3.0"?(f.type="string",f.nullable=!0,f.enum=[null]):f.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{f.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const y=f,{minimum:v,maximum:x}=e._zod.bag;typeof v=="number"&&(y.minItems=v),typeof x=="number"&&(y.maxItems=x),y.type="array",y.items=this.process(i.element,{...u,path:[...u.path,"items"]});break}case"object":{const y=f;y.type="object",y.properties={};const v=i.shape;for(const w in v)y.properties[w]=this.process(v[w],{...u,path:[...u.path,"properties",w]});const x=new Set(Object.keys(v)),b=new Set([...x].filter(w=>{const _=i.shape[w]._zod;return this.io==="input"?_.optin===void 0:_.optout===void 0}));b.size>0&&(y.required=Array.from(b)),i.catchall?._zod.def.type==="never"?y.additionalProperties=!1:i.catchall?i.catchall&&(y.additionalProperties=this.process(i.catchall,{...u,path:[...u.path,"additionalProperties"]})):this.io==="output"&&(y.additionalProperties=!1);break}case"union":{const y=f,v=i.options.map((x,b)=>this.process(x,{...u,path:[...u.path,"anyOf",b]}));y.anyOf=v;break}case"intersection":{const y=f,v=this.process(i.left,{...u,path:[...u.path,"allOf",0]}),x=this.process(i.right,{...u,path:[...u.path,"allOf",1]}),b=_=>"allOf"in _&&Object.keys(_).length===1,w=[...b(v)?v.allOf:[v],...b(x)?x.allOf:[x]];y.allOf=w;break}case"tuple":{const y=f;y.type="array";const v=this.target==="draft-2020-12"?"prefixItems":"items",x=this.target==="draft-2020-12"||this.target==="openapi-3.0"?"items":"additionalItems",b=i.items.map((A,E)=>this.process(A,{...u,path:[...u.path,v,E]})),w=i.rest?this.process(i.rest,{...u,path:[...u.path,x,...this.target==="openapi-3.0"?[i.items.length]:[]]}):null;this.target==="draft-2020-12"?(y.prefixItems=b,w&&(y.items=w)):this.target==="openapi-3.0"?(y.items={anyOf:b},w&&y.items.anyOf.push(w),y.minItems=b.length,w||(y.maxItems=b.length)):(y.items=b,w&&(y.additionalItems=w));const{minimum:_,maximum:C}=e._zod.bag;typeof _=="number"&&(y.minItems=_),typeof C=="number"&&(y.maxItems=C);break}case"record":{const y=f;y.type="object",(this.target==="draft-7"||this.target==="draft-2020-12")&&(y.propertyNames=this.process(i.keyType,{...u,path:[...u.path,"propertyNames"]})),y.additionalProperties=this.process(i.valueType,{...u,path:[...u.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const y=f,v=SO(i.entries);v.every(x=>typeof x=="number")&&(y.type="number"),v.every(x=>typeof x=="string")&&(y.type="string"),y.enum=v;break}case"literal":{const y=f,v=[];for(const x of i.values)if(x===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof x=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");v.push(Number(x))}else v.push(x);if(v.length!==0)if(v.length===1){const x=v[0];y.type=x===null?"null":typeof x,this.target==="draft-4"||this.target==="openapi-3.0"?y.enum=[x]:y.const=x}else v.every(x=>typeof x=="number")&&(y.type="number"),v.every(x=>typeof x=="string")&&(y.type="string"),v.every(x=>typeof x=="boolean")&&(y.type="string"),v.every(x=>x===null)&&(y.type="null"),y.enum=v;break}case"file":{const y=f,v={type:"string",format:"binary",contentEncoding:"binary"},{minimum:x,maximum:b,mime:w}=e._zod.bag;x!==void 0&&(v.minLength=x),b!==void 0&&(v.maxLength=b),w?w.length===1?(v.contentMediaType=w[0],Object.assign(y,v)):y.anyOf=w.map(_=>({...v,contentMediaType:_})):Object.assign(y,v);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const y=this.process(i.innerType,u);this.target==="openapi-3.0"?(a.ref=i.innerType,f.nullable=!0):f.anyOf=[y,{type:"null"}];break}case"nonoptional":{this.process(i.innerType,u),a.ref=i.innerType;break}case"success":{const y=f;y.type="boolean";break}case"default":{this.process(i.innerType,u),a.ref=i.innerType,f.default=JSON.parse(JSON.stringify(i.defaultValue));break}case"prefault":{this.process(i.innerType,u),a.ref=i.innerType,this.io==="input"&&(f._prefault=JSON.parse(JSON.stringify(i.defaultValue)));break}case"catch":{this.process(i.innerType,u),a.ref=i.innerType;let y;try{y=i.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}f.default=y;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const y=f,v=e._zod.pattern;if(!v)throw new Error("Pattern not found in template literal");y.type="string",y.pattern=v.source;break}case"pipe":{const y=this.io==="input"?i.in._zod.def.type==="transform"?i.out:i.in:i.out;this.process(y,u),a.ref=y;break}case"readonly":{this.process(i.innerType,u),a.ref=i.innerType,f.readOnly=!0;break}case"promise":{this.process(i.innerType,u),a.ref=i.innerType;break}case"optional":{this.process(i.innerType,u),a.ref=i.innerType;break}case"lazy":{const y=e._zod.innerType;this.process(y,u),a.ref=y;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}case"function":{if(this.unrepresentable==="throw")throw new Error("Function types cannot be represented in JSON Schema");break}}}}const c=this.metadataRegistry.get(e);return c&&Object.assign(a.schema,c),this.io==="input"&&zr(e)&&(delete a.schema.examples,delete a.schema.default),this.io==="input"&&a.schema._prefault&&((r=a.schema).default??(r.default=a.schema._prefault)),delete a.schema._prefault,this.seen.get(e).schema}emit(e,n){const r={cycles:n?.cycles??"ref",reused:n?.reused??"inline",external:n?.external??void 0},i=this.seen.get(e);if(!i)throw new Error("Unprocessed schema. This is a bug in Zod.");const o=d=>{const u=this.target==="draft-2020-12"?"$defs":"definitions";if(r.external){const v=r.external.registry.get(d[0])?.id,x=r.external.uri??(w=>w);if(v)return{ref:x(v)};const b=d[1].defId??d[1].schema.id??`schema${this.counter++}`;return d[1].defId=b,{defId:b,ref:`${x("__shared")}#/${u}/${b}`}}if(d[1]===i)return{ref:"#"};const f=`#/${u}/`,y=d[1].schema.id??`__schema${this.counter++}`;return{defId:y,ref:f+y}},s=d=>{if(d[1].schema.$ref)return;const u=d[1],{ref:p,defId:f}=o(d);u.def={...u.schema},f&&(u.defId=f);const y=u.schema;for(const v in y)delete y[v];y.$ref=p};if(r.cycles==="throw")for(const d of this.seen.entries()){const u=d[1];if(u.cycle)throw new Error(`Cycle detected: #/${u.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const d of this.seen.entries()){const u=d[1];if(e===d[0]){s(d);continue}if(r.external){const f=r.external.registry.get(d[0])?.id;if(e!==d[0]&&f){s(d);continue}}if(this.metadataRegistry.get(d[0])?.id){s(d);continue}if(u.cycle){s(d);continue}if(u.count>1&&r.reused==="ref"){s(d);continue}}const a=(d,u)=>{const p=this.seen.get(d),f=p.def??p.schema,y={...f};if(p.ref===null)return;const v=p.ref;if(p.ref=null,v){a(v,u);const x=this.seen.get(v).schema;x.$ref&&(u.target==="draft-7"||u.target==="draft-4"||u.target==="openapi-3.0")?(f.allOf=f.allOf??[],f.allOf.push(x)):(Object.assign(f,x),Object.assign(f,y))}p.isParent||this.override({zodSchema:d,jsonSchema:f,path:p.path??[]})};for(const d of[...this.seen.entries()].reverse())a(d[0],{target:this.target});const l={};if(this.target==="draft-2020-12"?l.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?l.$schema="http://json-schema.org/draft-07/schema#":this.target==="draft-4"?l.$schema="http://json-schema.org/draft-04/schema#":this.target==="openapi-3.0"||console.warn(`Invalid target: ${this.target}`),r.external?.uri){const d=r.external.registry.get(e)?.id;if(!d)throw new Error("Schema is missing an `id` property");l.$id=r.external.uri(d)}Object.assign(l,i.def);const c=r.external?.defs??{};for(const d of this.seen.entries()){const u=d[1];u.def&&u.defId&&(c[u.defId]=u.def)}r.external||Object.keys(c).length>0&&(this.target==="draft-2020-12"?l.$defs=c:l.definitions=c);try{return JSON.parse(JSON.stringify(l))}catch{throw new Error("Error converting schema to JSON.")}}}function Wte(t,e){if(t instanceof VO){const r=new qE(e),i={};for(const a of t._idmap.entries()){const[l,c]=a;r.process(c)}const o={},s={registry:t,uri:e?.uri,defs:i};for(const a of t._idmap.entries()){const[l,c]=a;o[l]=r.emit(c,{...e,external:s})}if(Object.keys(i).length>0){const a=r.target==="draft-2020-12"?"$defs":"definitions";o.__shared={[a]:i}}return{schemas:o}}const n=new qE(e);return n.process(t),n.emit(t,e)}function zr(t,e){const n=e??{seen:new Set};if(n.seen.has(t))return!1;n.seen.add(t);const i=t._zod.def;switch(i.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return zr(i.element,n);case"object":{for(const o in i.shape)if(zr(i.shape[o],n))return!0;return!1}case"union":{for(const o of i.options)if(zr(o,n))return!0;return!1}case"intersection":return zr(i.left,n)||zr(i.right,n);case"tuple":{for(const o of i.items)if(zr(o,n))return!0;return!!(i.rest&&zr(i.rest,n))}case"record":return zr(i.keyType,n)||zr(i.valueType,n);case"map":return zr(i.keyType,n)||zr(i.valueType,n);case"set":return zr(i.valueType,n);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return zr(i.innerType,n);case"lazy":return zr(i.getter(),n);case"default":return zr(i.innerType,n);case"prefault":return zr(i.innerType,n);case"custom":return!1;case"transform":return!0;case"pipe":return zr(i.in,n)||zr(i.out,n);case"success":return!1;case"catch":return!1;case"function":return!1}throw new Error(`Unknown schema type: ${i.type}`)}const Qze=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),e4e=Object.freeze(Object.defineProperty({__proto__:null,$ZodAny:mee,$ZodArray:bee,$ZodAsyncError:qd,$ZodBase64:iee,$ZodBase64URL:see,$ZodBigInt:BO,$ZodBigIntFormat:hee,$ZodBoolean:FO,$ZodCIDRv4:nee,$ZodCIDRv6:ree,$ZodCUID:VQ,$ZodCUID2:KQ,$ZodCatch:Bee,$ZodCheck:pr,$ZodCheckBigIntFormat:bQ,$ZodCheckEndsWith:DQ,$ZodCheckGreaterThan:NO,$ZodCheckIncludes:MQ,$ZodCheckLengthEquals:PQ,$ZodCheckLessThan:$O,$ZodCheckLowerCase:EQ,$ZodCheckMaxLength:_Q,$ZodCheckMaxSize:wQ,$ZodCheckMimeType:RQ,$ZodCheckMinLength:CQ,$ZodCheckMinSize:kQ,$ZodCheckMultipleOf:xQ,$ZodCheckNumberFormat:SQ,$ZodCheckOverwrite:$Q,$ZodCheckProperty:jQ,$ZodCheckRegex:TQ,$ZodCheckSizeEquals:IQ,$ZodCheckStartsWith:OQ,$ZodCheckStringFormat:Tv,$ZodCheckUpperCase:AQ,$ZodCodec:WO,$ZodCustom:Yee,$ZodCustomStringFormat:uee,$ZodDate:See,$ZodDefault:Nee,$ZodDiscriminatedUnion:Cee,$ZodE164:aee,$ZodEmail:BQ,$ZodEmoji:HQ,$ZodEncodeError:P1,$ZodEnum:Mee,$ZodError:wO,$ZodFile:Dee,$ZodFunction:Kee,$ZodGUID:zQ,$ZodIPv4:eee,$ZodIPv6:tee,$ZodISODate:ZQ,$ZodISODateTime:XQ,$ZodISODuration:QQ,$ZodISOTime:JQ,$ZodIntersection:Pee,$ZodJWT:cee,$ZodKSUID:YQ,$ZodLazy:Gee,$ZodLiteral:Oee,$ZodMap:Eee,$ZodNaN:Uee,$ZodNanoID:WQ,$ZodNever:vee,$ZodNonOptional:zee,$ZodNull:gee,$ZodNullable:$ee,$ZodNumber:zO,$ZodNumberFormat:dee,$ZodObject:Iee,$ZodObjectJIT:_ee,$ZodOptional:Ree,$ZodPipe:Hee,$ZodPrefault:Lee,$ZodPromise:qee,$ZodReadonly:Wee,$ZodRealError:Rs,$ZodRecord:Tee,$ZodRegistry:VO,$ZodSet:Aee,$ZodString:Ev,$ZodStringFormat:Tn,$ZodSuccess:Fee,$ZodSymbol:pee,$ZodTemplateLiteral:Vee,$ZodTransform:jee,$ZodTuple:HO,$ZodType:kt,$ZodULID:qQ,$ZodURL:UQ,$ZodUUID:FQ,$ZodUndefined:fee,$ZodUnion:UO,$ZodUnknown:yee,$ZodVoid:xee,$ZodXID:GQ,$brand:mJ,$constructor:se,$input:tte,$output:ete,Doc:NQ,JSONSchema:Qze,JSONSchemaGenerator:qE,NEVER:gJ,TimePrecision:ite,_any:_te,_array:Nte,_base64:cD,_base64url:uD,_bigint:vte,_boolean:mte,_catch:qze,_check:Ute,_cidrv4:aD,_cidrv6:lD,_coercedBigint:xte,_coercedBoolean:yte,_coercedDate:Ate,_coercedNumber:ute,_coercedString:rte,_cuid:eD,_cuid2:tD,_custom:zte,_date:Ete,_decode:CO,_decodeAsync:TO,_default:Wze,_discriminatedUnion:Oze,_e164:dD,_email:qO,_emoji:JO,_encode:_O,_encodeAsync:PO,_endsWith:xD,_enum:Lze,_file:Lte,_float32:hte,_float64:pte,_gt:mh,_gte:ys,_guid:Aw,_includes:yD,_int:dte,_int32:fte,_int64:Ste,_intersection:Dze,_ipv4:oD,_ipv6:sD,_isoDate:ste,_isoDateTime:ote,_isoDuration:lte,_isoTime:ate,_jwt:hD,_ksuid:iD,_lazy:Zze,_length:R1,_literal:Fze,_lowercase:gD,_lt:gh,_lte:Ua,_map:$ze,_max:Ua,_maxLength:j1,_maxSize:D1,_mime:SD,_min:ys,_minLength:_f,_minSize:Dy,_multipleOf:Oy,_nan:Mte,_nanoid:QO,_nativeEnum:zze,_negative:Dte,_never:Pte,_nonnegative:Rte,_nonoptional:Vze,_nonpositive:jte,_normalize:bD,_null:Ite,_nullable:Hze,_number:cte,_optional:Uze,_overwrite:Mh,_parse:wv,_parseAsync:kv,_pipe:Gze,_positive:Ote,_promise:Jze,_property:$te,_readonly:Yze,_record:Rze,_refine:Fte,_regex:fD,_safeDecode:AO,_safeDecodeAsync:OO,_safeEncode:EO,_safeEncodeAsync:MO,_safeParse:Iv,_safeParseAsync:_v,_set:Nze,_size:pD,_startsWith:vD,_string:nte,_stringFormat:Av,_stringbool:Hte,_success:Kze,_superRefine:Bte,_symbol:wte,_templateLiteral:Xze,_toLowerCase:kD,_toUpperCase:ID,_transform:Bze,_trim:wD,_tuple:jze,_uint32:gte,_uint64:bte,_ulid:nD,_undefined:kte,_union:Mze,_unknown:Cte,_uppercase:mD,_url:O1,_uuid:GO,_uuidv4:YO,_uuidv6:XO,_uuidv7:ZO,_void:Tte,_xid:rD,clone:ma,config:Io,decode:hNe,decodeAsync:fNe,encode:dNe,encodeAsync:pNe,flattenError:kO,formatError:IO,globalConfig:Cw,globalRegistry:zd,isValidBase64:LO,isValidBase64URL:oee,isValidJWT:lee,locales:Qee,parse:WE,parseAsync:VE,prettifyError:$J,regexes:RO,registry:KO,safeDecode:mNe,safeDecodeAsync:vNe,safeEncode:gNe,safeEncodeAsync:yNe,safeParse:NJ,safeParseAsync:LJ,toDotPath:RJ,toJSONSchema:Wte,treeifyError:jJ,util:OJ,version:LQ},Symbol.toStringTag,{value:"Module"})),_D=se("ZodISODateTime",(t,e)=>{XQ.init(t,e),$n.init(t,e)});function Vte(t){return ote(_D,t)}const CD=se("ZodISODate",(t,e)=>{ZQ.init(t,e),$n.init(t,e)});function Kte(t){return ste(CD,t)}const PD=se("ZodISOTime",(t,e)=>{JQ.init(t,e),$n.init(t,e)});function qte(t){return ate(PD,t)}const TD=se("ZodISODuration",(t,e)=>{QQ.init(t,e),$n.init(t,e)});function Gte(t){return lte(TD,t)}const t4e=Object.freeze(Object.defineProperty({__proto__:null,ZodISODate:CD,ZodISODateTime:_D,ZodISODuration:TD,ZodISOTime:PD,date:Kte,datetime:Vte,duration:Gte,time:qte},Symbol.toStringTag,{value:"Module"})),Yte=(t,e)=>{wO.init(t,e),t.name="ZodError",Object.defineProperties(t,{format:{value:n=>IO(t,n)},flatten:{value:n=>kO(t,n)},addIssue:{value:n=>{t.issues.push(n),t.message=JSON.stringify(t.issues,Pw,2)}},addIssues:{value:n=>{t.issues.push(...n),t.message=JSON.stringify(t.issues,Pw,2)}},isEmpty:{get(){return t.issues.length===0}}})},n4e=se("ZodError",Yte),$s=se("ZodError",Yte,{Parent:Error}),Xte=wv($s),Zte=kv($s),Jte=Iv($s),Qte=_v($s),ene=_O($s),tne=CO($s),nne=PO($s),rne=TO($s),ine=EO($s),one=AO($s),sne=MO($s),ane=OO($s),Ot=se("ZodType",(t,e)=>(kt.init(t,e),t.def=e,t.type=e.type,Object.defineProperty(t,"_def",{value:e}),t.check=(...n)=>t.clone(Pc(e,{checks:[...e.checks??[],...n.map(r=>typeof r=="function"?{_zod:{check:r,def:{check:"custom"},onattach:[]}}:r)]})),t.clone=(n,r)=>ma(t,n,r),t.brand=()=>t,t.register=((n,r)=>(n.add(t,r),t)),t.parse=(n,r)=>Xte(t,n,r,{callee:t.parse}),t.safeParse=(n,r)=>Jte(t,n,r),t.parseAsync=async(n,r)=>Zte(t,n,r,{callee:t.parseAsync}),t.safeParseAsync=async(n,r)=>Qte(t,n,r),t.spa=t.safeParseAsync,t.encode=(n,r)=>ene(t,n,r),t.decode=(n,r)=>tne(t,n,r),t.encodeAsync=async(n,r)=>nne(t,n,r),t.decodeAsync=async(n,r)=>rne(t,n,r),t.safeEncode=(n,r)=>ine(t,n,r),t.safeDecode=(n,r)=>one(t,n,r),t.safeEncodeAsync=async(n,r)=>sne(t,n,r),t.safeDecodeAsync=async(n,r)=>ane(t,n,r),t.refine=(n,r)=>t.check(Vne(n,r)),t.superRefine=n=>t.check(Kne(n)),t.overwrite=n=>t.check(Mh(n)),t.optional=()=>Ow(t),t.nullable=()=>Dw(t),t.nullish=()=>Ow(Dw(t)),t.nonoptional=n=>Dne(t,n),t.array=()=>B1(t),t.or=n=>H1([t,n]),t.and=n=>xne(t,n),t.transform=n=>jw(t,JD(n)),t.default=n=>Ane(t,n),t.prefault=n=>One(t,n),t.catch=n=>$ne(t,n),t.pipe=n=>jw(t,n),t.readonly=()=>zne(t),t.describe=n=>{const r=t.clone();return zd.add(r,{description:n}),r},Object.defineProperty(t,"description",{get(){return zd.get(t)?.description},configurable:!0}),t.meta=(...n)=>{if(n.length===0)return zd.get(t);const r=t.clone();return zd.add(r,n[0]),r},t.isOptional=()=>t.safeParse(void 0).success,t.isNullable=()=>t.safeParse(null).success,t)),ED=se("_ZodString",(t,e)=>{Ev.init(t,e),Ot.init(t,e);const n=t._zod.bag;t.format=n.format??null,t.minLength=n.minimum??null,t.maxLength=n.maximum??null,t.regex=(...r)=>t.check(fD(...r)),t.includes=(...r)=>t.check(yD(...r)),t.startsWith=(...r)=>t.check(vD(...r)),t.endsWith=(...r)=>t.check(xD(...r)),t.min=(...r)=>t.check(_f(...r)),t.max=(...r)=>t.check(j1(...r)),t.length=(...r)=>t.check(R1(...r)),t.nonempty=(...r)=>t.check(_f(1,...r)),t.lowercase=r=>t.check(gD(r)),t.uppercase=r=>t.check(mD(r)),t.trim=()=>t.check(wD()),t.normalize=(...r)=>t.check(bD(...r)),t.toLowerCase=()=>t.check(kD()),t.toUpperCase=()=>t.check(ID())}),$1=se("ZodString",(t,e)=>{Ev.init(t,e),ED.init(t,e),t.email=n=>t.check(qO(AD,n)),t.url=n=>t.check(O1(N1,n)),t.jwt=n=>t.check(hD(VD,n)),t.emoji=n=>t.check(JO(MD,n)),t.guid=n=>t.check(Aw(Mw,n)),t.uuid=n=>t.check(GO(dc,n)),t.uuidv4=n=>t.check(YO(dc,n)),t.uuidv6=n=>t.check(XO(dc,n)),t.uuidv7=n=>t.check(ZO(dc,n)),t.nanoid=n=>t.check(QO(OD,n)),t.guid=n=>t.check(Aw(Mw,n)),t.cuid=n=>t.check(eD(DD,n)),t.cuid2=n=>t.check(tD(jD,n)),t.ulid=n=>t.check(nD(RD,n)),t.base64=n=>t.check(cD(UD,n)),t.base64url=n=>t.check(uD(HD,n)),t.xid=n=>t.check(rD($D,n)),t.ksuid=n=>t.check(iD(ND,n)),t.ipv4=n=>t.check(oD(LD,n)),t.ipv6=n=>t.check(sD(zD,n)),t.cidrv4=n=>t.check(aD(FD,n)),t.cidrv6=n=>t.check(lD(BD,n)),t.e164=n=>t.check(dD(WD,n)),t.datetime=n=>t.check(Vte(n)),t.date=n=>t.check(Kte(n)),t.time=n=>t.check(qte(n)),t.duration=n=>t.check(Gte(n))});function Qn(t){return nte($1,t)}const $n=se("ZodStringFormat",(t,e)=>{Tn.init(t,e),ED.init(t,e)}),AD=se("ZodEmail",(t,e)=>{BQ.init(t,e),$n.init(t,e)});function r4e(t){return qO(AD,t)}const Mw=se("ZodGUID",(t,e)=>{zQ.init(t,e),$n.init(t,e)});function i4e(t){return Aw(Mw,t)}const dc=se("ZodUUID",(t,e)=>{FQ.init(t,e),$n.init(t,e)});function o4e(t){return GO(dc,t)}function s4e(t){return YO(dc,t)}function a4e(t){return XO(dc,t)}function l4e(t){return ZO(dc,t)}const N1=se("ZodURL",(t,e)=>{UQ.init(t,e),$n.init(t,e)});function c4e(t){return O1(N1,t)}function u4e(t){return O1(N1,{protocol:/^https?$/,hostname:tQ,...be(t)})}const MD=se("ZodEmoji",(t,e)=>{HQ.init(t,e),$n.init(t,e)});function d4e(t){return JO(MD,t)}const OD=se("ZodNanoID",(t,e)=>{WQ.init(t,e),$n.init(t,e)});function h4e(t){return QO(OD,t)}const DD=se("ZodCUID",(t,e)=>{VQ.init(t,e),$n.init(t,e)});function p4e(t){return eD(DD,t)}const jD=se("ZodCUID2",(t,e)=>{KQ.init(t,e),$n.init(t,e)});function f4e(t){return tD(jD,t)}const RD=se("ZodULID",(t,e)=>{qQ.init(t,e),$n.init(t,e)});function g4e(t){return nD(RD,t)}const $D=se("ZodXID",(t,e)=>{GQ.init(t,e),$n.init(t,e)});function m4e(t){return rD($D,t)}const ND=se("ZodKSUID",(t,e)=>{YQ.init(t,e),$n.init(t,e)});function y4e(t){return iD(ND,t)}const LD=se("ZodIPv4",(t,e)=>{eee.init(t,e),$n.init(t,e)});function v4e(t){return oD(LD,t)}const zD=se("ZodIPv6",(t,e)=>{tee.init(t,e),$n.init(t,e)});function x4e(t){return sD(zD,t)}const FD=se("ZodCIDRv4",(t,e)=>{nee.init(t,e),$n.init(t,e)});function S4e(t){return aD(FD,t)}const BD=se("ZodCIDRv6",(t,e)=>{ree.init(t,e),$n.init(t,e)});function b4e(t){return lD(BD,t)}const UD=se("ZodBase64",(t,e)=>{iee.init(t,e),$n.init(t,e)});function w4e(t){return cD(UD,t)}const HD=se("ZodBase64URL",(t,e)=>{see.init(t,e),$n.init(t,e)});function k4e(t){return uD(HD,t)}const WD=se("ZodE164",(t,e)=>{aee.init(t,e),$n.init(t,e)});function I4e(t){return dD(WD,t)}const VD=se("ZodJWT",(t,e)=>{cee.init(t,e),$n.init(t,e)});function _4e(t){return hD(VD,t)}const Mv=se("ZodCustomStringFormat",(t,e)=>{uee.init(t,e),$n.init(t,e)});function C4e(t,e,n={}){return Av(Mv,t,e,n)}function P4e(t){return Av(Mv,"hostname",jO,t)}function T4e(t){return Av(Mv,"hex",yQ,t)}function E4e(t,e){const n=e?.enc??"hex",r=`${t}_${n}`,i=RO[r];if(!i)throw new Error(`Unrecognized hash format: ${r}`);return Av(Mv,r,i,e)}const L1=se("ZodNumber",(t,e)=>{zO.init(t,e),Ot.init(t,e),t.gt=(r,i)=>t.check(mh(r,i)),t.gte=(r,i)=>t.check(ys(r,i)),t.min=(r,i)=>t.check(ys(r,i)),t.lt=(r,i)=>t.check(gh(r,i)),t.lte=(r,i)=>t.check(Ua(r,i)),t.max=(r,i)=>t.check(Ua(r,i)),t.int=r=>t.check(GE(r)),t.safe=r=>t.check(GE(r)),t.positive=r=>t.check(mh(0,r)),t.nonnegative=r=>t.check(ys(0,r)),t.negative=r=>t.check(gh(0,r)),t.nonpositive=r=>t.check(Ua(0,r)),t.multipleOf=(r,i)=>t.check(Oy(r,i)),t.step=(r,i)=>t.check(Oy(r,i)),t.finite=()=>t;const n=t._zod.bag;t.minValue=Math.max(n.minimum??Number.NEGATIVE_INFINITY,n.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,t.maxValue=Math.min(n.maximum??Number.POSITIVE_INFINITY,n.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,t.isInt=(n.format??"").includes("int")||Number.isSafeInteger(n.multipleOf??.5),t.isFinite=!0,t.format=n.format??null});function Kn(t){return cte(L1,t)}const Kf=se("ZodNumberFormat",(t,e)=>{dee.init(t,e),L1.init(t,e)});function GE(t){return dte(Kf,t)}function A4e(t){return hte(Kf,t)}function M4e(t){return pte(Kf,t)}function O4e(t){return fte(Kf,t)}function D4e(t){return gte(Kf,t)}const z1=se("ZodBoolean",(t,e)=>{FO.init(t,e),Ot.init(t,e)});function KD(t){return mte(z1,t)}const F1=se("ZodBigInt",(t,e)=>{BO.init(t,e),Ot.init(t,e),t.gte=(r,i)=>t.check(ys(r,i)),t.min=(r,i)=>t.check(ys(r,i)),t.gt=(r,i)=>t.check(mh(r,i)),t.gte=(r,i)=>t.check(ys(r,i)),t.min=(r,i)=>t.check(ys(r,i)),t.lt=(r,i)=>t.check(gh(r,i)),t.lte=(r,i)=>t.check(Ua(r,i)),t.max=(r,i)=>t.check(Ua(r,i)),t.positive=r=>t.check(mh(BigInt(0),r)),t.negative=r=>t.check(gh(BigInt(0),r)),t.nonpositive=r=>t.check(Ua(BigInt(0),r)),t.nonnegative=r=>t.check(ys(BigInt(0),r)),t.multipleOf=(r,i)=>t.check(Oy(r,i));const n=t._zod.bag;t.minValue=n.minimum??null,t.maxValue=n.maximum??null,t.format=n.format??null});function j4e(t){return vte(F1,t)}const qD=se("ZodBigIntFormat",(t,e)=>{hee.init(t,e),F1.init(t,e)});function R4e(t){return Ste(qD,t)}function $4e(t){return bte(qD,t)}const lne=se("ZodSymbol",(t,e)=>{pee.init(t,e),Ot.init(t,e)});function N4e(t){return wte(lne,t)}const cne=se("ZodUndefined",(t,e)=>{fee.init(t,e),Ot.init(t,e)});function L4e(t){return kte(cne,t)}const une=se("ZodNull",(t,e)=>{gee.init(t,e),Ot.init(t,e)});function dne(t){return Ite(une,t)}const hne=se("ZodAny",(t,e)=>{mee.init(t,e),Ot.init(t,e)});function z4e(){return _te(hne)}const pne=se("ZodUnknown",(t,e)=>{yee.init(t,e),Ot.init(t,e)});function Cf(){return Cte(pne)}const fne=se("ZodNever",(t,e)=>{vee.init(t,e),Ot.init(t,e)});function GD(t){return Pte(fne,t)}const gne=se("ZodVoid",(t,e)=>{xee.init(t,e),Ot.init(t,e)});function F4e(t){return Tte(gne,t)}const YD=se("ZodDate",(t,e)=>{See.init(t,e),Ot.init(t,e),t.min=(r,i)=>t.check(ys(r,i)),t.max=(r,i)=>t.check(Ua(r,i));const n=t._zod.bag;t.minDate=n.minimum?new Date(n.minimum):null,t.maxDate=n.maximum?new Date(n.maximum):null});function B4e(t){return Ete(YD,t)}const mne=se("ZodArray",(t,e)=>{bee.init(t,e),Ot.init(t,e),t.element=e.element,t.min=(n,r)=>t.check(_f(n,r)),t.nonempty=n=>t.check(_f(1,n)),t.max=(n,r)=>t.check(j1(n,r)),t.length=(n,r)=>t.check(R1(n,r)),t.unwrap=()=>t.element});function B1(t,e){return Nte(mne,t,e)}function U4e(t){const e=t._zod.def.shape;return Oh(Object.keys(e))}const U1=se("ZodObject",(t,e)=>{_ee.init(t,e),Ot.init(t,e),Bt(t,"shape",()=>e.shape),t.keyof=()=>Oh(Object.keys(t._zod.def.shape)),t.catchall=n=>t.clone({...t._zod.def,catchall:n}),t.passthrough=()=>t.clone({...t._zod.def,catchall:Cf()}),t.loose=()=>t.clone({...t._zod.def,catchall:Cf()}),t.strict=()=>t.clone({...t._zod.def,catchall:GD()}),t.strip=()=>t.clone({...t._zod.def,catchall:void 0}),t.extend=n=>_J(t,n),t.safeExtend=n=>CJ(t,n),t.merge=n=>PJ(t,n),t.pick=n=>kJ(t,n),t.omit=n=>IJ(t,n),t.partial=(...n)=>TJ(QD,t,n[0]),t.required=(...n)=>EJ(ej,t,n[0])});function Tc(t,e){const n={type:"object",shape:t??{},...be(e)};return new U1(n)}function H4e(t,e){return new U1({type:"object",shape:t,catchall:GD(),...be(e)})}function W4e(t,e){return new U1({type:"object",shape:t,catchall:Cf(),...be(e)})}const XD=se("ZodUnion",(t,e)=>{UO.init(t,e),Ot.init(t,e),t.options=e.options});function H1(t,e){return new XD({type:"union",options:t,...be(e)})}const yne=se("ZodDiscriminatedUnion",(t,e)=>{XD.init(t,e),Cee.init(t,e)});function V4e(t,e,n){return new yne({type:"union",options:e,discriminator:t,...be(n)})}const vne=se("ZodIntersection",(t,e)=>{Pee.init(t,e),Ot.init(t,e)});function xne(t,e){return new vne({type:"intersection",left:t,right:e})}const Sne=se("ZodTuple",(t,e)=>{HO.init(t,e),Ot.init(t,e),t.rest=n=>t.clone({...t._zod.def,rest:n})});function bne(t,e,n){const r=e instanceof kt,i=r?n:e,o=r?e:null;return new Sne({type:"tuple",items:t,rest:o,...be(i)})}const ZD=se("ZodRecord",(t,e)=>{Tee.init(t,e),Ot.init(t,e),t.keyType=e.keyType,t.valueType=e.valueType});function wne(t,e,n){return new ZD({type:"record",keyType:t,valueType:e,...be(n)})}function K4e(t,e,n){const r=ma(t);return r._zod.values=void 0,new ZD({type:"record",keyType:r,valueType:e,...be(n)})}const kne=se("ZodMap",(t,e)=>{Eee.init(t,e),Ot.init(t,e),t.keyType=e.keyType,t.valueType=e.valueType});function q4e(t,e,n){return new kne({type:"map",keyType:t,valueType:e,...be(n)})}const Ine=se("ZodSet",(t,e)=>{Aee.init(t,e),Ot.init(t,e),t.min=(...n)=>t.check(Dy(...n)),t.nonempty=n=>t.check(Dy(1,n)),t.max=(...n)=>t.check(D1(...n)),t.size=(...n)=>t.check(pD(...n))});function G4e(t,e){return new Ine({type:"set",valueType:t,...be(e)})}const jy=se("ZodEnum",(t,e)=>{Mee.init(t,e),Ot.init(t,e),t.enum=e.entries,t.options=Object.values(e.entries);const n=new Set(Object.keys(e.entries));t.extract=(r,i)=>{const o={};for(const s of r)if(n.has(s))o[s]=e.entries[s];else throw new Error(`Key ${s} not found in enum`);return new jy({...e,checks:[],...be(i),entries:o})},t.exclude=(r,i)=>{const o={...e.entries};for(const s of r)if(n.has(s))delete o[s];else throw new Error(`Key ${s} not found in enum`);return new jy({...e,checks:[],...be(i),entries:o})}});function Oh(t,e){const n=Array.isArray(t)?Object.fromEntries(t.map(r=>[r,r])):t;return new jy({type:"enum",entries:n,...be(e)})}function Y4e(t,e){return new jy({type:"enum",entries:t,...be(e)})}const _ne=se("ZodLiteral",(t,e)=>{Oee.init(t,e),Ot.init(t,e),t.values=new Set(e.values),Object.defineProperty(t,"value",{get(){if(e.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return e.values[0]}})});function rd(t,e){return new _ne({type:"literal",values:Array.isArray(t)?t:[t],...be(e)})}const Cne=se("ZodFile",(t,e)=>{Dee.init(t,e),Ot.init(t,e),t.min=(n,r)=>t.check(Dy(n,r)),t.max=(n,r)=>t.check(D1(n,r)),t.mime=(n,r)=>t.check(SD(Array.isArray(n)?n:[n],r))});function X4e(t){return Lte(Cne,t)}const Pne=se("ZodTransform",(t,e)=>{jee.init(t,e),Ot.init(t,e),t._zod.parse=(n,r)=>{if(r.direction==="backward")throw new P1(t.constructor.name);n.addIssue=o=>{if(typeof o=="string")n.issues.push(kf(o,n.value,e));else{const s=o;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=n.value),s.inst??(s.inst=t),n.issues.push(kf(s))}};const i=e.transform(n.value,n);return i instanceof Promise?i.then(o=>(n.value=o,n)):(n.value=i,n)}});function JD(t){return new Pne({type:"transform",transform:t})}const QD=se("ZodOptional",(t,e)=>{Ree.init(t,e),Ot.init(t,e),t.unwrap=()=>t._zod.def.innerType});function Ow(t){return new QD({type:"optional",innerType:t})}const Tne=se("ZodNullable",(t,e)=>{$ee.init(t,e),Ot.init(t,e),t.unwrap=()=>t._zod.def.innerType});function Dw(t){return new Tne({type:"nullable",innerType:t})}function Z4e(t){return Ow(Dw(t))}const Ene=se("ZodDefault",(t,e)=>{Nee.init(t,e),Ot.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeDefault=t.unwrap});function Ane(t,e){return new Ene({type:"default",innerType:t,get defaultValue(){return typeof e=="function"?e():E1(e)}})}const Mne=se("ZodPrefault",(t,e)=>{Lee.init(t,e),Ot.init(t,e),t.unwrap=()=>t._zod.def.innerType});function One(t,e){return new Mne({type:"prefault",innerType:t,get defaultValue(){return typeof e=="function"?e():E1(e)}})}const ej=se("ZodNonOptional",(t,e)=>{zee.init(t,e),Ot.init(t,e),t.unwrap=()=>t._zod.def.innerType});function Dne(t,e){return new ej({type:"nonoptional",innerType:t,...be(e)})}const jne=se("ZodSuccess",(t,e)=>{Fee.init(t,e),Ot.init(t,e),t.unwrap=()=>t._zod.def.innerType});function J4e(t){return new jne({type:"success",innerType:t})}const Rne=se("ZodCatch",(t,e)=>{Bee.init(t,e),Ot.init(t,e),t.unwrap=()=>t._zod.def.innerType,t.removeCatch=t.unwrap});function $ne(t,e){return new Rne({type:"catch",innerType:t,catchValue:typeof e=="function"?e:()=>e})}const Nne=se("ZodNaN",(t,e)=>{Uee.init(t,e),Ot.init(t,e)});function Q4e(t){return Mte(Nne,t)}const tj=se("ZodPipe",(t,e)=>{Hee.init(t,e),Ot.init(t,e),t.in=e.in,t.out=e.out});function jw(t,e){return new tj({type:"pipe",in:t,out:e})}const nj=se("ZodCodec",(t,e)=>{tj.init(t,e),WO.init(t,e)});function eFe(t,e,n){return new nj({type:"pipe",in:t,out:e,transform:n.decode,reverseTransform:n.encode})}const Lne=se("ZodReadonly",(t,e)=>{Wee.init(t,e),Ot.init(t,e),t.unwrap=()=>t._zod.def.innerType});function zne(t){return new Lne({type:"readonly",innerType:t})}const Fne=se("ZodTemplateLiteral",(t,e)=>{Vee.init(t,e),Ot.init(t,e)});function tFe(t,e){return new Fne({type:"template_literal",parts:t,...be(e)})}const Bne=se("ZodLazy",(t,e)=>{Gee.init(t,e),Ot.init(t,e),t.unwrap=()=>t._zod.def.getter()});function Une(t){return new Bne({type:"lazy",getter:t})}const Hne=se("ZodPromise",(t,e)=>{qee.init(t,e),Ot.init(t,e),t.unwrap=()=>t._zod.def.innerType});function nFe(t){return new Hne({type:"promise",innerType:t})}const Wne=se("ZodFunction",(t,e)=>{Kee.init(t,e),Ot.init(t,e)});function lB(t){return new Wne({type:"function",input:Array.isArray(t?.input)?bne(t?.input):t?.input??B1(Cf()),output:t?.output??Cf()})}const W1=se("ZodCustom",(t,e)=>{Yee.init(t,e),Ot.init(t,e)});function rFe(t){const e=new pr({check:"custom"});return e._zod.check=t,e}function iFe(t,e){return zte(W1,t??(()=>!0),e)}function Vne(t,e={}){return Fte(W1,t,e)}function Kne(t){return Bte(t)}function oFe(t,e={error:`Input not instance of ${t.name}`}){const n=new W1({type:"custom",check:"custom",fn:r=>r instanceof t,abort:!0,...be(e)});return n._zod.bag.Class=t,n}const sFe=(...t)=>Hte({Codec:nj,Boolean:z1,String:$1},...t);function aFe(t){const e=Une(()=>H1([Qn(t),Kn(),KD(),dne(),B1(e),wne(Qn(),e)]));return e}function lFe(t,e){return jw(JD(t),e)}const cFe={invalid_type:"invalid_type",too_big:"too_big",too_small:"too_small",invalid_format:"invalid_format",not_multiple_of:"not_multiple_of",unrecognized_keys:"unrecognized_keys",invalid_union:"invalid_union",invalid_key:"invalid_key",invalid_element:"invalid_element",invalid_value:"invalid_value",custom:"custom"};function uFe(t){Io({customError:t})}function dFe(){return Io().customError}var YE;YE||(YE={});function hFe(t){return rte($1,t)}function pFe(t){return ute(L1,t)}function fFe(t){return yte(z1,t)}function gFe(t){return xte(F1,t)}function mFe(t){return Ate(YD,t)}const yFe=Object.freeze(Object.defineProperty({__proto__:null,bigint:gFe,boolean:fFe,date:mFe,number:pFe,string:hFe},Symbol.toStringTag,{value:"Module"}));Io(Xee());const he=Object.freeze(Object.defineProperty({__proto__:null,$brand:mJ,$input:tte,$output:ete,NEVER:gJ,TimePrecision:ite,ZodAny:hne,ZodArray:mne,ZodBase64:UD,ZodBase64URL:HD,ZodBigInt:F1,ZodBigIntFormat:qD,ZodBoolean:z1,ZodCIDRv4:FD,ZodCIDRv6:BD,ZodCUID:DD,ZodCUID2:jD,ZodCatch:Rne,ZodCodec:nj,ZodCustom:W1,ZodCustomStringFormat:Mv,ZodDate:YD,ZodDefault:Ene,ZodDiscriminatedUnion:yne,ZodE164:WD,ZodEmail:AD,ZodEmoji:MD,ZodEnum:jy,ZodError:n4e,ZodFile:Cne,get ZodFirstPartyTypeKind(){return YE},ZodFunction:Wne,ZodGUID:Mw,ZodIPv4:LD,ZodIPv6:zD,ZodISODate:CD,ZodISODateTime:_D,ZodISODuration:TD,ZodISOTime:PD,ZodIntersection:vne,ZodIssueCode:cFe,ZodJWT:VD,ZodKSUID:ND,ZodLazy:Bne,ZodLiteral:_ne,ZodMap:kne,ZodNaN:Nne,ZodNanoID:OD,ZodNever:fne,ZodNonOptional:ej,ZodNull:une,ZodNullable:Tne,ZodNumber:L1,ZodNumberFormat:Kf,ZodObject:U1,ZodOptional:QD,ZodPipe:tj,ZodPrefault:Mne,ZodPromise:Hne,ZodReadonly:Lne,ZodRealError:$s,ZodRecord:ZD,ZodSet:Ine,ZodString:$1,ZodStringFormat:$n,ZodSuccess:jne,ZodSymbol:lne,ZodTemplateLiteral:Fne,ZodTransform:Pne,ZodTuple:Sne,ZodType:Ot,ZodULID:RD,ZodURL:N1,ZodUUID:dc,ZodUndefined:cne,ZodUnion:XD,ZodUnknown:pne,ZodVoid:gne,ZodXID:$D,_ZodString:ED,_default:Ane,_function:lB,any:z4e,array:B1,base64:w4e,base64url:k4e,bigint:j4e,boolean:KD,catch:$ne,check:rFe,cidrv4:S4e,cidrv6:b4e,clone:ma,codec:eFe,coerce:yFe,config:Io,core:e4e,cuid:p4e,cuid2:f4e,custom:iFe,date:B4e,decode:tne,decodeAsync:rne,discriminatedUnion:V4e,e164:I4e,email:r4e,emoji:d4e,encode:ene,encodeAsync:nne,endsWith:xD,enum:Oh,file:X4e,flattenError:kO,float32:A4e,float64:M4e,formatError:IO,function:lB,getErrorMap:dFe,globalRegistry:zd,gt:mh,gte:ys,guid:i4e,hash:E4e,hex:T4e,hostname:P4e,httpUrl:u4e,includes:yD,instanceof:oFe,int:GE,int32:O4e,int64:R4e,intersection:xne,ipv4:v4e,ipv6:x4e,iso:t4e,json:aFe,jwt:_4e,keyof:U4e,ksuid:y4e,lazy:Une,length:R1,literal:rd,locales:Qee,looseObject:W4e,lowercase:gD,lt:gh,lte:Ua,map:q4e,maxLength:j1,maxSize:D1,mime:SD,minLength:_f,minSize:Dy,multipleOf:Oy,nan:Q4e,nanoid:h4e,nativeEnum:Y4e,negative:Dte,never:GD,nonnegative:Rte,nonoptional:Dne,nonpositive:jte,normalize:bD,null:dne,nullable:Dw,nullish:Z4e,number:Kn,object:Tc,optional:Ow,overwrite:Mh,parse:Xte,parseAsync:Zte,partialRecord:K4e,pipe:jw,positive:Ote,prefault:One,preprocess:lFe,prettifyError:$J,promise:nFe,property:$te,readonly:zne,record:wne,refine:Vne,regex:fD,regexes:RO,registry:KO,safeDecode:one,safeDecodeAsync:ane,safeEncode:ine,safeEncodeAsync:sne,safeParse:Jte,safeParseAsync:Qte,set:G4e,setErrorMap:uFe,size:pD,startsWith:vD,strictObject:H4e,string:Qn,stringFormat:C4e,stringbool:sFe,success:J4e,superRefine:Kne,symbol:N4e,templateLiteral:tFe,toJSONSchema:Wte,toLowerCase:kD,toUpperCase:ID,transform:JD,treeifyError:jJ,trim:wD,tuple:bne,uint32:D4e,uint64:$4e,ulid:g4e,undefined:L4e,union:H1,unknown:Cf,uppercase:mD,url:c4e,util:OJ,uuid:o4e,uuidv4:s4e,uuidv6:a4e,uuidv7:l4e,void:F4e,xid:m4e},Symbol.toStringTag,{value:"Module"})),V1=he.enum(["none","tint","background","solid","pattern"]),vFe={none:"none",solid:"fill",background:"semi",tint:"solid",pattern:"pattern"},xFe={none:"none",fill:"solid",semi:"background",solid:"tint",pattern:"pattern"};function Ry(t){return vFe[t]}function qne(t){return xFe[t]}class Gne{agent;editor;constructor(e){this.agent=e,this.editor=e.editor;const n=e.$chatOrigin.get();this.offset={x:-n.x,y:-n.y}}offset={x:0,y:0};shapeIdMap=new Map;roundingDiffMap=new Map;applyOffsetToVec(e){return{x:e.x+this.offset.x,y:e.y+this.offset.y}}removeOffsetFromVec(e){return{x:e.x-this.offset.x,y:e.y-this.offset.y}}applyOffsetToBox(e){return{x:e.x+this.offset.x,y:e.y+this.offset.y,w:e.w,h:e.h}}removeOffsetFromBox(e){return{x:e.x-this.offset.x,y:e.y-this.offset.y,w:e.w,h:e.h}}applyOffsetToShape(e){return"x1"in e?{...e,x1:e.x1+this.offset.x,y1:e.y1+this.offset.y,x2:e.x2+this.offset.x,y2:e.y2+this.offset.y}:"x"in e?{...e,x:e.x+this.offset.x,y:e.y+this.offset.y}:e}applyOffsetToShapePartial(e){return"x"in e&&e.x!==void 0?{...e,x:e.x+this.offset.x}:"y"in e&&e.y!==void 0?{...e,y:e.y+this.offset.y}:"x1"in e&&e.x1!==void 0?{...e,x1:e.x1+this.offset.x}:"y1"in e&&e.y1!==void 0?{...e,y1:e.y1+this.offset.y}:"x2"in e&&e.x2!==void 0?{...e,x2:e.x2+this.offset.x}:"y2"in e&&e.y2!==void 0?{...e,y2:e.y2+this.offset.y}:e}removeOffsetFromShape(e){return"x1"in e?{...e,x1:e.x1-this.offset.x,y1:e.y1-this.offset.y,x2:e.x2-this.offset.x,y2:e.y2-this.offset.y}:"x"in e?{...e,x:e.x-this.offset.x,y:e.y-this.offset.y}:e}applyOffsetToContextItem(e){switch(e.type){case"shape":return e.shape=this.applyOffsetToShape(e.shape),e;case"shapes":return e.shapes=e.shapes.map(n=>this.applyOffsetToShape(n)),e;case"area":return e.bounds=this.applyOffsetToBox(e.bounds),e;case"point":return e.point=this.applyOffsetToVec(e.point),e}}roundContextItem(e){switch(e.type){case"shape":return e.shape=this.roundShape(e.shape),e;case"shapes":return e.shapes=e.shapes.map(n=>this.roundShape(n)),e;case"area":return e.bounds=this.roundBox(e.bounds),e;case"point":return e.point=this.roundVec(e.point),e}}ensureShapeIdIsUnique(e){const{editor:n}=this.agent,r=e.startsWith("shape:")?e.slice(6):e;let i=r,o=n.getShape(`shape:${i}`);for(;o;)i=/^.*(\d+)$/.exec(i)?.[1]?i.replace(/(\d+)(?=\D?)$/,s=>(+s+1).toString()):`${i}-1`,o=n.getShape(`shape:${i}`);return r!==i&&this.shapeIdMap.set(r,i),r===e?i:`shape:${i}`}ensureShapeIdExists(e){const{editor:n}=this.agent,r=e.startsWith("shape:")?e.slice(6):e,i=this.shapeIdMap.get(r);return i||(n.getShape(`shape:${r}`)?e:null)}ensureShapeIdsExist(e){return e.map(n=>this.ensureShapeIdExists(n)).filter(n=>n!==null)}roundShape(e){return"x1"in e?(e=this.roundProperty(e,"x1"),e=this.roundProperty(e,"y1"),e=this.roundProperty(e,"x2"),e=this.roundProperty(e,"y2")):"x"in e&&(e=this.roundProperty(e,"x"),e=this.roundProperty(e,"y")),"w"in e&&(e=this.roundProperty(e,"w"),e=this.roundProperty(e,"h")),e}roundShapePartial(e){for(const n of["x1","y1","x2","y2","x","y","w","h"])n in e&&(e=this.roundProperty(e,n));return e}unroundShape(e){return"x1"in e?(e=this.unroundProperty(e,"x1"),e=this.unroundProperty(e,"y1"),e=this.unroundProperty(e,"x2"),e=this.unroundProperty(e,"y2")):"x"in e&&(e=this.unroundProperty(e,"x"),e=this.unroundProperty(e,"y")),"w"in e&&(e=this.unroundProperty(e,"w"),e=this.unroundProperty(e,"h")),e}roundAndSaveNumber(e,n){const r=Math.round(e),i=r-e;return this.roundingDiffMap.set(n,i),r}unroundAndRestoreNumber(e,n){const r=this.roundingDiffMap.get(n);return r===void 0?e:e+r}roundProperty(e,n){if(typeof e[n]!="number")return e;const r=e[n],i=`${e.shapeId}_${n}`,o=this.roundAndSaveNumber(r,i);return e[n]=o,e}unroundProperty(e,n){if(typeof e[n]!="number")return e;const r=`${e.shapeId}_${n}`,i=this.roundingDiffMap.get(r);return i===void 0||(e[n]+=i),e}ensureValueIsNumber(e){if(typeof e=="number")return e;if(typeof e=="string"){const n=parseFloat(e);return isNaN(n)?null:n}return null}ensureValueIsVec(e){if(!e||typeof e!="object"||!("x"in e)||!("y"in e))return null;const n=this.ensureValueIsNumber(e.x),r=this.ensureValueIsNumber(e.y);return n===null||r===null?null:{x:n,y:r}}ensureValueIsBoolean(e){return typeof e=="boolean"?e:typeof e=="number"?e>0:typeof e=="string"?e!=="false":null}ensureValueIsSimpleFill(e){const n=V1.safeParse(e);return n.success?n.data:null}roundBox(e){return e.x=Math.round(e.x),e.y=Math.round(e.y),e.w=Math.round(e.w),e.h=Math.round(e.h),e}roundVec(e){return e.x=Math.round(e.x),e.y=Math.round(e.y),e}}class Nn{static type;agent;editor;constructor(e){this.agent=e,this.editor=e?.editor}getSchema(){return null}getInfo(e){return{}}sanitizeAction(e,n){return e}applyAction(e,n){}savesToHistory(){return!0}buildSystemPrompt(){return null}}const SFe=he.object({_type:he.literal("add-detail"),intent:he.string()}).meta({title:"Add Detail",description:"The AI plans further work so that it can add detail to its work."});class bFe extends Nn{static type="add-detail";getSchema(){return SFe}getInfo(e){const n="Adding detail",r=e.intent?.startsWith("#")?`

${e.intent}`:e.intent;return{icon:"pencil",description:`**${n}:** ${r??""}`}}applyAction(e){e.complete&&this.agent&&this.agent.schedule("Add detail to the canvas.")}}const wFe=he.object({_type:he.literal("align"),alignment:he.enum(["top","bottom","left","right","center-horizontal","center-vertical"]),gap:he.number(),intent:he.string(),shapeIds:he.array(he.string())}).meta({title:"Align",description:"The AI aligns shapes to each other on an axis."});class kFe extends Nn{static type="align";getSchema(){return wFe}getInfo(e){return{icon:"cursor",description:e.intent??""}}sanitizeAction(e,n){return e.shapeIds=n.ensureShapeIdsExist(e.shapeIds??[]),e}applyAction(e){e.complete&&this.agent&&this.agent.editor.alignShapes(e.shapeIds.map(n=>`shape:${n}`),e.alignment)}}const IFe=he.object({_type:he.literal("bringToFront"),intent:he.string(),shapeIds:he.array(he.string())}).meta({title:"Bring to Front",description:"The AI brings one or more shapes to the front so that they appear in front of everything else."});class _Fe extends Nn{static type="bringToFront";getSchema(){return IFe}getInfo(e){return{icon:"cursor",description:e.intent??""}}sanitizeAction(e,n){return e.shapeIds=n.ensureShapeIdsExist(e.shapeIds??[]),e}applyAction(e){this.agent&&e.shapeIds&&this.agent.editor.bringToFront(e.shapeIds.map(n=>`shape:${n}`))}}const CFe=he.object({_type:he.literal("clear")}).meta({title:"Clear",description:"The agent deletes all shapes on the canvas."});class PFe extends Nn{static type="clear";getSchema(){return CFe}getInfo(){return{icon:"trash",description:"Cleared the canvas"}}applyAction(e){if(!e.complete||!this.agent)return;const{editor:n}=this.agent,r=n.getCurrentPageShapes();n.deleteShapes(r)}}const TFe=he.object({_type:he.literal("countryInfo"),code:he.string()}).meta({title:"Country info",description:'The AI gets information about a country by providing its country code, eg: "de" for Germany.'});class EFe extends Nn{static type="countryInfo";getSchema(){return TFe}getInfo(e){return{icon:"search",description:e.complete?"Searched for country info":"Searching for country info"}}async applyAction(e){if(!e.complete||!this.agent)return;const n=await AFe(e.code);this.agent.schedule({data:[n]})}}async function AFe(t){const e=await fetch(`https://restcountries.com/v3.1/alpha/${t}`);if(!e.ok)throw new Error(`Country API returned status ${e.status}, ${e.statusText}`);const n=await e.json();return Array.isArray(n)?n[0]:n}const MFe=he.object({_type:he.literal("count"),expression:he.string()}).meta({title:"Count",description:"The AI requests to count the number of shapes in the canvas. The answer will be provided to the AI in a follow-up request."});class OFe extends Nn{static type="count";getSchema(){return MFe}getInfo(e){return{icon:"search",description:e.complete?"Counted shapes":"Counting shapes"}}async applyAction(e,n){if(!e.complete)return;const{agent:r,editor:i}=n;r.schedule({data:[`Number of shapes on the canvas: ${i.getCurrentPageShapes().length}`]})}}const id=he.enum(["red","light-red","green","light-green","blue","light-blue","orange","yellow","black","violet","light-violet","grey","white"]);function Dh(t){if(id.safeParse(t).success)return t;switch(t){case"pink":return"light-violet";case"light-pink":return"light-violet"}return"black"}const DFe=Kn();function jFe(t){const e=Object.entries(Sc);let n=e[0],r=Math.abs(t-n[1]);for(const[a,l]of e){const c=Math.abs(t-l);c<r&&(r=c,n=[a,l])}const i=n[0],o=n[1],s=t/o;return{textSize:i,scale:s}}function RFe(t,e){return Math.round(Sc[t]*e)}function Yne(t,e,{defaultShape:n}){switch(e._type){case"text":return NFe(t,e,{defaultShape:n});case"line":return LFe(t,e,{defaultShape:n});case"arrow":return zFe(t,e,{defaultShape:n});case"cloud":case"rectangle":case"triangle":case"diamond":case"hexagon":case"pill":case"x-box":case"pentagon":case"octagon":case"star":case"parallelogram-right":case"parallelogram-left":case"trapezoid":case"fat-arrow-right":case"fat-arrow-left":case"fat-arrow-up":case"fat-arrow-down":case"check-box":case"heart":case"ellipse":return FFe(t,e,{defaultShape:n});case"note":return BFe(t,e,{defaultShape:n});case"draw":return UFe(t,e,{defaultShape:n});case"unknown":return HFe(t,e,{defaultShape:n})}}function Il(t){return"shape:"+t}function $Fe(t){return Xne[t]}const Xne={rectangle:"rectangle",ellipse:"ellipse",triangle:"triangle",diamond:"diamond",hexagon:"hexagon",pill:"oval",cloud:"cloud","x-box":"x-box","check-box":"check-box",heart:"heart",pentagon:"pentagon",octagon:"octagon",star:"star","parallelogram-right":"rhombus","parallelogram-left":"rhombus-2",trapezoid:"trapezoid","fat-arrow-right":"arrow-right","fat-arrow-left":"arrow-left","fat-arrow-up":"arrow-up","fat-arrow-down":"arrow-down"};function NFe(t,e,{defaultShape:n}){const r=Il(e.shapeId),i=n;let o="s",s=1;if(e.fontSize){const{textSize:x,scale:b}=jFe(e.fontSize);o=x,s=b}else i.props?.size&&(o=i.props.size,s=i.props.scale??1);const a=e.wrap===void 0?i.props?.autoSize??!0:!e.wrap,l=Sc[o],c=e.textAlign??i.props?.textAlign??"start",d=i.props?.font??"draw",u=new T,p=l*s,f=t.textMeasure.measureText(e.text,{...Vi,fontFamily:bc[d],fontSize:p,maxWidth:e.width??1/0}),y=e.x??i.x??0,v=e.y??i.y??0;switch(c){case"start":u.x=y,u.y=v-f.h/2;break;case"middle":u.x=y-f.w/2,u.y=v-f.h/2;break;case"end":u.x=y-f.w,u.y=v-f.h/2;break}return{shape:{id:r,type:"text",typeName:"shape",x:u.x,y:u.y,rotation:i.rotation??0,index:i.index??"a1",parentId:i.parentId??t.getCurrentPageId(),isLocked:i.isLocked??!1,opacity:i.opacity??1,props:{size:o,scale:s,richText:dn(e.text),color:Dh(e.color??i.props?.color??"black"),textAlign:c,autoSize:a,w:f.w,font:d},meta:{note:e.note??i.meta?.note??""}}}}function LFe(t,e,{defaultShape:n}){const r=Il(e.shapeId),i=n,o=e.x1??0,s=e.y1??0,a=e.x2??0,l=e.y2??0,c=Math.min(o,a),d=Math.min(s,l);return{shape:{id:r,type:"line",typeName:"shape",x:c,y:d,rotation:i.rotation??0,index:i.index??"a1",parentId:i.parentId??t.getCurrentPageId(),isLocked:i.isLocked??!1,opacity:i.opacity??1,props:{size:i.props?.size??"s",points:{a1:{id:"a1",index:"a1",x:o-c,y:s-d},a2:{id:"a2",index:"a2",x:a-c,y:l-d}},color:Dh(e.color??i.props?.color??"black"),dash:i.props?.dash??"draw",scale:i.props?.scale??1,spline:i.props?.spline??"line"},meta:{note:e.note??i.meta?.note??""}}}}function zFe(t,e,{defaultShape:n}){const r=Il(e.shapeId),i=n,o=e.x1??i.props?.start?.x??0,s=e.y1??i.props?.start?.y??0,a=e.x2??i.props?.end?.x??0,l=e.y2??i.props?.end?.y??0,c=Math.min(o,a),d=Math.min(s,l);let u;e.text!==void 0?u=dn(e.text):i.props?.richText?u=i.props.richText:u=dn("");const p={id:r,type:"arrow",typeName:"shape",x:c,y:d,rotation:i.rotation??0,index:i.index??"a1",parentId:i.parentId??t.getCurrentPageId(),isLocked:i.isLocked??!1,opacity:i.opacity??1,props:{arrowheadEnd:i.props?.arrowheadEnd??"arrow",arrowheadStart:i.props?.arrowheadStart??"none",bend:e.bend??i.props?.bend??0,color:Dh(e.color??i.props?.color??"black"),dash:i.props?.dash??"draw",elbowMidPoint:i.props?.elbowMidPoint??.5,end:{x:a-c,y:l-d},fill:i.props?.fill??"none",font:i.props?.font??"draw",kind:i.props?.kind??"arc",labelColor:i.props?.labelColor??"black",labelPosition:i.props?.labelPosition??.5,richText:u,scale:i.props?.scale??1,size:i.props?.size??"s",start:{x:o-c,y:s-d}},meta:{note:e.note??i.meta?.note??""}},f=[];if(e.fromId){const y=Il(e.fromId),v=t.getShape(y);if(v){const b=cB(t,v,{x:o,y:s});f.push({type:"arrow",typeName:"binding",fromId:r,toId:v.id,props:{normalizedAnchor:b,isExact:!1,isPrecise:!0,terminal:"start"},meta:{}})}}if(e.toId){const y=Il(e.toId),v=t.getShape(y);if(v){const b=cB(t,v,{x:a,y:l});f.push({type:"arrow",typeName:"binding",fromId:r,toId:v.id,props:{normalizedAnchor:b,isExact:!1,isPrecise:!0,terminal:"end"},meta:{}})}}return{shape:p,bindings:f.length>0?f:void 0}}function FFe(t,e,{defaultShape:n}){const r=Il(e.shapeId),i=$Fe(e._type),o=n;let s;e.text!==void 0?s=dn(e.text):o.props?.richText?s=o.props.richText:s=dn("");let a;return e.fill!==void 0?a=Ry(e.fill):o.props?.fill?a=o.props.fill:a=Ry("none"),{shape:{id:r,type:"geo",typeName:"shape",x:e.x??o.x??0,y:e.y??o.y??0,rotation:o.rotation??0,index:o.index??"a1",parentId:o.parentId??t.getCurrentPageId(),isLocked:o.isLocked??!1,opacity:o.opacity??1,props:{align:e.textAlign??o.props?.align??"middle",color:Dh(e.color??o.props?.color??"black"),dash:o.props?.dash??"draw",fill:a,font:o.props?.font??"draw",geo:i,growY:o.props?.growY??0,h:e.h??o.props?.h??100,labelColor:o.props?.labelColor??"black",richText:s,scale:o.props?.scale??1,size:o.props?.size??"s",url:o.props?.url??"",verticalAlign:o.props?.verticalAlign??"middle",w:e.w??o.props?.w??100},meta:{note:e.note??o.meta?.note??""}}}}function BFe(t,e,{defaultShape:n}){const r=Il(e.shapeId),i=n;let o;return e.text!==void 0?o=dn(e.text):i.props?.richText?o=i.props.richText:o=dn(""),{shape:{id:r,type:"note",typeName:"shape",x:e.x??i.x??0,y:e.y??i.y??0,rotation:i.rotation??0,index:i.index??"a1",parentId:i.parentId??t.getCurrentPageId(),isLocked:i.isLocked??!1,opacity:i.opacity??1,props:{color:Dh(e.color??i.props?.color??"black"),richText:o,size:i.props?.size??"s",align:i.props?.align??"middle",font:i.props?.font??"draw",fontSizeAdjustment:i.props?.fontSizeAdjustment??0,growY:i.props?.growY??0,labelColor:i.props?.labelColor??"black",scale:i.props?.scale??1,url:i.props?.url??"",verticalAlign:i.props?.verticalAlign??"middle"},meta:{note:e.note??i.meta?.note??""}}}}function UFe(t,e,{defaultShape:n}){const r=Il(e.shapeId),i=n;let o;return e.fill!==void 0?o=Ry(e.fill):i.props?.fill?o=i.props.fill:o=Ry("none"),{shape:{id:r,type:"draw",typeName:"shape",x:i.x??0,y:i.y??0,rotation:i.rotation??0,index:i.index??"a1",parentId:i.parentId??t.getCurrentPageId(),isLocked:i.isLocked??!1,opacity:i.opacity??1,props:{color:Dh(e.color??i.props?.color??"black"),fill:o},meta:{note:e.note??i.meta?.note??""}}}}function HFe(t,e,{defaultShape:n}){return{shape:{id:Il(e.shapeId),type:n.type??"geo",typeName:"shape",x:e.x??n.x??0,y:e.y??n.y??0,rotation:n.rotation??0,index:n.index??"a1",parentId:n.parentId??t.getCurrentPageId(),isLocked:n.isLocked??!1,opacity:n.opacity??1,props:n.props??{},meta:{note:e.note??n.meta?.note??""}}}}function cB(t,e,n){const r=t.getShapePageBounds(e),i=t.getShapeGeometry(e);if(!r||!i)return{x:.5,y:.5};const o=t.getShapePageTransform(e),s=i.transform(o),a=s.hitTestPoint(n,0,!0)?n:s.nearestPoint(n),l={x:(a.x-r.x)/r.w,y:(a.y-r.y)/r.h},c={x:Math.max(0,Math.min(1,l.x)),y:Math.max(0,Math.min(1,l.y))},d={x:r.x+c.x*r.w,y:r.y+c.y*r.h};return s.hitTestPoint(d,0,!0)?c:{x:.5,y:.5}}const WFe=Oh(["rectangle","ellipse","triangle","diamond","hexagon","pill","cloud","x-box","check-box","heart","pentagon","octagon","star","parallelogram-right","parallelogram-left","trapezoid","fat-arrow-right","fat-arrow-left","fat-arrow-up","fat-arrow-down"]),rj=Qn(),VFe=Tc({_type:WFe,color:id,fill:V1,h:Kn(),note:Qn(),shapeId:Qn(),text:rj.optional(),textAlign:Oh(["start","middle","end"]).optional(),w:Kn(),x:Kn(),y:Kn()}),KFe=Tc({_type:rd("line"),color:id,note:Qn(),shapeId:Qn(),x1:Kn(),x2:Kn(),y1:Kn(),y2:Kn()}),qFe=Tc({_type:rd("note"),color:id,note:Qn(),shapeId:Qn(),text:rj.optional(),x:Kn(),y:Kn()}),GFe=Tc({_type:rd("text"),color:id,fontSize:DFe.optional(),note:Qn(),shapeId:Qn(),text:rj,textAlign:Oh(["start","middle","end"]).optional(),width:Kn().optional(),wrap:KD().optional(),x:Kn(),y:Kn()}),YFe=Tc({_type:rd("arrow"),color:id,fromId:Qn().nullable(),note:Qn(),shapeId:Qn(),text:Qn().optional(),toId:Qn().nullable(),x1:Kn(),x2:Kn(),y1:Kn(),y2:Kn(),bend:Kn().optional()}),XFe=Tc({_type:rd("draw"),color:id,fill:V1.optional(),note:Qn(),shapeId:Qn()}).meta({title:"Draw Shape",description:"A draw shape is a freeform shape that was drawn by the pen tool. To create new draw shapes, the AI must use the pen event because it gives more control."}),ZFe=Tc({_type:rd("unknown"),note:Qn(),shapeId:Qn(),subType:Qn(),x:Kn(),y:Kn()}).meta({title:"Unknown Shape",description:"A special shape that is not represented by one of the canvas's core shape types. The AI cannot create these shapes, but it *can* interact with them. eg: The AI can move these shapes. The `subType` property contains the internal name of the shape's type."}),Zne=[XFe,VFe,KFe,GFe,YFe,qFe,ZFe],Jne=H1(Zne);function JFe(){const t=[];for(const e of Zne){const n=e.shape._type;n&&("value"in n&&typeof n.value=="string"?t.push(n.value):"options"in n&&Array.isArray(n.options)&&t.push(...n.options))}return t}const QFe=he.object({_type:he.literal("create"),intent:he.string(),shape:Jne}).meta({title:"Create",description:"The AI creates a new shape."});class e3e extends Nn{static type="create";getSchema(){return QFe}getInfo(e){return{icon:"pencil",description:e.intent??""}}sanitizeAction(e,n){if(!e.complete)return e;const{shape:r}=e;return r.shapeId=n.ensureShapeIdIsUnique(r.shapeId),r._type==="arrow"&&(r.fromId&&(r.fromId=n.ensureShapeIdExists(r.fromId)),r.toId&&(r.toId=n.ensureShapeIdExists(r.toId))),e}applyAction(e,n){if(!e.complete||!this.agent)return;const{editor:r}=this.agent;e.shape=n.removeOffsetFromShape(e.shape);const i=Yne(r,e.shape,{defaultShape:t3e(e.shape._type)});if(r.createShape(i.shape),i.bindings)for(const o of i.bindings)r.createBinding({type:o.type,fromId:o.fromId,toId:o.toId,props:o.props,meta:o.meta})}}function t3e(t){return t in Xne?XP.geo:XP[t]??XP.unknown}const Cd={isLocked:!1,opacity:1,rotation:0,meta:{}},XP={text:{...Cd,props:{autoSize:!0,color:"black",font:"draw",richText:dn(""),scale:1,size:"s",textAlign:"start",w:0}},line:{...Cd,props:{size:"s",color:"black",dash:"draw",points:{a1:{id:"a1",index:"a1",x:0,y:0},a2:{id:"a2",index:"a2",x:100,y:0}},scale:1,spline:"line"}},arrow:{...Cd,props:{arrowheadEnd:"arrow",arrowheadStart:"none",bend:0,color:"black",dash:"draw",elbowMidPoint:.5,end:{x:100,y:0},fill:"none",font:"draw",kind:"arc",labelColor:"black",labelPosition:.5,richText:dn(""),scale:1,size:"s",start:{x:0,y:0}}},geo:{...Cd,props:{align:"middle",color:"black",dash:"draw",fill:"none",font:"draw",geo:"rectangle",growY:0,h:100,labelColor:"black",richText:dn(""),scale:1,size:"s",url:"",verticalAlign:"middle",w:100}},note:{...Cd,props:{color:"black",richText:dn(""),size:"s",align:"middle",font:"draw",fontSizeAdjustment:0,growY:0,labelColor:"black",scale:1,url:"",verticalAlign:"middle"}},draw:{...Cd,props:{}},unknown:{...Cd,props:{}}},n3e=he.object({_type:he.literal("delete"),intent:he.string(),shapeId:he.string()}).meta({title:"Delete",description:"The AI deletes a shape."});class r3e extends Nn{static type="delete";getSchema(){return n3e}getInfo(e){return{icon:"trash",description:e.intent??"",canGroup:n=>n._type==="delete"}}sanitizeAction(e,n){if(!e.complete)return e;const r=n.ensureShapeIdExists(e.shapeId);return r?(e.shapeId=r,e):null}applyAction(e){e.complete&&this.agent&&this.agent.editor.deleteShape(`shape:${e.shapeId}`)}}const i3e=he.object({_type:he.literal("distribute"),direction:he.enum(["horizontal","vertical"]),intent:he.string(),shapeIds:he.array(he.string())}).meta({title:"Distribute",description:"The AI distributes shapes horizontally or vertically."});class o3e extends Nn{static type="distribute";getSchema(){return i3e}getInfo(e){return{icon:"cursor",description:e.intent??""}}sanitizeAction(e,n){return e.shapeIds=n.ensureShapeIdsExist(e.shapeIds??[]),e}applyAction(e){e.complete&&this.agent&&this.agent.editor.distributeShapes(e.shapeIds.map(n=>`shape:${n}`),e.direction)}}const s3e=he.object({_type:he.literal("label"),intent:he.string(),shapeId:he.string(),text:he.string()}).meta({title:"Label",description:"The AI changes a shape's text."});class a3e extends Nn{static type="label";getSchema(){return s3e}getInfo(e){return{icon:"pencil",description:e.intent??""}}sanitizeAction(e,n){if(!e.complete)return e;const r=n.ensureShapeIdExists(e.shapeId);return r?(e.shapeId=r,e):null}applyAction(e){if(!e.complete||!this.agent)return;const{editor:n}=this.agent,r=`shape:${e.shapeId}`,i=n.getShape(r);i&&n.updateShape({id:r,type:i.type,props:{richText:dn(e.text??"")}})}}const l3e=he.object({_type:he.literal("message"),text:he.string()}).meta({title:"Message",description:"The AI sends a message to the user."});class c3e extends Nn{static type="message";getSchema(){return l3e}getInfo(e){return{description:e.text??"",canGroup:()=>!1}}}const u3e=he.object({_type:he.literal("move"),intent:he.string(),shapeId:he.string(),x:he.number(),y:he.number()}).meta({title:"Move",description:"The AI moves a shape to a new position."});class d3e extends Nn{static type="move";getSchema(){return u3e}getInfo(e){return{icon:"cursor",description:e.intent??""}}sanitizeAction(e,n){if(!e.complete)return e;const r=n.ensureShapeIdExists(e.shapeId);if(!r)return null;e.shapeId=r;const i=n.ensureValueIsNumber(e.x),o=n.ensureValueIsNumber(e.y);return i===null||o===null?null:(e.x=i,e.y=o,e)}applyAction(e,n){if(!e.complete||!this.agent)return;const{editor:r}=this.agent,{x:i,y:o}=n.removeOffsetFromVec({x:e.x,y:e.y}),s=`shape:${e.shapeId}`,a=r.getShape(s);if(!a)return;const l=r.getShapePageBounds(s);if(!l)return;const c=new T(i,o),d=new T(a.x,a.y),u=new T(l.minX,l.minY),p=d.sub(u),f=c.add(p);r.updateShape({id:s,type:a.type,x:f.x,y:f.y})}}const h3e=he.object({_type:he.literal("pen"),color:id,closed:he.boolean(),fill:V1,intent:he.string(),points:he.array(he.object({x:he.number(),y:he.number()})),style:he.enum(["smooth","straight"])}).meta({title:"Pen",description:'The AI draws a freeform line with a pen. This is useful for drawing custom paths that are not available with the other available shapes. The "smooth" style will automatically smooth the line between points. The "straight" style will render a straight line between points. The "closed" property will determine if the drawn line gets automatically closed to form a complete shape or not. Remember that the pen will be *down* until the action is over. If you want to lift up the pen, start a new pen action.'});class p3e extends Nn{static type="pen";getSchema(){return h3e}getInfo(e){return{icon:"pencil",description:e.intent??""}}sanitizeAction(e,n){if(!e.points)return e;const r=e.points.map(i=>n.ensureValueIsVec(i)).filter(i=>i!==null);return e.points=r,e.closed=n.ensureValueIsBoolean(e.closed)??!1,e.fill=n.ensureValueIsSimpleFill(e.fill)??"none",e}applyAction(e,n){if(!this.agent||!e.points||e.points.length===0)return;if(e.points=e.points.map(l=>n.removeOffsetFromVec(l)),e.closed){const l=e.points[0];e.points.push(l)}const r=Math.min(...e.points.map(l=>l.x)),i=Math.min(...e.points.map(l=>l.y)),o=[],s=e.style==="smooth"?10:2;for(let l=0;l<e.points.length-1;l++){const c=e.points[l];o.push(c);const d=e.points[l+1];if(!d)continue;const u=T.Dist(c,d),p=Math.floor(u/s),f=Array.from({length:p},(y,v)=>{const x=(v+1)/(p+1);return T.Lrp(c,d,x)});o.push(...f)}if(o.length===0)return;const a=[{type:"free",points:o.map(l=>({x:l.x-r,y:l.y-i,z:.75}))}];this.agent.editor.createShape({id:sn(),type:"draw",x:r,y:i,props:{color:Dh(e.color??"black"),fill:Ry(e.fill??"none"),dash:"draw",size:"s",segments:a,isComplete:e.complete,isClosed:e.closed,isPen:!0}})}}const f3e=he.object({_type:he.literal("place"),align:he.enum(["start","center","end"]),alignOffset:he.number(),intent:he.string(),referenceShapeId:he.string(),side:he.enum(["top","bottom","left","right"]),sideOffset:he.number(),shapeId:he.string()}).meta({title:"Place",description:"The AI places a shape relative to another shape."});class g3e extends Nn{static type="place";getSchema(){return f3e}getInfo(e){return{icon:"target",description:e.intent??""}}sanitizeAction(e,n){if(!e.complete)return e;const r=n.ensureShapeIdExists(e.shapeId);if(!r)return null;e.shapeId=r;const i=n.ensureShapeIdExists(e.referenceShapeId);return i?(e.referenceShapeId=i,e):null}applyAction(e){if(!e.complete||!this.agent)return;const{editor:n}=this.agent,{side:r,sideOffset:i=0,align:o,alignOffset:s=0}=e,a=`shape:${e.referenceShapeId}`,l=`shape:${e.shapeId}`,c=n.getShape(l),d=n.getShape(a);if(!c||!d)return;const u=n.getShapePageBounds(c),p=n.getShapePageBounds(d);r==="top"&&o==="start"?n.updateShape({id:l,type:c.type,x:p.minX+s,y:p.minY-u.height-i}):r==="top"&&o==="center"?n.updateShape({id:l,type:c.type,x:p.midX-u.width/2+s,y:p.minY-u.height-i}):r==="top"&&o==="end"?n.updateShape({id:l,type:c.type,x:p.maxX-u.width-s,y:p.minY-u.height-i}):r==="bottom"&&o==="start"?n.updateShape({id:l,type:c.type,x:p.minX+s,y:p.maxY+i}):r==="bottom"&&o==="center"?n.updateShape({id:l,type:c.type,x:p.midX-u.width/2+s,y:p.maxY+i}):r==="bottom"&&o==="end"?n.updateShape({id:l,type:c.type,x:p.maxX-u.width-s,y:p.maxY+i}):r==="left"&&o==="start"?n.updateShape({id:l,type:c.type,x:p.minX-u.width-i,y:p.minY+s}):r==="left"&&o==="center"?n.updateShape({id:l,type:c.type,x:p.minX-u.width-i,y:p.midY-u.height/2+s}):r==="left"&&o==="end"?n.updateShape({id:l,type:c.type,x:p.minX-u.width-i,y:p.maxY-u.height-s}):r==="right"&&o==="start"?n.updateShape({id:l,type:c.type,x:p.maxX+i,y:p.minY+s}):r==="right"&&o==="center"?n.updateShape({id:l,type:c.type,x:p.maxX+i,y:p.midY-u.height/2+s}):r==="right"&&o==="end"&&n.updateShape({id:l,type:c.type,x:p.maxX+i,y:p.maxY-u.height-s})}}const m3e=he.object({_type:he.literal("getInspiration")}).meta({title:"Get inspiration",description:"The AI gets inspiration from a random Wikipedia article."});class y3e extends Nn{static type="getInspiration";getSchema(){return m3e}getInfo(e){return{icon:"search",description:e.complete?"Got random Wikipedia article":"Getting random Wikipedia article"}}async applyAction(e,n){if(!e.complete||!this.agent)return;const r=await v3e();this.agent.schedule({data:[r]})}}async function v3e(){const t=await fetch("https://en.wikipedia.org/api/rest_v1/page/random/summary",{headers:{"User-Agent":"tldraw"}});if(!t.ok)throw new Error(`Wikipedia API returned status ${t.status}, ${t.statusText}`);const e=await t.json();return{title:e.title,extract:e.extract,url:e.content_urls.desktop.page,pageId:e.pageid}}const x3e=he.object({_type:he.literal("resize"),intent:he.string(),originX:he.number(),originY:he.number(),scaleX:he.number(),scaleY:he.number(),shapeIds:he.array(he.string())}).meta({title:"Resize",description:"The AI resizes one or more shapes, with the resize operation being performed relative to an origin point."});class S3e extends Nn{static type="resize";getSchema(){return x3e}getInfo(e){return{icon:"cursor",description:e.intent??""}}sanitizeAction(e,n){const r=n.ensureShapeIdsExist(e.shapeIds??[]);return r.length===0?null:(e.shapeIds=r,e)}applyAction(e,n){if(!this.agent||!e.shapeIds||!e.scaleX||!e.scaleY||!e.originX||!e.originY)return;const r=n.removeOffsetFromVec({x:e.originX,y:e.originY}),i=e.shapeIds.map(o=>`shape:${o}`);for(const o of i)this.agent.editor.resizeShape(o,{x:e.scaleX,y:e.scaleY},{scaleOrigin:r})}}const b3e=he.object({_type:he.literal("review"),intent:he.string(),x:he.number(),y:he.number(),w:he.number(),h:he.number()}).meta({title:"Review",description:"The AI schedules further work or a review so that it can look at the results of its work so far and take further action, such as reviewing what it has done or taking further steps that would benefit from seeing the results of its work so far."});class w3e extends Nn{static type="review";getSchema(){return b3e}getInfo(e){const n=e.complete?"Review":"Reviewing",r=e.intent?.startsWith("#")?`

${e.intent}`:e.intent;return{icon:"search",description:`**${n}:** ${r??""}`}}applyAction(e,n){if(!e.complete||!this.agent)return;const r=n.removeOffsetFromBox({x:e.x,y:e.y,w:e.w,h:e.h}),i={type:"area",bounds:r,source:"agent"},o=this.agent.$scheduledRequest.get(),s=o?pe.From(o.bounds).union(r):r;this.agent.schedule({bounds:s,message:k3e(e.intent),contextItems:[i]})}}function k3e(t){return`Examine the actions that you (the agent) took since the most recent user message, with the intent: "${t}". What's next?

- Are you awaiting a response from the user? If so, there's no need to do or say anything.
- Is there still more work to do? If so, continue it.
- Is the task supposed to be complete? If so, it's time to review the results of that. Did you do what the user asked for? Did the plan work? Think through your findings and pay close attention to the image, because that's what you can see right now. If you make any corrections, let the user know what you did and why. If no corrections are needed, there's no need to say anything.
- Make sure to reference your last actions (denoted by [ACTION]) in order to see if you completed the task. Assume each action you see in the chat history completed successfully.`}const I3e=he.object({_type:he.literal("rotate"),centerY:he.number(),degrees:he.number(),intent:he.string(),originX:he.number(),originY:he.number(),shapeIds:he.array(he.string())}).meta({title:"Rotate",description:"The AI rotates one or more shapes around an origin point."});class _3e extends Nn{static type="rotate";getSchema(){return I3e}getInfo(e){return{icon:"cursor",description:e.intent??""}}sanitizeAction(e,n){return e.shapeIds=n.ensureShapeIdsExist(e.shapeIds??[]),e}applyAction(e,n){if(!this.agent||!e.shapeIds||!e.degrees||!e.originX||!e.originY)return;const r=n.removeOffsetFromVec({x:e.originX,y:e.originY}),i=e.shapeIds.map(s=>`shape:${s}`),o=e.degrees*Math.PI/180;this.agent.editor.rotateShapesBy(i,o,{center:r})}}const C3e=he.object({_type:he.literal("sendToBack"),intent:he.string(),shapeIds:he.array(he.string())}).meta({title:"Send to Back",description:"The AI sends one or more shapes to the back so that they appear behind everything else."});class P3e extends Nn{static type="sendToBack";getSchema(){return C3e}getInfo(e){return{icon:"cursor",description:e.intent??""}}sanitizeAction(e,n){return e.shapeIds=n.ensureShapeIdsExist(e.shapeIds??[]),e}applyAction(e){this.agent&&e.shapeIds&&this.agent.editor.sendToBack(e.shapeIds.map(n=>`shape:${n}`))}}const T3e=he.object({_type:he.literal("setMyView"),intent:he.string(),x:he.number(),y:he.number(),w:he.number(),h:he.number()}).meta({title:"Set My View",description:"The AI changes the bounds of its own viewport to navigate to other areas of the canvas if needed."});class E3e extends Nn{static type="setMyView";getSchema(){return T3e}getInfo(e){const n=e.complete?"Move camera":"Moving camera",r=e.intent?.startsWith("#")?`

${e.intent}`:e.intent;return{icon:"eye",description:`**${n}**: ${r??""}`}}applyAction(e,n){if(!e.complete||!this.agent)return;const r=n.removeOffsetFromBox({x:e.x,y:e.y,w:e.w,h:e.h});this.agent.schedule({bounds:r})}}const A3e=he.object({_type:he.literal("stack"),direction:he.enum(["vertical","horizontal"]),gap:he.number(),intent:he.string(),shapeIds:he.array(he.string())}).meta({title:"Stack",description:"The AI stacks shapes horizontally or vertically. Note that this doesn't align shapes, it only stacks them along one axis."});class M3e extends Nn{static type="stack";getSchema(){return A3e}getInfo(e){return{icon:"cursor",description:e.intent??""}}sanitizeAction(e,n){return e.complete&&(e.shapeIds=n.ensureShapeIdsExist(e.shapeIds)),e}applyAction(e){e.complete&&this.agent&&this.agent.editor.stackShapes(e.shapeIds.map(n=>`shape:${n}`),e.direction,Math.min(e.gap,1))}}const O3e=he.object({_type:he.literal("think"),text:he.string()}).meta({title:"Think",description:"The AI describes its intent or reasoning."});class D3e extends Nn{static type="think";getSchema(){return O3e}getInfo(e){const n=Math.floor(e.time/1e3);let r=`Thought for ${n} seconds`;return n===0&&(r="Thought for less than a second"),n===1&&(r="Thought for 1 second"),{icon:"brain",description:e.text??(e.complete?"Thinking...":null),summary:r}}}const j3e=Tc({_type:rd("update-todo-list"),id:Kn(),status:Oh(["todo","in-progress","done"]),text:Qn()}).meta({title:"Update Todo List",description:"The AI updates a current todo list item or creates a new one"});class R3e extends Nn{static type="update-todo-list";getSchema(){return j3e}getInfo(){return null}applyAction(e){if(!e.complete||!this.agent)return;const n={id:e.id,status:e.status,text:e.text};this.agent.$todoList.update(r=>{const i=r.findIndex(o=>o.id===e.id);return i!==-1?[...r.slice(0,i),n,...r.slice(i+1)]:[...r,n]})}}class $3e extends Nn{static type="unknown";getInfo(){return null}}const N3e=he.object({_type:he.literal("update"),intent:he.string(),update:Jne}).meta({title:"Update",description:"The AI updates an existing shape."});class L3e extends Nn{static type="update";getSchema(){return N3e}getInfo(e){return{icon:"cursor",description:e.intent??""}}sanitizeAction(e,n){if(!e.complete)return e;const{update:r}=e,i=n.ensureShapeIdExists(r.shapeId);return i?(r.shapeId=i,r._type==="arrow"&&(r.fromId&&(r.fromId=n.ensureShapeIdExists(r.fromId)),r.toId&&(r.toId=n.ensureShapeIdExists(r.toId))),e.update=n.unroundShape(e.update),e):null}applyAction(e,n){if(!e.complete||!this.agent)return;const{editor:r}=this.agent;e.update=n.removeOffsetFromShape(e.update);const i=Il(e.update.shapeId),o=r.getShape(i);if(!o)throw new Error(`Shape ${i} not found in canvas`);const s=Yne(r,e.update,{defaultShape:o});if(r.updateShape(s.shape),s.bindings){const a=r.getBindingsFromShape(i,"arrow");for(const l of a)r.deleteBinding(l.id);for(const l of s.bindings)r.createBinding({type:l.type,fromId:l.fromId,toId:l.toId,props:l.props,meta:l.meta})}}}function Au(t,e){switch(e.type){case"text":return F3e(t,e);case"geo":return B3e(t,e);case"line":return U3e(t,e);case"arrow":return H3e(t,e);case"note":return W3e(t,e);case"draw":return z3e(t,e);default:return V3e(t,e)}}function Qne(t){switch(t.type){case"geo":return ere[t.props.geo];case"text":case"line":case"arrow":case"note":case"draw":return t.type;default:return"unknown"}}const ere={rectangle:"rectangle",ellipse:"ellipse",triangle:"triangle",diamond:"diamond",hexagon:"hexagon",oval:"pill",cloud:"cloud","x-box":"x-box","check-box":"check-box",heart:"heart",pentagon:"pentagon",octagon:"octagon",star:"star",rhombus:"parallelogram-right","rhombus-2":"parallelogram-left",trapezoid:"trapezoid","arrow-right":"fat-arrow-right","arrow-left":"fat-arrow-left","arrow-up":"fat-arrow-up","arrow-down":"fat-arrow-down"};function Ec(t){return t.slice(6)}function z3e(t,e){return{_type:"draw",color:e.props.color,fill:qne(e.props.fill),note:e.meta.note??"",shapeId:Ec(e.id)}}function F3e(t,e){const r=t.getShapeUtil(e).getText(e)??"",i=qf(t,e),o=e.props.size,s=e.props.textAlign,a=e.props.w;let l=i.x;switch(s){case"middle":l=i.x+a/2;break;case"end":l=i.x+a;break;case"start":default:l=i.x;break}return{_type:"text",color:e.props.color,fontSize:RFe(o,e.props.scale),note:e.meta.note??"",shapeId:Ec(e.id),text:r,textAlign:e.props.textAlign,x:l,y:i.y}}function B3e(t,e){const r=t.getShapeUtil(e).getText(e),i=qf(t,e),o=e.props.align;let s;switch(o){case"start-legacy":s="start";break;case"middle-legacy":s="middle";break;case"end-legacy":s="end";break;default:s=o;break}return{_type:ere[e.props.geo],color:e.props.color,fill:qne(e.props.fill),h:e.props.h,note:e.meta.note??"",shapeId:Ec(e.id),text:r??"",textAlign:s,w:e.props.w,x:i.x,y:i.y}}function U3e(t,e){const n=qf(t,e),r=Object.values(e.props.points).sort((i,o)=>i.index.localeCompare(o.index));return{_type:"line",color:e.props.color,note:e.meta.note??"",shapeId:Ec(e.id),x1:r[0].x+n.x,x2:r[1].x+n.x,y1:r[0].y+n.y,y2:r[1].y+n.y}}function H3e(t,e){const n=qf(t,e),i=t.store.query.records("binding").get().filter(a=>a.type==="arrow"&&a.fromId===e.id),o=i.find(a=>a.props.terminal==="start"),s=i.find(a=>a.props.terminal==="end");return{_type:"arrow",bend:e.props.bend,color:e.props.color,fromId:o?.toId??null,note:e.meta.note??"",shapeId:Ec(e.id),text:e.meta.text??"",toId:s?.toId??null,x1:e.props.start.x+n.x,x2:e.props.end.x+n.x,y1:e.props.start.y+n.y,y2:e.props.end.y+n.y}}function W3e(t,e){const r=t.getShapeUtil(e).getText(e),i=qf(t,e);return{_type:"note",color:e.props.color,note:e.meta.note??"",shapeId:Ec(e.id),text:r??"",x:i.x,y:i.y}}function V3e(t,e){const n=qf(t,e);return{_type:"unknown",note:e.meta.note??"",shapeId:Ec(e.id),subType:e.type,x:n.x,y:n.y}}function qf(t,e){const n=t.getShapePageBounds(e);if(n)return n;let r;const i=t.store.extractingChanges(()=>{t.run(()=>{const s=sn();t.createShape({id:s,type:e.type,props:e.props,meta:e.meta}),r=t.getShapePageBounds(s)},{ignoreShapeLock:!1,history:"ignore"})}),o=lf(i);if(t.store.applyDiff(o),!r)throw new Error("Failed to get bounds for shape");return r}function K3e(t,e){const n=t.getShapeMaskedPageBounds(e);if(!n)return null;const i=t.getShapeUtil(e).getText(e),o=Qne(e);return{x:Math.round(n.x),y:Math.round(n.y),w:Math.round(n.w),h:Math.round(n.h),type:o,shapeId:Ec(e.id),text:i}}class Qo{static type;agent;editor;constructor(e){this.agent=e,this.editor=e?.editor}getPriority(e){return 0}getModelName(e){return null}buildContent(e){return[]}buildMessages(e){const n=this.buildContent(e);if(!n||n.length===0)return[];const r=[];for(const i of n)typeof i=="string"&&i.startsWith("data:image/")?r.push({type:"image",image:i}):r.push({type:"text",text:i});return[{role:"user",content:r,priority:this.getPriority(e)}]}buildSystemPrompt(e){return null}}class q3e extends Qo{static type="blurryShapes";getPriority(){return 70}getPart(e,n){if(!this.agent)return{type:"blurryShapes",shapes:null};const{editor:r}=this.agent,i=r.getCurrentPageShapesSorted(),o=pe.From(e.bounds);return{type:"blurryShapes",shapes:i.filter(c=>{if(!r)return!1;const d=r.getShapeMaskedPageBounds(c);return d?o.includes(d):!1}).map(c=>r?K3e(r,c):null).filter(c=>c!==null).map(c=>{const d=n.roundBox(n.applyOffsetToBox({x:c.x,y:c.y,w:c.w,h:c.h}));return{...c,x:d.x,y:d.y,w:d.w,h:d.h}})}}buildContent({shapes:e}){return!e||e.length===0?["There are no shapes in your view at the moment."]:["These are the shapes you can currently see:",JSON.stringify(e)]}}class G3e extends Qo{static type="chatHistory";getPriority(){return 1/0}async getPart(e,n){if(!this.agent)return{type:"chatHistory",items:null};const r=fn(this.agent.$chatHistory.get());for(const i of r){if(i.type!=="prompt")continue;const o=i.contextItems.map(s=>{const a=n.applyOffsetToContextItem(s);return n.roundContextItem(a)});i.contextItems=o}return{type:"chatHistory",items:r}}buildMessages({items:e}){if(!e)return[];const n=[],r=this.getPriority(),i=e.length-1;let o=e.length;o>0&&e[i].type==="prompt"&&(o=i);for(let s=0;s<o;s++){const a=e[s],l=this.buildHistoryItemMessage(a,r);l&&n.push(l)}return n}buildHistoryItemMessage(e,n){switch(e.type){case"prompt":{const r=[];if(e.message.trim()!==""&&r.push({type:"text",text:e.message}),e.contextItems.length>0)for(const i of e.contextItems)switch(i.type){case"shape":{const o=i.shape;r.push({type:"text",text:`[CONTEXT]: ${JSON.stringify(o)}`});break}case"shapes":{const o=i.shapes;r.push({type:"text",text:`[CONTEXT]: ${JSON.stringify(o)}`});break}default:{r.push({type:"text",text:`[CONTEXT]: ${JSON.stringify(i)}`});break}}return r.length===0?null:{role:"user",content:r,priority:n}}case"continuation":return e.data.length===0?null:{role:"assistant",content:[{type:"text",text:`[DATA RETRIEVED]: ${JSON.stringify(e.data)}`}],priority:n};case"action":{const{action:r}=e;let i;switch(r._type){case"message":{i=r.text||"<message data lost>";break}case"think":{i="[THOUGHT]: "+(r.text||"<thought data lost>");break}default:{const{complete:o,time:s,...a}=r||{};i="[ACTION]: "+JSON.stringify(a);break}}return{role:"assistant",content:[{type:"text",text:i}],priority:n}}}}}class Y3e extends Qo{static type="contextItems";getPriority(){return 60}getPart(e,n){return{type:"contextItems",items:e.contextItems.map(i=>{const o=n.applyOffsetToContextItem(i);return n.roundContextItem(o)}),requestType:e.type}}buildContent({items:e,requestType:n}){const r=[],i=e.filter(l=>l.type==="shape"),o=e.filter(l=>l.type==="shapes"),s=e.filter(l=>l.type==="area"),a=e.filter(l=>l.type==="point");if(s.length>0){const l=n==="schedule",c=s.map(d=>d.bounds);r.push(l?"You are currently reviewing your work, and you have decided to focus your view on the following area. Make sure to focus your task here.":`The user has specifically brought your attention to the following areas in this request. The user might refer to them as the "area(s)" or perhaps "here" or "there", but either way, it's implied that you should focus on these areas in both your reasoning and actions. Make sure to focus your task on these areas:`);for(const d of c)r.push(JSON.stringify(d))}if(a.length>0){const l=a.map(c=>c.point);r.push(`The user has specifically brought your attention to the following points in this request. The user might refer to them as the "point(s)" or perhaps "here" or "there", but either way, it's implied that you should focus on these points in both your reasoning and actions. Make sure to focus your task on these points:`);for(const c of l)r.push(JSON.stringify(c))}if(i.length>0){const l=i.map(c=>c.shape);r.push(`The user has specifically brought your attention to these ${l.length} shapes individually in this request. Make sure to focus your task on these shapes where applicable:`);for(const c of l)r.push(JSON.stringify(c))}for(const l of o){const c=l.shapes;c.length>0&&(r.push(`The user has specifically brought your attention to the following group of ${c.length} shapes in this request. Make sure to focus your task on these shapes where applicable:`),r.push(c.map(d=>JSON.stringify(d)).join(`
`)))}return r}}class X3e extends Qo{static type="data";getPriority(){return-200}async getPart(e){const{data:n}=e;return{type:"data",data:await Promise.all(n.map(async i=>{try{return await i}catch(o){return console.error("Error retrieving data:",o),"An error occurred while retrieving some data."}}))}}buildContent({data:e}){return e.length===0?[]:["Here's the data you requested:",...e.map(r=>`${JSON.stringify(r)}`)]}}class Z3e extends Qo{static type="messages";getPriority(){return-1/0}getPart(e){const{messages:n,type:r}=e;return{type:"messages",messages:n,requestType:r}}buildContent({messages:e,requestType:n}){let r=[];switch(n){case"user":r=J3e(e);break;case"schedule":r=Q3e(e);break;case"todo":r=e6e(e);break}return r}}function J3e(t){return["Using the events provided in the response schema, here's what I want you to do:",...t]}function Q3e(t){return["Using the events provided in the response schema, here's what you should do:",...t]}function e6e(t){return["There are still outstanding todo items. Please continue. For your reference, the most recent message I gave you was this:",...t]}class t6e extends Qo{static type="modelName";getPart(e){return{type:"modelName",name:e.modelName}}getModelName(e){return e.name}}function n6e(t,e,{padding:n=0}={}){if(e.length===0)return[];const r=[],i=e.map(o=>({shape:o,bounds:t.getShapeMaskedPageBounds(o).clone().expandBy(n)}));for(let o=0;o<i.length;o++){const s=i[o];if(o===0){r[0]={shapes:[s.shape],bounds:s.bounds,numberOfShapes:1};continue}let a=!1;for(const l of r)if(l.bounds.includes(s.bounds)){l.shapes.push(s.shape),l.bounds.expand(s.bounds),l.numberOfShapes++,a=!0;break}a||r.push({shapes:[s.shape],bounds:s.bounds,numberOfShapes:1})}return r.map(o=>({bounds:o.bounds.clone().expandBy(-n),numberOfShapes:o.numberOfShapes}))}class r6e extends Qo{static type="peripheralShapes";getPriority(){return 65}getPart(e,n){if(!this.agent)return{type:"peripheralShapes",clusters:null};const{editor:r}=this.agent,i=r.getCurrentPageShapesSorted(),o=e.bounds,s=pe.From(o),a=i.filter(d=>{if(!r)return!1;const u=r.getShapeMaskedPageBounds(d);if(u&&!s.includes(u))return!0});return{type:"peripheralShapes",clusters:n6e(r,a,{padding:75}).map(d=>{const u=n.applyOffsetToBox(d.bounds);return{numberOfShapes:d.numberOfShapes,bounds:n.roundBox(u)}})}}buildContent({clusters:e}){return!e||e.length===0?[]:["There are some groups of shapes in your peripheral vision, outside the your main view. You can't make out their details or content. If you want to see their content, you need to get closer. The groups are as follows",JSON.stringify(e)]}}class i6e extends Qo{static type="screenshot";getPriority(){return 40}async getPart(e){if(!this.agent)return{type:"screenshot",screenshot:null};const{editor:n}=this.agent,r=e.bounds,i=pe.From(r),o=n.getCurrentPageShapesSorted().filter(c=>{if(!n)return!1;const d=n.getShapeMaskedPageBounds(c);return d?i.includes(d):!1});if(o.length===0)return{type:"screenshot",screenshot:null};const s=Math.max(e.bounds.w,e.bounds.h),a=s>8e3?8e3/s:1,l=await n.toImage(o,{format:"jpeg",background:!0,bounds:pe.From(e.bounds),padding:0,pixelRatio:1,scale:a});return{type:"screenshot",screenshot:await Si.blobToDataUrl(l.blob)}}buildContent({screenshot:e}){return e?["Here is the part of the canvas that you can currently see at this moment. It is not a reference image.",e]:[]}}class o6e extends Qo{static type="selectedShapes";getPriority(){return 55}getPart(e,n){if(!this.agent)return{type:"selectedShapes",shapes:null};const{editor:r}=this.agent,i=r.getSelectedShapes().map(a=>fn(a))??[],o=[];for(const a of i){if(!a)continue;const l=Au(r,a);l&&o.push(l)}return{type:"selectedShapes",shapes:o.map(a=>{const l=n.applyOffsetToShape(a);return n.roundShape(l)})}}buildContent({shapes:e}){return!e||e.length===0?[]:["The user has selected these shapes. Focus your task on these shapes where applicable:",e.map(n=>JSON.stringify(n)).join(`
`)]}}function s6e(){const t=tre(),e=Object.values(t).map(i=>i.getSchema()).filter(i=>i!==null),n=he.union(e),r=he.object({actions:he.array(n)});return he.toJSONSchema(r,{reused:"ref"})}class a6e extends Qo{static type="system";getPart(){return{type:"system"}}buildSystemPrompt(e){return l6e()}}const uB=JFe();function l6e(){return`# System Prompt

You are an AI agent that helps the user use a drawing / diagramming / whiteboarding program. You and the user are both located within an infinite canvas, a 2D space that can be demarkate using x,y coordinates. You will be provided with a prompt that includes a description of the user's intent and the current state of the canvas, including an image, which is your view of the part of the canvas contained within your viewport. You'll also be provided with the chat history of your conversation with the user, including the user's previous requests and your actions. Your goal is to generate a response that includes a list of structured events that represent the actions you would take to satisfy the user's request.

You respond with structured JSON data based on a predefined schema.

## Schema Overview

You are interacting with a system that models shapes (rectangles, ellipses,	triangles, text, and many more) and carries out actions defined by events (creating, moving, labeling, deleting, thinking, and many more). Your response should include:

- **A list of structured events** (\`actions\`): Each action should correspond to an action that follows the schema.

For the full list of events, refer to the JSON schema.

## Shapes

Shapes can be:

${uB.map(t=>`- **${t.charAt(0).toUpperCase()+t.slice(1)} (\`${t}\`)**`).join(`
`)}

Each shape has:

- \`_type\` (one of ${uB.map(t=>`\`${t}\``).join(", ")})
- \`x\`, \`y\` (numbers, coordinates, the TOP LEFT corner of the shape) (except for arrows and lines, which have \`x1\`, \`y1\`, \`x2\`, \`y2\`)
- \`note\` (a description of the shape's purpose or intent) (invisible to the user)

Shapes may also have different properties depending on their type:

- \`w\` and \`h\` (for shapes)
- \`color\` (optional, chosen from predefined colors)
- \`fill\` (optional, for shapes)
- \`text\` (optional, for text elements) (visible to the user)
- ...and others

### Arrow Properties

Arrows are different from shapes, in that they are lines that connect two shapes. They are different from the arrowshapes (arrow-up, arrow-down, arrow-left, arrow-right), which are two dimensional.

Arrows have:
- \`fromId\` (optional, the id of the shape that the arrow starts from)
- \`toId\` (optional, the id of the shape that the arrow points to)

### Arrow and Line Properties

Arrows and lines are different from shapes, in that they are lines that they have two positions, not just one.

Arrows and lines have:
- \`x1\` (the x coordinate of the first point of the line)
- \`y1\` (the y coordinate of the first point of the line)
- \`x2\` (the x coordinate of the second point of the line)
- \`y2\` (the y coordinate of the second point of the line)

## Event Schema

Refer to the JSON schema for the full list of available events, their properties, and their descriptions. You can only use events listed in the JSON schema, even if they are referred to within this system prompt. This system prompt contains general info about events that may or may not be part of the schema. Don't be fooled: Use the schema as the source of truth on what is available. Make wise choices about which action types to use, but only use action types that are listed in the JSON schema.

## Rules

1. **Always return a valid JSON object conforming to the schema.**
2. **Do not generate extra fields or omit required fields.**
3. **Ensure each \`shapeId\` is unique and consistent across related events.**
4. **Use meaningful \`intent\` descriptions for all actions.**

## Useful notes

### General tips about the canvas

- The coordinate space is the same as on a website: 0,0 is the top left corner. The x-axis increases as you scroll to the right. The y-axis increases as you scroll down the canvas.
- The x and y define the top left corner of the shape. The shape's origin is in its top left corner.
- Note shapes are 50x50. They're sticky notes and are only suitable for tiny sentences. Use a geometric shape or text shape if you need to write more.

### Tips for creating and updating shapes

- When moving shapes:
	- Always use the \`move\` action to move a shape, never the \`update\` action.
- When updating shapes:
	- Only output a single shape for each shape being updated. We know what it should update from its shapeId.
- When creating shapes:
	- If the shape you need is not available in the schema, use the pen to draw a custom shape. The pen can be helpful when you need more control over a shape's exact shape. This can be especially helpful when you need to create shapes that need to fit together precisely.
	- Use the \`note\` field to provide context for each shape. This will help you in the future to understand the purpose of each shape.
	- Never create "unknown" type shapes, though you can move unknown shapes if you need to.
	- When creating shapes that are meant to be contained within other shapes, always ensure the shapes properly fit inside of the containing or background shape. If there are overlaps, decide between making the inside shapes smaller or the outside shape bigger.
- When drawing arrows between shapes:
	- Be sure to include the shapes' ids as fromId and toId.
	- Always ensure they are properly connected with bindings.
	- You can make the arrow curved by using the "bend" property. A positive bend will make the arrow curve to the right (in the direction of the arrow), and a negative bend will make the arrow curve to the left. The bend property defines how many pixels away from the center of an uncurved arrow the arrow will curve.
	- Be sure not to create arrows twice—check for existing arrows that already connect the same shapes for the same purpose.
	- Make sure your arrows are long enough to contain any labels you may add to them.
- Labels and text
	- Be careful with labels. Did the user ask for labels on their shapes? Did the user ask for a format where labels would be appropriate? If yes, add labels to shapes. If not, do not add labels to shapes. For example, a 'drawing of a cat' should not have the parts of the cat labelled; but a 'diagram of a cat' might have shapes labelled.
	- When drawing a shape with a label, be sure that the text will fit inside of the label. Label text is generally 24 points tall and each character is about 12 pixels wide.
	- You may also specify the alignment of the label text within the shape.
	- There are also standalone text shapes that you may encounter. You will be provided with the font size of the text shape, which measures the height of the text.
	- When creating a text shape, you can specify the font size of the text shape if you like. The default size is 24 points tall.
	- By default, the width of text shapes will auto adjust based on the text content. Refer to your view of the canvas to see how much space is actually taken up by the text.
	- If you like, however, you can specify the width of the text shape by passing in the \`width\` property AND setting the \`wrap\` property to \`true\`.
		- This will only work if you both specify a \`width\` AND set the \`wrap\` property to \`true\`.
		- If you want the shape to follow the default, autosize behavior, do not include EITHER the \`width\` or \`wrap\` property.
	- Text shapes can be aligned horizontally, either \`start\`, \`middle\`, or \`end\`. The default alignment is \`start\` if you do not specify an alignment.
		- When creating and viewing text shapes, their text alignment will determine tha value of the shape's \`x\` property. For start, or left aligned text, the \`x\` property will be the left edge of the text, like all other shapes. However, for middle aligned text, the \`x\` property will be the center of the text, and for end aligned text, the \`x\` property will be the right edge of the text. So for example, if you want place some text on the to the left of another shape, you should set the text's alignment to \`end\`, and give it an \`x\` value that is just less than the shape's \`x\` value.
		- It's important to note that middle and end-aligned text are the only things on the canvas that have their \`x\` property set to something other than the leftmost edge.
	- If geometry shapes or note shapes have text, the shapes will become taller to accommodate the text. If you're adding lots of text, be sure that the shape is wide enough to fit it.
	- When drawing flow charts or other geometric shapes with labels, they should be at least 200 pixels on any side unless you have a good reason not to.
- Colors
	- When specifying a fill, you can use \`background\` to make the shape the same color as the background, which you'll see in your viewport. It will either be white or black, depending on the theme of the canvas.
		- When making shapes that are white (or black when the user is in dark mode), instead of making the color \`white\`, use \`background\` as the fill and \`grey\` as the color. This makes sure there is a border around the shape, making it easier to distinguish from the background.

### Communicating with the user

- If you want to communicate with the user, use the \`message\` action.
- Use the \`review\` action to check your work.
- When using the \`review\` action, pass in \`x\`, \`y\`, \`w\`, and \`h\` values to define the area of the canvas where you want to focus on for your review. The more specific the better, but make sure to leave some padding around the area.
- Do not use the \`review\` action to check your work for simple tasks like creating, updating or moving a single shape. Assume you got it right.
- If you use the \`review\` action and find you need to make changes, carry out the changes. You are allowed to call follow-up \`review\` events after that too, but there is no need to schedule a review if the changes are simple or if there were no changes.
- Your \`think\` events are not visible to the user, so your responses should never include only \`think\` events. Use a \`message\` action to communicate with the user.

### Starting your work

- Use \`update-todo-list\` events liberally to keep an up to date list of your progress on the task at hand. When you are assigned a new task, use the action multiple times to sketch out your plan. You can then use the \`review\` action to check the todo list.
	- Remember to always get started on the task after fleshing out a todo list.
	- NEVER make a todo for waiting for the user to do something. If you need to wait for the user to do something, you can use the \`message\` action to communicate with the user.
- Use \`think\` events liberally to work through each step of your strategy.
- If the canvas is empty, place your shapes in the center of the viewport. A general good size for your content is 80% of the viewport tall, but if you need more space, feel free to use more space. The "setMyView" action can be used to move the camera, if you need to.
- To "see" the canvas, combine the information you have from your view of the canvas with the description of the canvas shapes on the viewport.
- Carefully plan which action types to use. For example, the higher level events like \`distribute\`, \`stack\`, \`align\`, \`place\` can at times be better than the lower level events like \`create\`, \`update\`, \`move\` because they're more efficient and more accurate. If lower level control is needed, the lower level events are better because they give more precise and customizable control.
- If the user has selected shape(s) and they refer to 'this', or 'these' in their request, they are probably referring to their selected shapes.

### Navigating the canvas

- Your viewport may be different from the user's viewport (you will be informed if this is the case).
- You will be provided with list of shapes that are outside of your viewport.
- You can use the \`setMyView\` action to change your viewport to navigate to other areas of the canvas if needed. This will provide you with an updated view of the canvas. You can also use this to functionally zoom in or out.
- Never send any events after you have used the \`setMyView\` action. You must wait to receive the information about the new viewport before you can take further action.
- Always make sure that any shapes you create or modify are within your viewport.

## Reviewing your work

- Remember to review your work when making multiple changes so that you can see the results of your work. Otherwise, you're flying blind.
- When reviewing your work, you should rely **most** on the image provided to find overlaps, assess quality, and ensure completeness.
- Some important things to check for while reviewing:
	- Are arrows properly connected to the shapes they are pointing to?
	- Are labels properly contained within their containing shapes?
	- Are labels properly positioned?
	- Are any shapes overlapping? If so, decide whether to move the shapes, labels, or both.
	- Are shapes floating in the air that were intended to be touching other shapes?
- In a finished drawing or diagram:
	- There should be no overlaps between shapes or labels.
	- Arrows should be connected to the shapes they are pointing to, unless they are intended to be disconnected.
	- Arrows should not overlap with other shapes.
	- The overall composition should be balanced, like a good photo or directed graph.

### Finishing your work

- Complete the task to the best of your ability. Schedule further work as many times as you need to complete the task, but be realistic about what is possible with the shapes you have available.
- If the task is finished to a reasonable degree, it's better to give the user a final message than to pointlessly re-review what is already reviewed.
- If there's still more work to do, you must \`review\` it. Otherwise it won't happen.
- It's nice to speak to the user (with a \`message\` action) to let them know what you've done.

### API data

- When you call an API, you must end your actions in order to get response. Don't worry, you will be able to continue working after that.
- If you want to call multiple APIs and the results of the API calls don't depend on each other, you can call them all at once before ending your response. This will help you get the results of the API calls faster.
- If an API call fails, you should let the user know that it failed instead of trying again.

## JSON Schema

This is the JSON schema for the events you can return. You must conform to this schema.

${JSON.stringify(s6e(),null,2)}`}class c6e extends Qo{static type="time";getPart(){return{type:"time",time:new Date().toLocaleTimeString()}}buildContent({time:e}){return["The user's current time is:",e]}}class u6e extends Qo{static type="todoList";getPriority(){return 10}getPart(e,n){return{type:"todoList",items:n.agent.$todoList.get()}}buildContent({items:e}){return e.length===0?["You have no todos yet. Use the `update-todo-list` event with a new id to create a todo."]:["Here is your current todo list:",JSON.stringify(e)]}}class d6e extends Qo{static type="userActionHistory";getPriority(){return 40}getPart(e,n){const{editor:r,agent:i}=n,o=i.$userActionHistory.get();i.$userActionHistory.set([]);const s={type:"userActionHistory",added:[],removed:[],updated:[]},a=Vy(o),{added:l,updated:c,removed:d}=a;for(const u of Object.values(l))u.typeName==="shape"&&s.added.push({shapeId:Ec(u.id),type:Qne(u)});for(const u of Object.values(d)){if(u.typeName!=="shape")continue;const p=Au(r,u);s.removed.push({shapeId:p.shapeId,type:p._type})}for(const[u,p]of Object.values(c)){if(u.typeName!=="shape"||p.typeName!=="shape")continue;const f=Au(r,u),y=Au(r,p),v=h6e(f,y);if(!v)continue;const x=n.applyOffsetToShapePartial(v.from),b=n.applyOffsetToShapePartial(v.to);s.updated.push({shapeId:y.shapeId,type:y._type,before:n.roundShapePartial(x),after:n.roundShapePartial(b)})}return s}buildContent(e){const{updated:n,removed:r,added:i}=e;return n.length===0&&r.length===0&&i.length===0?[]:["Since the previous request, the user has made the following changes to the canvas:",JSON.stringify(e)]}}function h6e(t,e){if(t._type!==e._type)return null;const n={from:{},to:{}};for(const r in e){const i=t[r],o=e[r];i!==o&&(n.from[r]=i,n.to[r]=o)}return n}class p6e extends Qo{static type="viewportBounds";getPriority(){return 75}getPart(e,n){if(!this.agent)return{type:"viewportBounds",userBounds:null,agentBounds:null};const r=this.agent.editor.getViewportPageBounds(),i=n.applyOffsetToBox(r),o=n.applyOffsetToBox(e.bounds);return{type:"viewportBounds",userBounds:n.roundBox(i),agentBounds:n.roundBox(o)}}buildContent({userBounds:e,agentBounds:n}){const r=n;if(!r||!e)return[];const i=AS(r.x,e.x,5)&&AS(r.y,e.y,5)&&AS(r.w,e.w,5)&&AS(r.h,e.h,5),o=pe.From(r),s=pe.From(e),a=o.contains(s),l=s.contains(o);let c="";i?c="is the same as":a?c="contains":l?c="is contained by":c=f6e(r,e);const d=["The bounds of the part of the canvas that you can currently see are:",JSON.stringify(n),`The user's view is ${c} your view.`];return i||d.push("The bounds of what the user can see are:",JSON.stringify(e)),d}}function AS(t,e,n){const r=Math.max(Math.abs(t),Math.abs(e),1);return Math.abs(t-e)<=n/100*r}function f6e(t,e){const n={x:t.x+t.w/2,y:t.y+t.h/2},r={x:e.x+e.w/2,y:e.y+e.h/2},i=r.x-n.x,o=r.y-n.y;if(Math.abs(i)<.001&&Math.abs(o)<.001)return"is concentric with";let a=Math.atan2(o,i)*180/Math.PI;return a<0&&(a+=360),a>=337.5||a<22.5?"to the right of":a>=22.5&&a<67.5?"to the bottom right of":a>=67.5&&a<112.5?"below":a>=112.5&&a<157.5?"to the bottom left of":a>=157.5&&a<202.5?"to the left of":a>=202.5&&a<247.5?"to the top left of":a>=247.5&&a<292.5?"above":a>=292.5&&a<337.5?"to the top right of":"is different from"}const g6e=[a6e,t6e,Z3e,X3e,Y3e,i6e,p6e,q3e,r6e,o6e,G3e,d6e,u6e,c6e],m6e=[c3e,D3e,w3e,bFe,R3e,E3e,e3e,r3e,L3e,a3e,d3e,g3e,_Fe,P3e,_3e,S3e,kFe,o3e,M3e,PFe,p3e,y3e,EFe,OFe,$3e];function y6e(t){const e={};for(const n of g6e)e[n.type]=new n(t);return e}function tre(t){const e={};for(const n of m6e)e[n.type]=new n(t);return e}const v6e="claude-4.5-sonnet",x6e={"claude-4.5-sonnet":{name:"claude-4.5-sonnet",id:"claude-sonnet-4-5",provider:"anthropic"},"claude-4-sonnet":{name:"claude-4-sonnet",id:"claude-sonnet-4-0",provider:"anthropic"},"claude-3.5-sonnet":{name:"claude-3.5-sonnet",id:"claude-3-5-sonnet-latest",provider:"anthropic"}},yh=new xme("agents",()=>[]);class S6e{editor;id;onError;$activeRequest=qt("activeRequest",null);$scheduledRequest=qt("scheduledRequest",null);$chatHistory=qt("chatHistory",[]);$chatOrigin=qt("chatOrigin",{x:0,y:0});$todoList=qt("todoList",[]);$userActionHistory=qt("userActionHistory",[]);$contextItems=qt("contextItems",[]);$modelName=qt("modelName",v6e);constructor({editor:e,id:n,onError:r}){this.editor=e,this.id=n,this.onError=r,yh.update(e,i=>[...i,this]),this.agentActionUtils=tre(this),this.promptPartUtils=y6e(this),this.unknownActionUtil=this.agentActionUtils.unknown,Jg(this.$chatHistory,`${n}:chat-history`),Jg(this.$chatOrigin,`${n}:chat-origin`),Jg(this.$modelName,`${n}:model-name`),Jg(this.$todoList,`${n}:todo-items`),Jg(this.$contextItems,`${n}:context-items`),this.stopRecordingFn=this.startRecordingUserActions()}dispose(){this.cancel(),this.stopRecordingUserActions(),yh.update(this.editor,e=>e.filter(n=>n.id!==this.id))}getAgentActionUtil(e){const n=this.getAgentActionUtilType(e);return this.agentActionUtils[n]}getAgentActionUtilType(e){return!e||!this.agentActionUtils[e]?"unknown":e}getPromptPartUtil(e){return this.promptPartUtils[e]}agentActionUtils;unknownActionUtil;promptPartUtils;getFullRequestFromInput(e){const n=this.getPartialRequestFromInput(e),r=this.$activeRequest.get();return{type:n.type??"user",messages:n.messages??[],data:n.data??[],selectedShapes:n.selectedShapes??[],contextItems:n.contextItems??[],bounds:n.bounds??r?.bounds??this.editor.getViewportPageBounds(),modelName:n.modelName??r?.modelName??this.$modelName.get()}}getPartialRequestFromInput(e){return typeof e=="string"?{messages:[e]}:Array.isArray(e)?{messages:e}:typeof e.messages=="string"?{...e,messages:[e.messages]}:typeof e.message=="string"?{...e,messages:[e.message,...e.messages??[]]}:e}async preparePrompt(e,n){const{promptPartUtils:r}=this,i=[];for(const o of Object.values(r)){const s=await o.getPart(fn(e),n);s&&i.push(s)}return Object.fromEntries(i.map(o=>[o.type,o]))}async prompt(e){const n=this.getFullRequestFromInput(e);await this.request(n);let r=this.$scheduledRequest.get();const i=this.$todoList.get().filter(s=>s.status!=="done");if(!r){if(i.length===0)return;r={messages:n.messages,contextItems:n.contextItems,bounds:n.bounds,modelName:n.modelName,selectedShapes:n.selectedShapes,data:n.data,type:"todo"}}const o=await Promise.all(r.data);this.$chatHistory.update(s=>[...s,{type:"continuation",data:o}]),this.$scheduledRequest.set(null),await this.prompt(r)}async request(e){const n=this.getFullRequestFromInput(e);this.$activeRequest.get()!==null&&this.cancel(),this.$activeRequest.set(n);const{promise:r,cancel:i}=b6e({agent:this,request:n});this.cancelFn=i,r.finally(()=>{this.cancelFn=null});const o=await r;return this.$activeRequest.set(null),o}schedule(e){const n=this.$scheduledRequest.get();if(!n){this.setScheduledRequest(e);return}const r=this.getPartialRequestFromInput(e);this.setScheduledRequest({type:"schedule",messages:[...n.messages,...r.messages??[]],contextItems:[...n.contextItems,...r.contextItems??[]],selectedShapes:[...n.selectedShapes,...r.selectedShapes??[]],data:[...n.data,...r.data??[]],bounds:r.bounds??n.bounds,modelName:r.modelName??n.modelName})}setScheduledRequest(e){if(e===null){this.$scheduledRequest.set(null);return}const n=this.getFullRequestFromInput(e);n.type="schedule",this.$scheduledRequest.set(n)}addTodo(e){const n=this.$todoList.get().length;return this.$todoList.update(r=>[...r,{id:n,status:"todo",text:e}]),n}act(e,n=new Gne(this)){const{editor:r}=this,i=this.getAgentActionUtil(e._type);this.isActing=!0;let o=null,s;try{s=r.store.extractingChanges(()=>{o=i.applyAction(fn(e),n)??null})}finally{this.isActing=!1}if(i.savesToHistory()){const a={type:"action",action:e,diff:s,acceptance:"pending"};this.$chatHistory.update(l=>{if(l.length===0)return[a];const c=l.at(-1);return c&&c.type==="action"&&!c.action.complete?[...l.slice(0,-1),a]:[...l,a]})}return{diff:s,promise:o}}cancelFn=null;cancel(){this.cancelFn?.(),this.$activeRequest.set(null),this.$scheduledRequest.set(null),this.cancelFn=null}reset(){this.cancel(),this.$contextItems.set([]),this.$todoList.set([]),this.$userActionHistory.set([]);const e=this.editor.getViewportPageBounds();this.$chatHistory.set([]),this.$chatOrigin.set({x:e.x,y:e.y})}isGenerating(){return this.$activeRequest.get()!==null}isActing=!1;startRecordingUserActions(){const{editor:e}=this,n=e.sideEffects.registerAfterCreateHandler("shape",(s,a)=>{if(a!=="user"||this.isActing)return;const l={added:{[s.id]:s},updated:{},removed:{}};this.$userActionHistory.update(c=>[...c,l])}),r=e.sideEffects.registerAfterDeleteHandler("shape",(s,a)=>{if(a!=="user"||this.isActing)return;const l={added:{},updated:{},removed:{[s.id]:s}};this.$userActionHistory.update(c=>[...c,l])}),i=e.sideEffects.registerAfterChangeHandler("shape",(s,a,l)=>{if(l!=="user"||this.isActing)return;const c={added:{},updated:{[s.id]:[s,a]},removed:{}};this.$userActionHistory.update(d=>[...d,c])});function o(){n(),r(),i()}return o}stopRecordingFn;stopRecordingUserActions(){this.stopRecordingFn?.()}addToContext(e){this.$contextItems.update(n=>{if(e.type==="shapes"){const r=I6e(e,n);return[...n,...r]}return this.hasContextItem(e)?n:[...n,fn(e)]})}removeFromContext(e){this.$contextItems.update(n=>n.filter(r=>e!==r))}hasContextItem(e){const n=this.$contextItems.get();if(n.some(r=>k6e(r,e)))return!0;if(e.type==="shape"){for(const r of n)if(r.type==="shapes"&&r.shapes.some(i=>i.shapeId===e.shape.shapeId))return!0}return!1}}function b6e({agent:t,request:e}){const{editor:n}=t;if(e.type==="user"){const c={type:"prompt",message:e.messages.join(`
`),contextItems:e.contextItems,selectedShapes:e.selectedShapes};t.$chatHistory.update(d=>[...d,c])}let r=!1;const i=new AbortController,o=i.signal,s=new Gne(t);return{promise:(async()=>{const c=await t.preparePrompt(e,s);let d=null;const u=[];try{for await(const p of w6e({prompt:c,signal:o})){if(r)break;n.run(()=>{const y=t.getAgentActionUtil(p._type).sanitizeAction(p,s);if(!y){d=null;return}if(d){const b=lf(d);n.store.applyDiff(b)}const{diff:v,promise:x}=t.act(y,s);x&&u.push(x),y.complete?d=null:d=v},{ignoreShapeLock:!1,history:"ignore"})}await Promise.all(u)}catch(p){if(p==="Cancelled by user"||p instanceof Error&&p.name==="AbortError")return;t.onError(p)}})(),cancel:()=>{r=!0,i.abort("Cancelled by user")}}}async function*w6e({prompt:t,signal:e}){const n=await fetch("/stream",{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"},signal:e});if(!n.body)throw Error("No body in response");const r=n.body.getReader(),i=new TextDecoder;let o="";try{for(;;){const{value:s,done:a}=await r.read();if(a)break;o+=i.decode(s,{stream:!0});const l=o.split(`

`);o=l.pop()||"";for(const c of l){const d=c.match(/^data: (.+)$/m);if(d)try{const u=JSON.parse(d[1]);if("error"in u)throw new Error(u.error);yield u}catch(u){throw new Error(u.message)}}}}finally{r.releaseLock()}}function k6e(t,e){if(t.type!==e.type)return!1;switch(t.type){case"shape":{const n=e;return t.shape.shapeId===n.shape.shapeId}case"shapes":{const n=e;return t.shapes.length!==n.shapes.length?!1:t.shapes.every(r=>n.shapes.find(i=>i.shapeId===r.shapeId))}case"area":{const n=e;return pe.Equals(t.bounds,n.bounds)}case"point":{const n=e;return T.Equals(t.point,n.point)}default:_6e(t)}}function I6e(t,e){const n=new Set;e.forEach(i=>{i.type==="shape"?n.add(i.shape.shapeId):i.type==="shapes"&&i.shapes.forEach(o=>{n.add(o.shapeId)})});const r=t.shapes.filter(i=>!n.has(i.shapeId));if(r.length>0){if(r.length===1){const o={type:"shape",shape:r[0],source:t.source};return[fn(o)]}const i={type:"shapes",shapes:r,source:t.source};return[fn(i)]}return[]}function Jg(t,e){const n=globalThis.localStorage;if(n){try{const r=n.getItem(e);if(r){const i=JSON.parse(r);t.set(i)}}catch{console.warn(`Couldn't load ${e} from localStorage`)}mo(`save ${e} to localStorage`,()=>{n.setItem(e,JSON.stringify(t.get()))})}}function _6e(t,e){const n=t;throw new Error(`Unknown switch case ${n}`)}function C6e(t,e="tldraw-agent"){const n=Nl(),r=I.useCallback(o=>{const s=typeof o=="string"?o:o instanceof Error&&o.message;n.addToast({title:"Error",description:s||"An error occurred",severity:"error"}),console.error(o)},[n]);return I.useMemo(()=>{const o=yh.get(t).find(s=>s.id===e);return o&&o.dispose(),new S6e({editor:t,id:e,onError:r})},[t,r,e])}function P6e(t){return g.jsx("svg",{width:11,height:11,viewBox:"0 0 11 11","aria-hidden":"false",...t,className:"tl-spinner",children:g.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[g.jsx("circle",{strokeOpacity:.25,cx:5.5,cy:5.5,r:4.5,stroke:"currentColor"}),g.jsx("path",{strokeLinecap:"round",d:"M10.5 5.5c0-2.5-2.5-4.5-4.5-4.5",stroke:"currentColor"})]})})}function nre(){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"chat-icon",children:[g.jsx("path",{d:"M12 18V5"}),g.jsx("path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4"}),g.jsx("path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5"}),g.jsx("path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77"}),g.jsx("path",{d:"M18 18a4 4 0 0 0 2-7.464"}),g.jsx("path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517"}),g.jsx("path",{d:"M6 18a4 4 0 0 1-2-7.464"}),g.jsx("path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77"})]})}function T6e(){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"chat-icon",children:[g.jsx("path",{d:"M18 6 6 18"}),g.jsx("path",{d:"m6 6 12 12"})]})}function E6e(){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 20 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"chat-icon",children:g.jsx("path",{d:"M4.037 4.688a.495.495 0 0 1 .651-.651l16 6.5a.5.5 0 0 1-.063.947l-6.124 1.58a2 2 0 0 0-1.438 1.435l-1.579 6.126a.5.5 0 0 1-.947.063z"})})}function A6e(){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"chat-icon ",children:[g.jsx("path",{d:"M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"}),g.jsx("path",{d:"M19 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"}),g.jsx("path",{d:"M5 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"})]})}function M6e(){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"chat-icon",children:[g.jsx("path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}),g.jsx("circle",{cx:"12",cy:"12",r:"3"})]})}function O6e(){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"chat-icon",children:[g.jsx("path",{d:"M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4"}),g.jsx("path",{d:"M2 6h4"}),g.jsx("path",{d:"M2 10h4"}),g.jsx("path",{d:"M2 14h4"}),g.jsx("path",{d:"M2 18h4"}),g.jsx("path",{d:"M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z"})]})}function D6e(){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"chat-icon",children:[g.jsx("path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}),g.jsx("path",{d:"m15 5 4 4"})]})}function j6e(){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"chat-icon",children:[g.jsx("path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}),g.jsx("path",{d:"M3 3v5h5"}),g.jsx("path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"}),g.jsx("path",{d:"M16 16h5v5"})]})}function R6e(){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"chat-icon",children:[g.jsx("path",{d:"m21 21-4.34-4.34"}),g.jsx("circle",{cx:"11",cy:"11",r:"8"})]})}function $6e(){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"chat-icon",children:[g.jsx("circle",{cx:"12",cy:"12",r:"10"}),g.jsx("line",{x1:"12",y1:"2",x2:"12",y2:"8"}),g.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"22"}),g.jsx("line",{x1:"2",y1:"12",x2:"8",y2:"12"}),g.jsx("line",{x1:"16",y1:"12",x2:"22",y2:"12"})]})}function N6e(){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"chat-icon",children:[g.jsx("path",{d:"M10 11v6"}),g.jsx("path",{d:"M14 11v6"}),g.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}),g.jsx("path",{d:"M3 6h18"}),g.jsx("path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})}const L6e={brain:g.jsx(nre,{}),pencil:g.jsx(D6e,{}),trash:g.jsx(N6e,{}),refresh:g.jsx(j6e,{}),search:g.jsx(R6e,{}),eye:g.jsx(M6e,{}),cursor:g.jsx(E6e,{}),target:g.jsx($6e,{}),ellipsis:g.jsx(A6e,{}),note:g.jsx(O6e,{}),cross:g.jsx(T6e,{})};function Rw({type:t}){return L6e[t]}function z6e({shapes:t,components:e={}}){const[n,r]=I.useState(null),[i,o]=I.useState(!1),s=I.useRef(null);return I.useEffect(()=>{const a=new IntersectionObserver(([c])=>{o(c.isIntersecting)},{rootMargin:"200px",threshold:0}),l=s.current;return l&&a.observe(l),()=>{l&&a.unobserve(l)}},[]),I.useEffect(()=>{if(!n||!i)return;n.updateInstanceState({isReadonly:!1}),n.setCameraOptions({isLocked:!1}),n.deleteShapes(n.getCurrentPageShapes()),n.createShapes(t),n.updateInstanceState({isReadonly:!0}),n.selectAll();const a=n.getSelectionPageBounds();a&&n.zoomToBounds(a,{inset:30}),n.selectNone(),n.setCameraOptions({isLocked:!0})},[t,n,i]),i?g.jsx("div",{ref:s,className:"tldraw-viewer",children:g.jsx(fJ,{children:g.jsx(R7,{autoFocus:!1,components:e??{},inferDarkMode:!1,onMount:r,shapeUtils:yO,bindingUtils:ZM,tools:B6e,textOptions:U6e,assetUrls:_w,initialState:"inspect"})})}):g.jsx("div",{ref:s,className:"tldraw-viewer"})}class F6e extends We{static id="inspect"}const B6e=[F6e],U6e={tipTapConfig:{extensions:Vf},addFontsFromNode:cO};function H6e({diff:t}){const e=I.useMemo(()=>W6e(t),[t]);return g.jsx(z6e,{shapes:e,components:{ShapeWrapper:V6e}})}function W6e(t){const e=[],r=Object.keys(t.added).length+Object.keys(t.updated).length+Object.keys(t.removed).length<20;for(const i in t.removed){const o=i,s=t.removed[o];if(s.typeName!=="shape")continue;const a={...s,opacity:r?s.opacity:s.opacity/2,props:{...s.props},meta:{...s.meta,changeType:r?"delete-shadow":"delete"}};"dash"in a.props&&(a.props.dash="solid"),e.push(a)}for(const i in t.updated){const o=i,s=t.updated[o][0],a=t.updated[o][1];if(s.typeName!=="shape"||a.typeName!=="shape")continue;const l={...s,id:o+"-before",opacity:a.opacity/2,props:{...s.props},meta:{...s.meta,changeType:r?"update-before-shadow":"update-before"}},c={...a,props:{...a.props},meta:{...a.meta,changeType:r?"update-after-shadow":"update-after"}};"dash"in l.props&&(l.props.dash="dashed"),"fill"in l.props&&(l.props.fill="none"),"dash"in c.props&&(c.props.dash="solid"),e.push(l),e.push(c)}for(const i in t.added){const o=i,s=t.added[o];if(s.typeName!=="shape")continue;const a={...s,props:{...s.props},meta:{...s.meta,changeType:r?"create-shadow":"create"}};"dash"in a.props&&(a.props.dash="solid"),e.push(a)}return e}const V6e=I.forwardRef(function({children:e,shape:n,isBackground:r},i){const o=n.meta.changeType;return g.jsx(U7,{ref:i,shape:n,isBackground:r,className:o?"diff-shape-"+o:void 0,children:e})});function vh(t,e){const r=e.getAgentActionUtil(t._type).getInfo(t)??{description:null},{icon:i=null,description:o=JSON.stringify(t,null,2),summary:s=null,canGroup:a=()=>!0}=r;return{icon:i,description:o,summary:s,canGroup:a}}function K6e({group:t,agent:e}){const{items:n}=t,{editor:r}=e,i=I.useMemo(()=>Vy(n.map(c=>c.diff)),[n]),o=I.useCallback(()=>{e.$chatHistory.update(c=>{const d=[...c];for(const u of n){const p=d.findIndex(f=>f===u);p!==-1&&(d[p]={...u,acceptance:"accepted"}),u.acceptance==="rejected"&&r.store.applyDiff(u.diff)}return d})},[n,r,e.$chatHistory]),s=I.useCallback(()=>{e.$chatHistory.update(c=>{const d=[...c];for(const u of n){const p=d.findIndex(f=>f===u);if(p!==-1&&(d[p]={...u,acceptance:"rejected"}),u.acceptance!=="rejected"){const f=lf(u.diff);r.store.applyDiff(f)}}return d})},[n,r,e.$chatHistory]),a=I.useMemo(()=>{if(n.length===0)return"pending";const c=n[0].acceptance;for(let d=1;d<n.length;d++)if(n[d].acceptance!==c)return"pending";return c},[n]),l=I.useMemo(()=>n.map(c=>vh(c.action,e)),[n,e]);return g.jsxs("div",{className:"chat-history-change",children:[g.jsxs("div",{className:"chat-history-change-acceptance",children:[g.jsx("button",{onClick:s,disabled:a==="rejected",children:a==="rejected"?"Rejected":"Reject"}),g.jsx("button",{onClick:o,disabled:a==="accepted",children:a==="accepted"?"Accepted":"Accept"})]}),g.jsx(q6e,{steps:l}),g.jsx(H6e,{diff:i})]})}function q6e({steps:t}){let e="";return g.jsx("div",{className:"agent-changes",children:t.map((n,r)=>!n.description||n.description===e?null:(e=n.description,g.jsxs("div",{className:"agent-change",children:[n.icon&&g.jsx("span",{className:"agent-change-icon",children:g.jsx(Rw,{type:n.icon})}),n.description]},"intent-"+r)))})}function G6e(t,e){const n={};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const Y6e=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,X6e=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,Z6e={};function dB(t,e){return(Z6e.jsx?X6e:Y6e).test(t)}const J6e=/[ \t\n\f\r]/g;function Q6e(t){return typeof t=="object"?t.type==="text"?hB(t.value):!1:hB(t)}function hB(t){return t.replace(J6e,"")===""}class Ov{constructor(e,n,r){this.normal=n,this.property=e,r&&(this.space=r)}}Ov.prototype.normal={};Ov.prototype.property={};Ov.prototype.space=void 0;function rre(t,e){const n={},r={};for(const i of t)Object.assign(n,i.property),Object.assign(r,i.normal);return new Ov(n,r,e)}function XE(t){return t.toLowerCase()}class es{constructor(e,n){this.attribute=n,this.property=e}}es.prototype.attribute="";es.prototype.booleanish=!1;es.prototype.boolean=!1;es.prototype.commaOrSpaceSeparated=!1;es.prototype.commaSeparated=!1;es.prototype.defined=!1;es.prototype.mustUseProperty=!1;es.prototype.number=!1;es.prototype.overloadedBoolean=!1;es.prototype.property="";es.prototype.spaceSeparated=!1;es.prototype.space=void 0;let eBe=0;const Et=jh(),Or=jh(),ZE=jh(),Oe=jh(),Cn=jh(),tf=jh(),fs=jh();function jh(){return 2**++eBe}const JE=Object.freeze(Object.defineProperty({__proto__:null,boolean:Et,booleanish:Or,commaOrSpaceSeparated:fs,commaSeparated:tf,number:Oe,overloadedBoolean:ZE,spaceSeparated:Cn},Symbol.toStringTag,{value:"Module"})),ZP=Object.keys(JE);class ij extends es{constructor(e,n,r,i){let o=-1;if(super(e,n),pB(this,"space",i),typeof r=="number")for(;++o<ZP.length;){const s=ZP[o];pB(this,ZP[o],(r&JE[s])===JE[s])}}}ij.prototype.defined=!0;function pB(t,e,n){n&&(t[e]=n)}function Gf(t){const e={},n={};for(const[r,i]of Object.entries(t.properties)){const o=new ij(r,t.transform(t.attributes||{},r),i,t.space);t.mustUseProperty&&t.mustUseProperty.includes(r)&&(o.mustUseProperty=!0),e[r]=o,n[XE(r)]=r,n[XE(o.attribute)]=r}return new Ov(e,n,t.space)}const ire=Gf({properties:{ariaActiveDescendant:null,ariaAtomic:Or,ariaAutoComplete:null,ariaBusy:Or,ariaChecked:Or,ariaColCount:Oe,ariaColIndex:Oe,ariaColSpan:Oe,ariaControls:Cn,ariaCurrent:null,ariaDescribedBy:Cn,ariaDetails:null,ariaDisabled:Or,ariaDropEffect:Cn,ariaErrorMessage:null,ariaExpanded:Or,ariaFlowTo:Cn,ariaGrabbed:Or,ariaHasPopup:null,ariaHidden:Or,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:Cn,ariaLevel:Oe,ariaLive:null,ariaModal:Or,ariaMultiLine:Or,ariaMultiSelectable:Or,ariaOrientation:null,ariaOwns:Cn,ariaPlaceholder:null,ariaPosInSet:Oe,ariaPressed:Or,ariaReadOnly:Or,ariaRelevant:null,ariaRequired:Or,ariaRoleDescription:Cn,ariaRowCount:Oe,ariaRowIndex:Oe,ariaRowSpan:Oe,ariaSelected:Or,ariaSetSize:Oe,ariaSort:null,ariaValueMax:Oe,ariaValueMin:Oe,ariaValueNow:Oe,ariaValueText:null,role:null},transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function ore(t,e){return e in t?t[e]:e}function sre(t,e){return ore(t,e.toLowerCase())}const tBe=Gf({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:tf,acceptCharset:Cn,accessKey:Cn,action:null,allow:null,allowFullScreen:Et,allowPaymentRequest:Et,allowUserMedia:Et,alt:null,as:null,async:Et,autoCapitalize:null,autoComplete:Cn,autoFocus:Et,autoPlay:Et,blocking:Cn,capture:null,charSet:null,checked:Et,cite:null,className:Cn,cols:Oe,colSpan:null,content:null,contentEditable:Or,controls:Et,controlsList:Cn,coords:Oe|tf,crossOrigin:null,data:null,dateTime:null,decoding:null,default:Et,defer:Et,dir:null,dirName:null,disabled:Et,download:ZE,draggable:Or,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:Et,formTarget:null,headers:Cn,height:Oe,hidden:ZE,high:Oe,href:null,hrefLang:null,htmlFor:Cn,httpEquiv:Cn,id:null,imageSizes:null,imageSrcSet:null,inert:Et,inputMode:null,integrity:null,is:null,isMap:Et,itemId:null,itemProp:Cn,itemRef:Cn,itemScope:Et,itemType:Cn,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:Et,low:Oe,manifest:null,max:null,maxLength:Oe,media:null,method:null,min:null,minLength:Oe,multiple:Et,muted:Et,name:null,nonce:null,noModule:Et,noValidate:Et,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:Et,optimum:Oe,pattern:null,ping:Cn,placeholder:null,playsInline:Et,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:Et,referrerPolicy:null,rel:Cn,required:Et,reversed:Et,rows:Oe,rowSpan:Oe,sandbox:Cn,scope:null,scoped:Et,seamless:Et,selected:Et,shadowRootClonable:Et,shadowRootDelegatesFocus:Et,shadowRootMode:null,shape:null,size:Oe,sizes:null,slot:null,span:Oe,spellCheck:Or,src:null,srcDoc:null,srcLang:null,srcSet:null,start:Oe,step:null,style:null,tabIndex:Oe,target:null,title:null,translate:null,type:null,typeMustMatch:Et,useMap:null,value:Or,width:Oe,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:Cn,axis:null,background:null,bgColor:null,border:Oe,borderColor:null,bottomMargin:Oe,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:Et,declare:Et,event:null,face:null,frame:null,frameBorder:null,hSpace:Oe,leftMargin:Oe,link:null,longDesc:null,lowSrc:null,marginHeight:Oe,marginWidth:Oe,noResize:Et,noHref:Et,noShade:Et,noWrap:Et,object:null,profile:null,prompt:null,rev:null,rightMargin:Oe,rules:null,scheme:null,scrolling:Or,standby:null,summary:null,text:null,topMargin:Oe,valueType:null,version:null,vAlign:null,vLink:null,vSpace:Oe,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:Et,disableRemotePlayback:Et,prefix:null,property:null,results:Oe,security:null,unselectable:null},space:"html",transform:sre}),nBe=Gf({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:fs,accentHeight:Oe,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:Oe,amplitude:Oe,arabicForm:null,ascent:Oe,attributeName:null,attributeType:null,azimuth:Oe,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:Oe,by:null,calcMode:null,capHeight:Oe,className:Cn,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:Oe,diffuseConstant:Oe,direction:null,display:null,dur:null,divisor:Oe,dominantBaseline:null,download:Et,dx:null,dy:null,edgeMode:null,editable:null,elevation:Oe,enableBackground:null,end:null,event:null,exponent:Oe,externalResourcesRequired:null,fill:null,fillOpacity:Oe,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:tf,g2:tf,glyphName:tf,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:Oe,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:Oe,horizOriginX:Oe,horizOriginY:Oe,id:null,ideographic:Oe,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:Oe,k:Oe,k1:Oe,k2:Oe,k3:Oe,k4:Oe,kernelMatrix:fs,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:Oe,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:Oe,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:Oe,overlineThickness:Oe,paintOrder:null,panose1:null,path:null,pathLength:Oe,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:Cn,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:Oe,pointsAtY:Oe,pointsAtZ:Oe,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:fs,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:fs,rev:fs,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:fs,requiredFeatures:fs,requiredFonts:fs,requiredFormats:fs,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:Oe,specularExponent:Oe,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:Oe,strikethroughThickness:Oe,string:null,stroke:null,strokeDashArray:fs,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:Oe,strokeOpacity:Oe,strokeWidth:null,style:null,surfaceScale:Oe,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:fs,tabIndex:Oe,tableValues:null,target:null,targetX:Oe,targetY:Oe,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:fs,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:Oe,underlineThickness:Oe,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:Oe,values:null,vAlphabetic:Oe,vMathematical:Oe,vectorEffect:null,vHanging:Oe,vIdeographic:Oe,version:null,vertAdvY:Oe,vertOriginX:Oe,vertOriginY:Oe,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:Oe,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:ore}),are=Gf({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()}}),lre=Gf({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:sre}),cre=Gf({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()}}),rBe={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},iBe=/[A-Z]/g,fB=/-[a-z]/g,oBe=/^data[-\w.:]+$/i;function sBe(t,e){const n=XE(e);let r=e,i=es;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&oBe.test(e)){if(e.charAt(4)==="-"){const o=e.slice(5).replace(fB,lBe);r="data"+o.charAt(0).toUpperCase()+o.slice(1)}else{const o=e.slice(4);if(!fB.test(o)){let s=o.replace(iBe,aBe);s.charAt(0)!=="-"&&(s="-"+s),e="data"+s}}i=ij}return new i(r,e)}function aBe(t){return"-"+t.toLowerCase()}function lBe(t){return t.charAt(1).toUpperCase()}const cBe=rre([ire,tBe,are,lre,cre],"html"),oj=rre([ire,nBe,are,lre,cre],"svg");function uBe(t){return t.join(" ").trim()}var Tp={},JP,gB;function dBe(){if(gB)return JP;gB=1;var t=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,e=/\n/g,n=/^\s*/,r=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,i=/^:\s*/,o=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,s=/^[;\s]*/,a=/^\s+|\s+$/g,l=`
`,c="/",d="*",u="",p="comment",f="declaration";JP=function(v,x){if(typeof v!="string")throw new TypeError("First argument must be a string");if(!v)return[];x=x||{};var b=1,w=1;function _(z){var $=z.match(e);$&&(b+=$.length);var V=z.lastIndexOf(l);w=~V?z.length-V:w+z.length}function C(){var z={line:b,column:w};return function($){return $.position=new A(z),D(),$}}function A(z){this.start=z,this.end={line:b,column:w},this.source=x.source}A.prototype.content=v;function E(z){var $=new Error(x.source+":"+b+":"+w+": "+z);if($.reason=z,$.filename=x.source,$.line=b,$.column=w,$.source=v,!x.silent)throw $}function O(z){var $=z.exec(v);if($){var V=$[0];return _(V),v=v.slice(V.length),$}}function D(){O(n)}function B(z){var $;for(z=z||[];$=L();)$!==!1&&z.push($);return z}function L(){var z=C();if(!(c!=v.charAt(0)||d!=v.charAt(1))){for(var $=2;u!=v.charAt($)&&(d!=v.charAt($)||c!=v.charAt($+1));)++$;if($+=2,u===v.charAt($-1))return E("End of comment missing");var V=v.slice(2,$-2);return w+=2,_(V),v=v.slice($),w+=2,z({type:p,comment:V})}}function j(){var z=C(),$=O(r);if($){if(L(),!O(i))return E("property missing ':'");var V=O(o),Y=z({type:f,property:y($[0].replace(t,u)),value:V?y(V[0].replace(t,u)):u});return O(s),Y}}function F(){var z=[];B(z);for(var $;$=j();)$!==!1&&(z.push($),B(z));return z}return D(),F()};function y(v){return v?v.replace(a,u):u}return JP}var mB;function hBe(){if(mB)return Tp;mB=1;var t=Tp&&Tp.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Tp,"__esModule",{value:!0}),Tp.default=n;const e=t(dBe());function n(r,i){let o=null;if(!r||typeof r!="string")return o;const s=(0,e.default)(r),a=typeof i=="function";return s.forEach(l=>{if(l.type!=="declaration")return;const{property:c,value:d}=l;a?i(c,d,l):d&&(o=o||{},o[c]=d)}),o}return Tp}var Qg={},yB;function pBe(){if(yB)return Qg;yB=1,Object.defineProperty(Qg,"__esModule",{value:!0}),Qg.camelCase=void 0;var t=/^--[a-zA-Z0-9_-]+$/,e=/-([a-z])/g,n=/^[^-]+$/,r=/^-(webkit|moz|ms|o|khtml)-/,i=/^-(ms)-/,o=function(c){return!c||n.test(c)||t.test(c)},s=function(c,d){return d.toUpperCase()},a=function(c,d){return"".concat(d,"-")},l=function(c,d){return d===void 0&&(d={}),o(c)?c:(c=c.toLowerCase(),d.reactCompat?c=c.replace(i,a):c=c.replace(r,a),c.replace(e,s))};return Qg.camelCase=l,Qg}var em,vB;function fBe(){if(vB)return em;vB=1;var t=em&&em.__importDefault||function(i){return i&&i.__esModule?i:{default:i}},e=t(hBe()),n=pBe();function r(i,o){var s={};return!i||typeof i!="string"||(0,e.default)(i,function(a,l){a&&l&&(s[(0,n.camelCase)(a,o)]=l)}),s}return r.default=r,em=r,em}var gBe=fBe();const mBe=ua(gBe),ure=dre("end"),sj=dre("start");function dre(t){return e;function e(n){const r=n&&n.position&&n.position[t]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function yBe(t){const e=sj(t),n=ure(t);if(e&&n)return{start:e,end:n}}function qm(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?xB(t.position):"start"in t||"end"in t?xB(t):"line"in t||"column"in t?QE(t):""}function QE(t){return SB(t&&t.line)+":"+SB(t&&t.column)}function xB(t){return QE(t&&t.start)+"-"+QE(t&&t.end)}function SB(t){return t&&typeof t=="number"?t:1}class no extends Error{constructor(e,n,r){super(),typeof n=="string"&&(r=n,n=void 0);let i="",o={},s=!1;if(n&&("line"in n&&"column"in n?o={place:n}:"start"in n&&"end"in n?o={place:n}:"type"in n?o={ancestors:[n],place:n.position}:o={...n}),typeof e=="string"?i=e:!o.cause&&e&&(s=!0,i=e.message,o.cause=e),!o.ruleId&&!o.source&&typeof r=="string"){const l=r.indexOf(":");l===-1?o.ruleId=r:(o.source=r.slice(0,l),o.ruleId=r.slice(l+1))}if(!o.place&&o.ancestors&&o.ancestors){const l=o.ancestors[o.ancestors.length-1];l&&(o.place=l.position)}const a=o.place&&"start"in o.place?o.place.start:o.place;this.ancestors=o.ancestors||void 0,this.cause=o.cause||void 0,this.column=a?a.column:void 0,this.fatal=void 0,this.file="",this.message=i,this.line=a?a.line:void 0,this.name=qm(o.place)||"1:1",this.place=o.place||void 0,this.reason=this.message,this.ruleId=o.ruleId||void 0,this.source=o.source||void 0,this.stack=s&&o.cause&&typeof o.cause.stack=="string"?o.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}no.prototype.file="";no.prototype.name="";no.prototype.reason="";no.prototype.message="";no.prototype.stack="";no.prototype.column=void 0;no.prototype.line=void 0;no.prototype.ancestors=void 0;no.prototype.cause=void 0;no.prototype.fatal=void 0;no.prototype.place=void 0;no.prototype.ruleId=void 0;no.prototype.source=void 0;const aj={}.hasOwnProperty,vBe=new Map,xBe=/[A-Z]/g,SBe=new Set(["table","tbody","thead","tfoot","tr"]),bBe=new Set(["td","th"]),hre="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function wBe(t,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=e.filePath||void 0;let r;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=ABe(n,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");r=EBe(n,e.jsx,e.jsxs)}const i={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:r,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?oj:cBe,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},o=pre(i,t,void 0);return o&&typeof o!="string"?o:i.create(t,i.Fragment,{children:o||void 0},void 0)}function pre(t,e,n){if(e.type==="element")return kBe(t,e,n);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return IBe(t,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return CBe(t,e,n);if(e.type==="mdxjsEsm")return _Be(t,e);if(e.type==="root")return PBe(t,e,n);if(e.type==="text")return TBe(t,e)}function kBe(t,e,n){const r=t.schema;let i=r;e.tagName.toLowerCase()==="svg"&&r.space==="html"&&(i=oj,t.schema=i),t.ancestors.push(e);const o=gre(t,e.tagName,!1),s=MBe(t,e);let a=cj(t,e);return SBe.has(e.tagName)&&(a=a.filter(function(l){return typeof l=="string"?!Q6e(l):!0})),fre(t,s,o,e),lj(s,a),t.ancestors.pop(),t.schema=r,t.create(e,o,s,n)}function IBe(t,e){if(e.data&&e.data.estree&&t.evaluater){const r=e.data.estree.body[0];return r.type,t.evaluater.evaluateExpression(r.expression)}$y(t,e.position)}function _Be(t,e){if(e.data&&e.data.estree&&t.evaluater)return t.evaluater.evaluateProgram(e.data.estree);$y(t,e.position)}function CBe(t,e,n){const r=t.schema;let i=r;e.name==="svg"&&r.space==="html"&&(i=oj,t.schema=i),t.ancestors.push(e);const o=e.name===null?t.Fragment:gre(t,e.name,!0),s=OBe(t,e),a=cj(t,e);return fre(t,s,o,e),lj(s,a),t.ancestors.pop(),t.schema=r,t.create(e,o,s,n)}function PBe(t,e,n){const r={};return lj(r,cj(t,e)),t.create(e,t.Fragment,r,n)}function TBe(t,e){return e.value}function fre(t,e,n,r){typeof n!="string"&&n!==t.Fragment&&t.passNode&&(e.node=r)}function lj(t,e){if(e.length>0){const n=e.length>1?e:e[0];n&&(t.children=n)}}function EBe(t,e,n){return r;function r(i,o,s,a){const c=Array.isArray(s.children)?n:e;return a?c(o,s,a):c(o,s)}}function ABe(t,e){return n;function n(r,i,o,s){const a=Array.isArray(o.children),l=sj(r);return e(i,o,s,a,{columnNumber:l?l.column-1:void 0,fileName:t,lineNumber:l?l.line:void 0},void 0)}}function MBe(t,e){const n={};let r,i;for(i in e.properties)if(i!=="children"&&aj.call(e.properties,i)){const o=DBe(t,i,e.properties[i]);if(o){const[s,a]=o;t.tableCellAlignToStyle&&s==="align"&&typeof a=="string"&&bBe.has(e.tagName)?r=a:n[s]=a}}if(r){const o=n.style||(n.style={});o[t.stylePropertyNameCase==="css"?"text-align":"textAlign"]=r}return n}function OBe(t,e){const n={};for(const r of e.attributes)if(r.type==="mdxJsxExpressionAttribute")if(r.data&&r.data.estree&&t.evaluater){const o=r.data.estree.body[0];o.type;const s=o.expression;s.type;const a=s.properties[0];a.type,Object.assign(n,t.evaluater.evaluateExpression(a.argument))}else $y(t,e.position);else{const i=r.name;let o;if(r.value&&typeof r.value=="object")if(r.value.data&&r.value.data.estree&&t.evaluater){const a=r.value.data.estree.body[0];a.type,o=t.evaluater.evaluateExpression(a.expression)}else $y(t,e.position);else o=r.value===null?!0:r.value;n[i]=o}return n}function cj(t,e){const n=[];let r=-1;const i=t.passKeys?new Map:vBe;for(;++r<e.children.length;){const o=e.children[r];let s;if(t.passKeys){const l=o.type==="element"?o.tagName:o.type==="mdxJsxFlowElement"||o.type==="mdxJsxTextElement"?o.name:void 0;if(l){const c=i.get(l)||0;s=l+"-"+c,i.set(l,c+1)}}const a=pre(t,o,s);a!==void 0&&n.push(a)}return n}function DBe(t,e,n){const r=sBe(t.schema,e);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=r.commaSeparated?G6e(n):uBe(n)),r.property==="style"){let i=typeof n=="object"?n:jBe(t,String(n));return t.stylePropertyNameCase==="css"&&(i=RBe(i)),["style",i]}return[t.elementAttributeNameCase==="react"&&r.space?rBe[r.property]||r.property:r.attribute,n]}}function jBe(t,e){try{return mBe(e,{reactCompat:!0})}catch(n){if(t.ignoreInvalidStyle)return{};const r=n,i=new no("Cannot parse `style` attribute",{ancestors:t.ancestors,cause:r,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw i.file=t.filePath||void 0,i.url=hre+"#cannot-parse-style-attribute",i}}function gre(t,e,n){let r;if(!n)r={type:"Literal",value:e};else if(e.includes(".")){const i=e.split(".");let o=-1,s;for(;++o<i.length;){const a=dB(i[o])?{type:"Identifier",name:i[o]}:{type:"Literal",value:i[o]};s=s?{type:"MemberExpression",object:s,property:a,computed:!!(o&&a.type==="Literal"),optional:!1}:a}r=s}else r=dB(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(r.type==="Literal"){const i=r.value;return aj.call(t.components,i)?t.components[i]:i}if(t.evaluater)return t.evaluater.evaluateExpression(r);$y(t)}function $y(t,e){const n=new no("Cannot handle MDX estrees without `createEvaluater`",{ancestors:t.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=t.filePath||void 0,n.url=hre+"#cannot-handle-mdx-estrees-without-createevaluater",n}function RBe(t){const e={};let n;for(n in t)aj.call(t,n)&&(e[$Be(n)]=t[n]);return e}function $Be(t){let e=t.replace(xBe,NBe);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function NBe(t){return"-"+t.toLowerCase()}const QP={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},LBe={};function zBe(t,e){const n=LBe,r=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,i=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return mre(t,r,i)}function mre(t,e,n){if(FBe(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(e&&"alt"in t&&t.alt)return t.alt;if("children"in t)return bB(t.children,e,n)}return Array.isArray(t)?bB(t,e,n):""}function bB(t,e,n){const r=[];let i=-1;for(;++i<t.length;)r[i]=mre(t[i],e,n);return r.join("")}function FBe(t){return!!(t&&typeof t=="object")}const wB=document.createElement("i");function uj(t){const e="&"+t+";";wB.innerHTML=e;const n=wB.textContent;return n.charCodeAt(n.length-1)===59&&t!=="semi"||n===e?!1:n}function Ol(t,e,n,r){const i=t.length;let o=0,s;if(e<0?e=-e>i?0:i+e:e=e>i?i:e,n=n>0?n:0,r.length<1e4)s=Array.from(r),s.unshift(e,n),t.splice(...s);else for(n&&t.splice(e,n);o<r.length;)s=r.slice(o,o+1e4),s.unshift(e,0),t.splice(...s),o+=1e4,e+=1e4}function ta(t,e){return t.length>0?(Ol(t,t.length,0,e),t):e}const kB={}.hasOwnProperty;function BBe(t){const e={};let n=-1;for(;++n<t.length;)UBe(e,t[n]);return e}function UBe(t,e){let n;for(n in e){const i=(kB.call(t,n)?t[n]:void 0)||(t[n]={}),o=e[n];let s;if(o)for(s in o){kB.call(i,s)||(i[s]=[]);const a=o[s];HBe(i[s],Array.isArray(a)?a:a?[a]:[])}}}function HBe(t,e){let n=-1;const r=[];for(;++n<e.length;)(e[n].add==="after"?t:r).push(e[n]);Ol(t,0,0,r)}function yre(t,e){const n=Number.parseInt(t,e);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"�":String.fromCodePoint(n)}function nf(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const ml=od(/[A-Za-z]/),Ss=od(/[\dA-Za-z]/),WBe=od(/[#-'*+\--9=?A-Z^-~]/);function e2(t){return t!==null&&(t<32||t===127)}const t2=od(/\d/),VBe=od(/[\dA-Fa-f]/),KBe=od(/[!-/:-@[-`{-~]/);function mt(t){return t!==null&&t<-2}function Xo(t){return t!==null&&(t<0||t===32)}function on(t){return t===-2||t===-1||t===32}const qBe=od(new RegExp("\\p{P}|\\p{S}","u")),GBe=od(/\s/);function od(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function Yf(t){const e=[];let n=-1,r=0,i=0;for(;++n<t.length;){const o=t.charCodeAt(n);let s="";if(o===37&&Ss(t.charCodeAt(n+1))&&Ss(t.charCodeAt(n+2)))i=2;else if(o<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(o))||(s=String.fromCharCode(o));else if(o>55295&&o<57344){const a=t.charCodeAt(n+1);o<56320&&a>56319&&a<57344?(s=String.fromCharCode(o,a),i=1):s="�"}else s=String.fromCharCode(o);s&&(e.push(t.slice(r,n),encodeURIComponent(s)),r=n+i+1,s=""),i&&(n+=i,i=0)}return e.join("")+t.slice(r)}function Pn(t,e,n,r){const i=r?r-1:Number.POSITIVE_INFINITY;let o=0;return s;function s(l){return on(l)?(t.enter(n),a(l)):e(l)}function a(l){return on(l)&&o++<i?(t.consume(l),a):(t.exit(n),e(l))}}const YBe={tokenize:XBe};function XBe(t){const e=t.attempt(this.parser.constructs.contentInitial,r,i);let n;return e;function r(a){if(a===null){t.consume(a);return}return t.enter("lineEnding"),t.consume(a),t.exit("lineEnding"),Pn(t,e,"linePrefix")}function i(a){return t.enter("paragraph"),o(a)}function o(a){const l=t.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=l),n=l,s(a)}function s(a){if(a===null){t.exit("chunkText"),t.exit("paragraph"),t.consume(a);return}return mt(a)?(t.consume(a),t.exit("chunkText"),o):(t.consume(a),s)}}const ZBe={tokenize:JBe},IB={tokenize:QBe};function JBe(t){const e=this,n=[];let r=0,i,o,s;return a;function a(_){if(r<n.length){const C=n[r];return e.containerState=C[1],t.attempt(C[0].continuation,l,c)(_)}return c(_)}function l(_){if(r++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,i&&w();const C=e.events.length;let A=C,E;for(;A--;)if(e.events[A][0]==="exit"&&e.events[A][1].type==="chunkFlow"){E=e.events[A][1].end;break}b(r);let O=C;for(;O<e.events.length;)e.events[O][1].end={...E},O++;return Ol(e.events,A+1,0,e.events.slice(C)),e.events.length=O,c(_)}return a(_)}function c(_){if(r===n.length){if(!i)return p(_);if(i.currentConstruct&&i.currentConstruct.concrete)return y(_);e.interrupt=!!(i.currentConstruct&&!i._gfmTableDynamicInterruptHack)}return e.containerState={},t.check(IB,d,u)(_)}function d(_){return i&&w(),b(r),p(_)}function u(_){return e.parser.lazy[e.now().line]=r!==n.length,s=e.now().offset,y(_)}function p(_){return e.containerState={},t.attempt(IB,f,y)(_)}function f(_){return r++,n.push([e.currentConstruct,e.containerState]),p(_)}function y(_){if(_===null){i&&w(),b(0),t.consume(_);return}return i=i||e.parser.flow(e.now()),t.enter("chunkFlow",{_tokenizer:i,contentType:"flow",previous:o}),v(_)}function v(_){if(_===null){x(t.exit("chunkFlow"),!0),b(0),t.consume(_);return}return mt(_)?(t.consume(_),x(t.exit("chunkFlow")),r=0,e.interrupt=void 0,a):(t.consume(_),v)}function x(_,C){const A=e.sliceStream(_);if(C&&A.push(null),_.previous=o,o&&(o.next=_),o=_,i.defineSkip(_.start),i.write(A),e.parser.lazy[_.start.line]){let E=i.events.length;for(;E--;)if(i.events[E][1].start.offset<s&&(!i.events[E][1].end||i.events[E][1].end.offset>s))return;const O=e.events.length;let D=O,B,L;for(;D--;)if(e.events[D][0]==="exit"&&e.events[D][1].type==="chunkFlow"){if(B){L=e.events[D][1].end;break}B=!0}for(b(r),E=O;E<e.events.length;)e.events[E][1].end={...L},E++;Ol(e.events,D+1,0,e.events.slice(O)),e.events.length=E}}function b(_){let C=n.length;for(;C-- >_;){const A=n[C];e.containerState=A[1],A[0].exit.call(e,t)}n.length=_}function w(){i.write([null]),o=void 0,i=void 0,e.containerState._closeFlow=void 0}}function QBe(t,e,n){return Pn(t,t.attempt(this.parser.constructs.document,e,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function _B(t){if(t===null||Xo(t)||GBe(t))return 1;if(qBe(t))return 2}function dj(t,e,n){const r=[];let i=-1;for(;++i<t.length;){const o=t[i].resolveAll;o&&!r.includes(o)&&(e=o(e,n),r.push(o))}return e}const n2={name:"attention",resolveAll:e5e,tokenize:t5e};function e5e(t,e){let n=-1,r,i,o,s,a,l,c,d;for(;++n<t.length;)if(t[n][0]==="enter"&&t[n][1].type==="attentionSequence"&&t[n][1]._close){for(r=n;r--;)if(t[r][0]==="exit"&&t[r][1].type==="attentionSequence"&&t[r][1]._open&&e.sliceSerialize(t[r][1]).charCodeAt(0)===e.sliceSerialize(t[n][1]).charCodeAt(0)){if((t[r][1]._close||t[n][1]._open)&&(t[n][1].end.offset-t[n][1].start.offset)%3&&!((t[r][1].end.offset-t[r][1].start.offset+t[n][1].end.offset-t[n][1].start.offset)%3))continue;l=t[r][1].end.offset-t[r][1].start.offset>1&&t[n][1].end.offset-t[n][1].start.offset>1?2:1;const u={...t[r][1].end},p={...t[n][1].start};CB(u,-l),CB(p,l),s={type:l>1?"strongSequence":"emphasisSequence",start:u,end:{...t[r][1].end}},a={type:l>1?"strongSequence":"emphasisSequence",start:{...t[n][1].start},end:p},o={type:l>1?"strongText":"emphasisText",start:{...t[r][1].end},end:{...t[n][1].start}},i={type:l>1?"strong":"emphasis",start:{...s.start},end:{...a.end}},t[r][1].end={...s.start},t[n][1].start={...a.end},c=[],t[r][1].end.offset-t[r][1].start.offset&&(c=ta(c,[["enter",t[r][1],e],["exit",t[r][1],e]])),c=ta(c,[["enter",i,e],["enter",s,e],["exit",s,e],["enter",o,e]]),c=ta(c,dj(e.parser.constructs.insideSpan.null,t.slice(r+1,n),e)),c=ta(c,[["exit",o,e],["enter",a,e],["exit",a,e],["exit",i,e]]),t[n][1].end.offset-t[n][1].start.offset?(d=2,c=ta(c,[["enter",t[n][1],e],["exit",t[n][1],e]])):d=0,Ol(t,r-1,n-r+3,c),n=r+c.length-d-2;break}}for(n=-1;++n<t.length;)t[n][1].type==="attentionSequence"&&(t[n][1].type="data");return t}function t5e(t,e){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,i=_B(r);let o;return s;function s(l){return o=l,t.enter("attentionSequence"),a(l)}function a(l){if(l===o)return t.consume(l),a;const c=t.exit("attentionSequence"),d=_B(l),u=!d||d===2&&i||n.includes(l),p=!i||i===2&&d||n.includes(r);return c._open=!!(o===42?u:u&&(i||!p)),c._close=!!(o===42?p:p&&(d||!u)),e(l)}}function CB(t,e){t.column+=e,t.offset+=e,t._bufferIndex+=e}const n5e={name:"autolink",tokenize:r5e};function r5e(t,e,n){let r=0;return i;function i(f){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(f),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),o}function o(f){return ml(f)?(t.consume(f),s):f===64?n(f):c(f)}function s(f){return f===43||f===45||f===46||Ss(f)?(r=1,a(f)):c(f)}function a(f){return f===58?(t.consume(f),r=0,l):(f===43||f===45||f===46||Ss(f))&&r++<32?(t.consume(f),a):(r=0,c(f))}function l(f){return f===62?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(f),t.exit("autolinkMarker"),t.exit("autolink"),e):f===null||f===32||f===60||e2(f)?n(f):(t.consume(f),l)}function c(f){return f===64?(t.consume(f),d):WBe(f)?(t.consume(f),c):n(f)}function d(f){return Ss(f)?u(f):n(f)}function u(f){return f===46?(t.consume(f),r=0,d):f===62?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(f),t.exit("autolinkMarker"),t.exit("autolink"),e):p(f)}function p(f){if((f===45||Ss(f))&&r++<63){const y=f===45?p:u;return t.consume(f),y}return n(f)}}const K1={partial:!0,tokenize:i5e};function i5e(t,e,n){return r;function r(o){return on(o)?Pn(t,i,"linePrefix")(o):i(o)}function i(o){return o===null||mt(o)?e(o):n(o)}}const vre={continuation:{tokenize:s5e},exit:a5e,name:"blockQuote",tokenize:o5e};function o5e(t,e,n){const r=this;return i;function i(s){if(s===62){const a=r.containerState;return a.open||(t.enter("blockQuote",{_container:!0}),a.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(s),t.exit("blockQuoteMarker"),o}return n(s)}function o(s){return on(s)?(t.enter("blockQuotePrefixWhitespace"),t.consume(s),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),e):(t.exit("blockQuotePrefix"),e(s))}}function s5e(t,e,n){const r=this;return i;function i(s){return on(s)?Pn(t,o,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(s):o(s)}function o(s){return t.attempt(vre,e,n)(s)}}function a5e(t){t.exit("blockQuote")}const xre={name:"characterEscape",tokenize:l5e};function l5e(t,e,n){return r;function r(o){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(o),t.exit("escapeMarker"),i}function i(o){return KBe(o)?(t.enter("characterEscapeValue"),t.consume(o),t.exit("characterEscapeValue"),t.exit("characterEscape"),e):n(o)}}const Sre={name:"characterReference",tokenize:c5e};function c5e(t,e,n){const r=this;let i=0,o,s;return a;function a(u){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(u),t.exit("characterReferenceMarker"),l}function l(u){return u===35?(t.enter("characterReferenceMarkerNumeric"),t.consume(u),t.exit("characterReferenceMarkerNumeric"),c):(t.enter("characterReferenceValue"),o=31,s=Ss,d(u))}function c(u){return u===88||u===120?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(u),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),o=6,s=VBe,d):(t.enter("characterReferenceValue"),o=7,s=t2,d(u))}function d(u){if(u===59&&i){const p=t.exit("characterReferenceValue");return s===Ss&&!uj(r.sliceSerialize(p))?n(u):(t.enter("characterReferenceMarker"),t.consume(u),t.exit("characterReferenceMarker"),t.exit("characterReference"),e)}return s(u)&&i++<o?(t.consume(u),d):n(u)}}const PB={partial:!0,tokenize:d5e},TB={concrete:!0,name:"codeFenced",tokenize:u5e};function u5e(t,e,n){const r=this,i={partial:!0,tokenize:A};let o=0,s=0,a;return l;function l(E){return c(E)}function c(E){const O=r.events[r.events.length-1];return o=O&&O[1].type==="linePrefix"?O[2].sliceSerialize(O[1],!0).length:0,a=E,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),d(E)}function d(E){return E===a?(s++,t.consume(E),d):s<3?n(E):(t.exit("codeFencedFenceSequence"),on(E)?Pn(t,u,"whitespace")(E):u(E))}function u(E){return E===null||mt(E)?(t.exit("codeFencedFence"),r.interrupt?e(E):t.check(PB,v,C)(E)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),p(E))}function p(E){return E===null||mt(E)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),u(E)):on(E)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),Pn(t,f,"whitespace")(E)):E===96&&E===a?n(E):(t.consume(E),p)}function f(E){return E===null||mt(E)?u(E):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),y(E))}function y(E){return E===null||mt(E)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),u(E)):E===96&&E===a?n(E):(t.consume(E),y)}function v(E){return t.attempt(i,C,x)(E)}function x(E){return t.enter("lineEnding"),t.consume(E),t.exit("lineEnding"),b}function b(E){return o>0&&on(E)?Pn(t,w,"linePrefix",o+1)(E):w(E)}function w(E){return E===null||mt(E)?t.check(PB,v,C)(E):(t.enter("codeFlowValue"),_(E))}function _(E){return E===null||mt(E)?(t.exit("codeFlowValue"),w(E)):(t.consume(E),_)}function C(E){return t.exit("codeFenced"),e(E)}function A(E,O,D){let B=0;return L;function L(V){return E.enter("lineEnding"),E.consume(V),E.exit("lineEnding"),j}function j(V){return E.enter("codeFencedFence"),on(V)?Pn(E,F,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(V):F(V)}function F(V){return V===a?(E.enter("codeFencedFenceSequence"),z(V)):D(V)}function z(V){return V===a?(B++,E.consume(V),z):B>=s?(E.exit("codeFencedFenceSequence"),on(V)?Pn(E,$,"whitespace")(V):$(V)):D(V)}function $(V){return V===null||mt(V)?(E.exit("codeFencedFence"),O(V)):D(V)}}}function d5e(t,e,n){const r=this;return i;function i(s){return s===null?n(s):(t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),o)}function o(s){return r.parser.lazy[r.now().line]?n(s):e(s)}}const eT={name:"codeIndented",tokenize:p5e},h5e={partial:!0,tokenize:f5e};function p5e(t,e,n){const r=this;return i;function i(c){return t.enter("codeIndented"),Pn(t,o,"linePrefix",5)(c)}function o(c){const d=r.events[r.events.length-1];return d&&d[1].type==="linePrefix"&&d[2].sliceSerialize(d[1],!0).length>=4?s(c):n(c)}function s(c){return c===null?l(c):mt(c)?t.attempt(h5e,s,l)(c):(t.enter("codeFlowValue"),a(c))}function a(c){return c===null||mt(c)?(t.exit("codeFlowValue"),s(c)):(t.consume(c),a)}function l(c){return t.exit("codeIndented"),e(c)}}function f5e(t,e,n){const r=this;return i;function i(s){return r.parser.lazy[r.now().line]?n(s):mt(s)?(t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),i):Pn(t,o,"linePrefix",5)(s)}function o(s){const a=r.events[r.events.length-1];return a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(s):mt(s)?i(s):n(s)}}const g5e={name:"codeText",previous:y5e,resolve:m5e,tokenize:v5e};function m5e(t){let e=t.length-4,n=3,r,i;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[e][1].type==="lineEnding"||t[e][1].type==="space")){for(r=n;++r<e;)if(t[r][1].type==="codeTextData"){t[n][1].type="codeTextPadding",t[e][1].type="codeTextPadding",n+=2,e-=2;break}}for(r=n-1,e++;++r<=e;)i===void 0?r!==e&&t[r][1].type!=="lineEnding"&&(i=r):(r===e||t[r][1].type==="lineEnding")&&(t[i][1].type="codeTextData",r!==i+2&&(t[i][1].end=t[r-1][1].end,t.splice(i+2,r-i-2),e-=r-i-2,r=i+2),i=void 0);return t}function y5e(t){return t!==96||this.events[this.events.length-1][1].type==="characterEscape"}function v5e(t,e,n){let r=0,i,o;return s;function s(u){return t.enter("codeText"),t.enter("codeTextSequence"),a(u)}function a(u){return u===96?(t.consume(u),r++,a):(t.exit("codeTextSequence"),l(u))}function l(u){return u===null?n(u):u===32?(t.enter("space"),t.consume(u),t.exit("space"),l):u===96?(o=t.enter("codeTextSequence"),i=0,d(u)):mt(u)?(t.enter("lineEnding"),t.consume(u),t.exit("lineEnding"),l):(t.enter("codeTextData"),c(u))}function c(u){return u===null||u===32||u===96||mt(u)?(t.exit("codeTextData"),l(u)):(t.consume(u),c)}function d(u){return u===96?(t.consume(u),i++,d):i===r?(t.exit("codeTextSequence"),t.exit("codeText"),e(u)):(o.type="codeTextData",c(u))}}class x5e{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,n){const r=n??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(e,r):e>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(e,n,r){const i=n||0;this.setCursor(Math.trunc(e));const o=this.right.splice(this.right.length-i,Number.POSITIVE_INFINITY);return r&&tm(this.left,r),o.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),tm(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),tm(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const n=this.left.splice(e,Number.POSITIVE_INFINITY);tm(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);tm(this.left,n.reverse())}}}function tm(t,e){let n=0;if(e.length<1e4)t.push(...e);else for(;n<e.length;)t.push(...e.slice(n,n+1e4)),n+=1e4}function bre(t){const e={};let n=-1,r,i,o,s,a,l,c;const d=new x5e(t);for(;++n<d.length;){for(;n in e;)n=e[n];if(r=d.get(n),n&&r[1].type==="chunkFlow"&&d.get(n-1)[1].type==="listItemPrefix"&&(l=r[1]._tokenizer.events,o=0,o<l.length&&l[o][1].type==="lineEndingBlank"&&(o+=2),o<l.length&&l[o][1].type==="content"))for(;++o<l.length&&l[o][1].type!=="content";)l[o][1].type==="chunkText"&&(l[o][1]._isInFirstContentOfListItem=!0,o++);if(r[0]==="enter")r[1].contentType&&(Object.assign(e,S5e(d,n)),n=e[n],c=!0);else if(r[1]._container){for(o=n,i=void 0;o--;)if(s=d.get(o),s[1].type==="lineEnding"||s[1].type==="lineEndingBlank")s[0]==="enter"&&(i&&(d.get(i)[1].type="lineEndingBlank"),s[1].type="lineEnding",i=o);else if(!(s[1].type==="linePrefix"||s[1].type==="listItemIndent"))break;i&&(r[1].end={...d.get(i)[1].start},a=d.slice(i,n),a.unshift(r),d.splice(i,n-i+1,a))}}return Ol(t,0,Number.POSITIVE_INFINITY,d.slice(0)),!c}function S5e(t,e){const n=t.get(e)[1],r=t.get(e)[2];let i=e-1;const o=[];let s=n._tokenizer;s||(s=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(s._contentTypeTextTrailing=!0));const a=s.events,l=[],c={};let d,u,p=-1,f=n,y=0,v=0;const x=[v];for(;f;){for(;t.get(++i)[1]!==f;);o.push(i),f._tokenizer||(d=r.sliceStream(f),f.next||d.push(null),u&&s.defineSkip(f.start),f._isInFirstContentOfListItem&&(s._gfmTasklistFirstContentOfListItem=!0),s.write(d),f._isInFirstContentOfListItem&&(s._gfmTasklistFirstContentOfListItem=void 0)),u=f,f=f.next}for(f=n;++p<a.length;)a[p][0]==="exit"&&a[p-1][0]==="enter"&&a[p][1].type===a[p-1][1].type&&a[p][1].start.line!==a[p][1].end.line&&(v=p+1,x.push(v),f._tokenizer=void 0,f.previous=void 0,f=f.next);for(s.events=[],f?(f._tokenizer=void 0,f.previous=void 0):x.pop(),p=x.length;p--;){const b=a.slice(x[p],x[p+1]),w=o.pop();l.push([w,w+b.length-1]),t.splice(w,2,b)}for(l.reverse(),p=-1;++p<l.length;)c[y+l[p][0]]=y+l[p][1],y+=l[p][1]-l[p][0]-1;return c}const b5e={resolve:k5e,tokenize:I5e},w5e={partial:!0,tokenize:_5e};function k5e(t){return bre(t),t}function I5e(t,e){let n;return r;function r(a){return t.enter("content"),n=t.enter("chunkContent",{contentType:"content"}),i(a)}function i(a){return a===null?o(a):mt(a)?t.check(w5e,s,o)(a):(t.consume(a),i)}function o(a){return t.exit("chunkContent"),t.exit("content"),e(a)}function s(a){return t.consume(a),t.exit("chunkContent"),n.next=t.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,i}}function _5e(t,e,n){const r=this;return i;function i(s){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),Pn(t,o,"linePrefix")}function o(s){if(s===null||mt(s))return n(s);const a=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&a&&a[1].type==="linePrefix"&&a[2].sliceSerialize(a[1],!0).length>=4?e(s):t.interrupt(r.parser.constructs.flow,n,e)(s)}}function wre(t,e,n,r,i,o,s,a,l){const c=l||Number.POSITIVE_INFINITY;let d=0;return u;function u(b){return b===60?(t.enter(r),t.enter(i),t.enter(o),t.consume(b),t.exit(o),p):b===null||b===32||b===41||e2(b)?n(b):(t.enter(r),t.enter(s),t.enter(a),t.enter("chunkString",{contentType:"string"}),v(b))}function p(b){return b===62?(t.enter(o),t.consume(b),t.exit(o),t.exit(i),t.exit(r),e):(t.enter(a),t.enter("chunkString",{contentType:"string"}),f(b))}function f(b){return b===62?(t.exit("chunkString"),t.exit(a),p(b)):b===null||b===60||mt(b)?n(b):(t.consume(b),b===92?y:f)}function y(b){return b===60||b===62||b===92?(t.consume(b),f):f(b)}function v(b){return!d&&(b===null||b===41||Xo(b))?(t.exit("chunkString"),t.exit(a),t.exit(s),t.exit(r),e(b)):d<c&&b===40?(t.consume(b),d++,v):b===41?(t.consume(b),d--,v):b===null||b===32||b===40||e2(b)?n(b):(t.consume(b),b===92?x:v)}function x(b){return b===40||b===41||b===92?(t.consume(b),v):v(b)}}function kre(t,e,n,r,i,o){const s=this;let a=0,l;return c;function c(f){return t.enter(r),t.enter(i),t.consume(f),t.exit(i),t.enter(o),d}function d(f){return a>999||f===null||f===91||f===93&&!l||f===94&&!a&&"_hiddenFootnoteSupport"in s.parser.constructs?n(f):f===93?(t.exit(o),t.enter(i),t.consume(f),t.exit(i),t.exit(r),e):mt(f)?(t.enter("lineEnding"),t.consume(f),t.exit("lineEnding"),d):(t.enter("chunkString",{contentType:"string"}),u(f))}function u(f){return f===null||f===91||f===93||mt(f)||a++>999?(t.exit("chunkString"),d(f)):(t.consume(f),l||(l=!on(f)),f===92?p:u)}function p(f){return f===91||f===92||f===93?(t.consume(f),a++,u):u(f)}}function Ire(t,e,n,r,i,o){let s;return a;function a(p){return p===34||p===39||p===40?(t.enter(r),t.enter(i),t.consume(p),t.exit(i),s=p===40?41:p,l):n(p)}function l(p){return p===s?(t.enter(i),t.consume(p),t.exit(i),t.exit(r),e):(t.enter(o),c(p))}function c(p){return p===s?(t.exit(o),l(s)):p===null?n(p):mt(p)?(t.enter("lineEnding"),t.consume(p),t.exit("lineEnding"),Pn(t,c,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),d(p))}function d(p){return p===s||p===null||mt(p)?(t.exit("chunkString"),c(p)):(t.consume(p),p===92?u:d)}function u(p){return p===s||p===92?(t.consume(p),d):d(p)}}function Gm(t,e){let n;return r;function r(i){return mt(i)?(t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),n=!0,r):on(i)?Pn(t,r,n?"linePrefix":"lineSuffix")(i):e(i)}}const C5e={name:"definition",tokenize:T5e},P5e={partial:!0,tokenize:E5e};function T5e(t,e,n){const r=this;let i;return o;function o(f){return t.enter("definition"),s(f)}function s(f){return kre.call(r,t,a,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(f)}function a(f){return i=nf(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),f===58?(t.enter("definitionMarker"),t.consume(f),t.exit("definitionMarker"),l):n(f)}function l(f){return Xo(f)?Gm(t,c)(f):c(f)}function c(f){return wre(t,d,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(f)}function d(f){return t.attempt(P5e,u,u)(f)}function u(f){return on(f)?Pn(t,p,"whitespace")(f):p(f)}function p(f){return f===null||mt(f)?(t.exit("definition"),r.parser.defined.push(i),e(f)):n(f)}}function E5e(t,e,n){return r;function r(a){return Xo(a)?Gm(t,i)(a):n(a)}function i(a){return Ire(t,o,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(a)}function o(a){return on(a)?Pn(t,s,"whitespace")(a):s(a)}function s(a){return a===null||mt(a)?e(a):n(a)}}const A5e={name:"hardBreakEscape",tokenize:M5e};function M5e(t,e,n){return r;function r(o){return t.enter("hardBreakEscape"),t.consume(o),i}function i(o){return mt(o)?(t.exit("hardBreakEscape"),e(o)):n(o)}}const O5e={name:"headingAtx",resolve:D5e,tokenize:j5e};function D5e(t,e){let n=t.length-2,r=3,i,o;return t[r][1].type==="whitespace"&&(r+=2),n-2>r&&t[n][1].type==="whitespace"&&(n-=2),t[n][1].type==="atxHeadingSequence"&&(r===n-1||n-4>r&&t[n-2][1].type==="whitespace")&&(n-=r+1===n?2:4),n>r&&(i={type:"atxHeadingText",start:t[r][1].start,end:t[n][1].end},o={type:"chunkText",start:t[r][1].start,end:t[n][1].end,contentType:"text"},Ol(t,r,n-r+1,[["enter",i,e],["enter",o,e],["exit",o,e],["exit",i,e]])),t}function j5e(t,e,n){let r=0;return i;function i(d){return t.enter("atxHeading"),o(d)}function o(d){return t.enter("atxHeadingSequence"),s(d)}function s(d){return d===35&&r++<6?(t.consume(d),s):d===null||Xo(d)?(t.exit("atxHeadingSequence"),a(d)):n(d)}function a(d){return d===35?(t.enter("atxHeadingSequence"),l(d)):d===null||mt(d)?(t.exit("atxHeading"),e(d)):on(d)?Pn(t,a,"whitespace")(d):(t.enter("atxHeadingText"),c(d))}function l(d){return d===35?(t.consume(d),l):(t.exit("atxHeadingSequence"),a(d))}function c(d){return d===null||d===35||Xo(d)?(t.exit("atxHeadingText"),a(d)):(t.consume(d),c)}}const R5e=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],EB=["pre","script","style","textarea"],$5e={concrete:!0,name:"htmlFlow",resolveTo:z5e,tokenize:F5e},N5e={partial:!0,tokenize:U5e},L5e={partial:!0,tokenize:B5e};function z5e(t){let e=t.length;for(;e--&&!(t[e][0]==="enter"&&t[e][1].type==="htmlFlow"););return e>1&&t[e-2][1].type==="linePrefix"&&(t[e][1].start=t[e-2][1].start,t[e+1][1].start=t[e-2][1].start,t.splice(e-2,2)),t}function F5e(t,e,n){const r=this;let i,o,s,a,l;return c;function c(U){return d(U)}function d(U){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume(U),u}function u(U){return U===33?(t.consume(U),p):U===47?(t.consume(U),o=!0,v):U===63?(t.consume(U),i=3,r.interrupt?e:N):ml(U)?(t.consume(U),s=String.fromCharCode(U),x):n(U)}function p(U){return U===45?(t.consume(U),i=2,f):U===91?(t.consume(U),i=5,a=0,y):ml(U)?(t.consume(U),i=4,r.interrupt?e:N):n(U)}function f(U){return U===45?(t.consume(U),r.interrupt?e:N):n(U)}function y(U){const ke="CDATA[";return U===ke.charCodeAt(a++)?(t.consume(U),a===ke.length?r.interrupt?e:F:y):n(U)}function v(U){return ml(U)?(t.consume(U),s=String.fromCharCode(U),x):n(U)}function x(U){if(U===null||U===47||U===62||Xo(U)){const ke=U===47,ge=s.toLowerCase();return!ke&&!o&&EB.includes(ge)?(i=1,r.interrupt?e(U):F(U)):R5e.includes(s.toLowerCase())?(i=6,ke?(t.consume(U),b):r.interrupt?e(U):F(U)):(i=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(U):o?w(U):_(U))}return U===45||Ss(U)?(t.consume(U),s+=String.fromCharCode(U),x):n(U)}function b(U){return U===62?(t.consume(U),r.interrupt?e:F):n(U)}function w(U){return on(U)?(t.consume(U),w):L(U)}function _(U){return U===47?(t.consume(U),L):U===58||U===95||ml(U)?(t.consume(U),C):on(U)?(t.consume(U),_):L(U)}function C(U){return U===45||U===46||U===58||U===95||Ss(U)?(t.consume(U),C):A(U)}function A(U){return U===61?(t.consume(U),E):on(U)?(t.consume(U),A):_(U)}function E(U){return U===null||U===60||U===61||U===62||U===96?n(U):U===34||U===39?(t.consume(U),l=U,O):on(U)?(t.consume(U),E):D(U)}function O(U){return U===l?(t.consume(U),l=null,B):U===null||mt(U)?n(U):(t.consume(U),O)}function D(U){return U===null||U===34||U===39||U===47||U===60||U===61||U===62||U===96||Xo(U)?A(U):(t.consume(U),D)}function B(U){return U===47||U===62||on(U)?_(U):n(U)}function L(U){return U===62?(t.consume(U),j):n(U)}function j(U){return U===null||mt(U)?F(U):on(U)?(t.consume(U),j):n(U)}function F(U){return U===45&&i===2?(t.consume(U),Y):U===60&&i===1?(t.consume(U),re):U===62&&i===4?(t.consume(U),H):U===63&&i===3?(t.consume(U),N):U===93&&i===5?(t.consume(U),X):mt(U)&&(i===6||i===7)?(t.exit("htmlFlowData"),t.check(N5e,ie,z)(U)):U===null||mt(U)?(t.exit("htmlFlowData"),z(U)):(t.consume(U),F)}function z(U){return t.check(L5e,$,ie)(U)}function $(U){return t.enter("lineEnding"),t.consume(U),t.exit("lineEnding"),V}function V(U){return U===null||mt(U)?z(U):(t.enter("htmlFlowData"),F(U))}function Y(U){return U===45?(t.consume(U),N):F(U)}function re(U){return U===47?(t.consume(U),s="",q):F(U)}function q(U){if(U===62){const ke=s.toLowerCase();return EB.includes(ke)?(t.consume(U),H):F(U)}return ml(U)&&s.length<8?(t.consume(U),s+=String.fromCharCode(U),q):F(U)}function X(U){return U===93?(t.consume(U),N):F(U)}function N(U){return U===62?(t.consume(U),H):U===45&&i===2?(t.consume(U),N):F(U)}function H(U){return U===null||mt(U)?(t.exit("htmlFlowData"),ie(U)):(t.consume(U),H)}function ie(U){return t.exit("htmlFlow"),e(U)}}function B5e(t,e,n){const r=this;return i;function i(s){return mt(s)?(t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),o):n(s)}function o(s){return r.parser.lazy[r.now().line]?n(s):e(s)}}function U5e(t,e,n){return r;function r(i){return t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),t.attempt(K1,e,n)}}const H5e={name:"htmlText",tokenize:W5e};function W5e(t,e,n){const r=this;let i,o,s;return a;function a(N){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(N),l}function l(N){return N===33?(t.consume(N),c):N===47?(t.consume(N),A):N===63?(t.consume(N),_):ml(N)?(t.consume(N),D):n(N)}function c(N){return N===45?(t.consume(N),d):N===91?(t.consume(N),o=0,y):ml(N)?(t.consume(N),w):n(N)}function d(N){return N===45?(t.consume(N),f):n(N)}function u(N){return N===null?n(N):N===45?(t.consume(N),p):mt(N)?(s=u,re(N)):(t.consume(N),u)}function p(N){return N===45?(t.consume(N),f):u(N)}function f(N){return N===62?Y(N):N===45?p(N):u(N)}function y(N){const H="CDATA[";return N===H.charCodeAt(o++)?(t.consume(N),o===H.length?v:y):n(N)}function v(N){return N===null?n(N):N===93?(t.consume(N),x):mt(N)?(s=v,re(N)):(t.consume(N),v)}function x(N){return N===93?(t.consume(N),b):v(N)}function b(N){return N===62?Y(N):N===93?(t.consume(N),b):v(N)}function w(N){return N===null||N===62?Y(N):mt(N)?(s=w,re(N)):(t.consume(N),w)}function _(N){return N===null?n(N):N===63?(t.consume(N),C):mt(N)?(s=_,re(N)):(t.consume(N),_)}function C(N){return N===62?Y(N):_(N)}function A(N){return ml(N)?(t.consume(N),E):n(N)}function E(N){return N===45||Ss(N)?(t.consume(N),E):O(N)}function O(N){return mt(N)?(s=O,re(N)):on(N)?(t.consume(N),O):Y(N)}function D(N){return N===45||Ss(N)?(t.consume(N),D):N===47||N===62||Xo(N)?B(N):n(N)}function B(N){return N===47?(t.consume(N),Y):N===58||N===95||ml(N)?(t.consume(N),L):mt(N)?(s=B,re(N)):on(N)?(t.consume(N),B):Y(N)}function L(N){return N===45||N===46||N===58||N===95||Ss(N)?(t.consume(N),L):j(N)}function j(N){return N===61?(t.consume(N),F):mt(N)?(s=j,re(N)):on(N)?(t.consume(N),j):B(N)}function F(N){return N===null||N===60||N===61||N===62||N===96?n(N):N===34||N===39?(t.consume(N),i=N,z):mt(N)?(s=F,re(N)):on(N)?(t.consume(N),F):(t.consume(N),$)}function z(N){return N===i?(t.consume(N),i=void 0,V):N===null?n(N):mt(N)?(s=z,re(N)):(t.consume(N),z)}function $(N){return N===null||N===34||N===39||N===60||N===61||N===96?n(N):N===47||N===62||Xo(N)?B(N):(t.consume(N),$)}function V(N){return N===47||N===62||Xo(N)?B(N):n(N)}function Y(N){return N===62?(t.consume(N),t.exit("htmlTextData"),t.exit("htmlText"),e):n(N)}function re(N){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(N),t.exit("lineEnding"),q}function q(N){return on(N)?Pn(t,X,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(N):X(N)}function X(N){return t.enter("htmlTextData"),s(N)}}const hj={name:"labelEnd",resolveAll:G5e,resolveTo:Y5e,tokenize:X5e},V5e={tokenize:Z5e},K5e={tokenize:J5e},q5e={tokenize:Q5e};function G5e(t){let e=-1;const n=[];for(;++e<t.length;){const r=t[e][1];if(n.push(t[e]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const i=r.type==="labelImage"?4:2;r.type="data",e+=i}}return t.length!==n.length&&Ol(t,0,t.length,n),t}function Y5e(t,e){let n=t.length,r=0,i,o,s,a;for(;n--;)if(i=t[n][1],o){if(i.type==="link"||i.type==="labelLink"&&i._inactive)break;t[n][0]==="enter"&&i.type==="labelLink"&&(i._inactive=!0)}else if(s){if(t[n][0]==="enter"&&(i.type==="labelImage"||i.type==="labelLink")&&!i._balanced&&(o=n,i.type!=="labelLink")){r=2;break}}else i.type==="labelEnd"&&(s=n);const l={type:t[o][1].type==="labelLink"?"link":"image",start:{...t[o][1].start},end:{...t[t.length-1][1].end}},c={type:"label",start:{...t[o][1].start},end:{...t[s][1].end}},d={type:"labelText",start:{...t[o+r+2][1].end},end:{...t[s-2][1].start}};return a=[["enter",l,e],["enter",c,e]],a=ta(a,t.slice(o+1,o+r+3)),a=ta(a,[["enter",d,e]]),a=ta(a,dj(e.parser.constructs.insideSpan.null,t.slice(o+r+4,s-3),e)),a=ta(a,[["exit",d,e],t[s-2],t[s-1],["exit",c,e]]),a=ta(a,t.slice(s+1)),a=ta(a,[["exit",l,e]]),Ol(t,o,t.length,a),t}function X5e(t,e,n){const r=this;let i=r.events.length,o,s;for(;i--;)if((r.events[i][1].type==="labelImage"||r.events[i][1].type==="labelLink")&&!r.events[i][1]._balanced){o=r.events[i][1];break}return a;function a(p){return o?o._inactive?u(p):(s=r.parser.defined.includes(nf(r.sliceSerialize({start:o.end,end:r.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(p),t.exit("labelMarker"),t.exit("labelEnd"),l):n(p)}function l(p){return p===40?t.attempt(V5e,d,s?d:u)(p):p===91?t.attempt(K5e,d,s?c:u)(p):s?d(p):u(p)}function c(p){return t.attempt(q5e,d,u)(p)}function d(p){return e(p)}function u(p){return o._balanced=!0,n(p)}}function Z5e(t,e,n){return r;function r(u){return t.enter("resource"),t.enter("resourceMarker"),t.consume(u),t.exit("resourceMarker"),i}function i(u){return Xo(u)?Gm(t,o)(u):o(u)}function o(u){return u===41?d(u):wre(t,s,a,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(u)}function s(u){return Xo(u)?Gm(t,l)(u):d(u)}function a(u){return n(u)}function l(u){return u===34||u===39||u===40?Ire(t,c,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(u):d(u)}function c(u){return Xo(u)?Gm(t,d)(u):d(u)}function d(u){return u===41?(t.enter("resourceMarker"),t.consume(u),t.exit("resourceMarker"),t.exit("resource"),e):n(u)}}function J5e(t,e,n){const r=this;return i;function i(a){return kre.call(r,t,o,s,"reference","referenceMarker","referenceString")(a)}function o(a){return r.parser.defined.includes(nf(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?e(a):n(a)}function s(a){return n(a)}}function Q5e(t,e,n){return r;function r(o){return t.enter("reference"),t.enter("referenceMarker"),t.consume(o),t.exit("referenceMarker"),i}function i(o){return o===93?(t.enter("referenceMarker"),t.consume(o),t.exit("referenceMarker"),t.exit("reference"),e):n(o)}}const eUe={name:"labelStartImage",resolveAll:hj.resolveAll,tokenize:tUe};function tUe(t,e,n){const r=this;return i;function i(a){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(a),t.exit("labelImageMarker"),o}function o(a){return a===91?(t.enter("labelMarker"),t.consume(a),t.exit("labelMarker"),t.exit("labelImage"),s):n(a)}function s(a){return a===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(a):e(a)}}const nUe={name:"labelStartLink",resolveAll:hj.resolveAll,tokenize:rUe};function rUe(t,e,n){const r=this;return i;function i(s){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(s),t.exit("labelMarker"),t.exit("labelLink"),o}function o(s){return s===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(s):e(s)}}const tT={name:"lineEnding",tokenize:iUe};function iUe(t,e){return n;function n(r){return t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),Pn(t,e,"linePrefix")}}const ZS={name:"thematicBreak",tokenize:oUe};function oUe(t,e,n){let r=0,i;return o;function o(c){return t.enter("thematicBreak"),s(c)}function s(c){return i=c,a(c)}function a(c){return c===i?(t.enter("thematicBreakSequence"),l(c)):r>=3&&(c===null||mt(c))?(t.exit("thematicBreak"),e(c)):n(c)}function l(c){return c===i?(t.consume(c),r++,l):(t.exit("thematicBreakSequence"),on(c)?Pn(t,a,"whitespace")(c):a(c))}}const zo={continuation:{tokenize:cUe},exit:dUe,name:"list",tokenize:lUe},sUe={partial:!0,tokenize:hUe},aUe={partial:!0,tokenize:uUe};function lUe(t,e,n){const r=this,i=r.events[r.events.length-1];let o=i&&i[1].type==="linePrefix"?i[2].sliceSerialize(i[1],!0).length:0,s=0;return a;function a(f){const y=r.containerState.type||(f===42||f===43||f===45?"listUnordered":"listOrdered");if(y==="listUnordered"?!r.containerState.marker||f===r.containerState.marker:t2(f)){if(r.containerState.type||(r.containerState.type=y,t.enter(y,{_container:!0})),y==="listUnordered")return t.enter("listItemPrefix"),f===42||f===45?t.check(ZS,n,c)(f):c(f);if(!r.interrupt||f===49)return t.enter("listItemPrefix"),t.enter("listItemValue"),l(f)}return n(f)}function l(f){return t2(f)&&++s<10?(t.consume(f),l):(!r.interrupt||s<2)&&(r.containerState.marker?f===r.containerState.marker:f===41||f===46)?(t.exit("listItemValue"),c(f)):n(f)}function c(f){return t.enter("listItemMarker"),t.consume(f),t.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||f,t.check(K1,r.interrupt?n:d,t.attempt(sUe,p,u))}function d(f){return r.containerState.initialBlankLine=!0,o++,p(f)}function u(f){return on(f)?(t.enter("listItemPrefixWhitespace"),t.consume(f),t.exit("listItemPrefixWhitespace"),p):n(f)}function p(f){return r.containerState.size=o+r.sliceSerialize(t.exit("listItemPrefix"),!0).length,e(f)}}function cUe(t,e,n){const r=this;return r.containerState._closeFlow=void 0,t.check(K1,i,o);function i(a){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,Pn(t,e,"listItemIndent",r.containerState.size+1)(a)}function o(a){return r.containerState.furtherBlankLines||!on(a)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,s(a)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,t.attempt(aUe,e,s)(a))}function s(a){return r.containerState._closeFlow=!0,r.interrupt=void 0,Pn(t,t.attempt(zo,e,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a)}}function uUe(t,e,n){const r=this;return Pn(t,i,"listItemIndent",r.containerState.size+1);function i(o){const s=r.events[r.events.length-1];return s&&s[1].type==="listItemIndent"&&s[2].sliceSerialize(s[1],!0).length===r.containerState.size?e(o):n(o)}}function dUe(t){t.exit(this.containerState.type)}function hUe(t,e,n){const r=this;return Pn(t,i,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function i(o){const s=r.events[r.events.length-1];return!on(o)&&s&&s[1].type==="listItemPrefixWhitespace"?e(o):n(o)}}const AB={name:"setextUnderline",resolveTo:pUe,tokenize:fUe};function pUe(t,e){let n=t.length,r,i,o;for(;n--;)if(t[n][0]==="enter"){if(t[n][1].type==="content"){r=n;break}t[n][1].type==="paragraph"&&(i=n)}else t[n][1].type==="content"&&t.splice(n,1),!o&&t[n][1].type==="definition"&&(o=n);const s={type:"setextHeading",start:{...t[r][1].start},end:{...t[t.length-1][1].end}};return t[i][1].type="setextHeadingText",o?(t.splice(i,0,["enter",s,e]),t.splice(o+1,0,["exit",t[r][1],e]),t[r][1].end={...t[o][1].end}):t[r][1]=s,t.push(["exit",s,e]),t}function fUe(t,e,n){const r=this;let i;return o;function o(c){let d=r.events.length,u;for(;d--;)if(r.events[d][1].type!=="lineEnding"&&r.events[d][1].type!=="linePrefix"&&r.events[d][1].type!=="content"){u=r.events[d][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||u)?(t.enter("setextHeadingLine"),i=c,s(c)):n(c)}function s(c){return t.enter("setextHeadingLineSequence"),a(c)}function a(c){return c===i?(t.consume(c),a):(t.exit("setextHeadingLineSequence"),on(c)?Pn(t,l,"lineSuffix")(c):l(c))}function l(c){return c===null||mt(c)?(t.exit("setextHeadingLine"),e(c)):n(c)}}const gUe={tokenize:mUe};function mUe(t){const e=this,n=t.attempt(K1,r,t.attempt(this.parser.constructs.flowInitial,i,Pn(t,t.attempt(this.parser.constructs.flow,i,t.attempt(b5e,i)),"linePrefix")));return n;function r(o){if(o===null){t.consume(o);return}return t.enter("lineEndingBlank"),t.consume(o),t.exit("lineEndingBlank"),e.currentConstruct=void 0,n}function i(o){if(o===null){t.consume(o);return}return t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),e.currentConstruct=void 0,n}}const yUe={resolveAll:Cre()},vUe=_re("string"),xUe=_re("text");function _re(t){return{resolveAll:Cre(t==="text"?SUe:void 0),tokenize:e};function e(n){const r=this,i=this.parser.constructs[t],o=n.attempt(i,s,a);return s;function s(d){return c(d)?o(d):a(d)}function a(d){if(d===null){n.consume(d);return}return n.enter("data"),n.consume(d),l}function l(d){return c(d)?(n.exit("data"),o(d)):(n.consume(d),l)}function c(d){if(d===null)return!0;const u=i[d];let p=-1;if(u)for(;++p<u.length;){const f=u[p];if(!f.previous||f.previous.call(r,r.previous))return!0}return!1}}}function Cre(t){return e;function e(n,r){let i=-1,o;for(;++i<=n.length;)o===void 0?n[i]&&n[i][1].type==="data"&&(o=i,i++):(!n[i]||n[i][1].type!=="data")&&(i!==o+2&&(n[o][1].end=n[i-1][1].end,n.splice(o+2,i-o-2),i=o+2),o=void 0);return t?t(n,r):n}}function SUe(t,e){let n=0;for(;++n<=t.length;)if((n===t.length||t[n][1].type==="lineEnding")&&t[n-1][1].type==="data"){const r=t[n-1][1],i=e.sliceStream(r);let o=i.length,s=-1,a=0,l;for(;o--;){const c=i[o];if(typeof c=="string"){for(s=c.length;c.charCodeAt(s-1)===32;)a++,s--;if(s)break;s=-1}else if(c===-2)l=!0,a++;else if(c!==-1){o++;break}}if(e._contentTypeTextTrailing&&n===t.length&&(a=0),a){const c={type:n===t.length||l||a<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:o?s:r.start._bufferIndex+s,_index:r.start._index+o,line:r.end.line,column:r.end.column-a,offset:r.end.offset-a},end:{...r.end}};r.end={...c.start},r.start.offset===r.end.offset?Object.assign(r,c):(t.splice(n,0,["enter",c,e],["exit",c,e]),n+=2)}n++}return t}const bUe={42:zo,43:zo,45:zo,48:zo,49:zo,50:zo,51:zo,52:zo,53:zo,54:zo,55:zo,56:zo,57:zo,62:vre},wUe={91:C5e},kUe={[-2]:eT,[-1]:eT,32:eT},IUe={35:O5e,42:ZS,45:[AB,ZS],60:$5e,61:AB,95:ZS,96:TB,126:TB},_Ue={38:Sre,92:xre},CUe={[-5]:tT,[-4]:tT,[-3]:tT,33:eUe,38:Sre,42:n2,60:[n5e,H5e],91:nUe,92:[A5e,xre],93:hj,95:n2,96:g5e},PUe={null:[n2,yUe]},TUe={null:[42,95]},EUe={null:[]},AUe=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:TUe,contentInitial:wUe,disable:EUe,document:bUe,flow:IUe,flowInitial:kUe,insideSpan:PUe,string:_Ue,text:CUe},Symbol.toStringTag,{value:"Module"}));function MUe(t,e,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const i={},o=[];let s=[],a=[];const l={attempt:O(A),check:O(E),consume:w,enter:_,exit:C,interrupt:O(E,{interrupt:!0})},c={code:null,containerState:{},defineSkip:v,events:[],now:y,parser:t,previous:null,sliceSerialize:p,sliceStream:f,write:u};let d=e.tokenize.call(c,l);return e.resolveAll&&o.push(e),c;function u(j){return s=ta(s,j),x(),s[s.length-1]!==null?[]:(D(e,0),c.events=dj(o,c.events,c),c.events)}function p(j,F){return DUe(f(j),F)}function f(j){return OUe(s,j)}function y(){const{_bufferIndex:j,_index:F,line:z,column:$,offset:V}=r;return{_bufferIndex:j,_index:F,line:z,column:$,offset:V}}function v(j){i[j.line]=j.column,L()}function x(){let j;for(;r._index<s.length;){const F=s[r._index];if(typeof F=="string")for(j=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===j&&r._bufferIndex<F.length;)b(F.charCodeAt(r._bufferIndex));else b(F)}}function b(j){d=d(j)}function w(j){mt(j)?(r.line++,r.column=1,r.offset+=j===-3?2:1,L()):j!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===s[r._index].length&&(r._bufferIndex=-1,r._index++)),c.previous=j}function _(j,F){const z=F||{};return z.type=j,z.start=y(),c.events.push(["enter",z,c]),a.push(z),z}function C(j){const F=a.pop();return F.end=y(),c.events.push(["exit",F,c]),F}function A(j,F){D(j,F.from)}function E(j,F){F.restore()}function O(j,F){return z;function z($,V,Y){let re,q,X,N;return Array.isArray($)?ie($):"tokenize"in $?ie([$]):H($);function H(Te){return ye;function ye(Se){const Re=Se!==null&&Te[Se],$e=Se!==null&&Te.null,Ft=[...Array.isArray(Re)?Re:Re?[Re]:[],...Array.isArray($e)?$e:$e?[$e]:[]];return ie(Ft)(Se)}}function ie(Te){return re=Te,q=0,Te.length===0?Y:U(Te[q])}function U(Te){return ye;function ye(Se){return N=B(),X=Te,Te.partial||(c.currentConstruct=Te),Te.name&&c.parser.constructs.disable.null.includes(Te.name)?ge():Te.tokenize.call(F?Object.assign(Object.create(c),F):c,l,ke,ge)(Se)}}function ke(Te){return j(X,N),V}function ge(Te){return N.restore(),++q<re.length?U(re[q]):Y}}}function D(j,F){j.resolveAll&&!o.includes(j)&&o.push(j),j.resolve&&Ol(c.events,F,c.events.length-F,j.resolve(c.events.slice(F),c)),j.resolveTo&&(c.events=j.resolveTo(c.events,c))}function B(){const j=y(),F=c.previous,z=c.currentConstruct,$=c.events.length,V=Array.from(a);return{from:$,restore:Y};function Y(){r=j,c.previous=F,c.currentConstruct=z,c.events.length=$,a=V,L()}}function L(){r.line in i&&r.column<2&&(r.column=i[r.line],r.offset+=i[r.line]-1)}}function OUe(t,e){const n=e.start._index,r=e.start._bufferIndex,i=e.end._index,o=e.end._bufferIndex;let s;if(n===i)s=[t[n].slice(r,o)];else{if(s=t.slice(n,i),r>-1){const a=s[0];typeof a=="string"?s[0]=a.slice(r):s.shift()}o>0&&s.push(t[i].slice(0,o))}return s}function DUe(t,e){let n=-1;const r=[];let i;for(;++n<t.length;){const o=t[n];let s;if(typeof o=="string")s=o;else switch(o){case-5:{s="\r";break}case-4:{s=`
`;break}case-3:{s=`\r
`;break}case-2:{s=e?" ":"	";break}case-1:{if(!e&&i)continue;s=" ";break}default:s=String.fromCharCode(o)}i=o===-2,r.push(s)}return r.join("")}function jUe(t){const r={constructs:BBe([AUe,...(t||{}).extensions||[]]),content:i(YBe),defined:[],document:i(ZBe),flow:i(gUe),lazy:{},string:i(vUe),text:i(xUe)};return r;function i(o){return s;function s(a){return MUe(r,o,a)}}}function RUe(t){for(;!bre(t););return t}const MB=/[\0\t\n\r]/g;function $Ue(){let t=1,e="",n=!0,r;return i;function i(o,s,a){const l=[];let c,d,u,p,f;for(o=e+(typeof o=="string"?o.toString():new TextDecoder(s||void 0).decode(o)),u=0,e="",n&&(o.charCodeAt(0)===65279&&u++,n=void 0);u<o.length;){if(MB.lastIndex=u,c=MB.exec(o),p=c&&c.index!==void 0?c.index:o.length,f=o.charCodeAt(p),!c){e=o.slice(u);break}if(f===10&&u===p&&r)l.push(-3),r=void 0;else switch(r&&(l.push(-5),r=void 0),u<p&&(l.push(o.slice(u,p)),t+=p-u),f){case 0:{l.push(65533),t++;break}case 9:{for(d=Math.ceil(t/4)*4,l.push(-2);t++<d;)l.push(-1);break}case 10:{l.push(-4),t=1;break}default:r=!0,t=1}u=p+1}return a&&(r&&l.push(-5),e&&l.push(e),l.push(null)),l}}const NUe=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function LUe(t){return t.replace(NUe,zUe)}function zUe(t,e,n){if(e)return e;if(n.charCodeAt(0)===35){const i=n.charCodeAt(1),o=i===120||i===88;return yre(n.slice(o?2:1),o?16:10)}return uj(n)||t}const Pre={}.hasOwnProperty;function FUe(t,e,n){return typeof e!="string"&&(n=e,e=void 0),BUe(n)(RUe(jUe(n).document().write($Ue()(t,e,!0))))}function BUe(t){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:o(Tr),autolinkProtocol:B,autolinkEmail:B,atxHeading:o(Gt),blockQuote:o($e),characterEscape:B,characterReference:B,codeFenced:o(Ft),codeFencedFenceInfo:s,codeFencedFenceMeta:s,codeIndented:o(Ft,s),codeText:o(rn,s),codeTextData:B,data:B,codeFlowValue:B,definition:o(Dt),definitionDestinationString:s,definitionLabelString:s,definitionTitleString:s,emphasis:o(Kt),hardBreakEscape:o(Gn),hardBreakTrailing:o(Gn),htmlFlow:o(Ln,s),htmlFlowData:B,htmlText:o(Ln,s),htmlTextData:B,image:o(Pr),label:s,link:o(Tr),listItem:o(gr),listItemValue:p,listOrdered:o(fr,u),listUnordered:o(fr),paragraph:o(ts),reference:U,referenceString:s,resourceDestinationString:s,resourceTitleString:s,setextHeading:o(Gt),strong:o(ya),thematicBreak:o(Ur)},exit:{atxHeading:l(),atxHeadingSequence:A,autolink:l(),autolinkEmail:Re,autolinkProtocol:Se,blockQuote:l(),characterEscapeValue:L,characterReferenceMarkerHexadecimal:ge,characterReferenceMarkerNumeric:ge,characterReferenceValue:Te,characterReference:ye,codeFenced:l(x),codeFencedFence:v,codeFencedFenceInfo:f,codeFencedFenceMeta:y,codeFlowValue:L,codeIndented:l(b),codeText:l(V),codeTextData:L,data:L,definition:l(),definitionDestinationString:C,definitionLabelString:w,definitionTitleString:_,emphasis:l(),hardBreakEscape:l(F),hardBreakTrailing:l(F),htmlFlow:l(z),htmlFlowData:L,htmlText:l($),htmlTextData:L,image:l(re),label:X,labelText:q,lineEnding:j,link:l(Y),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:ke,resourceDestinationString:N,resourceTitleString:H,resource:ie,setextHeading:l(D),setextHeadingLineSequence:O,setextHeadingText:E,strong:l(),thematicBreak:l()}};Tre(e,(t||{}).mdastExtensions||[]);const n={};return r;function r(de){let Me={type:"root",children:[]};const nt={stack:[Me],tokenStack:[],config:e,enter:a,exit:c,buffer:s,resume:d,data:n},vt=[];let oe=-1;for(;++oe<de.length;)if(de[oe][1].type==="listOrdered"||de[oe][1].type==="listUnordered")if(de[oe][0]==="enter")vt.push(oe);else{const Ie=vt.pop();oe=i(de,Ie,oe)}for(oe=-1;++oe<de.length;){const Ie=e[de[oe][0]];Pre.call(Ie,de[oe][1].type)&&Ie[de[oe][1].type].call(Object.assign({sliceSerialize:de[oe][2].sliceSerialize},nt),de[oe][1])}if(nt.tokenStack.length>0){const Ie=nt.tokenStack[nt.tokenStack.length-1];(Ie[1]||OB).call(nt,void 0,Ie[0])}for(Me.position={start:ou(de.length>0?de[0][1].start:{line:1,column:1,offset:0}),end:ou(de.length>0?de[de.length-2][1].end:{line:1,column:1,offset:0})},oe=-1;++oe<e.transforms.length;)Me=e.transforms[oe](Me)||Me;return Me}function i(de,Me,nt){let vt=Me-1,oe=-1,Ie=!1,Qe,Pt,zn,Fn;for(;++vt<=nt;){const mn=de[vt];switch(mn[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{mn[0]==="enter"?oe++:oe--,Fn=void 0;break}case"lineEndingBlank":{mn[0]==="enter"&&(Qe&&!Fn&&!oe&&!zn&&(zn=vt),Fn=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:Fn=void 0}if(!oe&&mn[0]==="enter"&&mn[1].type==="listItemPrefix"||oe===-1&&mn[0]==="exit"&&(mn[1].type==="listUnordered"||mn[1].type==="listOrdered")){if(Qe){let Bn=vt;for(Pt=void 0;Bn--;){const ln=de[Bn];if(ln[1].type==="lineEnding"||ln[1].type==="lineEndingBlank"){if(ln[0]==="exit")continue;Pt&&(de[Pt][1].type="lineEndingBlank",Ie=!0),ln[1].type="lineEnding",Pt=Bn}else if(!(ln[1].type==="linePrefix"||ln[1].type==="blockQuotePrefix"||ln[1].type==="blockQuotePrefixWhitespace"||ln[1].type==="blockQuoteMarker"||ln[1].type==="listItemIndent"))break}zn&&(!Pt||zn<Pt)&&(Qe._spread=!0),Qe.end=Object.assign({},Pt?de[Pt][1].start:mn[1].end),de.splice(Pt||vt,0,["exit",Qe,mn[2]]),vt++,nt++}if(mn[1].type==="listItemPrefix"){const Bn={type:"listItem",_spread:!1,start:Object.assign({},mn[1].start),end:void 0};Qe=Bn,de.splice(vt,0,["enter",Bn,mn[2]]),vt++,nt++,zn=void 0,Fn=!0}}}return de[Me][1]._spread=Ie,nt}function o(de,Me){return nt;function nt(vt){a.call(this,de(vt),vt),Me&&Me.call(this,vt)}}function s(){this.stack.push({type:"fragment",children:[]})}function a(de,Me,nt){this.stack[this.stack.length-1].children.push(de),this.stack.push(de),this.tokenStack.push([Me,nt||void 0]),de.position={start:ou(Me.start),end:void 0}}function l(de){return Me;function Me(nt){de&&de.call(this,nt),c.call(this,nt)}}function c(de,Me){const nt=this.stack.pop(),vt=this.tokenStack.pop();if(vt)vt[0].type!==de.type&&(Me?Me.call(this,de,vt[0]):(vt[1]||OB).call(this,de,vt[0]));else throw new Error("Cannot close `"+de.type+"` ("+qm({start:de.start,end:de.end})+"): it’s not open");nt.position.end=ou(de.end)}function d(){return zBe(this.stack.pop())}function u(){this.data.expectingFirstListItemValue=!0}function p(de){if(this.data.expectingFirstListItemValue){const Me=this.stack[this.stack.length-2];Me.start=Number.parseInt(this.sliceSerialize(de),10),this.data.expectingFirstListItemValue=void 0}}function f(){const de=this.resume(),Me=this.stack[this.stack.length-1];Me.lang=de}function y(){const de=this.resume(),Me=this.stack[this.stack.length-1];Me.meta=de}function v(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function x(){const de=this.resume(),Me=this.stack[this.stack.length-1];Me.value=de.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function b(){const de=this.resume(),Me=this.stack[this.stack.length-1];Me.value=de.replace(/(\r?\n|\r)$/g,"")}function w(de){const Me=this.resume(),nt=this.stack[this.stack.length-1];nt.label=Me,nt.identifier=nf(this.sliceSerialize(de)).toLowerCase()}function _(){const de=this.resume(),Me=this.stack[this.stack.length-1];Me.title=de}function C(){const de=this.resume(),Me=this.stack[this.stack.length-1];Me.url=de}function A(de){const Me=this.stack[this.stack.length-1];if(!Me.depth){const nt=this.sliceSerialize(de).length;Me.depth=nt}}function E(){this.data.setextHeadingSlurpLineEnding=!0}function O(de){const Me=this.stack[this.stack.length-1];Me.depth=this.sliceSerialize(de).codePointAt(0)===61?1:2}function D(){this.data.setextHeadingSlurpLineEnding=void 0}function B(de){const nt=this.stack[this.stack.length-1].children;let vt=nt[nt.length-1];(!vt||vt.type!=="text")&&(vt=va(),vt.position={start:ou(de.start),end:void 0},nt.push(vt)),this.stack.push(vt)}function L(de){const Me=this.stack.pop();Me.value+=this.sliceSerialize(de),Me.position.end=ou(de.end)}function j(de){const Me=this.stack[this.stack.length-1];if(this.data.atHardBreak){const nt=Me.children[Me.children.length-1];nt.position.end=ou(de.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(Me.type)&&(B.call(this,de),L.call(this,de))}function F(){this.data.atHardBreak=!0}function z(){const de=this.resume(),Me=this.stack[this.stack.length-1];Me.value=de}function $(){const de=this.resume(),Me=this.stack[this.stack.length-1];Me.value=de}function V(){const de=this.resume(),Me=this.stack[this.stack.length-1];Me.value=de}function Y(){const de=this.stack[this.stack.length-1];if(this.data.inReference){const Me=this.data.referenceType||"shortcut";de.type+="Reference",de.referenceType=Me,delete de.url,delete de.title}else delete de.identifier,delete de.label;this.data.referenceType=void 0}function re(){const de=this.stack[this.stack.length-1];if(this.data.inReference){const Me=this.data.referenceType||"shortcut";de.type+="Reference",de.referenceType=Me,delete de.url,delete de.title}else delete de.identifier,delete de.label;this.data.referenceType=void 0}function q(de){const Me=this.sliceSerialize(de),nt=this.stack[this.stack.length-2];nt.label=LUe(Me),nt.identifier=nf(Me).toLowerCase()}function X(){const de=this.stack[this.stack.length-1],Me=this.resume(),nt=this.stack[this.stack.length-1];if(this.data.inReference=!0,nt.type==="link"){const vt=de.children;nt.children=vt}else nt.alt=Me}function N(){const de=this.resume(),Me=this.stack[this.stack.length-1];Me.url=de}function H(){const de=this.resume(),Me=this.stack[this.stack.length-1];Me.title=de}function ie(){this.data.inReference=void 0}function U(){this.data.referenceType="collapsed"}function ke(de){const Me=this.resume(),nt=this.stack[this.stack.length-1];nt.label=Me,nt.identifier=nf(this.sliceSerialize(de)).toLowerCase(),this.data.referenceType="full"}function ge(de){this.data.characterReferenceType=de.type}function Te(de){const Me=this.sliceSerialize(de),nt=this.data.characterReferenceType;let vt;nt?(vt=yre(Me,nt==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):vt=uj(Me);const oe=this.stack[this.stack.length-1];oe.value+=vt}function ye(de){const Me=this.stack.pop();Me.position.end=ou(de.end)}function Se(de){L.call(this,de);const Me=this.stack[this.stack.length-1];Me.url=this.sliceSerialize(de)}function Re(de){L.call(this,de);const Me=this.stack[this.stack.length-1];Me.url="mailto:"+this.sliceSerialize(de)}function $e(){return{type:"blockquote",children:[]}}function Ft(){return{type:"code",lang:null,meta:null,value:""}}function rn(){return{type:"inlineCode",value:""}}function Dt(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Kt(){return{type:"emphasis",children:[]}}function Gt(){return{type:"heading",depth:0,children:[]}}function Gn(){return{type:"break"}}function Ln(){return{type:"html",value:""}}function Pr(){return{type:"image",title:null,url:"",alt:null}}function Tr(){return{type:"link",title:null,url:"",children:[]}}function fr(de){return{type:"list",ordered:de.type==="listOrdered",start:null,spread:de._spread,children:[]}}function gr(de){return{type:"listItem",spread:de._spread,checked:null,children:[]}}function ts(){return{type:"paragraph",children:[]}}function ya(){return{type:"strong",children:[]}}function va(){return{type:"text",value:""}}function Ur(){return{type:"thematicBreak"}}}function ou(t){return{line:t.line,column:t.column,offset:t.offset}}function Tre(t,e){let n=-1;for(;++n<e.length;){const r=e[n];Array.isArray(r)?Tre(t,r):UUe(t,r)}}function UUe(t,e){let n;for(n in e)if(Pre.call(e,n))switch(n){case"canContainEols":{const r=e[n];r&&t[n].push(...r);break}case"transforms":{const r=e[n];r&&t[n].push(...r);break}case"enter":case"exit":{const r=e[n];r&&Object.assign(t[n],r);break}}}function OB(t,e){throw t?new Error("Cannot close `"+t.type+"` ("+qm({start:t.start,end:t.end})+"): a different token (`"+e.type+"`, "+qm({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+qm({start:e.start,end:e.end})+") is still open")}function HUe(t){const e=this;e.parser=n;function n(r){return FUe(r,{...e.data("settings"),...t,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function WUe(t,e){const n={type:"element",tagName:"blockquote",properties:{},children:t.wrap(t.all(e),!0)};return t.patch(e,n),t.applyData(e,n)}function VUe(t,e){const n={type:"element",tagName:"br",properties:{},children:[]};return t.patch(e,n),[t.applyData(e,n),{type:"text",value:`
`}]}function KUe(t,e){const n=e.value?e.value+`
`:"",r={};e.lang&&(r.className=["language-"+e.lang]);let i={type:"element",tagName:"code",properties:r,children:[{type:"text",value:n}]};return e.meta&&(i.data={meta:e.meta}),t.patch(e,i),i=t.applyData(e,i),i={type:"element",tagName:"pre",properties:{},children:[i]},t.patch(e,i),i}function qUe(t,e){const n={type:"element",tagName:"del",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function GUe(t,e){const n={type:"element",tagName:"em",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function YUe(t,e){const n=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",r=String(e.identifier).toUpperCase(),i=Yf(r.toLowerCase()),o=t.footnoteOrder.indexOf(r);let s,a=t.footnoteCounts.get(r);a===void 0?(a=0,t.footnoteOrder.push(r),s=t.footnoteOrder.length):s=o+1,a+=1,t.footnoteCounts.set(r,a);const l={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+i,id:n+"fnref-"+i+(a>1?"-"+a:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(s)}]};t.patch(e,l);const c={type:"element",tagName:"sup",properties:{},children:[l]};return t.patch(e,c),t.applyData(e,c)}function XUe(t,e){const n={type:"element",tagName:"h"+e.depth,properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function ZUe(t,e){if(t.options.allowDangerousHtml){const n={type:"raw",value:e.value};return t.patch(e,n),t.applyData(e,n)}}function Ere(t,e){const n=e.referenceType;let r="]";if(n==="collapsed"?r+="[]":n==="full"&&(r+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+r}];const i=t.all(e),o=i[0];o&&o.type==="text"?o.value="["+o.value:i.unshift({type:"text",value:"["});const s=i[i.length-1];return s&&s.type==="text"?s.value+=r:i.push({type:"text",value:r}),i}function JUe(t,e){const n=String(e.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return Ere(t,e);const i={src:Yf(r.url||""),alt:e.alt};r.title!==null&&r.title!==void 0&&(i.title=r.title);const o={type:"element",tagName:"img",properties:i,children:[]};return t.patch(e,o),t.applyData(e,o)}function QUe(t,e){const n={src:Yf(e.url)};e.alt!==null&&e.alt!==void 0&&(n.alt=e.alt),e.title!==null&&e.title!==void 0&&(n.title=e.title);const r={type:"element",tagName:"img",properties:n,children:[]};return t.patch(e,r),t.applyData(e,r)}function e8e(t,e){const n={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};t.patch(e,n);const r={type:"element",tagName:"code",properties:{},children:[n]};return t.patch(e,r),t.applyData(e,r)}function t8e(t,e){const n=String(e.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return Ere(t,e);const i={href:Yf(r.url||"")};r.title!==null&&r.title!==void 0&&(i.title=r.title);const o={type:"element",tagName:"a",properties:i,children:t.all(e)};return t.patch(e,o),t.applyData(e,o)}function n8e(t,e){const n={href:Yf(e.url)};e.title!==null&&e.title!==void 0&&(n.title=e.title);const r={type:"element",tagName:"a",properties:n,children:t.all(e)};return t.patch(e,r),t.applyData(e,r)}function r8e(t,e,n){const r=t.all(e),i=n?i8e(n):Are(e),o={},s=[];if(typeof e.checked=="boolean"){const d=r[0];let u;d&&d.type==="element"&&d.tagName==="p"?u=d:(u={type:"element",tagName:"p",properties:{},children:[]},r.unshift(u)),u.children.length>0&&u.children.unshift({type:"text",value:" "}),u.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),o.className=["task-list-item"]}let a=-1;for(;++a<r.length;){const d=r[a];(i||a!==0||d.type!=="element"||d.tagName!=="p")&&s.push({type:"text",value:`
`}),d.type==="element"&&d.tagName==="p"&&!i?s.push(...d.children):s.push(d)}const l=r[r.length-1];l&&(i||l.type!=="element"||l.tagName!=="p")&&s.push({type:"text",value:`
`});const c={type:"element",tagName:"li",properties:o,children:s};return t.patch(e,c),t.applyData(e,c)}function i8e(t){let e=!1;if(t.type==="list"){e=t.spread||!1;const n=t.children;let r=-1;for(;!e&&++r<n.length;)e=Are(n[r])}return e}function Are(t){const e=t.spread;return e??t.children.length>1}function o8e(t,e){const n={},r=t.all(e);let i=-1;for(typeof e.start=="number"&&e.start!==1&&(n.start=e.start);++i<r.length;){const s=r[i];if(s.type==="element"&&s.tagName==="li"&&s.properties&&Array.isArray(s.properties.className)&&s.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const o={type:"element",tagName:e.ordered?"ol":"ul",properties:n,children:t.wrap(r,!0)};return t.patch(e,o),t.applyData(e,o)}function s8e(t,e){const n={type:"element",tagName:"p",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function a8e(t,e){const n={type:"root",children:t.wrap(t.all(e))};return t.patch(e,n),t.applyData(e,n)}function l8e(t,e){const n={type:"element",tagName:"strong",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function c8e(t,e){const n=t.all(e),r=n.shift(),i=[];if(r){const s={type:"element",tagName:"thead",properties:{},children:t.wrap([r],!0)};t.patch(e.children[0],s),i.push(s)}if(n.length>0){const s={type:"element",tagName:"tbody",properties:{},children:t.wrap(n,!0)},a=sj(e.children[1]),l=ure(e.children[e.children.length-1]);a&&l&&(s.position={start:a,end:l}),i.push(s)}const o={type:"element",tagName:"table",properties:{},children:t.wrap(i,!0)};return t.patch(e,o),t.applyData(e,o)}function u8e(t,e,n){const r=n?n.children:void 0,o=(r?r.indexOf(e):1)===0?"th":"td",s=n&&n.type==="table"?n.align:void 0,a=s?s.length:e.children.length;let l=-1;const c=[];for(;++l<a;){const u=e.children[l],p={},f=s?s[l]:void 0;f&&(p.align=f);let y={type:"element",tagName:o,properties:p,children:[]};u&&(y.children=t.all(u),t.patch(u,y),y=t.applyData(u,y)),c.push(y)}const d={type:"element",tagName:"tr",properties:{},children:t.wrap(c,!0)};return t.patch(e,d),t.applyData(e,d)}function d8e(t,e){const n={type:"element",tagName:"td",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}const DB=9,jB=32;function h8e(t){const e=String(t),n=/\r?\n|\r/g;let r=n.exec(e),i=0;const o=[];for(;r;)o.push(RB(e.slice(i,r.index),i>0,!0),r[0]),i=r.index+r[0].length,r=n.exec(e);return o.push(RB(e.slice(i),i>0,!1)),o.join("")}function RB(t,e,n){let r=0,i=t.length;if(e){let o=t.codePointAt(r);for(;o===DB||o===jB;)r++,o=t.codePointAt(r)}if(n){let o=t.codePointAt(i-1);for(;o===DB||o===jB;)i--,o=t.codePointAt(i-1)}return i>r?t.slice(r,i):""}function p8e(t,e){const n={type:"text",value:h8e(String(e.value))};return t.patch(e,n),t.applyData(e,n)}function f8e(t,e){const n={type:"element",tagName:"hr",properties:{},children:[]};return t.patch(e,n),t.applyData(e,n)}const g8e={blockquote:WUe,break:VUe,code:KUe,delete:qUe,emphasis:GUe,footnoteReference:YUe,heading:XUe,html:ZUe,imageReference:JUe,image:QUe,inlineCode:e8e,linkReference:t8e,link:n8e,listItem:r8e,list:o8e,paragraph:s8e,root:a8e,strong:l8e,table:c8e,tableCell:d8e,tableRow:u8e,text:p8e,thematicBreak:f8e,toml:MS,yaml:MS,definition:MS,footnoteDefinition:MS};function MS(){}const Mre=-1,q1=0,Ym=1,$w=2,pj=3,fj=4,gj=5,mj=6,Ore=7,Dre=8,$B=typeof self=="object"?self:globalThis,m8e=(t,e)=>{const n=(i,o)=>(t.set(o,i),i),r=i=>{if(t.has(i))return t.get(i);const[o,s]=e[i];switch(o){case q1:case Mre:return n(s,i);case Ym:{const a=n([],i);for(const l of s)a.push(r(l));return a}case $w:{const a=n({},i);for(const[l,c]of s)a[r(l)]=r(c);return a}case pj:return n(new Date(s),i);case fj:{const{source:a,flags:l}=s;return n(new RegExp(a,l),i)}case gj:{const a=n(new Map,i);for(const[l,c]of s)a.set(r(l),r(c));return a}case mj:{const a=n(new Set,i);for(const l of s)a.add(r(l));return a}case Ore:{const{name:a,message:l}=s;return n(new $B[a](l),i)}case Dre:return n(BigInt(s),i);case"BigInt":return n(Object(BigInt(s)),i);case"ArrayBuffer":return n(new Uint8Array(s).buffer,s);case"DataView":{const{buffer:a}=new Uint8Array(s);return n(new DataView(a),s)}}return n(new $B[o](s),i)};return r},NB=t=>m8e(new Map,t)(0),Ep="",{toString:y8e}={},{keys:v8e}=Object,nm=t=>{const e=typeof t;if(e!=="object"||!t)return[q1,e];const n=y8e.call(t).slice(8,-1);switch(n){case"Array":return[Ym,Ep];case"Object":return[$w,Ep];case"Date":return[pj,Ep];case"RegExp":return[fj,Ep];case"Map":return[gj,Ep];case"Set":return[mj,Ep];case"DataView":return[Ym,n]}return n.includes("Array")?[Ym,n]:n.includes("Error")?[Ore,n]:[$w,n]},OS=([t,e])=>t===q1&&(e==="function"||e==="symbol"),x8e=(t,e,n,r)=>{const i=(s,a)=>{const l=r.push(s)-1;return n.set(a,l),l},o=s=>{if(n.has(s))return n.get(s);let[a,l]=nm(s);switch(a){case q1:{let d=s;switch(l){case"bigint":a=Dre,d=s.toString();break;case"function":case"symbol":if(t)throw new TypeError("unable to serialize "+l);d=null;break;case"undefined":return i([Mre],s)}return i([a,d],s)}case Ym:{if(l){let p=s;return l==="DataView"?p=new Uint8Array(s.buffer):l==="ArrayBuffer"&&(p=new Uint8Array(s)),i([l,[...p]],s)}const d=[],u=i([a,d],s);for(const p of s)d.push(o(p));return u}case $w:{if(l)switch(l){case"BigInt":return i([l,s.toString()],s);case"Boolean":case"Number":case"String":return i([l,s.valueOf()],s)}if(e&&"toJSON"in s)return o(s.toJSON());const d=[],u=i([a,d],s);for(const p of v8e(s))(t||!OS(nm(s[p])))&&d.push([o(p),o(s[p])]);return u}case pj:return i([a,s.toISOString()],s);case fj:{const{source:d,flags:u}=s;return i([a,{source:d,flags:u}],s)}case gj:{const d=[],u=i([a,d],s);for(const[p,f]of s)(t||!(OS(nm(p))||OS(nm(f))))&&d.push([o(p),o(f)]);return u}case mj:{const d=[],u=i([a,d],s);for(const p of s)(t||!OS(nm(p)))&&d.push(o(p));return u}}const{message:c}=s;return i([a,{name:l,message:c}],s)};return o},LB=(t,{json:e,lossy:n}={})=>{const r=[];return x8e(!(e||n),!!e,new Map,r)(t),r},Nw=typeof structuredClone=="function"?(t,e)=>e&&("json"in e||"lossy"in e)?NB(LB(t,e)):structuredClone(t):(t,e)=>NB(LB(t,e));function S8e(t,e){const n=[{type:"text",value:"↩"}];return e>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),n}function b8e(t,e){return"Back to reference "+(t+1)+(e>1?"-"+e:"")}function w8e(t){const e=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",n=t.options.footnoteBackContent||S8e,r=t.options.footnoteBackLabel||b8e,i=t.options.footnoteLabel||"Footnotes",o=t.options.footnoteLabelTagName||"h2",s=t.options.footnoteLabelProperties||{className:["sr-only"]},a=[];let l=-1;for(;++l<t.footnoteOrder.length;){const c=t.footnoteById.get(t.footnoteOrder[l]);if(!c)continue;const d=t.all(c),u=String(c.identifier).toUpperCase(),p=Yf(u.toLowerCase());let f=0;const y=[],v=t.footnoteCounts.get(u);for(;v!==void 0&&++f<=v;){y.length>0&&y.push({type:"text",value:" "});let w=typeof n=="string"?n:n(l,f);typeof w=="string"&&(w={type:"text",value:w}),y.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+p+(f>1?"-"+f:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(l,f),className:["data-footnote-backref"]},children:Array.isArray(w)?w:[w]})}const x=d[d.length-1];if(x&&x.type==="element"&&x.tagName==="p"){const w=x.children[x.children.length-1];w&&w.type==="text"?w.value+=" ":x.children.push({type:"text",value:" "}),x.children.push(...y)}else d.push(...y);const b={type:"element",tagName:"li",properties:{id:e+"fn-"+p},children:t.wrap(d,!0)};t.patch(c,b),a.push(b)}if(a.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:o,properties:{...Nw(s),id:"footnote-label"},children:[{type:"text",value:i}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:t.wrap(a,!0)},{type:"text",value:`
`}]}}const jre=(function(t){if(t==null)return C8e;if(typeof t=="function")return G1(t);if(typeof t=="object")return Array.isArray(t)?k8e(t):I8e(t);if(typeof t=="string")return _8e(t);throw new Error("Expected function, string, or object as test")});function k8e(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=jre(t[n]);return G1(r);function r(...i){let o=-1;for(;++o<e.length;)if(e[o].apply(this,i))return!0;return!1}}function I8e(t){const e=t;return G1(n);function n(r){const i=r;let o;for(o in t)if(i[o]!==e[o])return!1;return!0}}function _8e(t){return G1(e);function e(n){return n&&n.type===t}}function G1(t){return e;function e(n,r,i){return!!(P8e(n)&&t.call(this,n,typeof r=="number"?r:void 0,i||void 0))}}function C8e(){return!0}function P8e(t){return t!==null&&typeof t=="object"&&"type"in t}const Rre=[],T8e=!0,zB=!1,E8e="skip";function A8e(t,e,n,r){let i;typeof e=="function"&&typeof n!="function"?(r=n,n=e):i=e;const o=jre(i),s=r?-1:1;a(t,void 0,[])();function a(l,c,d){const u=l&&typeof l=="object"?l:{};if(typeof u.type=="string"){const f=typeof u.tagName=="string"?u.tagName:typeof u.name=="string"?u.name:void 0;Object.defineProperty(p,"name",{value:"node ("+(l.type+(f?"<"+f+">":""))+")"})}return p;function p(){let f=Rre,y,v,x;if((!e||o(l,c,d[d.length-1]||void 0))&&(f=M8e(n(l,d)),f[0]===zB))return f;if("children"in l&&l.children){const b=l;if(b.children&&f[0]!==E8e)for(v=(r?b.children.length:-1)+s,x=d.concat(b);v>-1&&v<b.children.length;){const w=b.children[v];if(y=a(w,v,x)(),y[0]===zB)return y;v=typeof y[1]=="number"?y[1]:v+s}}return f}}}function M8e(t){return Array.isArray(t)?t:typeof t=="number"?[T8e,t]:t==null?Rre:[t]}function $re(t,e,n,r){let i,o,s;typeof e=="function"&&typeof n!="function"?(o=void 0,s=e,i=n):(o=e,s=n,i=r),A8e(t,o,a,i);function a(l,c){const d=c[c.length-1],u=d?d.children.indexOf(l):void 0;return s(l,u,d)}}const r2={}.hasOwnProperty,O8e={};function D8e(t,e){const n=e||O8e,r=new Map,i=new Map,o=new Map,s={...g8e,...n.handlers},a={all:c,applyData:R8e,definitionById:r,footnoteById:i,footnoteCounts:o,footnoteOrder:[],handlers:s,one:l,options:n,patch:j8e,wrap:N8e};return $re(t,function(d){if(d.type==="definition"||d.type==="footnoteDefinition"){const u=d.type==="definition"?r:i,p=String(d.identifier).toUpperCase();u.has(p)||u.set(p,d)}}),a;function l(d,u){const p=d.type,f=a.handlers[p];if(r2.call(a.handlers,p)&&f)return f(a,d,u);if(a.options.passThrough&&a.options.passThrough.includes(p)){if("children"in d){const{children:v,...x}=d,b=Nw(x);return b.children=a.all(d),b}return Nw(d)}return(a.options.unknownHandler||$8e)(a,d,u)}function c(d){const u=[];if("children"in d){const p=d.children;let f=-1;for(;++f<p.length;){const y=a.one(p[f],d);if(y){if(f&&p[f-1].type==="break"&&(!Array.isArray(y)&&y.type==="text"&&(y.value=FB(y.value)),!Array.isArray(y)&&y.type==="element")){const v=y.children[0];v&&v.type==="text"&&(v.value=FB(v.value))}Array.isArray(y)?u.push(...y):u.push(y)}}}return u}}function j8e(t,e){t.position&&(e.position=yBe(t))}function R8e(t,e){let n=e;if(t&&t.data){const r=t.data.hName,i=t.data.hChildren,o=t.data.hProperties;if(typeof r=="string")if(n.type==="element")n.tagName=r;else{const s="children"in n?n.children:[n];n={type:"element",tagName:r,properties:{},children:s}}n.type==="element"&&o&&Object.assign(n.properties,Nw(o)),"children"in n&&n.children&&i!==null&&i!==void 0&&(n.children=i)}return n}function $8e(t,e){const n=e.data||{},r="value"in e&&!(r2.call(n,"hProperties")||r2.call(n,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:t.all(e)};return t.patch(e,r),t.applyData(e,r)}function N8e(t,e){const n=[];let r=-1;for(e&&n.push({type:"text",value:`
`});++r<t.length;)r&&n.push({type:"text",value:`
`}),n.push(t[r]);return e&&t.length>0&&n.push({type:"text",value:`
`}),n}function FB(t){let e=0,n=t.charCodeAt(e);for(;n===9||n===32;)e++,n=t.charCodeAt(e);return t.slice(e)}function BB(t,e){const n=D8e(t,e),r=n.one(t,void 0),i=w8e(n),o=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return i&&o.children.push({type:"text",value:`
`},i),o}function L8e(t,e){return t&&"run"in t?async function(n,r){const i=BB(n,{file:r,...e});await t.run(i,r)}:function(n,r){return BB(n,{file:r,...t||e})}}function UB(t){if(t)throw t}var nT,HB;function z8e(){if(HB)return nT;HB=1;var t=Object.prototype.hasOwnProperty,e=Object.prototype.toString,n=Object.defineProperty,r=Object.getOwnPropertyDescriptor,i=function(c){return typeof Array.isArray=="function"?Array.isArray(c):e.call(c)==="[object Array]"},o=function(c){if(!c||e.call(c)!=="[object Object]")return!1;var d=t.call(c,"constructor"),u=c.constructor&&c.constructor.prototype&&t.call(c.constructor.prototype,"isPrototypeOf");if(c.constructor&&!d&&!u)return!1;var p;for(p in c);return typeof p>"u"||t.call(c,p)},s=function(c,d){n&&d.name==="__proto__"?n(c,d.name,{enumerable:!0,configurable:!0,value:d.newValue,writable:!0}):c[d.name]=d.newValue},a=function(c,d){if(d==="__proto__")if(t.call(c,d)){if(r)return r(c,d).value}else return;return c[d]};return nT=function l(){var c,d,u,p,f,y,v=arguments[0],x=1,b=arguments.length,w=!1;for(typeof v=="boolean"&&(w=v,v=arguments[1]||{},x=2),(v==null||typeof v!="object"&&typeof v!="function")&&(v={});x<b;++x)if(c=arguments[x],c!=null)for(d in c)u=a(v,d),p=a(c,d),v!==p&&(w&&p&&(o(p)||(f=i(p)))?(f?(f=!1,y=u&&i(u)?u:[]):y=u&&o(u)?u:{},s(v,{name:d,newValue:l(w,y,p)})):typeof p<"u"&&s(v,{name:d,newValue:p}));return v},nT}var F8e=z8e();const rT=ua(F8e);function i2(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function B8e(){const t=[],e={run:n,use:r};return e;function n(...i){let o=-1;const s=i.pop();if(typeof s!="function")throw new TypeError("Expected function as last argument, not "+s);a(null,...i);function a(l,...c){const d=t[++o];let u=-1;if(l){s(l);return}for(;++u<i.length;)(c[u]===null||c[u]===void 0)&&(c[u]=i[u]);i=c,d?U8e(d,a)(...c):s(null,...c)}}function r(i){if(typeof i!="function")throw new TypeError("Expected `middelware` to be a function, not "+i);return t.push(i),e}}function U8e(t,e){let n;return r;function r(...s){const a=t.length>s.length;let l;a&&s.push(i);try{l=t.apply(this,s)}catch(c){const d=c;if(a&&n)throw d;return i(d)}a||(l&&l.then&&typeof l.then=="function"?l.then(o,i):l instanceof Error?i(l):o(l))}function i(s,...a){n||(n=!0,e(s,...a))}function o(s){i(null,s)}}const hl={basename:H8e,dirname:W8e,extname:V8e,join:K8e,sep:"/"};function H8e(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');Dv(t);let n=0,r=-1,i=t.length,o;if(e===void 0||e.length===0||e.length>t.length){for(;i--;)if(t.codePointAt(i)===47){if(o){n=i+1;break}}else r<0&&(o=!0,r=i+1);return r<0?"":t.slice(n,r)}if(e===t)return"";let s=-1,a=e.length-1;for(;i--;)if(t.codePointAt(i)===47){if(o){n=i+1;break}}else s<0&&(o=!0,s=i+1),a>-1&&(t.codePointAt(i)===e.codePointAt(a--)?a<0&&(r=i):(a=-1,r=s));return n===r?r=s:r<0&&(r=t.length),t.slice(n,r)}function W8e(t){if(Dv(t),t.length===0)return".";let e=-1,n=t.length,r;for(;--n;)if(t.codePointAt(n)===47){if(r){e=n;break}}else r||(r=!0);return e<0?t.codePointAt(0)===47?"/":".":e===1&&t.codePointAt(0)===47?"//":t.slice(0,e)}function V8e(t){Dv(t);let e=t.length,n=-1,r=0,i=-1,o=0,s;for(;e--;){const a=t.codePointAt(e);if(a===47){if(s){r=e+1;break}continue}n<0&&(s=!0,n=e+1),a===46?i<0?i=e:o!==1&&(o=1):i>-1&&(o=-1)}return i<0||n<0||o===0||o===1&&i===n-1&&i===r+1?"":t.slice(i,n)}function K8e(...t){let e=-1,n;for(;++e<t.length;)Dv(t[e]),t[e]&&(n=n===void 0?t[e]:n+"/"+t[e]);return n===void 0?".":q8e(n)}function q8e(t){Dv(t);const e=t.codePointAt(0)===47;let n=G8e(t,!e);return n.length===0&&!e&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),e?"/"+n:n}function G8e(t,e){let n="",r=0,i=-1,o=0,s=-1,a,l;for(;++s<=t.length;){if(s<t.length)a=t.codePointAt(s);else{if(a===47)break;a=47}if(a===47){if(!(i===s-1||o===1))if(i!==s-1&&o===2){if(n.length<2||r!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(l=n.lastIndexOf("/"),l!==n.length-1){l<0?(n="",r=0):(n=n.slice(0,l),r=n.length-1-n.lastIndexOf("/")),i=s,o=0;continue}}else if(n.length>0){n="",r=0,i=s,o=0;continue}}e&&(n=n.length>0?n+"/..":"..",r=2)}else n.length>0?n+="/"+t.slice(i+1,s):n=t.slice(i+1,s),r=s-i-1;i=s,o=0}else a===46&&o>-1?o++:o=-1}return n}function Dv(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const Y8e={cwd:X8e};function X8e(){return"/"}function o2(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function Z8e(t){if(typeof t=="string")t=new URL(t);else if(!o2(t)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(t.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return J8e(t)}function J8e(t){if(t.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const e=t.pathname;let n=-1;for(;++n<e.length;)if(e.codePointAt(n)===37&&e.codePointAt(n+1)===50){const r=e.codePointAt(n+2);if(r===70||r===102){const i=new TypeError("File URL path must not include encoded / characters");throw i.code="ERR_INVALID_FILE_URL_PATH",i}}return decodeURIComponent(e)}const iT=["history","path","basename","stem","extname","dirname"];class Nre{constructor(e){let n;e?o2(e)?n={path:e}:typeof e=="string"||Q8e(e)?n={value:e}:n=e:n={},this.cwd="cwd"in n?"":Y8e.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<iT.length;){const o=iT[r];o in n&&n[o]!==void 0&&n[o]!==null&&(this[o]=o==="history"?[...n[o]]:n[o])}let i;for(i in n)iT.includes(i)||(this[i]=n[i])}get basename(){return typeof this.path=="string"?hl.basename(this.path):void 0}set basename(e){sT(e,"basename"),oT(e,"basename"),this.path=hl.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?hl.dirname(this.path):void 0}set dirname(e){WB(this.basename,"dirname"),this.path=hl.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?hl.extname(this.path):void 0}set extname(e){if(oT(e,"extname"),WB(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=hl.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){o2(e)&&(e=Z8e(e)),sT(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?hl.basename(this.path,this.extname):void 0}set stem(e){sT(e,"stem"),oT(e,"stem"),this.path=hl.join(this.dirname||"",e+(this.extname||""))}fail(e,n,r){const i=this.message(e,n,r);throw i.fatal=!0,i}info(e,n,r){const i=this.message(e,n,r);return i.fatal=void 0,i}message(e,n,r){const i=new no(e,n,r);return this.path&&(i.name=this.path+":"+i.name,i.file=this.path),i.fatal=!1,this.messages.push(i),i}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function oT(t,e){if(t&&t.includes(hl.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+hl.sep+"`")}function sT(t,e){if(!t)throw new Error("`"+e+"` cannot be empty")}function WB(t,e){if(!t)throw new Error("Setting `"+e+"` requires `path` to be set too")}function Q8e(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const e9e=(function(t){const r=this.constructor.prototype,i=r[t],o=function(){return i.apply(o,arguments)};return Object.setPrototypeOf(o,r),o}),t9e={}.hasOwnProperty;class yj extends e9e{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=B8e()}copy(){const e=new yj;let n=-1;for(;++n<this.attachers.length;){const r=this.attachers[n];e.use(...r)}return e.data(rT(!0,{},this.namespace)),e}data(e,n){return typeof e=="string"?arguments.length===2?(cT("data",this.frozen),this.namespace[e]=n,this):t9e.call(this.namespace,e)&&this.namespace[e]||void 0:e?(cT("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const i=n.call(e,...r);typeof i=="function"&&this.transformers.use(i)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const n=DS(e),r=this.parser||this.Parser;return aT("parse",r),r(String(n),n)}process(e,n){const r=this;return this.freeze(),aT("process",this.parser||this.Parser),lT("process",this.compiler||this.Compiler),n?i(void 0,n):new Promise(i);function i(o,s){const a=DS(e),l=r.parse(a);r.run(l,a,function(d,u,p){if(d||!u||!p)return c(d);const f=u,y=r.stringify(f,p);i9e(y)?p.value=y:p.result=y,c(d,p)});function c(d,u){d||!u?s(d):o?o(u):n(void 0,u)}}}processSync(e){let n=!1,r;return this.freeze(),aT("processSync",this.parser||this.Parser),lT("processSync",this.compiler||this.Compiler),this.process(e,i),KB("processSync","process",n),r;function i(o,s){n=!0,UB(o),r=s}}run(e,n,r){VB(e),this.freeze();const i=this.transformers;return!r&&typeof n=="function"&&(r=n,n=void 0),r?o(void 0,r):new Promise(o);function o(s,a){const l=DS(n);i.run(e,l,c);function c(d,u,p){const f=u||e;d?a(d):s?s(f):r(void 0,f,p)}}}runSync(e,n){let r=!1,i;return this.run(e,n,o),KB("runSync","run",r),i;function o(s,a){UB(s),i=a,r=!0}}stringify(e,n){this.freeze();const r=DS(n),i=this.compiler||this.Compiler;return lT("stringify",i),VB(e),i(e,r)}use(e,...n){const r=this.attachers,i=this.namespace;if(cT("use",this.frozen),e!=null)if(typeof e=="function")l(e,n);else if(typeof e=="object")Array.isArray(e)?a(e):s(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function o(c){if(typeof c=="function")l(c,[]);else if(typeof c=="object")if(Array.isArray(c)){const[d,...u]=c;l(d,u)}else s(c);else throw new TypeError("Expected usable value, not `"+c+"`")}function s(c){if(!("plugins"in c)&&!("settings"in c))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");a(c.plugins),c.settings&&(i.settings=rT(!0,i.settings,c.settings))}function a(c){let d=-1;if(c!=null)if(Array.isArray(c))for(;++d<c.length;){const u=c[d];o(u)}else throw new TypeError("Expected a list of plugins, not `"+c+"`")}function l(c,d){let u=-1,p=-1;for(;++u<r.length;)if(r[u][0]===c){p=u;break}if(p===-1)r.push([c,...d]);else if(d.length>0){let[f,...y]=d;const v=r[p][1];i2(v)&&i2(f)&&(f=rT(!0,v,f)),r[p]=[c,f,...y]}}}}const n9e=new yj().freeze();function aT(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function lT(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function cT(t,e){if(e)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function VB(t){if(!i2(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function KB(t,e,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+e+"` instead")}function DS(t){return r9e(t)?t:new Nre(t)}function r9e(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function i9e(t){return typeof t=="string"||o9e(t)}function o9e(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const s9e="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",qB=[],GB={allowDangerousHtml:!0},a9e=/^(https?|ircs?|mailto|xmpp)$/i,l9e=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function c9e(t){const e=u9e(t),n=d9e(t);return h9e(e.runSync(e.parse(n),n),t)}function u9e(t){const e=t.rehypePlugins||qB,n=t.remarkPlugins||qB,r=t.remarkRehypeOptions?{...t.remarkRehypeOptions,...GB}:GB;return n9e().use(HUe).use(n).use(L8e,r).use(e)}function d9e(t){const e=t.children||"",n=new Nre;return typeof e=="string"&&(n.value=e),n}function h9e(t,e){const n=e.allowedElements,r=e.allowElement,i=e.components,o=e.disallowedElements,s=e.skipHtml,a=e.unwrapDisallowed,l=e.urlTransform||p9e;for(const d of l9e)Object.hasOwn(e,d.from)&&(""+d.from+(d.to?"use `"+d.to+"` instead":"remove it")+s9e+d.id,void 0);return $re(t,c),wBe(t,{Fragment:g.Fragment,components:i,ignoreInvalidStyle:!0,jsx:g.jsx,jsxs:g.jsxs,passKeys:!0,passNode:!0});function c(d,u,p){if(d.type==="raw"&&p&&typeof u=="number")return s?p.children.splice(u,1):p.children[u]={type:"text",value:d.value},u;if(d.type==="element"){let f;for(f in QP)if(Object.hasOwn(QP,f)&&Object.hasOwn(d.properties,f)){const y=d.properties[f],v=QP[f];(v===null||v.includes(d.tagName))&&(d.properties[f]=l(String(y||""),f,d))}}if(d.type==="element"){let f=n?!n.includes(d.tagName):o?o.includes(d.tagName):!1;if(!f&&r&&typeof u=="number"&&(f=!r(d,u,p)),f&&p&&typeof u=="number")return a&&d.children?p.children.splice(u,1,...d.children):p.children.splice(u,1),u}}}function p9e(t){const e=t.indexOf(":"),n=t.indexOf("?"),r=t.indexOf("#"),i=t.indexOf("/");return e===-1||i!==-1&&e>i||n!==-1&&e>n||r!==-1&&e>r||a9e.test(t.slice(0,e))?t:""}function vj(){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"chat-icon",children:g.jsx("path",{d:"m6 9 6 6 6-6"})})}function Lre(){return g.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"chat-icon",children:g.jsx("path",{d:"m9 18 6-6-6-6"})})}function f9e({group:t,agent:e}){const{items:n}=t,r=I.useMemo(()=>n.filter(c=>{const{description:d}=vh(c.action,e);return d!==null}),[n,e]),[i,o]=I.useState(!0),s=I.useMemo(()=>n.every(c=>c.action.complete),[n]),a=I.useMemo(()=>{const c=Math.floor(n.reduce((d,u)=>d+u.action.time,0)/1e3);return c===0?"Thought for less than a second":c===1?"Thought for 1 second":`Thought for ${c} seconds`},[n]);if(r.length===0)return null;if(r.length<2)return g.jsx("div",{className:"chat-history-group",children:r.map((c,d)=>g.jsx(g9e,{item:c,agent:e},"action-"+d))});const l=!i||!s;return g.jsxs("div",{className:"chat-history-group",children:[s&&g.jsxs("button",{onClick:()=>o(c=>!c),children:[g.jsx("span",{children:l?g.jsx(vj,{}):g.jsx(Lre,{})}),a]}),l&&g.jsx("div",{className:"agent-actions-container",children:r.map((c,d)=>g.jsx(zre,{action:c.action,agent:e},"action-"+d))})]})}function g9e({item:t,agent:e}){const{action:n}=t,{description:r,summary:i}=vh(n,e),o=i!==null,[s,a]=I.useState(o);return r?g.jsxs("div",{className:"agent-actions-container",children:[n.complete&&o&&g.jsxs("button",{onClick:()=>a(l=>!l),children:[g.jsx("span",{children:s?g.jsx(Lre,{}):g.jsx(vj,{})}),i]}),(!s||!n.complete)&&g.jsx(zre,{action:n,agent:e})]}):null}function zre({action:t,agent:e}){const{icon:n,description:r}=vh(t,e);return g.jsxs("div",{className:`agent-action agent-action-type-${t._type}`,children:[n&&g.jsx("span",{children:g.jsx(Rw,{type:n})}),g.jsx("span",{className:"agent-action-description",children:g.jsx(c9e,{children:r})})]})}function m9e({group:t,agent:e}){return t.withDiff?g.jsx(K6e,{group:t,agent:e}):g.jsx(f9e,{group:t,agent:e})}function y9e(t,e){const n=[];for(const r of t){const{description:i}=vh(r.action,e);if(i===null)continue;const o=n[n.length-1];o&&v9e({item:r,group:o,agent:e})?o.items.push(r):n.push({items:[r],withDiff:!Kw(r.diff)&&r.action.complete})}return n}function v9e({item:t,group:e,agent:n}){if(!t.action.complete||!e||!Kw(t.diff)!==e.withDiff||e.items[0]?.acceptance!==t.acceptance)return!1;const o=e.items.at(-1)?.action;if(!o)return!1;const s=vh(t.action,n),a=vh(o,n);return!!(s.canGroup(o)&&a.canGroup(t.action))}const Fre={shape:{icon:"target",name:t=>{let e=t.shape.note;return e||(e=t.shape._type,t.shape._type==="draw"?e="drawing":t.shape._type==="unknown"&&(e=t.shape.subType)),e[0].toUpperCase()+e.slice(1)}},area:{icon:"target",name:()=>"Area"},point:{icon:"target",name:()=>"Point"},shapes:{icon:"target",name:(t,e)=>{const n=t.shapes.length;return n===1?Fre.shape.name(t,e):`${n} shapes`}}};function Bre({text:t,icon:e,onClick:n}){return n?g.jsxs("button",{type:"button",className:"prompt-tag",onClick:n,children:[g.jsx(Rw,{type:e})," ",g.jsx("span",{children:t})]}):g.jsxs("div",{className:"prompt-tag",children:[g.jsx(Rw,{type:e})," ",g.jsx("span",{children:t})]})}function Ure({item:t,editor:e,onClick:n}){const r=Fre[t.type],i=r.name(t,e),o=r.icon;return g.jsx(Bre,{text:i,icon:o,onClick:n})}function Hre({onClick:t}){return g.jsx(Bre,{text:"Selection",icon:"cursor",onClick:t})}function x9e({item:t,editor:e}){const{contextItems:n,message:r,selectedShapes:i}=t,o=i.length>0||n.length>0;return g.jsx("div",{className:"chat-history-prompt-container",children:g.jsxs("div",{className:"chat-history-prompt",children:[o&&g.jsxs("div",{className:"prompt-tags",children:[i.length>0&&g.jsx(Hre,{}),n.map((s,a)=>g.jsx(Ure,{editor:e,item:s},"context-item-"+a))]}),r]})})}function S9e({section:t,agent:e,loading:n}){const r=t.items.filter(o=>o.type==="action"),i=y9e(r,e);return g.jsxs("div",{className:"chat-history-section",children:[g.jsx(x9e,{item:t.prompt,editor:e.editor}),i.map((o,s)=>g.jsx(m9e,{group:o,agent:e},"chat-history-group-"+s)),n&&g.jsx(P6e,{})]})}function b9e(t){const e=[];for(const n of t){if(n.type==="prompt"){e.push({prompt:n,items:[]});continue}e[e.length-1].items.push(n)}return e}function w9e({agent:t}){const e=J(t.$chatHistory),n=b9e(e),r=I.useRef(null),i=I.useRef(0);I.useEffect(()=>{if(r.current){if(e.at(-1)?.type==="prompt"){i.current<=0&&(r.current.scrollTo(0,r.current.scrollHeight),i.current=0);return}i.current<=0&&r.current.scrollHeight-r.current.scrollTop-r.current.clientHeight>0&&r.current.scrollTo(0,r.current.scrollHeight)}},[r,e]);const o=()=>{if(!r.current)return;const a=r.current.scrollHeight-r.current.scrollTop-r.current.clientHeight;i.current=a},s=J("isGenerating",()=>t.isGenerating(),[t]);return g.jsx("div",{className:"chat-history",ref:r,onScroll:o,children:n.map((a,l)=>g.jsx(S9e,{section:a,agent:t,loading:l===n.length-1&&s},"history-section-"+l))})}function k9e(){return g.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"chat-icon",children:[g.jsx("circle",{cx:"12",cy:"12",r:"4"}),g.jsx("path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8"})]})}function I9e({agent:t,handleSubmit:e,inputRef:n}){const{editor:r}=t,[i,o]=I.useState(""),s=J("isGenerating",()=>t.isGenerating(),[t]),a=J("isContextToolActive",()=>{const u=r.getCurrentTool();return u.id==="target-shape"||u.id==="target-area"},[r]),l=J("selectedShapes",()=>r.getSelectedShapes(),[r]),c=J(t.$contextItems),d=J(t.$modelName);return g.jsx("div",{className:"chat-input",children:g.jsxs("form",{onSubmit:u=>{u.preventDefault(),o(""),e(u)},children:[g.jsxs("div",{className:"prompt-tags",children:[g.jsxs("div",{className:"chat-context-select "+(a?"active":""),children:[g.jsxs("div",{className:"chat-context-select-label",children:[g.jsx(k9e,{})," Add Context"]}),g.jsx("select",{id:"chat-context-select",value:" ",onChange:u=>{const p=YB.find(f=>f.name===u.target.value);p&&p.onSelect(r)},children:YB.map(u=>g.jsx("option",{value:u.name,children:u.name},u.name))})]}),l.length>0&&g.jsx(Hre,{onClick:()=>r.selectNone()}),c.map((u,p)=>g.jsx(Ure,{editor:r,onClick:()=>t.removeFromContext(u),item:u},"context-item-"+p))]}),g.jsx("textarea",{ref:n,name:"input",autoComplete:"off",placeholder:"Ask, learn, brainstorm, draw",value:i,onInput:u=>o(u.currentTarget.value),onKeyDown:u=>{if(u.key==="Enter"&&!u.shiftKey){u.preventDefault();const p=u.currentTarget.closest("form");if(p){const f=new Event("submit",{bubbles:!0,cancelable:!0});p.dispatchEvent(f)}}}}),g.jsxs("span",{className:"chat-actions",children:[g.jsx("div",{className:"chat-actions-left",children:g.jsxs("div",{className:"chat-model-select",children:[g.jsxs("div",{className:"chat-model-select-label",children:[g.jsx(nre,{})," ",d]}),g.jsx("select",{value:d,onChange:u=>t.$modelName.set(u.target.value),children:Object.values(x6e).map(u=>g.jsx("option",{value:u.name,children:u.name},u.name))}),g.jsx(vj,{})]})}),g.jsx("button",{className:"chat-input-submit",disabled:i===""&&!s,children:s&&i===""?"◼":"⬆"})]})]})})}const YB=[{name:"Pick Shapes",onSelect:t=>{t.setCurrentTool("target-shape"),t.focus()}},{name:"Pick Area",onSelect:t=>{t.setCurrentTool("target-area"),t.focus()}},{name:" ",onSelect:t=>{const e=t.getCurrentTool();(e.id==="target-area"||e.id==="target-shape")&&t.setCurrentTool("select")}}];function _9e({agent:t}){const e=J(t.$todoList);return e.length===0?null:g.jsx("div",{className:"todo-list",children:g.jsx("div",{className:"todo-list-items",children:e.map(n=>g.jsx(C9e,{agent:t,item:n},n.id))})})}function C9e({agent:t,item:e}){const n=I.useCallback(()=>{t.$todoList.update(o=>o.filter(s=>s.id!==e.id))},[e.id,t.$todoList]),i=(o=>{switch(o){case"todo":return"○";case"in-progress":return"➤";case"done":return"●"}})(e.status);return g.jsxs("div",{className:`todo-item todo-item-${e.status}`,children:[g.jsx("span",{className:"todo-item-icon",children:i}),g.jsx("span",{className:"todo-item-text",children:e.text}),g.jsx("button",{className:"todo-item-delete",onClick:n,children:"×"})]})}function P9e({agent:t}){const{editor:e}=t,n=I.useRef(null),r=J(t.$modelName),i=I.useCallback(async a=>{if(a.preventDefault(),!n.current)return;const c=new FormData(a.currentTarget).get("input");if(c===""){t.cancel();return}t.$todoList.get().filter(y=>y.status!=="done").length===0&&t.$todoList.set([]);const u=c,p=t.$contextItems.get();t.$contextItems.set([]),n.current.value="";const f=e.getSelectedShapes().map(y=>Au(e,y));await t.prompt({message:u,contextItems:p,bounds:e.getViewportPageBounds(),modelName:r,selectedShapes:f,type:"user"})},[t,r,e]);function o(){t.reset()}function s(){return g.jsx("button",{className:"new-chat-button",onClick:o,children:"+"})}return g.jsxs("div",{className:"chat-panel tl-theme__dark",children:[g.jsx("div",{className:"chat-header",children:g.jsx(s,{})}),g.jsx(w9e,{agent:t}),g.jsxs("div",{className:"chat-input-container",children:[g.jsx(_9e,{agent:t}),g.jsx(I9e,{agent:t,handleSubmit:i,inputRef:n})]})]})}function T9e(){return g.jsxs("div",{className:"chat-fallback",children:[g.jsx("p",{children:"Error loading chat history"}),g.jsx("button",{onClick:()=>{localStorage.clear(),window.location.reload()},children:"Clear chat history"})]})}function E9e({agent:t}){const e=ne(),r=J(t.$activeRequest)?.bounds,i=J("agentIsOffscreen",()=>{if(!r)return!1;const a=e.getViewportScreenBounds(),l=pe.From(r).corners.map(c=>e.pageToViewport(c));return!pe.FromPoints(l).collides(a)},[r]),o=J("angleToAgent",()=>{if(!r||i)return;const a=pe.From(r).center,l=e.pageToViewport(a),c=e.getViewportScreenBounds(),d=pe.From(c).center,u=T.From(l).sub(d);return Math.atan2(u.y,u.x)*(180/Math.PI)},[r]),s=I.useCallback(()=>{if(r){const a=pe.From(r).expandBy(50);e.zoomToBounds(a,{animation:{duration:220}})}},[r,e]);return!r||!i?null:g.jsx(It,{type:"low",onClick:s,children:g.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",gap:8},children:[g.jsx(it,{icon:g.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",style:{transform:`rotate(${o}deg)`,transition:"transform 0.2s ease"},children:g.jsx("path",{d:"M8 6l6 6-6 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})})}),g.jsx(dr,{children:"Go to agent"})]})})}function A9e({agent:t}){return g.jsx(JY,{children:g.jsxs(qi,{type:"helper-buttons",sourceId:"helper-buttons",children:[g.jsx(ZY,{}),g.jsx(E9e,{agent:t})]})})}function Wre({pageBounds:t,color:e,generating:n,label:r}){const i=ne(),o=J("screenBounds",()=>{const u=pe.From(t).expandBy(4).corners.map(p=>i.pageToViewport(p));return pe.FromPoints(u)},[t]);if(!o)return null;const s=o.minX,a=o.minY,l=o.maxX,c=o.maxY;return g.jsxs(g.Fragment,{children:[g.jsx(_l,{className:`context-highlight ${n?"context-highlight-generating":""}`,style:{top:a,left:s,width:l-s,height:c-a},children:o.sides.map((d,u)=>g.jsx("line",{x1:d[0].x-o.minX,y1:d[0].y-o.minY,x2:d[1].x-o.minX,y2:d[1].y-o.minY,stroke:e},"context-highlight-side-"+u))}),r&&g.jsx("div",{className:"context-highlight-label",style:{top:o.y,left:o.x,backgroundColor:e},children:r})]})}function M9e({agent:t}){const e=J(t.$activeRequest),n=e?.bounds,r=J("isEquivalentToPendingContextArea",()=>n?e.contextItems.some(o=>o.type==="area"&&o.source==="agent"&&pe.Equals(o.bounds,n)):!1,[n]);return!n||r?null:g.jsx(Wre,{pageBounds:n,color:"var(--tl-color-tooltip)",generating:!0,label:"Agent view"},"prompt-bounds-highlight")}function O9e({pagePoint:t,color:e,generating:n}){const r=ne(),i=J("screenPoint",()=>r.pageToViewport(t),[]),o=3;return g.jsx(_l,{className:`context-highlight ${n?"context-highlight-generating":""}`,style:{top:i.y-o,left:i.x-o,width:o*2,height:o*2},children:g.jsx("circle",{cx:o,cy:o,r:o,stroke:e||"var(--color-selected)",fill:e||"var(--color-selected)"})})}function D9e({agent:t}){const e=ne(),n=J(t.$contextItems),i=J(t.$activeRequest)?.contextItems??[],o=J("selectedAreas",()=>n.filter(x=>x.type==="area").map(x=>({pageBounds:x.bounds,generating:!1,color:"var(--tl-color-selected)"})),[n]),s=J("activeAreas",()=>i.filter(x=>x.type==="area").map(x=>({pageBounds:x.bounds,generating:!0,color:"var(--tl-color-selected)",label:x.source==="agent"?"Reviewing":void 0})),[i]),a=J("selectedShapes",()=>n.filter(x=>x.type==="shapes").map(x=>{const b=e.getShapesPageBounds(x.shapes.map(w=>`shape:${w.shapeId}`));return b?{pageBounds:b,generating:!1,color:"var(--tl-color-selected)"}:null}).filter(x=>x!==null),[n]),l=J("activeShapes",()=>i.filter(x=>x.type==="shapes").map(x=>{const b=e.getShapesPageBounds(x.shapes.map(w=>`shape:${w.shapeId}`));return b?{pageBounds:b,generating:!0,color:"var(--tl-color-selected)"}:null}).filter(x=>x!==null),[i]),c=J("selectedShapesAreas",()=>n.filter(x=>x.type==="shape").map(x=>{const b=e.getShapePageBounds(`shape:${x.shape.shapeId}`);return b?{pageBounds:b,generating:!1,color:"var(--tl-color-selected)"}:null}).filter(x=>x!==null),[n]),d=J("activeShapeAreas",()=>i.filter(x=>x.type==="shape").map(x=>{const b=e.getShapePageBounds(`shape:${x.shape.shapeId}`);return b?{pageBounds:b,generating:!0,color:"var(--tl-color-selected)"}:null}).filter(x=>x!==null),[i]),u=J("selectedPoints",()=>n.filter(x=>x.type==="point").map(x=>({pagePoint:x.point,generating:!1,color:"var(--tl-color-selected)"})),[n]),p=J("activePoints",()=>i.filter(x=>x.type==="point").map(x=>({pagePoint:x.point,generating:!0,color:"var(--tl-color-selected)"})),[i]),f=I.useMemo(()=>[...o,...a,...c,...s,...l,...d],[o,a,c,s,l,d]),y=I.useMemo(()=>[...u,...p],[u,p]);return g.jsxs(g.Fragment,{children:[f.map((v,x)=>g.jsx(Wre,{pageBounds:v.pageBounds,color:v.color,generating:v.generating,label:v.label},"context-highlight-"+x)),y.map((v,x)=>g.jsx(O9e,{pagePoint:v.pagePoint,color:v.color,generating:v.generating},"context-point-"+x))]})}function j9e(){tn.lightMode.black.fill="#363636",tn.lightMode.blue.fill="#6580ec",tn.lightMode["light-blue"].fill="#7abaf5",tn.lightMode.green.fill="#0bad7c",tn.lightMode.grey.fill="#bbc1c9",tn.lightMode["light-green"].fill="#7ec88c",tn.lightMode["light-red"].fill="#f99a9a",tn.lightMode["light-violet"].fill="#e9abf7",tn.lightMode.orange.fill="#ea8643",tn.lightMode.red.fill="#e75f5f",tn.lightMode.violet.fill="#be68d4",tn.lightMode.yellow.fill="#f5c27a",tn.lightMode.white.solid="#f5f5f5",tn.darkMode.black.solid="#f0f0f0",tn.darkMode.black.fill="#ffffff",tn.darkMode.blue.fill="#3c5cdd",tn.darkMode["light-blue"].fill="#2793ec",tn.darkMode.green.fill="#087856",tn.darkMode.grey.fill="#8388a5",tn.darkMode["light-green"].fill="#37a44b",tn.darkMode["light-red"].fill="#ff6666",tn.darkMode["light-violet"].fill="#dc71f4",tn.darkMode.orange.fill="#f54900",tn.darkMode.red.fill="#c31d1d",tn.darkMode.violet.fill="#8f2fa7",tn.darkMode.yellow.fill="#ffae00",tn.darkMode.white=tn.lightMode.black}class R9e extends We{static id="target-area";static initial="idle";static children(){return[$9e,N9e,L9e]}isLockable=!1;onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onExit(){this.editor.setCursor({type:"default",rotation:0})}onInterrupt(){this.complete()}onCancel(){this.complete()}complete(){this.parent.transition("select",{})}}class $9e extends We{static id="idle";onPointerDown(){this.parent.transition("pointing")}}class N9e extends We{static id="pointing";initialScreenPoint=void 0;initialPagePoint=void 0;onEnter(){this.initialScreenPoint=this.editor.inputs.currentScreenPoint.clone(),this.initialPagePoint=this.editor.inputs.currentPagePoint.clone()}onPointerMove(){this.initialScreenPoint&&this.editor.inputs.isDragging&&this.parent.transition("dragging",{initialPagePoint:this.initialPagePoint})}onPointerUp(){const e=yh.get(this.editor);for(const n of e)n.addToContext({type:"point",point:this.editor.inputs.currentPagePoint.clone(),source:"user"});this.editor.setCurrentTool("select")}}class L9e extends We{static id="dragging";initialPagePoint=void 0;bounds=void 0;onEnter(e){this.initialPagePoint=e.initialPagePoint,this.updateBounds()}onPointerMove(){this.updateBounds()}onPointerUp(){if(this.editor.updateInstanceState({brush:null}),!this.bounds)throw new Error("Bounds not set");const e=yh.get(this.editor);for(const n of e)n.addToContext({type:"area",bounds:this.bounds,source:"user"});this.editor.setCurrentTool("select")}updateBounds(){if(!this.initialPagePoint)return;const e=this.editor.inputs.currentPagePoint,n=Math.min(this.initialPagePoint.x,e.x),r=Math.min(this.initialPagePoint.y,e.y),i=Math.abs(e.x-this.initialPagePoint.x),o=Math.abs(e.y-this.initialPagePoint.y);this.editor.updateInstanceState({brush:{x:n,y:r,w:i,h:o}}),this.bounds={x:n,y:r,w:i,h:o}}}class z9e extends We{static id="target-shape";static initial="idle";static children(){return[F9e,B9e,U9e]}isLockable=!1;onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onExit(){this.editor.setCursor({type:"default",rotation:0})}onInterrupt(){this.complete()}onCancel(){this.complete()}complete(){this.parent.transition("select",{})}}class F9e extends We{static id="idle";onPointerMove(){const{currentPagePoint:e}=this.editor.inputs,n=this.editor.getShapeAtPoint(e,{hitInside:!0});n?this.editor.setHintingShapes([n]):this.editor.setHintingShapes([])}onPointerDown(){const e=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0});this.parent.transition("pointing",{shape:e})}}class B9e extends We{static id="pointing";shape=void 0;initialScreenPoint=void 0;initialPagePoint=void 0;onEnter({shape:e}){this.initialScreenPoint=this.editor.inputs.currentScreenPoint.clone(),this.initialPagePoint=this.editor.inputs.currentPagePoint.clone(),this.shape=e}onPointerMove(){this.initialScreenPoint&&this.editor.inputs.isDragging&&this.parent.transition("dragging",{initialPagePoint:this.initialPagePoint})}onPointerUp(){if(this.editor.setHintingShapes([]),this.shape){const e=yh.get(this.editor);for(const n of e)n.addToContext({type:"shape",shape:Au(this.editor,this.shape),source:"user"})}this.editor.setCurrentTool("select")}}class U9e extends We{static id="dragging";shapes=[];initialPagePoint=void 0;bounds=void 0;onEnter(e){this.initialPagePoint=e.initialPagePoint,this.editor.setHintingShapes([]),this.updateBounds()}onPointerMove(){this.updateBounds()}onPointerUp(){if(this.editor.setHintingShapes([]),this.editor.updateInstanceState({brush:null}),!this.bounds)throw new Error("Bounds not set");const e=yh.get(this.editor);if(this.shapes.length<=3)for(const n of this.shapes)for(const r of e)r.addToContext({type:"shape",shape:Au(this.editor,n),source:"user"});else for(const n of e)n.addToContext({type:"shapes",shapes:this.shapes.map(r=>Au(this.editor,r)),source:"user"});this.editor.setCurrentTool("select")}updateBounds(){if(!this.initialPagePoint)return;const e=this.editor.inputs.currentPagePoint,n=Math.min(this.initialPagePoint.x,e.x),r=Math.min(this.initialPagePoint.y,e.y),i=Math.abs(e.x-this.initialPagePoint.x),o=Math.abs(e.y-this.initialPagePoint.y);this.editor.updateInstanceState({brush:{x:n,y:r,w:i,h:o}}),this.bounds={x:n,y:r,w:i,h:o};const s=new pe(n,r,i,o),a=this.editor.getCurrentPageShapesSorted().filter(l=>{const c=this.editor.getShapeGeometry(l),p=this.editor.getShapePageTransform(l).clone().invert().applyToPoints(s.corners);return c.overlapsPolygon(p)});this.shapes=a,this.editor.setHintingShapes(a)}}/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H9e=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),W9e=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,r)=>r?r.toUpperCase():n.toLowerCase()),XB=t=>{const e=W9e(t);return e.charAt(0).toUpperCase()+e.slice(1)},Vre=(...t)=>t.filter((e,n,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===n).join(" ").trim(),V9e=t=>{for(const e in t)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var K9e={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q9e=I.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:i="",children:o,iconNode:s,...a},l)=>I.createElement("svg",{ref:l,...K9e,width:e,height:e,stroke:t,strokeWidth:r?Number(n)*24/Number(e):n,className:Vre("lucide",i),...!o&&!V9e(a)&&{"aria-hidden":"true"},...a},[...s.map(([c,d])=>I.createElement(c,d)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jv=(t,e)=>{const n=I.forwardRef(({className:r,...i},o)=>I.createElement(q9e,{ref:o,iconNode:e,className:Vre(`lucide-${H9e(XB(t))}`,`lucide-${t}`,r),...i}));return n.displayName=XB(t),n};/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G9e=[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]],Y9e=jv("arrow-up",G9e);/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X9e=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],Z9e=jv("file-text",X9e);/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J9e=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],Q9e=jv("image",J9e);/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eHe=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],tHe=jv("paperclip",eHe);/**
 * @license lucide-react v0.546.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nHe=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],rHe=jv("x",nHe),iHe="agent-starter";Wa.setDefaultValue("s");j9e();const oHe=[z9e,R9e],sHe={tools:(t,e)=>({...e,"target-area":{id:"target-area",label:"Pick Area",kbd:"c",icon:"tool-frame",onSelect(){t.setCurrentTool("target-area")}},"target-shape":{id:"target-shape",label:"Pick Shape",kbd:"s",icon:"tool-frame",onSelect(){t.setCurrentTool("target-shape")}}})};function aHe(){const[t,e]=I.useState(),[n,r]=I.useState("start"),[i,o]=I.useState({initialMessage:"",uploadedFiles:[]}),s=I.useMemo(()=>({HelperButtons:()=>t&&g.jsx(A9e,{agent:t}),InFrontOfTheCanvas:()=>g.jsxs(g.Fragment,{children:[t&&g.jsx(M9e,{agent:t}),t&&g.jsx(D9e,{agent:t})]})}),[t]),a=(l,c)=>{o({initialMessage:l,uploadedFiles:c}),r("board")};return n==="start"?g.jsx(lHe,{onStartSession:a}):n==="board"?g.jsx(DY,{children:g.jsxs("div",{className:"tldraw-agent-container",children:[g.jsx("div",{className:"tldraw-canvas",children:g.jsx(B$e,{persistenceKey:"tldraw-agent-demo",tools:oHe,overrides:sHe,components:s,children:g.jsx(cHe,{setAgent:e,appState:i})})}),g.jsx(t0,{fallback:T9e,children:t&&g.jsx(P9e,{agent:t})})]})}):g.jsx("div",{children:"Not found"})}function lHe({onStartSession:t}){const[e,n]=I.useState(""),[r,i]=I.useState([]),o=I.useRef(null),s=I.useRef(null),a=p=>{if(p.target.files){const f=p.target.files,y=[];for(let v=0;v<f.length;v++)f[v]&&y.push(f[v]);i(v=>[...v,...y])}},l=p=>{i(f=>f.filter((y,v)=>v!==p))},c=()=>{(e.trim()||r.length>0)&&t(e,r)},d=p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),c())};I.useEffect(()=>{s.current&&(s.current.style.height="auto",s.current.style.height=s.current.scrollHeight+"px")},[e]);const u=p=>p.type.indexOf("image/")===0?g.jsx(Q9e,{className:"h-4 w-4"}):g.jsx(Z9e,{className:"h-4 w-4"});return g.jsxs("div",{className:"flex h-screen w-screen flex-col items-center justify-center bg-zinc-900",children:[g.jsxs("div",{className:"mb-12 text-center",children:[g.jsxs("h1",{className:"text-5xl font-bold text-white mb-4",children:["Welcome to ",g.jsx("span",{className:"text-blue-400",children:"REALLY SMART BOARD"})]}),g.jsx("p",{className:"text-zinc-400 text-lg",children:"Start by describing what you want to create or upload files to get started"})]}),g.jsxs("div",{className:"w-full max-w-3xl px-4",children:[r.length>0&&g.jsx("div",{className:"mb-4 flex flex-wrap gap-2",children:r.map((p,f)=>g.jsxs("div",{className:"flex items-center gap-2 rounded-lg bg-zinc-800 px-3 py-2 text-sm text-white",children:[u(p),g.jsx("span",{className:"max-w-[200px] truncate",children:p.name}),g.jsx("button",{onClick:()=>l(f),className:"ml-1 text-zinc-400 hover:text-white",children:g.jsx(rHe,{className:"h-4 w-4"})})]},f))}),g.jsxs("div",{className:"relative flex flex-col rounded-2xl bg-zinc-800 p-4 shadow-lg ring-1 ring-zinc-700",children:[g.jsxs("div",{className:"flex items-end gap-2",children:[g.jsx("input",{ref:o,type:"file",multiple:!0,onChange:a,className:"hidden",accept:"image/*,.pdf,.txt,.doc,.docx"}),g.jsx("button",{onClick:()=>o.current?.click(),className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full text-zinc-400 transition-colors hover:bg-zinc-700 hover:text-white",children:g.jsx(tHe,{className:"h-5 w-5"})}),g.jsx("textarea",{ref:s,value:e,onChange:p=>n(p.target.value),onKeyDown:d,className:"max-h-[200px] min-h-[40px] flex-1 resize-none border-none bg-transparent text-white placeholder-zinc-400 focus:outline-none focus:ring-0",placeholder:"Describe what you want to create...",rows:1}),g.jsx("button",{onClick:c,disabled:!e.trim()&&r.length===0,className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-blue-500 text-white transition-colors hover:bg-blue-600 disabled:bg-zinc-600 disabled:cursor-not-allowed",children:g.jsx(Y9e,{className:"h-5 w-5"})})]}),g.jsx("div",{className:"mt-2 text-xs text-zinc-500",children:"Press Enter to submit, Shift+Enter for new line"})]}),g.jsxs("div",{className:"mt-6 text-center",children:[g.jsx("p",{className:"mb-3 text-sm text-zinc-500",children:"Or try a quick start:"}),g.jsxs("div",{className:"flex flex-wrap justify-center gap-2",children:[g.jsx("button",{onClick:()=>t("Create a brainstorming board for a new app idea",[]),className:"rounded-full bg-zinc-800 px-4 py-2 text-sm text-white transition-colors hover:bg-zinc-700",children:"🧠 Brainstorm Board"}),g.jsx("button",{onClick:()=>t("Create a project planning board",[]),className:"rounded-full bg-zinc-800 px-4 py-2 text-sm text-white transition-colors hover:bg-zinc-700",children:"📋 Project Plan"}),g.jsx("button",{onClick:()=>t("Create a mind map",[]),className:"rounded-full bg-zinc-800 px-4 py-2 text-sm text-white transition-colors hover:bg-zinc-700",children:"🗺️ Mind Map"})]})]})]})]})}function cHe({setAgent:t,appState:e}){const n=ne(),r=C6e(n,iHe),[i,o]=I.useState(!1);return I.useEffect(()=>{!n||!r||(t(r),window.editor=n,window.agent=r)},[r,n,t]),I.useEffect(()=>{if(!r||!n||i)return;(()=>{if(e.initialMessage.trim()){if(e.uploadedFiles.length>0){const a=e.uploadedFiles.map(c=>c.name).join(", "),l=`${e.initialMessage}

(Files uploaded: ${a})`;console.log("Initial message with files:",l)}console.log("Initial message:",e.initialMessage),o(!0)}else o(!0)})()},[r,n,e,i]),null}Coe.createRoot(document.getElementById("root")).render(g.jsx(rt.StrictMode,{children:g.jsx(aHe,{})}));
